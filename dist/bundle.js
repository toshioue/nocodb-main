/*! For license information please see bundle.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.libs=t():e.libs=t()}("undefined"!=typeof self?self:this,(()=>(()=>{var __webpack_modules__={77852:e=>{"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var i,s,r;if(Array.isArray(t)){if((i=t.length)!=a.length)return!1;for(s=i;0!=s--;)if(!e(t[s],a[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(s=i;0!=s--;)if(!Object.prototype.hasOwnProperty.call(a,r[s]))return!1;for(s=i;0!=s--;){var l=r[s];if(!e(t[l],a[l]))return!1}return!0}return t!=t&&a!=a}},6656:function(e,t,a){!function(e){"use strict";e.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mrt_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(e){return/^nm$/i.test(e)},meridiem:function(e,t,a){return e<12?a?"vm":"VM":a?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Môre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",ss:"%d sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(a(43936))},69264:function(e,t,a){!function(e){"use strict";var t=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},a={s:["أقل من ثانية","ثانية واحدة",["ثانيتان","ثانيتين"],"%d ثوان","%d ثانية","%d ثانية"],m:["أقل من دقيقة","دقيقة واحدة",["دقيقتان","دقيقتين"],"%d دقائق","%d دقيقة","%d دقيقة"],h:["أقل من ساعة","ساعة واحدة",["ساعتان","ساعتين"],"%d ساعات","%d ساعة","%d ساعة"],d:["أقل من يوم","يوم واحد",["يومان","يومين"],"%d أيام","%d يومًا","%d يوم"],M:["أقل من شهر","شهر واحد",["شهران","شهرين"],"%d أشهر","%d شهرا","%d شهر"],y:["أقل من عام","عام واحد",["عامان","عامين"],"%d أعوام","%d عامًا","%d عام"]},i=function(e){return function(i,s,r,l){var c=t(i),d=a[e][t(i)];return 2===c&&(d=d[s?0:1]),d.replace(/%d/i,i)}},s=["جانفي","فيفري","مارس","أفريل","ماي","جوان","جويلية","أوت","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];e.defineLocale("ar-dz",{months:s,monthsShort:s,weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/‏M/‏YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/ص|م/,isPM:function(e){return"م"===e},meridiem:function(e,t,a){return e<12?"ص":"م"},calendar:{sameDay:"[اليوم عند الساعة] LT",nextDay:"[غدًا عند الساعة] LT",nextWeek:"dddd [عند الساعة] LT",lastDay:"[أمس عند الساعة] LT",lastWeek:"dddd [عند الساعة] LT",sameElse:"L"},relativeTime:{future:"بعد %s",past:"منذ %s",s:i("s"),ss:i("s"),m:i("m"),mm:i("m"),h:i("h"),hh:i("h"),d:i("d"),dd:i("d"),M:i("M"),MM:i("M"),y:i("y"),yy:i("y")},postformat:function(e){return e.replace(/,/g,"،")},week:{dow:0,doy:4}})}(a(43936))},28420:function(e,t,a){!function(e){"use strict";e.defineLocale("ar-kw",{months:"يناير_فبراير_مارس_أبريل_ماي_يونيو_يوليوز_غشت_شتنبر_أكتوبر_نونبر_دجنبر".split("_"),monthsShort:"يناير_فبراير_مارس_أبريل_ماي_يونيو_يوليوز_غشت_شتنبر_أكتوبر_نونبر_دجنبر".split("_"),weekdays:"الأحد_الإتنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"احد_اتنين_ثلاثاء_اربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[اليوم على الساعة] LT",nextDay:"[غدا على الساعة] LT",nextWeek:"dddd [على الساعة] LT",lastDay:"[أمس على الساعة] LT",lastWeek:"dddd [على الساعة] LT",sameElse:"L"},relativeTime:{future:"في %s",past:"منذ %s",s:"ثوان",ss:"%d ثانية",m:"دقيقة",mm:"%d دقائق",h:"ساعة",hh:"%d ساعات",d:"يوم",dd:"%d أيام",M:"شهر",MM:"%d أشهر",y:"سنة",yy:"%d سنوات"},week:{dow:0,doy:12}})}(a(43936))},83280:function(e,t,a){!function(e){"use strict";var t={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},a=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},i={s:["أقل من ثانية","ثانية واحدة",["ثانيتان","ثانيتين"],"%d ثوان","%d ثانية","%d ثانية"],m:["أقل من دقيقة","دقيقة واحدة",["دقيقتان","دقيقتين"],"%d دقائق","%d دقيقة","%d دقيقة"],h:["أقل من ساعة","ساعة واحدة",["ساعتان","ساعتين"],"%d ساعات","%d ساعة","%d ساعة"],d:["أقل من يوم","يوم واحد",["يومان","يومين"],"%d أيام","%d يومًا","%d يوم"],M:["أقل من شهر","شهر واحد",["شهران","شهرين"],"%d أشهر","%d شهرا","%d شهر"],y:["أقل من عام","عام واحد",["عامان","عامين"],"%d أعوام","%d عامًا","%d عام"]},s=function(e){return function(t,s,r,l){var c=a(t),d=i[e][a(t)];return 2===c&&(d=d[s?0:1]),d.replace(/%d/i,t)}},r=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];e.defineLocale("ar-ly",{months:r,monthsShort:r,weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/‏M/‏YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/ص|م/,isPM:function(e){return"م"===e},meridiem:function(e,t,a){return e<12?"ص":"م"},calendar:{sameDay:"[اليوم عند الساعة] LT",nextDay:"[غدًا عند الساعة] LT",nextWeek:"dddd [عند الساعة] LT",lastDay:"[أمس عند الساعة] LT",lastWeek:"dddd [عند الساعة] LT",sameElse:"L"},relativeTime:{future:"بعد %s",past:"منذ %s",s:s("s"),ss:s("s"),m:s("m"),mm:s("m"),h:s("h"),hh:s("h"),d:s("d"),dd:s("d"),M:s("M"),MM:s("M"),y:s("y"),yy:s("y")},preparse:function(e){return e.replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"،")},week:{dow:6,doy:12}})}(a(43936))},764:function(e,t,a){!function(e){"use strict";e.defineLocale("ar-ma",{months:"يناير_فبراير_مارس_أبريل_ماي_يونيو_يوليوز_غشت_شتنبر_أكتوبر_نونبر_دجنبر".split("_"),monthsShort:"يناير_فبراير_مارس_أبريل_ماي_يونيو_يوليوز_غشت_شتنبر_أكتوبر_نونبر_دجنبر".split("_"),weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"احد_اثنين_ثلاثاء_اربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[اليوم على الساعة] LT",nextDay:"[غدا على الساعة] LT",nextWeek:"dddd [على الساعة] LT",lastDay:"[أمس على الساعة] LT",lastWeek:"dddd [على الساعة] LT",sameElse:"L"},relativeTime:{future:"في %s",past:"منذ %s",s:"ثوان",ss:"%d ثانية",m:"دقيقة",mm:"%d دقائق",h:"ساعة",hh:"%d ساعات",d:"يوم",dd:"%d أيام",M:"شهر",MM:"%d أشهر",y:"سنة",yy:"%d سنوات"},week:{dow:1,doy:4}})}(a(43936))},22096:function(e,t,a){!function(e){"use strict";var t={1:"١",2:"٢",3:"٣",4:"٤",5:"٥",6:"٦",7:"٧",8:"٨",9:"٩",0:"٠"},a={"١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","٠":"0"};e.defineLocale("ar-sa",{months:"يناير_فبراير_مارس_أبريل_مايو_يونيو_يوليو_أغسطس_سبتمبر_أكتوبر_نوفمبر_ديسمبر".split("_"),monthsShort:"يناير_فبراير_مارس_أبريل_مايو_يونيو_يوليو_أغسطس_سبتمبر_أكتوبر_نوفمبر_ديسمبر".split("_"),weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/ص|م/,isPM:function(e){return"م"===e},meridiem:function(e,t,a){return e<12?"ص":"م"},calendar:{sameDay:"[اليوم على الساعة] LT",nextDay:"[غدا على الساعة] LT",nextWeek:"dddd [على الساعة] LT",lastDay:"[أمس على الساعة] LT",lastWeek:"dddd [على الساعة] LT",sameElse:"L"},relativeTime:{future:"في %s",past:"منذ %s",s:"ثوان",ss:"%d ثانية",m:"دقيقة",mm:"%d دقائق",h:"ساعة",hh:"%d ساعات",d:"يوم",dd:"%d أيام",M:"شهر",MM:"%d أشهر",y:"سنة",yy:"%d سنوات"},preparse:function(e){return e.replace(/[١٢٣٤٥٦٧٨٩٠]/g,(function(e){return a[e]})).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"،")},week:{dow:0,doy:6}})}(a(43936))},60480:function(e,t,a){!function(e){"use strict";e.defineLocale("ar-tn",{months:"جانفي_فيفري_مارس_أفريل_ماي_جوان_جويلية_أوت_سبتمبر_أكتوبر_نوفمبر_ديسمبر".split("_"),monthsShort:"جانفي_فيفري_مارس_أفريل_ماي_جوان_جويلية_أوت_سبتمبر_أكتوبر_نوفمبر_ديسمبر".split("_"),weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[اليوم على الساعة] LT",nextDay:"[غدا على الساعة] LT",nextWeek:"dddd [على الساعة] LT",lastDay:"[أمس على الساعة] LT",lastWeek:"dddd [على الساعة] LT",sameElse:"L"},relativeTime:{future:"في %s",past:"منذ %s",s:"ثوان",ss:"%d ثانية",m:"دقيقة",mm:"%d دقائق",h:"ساعة",hh:"%d ساعات",d:"يوم",dd:"%d أيام",M:"شهر",MM:"%d أشهر",y:"سنة",yy:"%d سنوات"},week:{dow:1,doy:4}})}(a(43936))},87248:function(e,t,a){!function(e){"use strict";var t={1:"١",2:"٢",3:"٣",4:"٤",5:"٥",6:"٦",7:"٧",8:"٨",9:"٩",0:"٠"},a={"١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","٠":"0"},i=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},s={s:["أقل من ثانية","ثانية واحدة",["ثانيتان","ثانيتين"],"%d ثوان","%d ثانية","%d ثانية"],m:["أقل من دقيقة","دقيقة واحدة",["دقيقتان","دقيقتين"],"%d دقائق","%d دقيقة","%d دقيقة"],h:["أقل من ساعة","ساعة واحدة",["ساعتان","ساعتين"],"%d ساعات","%d ساعة","%d ساعة"],d:["أقل من يوم","يوم واحد",["يومان","يومين"],"%d أيام","%d يومًا","%d يوم"],M:["أقل من شهر","شهر واحد",["شهران","شهرين"],"%d أشهر","%d شهرا","%d شهر"],y:["أقل من عام","عام واحد",["عامان","عامين"],"%d أعوام","%d عامًا","%d عام"]},r=function(e){return function(t,a,r,l){var c=i(t),d=s[e][i(t)];return 2===c&&(d=d[a?0:1]),d.replace(/%d/i,t)}},l=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];e.defineLocale("ar",{months:l,monthsShort:l,weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/‏M/‏YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/ص|م/,isPM:function(e){return"م"===e},meridiem:function(e,t,a){return e<12?"ص":"م"},calendar:{sameDay:"[اليوم عند الساعة] LT",nextDay:"[غدًا عند الساعة] LT",nextWeek:"dddd [عند الساعة] LT",lastDay:"[أمس عند الساعة] LT",lastWeek:"dddd [عند الساعة] LT",sameElse:"L"},relativeTime:{future:"بعد %s",past:"منذ %s",s:r("s"),ss:r("s"),m:r("m"),mm:r("m"),h:r("h"),hh:r("h"),d:r("d"),dd:r("d"),M:r("M"),MM:r("M"),y:r("y"),yy:r("y")},preparse:function(e){return e.replace(/[١٢٣٤٥٦٧٨٩٠]/g,(function(e){return a[e]})).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"،")},week:{dow:6,doy:12}})}(a(43936))},81995:function(e,t,a){!function(e){"use strict";var t={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-üncü",4:"-üncü",100:"-üncü",6:"-ncı",9:"-uncu",10:"-uncu",30:"-uncu",60:"-ıncı",90:"-ıncı"};e.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertəsi_Çərşənbə axşamı_Çərşənbə_Cümə axşamı_Cümə_Şənbə".split("_"),weekdaysShort:"Baz_BzE_ÇAx_Çər_CAx_Cüm_Şən".split("_"),weekdaysMin:"Bz_BE_ÇA_Çə_CA_Cü_Şə".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugün saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gələn həftə] dddd [saat] LT",lastDay:"[dünən] LT",lastWeek:"[keçən həftə] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s əvvəl",s:"bir neçə saniyə",ss:"%d saniyə",m:"bir dəqiqə",mm:"%d dəqiqə",h:"bir saat",hh:"%d saat",d:"bir gün",dd:"%d gün",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gecə|səhər|gündüz|axşam/,isPM:function(e){return/^(gündüz|axşam)$/.test(e)},meridiem:function(e,t,a){return e<4?"gecə":e<12?"səhər":e<17?"gündüz":"axşam"},dayOfMonthOrdinalParse:/\d{1,2}-(ıncı|inci|nci|üncü|ncı|uncu)/,ordinal:function(e){if(0===e)return e+"-ıncı";var a=e%10,i=e%100-a,s=e>=100?100:null;return e+(t[a]||t[i]||t[s])},week:{dow:1,doy:7}})}(a(43936))},47243:function(e,t,a){!function(e){"use strict";function t(e,t){var a=e.split("_");return t%10==1&&t%100!=11?a[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?a[1]:a[2]}function a(e,a,i){return"m"===i?a?"хвіліна":"хвіліну":"h"===i?a?"гадзіна":"гадзіну":e+" "+t({ss:a?"секунда_секунды_секунд":"секунду_секунды_секунд",mm:a?"хвіліна_хвіліны_хвілін":"хвіліну_хвіліны_хвілін",hh:a?"гадзіна_гадзіны_гадзін":"гадзіну_гадзіны_гадзін",dd:"дзень_дні_дзён",MM:"месяц_месяцы_месяцаў",yy:"год_гады_гадоў"}[i],+e)}e.defineLocale("be",{months:{format:"студзеня_лютага_сакавіка_красавіка_траўня_чэрвеня_ліпеня_жніўня_верасня_кастрычніка_лістапада_снежня".split("_"),standalone:"студзень_люты_сакавік_красавік_травень_чэрвень_ліпень_жнівень_верасень_кастрычнік_лістапад_снежань".split("_")},monthsShort:"студ_лют_сак_крас_трав_чэрв_ліп_жнів_вер_каст_ліст_снеж".split("_"),weekdays:{format:"нядзелю_панядзелак_аўторак_сераду_чацвер_пятніцу_суботу".split("_"),standalone:"нядзеля_панядзелак_аўторак_серада_чацвер_пятніца_субота".split("_"),isFormat:/\[ ?[Ууў] ?(?:мінулую|наступную)? ?\] ?dddd/},weekdaysShort:"нд_пн_ат_ср_чц_пт_сб".split("_"),weekdaysMin:"нд_пн_ат_ср_чц_пт_сб".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., HH:mm",LLLL:"dddd, D MMMM YYYY г., HH:mm"},calendar:{sameDay:"[Сёння ў] LT",nextDay:"[Заўтра ў] LT",lastDay:"[Учора ў] LT",nextWeek:function(){return"[У] dddd [ў] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[У мінулую] dddd [ў] LT";case 1:case 2:case 4:return"[У мінулы] dddd [ў] LT"}},sameElse:"L"},relativeTime:{future:"праз %s",past:"%s таму",s:"некалькі секунд",m:a,mm:a,h:a,hh:a,d:"дзень",dd:a,M:"месяц",MM:a,y:"год",yy:a},meridiemParse:/ночы|раніцы|дня|вечара/,isPM:function(e){return/^(дня|вечара)$/.test(e)},meridiem:function(e,t,a){return e<4?"ночы":e<12?"раніцы":e<17?"дня":"вечара"},dayOfMonthOrdinalParse:/\d{1,2}-(і|ы|га)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e%10!=2&&e%10!=3||e%100==12||e%100==13?e+"-ы":e+"-і";case"D":return e+"-га";default:return e}},week:{dow:1,doy:7}})}(a(43936))},61964:function(e,t,a){!function(e){"use strict";e.defineLocale("bg",{months:"януари_февруари_март_април_май_юни_юли_август_септември_октомври_ноември_декември".split("_"),monthsShort:"яну_фев_мар_апр_май_юни_юли_авг_сеп_окт_ное_дек".split("_"),weekdays:"неделя_понеделник_вторник_сряда_четвъртък_петък_събота".split("_"),weekdaysShort:"нед_пон_вто_сря_чет_пет_съб".split("_"),weekdaysMin:"нд_пн_вт_ср_чт_пт_сб".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[Днес в] LT",nextDay:"[Утре в] LT",nextWeek:"dddd [в] LT",lastDay:"[Вчера в] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[Миналата] dddd [в] LT";case 1:case 2:case 4:case 5:return"[Миналия] dddd [в] LT"}},sameElse:"L"},relativeTime:{future:"след %s",past:"преди %s",s:"няколко секунди",ss:"%d секунди",m:"минута",mm:"%d минути",h:"час",hh:"%d часа",d:"ден",dd:"%d дена",w:"седмица",ww:"%d седмици",M:"месец",MM:"%d месеца",y:"година",yy:"%d години"},dayOfMonthOrdinalParse:/\d{1,2}-(ев|ен|ти|ви|ри|ми)/,ordinal:function(e){var t=e%10,a=e%100;return 0===e?e+"-ев":0===a?e+"-ен":a>10&&a<20?e+"-ти":1===t?e+"-ви":2===t?e+"-ри":7===t||8===t?e+"-ми":e+"-ти"},week:{dow:1,doy:7}})}(a(43936))},82912:function(e,t,a){!function(e){"use strict";e.defineLocale("bm",{months:"Zanwuyekalo_Fewuruyekalo_Marisikalo_Awirilikalo_Mɛkalo_Zuwɛnkalo_Zuluyekalo_Utikalo_Sɛtanburukalo_ɔkutɔburukalo_Nowanburukalo_Desanburukalo".split("_"),monthsShort:"Zan_Few_Mar_Awi_Mɛ_Zuw_Zul_Uti_Sɛt_ɔku_Now_Des".split("_"),weekdays:"Kari_Ntɛnɛn_Tarata_Araba_Alamisa_Juma_Sibiri".split("_"),weekdaysShort:"Kar_Ntɛ_Tar_Ara_Ala_Jum_Sib".split("_"),weekdaysMin:"Ka_Nt_Ta_Ar_Al_Ju_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"MMMM [tile] D [san] YYYY",LLL:"MMMM [tile] D [san] YYYY [lɛrɛ] HH:mm",LLLL:"dddd MMMM [tile] D [san] YYYY [lɛrɛ] HH:mm"},calendar:{sameDay:"[Bi lɛrɛ] LT",nextDay:"[Sini lɛrɛ] LT",nextWeek:"dddd [don lɛrɛ] LT",lastDay:"[Kunu lɛrɛ] LT",lastWeek:"dddd [tɛmɛnen lɛrɛ] LT",sameElse:"L"},relativeTime:{future:"%s kɔnɔ",past:"a bɛ %s bɔ",s:"sanga dama dama",ss:"sekondi %d",m:"miniti kelen",mm:"miniti %d",h:"lɛrɛ kelen",hh:"lɛrɛ %d",d:"tile kelen",dd:"tile %d",M:"kalo kelen",MM:"kalo %d",y:"san kelen",yy:"san %d"},week:{dow:1,doy:4}})}(a(43936))},52552:function(e,t,a){!function(e){"use strict";var t={1:"১",2:"২",3:"৩",4:"৪",5:"৫",6:"৬",7:"৭",8:"৮",9:"৯",0:"০"},a={"১":"1","২":"2","৩":"3","৪":"4","৫":"5","৬":"6","৭":"7","৮":"8","৯":"9","০":"0"};e.defineLocale("bn-bd",{months:"জানুয়ারি_ফেব্রুয়ারি_মার্চ_এপ্রিল_মে_জুন_জুলাই_আগস্ট_সেপ্টেম্বর_অক্টোবর_নভেম্বর_ডিসেম্বর".split("_"),monthsShort:"জানু_ফেব্রু_মার্চ_এপ্রিল_মে_জুন_জুলাই_আগস্ট_সেপ্ট_অক্টো_নভে_ডিসে".split("_"),weekdays:"রবিবার_সোমবার_মঙ্গলবার_বুধবার_বৃহস্পতিবার_শুক্রবার_শনিবার".split("_"),weekdaysShort:"রবি_সোম_মঙ্গল_বুধ_বৃহস্পতি_শুক্র_শনি".split("_"),weekdaysMin:"রবি_সোম_মঙ্গল_বুধ_বৃহ_শুক্র_শনি".split("_"),longDateFormat:{LT:"A h:mm সময়",LTS:"A h:mm:ss সময়",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm সময়",LLLL:"dddd, D MMMM YYYY, A h:mm সময়"},calendar:{sameDay:"[আজ] LT",nextDay:"[আগামীকাল] LT",nextWeek:"dddd, LT",lastDay:"[গতকাল] LT",lastWeek:"[গত] dddd, LT",sameElse:"L"},relativeTime:{future:"%s পরে",past:"%s আগে",s:"কয়েক সেকেন্ড",ss:"%d সেকেন্ড",m:"এক মিনিট",mm:"%d মিনিট",h:"এক ঘন্টা",hh:"%d ঘন্টা",d:"এক দিন",dd:"%d দিন",M:"এক মাস",MM:"%d মাস",y:"এক বছর",yy:"%d বছর"},preparse:function(e){return e.replace(/[১২৩৪৫৬৭৮৯০]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/রাত|ভোর|সকাল|দুপুর|বিকাল|সন্ধ্যা|রাত/,meridiemHour:function(e,t){return 12===e&&(e=0),"রাত"===t?e<4?e:e+12:"ভোর"===t||"সকাল"===t?e:"দুপুর"===t?e>=3?e:e+12:"বিকাল"===t||"সন্ধ্যা"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"রাত":e<6?"ভোর":e<12?"সকাল":e<15?"দুপুর":e<18?"বিকাল":e<20?"সন্ধ্যা":"রাত"},week:{dow:0,doy:6}})}(a(43936))},12104:function(e,t,a){!function(e){"use strict";var t={1:"১",2:"২",3:"৩",4:"৪",5:"৫",6:"৬",7:"৭",8:"৮",9:"৯",0:"০"},a={"১":"1","২":"2","৩":"3","৪":"4","৫":"5","৬":"6","৭":"7","৮":"8","৯":"9","০":"0"};e.defineLocale("bn",{months:"জানুয়ারি_ফেব্রুয়ারি_মার্চ_এপ্রিল_মে_জুন_জুলাই_আগস্ট_সেপ্টেম্বর_অক্টোবর_নভেম্বর_ডিসেম্বর".split("_"),monthsShort:"জানু_ফেব্রু_মার্চ_এপ্রিল_মে_জুন_জুলাই_আগস্ট_সেপ্ট_অক্টো_নভে_ডিসে".split("_"),weekdays:"রবিবার_সোমবার_মঙ্গলবার_বুধবার_বৃহস্পতিবার_শুক্রবার_শনিবার".split("_"),weekdaysShort:"রবি_সোম_মঙ্গল_বুধ_বৃহস্পতি_শুক্র_শনি".split("_"),weekdaysMin:"রবি_সোম_মঙ্গল_বুধ_বৃহ_শুক্র_শনি".split("_"),longDateFormat:{LT:"A h:mm সময়",LTS:"A h:mm:ss সময়",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm সময়",LLLL:"dddd, D MMMM YYYY, A h:mm সময়"},calendar:{sameDay:"[আজ] LT",nextDay:"[আগামীকাল] LT",nextWeek:"dddd, LT",lastDay:"[গতকাল] LT",lastWeek:"[গত] dddd, LT",sameElse:"L"},relativeTime:{future:"%s পরে",past:"%s আগে",s:"কয়েক সেকেন্ড",ss:"%d সেকেন্ড",m:"এক মিনিট",mm:"%d মিনিট",h:"এক ঘন্টা",hh:"%d ঘন্টা",d:"এক দিন",dd:"%d দিন",M:"এক মাস",MM:"%d মাস",y:"এক বছর",yy:"%d বছর"},preparse:function(e){return e.replace(/[১২৩৪৫৬৭৮৯০]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/রাত|সকাল|দুপুর|বিকাল|রাত/,meridiemHour:function(e,t){return 12===e&&(e=0),"রাত"===t&&e>=4||"দুপুর"===t&&e<5||"বিকাল"===t?e+12:e},meridiem:function(e,t,a){return e<4?"রাত":e<10?"সকাল":e<17?"দুপুর":e<20?"বিকাল":"রাত"},week:{dow:0,doy:6}})}(a(43936))},1972:function(e,t,a){!function(e){"use strict";var t={1:"༡",2:"༢",3:"༣",4:"༤",5:"༥",6:"༦",7:"༧",8:"༨",9:"༩",0:"༠"},a={"༡":"1","༢":"2","༣":"3","༤":"4","༥":"5","༦":"6","༧":"7","༨":"8","༩":"9","༠":"0"};e.defineLocale("bo",{months:"ཟླ་བ་དང་པོ_ཟླ་བ་གཉིས་པ_ཟླ་བ་གསུམ་པ_ཟླ་བ་བཞི་པ_ཟླ་བ་ལྔ་པ_ཟླ་བ་དྲུག་པ_ཟླ་བ་བདུན་པ_ཟླ་བ་བརྒྱད་པ_ཟླ་བ་དགུ་པ_ཟླ་བ་བཅུ་པ_ཟླ་བ་བཅུ་གཅིག་པ_ཟླ་བ་བཅུ་གཉིས་པ".split("_"),monthsShort:"ཟླ་1_ཟླ་2_ཟླ་3_ཟླ་4_ཟླ་5_ཟླ་6_ཟླ་7_ཟླ་8_ཟླ་9_ཟླ་10_ཟླ་11_ཟླ་12".split("_"),monthsShortRegex:/^(ཟླ་\d{1,2})/,monthsParseExact:!0,weekdays:"གཟའ་ཉི་མ་_གཟའ་ཟླ་བ་_གཟའ་མིག་དམར་_གཟའ་ལྷག་པ་_གཟའ་ཕུར་བུ_གཟའ་པ་སངས་_གཟའ་སྤེན་པ་".split("_"),weekdaysShort:"ཉི་མ་_ཟླ་བ་_མིག་དམར་_ལྷག་པ་_ཕུར་བུ_པ་སངས་_སྤེན་པ་".split("_"),weekdaysMin:"ཉི_ཟླ_མིག_ལྷག_ཕུར_སངས_སྤེན".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[དི་རིང] LT",nextDay:"[སང་ཉིན] LT",nextWeek:"[བདུན་ཕྲག་རྗེས་མ], LT",lastDay:"[ཁ་སང] LT",lastWeek:"[བདུན་ཕྲག་མཐའ་མ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ལ་",past:"%s སྔན་ལ",s:"ལམ་སང",ss:"%d སྐར་ཆ།",m:"སྐར་མ་གཅིག",mm:"%d སྐར་མ",h:"ཆུ་ཚོད་གཅིག",hh:"%d ཆུ་ཚོད",d:"ཉིན་གཅིག",dd:"%d ཉིན་",M:"ཟླ་བ་གཅིག",MM:"%d ཟླ་བ",y:"ལོ་གཅིག",yy:"%d ལོ"},preparse:function(e){return e.replace(/[༡༢༣༤༥༦༧༨༩༠]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/མཚན་མོ|ཞོགས་ཀས|ཉིན་གུང|དགོང་དག|མཚན་མོ/,meridiemHour:function(e,t){return 12===e&&(e=0),"མཚན་མོ"===t&&e>=4||"ཉིན་གུང"===t&&e<5||"དགོང་དག"===t?e+12:e},meridiem:function(e,t,a){return e<4?"མཚན་མོ":e<10?"ཞོགས་ཀས":e<17?"ཉིན་གུང":e<20?"དགོང་དག":"མཚན་མོ"},week:{dow:0,doy:6}})}(a(43936))},90744:function(e,t,a){!function(e){"use strict";function t(e,t,a){return e+" "+s({mm:"munutenn",MM:"miz",dd:"devezh"}[a],e)}function a(e){switch(i(e)){case 1:case 3:case 4:case 5:case 9:return e+" bloaz";default:return e+" vloaz"}}function i(e){return e>9?i(e%10):e}function s(e,t){return 2===t?r(e):e}function r(e){var t={m:"v",b:"v",d:"z"};return void 0===t[e.charAt(0)]?e:t[e.charAt(0)]+e.substring(1)}var l=[/^gen/i,/^c[ʼ\']hwe/i,/^meu/i,/^ebr/i,/^mae/i,/^(mez|eve)/i,/^gou/i,/^eos/i,/^gwe/i,/^her/i,/^du/i,/^ker/i],c=/^(genver|c[ʼ\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu|gen|c[ʼ\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,d=/^(genver|c[ʼ\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu)/i,u=/^(gen|c[ʼ\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,p=[/^sul/i,/^lun/i,/^meurzh/i,/^merc[ʼ\']her/i,/^yaou/i,/^gwener/i,/^sadorn/i],m=[/^Sul/i,/^Lun/i,/^Meu/i,/^Mer/i,/^Yao/i,/^Gwe/i,/^Sad/i],_=[/^Su/i,/^Lu/i,/^Me([^r]|$)/i,/^Mer/i,/^Ya/i,/^Gw/i,/^Sa/i];e.defineLocale("br",{months:"Genver_Cʼhwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_Cʼhwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Mercʼher_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),weekdaysParse:_,fullWeekdaysParse:p,shortWeekdaysParse:m,minWeekdaysParse:_,monthsRegex:c,monthsShortRegex:c,monthsStrictRegex:d,monthsShortStrictRegex:u,monthsParse:l,longMonthsParse:l,shortMonthsParse:l,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY HH:mm",LLLL:"dddd, D [a viz] MMMM YYYY HH:mm"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warcʼhoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Decʼh da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s ʼzo",s:"un nebeud segondennoù",ss:"%d eilenn",m:"ur vunutenn",mm:t,h:"un eur",hh:"%d eur",d:"un devezh",dd:t,M:"ur miz",MM:t,y:"ur bloaz",yy:a},dayOfMonthOrdinalParse:/\d{1,2}(añ|vet)/,ordinal:function(e){return e+(1===e?"añ":"vet")},week:{dow:1,doy:4},meridiemParse:/a.m.|g.m./,isPM:function(e){return"g.m."===e},meridiem:function(e,t,a){return e<12?"a.m.":"g.m."}})}(a(43936))},23928:function(e,t,a){!function(e){"use strict";function t(e,t,a){var i=e+" ";switch(a){case"ss":return i+=1===e?"sekunda":2===e||3===e||4===e?"sekunde":"sekundi";case"m":return t?"jedna minuta":"jedne minute";case"mm":return i+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return i+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return i+=1===e?"dan":"dana";case"MM":return i+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return i+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}e.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_četvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._čet._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_če_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jučer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prošlu] dddd [u] LT";case 6:return"[prošle] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[prošli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:t,m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},29780:function(e,t,a){!function(e){"use strict";e.defineLocale("ca",{months:{standalone:"gener_febrer_març_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),format:"de gener_de febrer_de març_d'abril_de maig_de juny_de juliol_d'agost_de setembre_d'octubre_de novembre_de desembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._març_abr._maig_juny_jul._ag._set._oct._nov._des.".split("_"),monthsParseExact:!0,weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dt_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a les] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a les] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[demà a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"d'aquí %s",past:"fa %s",s:"uns segons",ss:"%d segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t|è|a)/,ordinal:function(e,t){var a=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"è";return"w"!==t&&"W"!==t||(a="a"),e+a},week:{dow:1,doy:4}})}(a(43936))},40112:function(e,t,a){!function(e){"use strict";var t={format:"leden_únor_březen_duben_květen_červen_červenec_srpen_září_říjen_listopad_prosinec".split("_"),standalone:"ledna_února_března_dubna_května_června_července_srpna_září_října_listopadu_prosince".split("_")},a="led_úno_bře_dub_kvě_čvn_čvc_srp_zář_říj_lis_pro".split("_"),i=[/^led/i,/^úno/i,/^bře/i,/^dub/i,/^kvě/i,/^(čvn|červen$|června)/i,/^(čvc|červenec|července)/i,/^srp/i,/^zář/i,/^říj/i,/^lis/i,/^pro/i],s=/^(leden|únor|březen|duben|květen|červenec|července|červen|června|srpen|září|říjen|listopad|prosinec|led|úno|bře|dub|kvě|čvn|čvc|srp|zář|říj|lis|pro)/i;function r(e){return e>1&&e<5&&1!=~~(e/10)}function l(e,t,a,i){var s=e+" ";switch(a){case"s":return t||i?"pár sekund":"pár sekundami";case"ss":return t||i?s+(r(e)?"sekundy":"sekund"):s+"sekundami";case"m":return t?"minuta":i?"minutu":"minutou";case"mm":return t||i?s+(r(e)?"minuty":"minut"):s+"minutami";case"h":return t?"hodina":i?"hodinu":"hodinou";case"hh":return t||i?s+(r(e)?"hodiny":"hodin"):s+"hodinami";case"d":return t||i?"den":"dnem";case"dd":return t||i?s+(r(e)?"dny":"dní"):s+"dny";case"M":return t||i?"měsíc":"měsícem";case"MM":return t||i?s+(r(e)?"měsíce":"měsíců"):s+"měsíci";case"y":return t||i?"rok":"rokem";case"yy":return t||i?s+(r(e)?"roky":"let"):s+"lety"}}e.defineLocale("cs",{months:t,monthsShort:a,monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(leden|ledna|února|únor|březen|března|duben|dubna|květen|května|červenec|července|červen|června|srpen|srpna|září|říjen|října|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|úno|bře|dub|kvě|čvn|čvc|srp|zář|říj|lis|pro)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"neděle_pondělí_úterý_středa_čtvrtek_pátek_sobota".split("_"),weekdaysShort:"ne_po_út_st_čt_pá_so".split("_"),weekdaysMin:"ne_po_út_st_čt_pá_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[zítra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v neděli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve středu v] LT";case 4:return"[ve čtvrtek v] LT";case 5:return"[v pátek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[včera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou neděli v] LT";case 1:case 2:return"[minulé] dddd [v] LT";case 3:return"[minulou středu v] LT";case 4:case 5:return"[minulý] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"před %s",s:l,ss:l,m:l,mm:l,h:l,hh:l,d:l,dd:l,M:l,MM:l,y:l,yy:l},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},92808:function(e,t,a){!function(e){"use strict";e.defineLocale("cv",{months:"кӑрлач_нарӑс_пуш_ака_май_ҫӗртме_утӑ_ҫурла_авӑн_юпа_чӳк_раштав".split("_"),monthsShort:"кӑр_нар_пуш_ака_май_ҫӗр_утӑ_ҫур_авн_юпа_чӳк_раш".split("_"),weekdays:"вырсарникун_тунтикун_ытларикун_юнкун_кӗҫнерникун_эрнекун_шӑматкун".split("_"),weekdaysShort:"выр_тун_ытл_юн_кӗҫ_эрн_шӑм".split("_"),weekdaysMin:"вр_тн_ыт_юн_кҫ_эр_шм".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"YYYY [ҫулхи] MMMM [уйӑхӗн] D[-мӗшӗ]",LLL:"YYYY [ҫулхи] MMMM [уйӑхӗн] D[-мӗшӗ], HH:mm",LLLL:"dddd, YYYY [ҫулхи] MMMM [уйӑхӗн] D[-мӗшӗ], HH:mm"},calendar:{sameDay:"[Паян] LT [сехетре]",nextDay:"[Ыран] LT [сехетре]",lastDay:"[Ӗнер] LT [сехетре]",nextWeek:"[Ҫитес] dddd LT [сехетре]",lastWeek:"[Иртнӗ] dddd LT [сехетре]",sameElse:"L"},relativeTime:{future:function(e){return e+(/сехет$/i.exec(e)?"рен":/ҫул$/i.exec(e)?"тан":"ран")},past:"%s каялла",s:"пӗр-ик ҫеккунт",ss:"%d ҫеккунт",m:"пӗр минут",mm:"%d минут",h:"пӗр сехет",hh:"%d сехет",d:"пӗр кун",dd:"%d кун",M:"пӗр уйӑх",MM:"%d уйӑх",y:"пӗр ҫул",yy:"%d ҫул"},dayOfMonthOrdinalParse:/\d{1,2}-мӗш/,ordinal:"%d-мӗш",week:{dow:1,doy:7}})}(a(43936))},19824:function(e,t,a){!function(e){"use strict";e.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn ôl",s:"ychydig eiliadau",ss:"%d eiliad",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},dayOfMonthOrdinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(e){var t="";return e>20?t=40===e||50===e||60===e||80===e||100===e?"fed":"ain":e>0&&(t=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"][e]),e+t},week:{dow:1,doy:4}})}(a(43936))},52780:function(e,t,a){!function(e){"use strict";e.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"søndag_mandag_tirsdag_onsdag_torsdag_fredag_lørdag".split("_"),weekdaysShort:"søn_man_tir_ons_tor_fre_lør".split("_"),weekdaysMin:"sø_ma_ti_on_to_fr_lø".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"på dddd [kl.] LT",lastDay:"[i går kl.] LT",lastWeek:"[i] dddd[s kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"få sekunder",ss:"%d sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en måned",MM:"%d måneder",y:"et år",yy:"%d år"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},72320:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?s[a][0]:s[a][1]}e.defineLocale("de-at",{months:"Jänner_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jän._Feb._März_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},25835:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?s[a][0]:s[a][1]}e.defineLocale("de-ch",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._März_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},17380:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?s[a][0]:s[a][1]}e.defineLocale("de",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._März_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},71876:function(e,t,a){!function(e){"use strict";var t=["ޖެނުއަރީ","ފެބްރުއަރީ","މާރިޗު","އޭޕްރީލު","މޭ","ޖޫން","ޖުލައި","އޯގަސްޓު","ސެޕްޓެމްބަރު","އޮކްޓޯބަރު","ނޮވެމްބަރު","ޑިސެމްބަރު"],a=["އާދިއްތަ","ހޯމަ","އަންގާރަ","ބުދަ","ބުރާސްފަތި","ހުކުރު","ހޮނިހިރު"];e.defineLocale("dv",{months:t,monthsShort:t,weekdays:a,weekdaysShort:a,weekdaysMin:"އާދި_ހޯމަ_އަން_ބުދަ_ބުރާ_ހުކު_ހޮނި".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/މކ|މފ/,isPM:function(e){return"މފ"===e},meridiem:function(e,t,a){return e<12?"މކ":"މފ"},calendar:{sameDay:"[މިއަދު] LT",nextDay:"[މާދަމާ] LT",nextWeek:"dddd LT",lastDay:"[އިއްޔެ] LT",lastWeek:"[ފާއިތުވި] dddd LT",sameElse:"L"},relativeTime:{future:"ތެރޭގައި %s",past:"ކުރިން %s",s:"ސިކުންތުކޮޅެއް",ss:"d% ސިކުންތު",m:"މިނިޓެއް",mm:"މިނިޓު %d",h:"ގަޑިއިރެއް",hh:"ގަޑިއިރު %d",d:"ދުވަހެއް",dd:"ދުވަސް %d",M:"މަހެއް",MM:"މަސް %d",y:"އަހަރެއް",yy:"އަހަރު %d"},preparse:function(e){return e.replace(/،/g,",")},postformat:function(e){return e.replace(/,/g,"،")},week:{dow:7,doy:12}})}(a(43936))},13996:function(e,t,a){!function(e){"use strict";function t(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}e.defineLocale("el",{monthsNominativeEl:"Ιανουάριος_Φεβρουάριος_Μάρτιος_Απρίλιος_Μάιος_Ιούνιος_Ιούλιος_Αύγουστος_Σεπτέμβριος_Οκτώβριος_Νοέμβριος_Δεκέμβριος".split("_"),monthsGenitiveEl:"Ιανουαρίου_Φεβρουαρίου_Μαρτίου_Απριλίου_Μαΐου_Ιουνίου_Ιουλίου_Αυγούστου_Σεπτεμβρίου_Οκτωβρίου_Νοεμβρίου_Δεκεμβρίου".split("_"),months:function(e,t){return e?"string"==typeof t&&/D/.test(t.substring(0,t.indexOf("MMMM")))?this._monthsGenitiveEl[e.month()]:this._monthsNominativeEl[e.month()]:this._monthsNominativeEl},monthsShort:"Ιαν_Φεβ_Μαρ_Απρ_Μαϊ_Ιουν_Ιουλ_Αυγ_Σεπ_Οκτ_Νοε_Δεκ".split("_"),weekdays:"Κυριακή_Δευτέρα_Τρίτη_Τετάρτη_Πέμπτη_Παρασκευή_Σάββατο".split("_"),weekdaysShort:"Κυρ_Δευ_Τρι_Τετ_Πεμ_Παρ_Σαβ".split("_"),weekdaysMin:"Κυ_Δε_Τρ_Τε_Πε_Πα_Σα".split("_"),meridiem:function(e,t,a){return e>11?a?"μμ":"ΜΜ":a?"πμ":"ΠΜ"},isPM:function(e){return"μ"===(e+"").toLowerCase()[0]},meridiemParse:/[ΠΜ]\.?Μ?\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendarEl:{sameDay:"[Σήμερα {}] LT",nextDay:"[Αύριο {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[Χθες {}] LT",lastWeek:function(){return 6===this.day()?"[το προηγούμενο] dddd [{}] LT":"[την προηγούμενη] dddd [{}] LT"},sameElse:"L"},calendar:function(e,a){var i=this._calendarEl[e],s=a&&a.hours();return t(i)&&(i=i.apply(a)),i.replace("{}",s%12==1?"στη":"στις")},relativeTime:{future:"σε %s",past:"%s πριν",s:"λίγα δευτερόλεπτα",ss:"%d δευτερόλεπτα",m:"ένα λεπτό",mm:"%d λεπτά",h:"μία ώρα",hh:"%d ώρες",d:"μία μέρα",dd:"%d μέρες",M:"ένας μήνας",MM:"%d μήνες",y:"ένας χρόνος",yy:"%d χρόνια"},dayOfMonthOrdinalParse:/\d{1,2}η/,ordinal:"%dη",week:{dow:1,doy:4}})}(a(43936))},66584:function(e,t,a){!function(e){"use strict";e.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:0,doy:4}})}(a(43936))},28272:function(e,t,a){!function(e){"use strict";e.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(a(43936))},53424:function(e,t,a){!function(e){"use strict";e.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(a(43936))},36256:function(e,t,a){!function(e){"use strict";e.defineLocale("en-ie",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(a(43936))},79088:function(e,t,a){!function(e){"use strict";e.defineLocale("en-il",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(a(43936))},98792:function(e,t,a){!function(e){"use strict";e.defineLocale("en-in",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:0,doy:6}})}(a(43936))},51208:function(e,t,a){!function(e){"use strict";e.defineLocale("en-nz",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(a(43936))},72576:function(e,t,a){!function(e){"use strict";e.defineLocale("en-sg",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(a(43936))},83e3:function(e,t,a){!function(e){"use strict";e.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_aŭgusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mart_apr_maj_jun_jul_aŭg_sept_okt_nov_dec".split("_"),weekdays:"dimanĉo_lundo_mardo_merkredo_ĵaŭdo_vendredo_sabato".split("_"),weekdaysShort:"dim_lun_mard_merk_ĵaŭ_ven_sab".split("_"),weekdaysMin:"di_lu_ma_me_ĵa_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"[la] D[-an de] MMMM, YYYY",LLL:"[la] D[-an de] MMMM, YYYY HH:mm",LLLL:"dddd[n], [la] D[-an de] MMMM, YYYY HH:mm",llll:"ddd, [la] D[-an de] MMM, YYYY HH:mm"},meridiemParse:/[ap]\.t\.m/i,isPM:function(e){return"p"===e.charAt(0).toLowerCase()},meridiem:function(e,t,a){return e>11?a?"p.t.m.":"P.T.M.":a?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodiaŭ je] LT",nextDay:"[Morgaŭ je] LT",nextWeek:"dddd[n je] LT",lastDay:"[Hieraŭ je] LT",lastWeek:"[pasintan] dddd[n je] LT",sameElse:"L"},relativeTime:{future:"post %s",past:"antaŭ %s",s:"kelkaj sekundoj",ss:"%d sekundoj",m:"unu minuto",mm:"%d minutoj",h:"unu horo",hh:"%d horoj",d:"unu tago",dd:"%d tagoj",M:"unu monato",MM:"%d monatoj",y:"unu jaro",yy:"%d jaroj"},dayOfMonthOrdinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})}(a(43936))},5640:function(e,t,a){!function(e){"use strict";var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),a="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),i=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],s=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-do",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},77844:function(e,t,a){!function(e){"use strict";var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),a="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),i=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],s=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-mx",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:0,doy:4},invalidDate:"Fecha inválida"})}(a(43936))},77932:function(e,t,a){!function(e){"use strict";var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),a="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),i=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],s=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-us",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:0,doy:6}})}(a(43936))},19676:function(e,t,a){!function(e){"use strict";var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),a="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),i=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],s=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4},invalidDate:"Fecha inválida"})}(a(43936))},12692:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={s:["mõne sekundi","mõni sekund","paar sekundit"],ss:[e+"sekundi",e+"sekundit"],m:["ühe minuti","üks minut"],mm:[e+" minuti",e+" minutit"],h:["ühe tunni","tund aega","üks tund"],hh:[e+" tunni",e+" tundi"],d:["ühe päeva","üks päev"],M:["kuu aja","kuu aega","üks kuu"],MM:[e+" kuu",e+" kuud"],y:["ühe aasta","aasta","üks aasta"],yy:[e+" aasta",e+" aastat"]};return t?s[a][2]?s[a][2]:s[a][1]:i?s[a][0]:s[a][1]}e.defineLocale("et",{months:"jaanuar_veebruar_märts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_märts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"pühapäev_esmaspäev_teisipäev_kolmapäev_neljapäev_reede_laupäev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[Täna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Järgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s pärast",past:"%s tagasi",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:"%d päeva",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},83344:function(e,t,a){!function(e){"use strict";e.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),monthsParseExact:!0,weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] HH:mm",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] HH:mm",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] HH:mm",llll:"ddd, YYYY[ko] MMM D[a] HH:mm"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",ss:"%d segundo",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},17828:function(e,t,a){!function(e){"use strict";var t={1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹",0:"۰"},a={"۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","۰":"0"};e.defineLocale("fa",{months:"ژانویه_فوریه_مارس_آوریل_مه_ژوئن_ژوئیه_اوت_سپتامبر_اکتبر_نوامبر_دسامبر".split("_"),monthsShort:"ژانویه_فوریه_مارس_آوریل_مه_ژوئن_ژوئیه_اوت_سپتامبر_اکتبر_نوامبر_دسامبر".split("_"),weekdays:"یک‌شنبه_دوشنبه_سه‌شنبه_چهارشنبه_پنج‌شنبه_جمعه_شنبه".split("_"),weekdaysShort:"یک‌شنبه_دوشنبه_سه‌شنبه_چهارشنبه_پنج‌شنبه_جمعه_شنبه".split("_"),weekdaysMin:"ی_د_س_چ_پ_ج_ش".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/قبل از ظهر|بعد از ظهر/,isPM:function(e){return/بعد از ظهر/.test(e)},meridiem:function(e,t,a){return e<12?"قبل از ظهر":"بعد از ظهر"},calendar:{sameDay:"[امروز ساعت] LT",nextDay:"[فردا ساعت] LT",nextWeek:"dddd [ساعت] LT",lastDay:"[دیروز ساعت] LT",lastWeek:"dddd [پیش] [ساعت] LT",sameElse:"L"},relativeTime:{future:"در %s",past:"%s پیش",s:"چند ثانیه",ss:"%d ثانیه",m:"یک دقیقه",mm:"%d دقیقه",h:"یک ساعت",hh:"%d ساعت",d:"یک روز",dd:"%d روز",M:"یک ماه",MM:"%d ماه",y:"یک سال",yy:"%d سال"},preparse:function(e){return e.replace(/[۰-۹]/g,(function(e){return a[e]})).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"،")},dayOfMonthOrdinalParse:/\d{1,2}م/,ordinal:"%dم",week:{dow:6,doy:12}})}(a(43936))},11e3:function(e,t,a){!function(e){"use strict";var t="nolla yksi kaksi kolme neljä viisi kuusi seitsemän kahdeksan yhdeksän".split(" "),a=["nolla","yhden","kahden","kolmen","neljän","viiden","kuuden",t[7],t[8],t[9]];function i(e,t,a,i){var r="";switch(a){case"s":return i?"muutaman sekunnin":"muutama sekunti";case"ss":r=i?"sekunnin":"sekuntia";break;case"m":return i?"minuutin":"minuutti";case"mm":r=i?"minuutin":"minuuttia";break;case"h":return i?"tunnin":"tunti";case"hh":r=i?"tunnin":"tuntia";break;case"d":return i?"päivän":"päivä";case"dd":r=i?"päivän":"päivää";break;case"M":return i?"kuukauden":"kuukausi";case"MM":r=i?"kuukauden":"kuukautta";break;case"y":return i?"vuoden":"vuosi";case"yy":r=i?"vuoden":"vuotta"}return r=s(e,i)+" "+r}function s(e,i){return e<10?i?a[e]:t[e]:e}e.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_kesäkuu_heinäkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kesä_heinä_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] HH.mm",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] HH.mm",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] HH.mm",llll:"ddd, Do MMM YYYY, [klo] HH.mm"},calendar:{sameDay:"[tänään] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s päästä",past:"%s sitten",s:i,ss:i,m:i,mm:i,h:i,hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},65600:function(e,t,a){!function(e){"use strict";e.defineLocale("fil",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(a(43936))},75328:function(e,t,a){!function(e){"use strict";e.defineLocale("fo",{months:"januar_februar_mars_apríl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mánadagur_týsdagur_mikudagur_hósdagur_fríggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mán_týs_mik_hós_frí_ley".split("_"),weekdaysMin:"su_má_tý_mi_hó_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D. MMMM, YYYY HH:mm"},calendar:{sameDay:"[Í dag kl.] LT",nextDay:"[Í morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[Í gjár kl.] LT",lastWeek:"[síðstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s síðani",s:"fá sekund",ss:"%d sekundir",m:"ein minuttur",mm:"%d minuttir",h:"ein tími",hh:"%d tímar",d:"ein dagur",dd:"%d dagar",M:"ein mánaður",MM:"%d mánaðir",y:"eitt ár",yy:"%d ár"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},72876:function(e,t,a){!function(e){"use strict";e.defineLocale("fr-ca",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e,t){switch(t){default:case"M":case"Q":case"D":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}}})}(a(43936))},12220:function(e,t,a){!function(e){"use strict";e.defineLocale("fr-ch",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e,t){switch(t){default:case"M":case"Q":case"D":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})}(a(43936))},73940:function(e,t,a){!function(e){"use strict";var t=/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i,a=/(janv\.?|févr\.?|mars|avr\.?|mai|juin|juil\.?|août|sept\.?|oct\.?|nov\.?|déc\.?)/i,i=/(janv\.?|févr\.?|mars|avr\.?|mai|juin|juil\.?|août|sept\.?|oct\.?|nov\.?|déc\.?|janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i,s=[/^janv/i,/^févr/i,/^mars/i,/^avr/i,/^mai/i,/^juin/i,/^juil/i,/^août/i,/^sept/i,/^oct/i,/^nov/i,/^déc/i];e.defineLocale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:t,monthsShortStrictRegex:a,monthsParse:s,longMonthsParse:s,shortMonthsParse:s,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",w:"une semaine",ww:"%d semaines",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(e,t){switch(t){case"D":return e+(1===e?"er":"");default:case"M":case"Q":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})}(a(43936))},58880:function(e,t,a){!function(e){"use strict";var t="jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_"),a="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_");e.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsParseExact:!0,weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[ôfrûne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",ss:"%d sekonden",m:"ien minút",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(a(43936))},39188:function(e,t,a){!function(e){"use strict";var t=["Eanáir","Feabhra","Márta","Aibreán","Bealtaine","Meitheamh","Iúil","Lúnasa","Meán Fómhair","Deireadh Fómhair","Samhain","Nollaig"],a=["Ean","Feabh","Márt","Aib","Beal","Meith","Iúil","Lún","M.F.","D.F.","Samh","Noll"],i=["Dé Domhnaigh","Dé Luain","Dé Máirt","Dé Céadaoin","Déardaoin","Dé hAoine","Dé Sathairn"],s=["Domh","Luan","Máirt","Céad","Déar","Aoine","Sath"],r=["Do","Lu","Má","Cé","Dé","A","Sa"];e.defineLocale("ga",{months:t,monthsShort:a,monthsParseExact:!0,weekdays:i,weekdaysShort:s,weekdaysMin:r,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Inniu ag] LT",nextDay:"[Amárach ag] LT",nextWeek:"dddd [ag] LT",lastDay:"[Inné ag] LT",lastWeek:"dddd [seo caite] [ag] LT",sameElse:"L"},relativeTime:{future:"i %s",past:"%s ó shin",s:"cúpla soicind",ss:"%d soicind",m:"nóiméad",mm:"%d nóiméad",h:"uair an chloig",hh:"%d uair an chloig",d:"lá",dd:"%d lá",M:"mí",MM:"%d míonna",y:"bliain",yy:"%d bliain"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(e){return e+(1===e?"d":e%10==2?"na":"mh")},week:{dow:1,doy:4}})}(a(43936))},1748:function(e,t,a){!function(e){"use strict";var t=["Am Faoilleach","An Gearran","Am Màrt","An Giblean","An Cèitean","An t-Ògmhios","An t-Iuchar","An Lùnastal","An t-Sultain","An Dàmhair","An t-Samhain","An Dùbhlachd"],a=["Faoi","Gear","Màrt","Gibl","Cèit","Ògmh","Iuch","Lùn","Sult","Dàmh","Samh","Dùbh"],i=["Didòmhnaich","Diluain","Dimàirt","Diciadain","Diardaoin","Dihaoine","Disathairne"],s=["Did","Dil","Dim","Dic","Dia","Dih","Dis"],r=["Dò","Lu","Mà","Ci","Ar","Ha","Sa"];e.defineLocale("gd",{months:t,monthsShort:a,monthsParseExact:!0,weekdays:i,weekdaysShort:s,weekdaysMin:r,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[An-diugh aig] LT",nextDay:"[A-màireach aig] LT",nextWeek:"dddd [aig] LT",lastDay:"[An-dè aig] LT",lastWeek:"dddd [seo chaidh] [aig] LT",sameElse:"L"},relativeTime:{future:"ann an %s",past:"bho chionn %s",s:"beagan diogan",ss:"%d diogan",m:"mionaid",mm:"%d mionaidean",h:"uair",hh:"%d uairean",d:"latha",dd:"%d latha",M:"mìos",MM:"%d mìosan",y:"bliadhna",yy:"%d bliadhna"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(e){return e+(1===e?"d":e%10==2?"na":"mh")},week:{dow:1,doy:4}})}(a(43936))},35112:function(e,t,a){!function(e){"use strict";e.defineLocale("gl",{months:"xaneiro_febreiro_marzo_abril_maio_xuño_xullo_agosto_setembro_outubro_novembro_decembro".split("_"),monthsShort:"xan._feb._mar._abr._mai._xuñ._xul._ago._set._out._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"domingo_luns_martes_mércores_xoves_venres_sábado".split("_"),weekdaysShort:"dom._lun._mar._mér._xov._ven._sáb.".split("_"),weekdaysMin:"do_lu_ma_mé_xo_ve_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"ás":"á")+"] LT"},nextDay:function(){return"[mañá "+(1!==this.hours()?"ás":"á")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"ás":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"á":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"ás":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(e){return 0===e.indexOf("un")?"n"+e:"en "+e},past:"hai %s",s:"uns segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},80352:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={s:["थोडया सॅकंडांनी","थोडे सॅकंड"],ss:[e+" सॅकंडांनी",e+" सॅकंड"],m:["एका मिणटान","एक मिनूट"],mm:[e+" मिणटांनी",e+" मिणटां"],h:["एका वरान","एक वर"],hh:[e+" वरांनी",e+" वरां"],d:["एका दिसान","एक दीस"],dd:[e+" दिसांनी",e+" दीस"],M:["एका म्हयन्यान","एक म्हयनो"],MM:[e+" म्हयन्यानी",e+" म्हयने"],y:["एका वर्सान","एक वर्स"],yy:[e+" वर्सांनी",e+" वर्सां"]};return i?s[a][0]:s[a][1]}e.defineLocale("gom-deva",{months:{standalone:"जानेवारी_फेब्रुवारी_मार्च_एप्रील_मे_जून_जुलय_ऑगस्ट_सप्टेंबर_ऑक्टोबर_नोव्हेंबर_डिसेंबर".split("_"),format:"जानेवारीच्या_फेब्रुवारीच्या_मार्चाच्या_एप्रीलाच्या_मेयाच्या_जूनाच्या_जुलयाच्या_ऑगस्टाच्या_सप्टेंबराच्या_ऑक्टोबराच्या_नोव्हेंबराच्या_डिसेंबराच्या".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"जाने._फेब्रु._मार्च_एप्री._मे_जून_जुल._ऑग._सप्टें._ऑक्टो._नोव्हें._डिसें.".split("_"),monthsParseExact:!0,weekdays:"आयतार_सोमार_मंगळार_बुधवार_बिरेस्तार_सुक्रार_शेनवार".split("_"),weekdaysShort:"आयत._सोम._मंगळ._बुध._ब्रेस्त._सुक्र._शेन.".split("_"),weekdaysMin:"आ_सो_मं_बु_ब्रे_सु_शे".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [वाजतां]",LTS:"A h:mm:ss [वाजतां]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [वाजतां]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [वाजतां]",llll:"ddd, D MMM YYYY, A h:mm [वाजतां]"},calendar:{sameDay:"[आयज] LT",nextDay:"[फाल्यां] LT",nextWeek:"[फुडलो] dddd[,] LT",lastDay:"[काल] LT",lastWeek:"[फाटलो] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s आदीं",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}(वेर)/,ordinal:function(e,t){return"D"===t?e+"वेर":e},week:{dow:0,doy:3},meridiemParse:/राती|सकाळीं|दनपारां|सांजे/,meridiemHour:function(e,t){return 12===e&&(e=0),"राती"===t?e<4?e:e+12:"सकाळीं"===t?e:"दनपारां"===t?e>12?e:e+12:"सांजे"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"राती":e<12?"सकाळीं":e<16?"दनपारां":e<20?"सांजे":"राती"}})}(a(43936))},86051:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={s:["thoddea sekondamni","thodde sekond"],ss:[e+" sekondamni",e+" sekond"],m:["eka mintan","ek minut"],mm:[e+" mintamni",e+" mintam"],h:["eka voran","ek vor"],hh:[e+" voramni",e+" voram"],d:["eka disan","ek dis"],dd:[e+" disamni",e+" dis"],M:["eka mhoinean","ek mhoino"],MM:[e+" mhoineamni",e+" mhoine"],y:["eka vorsan","ek voros"],yy:[e+" vorsamni",e+" vorsam"]};return i?s[a][0]:s[a][1]}e.defineLocale("gom-latn",{months:{standalone:"Janer_Febrer_Mars_Abril_Mai_Jun_Julai_Agost_Setembr_Otubr_Novembr_Dezembr".split("_"),format:"Janerachea_Febrerachea_Marsachea_Abrilachea_Maiachea_Junachea_Julaiachea_Agostachea_Setembrachea_Otubrachea_Novembrachea_Dezembrachea".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"Jan._Feb._Mars_Abr._Mai_Jun_Jul._Ago._Set._Otu._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Aitar_Somar_Mongllar_Budhvar_Birestar_Sukrar_Son'var".split("_"),weekdaysShort:"Ait._Som._Mon._Bud._Bre._Suk._Son.".split("_"),weekdaysMin:"Ai_Sm_Mo_Bu_Br_Su_Sn".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [vazta]",LTS:"A h:mm:ss [vazta]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [vazta]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [vazta]",llll:"ddd, D MMM YYYY, A h:mm [vazta]"},calendar:{sameDay:"[Aiz] LT",nextDay:"[Faleam] LT",nextWeek:"[Fuddlo] dddd[,] LT",lastDay:"[Kal] LT",lastWeek:"[Fattlo] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s adim",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}(er)/,ordinal:function(e,t){return"D"===t?e+"er":e},week:{dow:0,doy:3},meridiemParse:/rati|sokallim|donparam|sanje/,meridiemHour:function(e,t){return 12===e&&(e=0),"rati"===t?e<4?e:e+12:"sokallim"===t?e:"donparam"===t?e>12?e:e+12:"sanje"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"rati":e<12?"sokallim":e<16?"donparam":e<20?"sanje":"rati"}})}(a(43936))},60700:function(e,t,a){!function(e){"use strict";var t={1:"૧",2:"૨",3:"૩",4:"૪",5:"૫",6:"૬",7:"૭",8:"૮",9:"૯",0:"૦"},a={"૧":"1","૨":"2","૩":"3","૪":"4","૫":"5","૬":"6","૭":"7","૮":"8","૯":"9","૦":"0"};e.defineLocale("gu",{months:"જાન્યુઆરી_ફેબ્રુઆરી_માર્ચ_એપ્રિલ_મે_જૂન_જુલાઈ_ઑગસ્ટ_સપ્ટેમ્બર_ઑક્ટ્બર_નવેમ્બર_ડિસેમ્બર".split("_"),monthsShort:"જાન્યુ._ફેબ્રુ._માર્ચ_એપ્રિ._મે_જૂન_જુલા._ઑગ._સપ્ટે._ઑક્ટ્._નવે._ડિસે.".split("_"),monthsParseExact:!0,weekdays:"રવિવાર_સોમવાર_મંગળવાર_બુધ્વાર_ગુરુવાર_શુક્રવાર_શનિવાર".split("_"),weekdaysShort:"રવિ_સોમ_મંગળ_બુધ્_ગુરુ_શુક્ર_શનિ".split("_"),weekdaysMin:"ર_સો_મં_બુ_ગુ_શુ_શ".split("_"),longDateFormat:{LT:"A h:mm વાગ્યે",LTS:"A h:mm:ss વાગ્યે",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm વાગ્યે",LLLL:"dddd, D MMMM YYYY, A h:mm વાગ્યે"},calendar:{sameDay:"[આજ] LT",nextDay:"[કાલે] LT",nextWeek:"dddd, LT",lastDay:"[ગઇકાલે] LT",lastWeek:"[પાછલા] dddd, LT",sameElse:"L"},relativeTime:{future:"%s મા",past:"%s પહેલા",s:"અમુક પળો",ss:"%d સેકંડ",m:"એક મિનિટ",mm:"%d મિનિટ",h:"એક કલાક",hh:"%d કલાક",d:"એક દિવસ",dd:"%d દિવસ",M:"એક મહિનો",MM:"%d મહિનો",y:"એક વર્ષ",yy:"%d વર્ષ"},preparse:function(e){return e.replace(/[૧૨૩૪૫૬૭૮૯૦]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/રાત|બપોર|સવાર|સાંજ/,meridiemHour:function(e,t){return 12===e&&(e=0),"રાત"===t?e<4?e:e+12:"સવાર"===t?e:"બપોર"===t?e>=10?e:e+12:"સાંજ"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"રાત":e<10?"સવાર":e<17?"બપોર":e<20?"સાંજ":"રાત"},week:{dow:0,doy:6}})}(a(43936))},79384:function(e,t,a){!function(e){"use strict";e.defineLocale("he",{months:"ינואר_פברואר_מרץ_אפריל_מאי_יוני_יולי_אוגוסט_ספטמבר_אוקטובר_נובמבר_דצמבר".split("_"),monthsShort:"ינו׳_פבר׳_מרץ_אפר׳_מאי_יוני_יולי_אוג׳_ספט׳_אוק׳_נוב׳_דצמ׳".split("_"),weekdays:"ראשון_שני_שלישי_רביעי_חמישי_שישי_שבת".split("_"),weekdaysShort:"א׳_ב׳_ג׳_ד׳_ה׳_ו׳_ש׳".split("_"),weekdaysMin:"א_ב_ג_ד_ה_ו_ש".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [ב]MMMM YYYY",LLL:"D [ב]MMMM YYYY HH:mm",LLLL:"dddd, D [ב]MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[היום ב־]LT",nextDay:"[מחר ב־]LT",nextWeek:"dddd [בשעה] LT",lastDay:"[אתמול ב־]LT",lastWeek:"[ביום] dddd [האחרון בשעה] LT",sameElse:"L"},relativeTime:{future:"בעוד %s",past:"לפני %s",s:"מספר שניות",ss:"%d שניות",m:"דקה",mm:"%d דקות",h:"שעה",hh:function(e){return 2===e?"שעתיים":e+" שעות"},d:"יום",dd:function(e){return 2===e?"יומיים":e+" ימים"},M:"חודש",MM:function(e){return 2===e?"חודשיים":e+" חודשים"},y:"שנה",yy:function(e){return 2===e?"שנתיים":e%10==0&&10!==e?e+" שנה":e+" שנים"}},meridiemParse:/אחה"צ|לפנה"צ|אחרי הצהריים|לפני הצהריים|לפנות בוקר|בבוקר|בערב/i,isPM:function(e){return/^(אחה"צ|אחרי הצהריים|בערב)$/.test(e)},meridiem:function(e,t,a){return e<5?"לפנות בוקר":e<10?"בבוקר":e<12?a?'לפנה"צ':"לפני הצהריים":e<18?a?'אחה"צ':"אחרי הצהריים":"בערב"}})}(a(43936))},87759:function(e,t,a){!function(e){"use strict";var t={1:"१",2:"२",3:"३",4:"४",5:"५",6:"६",7:"७",8:"८",9:"९",0:"०"},a={"१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9","०":"0"},i=[/^जन/i,/^फ़र|फर/i,/^मार्च/i,/^अप्रै/i,/^मई/i,/^जून/i,/^जुल/i,/^अग/i,/^सितं|सित/i,/^अक्टू/i,/^नव|नवं/i,/^दिसं|दिस/i],s=[/^जन/i,/^फ़र/i,/^मार्च/i,/^अप्रै/i,/^मई/i,/^जून/i,/^जुल/i,/^अग/i,/^सित/i,/^अक्टू/i,/^नव/i,/^दिस/i];e.defineLocale("hi",{months:{format:"जनवरी_फ़रवरी_मार्च_अप्रैल_मई_जून_जुलाई_अगस्त_सितम्बर_अक्टूबर_नवम्बर_दिसम्बर".split("_"),standalone:"जनवरी_फरवरी_मार्च_अप्रैल_मई_जून_जुलाई_अगस्त_सितंबर_अक्टूबर_नवंबर_दिसंबर".split("_")},monthsShort:"जन._फ़र._मार्च_अप्रै._मई_जून_जुल._अग._सित._अक्टू._नव._दिस.".split("_"),weekdays:"रविवार_सोमवार_मंगलवार_बुधवार_गुरूवार_शुक्रवार_शनिवार".split("_"),weekdaysShort:"रवि_सोम_मंगल_बुध_गुरू_शुक्र_शनि".split("_"),weekdaysMin:"र_सो_मं_बु_गु_शु_श".split("_"),longDateFormat:{LT:"A h:mm बजे",LTS:"A h:mm:ss बजे",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm बजे",LLLL:"dddd, D MMMM YYYY, A h:mm बजे"},monthsParse:i,longMonthsParse:i,shortMonthsParse:s,monthsRegex:/^(जनवरी|जन\.?|फ़रवरी|फरवरी|फ़र\.?|मार्च?|अप्रैल|अप्रै\.?|मई?|जून?|जुलाई|जुल\.?|अगस्त|अग\.?|सितम्बर|सितंबर|सित\.?|अक्टूबर|अक्टू\.?|नवम्बर|नवंबर|नव\.?|दिसम्बर|दिसंबर|दिस\.?)/i,monthsShortRegex:/^(जनवरी|जन\.?|फ़रवरी|फरवरी|फ़र\.?|मार्च?|अप्रैल|अप्रै\.?|मई?|जून?|जुलाई|जुल\.?|अगस्त|अग\.?|सितम्बर|सितंबर|सित\.?|अक्टूबर|अक्टू\.?|नवम्बर|नवंबर|नव\.?|दिसम्बर|दिसंबर|दिस\.?)/i,monthsStrictRegex:/^(जनवरी?|फ़रवरी|फरवरी?|मार्च?|अप्रैल?|मई?|जून?|जुलाई?|अगस्त?|सितम्बर|सितंबर|सित?\.?|अक्टूबर|अक्टू\.?|नवम्बर|नवंबर?|दिसम्बर|दिसंबर?)/i,monthsShortStrictRegex:/^(जन\.?|फ़र\.?|मार्च?|अप्रै\.?|मई?|जून?|जुल\.?|अग\.?|सित\.?|अक्टू\.?|नव\.?|दिस\.?)/i,calendar:{sameDay:"[आज] LT",nextDay:"[कल] LT",nextWeek:"dddd, LT",lastDay:"[कल] LT",lastWeek:"[पिछले] dddd, LT",sameElse:"L"},relativeTime:{future:"%s में",past:"%s पहले",s:"कुछ ही क्षण",ss:"%d सेकंड",m:"एक मिनट",mm:"%d मिनट",h:"एक घंटा",hh:"%d घंटे",d:"एक दिन",dd:"%d दिन",M:"एक महीने",MM:"%d महीने",y:"एक वर्ष",yy:"%d वर्ष"},preparse:function(e){return e.replace(/[१२३४५६७८९०]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/रात|सुबह|दोपहर|शाम/,meridiemHour:function(e,t){return 12===e&&(e=0),"रात"===t?e<4?e:e+12:"सुबह"===t?e:"दोपहर"===t?e>=10?e:e+12:"शाम"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"रात":e<10?"सुबह":e<17?"दोपहर":e<20?"शाम":"रात"},week:{dow:0,doy:6}})}(a(43936))},74256:function(e,t,a){!function(e){"use strict";function t(e,t,a){var i=e+" ";switch(a){case"ss":return i+=1===e?"sekunda":2===e||3===e||4===e?"sekunde":"sekundi";case"m":return t?"jedna minuta":"jedne minute";case"mm":return i+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return i+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return i+=1===e?"dan":"dana";case"MM":return i+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return i+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}e.defineLocale("hr",{months:{format:"siječnja_veljače_ožujka_travnja_svibnja_lipnja_srpnja_kolovoza_rujna_listopada_studenoga_prosinca".split("_"),standalone:"siječanj_veljača_ožujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_")},monthsShort:"sij._velj._ožu._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_četvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._čet._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_če_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"Do MMMM YYYY",LLL:"Do MMMM YYYY H:mm",LLLL:"dddd, Do MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jučer u] LT",lastWeek:function(){switch(this.day()){case 0:return"[prošlu] [nedjelju] [u] LT";case 3:return"[prošlu] [srijedu] [u] LT";case 6:return"[prošle] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[prošli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:t,m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},61128:function(e,t,a){!function(e){"use strict";var t="vasárnap hétfőn kedden szerdán csütörtökön pénteken szombaton".split(" ");function a(e,t,a,i){var s=e;switch(a){case"s":return i||t?"néhány másodperc":"néhány másodperce";case"ss":return s+(i||t)?" másodperc":" másodperce";case"m":return"egy"+(i||t?" perc":" perce");case"mm":return s+(i||t?" perc":" perce");case"h":return"egy"+(i||t?" óra":" órája");case"hh":return s+(i||t?" óra":" órája");case"d":return"egy"+(i||t?" nap":" napja");case"dd":return s+(i||t?" nap":" napja");case"M":return"egy"+(i||t?" hónap":" hónapja");case"MM":return s+(i||t?" hónap":" hónapja");case"y":return"egy"+(i||t?" év":" éve");case"yy":return s+(i||t?" év":" éve")}return""}function i(e){return(e?"":"[múlt] ")+"["+t[this.day()]+"] LT[-kor]"}e.defineLocale("hu",{months:"január_február_március_április_május_június_július_augusztus_szeptember_október_november_december".split("_"),monthsShort:"jan._feb._márc._ápr._máj._jún._júl._aug._szept._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"vasárnap_hétfő_kedd_szerda_csütörtök_péntek_szombat".split("_"),weekdaysShort:"vas_hét_kedd_sze_csüt_pén_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(e){return"u"===e.charAt(1).toLowerCase()},meridiem:function(e,t,a){return e<12?!0===a?"de":"DE":!0===a?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return i.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return i.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s múlva",past:"%s",s:a,ss:a,m:a,mm:a,h:a,hh:a,d:a,dd:a,M:a,MM:a,y:a,yy:a},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},91120:function(e,t,a){!function(e){"use strict";e.defineLocale("hy-am",{months:{format:"հունվարի_փետրվարի_մարտի_ապրիլի_մայիսի_հունիսի_հուլիսի_օգոստոսի_սեպտեմբերի_հոկտեմբերի_նոյեմբերի_դեկտեմբերի".split("_"),standalone:"հունվար_փետրվար_մարտ_ապրիլ_մայիս_հունիս_հուլիս_օգոստոս_սեպտեմբեր_հոկտեմբեր_նոյեմբեր_դեկտեմբեր".split("_")},monthsShort:"հնվ_փտր_մրտ_ապր_մյս_հնս_հլս_օգս_սպտ_հկտ_նմբ_դկտ".split("_"),weekdays:"կիրակի_երկուշաբթի_երեքշաբթի_չորեքշաբթի_հինգշաբթի_ուրբաթ_շաբաթ".split("_"),weekdaysShort:"կրկ_երկ_երք_չրք_հնգ_ուրբ_շբթ".split("_"),weekdaysMin:"կրկ_երկ_երք_չրք_հնգ_ուրբ_շբթ".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY թ.",LLL:"D MMMM YYYY թ., HH:mm",LLLL:"dddd, D MMMM YYYY թ., HH:mm"},calendar:{sameDay:"[այսօր] LT",nextDay:"[վաղը] LT",lastDay:"[երեկ] LT",nextWeek:function(){return"dddd [օրը ժամը] LT"},lastWeek:function(){return"[անցած] dddd [օրը ժամը] LT"},sameElse:"L"},relativeTime:{future:"%s հետո",past:"%s առաջ",s:"մի քանի վայրկյան",ss:"%d վայրկյան",m:"րոպե",mm:"%d րոպե",h:"ժամ",hh:"%d ժամ",d:"օր",dd:"%d օր",M:"ամիս",MM:"%d ամիս",y:"տարի",yy:"%d տարի"},meridiemParse:/գիշերվա|առավոտվա|ցերեկվա|երեկոյան/,isPM:function(e){return/^(ցերեկվա|երեկոյան)$/.test(e)},meridiem:function(e){return e<4?"գիշերվա":e<12?"առավոտվա":e<17?"ցերեկվա":"երեկոյան"},dayOfMonthOrdinalParse:/\d{1,2}|\d{1,2}-(ին|րդ)/,ordinal:function(e,t){switch(t){case"DDD":case"w":case"W":case"DDDo":return 1===e?e+"-ին":e+"-րդ";default:return e}},week:{dow:1,doy:7}})}(a(43936))},60776:function(e,t,a){!function(e){"use strict";e.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"siang"===t?e>=11?e:e+12:"sore"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,a){return e<11?"pagi":e<15?"siang":e<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",ss:"%d detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:0,doy:6}})}(a(43936))},67956:function(e,t,a){!function(e){"use strict";function t(e){return e%100==11||e%10!=1}function a(e,a,i,s){var r=e+" ";switch(i){case"s":return a||s?"nokkrar sekúndur":"nokkrum sekúndum";case"ss":return t(e)?r+(a||s?"sekúndur":"sekúndum"):r+"sekúnda";case"m":return a?"mínúta":"mínútu";case"mm":return t(e)?r+(a||s?"mínútur":"mínútum"):a?r+"mínúta":r+"mínútu";case"hh":return t(e)?r+(a||s?"klukkustundir":"klukkustundum"):r+"klukkustund";case"d":return a?"dagur":s?"dag":"degi";case"dd":return t(e)?a?r+"dagar":r+(s?"daga":"dögum"):a?r+"dagur":r+(s?"dag":"degi");case"M":return a?"mánuður":s?"mánuð":"mánuði";case"MM":return t(e)?a?r+"mánuðir":r+(s?"mánuði":"mánuðum"):a?r+"mánuður":r+(s?"mánuð":"mánuði");case"y":return a||s?"ár":"ári";case"yy":return t(e)?r+(a||s?"ár":"árum"):r+(a||s?"ár":"ári")}}e.defineLocale("is",{months:"janúar_febrúar_mars_apríl_maí_júní_júlí_ágúst_september_október_nóvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_maí_jún_júl_ágú_sep_okt_nóv_des".split("_"),weekdays:"sunnudagur_mánudagur_þriðjudagur_miðvikudagur_fimmtudagur_föstudagur_laugardagur".split("_"),weekdaysShort:"sun_mán_þri_mið_fim_fös_lau".split("_"),weekdaysMin:"Su_Má_Þr_Mi_Fi_Fö_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd, D. MMMM YYYY [kl.] H:mm"},calendar:{sameDay:"[í dag kl.] LT",nextDay:"[á morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[í gær kl.] LT",lastWeek:"[síðasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s síðan",s:a,ss:a,m:a,mm:a,h:"klukkustund",hh:a,d:a,dd:a,M:a,MM:a,y:a,yy:a},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},39952:function(e,t,a){!function(e){"use strict";e.defineLocale("it-ch",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_lunedì_martedì_mercoledì_giovedì_venerdì_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){return 0===this.day()?"[la scorsa] dddd [alle] LT":"[lo scorso] dddd [alle] LT"},sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},29560:function(e,t,a){!function(e){"use strict";e.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_lunedì_martedì_mercoledì_giovedì_venerdì_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:function(){return"[Oggi a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextDay:function(){return"[Domani a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextWeek:function(){return"dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastDay:function(){return"[Ieri a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastWeek:function(){return 0===this.day()?"[La scorsa] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT":"[Lo scorso] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},sameElse:"L"},relativeTime:{future:"tra %s",past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",w:"una settimana",ww:"%d settimane",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},20232:function(e,t,a){!function(e){"use strict";e.defineLocale("ja",{eras:[{since:"2019-05-01",offset:1,name:"令和",narrow:"㋿",abbr:"R"},{since:"1989-01-08",until:"2019-04-30",offset:1,name:"平成",narrow:"㍻",abbr:"H"},{since:"1926-12-25",until:"1989-01-07",offset:1,name:"昭和",narrow:"㍼",abbr:"S"},{since:"1912-07-30",until:"1926-12-24",offset:1,name:"大正",narrow:"㍽",abbr:"T"},{since:"1873-01-01",until:"1912-07-29",offset:6,name:"明治",narrow:"㍾",abbr:"M"},{since:"0001-01-01",until:"1873-12-31",offset:1,name:"西暦",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"紀元前",narrow:"BC",abbr:"BC"}],eraYearOrdinalRegex:/(元|\d+)年/,eraYearOrdinalParse:function(e,t){return"元"===t[1]?1:parseInt(t[1]||e,10)},months:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort:"日_月_火_水_木_金_土".split("_"),weekdaysMin:"日_月_火_水_木_金_土".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日 HH:mm",LLLL:"YYYY年M月D日 dddd HH:mm",l:"YYYY/MM/DD",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日(ddd) HH:mm"},meridiemParse:/午前|午後/i,isPM:function(e){return"午後"===e},meridiem:function(e,t,a){return e<12?"午前":"午後"},calendar:{sameDay:"[今日] LT",nextDay:"[明日] LT",nextWeek:function(e){return e.week()!==this.week()?"[来週]dddd LT":"dddd LT"},lastDay:"[昨日] LT",lastWeek:function(e){return this.week()!==e.week()?"[先週]dddd LT":"dddd LT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}日/,ordinal:function(e,t){switch(t){case"y":return 1===e?"元年":e+"年";case"d":case"D":case"DDD":return e+"日";default:return e}},relativeTime:{future:"%s後",past:"%s前",s:"数秒",ss:"%d秒",m:"1分",mm:"%d分",h:"1時間",hh:"%d時間",d:"1日",dd:"%d日",M:"1ヶ月",MM:"%dヶ月",y:"1年",yy:"%d年"}})}(a(43936))},14024:function(e,t,a){!function(e){"use strict";e.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(e,t){return 12===e&&(e=0),"enjing"===t?e:"siyang"===t?e>=11?e:e+12:"sonten"===t||"ndalu"===t?e+12:void 0},meridiem:function(e,t,a){return e<11?"enjing":e<15?"siyang":e<19?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",ss:"%d detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}})}(a(43936))},74796:function(e,t,a){!function(e){"use strict";e.defineLocale("ka",{months:"იანვარი_თებერვალი_მარტი_აპრილი_მაისი_ივნისი_ივლისი_აგვისტო_სექტემბერი_ოქტომბერი_ნოემბერი_დეკემბერი".split("_"),monthsShort:"იან_თებ_მარ_აპრ_მაი_ივნ_ივლ_აგვ_სექ_ოქტ_ნოე_დეკ".split("_"),weekdays:{standalone:"კვირა_ორშაბათი_სამშაბათი_ოთხშაბათი_ხუთშაბათი_პარასკევი_შაბათი".split("_"),format:"კვირას_ორშაბათს_სამშაბათს_ოთხშაბათს_ხუთშაბათს_პარასკევს_შაბათს".split("_"),isFormat:/(წინა|შემდეგ)/},weekdaysShort:"კვი_ორშ_სამ_ოთხ_ხუთ_პარ_შაბ".split("_"),weekdaysMin:"კვ_ორ_სა_ოთ_ხუ_პა_შა".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[დღეს] LT[-ზე]",nextDay:"[ხვალ] LT[-ზე]",lastDay:"[გუშინ] LT[-ზე]",nextWeek:"[შემდეგ] dddd LT[-ზე]",lastWeek:"[წინა] dddd LT-ზე",sameElse:"L"},relativeTime:{future:function(e){return e.replace(/(წამ|წუთ|საათ|წელ|დღ|თვ)(ი|ე)/,(function(e,t,a){return"ი"===a?t+"ში":t+a+"ში"}))},past:function(e){return/(წამი|წუთი|საათი|დღე|თვე)/.test(e)?e.replace(/(ი|ე)$/,"ის წინ"):/წელი/.test(e)?e.replace(/წელი$/,"წლის წინ"):e},s:"რამდენიმე წამი",ss:"%d წამი",m:"წუთი",mm:"%d წუთი",h:"საათი",hh:"%d საათი",d:"დღე",dd:"%d დღე",M:"თვე",MM:"%d თვე",y:"წელი",yy:"%d წელი"},dayOfMonthOrdinalParse:/0|1-ლი|მე-\d{1,2}|\d{1,2}-ე/,ordinal:function(e){return 0===e?e:1===e?e+"-ლი":e<20||e<=100&&e%20==0||e%100==0?"მე-"+e:e+"-ე"},week:{dow:1,doy:7}})}(a(43936))},95744:function(e,t,a){!function(e){"use strict";var t={0:"-ші",1:"-ші",2:"-ші",3:"-ші",4:"-ші",5:"-ші",6:"-шы",7:"-ші",8:"-ші",9:"-шы",10:"-шы",20:"-шы",30:"-шы",40:"-шы",50:"-ші",60:"-шы",70:"-ші",80:"-ші",90:"-шы",100:"-ші"};e.defineLocale("kk",{months:"қаңтар_ақпан_наурыз_сәуір_мамыр_маусым_шілде_тамыз_қыркүйек_қазан_қараша_желтоқсан".split("_"),monthsShort:"қаң_ақп_нау_сәу_мам_мау_шіл_там_қыр_қаз_қар_жел".split("_"),weekdays:"жексенбі_дүйсенбі_сейсенбі_сәрсенбі_бейсенбі_жұма_сенбі".split("_"),weekdaysShort:"жек_дүй_сей_сәр_бей_жұм_сен".split("_"),weekdaysMin:"жк_дй_сй_ср_бй_жм_сн".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Бүгін сағат] LT",nextDay:"[Ертең сағат] LT",nextWeek:"dddd [сағат] LT",lastDay:"[Кеше сағат] LT",lastWeek:"[Өткен аптаның] dddd [сағат] LT",sameElse:"L"},relativeTime:{future:"%s ішінде",past:"%s бұрын",s:"бірнеше секунд",ss:"%d секунд",m:"бір минут",mm:"%d минут",h:"бір сағат",hh:"%d сағат",d:"бір күн",dd:"%d күн",M:"бір ай",MM:"%d ай",y:"бір жыл",yy:"%d жыл"},dayOfMonthOrdinalParse:/\d{1,2}-(ші|шы)/,ordinal:function(e){var a=e%10,i=e>=100?100:null;return e+(t[e]||t[a]||t[i])},week:{dow:1,doy:7}})}(a(43936))},95624:function(e,t,a){!function(e){"use strict";var t={1:"១",2:"២",3:"៣",4:"៤",5:"៥",6:"៦",7:"៧",8:"៨",9:"៩",0:"០"},a={"១":"1","២":"2","៣":"3","៤":"4","៥":"5","៦":"6","៧":"7","៨":"8","៩":"9","០":"0"};e.defineLocale("km",{months:"មករា_កុម្ភៈ_មីនា_មេសា_ឧសភា_មិថុនា_កក្កដា_សីហា_កញ្ញា_តុលា_វិច្ឆិកា_ធ្នូ".split("_"),monthsShort:"មករា_កុម្ភៈ_មីនា_មេសា_ឧសភា_មិថុនា_កក្កដា_សីហា_កញ្ញា_តុលា_វិច្ឆិកា_ធ្នូ".split("_"),weekdays:"អាទិត្យ_ច័ន្ទ_អង្គារ_ពុធ_ព្រហស្បតិ៍_សុក្រ_សៅរ៍".split("_"),weekdaysShort:"អា_ច_អ_ព_ព្រ_សុ_ស".split("_"),weekdaysMin:"អា_ច_អ_ព_ព្រ_សុ_ស".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/ព្រឹក|ល្ងាច/,isPM:function(e){return"ល្ងាច"===e},meridiem:function(e,t,a){return e<12?"ព្រឹក":"ល្ងាច"},calendar:{sameDay:"[ថ្ងៃនេះ ម៉ោង] LT",nextDay:"[ស្អែក ម៉ោង] LT",nextWeek:"dddd [ម៉ោង] LT",lastDay:"[ម្សិលមិញ ម៉ោង] LT",lastWeek:"dddd [សប្តាហ៍មុន] [ម៉ោង] LT",sameElse:"L"},relativeTime:{future:"%sទៀត",past:"%sមុន",s:"ប៉ុន្មានវិនាទី",ss:"%d វិនាទី",m:"មួយនាទី",mm:"%d នាទី",h:"មួយម៉ោង",hh:"%d ម៉ោង",d:"មួយថ្ងៃ",dd:"%d ថ្ងៃ",M:"មួយខែ",MM:"%d ខែ",y:"មួយឆ្នាំ",yy:"%d ឆ្នាំ"},dayOfMonthOrdinalParse:/ទី\d{1,2}/,ordinal:"ទី%d",preparse:function(e){return e.replace(/[១២៣៤៥៦៧៨៩០]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},week:{dow:1,doy:4}})}(a(43936))},99340:function(e,t,a){!function(e){"use strict";var t={1:"೧",2:"೨",3:"೩",4:"೪",5:"೫",6:"೬",7:"೭",8:"೮",9:"೯",0:"೦"},a={"೧":"1","೨":"2","೩":"3","೪":"4","೫":"5","೬":"6","೭":"7","೮":"8","೯":"9","೦":"0"};e.defineLocale("kn",{months:"ಜನವರಿ_ಫೆಬ್ರವರಿ_ಮಾರ್ಚ್_ಏಪ್ರಿಲ್_ಮೇ_ಜೂನ್_ಜುಲೈ_ಆಗಸ್ಟ್_ಸೆಪ್ಟೆಂಬರ್_ಅಕ್ಟೋಬರ್_ನವೆಂಬರ್_ಡಿಸೆಂಬರ್".split("_"),monthsShort:"ಜನ_ಫೆಬ್ರ_ಮಾರ್ಚ್_ಏಪ್ರಿಲ್_ಮೇ_ಜೂನ್_ಜುಲೈ_ಆಗಸ್ಟ್_ಸೆಪ್ಟೆಂ_ಅಕ್ಟೋ_ನವೆಂ_ಡಿಸೆಂ".split("_"),monthsParseExact:!0,weekdays:"ಭಾನುವಾರ_ಸೋಮವಾರ_ಮಂಗಳವಾರ_ಬುಧವಾರ_ಗುರುವಾರ_ಶುಕ್ರವಾರ_ಶನಿವಾರ".split("_"),weekdaysShort:"ಭಾನು_ಸೋಮ_ಮಂಗಳ_ಬುಧ_ಗುರು_ಶುಕ್ರ_ಶನಿ".split("_"),weekdaysMin:"ಭಾ_ಸೋ_ಮಂ_ಬು_ಗು_ಶು_ಶ".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[ಇಂದು] LT",nextDay:"[ನಾಳೆ] LT",nextWeek:"dddd, LT",lastDay:"[ನಿನ್ನೆ] LT",lastWeek:"[ಕೊನೆಯ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ನಂತರ",past:"%s ಹಿಂದೆ",s:"ಕೆಲವು ಕ್ಷಣಗಳು",ss:"%d ಸೆಕೆಂಡುಗಳು",m:"ಒಂದು ನಿಮಿಷ",mm:"%d ನಿಮಿಷ",h:"ಒಂದು ಗಂಟೆ",hh:"%d ಗಂಟೆ",d:"ಒಂದು ದಿನ",dd:"%d ದಿನ",M:"ಒಂದು ತಿಂಗಳು",MM:"%d ತಿಂಗಳು",y:"ಒಂದು ವರ್ಷ",yy:"%d ವರ್ಷ"},preparse:function(e){return e.replace(/[೧೨೩೪೫೬೭೮೯೦]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/ರಾತ್ರಿ|ಬೆಳಿಗ್ಗೆ|ಮಧ್ಯಾಹ್ನ|ಸಂಜೆ/,meridiemHour:function(e,t){return 12===e&&(e=0),"ರಾತ್ರಿ"===t?e<4?e:e+12:"ಬೆಳಿಗ್ಗೆ"===t?e:"ಮಧ್ಯಾಹ್ನ"===t?e>=10?e:e+12:"ಸಂಜೆ"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"ರಾತ್ರಿ":e<10?"ಬೆಳಿಗ್ಗೆ":e<17?"ಮಧ್ಯಾಹ್ನ":e<20?"ಸಂಜೆ":"ರಾತ್ರಿ"},dayOfMonthOrdinalParse:/\d{1,2}(ನೇ)/,ordinal:function(e){return e+"ನೇ"},week:{dow:0,doy:6}})}(a(43936))},92612:function(e,t,a){!function(e){"use strict";e.defineLocale("ko",{months:"1월_2월_3월_4월_5월_6월_7월_8월_9월_10월_11월_12월".split("_"),monthsShort:"1월_2월_3월_4월_5월_6월_7월_8월_9월_10월_11월_12월".split("_"),weekdays:"일요일_월요일_화요일_수요일_목요일_금요일_토요일".split("_"),weekdaysShort:"일_월_화_수_목_금_토".split("_"),weekdaysMin:"일_월_화_수_목_금_토".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY년 MMMM D일",LLL:"YYYY년 MMMM D일 A h:mm",LLLL:"YYYY년 MMMM D일 dddd A h:mm",l:"YYYY.MM.DD.",ll:"YYYY년 MMMM D일",lll:"YYYY년 MMMM D일 A h:mm",llll:"YYYY년 MMMM D일 dddd A h:mm"},calendar:{sameDay:"오늘 LT",nextDay:"내일 LT",nextWeek:"dddd LT",lastDay:"어제 LT",lastWeek:"지난주 dddd LT",sameElse:"L"},relativeTime:{future:"%s 후",past:"%s 전",s:"몇 초",ss:"%d초",m:"1분",mm:"%d분",h:"한 시간",hh:"%d시간",d:"하루",dd:"%d일",M:"한 달",MM:"%d달",y:"일 년",yy:"%d년"},dayOfMonthOrdinalParse:/\d{1,2}(일|월|주)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"일";case"M":return e+"월";case"w":case"W":return e+"주";default:return e}},meridiemParse:/오전|오후/,isPM:function(e){return"오후"===e},meridiem:function(e,t,a){return e<12?"오전":"오후"}})}(a(43936))},30928:function(e,t,a){!function(e){"use strict";var t={1:"١",2:"٢",3:"٣",4:"٤",5:"٥",6:"٦",7:"٧",8:"٨",9:"٩",0:"٠"},a={"١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","٠":"0"},i=["کانونی دووەم","شوبات","ئازار","نیسان","ئایار","حوزەیران","تەمموز","ئاب","ئەیلوول","تشرینی یەكەم","تشرینی دووەم","كانونی یەکەم"];e.defineLocale("ku",{months:i,monthsShort:i,weekdays:"یه‌كشه‌ممه‌_دووشه‌ممه‌_سێشه‌ممه‌_چوارشه‌ممه‌_پێنجشه‌ممه‌_هه‌ینی_شه‌ممه‌".split("_"),weekdaysShort:"یه‌كشه‌م_دووشه‌م_سێشه‌م_چوارشه‌م_پێنجشه‌م_هه‌ینی_شه‌ممه‌".split("_"),weekdaysMin:"ی_د_س_چ_پ_ه_ش".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/ئێواره‌|به‌یانی/,isPM:function(e){return/ئێواره‌/.test(e)},meridiem:function(e,t,a){return e<12?"به‌یانی":"ئێواره‌"},calendar:{sameDay:"[ئه‌مرۆ كاتژمێر] LT",nextDay:"[به‌یانی كاتژمێر] LT",nextWeek:"dddd [كاتژمێر] LT",lastDay:"[دوێنێ كاتژمێر] LT",lastWeek:"dddd [كاتژمێر] LT",sameElse:"L"},relativeTime:{future:"له‌ %s",past:"%s",s:"چه‌ند چركه‌یه‌ك",ss:"چركه‌ %d",m:"یه‌ك خوله‌ك",mm:"%d خوله‌ك",h:"یه‌ك كاتژمێر",hh:"%d كاتژمێر",d:"یه‌ك ڕۆژ",dd:"%d ڕۆژ",M:"یه‌ك مانگ",MM:"%d مانگ",y:"یه‌ك ساڵ",yy:"%d ساڵ"},preparse:function(e){return e.replace(/[١٢٣٤٥٦٧٨٩٠]/g,(function(e){return a[e]})).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"،")},week:{dow:6,doy:12}})}(a(43936))},84388:function(e,t,a){!function(e){"use strict";var t={0:"-чү",1:"-чи",2:"-чи",3:"-чү",4:"-чү",5:"-чи",6:"-чы",7:"-чи",8:"-чи",9:"-чу",10:"-чу",20:"-чы",30:"-чу",40:"-чы",50:"-чү",60:"-чы",70:"-чи",80:"-чи",90:"-чу",100:"-чү"};e.defineLocale("ky",{months:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),monthsShort:"янв_фев_март_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),weekdays:"Жекшемби_Дүйшөмбү_Шейшемби_Шаршемби_Бейшемби_Жума_Ишемби".split("_"),weekdaysShort:"Жек_Дүй_Шей_Шар_Бей_Жум_Ише".split("_"),weekdaysMin:"Жк_Дй_Шй_Шр_Бй_Жм_Иш".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Бүгүн саат] LT",nextDay:"[Эртең саат] LT",nextWeek:"dddd [саат] LT",lastDay:"[Кечээ саат] LT",lastWeek:"[Өткөн аптанын] dddd [күнү] [саат] LT",sameElse:"L"},relativeTime:{future:"%s ичинде",past:"%s мурун",s:"бирнече секунд",ss:"%d секунд",m:"бир мүнөт",mm:"%d мүнөт",h:"бир саат",hh:"%d саат",d:"бир күн",dd:"%d күн",M:"бир ай",MM:"%d ай",y:"бир жыл",yy:"%d жыл"},dayOfMonthOrdinalParse:/\d{1,2}-(чи|чы|чү|чу)/,ordinal:function(e){var a=e%10,i=e>=100?100:null;return e+(t[e]||t[a]||t[i])},week:{dow:1,doy:7}})}(a(43936))},24728:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return t?s[a][0]:s[a][1]}function a(e){return s(e.substr(0,e.indexOf(" ")))?"a "+e:"an "+e}function i(e){return s(e.substr(0,e.indexOf(" ")))?"viru "+e:"virun "+e}function s(e){if(e=parseInt(e,10),isNaN(e))return!1;if(e<0)return!0;if(e<10)return 4<=e&&e<=7;if(e<100){var t=e%10;return s(0===t?e/10:t)}if(e<1e4){for(;e>=10;)e/=10;return s(e)}return s(e/=1e3)}e.defineLocale("lb",{months:"Januar_Februar_Mäerz_Abrëll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonndeg_Méindeg_Dënschdeg_Mëttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._Mé._Dë._Më._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mé_Dë_Më_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm [Auer]",LLLL:"dddd, D. MMMM YYYY H:mm [Auer]"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gëschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:a,past:i,s:"e puer Sekonnen",ss:"%d Sekonnen",m:t,mm:"%d Minutten",h:t,hh:"%d Stonnen",d:t,dd:"%d Deeg",M:t,MM:"%d Méint",y:t,yy:"%d Joer"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},17464:function(e,t,a){!function(e){"use strict";e.defineLocale("lo",{months:"ມັງກອນ_ກຸມພາ_ມີນາ_ເມສາ_ພຶດສະພາ_ມິຖຸນາ_ກໍລະກົດ_ສິງຫາ_ກັນຍາ_ຕຸລາ_ພະຈິກ_ທັນວາ".split("_"),monthsShort:"ມັງກອນ_ກຸມພາ_ມີນາ_ເມສາ_ພຶດສະພາ_ມິຖຸນາ_ກໍລະກົດ_ສິງຫາ_ກັນຍາ_ຕຸລາ_ພະຈິກ_ທັນວາ".split("_"),weekdays:"ອາທິດ_ຈັນ_ອັງຄານ_ພຸດ_ພະຫັດ_ສຸກ_ເສົາ".split("_"),weekdaysShort:"ທິດ_ຈັນ_ອັງຄານ_ພຸດ_ພະຫັດ_ສຸກ_ເສົາ".split("_"),weekdaysMin:"ທ_ຈ_ອຄ_ພ_ພຫ_ສກ_ສ".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"ວັນdddd D MMMM YYYY HH:mm"},meridiemParse:/ຕອນເຊົ້າ|ຕອນແລງ/,isPM:function(e){return"ຕອນແລງ"===e},meridiem:function(e,t,a){return e<12?"ຕອນເຊົ້າ":"ຕອນແລງ"},calendar:{sameDay:"[ມື້ນີ້ເວລາ] LT",nextDay:"[ມື້ອື່ນເວລາ] LT",nextWeek:"[ວັນ]dddd[ໜ້າເວລາ] LT",lastDay:"[ມື້ວານນີ້ເວລາ] LT",lastWeek:"[ວັນ]dddd[ແລ້ວນີ້ເວລາ] LT",sameElse:"L"},relativeTime:{future:"ອີກ %s",past:"%sຜ່ານມາ",s:"ບໍ່ເທົ່າໃດວິນາທີ",ss:"%d ວິນາທີ",m:"1 ນາທີ",mm:"%d ນາທີ",h:"1 ຊົ່ວໂມງ",hh:"%d ຊົ່ວໂມງ",d:"1 ມື້",dd:"%d ມື້",M:"1 ເດືອນ",MM:"%d ເດືອນ",y:"1 ປີ",yy:"%d ປີ"},dayOfMonthOrdinalParse:/(ທີ່)\d{1,2}/,ordinal:function(e){return"ທີ່"+e}})}(a(43936))},60256:function(e,t,a){!function(e){"use strict";var t={ss:"sekundė_sekundžių_sekundes",m:"minutė_minutės_minutę",mm:"minutės_minučių_minutes",h:"valanda_valandos_valandą",hh:"valandos_valandų_valandas",d:"diena_dienos_dieną",dd:"dienos_dienų_dienas",M:"mėnuo_mėnesio_mėnesį",MM:"mėnesiai_mėnesių_mėnesius",y:"metai_metų_metus",yy:"metai_metų_metus"};function a(e,t,a,i){return t?"kelios sekundės":i?"kelių sekundžių":"kelias sekundes"}function i(e,t,a,i){return t?r(a)[0]:i?r(a)[1]:r(a)[2]}function s(e){return e%10==0||e>10&&e<20}function r(e){return t[e].split("_")}function l(e,t,a,l){var c=e+" ";return 1===e?c+i(e,t,a[0],l):t?c+(s(e)?r(a)[1]:r(a)[0]):l?c+r(a)[1]:c+(s(e)?r(a)[1]:r(a)[2])}e.defineLocale("lt",{months:{format:"sausio_vasario_kovo_balandžio_gegužės_birželio_liepos_rugpjūčio_rugsėjo_spalio_lapkričio_gruodžio".split("_"),standalone:"sausis_vasaris_kovas_balandis_gegužė_birželis_liepa_rugpjūtis_rugsėjis_spalis_lapkritis_gruodis".split("_"),isFormat:/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?|MMMM?(\[[^\[\]]*\]|\s)+D[oD]?/},monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:{format:"sekmadienį_pirmadienį_antradienį_trečiadienį_ketvirtadienį_penktadienį_šeštadienį".split("_"),standalone:"sekmadienis_pirmadienis_antradienis_trečiadienis_ketvirtadienis_penktadienis_šeštadienis".split("_"),isFormat:/dddd HH:mm/},weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_Šeš".split("_"),weekdaysMin:"S_P_A_T_K_Pn_Š".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], HH:mm [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, HH:mm [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], HH:mm [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, HH:mm [val.]"},calendar:{sameDay:"[Šiandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Praėjusį] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prieš %s",s:a,ss:l,m:i,mm:l,h:i,hh:l,d:i,dd:l,M:i,MM:l,y:i,yy:l},dayOfMonthOrdinalParse:/\d{1,2}-oji/,ordinal:function(e){return e+"-oji"},week:{dow:1,doy:4}})}(a(43936))},86312:function(e,t,a){!function(e){"use strict";var t={ss:"sekundes_sekundēm_sekunde_sekundes".split("_"),m:"minūtes_minūtēm_minūte_minūtes".split("_"),mm:"minūtes_minūtēm_minūte_minūtes".split("_"),h:"stundas_stundām_stunda_stundas".split("_"),hh:"stundas_stundām_stunda_stundas".split("_"),d:"dienas_dienām_diena_dienas".split("_"),dd:"dienas_dienām_diena_dienas".split("_"),M:"mēneša_mēnešiem_mēnesis_mēneši".split("_"),MM:"mēneša_mēnešiem_mēnesis_mēneši".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")};function a(e,t,a){return a?t%10==1&&t%100!=11?e[2]:e[3]:t%10==1&&t%100!=11?e[0]:e[1]}function i(e,i,s){return e+" "+a(t[s],e,i)}function s(e,i,s){return a(t[s],e,i)}function r(e,t){return t?"dažas sekundes":"dažām sekundēm"}e.defineLocale("lv",{months:"janvāris_februāris_marts_aprīlis_maijs_jūnijs_jūlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jūn_jūl_aug_sep_okt_nov_dec".split("_"),weekdays:"svētdiena_pirmdiena_otrdiena_trešdiena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, HH:mm",LLLL:"YYYY. [gada] D. MMMM, dddd, HH:mm"},calendar:{sameDay:"[Šodien pulksten] LT",nextDay:"[Rīt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagājušā] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"pēc %s",past:"pirms %s",s:r,ss:i,m:s,mm:i,h:s,hh:i,d:s,dd:i,M:s,MM:i,y:s,yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},49260:function(e,t,a){!function(e){"use strict";var t={words:{ss:["sekund","sekunda","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,a,i){var s=t.words[i];return 1===i.length?a?s[0]:s[1]:e+" "+t.correctGrammaticalCase(e,s)}};e.defineLocale("me",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_četvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._čet._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_če_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juče u] LT",lastWeek:function(){return["[prošle] [nedjelje] [u] LT","[prošlog] [ponedjeljka] [u] LT","[prošlog] [utorka] [u] LT","[prošle] [srijede] [u] LT","[prošlog] [četvrtka] [u] LT","[prošlog] [petka] [u] LT","[prošle] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"dan",dd:t.translate,M:"mjesec",MM:t.translate,y:"godinu",yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},24636:function(e,t,a){!function(e){"use strict";e.defineLocale("mi",{months:"Kohi-tāte_Hui-tanguru_Poutū-te-rangi_Paenga-whāwhā_Haratua_Pipiri_Hōngoingoi_Here-turi-kōkā_Mahuru_Whiringa-ā-nuku_Whiringa-ā-rangi_Hakihea".split("_"),monthsShort:"Kohi_Hui_Pou_Pae_Hara_Pipi_Hōngoi_Here_Mahu_Whi-nu_Whi-ra_Haki".split("_"),monthsRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,2}/i,weekdays:"Rātapu_Mane_Tūrei_Wenerei_Tāite_Paraire_Hātarei".split("_"),weekdaysShort:"Ta_Ma_Tū_We_Tāi_Pa_Hā".split("_"),weekdaysMin:"Ta_Ma_Tū_We_Tāi_Pa_Hā".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [i] HH:mm",LLLL:"dddd, D MMMM YYYY [i] HH:mm"},calendar:{sameDay:"[i teie mahana, i] LT",nextDay:"[apopo i] LT",nextWeek:"dddd [i] LT",lastDay:"[inanahi i] LT",lastWeek:"dddd [whakamutunga i] LT",sameElse:"L"},relativeTime:{future:"i roto i %s",past:"%s i mua",s:"te hēkona ruarua",ss:"%d hēkona",m:"he meneti",mm:"%d meneti",h:"te haora",hh:"%d haora",d:"he ra",dd:"%d ra",M:"he marama",MM:"%d marama",y:"he tau",yy:"%d tau"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},31952:function(e,t,a){!function(e){"use strict";e.defineLocale("mk",{months:"јануари_февруари_март_април_мај_јуни_јули_август_септември_октомври_ноември_декември".split("_"),monthsShort:"јан_фев_мар_апр_мај_јун_јул_авг_сеп_окт_ное_дек".split("_"),weekdays:"недела_понеделник_вторник_среда_четврток_петок_сабота".split("_"),weekdaysShort:"нед_пон_вто_сре_чет_пет_саб".split("_"),weekdaysMin:"нe_пo_вт_ср_че_пе_сa".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[Денес во] LT",nextDay:"[Утре во] LT",nextWeek:"[Во] dddd [во] LT",lastDay:"[Вчера во] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[Изминатата] dddd [во] LT";case 1:case 2:case 4:case 5:return"[Изминатиот] dddd [во] LT"}},sameElse:"L"},relativeTime:{future:"за %s",past:"пред %s",s:"неколку секунди",ss:"%d секунди",m:"една минута",mm:"%d минути",h:"еден час",hh:"%d часа",d:"еден ден",dd:"%d дена",M:"еден месец",MM:"%d месеци",y:"една година",yy:"%d години"},dayOfMonthOrdinalParse:/\d{1,2}-(ев|ен|ти|ви|ри|ми)/,ordinal:function(e){var t=e%10,a=e%100;return 0===e?e+"-ев":0===a?e+"-ен":a>10&&a<20?e+"-ти":1===t?e+"-ви":2===t?e+"-ри":7===t||8===t?e+"-ми":e+"-ти"},week:{dow:1,doy:7}})}(a(43936))},62252:function(e,t,a){!function(e){"use strict";e.defineLocale("ml",{months:"ജനുവരി_ഫെബ്രുവരി_മാർച്ച്_ഏപ്രിൽ_മേയ്_ജൂൺ_ജൂലൈ_ഓഗസ്റ്റ്_സെപ്റ്റംബർ_ഒക്ടോബർ_നവംബർ_ഡിസംബർ".split("_"),monthsShort:"ജനു._ഫെബ്രു._മാർ._ഏപ്രി._മേയ്_ജൂൺ_ജൂലൈ._ഓഗ._സെപ്റ്റ._ഒക്ടോ._നവം._ഡിസം.".split("_"),monthsParseExact:!0,weekdays:"ഞായറാഴ്ച_തിങ്കളാഴ്ച_ചൊവ്വാഴ്ച_ബുധനാഴ്ച_വ്യാഴാഴ്ച_വെള്ളിയാഴ്ച_ശനിയാഴ്ച".split("_"),weekdaysShort:"ഞായർ_തിങ്കൾ_ചൊവ്വ_ബുധൻ_വ്യാഴം_വെള്ളി_ശനി".split("_"),weekdaysMin:"ഞാ_തി_ചൊ_ബു_വ്യാ_വെ_ശ".split("_"),longDateFormat:{LT:"A h:mm -നു",LTS:"A h:mm:ss -നു",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm -നു",LLLL:"dddd, D MMMM YYYY, A h:mm -നു"},calendar:{sameDay:"[ഇന്ന്] LT",nextDay:"[നാളെ] LT",nextWeek:"dddd, LT",lastDay:"[ഇന്നലെ] LT",lastWeek:"[കഴിഞ്ഞ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s കഴിഞ്ഞ്",past:"%s മുൻപ്",s:"അൽപ നിമിഷങ്ങൾ",ss:"%d സെക്കൻഡ്",m:"ഒരു മിനിറ്റ്",mm:"%d മിനിറ്റ്",h:"ഒരു മണിക്കൂർ",hh:"%d മണിക്കൂർ",d:"ഒരു ദിവസം",dd:"%d ദിവസം",M:"ഒരു മാസം",MM:"%d മാസം",y:"ഒരു വർഷം",yy:"%d വർഷം"},meridiemParse:/രാത്രി|രാവിലെ|ഉച്ച കഴിഞ്ഞ്|വൈകുന്നേരം|രാത്രി/i,meridiemHour:function(e,t){return 12===e&&(e=0),"രാത്രി"===t&&e>=4||"ഉച്ച കഴിഞ്ഞ്"===t||"വൈകുന്നേരം"===t?e+12:e},meridiem:function(e,t,a){return e<4?"രാത്രി":e<12?"രാവിലെ":e<17?"ഉച്ച കഴിഞ്ഞ്":e<20?"വൈകുന്നേരം":"രാത്രി"}})}(a(43936))},82024:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){switch(a){case"s":return t?"хэдхэн секунд":"хэдхэн секундын";case"ss":return e+(t?" секунд":" секундын");case"m":case"mm":return e+(t?" минут":" минутын");case"h":case"hh":return e+(t?" цаг":" цагийн");case"d":case"dd":return e+(t?" өдөр":" өдрийн");case"M":case"MM":return e+(t?" сар":" сарын");case"y":case"yy":return e+(t?" жил":" жилийн");default:return e}}e.defineLocale("mn",{months:"Нэгдүгээр сар_Хоёрдугаар сар_Гуравдугаар сар_Дөрөвдүгээр сар_Тавдугаар сар_Зургадугаар сар_Долдугаар сар_Наймдугаар сар_Есдүгээр сар_Аравдугаар сар_Арван нэгдүгээр сар_Арван хоёрдугаар сар".split("_"),monthsShort:"1 сар_2 сар_3 сар_4 сар_5 сар_6 сар_7 сар_8 сар_9 сар_10 сар_11 сар_12 сар".split("_"),monthsParseExact:!0,weekdays:"Ням_Даваа_Мягмар_Лхагва_Пүрэв_Баасан_Бямба".split("_"),weekdaysShort:"Ням_Дав_Мяг_Лха_Пүр_Баа_Бям".split("_"),weekdaysMin:"Ня_Да_Мя_Лх_Пү_Ба_Бя".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY оны MMMMын D",LLL:"YYYY оны MMMMын D HH:mm",LLLL:"dddd, YYYY оны MMMMын D HH:mm"},meridiemParse:/ҮӨ|ҮХ/i,isPM:function(e){return"ҮХ"===e},meridiem:function(e,t,a){return e<12?"ҮӨ":"ҮХ"},calendar:{sameDay:"[Өнөөдөр] LT",nextDay:"[Маргааш] LT",nextWeek:"[Ирэх] dddd LT",lastDay:"[Өчигдөр] LT",lastWeek:"[Өнгөрсөн] dddd LT",sameElse:"L"},relativeTime:{future:"%s дараа",past:"%s өмнө",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2} өдөр/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+" өдөр";default:return e}}})}(a(43936))},84707:function(e,t,a){!function(e){"use strict";var t={1:"१",2:"२",3:"३",4:"४",5:"५",6:"६",7:"७",8:"८",9:"९",0:"०"},a={"१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9","०":"0"};function i(e,t,a,i){var s="";if(t)switch(a){case"s":s="काही सेकंद";break;case"ss":s="%d सेकंद";break;case"m":s="एक मिनिट";break;case"mm":s="%d मिनिटे";break;case"h":s="एक तास";break;case"hh":s="%d तास";break;case"d":s="एक दिवस";break;case"dd":s="%d दिवस";break;case"M":s="एक महिना";break;case"MM":s="%d महिने";break;case"y":s="एक वर्ष";break;case"yy":s="%d वर्षे"}else switch(a){case"s":s="काही सेकंदां";break;case"ss":s="%d सेकंदां";break;case"m":s="एका मिनिटा";break;case"mm":s="%d मिनिटां";break;case"h":s="एका तासा";break;case"hh":s="%d तासां";break;case"d":s="एका दिवसा";break;case"dd":s="%d दिवसां";break;case"M":s="एका महिन्या";break;case"MM":s="%d महिन्यां";break;case"y":s="एका वर्षा";break;case"yy":s="%d वर्षां"}return s.replace(/%d/i,e)}e.defineLocale("mr",{months:"जानेवारी_फेब्रुवारी_मार्च_एप्रिल_मे_जून_जुलै_ऑगस्ट_सप्टेंबर_ऑक्टोबर_नोव्हेंबर_डिसेंबर".split("_"),monthsShort:"जाने._फेब्रु._मार्च._एप्रि._मे._जून._जुलै._ऑग._सप्टें._ऑक्टो._नोव्हें._डिसें.".split("_"),monthsParseExact:!0,weekdays:"रविवार_सोमवार_मंगळवार_बुधवार_गुरूवार_शुक्रवार_शनिवार".split("_"),weekdaysShort:"रवि_सोम_मंगळ_बुध_गुरू_शुक्र_शनि".split("_"),weekdaysMin:"र_सो_मं_बु_गु_शु_श".split("_"),longDateFormat:{LT:"A h:mm वाजता",LTS:"A h:mm:ss वाजता",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm वाजता",LLLL:"dddd, D MMMM YYYY, A h:mm वाजता"},calendar:{sameDay:"[आज] LT",nextDay:"[उद्या] LT",nextWeek:"dddd, LT",lastDay:"[काल] LT",lastWeek:"[मागील] dddd, LT",sameElse:"L"},relativeTime:{future:"%sमध्ये",past:"%sपूर्वी",s:i,ss:i,m:i,mm:i,h:i,hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},preparse:function(e){return e.replace(/[१२३४५६७८९०]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/पहाटे|सकाळी|दुपारी|सायंकाळी|रात्री/,meridiemHour:function(e,t){return 12===e&&(e=0),"पहाटे"===t||"सकाळी"===t?e:"दुपारी"===t||"सायंकाळी"===t||"रात्री"===t?e>=12?e:e+12:void 0},meridiem:function(e,t,a){return e>=0&&e<6?"पहाटे":e<12?"सकाळी":e<17?"दुपारी":e<20?"सायंकाळी":"रात्री"},week:{dow:0,doy:6}})}(a(43936))},49444:function(e,t,a){!function(e){"use strict";e.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,a){return e<11?"pagi":e<15?"tengahari":e<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(a(43936))},59904:function(e,t,a){!function(e){"use strict";e.defineLocale("ms",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,a){return e<11?"pagi":e<15?"tengahari":e<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(a(43936))},1516:function(e,t,a){!function(e){"use strict";e.defineLocale("mt",{months:"Jannar_Frar_Marzu_April_Mejju_Ġunju_Lulju_Awwissu_Settembru_Ottubru_Novembru_Diċembru".split("_"),monthsShort:"Jan_Fra_Mar_Apr_Mej_Ġun_Lul_Aww_Set_Ott_Nov_Diċ".split("_"),weekdays:"Il-Ħadd_It-Tnejn_It-Tlieta_L-Erbgħa_Il-Ħamis_Il-Ġimgħa_Is-Sibt".split("_"),weekdaysShort:"Ħad_Tne_Tli_Erb_Ħam_Ġim_Sib".split("_"),weekdaysMin:"Ħa_Tn_Tl_Er_Ħa_Ġi_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Illum fil-]LT",nextDay:"[Għada fil-]LT",nextWeek:"dddd [fil-]LT",lastDay:"[Il-bieraħ fil-]LT",lastWeek:"dddd [li għadda] [fil-]LT",sameElse:"L"},relativeTime:{future:"f’ %s",past:"%s ilu",s:"ftit sekondi",ss:"%d sekondi",m:"minuta",mm:"%d minuti",h:"siegħa",hh:"%d siegħat",d:"ġurnata",dd:"%d ġranet",M:"xahar",MM:"%d xhur",y:"sena",yy:"%d sni"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},38956:function(e,t,a){!function(e){"use strict";var t={1:"၁",2:"၂",3:"၃",4:"၄",5:"၅",6:"၆",7:"၇",8:"၈",9:"၉",0:"၀"},a={"၁":"1","၂":"2","၃":"3","၄":"4","၅":"5","၆":"6","၇":"7","၈":"8","၉":"9","၀":"0"};e.defineLocale("my",{months:"ဇန်နဝါရီ_ဖေဖော်ဝါရီ_မတ်_ဧပြီ_မေ_ဇွန်_ဇူလိုင်_သြဂုတ်_စက်တင်ဘာ_အောက်တိုဘာ_နိုဝင်ဘာ_ဒီဇင်ဘာ".split("_"),monthsShort:"ဇန်_ဖေ_မတ်_ပြီ_မေ_ဇွန်_လိုင်_သြ_စက်_အောက်_နို_ဒီ".split("_"),weekdays:"တနင်္ဂနွေ_တနင်္လာ_အင်္ဂါ_ဗုဒ္ဓဟူး_ကြာသပတေး_သောကြာ_စနေ".split("_"),weekdaysShort:"နွေ_လာ_ဂါ_ဟူး_ကြာ_သော_နေ".split("_"),weekdaysMin:"နွေ_လာ_ဂါ_ဟူး_ကြာ_သော_နေ".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[ယနေ.] LT [မှာ]",nextDay:"[မနက်ဖြန်] LT [မှာ]",nextWeek:"dddd LT [မှာ]",lastDay:"[မနေ.က] LT [မှာ]",lastWeek:"[ပြီးခဲ့သော] dddd LT [မှာ]",sameElse:"L"},relativeTime:{future:"လာမည့် %s မှာ",past:"လွန်ခဲ့သော %s က",s:"စက္ကန်.အနည်းငယ်",ss:"%d စက္ကန့်",m:"တစ်မိနစ်",mm:"%d မိနစ်",h:"တစ်နာရီ",hh:"%d နာရီ",d:"တစ်ရက်",dd:"%d ရက်",M:"တစ်လ",MM:"%d လ",y:"တစ်နှစ်",yy:"%d နှစ်"},preparse:function(e){return e.replace(/[၁၂၃၄၅၆၇၈၉၀]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},week:{dow:1,doy:4}})}(a(43936))},44508:function(e,t,a){!function(e){"use strict";e.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"søndag_mandag_tirsdag_onsdag_torsdag_fredag_lørdag".split("_"),weekdaysShort:"sø._ma._ti._on._to._fr._lø.".split("_"),weekdaysMin:"sø_ma_ti_on_to_fr_lø".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i går kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",ss:"%d sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",w:"en uke",ww:"%d uker",M:"en måned",MM:"%d måneder",y:"ett år",yy:"%d år"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},95831:function(e,t,a){!function(e){"use strict";var t={1:"१",2:"२",3:"३",4:"४",5:"५",6:"६",7:"७",8:"८",9:"९",0:"०"},a={"१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9","०":"0"};e.defineLocale("ne",{months:"जनवरी_फेब्रुवरी_मार्च_अप्रिल_मई_जुन_जुलाई_अगष्ट_सेप्टेम्बर_अक्टोबर_नोभेम्बर_डिसेम्बर".split("_"),monthsShort:"जन._फेब्रु._मार्च_अप्रि._मई_जुन_जुलाई._अग._सेप्ट._अक्टो._नोभे._डिसे.".split("_"),monthsParseExact:!0,weekdays:"आइतबार_सोमबार_मङ्गलबार_बुधबार_बिहिबार_शुक्रबार_शनिबार".split("_"),weekdaysShort:"आइत._सोम._मङ्गल._बुध._बिहि._शुक्र._शनि.".split("_"),weekdaysMin:"आ._सो._मं._बु._बि._शु._श.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"Aको h:mm बजे",LTS:"Aको h:mm:ss बजे",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, Aको h:mm बजे",LLLL:"dddd, D MMMM YYYY, Aको h:mm बजे"},preparse:function(e){return e.replace(/[१२३४५६७८९०]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/राति|बिहान|दिउँसो|साँझ/,meridiemHour:function(e,t){return 12===e&&(e=0),"राति"===t?e<4?e:e+12:"बिहान"===t?e:"दिउँसो"===t?e>=10?e:e+12:"साँझ"===t?e+12:void 0},meridiem:function(e,t,a){return e<3?"राति":e<12?"बिहान":e<16?"दिउँसो":e<20?"साँझ":"राति"},calendar:{sameDay:"[आज] LT",nextDay:"[भोलि] LT",nextWeek:"[आउँदो] dddd[,] LT",lastDay:"[हिजो] LT",lastWeek:"[गएको] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%sमा",past:"%s अगाडि",s:"केही क्षण",ss:"%d सेकेण्ड",m:"एक मिनेट",mm:"%d मिनेट",h:"एक घण्टा",hh:"%d घण्टा",d:"एक दिन",dd:"%d दिन",M:"एक महिना",MM:"%d महिना",y:"एक बर्ष",yy:"%d बर्ष"},week:{dow:0,doy:6}})}(a(43936))},28640:function(e,t,a){!function(e){"use strict";var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),a="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),i=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],s=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;e.defineLocale("nl-be",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"één minuut",mm:"%d minuten",h:"één uur",hh:"%d uur",d:"één dag",dd:"%d dagen",M:"één maand",MM:"%d maanden",y:"één jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(a(43936))},88036:function(e,t,a){!function(e){"use strict";var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),a="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),i=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],s=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;e.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,i){return e?/-MMM-/.test(i)?a[e.month()]:t[e.month()]:t},monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"één minuut",mm:"%d minuten",h:"één uur",hh:"%d uur",d:"één dag",dd:"%d dagen",w:"één week",ww:"%d weken",M:"één maand",MM:"%d maanden",y:"één jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(a(43936))},20964:function(e,t,a){!function(e){"use strict";e.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"sundag_måndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"su._må._ty._on._to._fr._lau.".split("_"),weekdaysMin:"su_må_ty_on_to_fr_la".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I går klokka] LT",lastWeek:"[Føregåande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s sidan",s:"nokre sekund",ss:"%d sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",w:"ei veke",ww:"%d veker",M:"ein månad",MM:"%d månader",y:"eit år",yy:"%d år"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},15632:function(e,t,a){!function(e){"use strict";e.defineLocale("oc-lnc",{months:{standalone:"genièr_febrièr_març_abril_mai_junh_julhet_agost_setembre_octòbre_novembre_decembre".split("_"),format:"de genièr_de febrièr_de març_d'abril_de mai_de junh_de julhet_d'agost_de setembre_d'octòbre_de novembre_de decembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._març_abr._mai_junh_julh._ago._set._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"dimenge_diluns_dimars_dimècres_dijòus_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dm._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dm_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:"[uèi a] LT",nextDay:"[deman a] LT",nextWeek:"dddd [a] LT",lastDay:"[ièr a] LT",lastWeek:"dddd [passat a] LT",sameElse:"L"},relativeTime:{future:"d'aquí %s",past:"fa %s",s:"unas segondas",ss:"%d segondas",m:"una minuta",mm:"%d minutas",h:"una ora",hh:"%d oras",d:"un jorn",dd:"%d jorns",M:"un mes",MM:"%d meses",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t|è|a)/,ordinal:function(e,t){var a=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"è";return"w"!==t&&"W"!==t||(a="a"),e+a},week:{dow:1,doy:4}})}(a(43936))},14243:function(e,t,a){!function(e){"use strict";var t={1:"੧",2:"੨",3:"੩",4:"੪",5:"੫",6:"੬",7:"੭",8:"੮",9:"੯",0:"੦"},a={"੧":"1","੨":"2","੩":"3","੪":"4","੫":"5","੬":"6","੭":"7","੮":"8","੯":"9","੦":"0"};e.defineLocale("pa-in",{months:"ਜਨਵਰੀ_ਫ਼ਰਵਰੀ_ਮਾਰਚ_ਅਪ੍ਰੈਲ_ਮਈ_ਜੂਨ_ਜੁਲਾਈ_ਅਗਸਤ_ਸਤੰਬਰ_ਅਕਤੂਬਰ_ਨਵੰਬਰ_ਦਸੰਬਰ".split("_"),monthsShort:"ਜਨਵਰੀ_ਫ਼ਰਵਰੀ_ਮਾਰਚ_ਅਪ੍ਰੈਲ_ਮਈ_ਜੂਨ_ਜੁਲਾਈ_ਅਗਸਤ_ਸਤੰਬਰ_ਅਕਤੂਬਰ_ਨਵੰਬਰ_ਦਸੰਬਰ".split("_"),weekdays:"ਐਤਵਾਰ_ਸੋਮਵਾਰ_ਮੰਗਲਵਾਰ_ਬੁਧਵਾਰ_ਵੀਰਵਾਰ_ਸ਼ੁੱਕਰਵਾਰ_ਸ਼ਨੀਚਰਵਾਰ".split("_"),weekdaysShort:"ਐਤ_ਸੋਮ_ਮੰਗਲ_ਬੁਧ_ਵੀਰ_ਸ਼ੁਕਰ_ਸ਼ਨੀ".split("_"),weekdaysMin:"ਐਤ_ਸੋਮ_ਮੰਗਲ_ਬੁਧ_ਵੀਰ_ਸ਼ੁਕਰ_ਸ਼ਨੀ".split("_"),longDateFormat:{LT:"A h:mm ਵਜੇ",LTS:"A h:mm:ss ਵਜੇ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ਵਜੇ",LLLL:"dddd, D MMMM YYYY, A h:mm ਵਜੇ"},calendar:{sameDay:"[ਅਜ] LT",nextDay:"[ਕਲ] LT",nextWeek:"[ਅਗਲਾ] dddd, LT",lastDay:"[ਕਲ] LT",lastWeek:"[ਪਿਛਲੇ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ਵਿੱਚ",past:"%s ਪਿਛਲੇ",s:"ਕੁਝ ਸਕਿੰਟ",ss:"%d ਸਕਿੰਟ",m:"ਇਕ ਮਿੰਟ",mm:"%d ਮਿੰਟ",h:"ਇੱਕ ਘੰਟਾ",hh:"%d ਘੰਟੇ",d:"ਇੱਕ ਦਿਨ",dd:"%d ਦਿਨ",M:"ਇੱਕ ਮਹੀਨਾ",MM:"%d ਮਹੀਨੇ",y:"ਇੱਕ ਸਾਲ",yy:"%d ਸਾਲ"},preparse:function(e){return e.replace(/[੧੨੩੪੫੬੭੮੯੦]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/ਰਾਤ|ਸਵੇਰ|ਦੁਪਹਿਰ|ਸ਼ਾਮ/,meridiemHour:function(e,t){return 12===e&&(e=0),"ਰਾਤ"===t?e<4?e:e+12:"ਸਵੇਰ"===t?e:"ਦੁਪਹਿਰ"===t?e>=10?e:e+12:"ਸ਼ਾਮ"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"ਰਾਤ":e<10?"ਸਵੇਰ":e<17?"ਦੁਪਹਿਰ":e<20?"ਸ਼ਾਮ":"ਰਾਤ"},week:{dow:0,doy:6}})}(a(43936))},16928:function(e,t,a){!function(e){"use strict";var t="styczeń_luty_marzec_kwiecień_maj_czerwiec_lipiec_sierpień_wrzesień_październik_listopad_grudzień".split("_"),a="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_września_października_listopada_grudnia".split("_"),i=[/^sty/i,/^lut/i,/^mar/i,/^kwi/i,/^maj/i,/^cze/i,/^lip/i,/^sie/i,/^wrz/i,/^paź/i,/^lis/i,/^gru/i];function s(e){return e%10<5&&e%10>1&&~~(e/10)%10!=1}function r(e,t,a){var i=e+" ";switch(a){case"ss":return i+(s(e)?"sekundy":"sekund");case"m":return t?"minuta":"minutę";case"mm":return i+(s(e)?"minuty":"minut");case"h":return t?"godzina":"godzinę";case"hh":return i+(s(e)?"godziny":"godzin");case"ww":return i+(s(e)?"tygodnie":"tygodni");case"MM":return i+(s(e)?"miesiące":"miesięcy");case"yy":return i+(s(e)?"lata":"lat")}}e.defineLocale("pl",{months:function(e,i){return e?/D MMMM/.test(i)?a[e.month()]:t[e.month()]:t},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_paź_lis_gru".split("_"),monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"niedziela_poniedziałek_wtorek_środa_czwartek_piątek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_śr_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_Śr_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dziś o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedzielę o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W środę o] LT";case 6:return"[W sobotę o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zeszłą niedzielę o] LT";case 3:return"[W zeszłą środę o] LT";case 6:return"[W zeszłą sobotę o] LT";default:return"[W zeszły] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:r,m:r,mm:r,h:r,hh:r,d:"1 dzień",dd:"%d dni",w:"tydzień",ww:r,M:"miesiąc",MM:r,y:"rok",yy:r},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},80952:function(e,t,a){!function(e){"use strict";e.defineLocale("pt-br",{months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_terça-feira_quarta-feira_quinta-feira_sexta-feira_sábado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sáb".split("_"),weekdaysMin:"do_2ª_3ª_4ª_5ª_6ª_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [às] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [às] HH:mm"},calendar:{sameDay:"[Hoje às] LT",nextDay:"[Amanhã às] LT",nextWeek:"dddd [às] LT",lastDay:"[Ontem às] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[Último] dddd [às] LT":"[Última] dddd [às] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"há %s",s:"poucos segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",invalidDate:"Data inválida"})}(a(43936))},83992:function(e,t,a){!function(e){"use strict";e.defineLocale("pt",{months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"Domingo_Segunda-feira_Terça-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sábado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sáb".split("_"),weekdaysMin:"Do_2ª_3ª_4ª_5ª_6ª_Sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY HH:mm"},calendar:{sameDay:"[Hoje às] LT",nextDay:"[Amanhã às] LT",nextWeek:"dddd [às] LT",lastDay:"[Ontem às] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[Último] dddd [às] LT":"[Última] dddd [às] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"há %s",s:"segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",w:"uma semana",ww:"%d semanas",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})}(a(43936))},43464:function(e,t,a){!function(e){"use strict";function t(e,t,a){var i=" ";return(e%100>=20||e>=100&&e%100==0)&&(i=" de "),e+i+{ss:"secunde",mm:"minute",hh:"ore",dd:"zile",ww:"săptămâni",MM:"luni",yy:"ani"}[a]}e.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._feb._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"duminică_luni_marți_miercuri_joi_vineri_sâmbătă".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sâm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_Sâ".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mâine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s în urmă",s:"câteva secunde",ss:t,m:"un minut",mm:t,h:"o oră",hh:t,d:"o zi",dd:t,w:"o săptămână",ww:t,M:"o lună",MM:t,y:"un an",yy:t},week:{dow:1,doy:7}})}(a(43936))},8012:function(e,t,a){!function(e){"use strict";function t(e,t){var a=e.split("_");return t%10==1&&t%100!=11?a[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?a[1]:a[2]}function a(e,a,i){return"m"===i?a?"минута":"минуту":e+" "+t({ss:a?"секунда_секунды_секунд":"секунду_секунды_секунд",mm:a?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",ww:"неделя_недели_недель",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[i],+e)}var i=[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i];e.defineLocale("ru",{months:{format:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),standalone:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_")},monthsShort:{format:"янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),standalone:"янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_")},weekdays:{standalone:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),format:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_"),isFormat:/\[ ?[Вв] ?(?:прошлую|следующую|эту)? ?] ?dddd/},weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:i,longMonthsParse:i,shortMonthsParse:i,monthsRegex:/^(январ[ья]|янв\.?|феврал[ья]|февр?\.?|марта?|мар\.?|апрел[ья]|апр\.?|ма[йя]|июн[ья]|июн\.?|июл[ья]|июл\.?|августа?|авг\.?|сентябр[ья]|сент?\.?|октябр[ья]|окт\.?|ноябр[ья]|нояб?\.?|декабр[ья]|дек\.?)/i,monthsShortRegex:/^(январ[ья]|янв\.?|феврал[ья]|февр?\.?|марта?|мар\.?|апрел[ья]|апр\.?|ма[йя]|июн[ья]|июн\.?|июл[ья]|июл\.?|августа?|авг\.?|сентябр[ья]|сент?\.?|октябр[ья]|окт\.?|ноябр[ья]|нояб?\.?|декабр[ья]|дек\.?)/i,monthsStrictRegex:/^(январ[яь]|феврал[яь]|марта?|апрел[яь]|ма[яй]|июн[яь]|июл[яь]|августа?|сентябр[яь]|октябр[яь]|ноябр[яь]|декабр[яь])/i,monthsShortStrictRegex:/^(янв\.|февр?\.|мар[т.]|апр\.|ма[яй]|июн[ья.]|июл[ья.]|авг\.|сент?\.|окт\.|нояб?\.|дек\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},calendar:{sameDay:"[Сегодня, в] LT",nextDay:"[Завтра, в] LT",lastDay:"[Вчера, в] LT",nextWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[Во] dddd, [в] LT":"[В] dddd, [в] LT";switch(this.day()){case 0:return"[В следующее] dddd, [в] LT";case 1:case 2:case 4:return"[В следующий] dddd, [в] LT";case 3:case 5:case 6:return"[В следующую] dddd, [в] LT"}},lastWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[Во] dddd, [в] LT":"[В] dddd, [в] LT";switch(this.day()){case 0:return"[В прошлое] dddd, [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd, [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd, [в] LT"}},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",ss:a,m:a,mm:a,h:"час",hh:a,d:"день",dd:a,w:"неделя",ww:a,M:"месяц",MM:a,y:"год",yy:a},meridiemParse:/ночи|утра|дня|вечера/i,isPM:function(e){return/^(дня|вечера)$/.test(e)},meridiem:function(e,t,a){return e<4?"ночи":e<12?"утра":e<17?"дня":"вечера"},dayOfMonthOrdinalParse:/\d{1,2}-(й|го|я)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-й";case"D":return e+"-го";case"w":case"W":return e+"-я";default:return e}},week:{dow:1,doy:4}})}(a(43936))},27311:function(e,t,a){!function(e){"use strict";var t=["جنوري","فيبروري","مارچ","اپريل","مئي","جون","جولاءِ","آگسٽ","سيپٽمبر","آڪٽوبر","نومبر","ڊسمبر"],a=["آچر","سومر","اڱارو","اربع","خميس","جمع","ڇنڇر"];e.defineLocale("sd",{months:t,monthsShort:t,weekdays:a,weekdaysShort:a,weekdaysMin:a,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd، D MMMM YYYY HH:mm"},meridiemParse:/صبح|شام/,isPM:function(e){return"شام"===e},meridiem:function(e,t,a){return e<12?"صبح":"شام"},calendar:{sameDay:"[اڄ] LT",nextDay:"[سڀاڻي] LT",nextWeek:"dddd [اڳين هفتي تي] LT",lastDay:"[ڪالهه] LT",lastWeek:"[گزريل هفتي] dddd [تي] LT",sameElse:"L"},relativeTime:{future:"%s پوء",past:"%s اڳ",s:"چند سيڪنڊ",ss:"%d سيڪنڊ",m:"هڪ منٽ",mm:"%d منٽ",h:"هڪ ڪلاڪ",hh:"%d ڪلاڪ",d:"هڪ ڏينهن",dd:"%d ڏينهن",M:"هڪ مهينو",MM:"%d مهينا",y:"هڪ سال",yy:"%d سال"},preparse:function(e){return e.replace(/،/g,",")},postformat:function(e){return e.replace(/,/g,"،")},week:{dow:1,doy:4}})}(a(43936))},49976:function(e,t,a){!function(e){"use strict";e.defineLocale("se",{months:"ođđajagemánnu_guovvamánnu_njukčamánnu_cuoŋománnu_miessemánnu_geassemánnu_suoidnemánnu_borgemánnu_čakčamánnu_golggotmánnu_skábmamánnu_juovlamánnu".split("_"),monthsShort:"ođđj_guov_njuk_cuo_mies_geas_suoi_borg_čakč_golg_skáb_juov".split("_"),weekdays:"sotnabeaivi_vuossárga_maŋŋebárga_gaskavahkku_duorastat_bearjadat_lávvardat".split("_"),weekdaysShort:"sotn_vuos_maŋ_gask_duor_bear_láv".split("_"),weekdaysMin:"s_v_m_g_d_b_L".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"MMMM D. [b.] YYYY",LLL:"MMMM D. [b.] YYYY [ti.] HH:mm",LLLL:"dddd, MMMM D. [b.] YYYY [ti.] HH:mm"},calendar:{sameDay:"[otne ti] LT",nextDay:"[ihttin ti] LT",nextWeek:"dddd [ti] LT",lastDay:"[ikte ti] LT",lastWeek:"[ovddit] dddd [ti] LT",sameElse:"L"},relativeTime:{future:"%s geažes",past:"maŋit %s",s:"moadde sekunddat",ss:"%d sekunddat",m:"okta minuhta",mm:"%d minuhtat",h:"okta diimmu",hh:"%d diimmut",d:"okta beaivi",dd:"%d beaivvit",M:"okta mánnu",MM:"%d mánut",y:"okta jahki",yy:"%d jagit"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},46416:function(e,t,a){!function(e){"use strict";e.defineLocale("si",{months:"ජනවාරි_පෙබරවාරි_මාර්තු_අප්‍රේල්_මැයි_ජූනි_ජූලි_අගෝස්තු_සැප්තැම්බර්_ඔක්තෝබර්_නොවැම්බර්_දෙසැම්බර්".split("_"),monthsShort:"ජන_පෙබ_මාර්_අප්_මැයි_ජූනි_ජූලි_අගෝ_සැප්_ඔක්_නොවැ_දෙසැ".split("_"),weekdays:"ඉරිදා_සඳුදා_අඟහරුවාදා_බදාදා_බ්‍රහස්පතින්දා_සිකුරාදා_සෙනසුරාදා".split("_"),weekdaysShort:"ඉරි_සඳු_අඟ_බදා_බ්‍රහ_සිකු_සෙන".split("_"),weekdaysMin:"ඉ_ස_අ_බ_බ්‍ර_සි_සෙ".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, a h:mm",LLLL:"YYYY MMMM D [වැනි] dddd, a h:mm:ss"},calendar:{sameDay:"[අද] LT[ට]",nextDay:"[හෙට] LT[ට]",nextWeek:"dddd LT[ට]",lastDay:"[ඊයේ] LT[ට]",lastWeek:"[පසුගිය] dddd LT[ට]",sameElse:"L"},relativeTime:{future:"%sකින්",past:"%sකට පෙර",s:"තත්පර කිහිපය",ss:"තත්පර %d",m:"මිනිත්තුව",mm:"මිනිත්තු %d",h:"පැය",hh:"පැය %d",d:"දිනය",dd:"දින %d",M:"මාසය",MM:"මාස %d",y:"වසර",yy:"වසර %d"},dayOfMonthOrdinalParse:/\d{1,2} වැනි/,ordinal:function(e){return e+" වැනි"},meridiemParse:/පෙර වරු|පස් වරු|පෙ.ව|ප.ව./,isPM:function(e){return"ප.ව."===e||"පස් වරු"===e},meridiem:function(e,t,a){return e>11?a?"ප.ව.":"පස් වරු":a?"පෙ.ව.":"පෙර වරු"}})}(a(43936))},18784:function(e,t,a){!function(e){"use strict";var t="január_február_marec_apríl_máj_jún_júl_august_september_október_november_december".split("_"),a="jan_feb_mar_apr_máj_jún_júl_aug_sep_okt_nov_dec".split("_");function i(e){return e>1&&e<5}function s(e,t,a,s){var r=e+" ";switch(a){case"s":return t||s?"pár sekúnd":"pár sekundami";case"ss":return t||s?r+(i(e)?"sekundy":"sekúnd"):r+"sekundami";case"m":return t?"minúta":s?"minútu":"minútou";case"mm":return t||s?r+(i(e)?"minúty":"minút"):r+"minútami";case"h":return t?"hodina":s?"hodinu":"hodinou";case"hh":return t||s?r+(i(e)?"hodiny":"hodín"):r+"hodinami";case"d":return t||s?"deň":"dňom";case"dd":return t||s?r+(i(e)?"dni":"dní"):r+"dňami";case"M":return t||s?"mesiac":"mesiacom";case"MM":return t||s?r+(i(e)?"mesiace":"mesiacov"):r+"mesiacmi";case"y":return t||s?"rok":"rokom";case"yy":return t||s?r+(i(e)?"roky":"rokov"):r+"rokmi"}}e.defineLocale("sk",{months:t,monthsShort:a,weekdays:"nedeľa_pondelok_utorok_streda_štvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_št_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_št_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeľu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo štvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[včera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulú nedeľu o] LT";case 1:case 2:case 4:case 5:return"[minulý] dddd [o] LT";case 3:return"[minulú stredu o] LT";case 6:return"[minulú sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s,ss:s,m:s,mm:s,h:s,hh:s,d:s,dd:s,M:s,MM:s,y:s,yy:s},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},87400:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s=e+" ";switch(a){case"s":return t||i?"nekaj sekund":"nekaj sekundami";case"ss":return s+=1===e?t?"sekundo":"sekundi":2===e?t||i?"sekundi":"sekundah":e<5?t||i?"sekunde":"sekundah":"sekund";case"m":return t?"ena minuta":"eno minuto";case"mm":return s+=1===e?t?"minuta":"minuto":2===e?t||i?"minuti":"minutama":e<5?t||i?"minute":"minutami":t||i?"minut":"minutami";case"h":return t?"ena ura":"eno uro";case"hh":return s+=1===e?t?"ura":"uro":2===e?t||i?"uri":"urama":e<5?t||i?"ure":"urami":t||i?"ur":"urami";case"d":return t||i?"en dan":"enim dnem";case"dd":return s+=1===e?t||i?"dan":"dnem":2===e?t||i?"dni":"dnevoma":t||i?"dni":"dnevi";case"M":return t||i?"en mesec":"enim mesecem";case"MM":return s+=1===e?t||i?"mesec":"mesecem":2===e?t||i?"meseca":"mesecema":e<5?t||i?"mesece":"meseci":t||i?"mesecev":"meseci";case"y":return t||i?"eno leto":"enim letom";case"yy":return s+=1===e?t||i?"leto":"letom":2===e?t||i?"leti":"letoma":e<5?t||i?"leta":"leti":t||i?"let":"leti"}}e.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljek_torek_sreda_četrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._čet._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_če_pe_so".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[včeraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prejšnjo] [nedeljo] [ob] LT";case 3:return"[prejšnjo] [sredo] [ob] LT";case 6:return"[prejšnjo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prejšnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"čez %s",past:"pred %s",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},40020:function(e,t,a){!function(e){"use strict";e.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nëntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nën_Dhj".split("_"),weekdays:"E Diel_E Hënë_E Martë_E Mërkurë_E Enjte_E Premte_E Shtunë".split("_"),weekdaysShort:"Die_Hën_Mar_Mër_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_Më_E_P_Sh".split("_"),weekdaysParseExact:!0,meridiemParse:/PD|MD/,isPM:function(e){return"M"===e.charAt(0)},meridiem:function(e,t,a){return e<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Sot në] LT",nextDay:"[Nesër në] LT",nextWeek:"dddd [në] LT",lastDay:"[Dje në] LT",lastWeek:"dddd [e kaluar në] LT",sameElse:"L"},relativeTime:{future:"në %s",past:"%s më parë",s:"disa sekonda",ss:"%d sekonda",m:"një minutë",mm:"%d minuta",h:"një orë",hh:"%d orë",d:"një ditë",dd:"%d ditë",M:"një muaj",MM:"%d muaj",y:"një vit",yy:"%d vite"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},8296:function(e,t,a){!function(e){"use strict";var t={words:{ss:["секунда","секунде","секунди"],m:["један минут","једног минута"],mm:["минут","минута","минута"],h:["један сат","једног сата"],hh:["сат","сата","сати"],d:["један дан","једног дана"],dd:["дан","дана","дана"],M:["један месец","једног месеца"],MM:["месец","месеца","месеци"],y:["једну годину","једне године"],yy:["годину","године","година"]},correctGrammaticalCase:function(e,t){return e%10>=1&&e%10<=4&&(e%100<10||e%100>=20)?e%10==1?t[0]:t[1]:t[2]},translate:function(e,a,i,s){var r,l=t.words[i];return 1===i.length?"y"===i&&a?"једна година":s||a?l[0]:l[1]:(r=t.correctGrammaticalCase(e,l),"yy"===i&&a&&"годину"===r?e+" година":e+" "+r)}};e.defineLocale("sr-cyrl",{months:"јануар_фебруар_март_април_мај_јун_јул_август_септембар_октобар_новембар_децембар".split("_"),monthsShort:"јан._феб._мар._апр._мај_јун_јул_авг._сеп._окт._нов._дец.".split("_"),monthsParseExact:!0,weekdays:"недеља_понедељак_уторак_среда_четвртак_петак_субота".split("_"),weekdaysShort:"нед._пон._уто._сре._чет._пет._суб.".split("_"),weekdaysMin:"не_по_ут_ср_че_пе_су".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[данас у] LT",nextDay:"[сутра у] LT",nextWeek:function(){switch(this.day()){case 0:return"[у] [недељу] [у] LT";case 3:return"[у] [среду] [у] LT";case 6:return"[у] [суботу] [у] LT";case 1:case 2:case 4:case 5:return"[у] dddd [у] LT"}},lastDay:"[јуче у] LT",lastWeek:function(){return["[прошле] [недеље] [у] LT","[прошлог] [понедељка] [у] LT","[прошлог] [уторка] [у] LT","[прошле] [среде] [у] LT","[прошлог] [четвртка] [у] LT","[прошлог] [петка] [у] LT","[прошле] [суботе] [у] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"за %s",past:"пре %s",s:"неколико секунди",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:t.translate,dd:t.translate,M:t.translate,MM:t.translate,y:t.translate,yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},27952:function(e,t,a){!function(e){"use strict";var t={words:{ss:["sekunda","sekunde","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],d:["jedan dan","jednog dana"],dd:["dan","dana","dana"],M:["jedan mesec","jednog meseca"],MM:["mesec","meseca","meseci"],y:["jednu godinu","jedne godine"],yy:["godinu","godine","godina"]},correctGrammaticalCase:function(e,t){return e%10>=1&&e%10<=4&&(e%100<10||e%100>=20)?e%10==1?t[0]:t[1]:t[2]},translate:function(e,a,i,s){var r,l=t.words[i];return 1===i.length?"y"===i&&a?"jedna godina":s||a?l[0]:l[1]:(r=t.correctGrammaticalCase(e,l),"yy"===i&&a&&"godinu"===r?e+" godina":e+" "+r)}};e.defineLocale("sr",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljak_utorak_sreda_četvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._čet._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_če_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juče u] LT",lastWeek:function(){return["[prošle] [nedelje] [u] LT","[prošlog] [ponedeljka] [u] LT","[prošlog] [utorka] [u] LT","[prošle] [srede] [u] LT","[prošlog] [četvrtka] [u] LT","[prošlog] [petka] [u] LT","[prošle] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:t.translate,dd:t.translate,M:t.translate,MM:t.translate,y:t.translate,yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(a(43936))},38240:function(e,t,a){!function(e){"use strict";e.defineLocale("ss",{months:"Bhimbidvwane_Indlovana_Indlov'lenkhulu_Mabasa_Inkhwekhweti_Inhlaba_Kholwane_Ingci_Inyoni_Imphala_Lweti_Ingongoni".split("_"),monthsShort:"Bhi_Ina_Inu_Mab_Ink_Inh_Kho_Igc_Iny_Imp_Lwe_Igo".split("_"),weekdays:"Lisontfo_Umsombuluko_Lesibili_Lesitsatfu_Lesine_Lesihlanu_Umgcibelo".split("_"),weekdaysShort:"Lis_Umb_Lsb_Les_Lsi_Lsh_Umg".split("_"),weekdaysMin:"Li_Us_Lb_Lt_Ls_Lh_Ug".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Namuhla nga] LT",nextDay:"[Kusasa nga] LT",nextWeek:"dddd [nga] LT",lastDay:"[Itolo nga] LT",lastWeek:"dddd [leliphelile] [nga] LT",sameElse:"L"},relativeTime:{future:"nga %s",past:"wenteka nga %s",s:"emizuzwana lomcane",ss:"%d mzuzwana",m:"umzuzu",mm:"%d emizuzu",h:"lihora",hh:"%d emahora",d:"lilanga",dd:"%d emalanga",M:"inyanga",MM:"%d tinyanga",y:"umnyaka",yy:"%d iminyaka"},meridiemParse:/ekuseni|emini|entsambama|ebusuku/,meridiem:function(e,t,a){return e<11?"ekuseni":e<15?"emini":e<19?"entsambama":"ebusuku"},meridiemHour:function(e,t){return 12===e&&(e=0),"ekuseni"===t?e:"emini"===t?e>=11?e:e+12:"entsambama"===t||"ebusuku"===t?0===e?0:e+12:void 0},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(a(43936))},7660:function(e,t,a){!function(e){"use strict";e.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"söndag_måndag_tisdag_onsdag_torsdag_fredag_lördag".split("_"),weekdaysShort:"sön_mån_tis_ons_tor_fre_lör".split("_"),weekdaysMin:"sö_må_ti_on_to_fr_lö".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [kl.] HH:mm",LLLL:"dddd D MMMM YYYY [kl.] HH:mm",lll:"D MMM YYYY HH:mm",llll:"ddd D MMM YYYY HH:mm"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igår] LT",nextWeek:"[På] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"för %s sedan",s:"några sekunder",ss:"%d sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en månad",MM:"%d månader",y:"ett år",yy:"%d år"},dayOfMonthOrdinalParse:/\d{1,2}(\:e|\:a)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?":e":1===t||2===t?":a":":e")},week:{dow:1,doy:4}})}(a(43936))},42948:function(e,t,a){!function(e){"use strict";e.defineLocale("sw",{months:"Januari_Februari_Machi_Aprili_Mei_Juni_Julai_Agosti_Septemba_Oktoba_Novemba_Desemba".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ago_Sep_Okt_Nov_Des".split("_"),weekdays:"Jumapili_Jumatatu_Jumanne_Jumatano_Alhamisi_Ijumaa_Jumamosi".split("_"),weekdaysShort:"Jpl_Jtat_Jnne_Jtan_Alh_Ijm_Jmos".split("_"),weekdaysMin:"J2_J3_J4_J5_Al_Ij_J1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"hh:mm A",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[leo saa] LT",nextDay:"[kesho saa] LT",nextWeek:"[wiki ijayo] dddd [saat] LT",lastDay:"[jana] LT",lastWeek:"[wiki iliyopita] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s baadaye",past:"tokea %s",s:"hivi punde",ss:"sekunde %d",m:"dakika moja",mm:"dakika %d",h:"saa limoja",hh:"masaa %d",d:"siku moja",dd:"siku %d",M:"mwezi mmoja",MM:"miezi %d",y:"mwaka mmoja",yy:"miaka %d"},week:{dow:1,doy:7}})}(a(43936))},8456:function(e,t,a){!function(e){"use strict";var t={1:"௧",2:"௨",3:"௩",4:"௪",5:"௫",6:"௬",7:"௭",8:"௮",9:"௯",0:"௦"},a={"௧":"1","௨":"2","௩":"3","௪":"4","௫":"5","௬":"6","௭":"7","௮":"8","௯":"9","௦":"0"};e.defineLocale("ta",{months:"ஜனவரி_பிப்ரவரி_மார்ச்_ஏப்ரல்_மே_ஜூன்_ஜூலை_ஆகஸ்ட்_செப்டெம்பர்_அக்டோபர்_நவம்பர்_டிசம்பர்".split("_"),monthsShort:"ஜனவரி_பிப்ரவரி_மார்ச்_ஏப்ரல்_மே_ஜூன்_ஜூலை_ஆகஸ்ட்_செப்டெம்பர்_அக்டோபர்_நவம்பர்_டிசம்பர்".split("_"),weekdays:"ஞாயிற்றுக்கிழமை_திங்கட்கிழமை_செவ்வாய்கிழமை_புதன்கிழமை_வியாழக்கிழமை_வெள்ளிக்கிழமை_சனிக்கிழமை".split("_"),weekdaysShort:"ஞாயிறு_திங்கள்_செவ்வாய்_புதன்_வியாழன்_வெள்ளி_சனி".split("_"),weekdaysMin:"ஞா_தி_செ_பு_வி_வெ_ச".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, HH:mm",LLLL:"dddd, D MMMM YYYY, HH:mm"},calendar:{sameDay:"[இன்று] LT",nextDay:"[நாளை] LT",nextWeek:"dddd, LT",lastDay:"[நேற்று] LT",lastWeek:"[கடந்த வாரம்] dddd, LT",sameElse:"L"},relativeTime:{future:"%s இல்",past:"%s முன்",s:"ஒரு சில விநாடிகள்",ss:"%d விநாடிகள்",m:"ஒரு நிமிடம்",mm:"%d நிமிடங்கள்",h:"ஒரு மணி நேரம்",hh:"%d மணி நேரம்",d:"ஒரு நாள்",dd:"%d நாட்கள்",M:"ஒரு மாதம்",MM:"%d மாதங்கள்",y:"ஒரு வருடம்",yy:"%d ஆண்டுகள்"},dayOfMonthOrdinalParse:/\d{1,2}வது/,ordinal:function(e){return e+"வது"},preparse:function(e){return e.replace(/[௧௨௩௪௫௬௭௮௯௦]/g,(function(e){return a[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/யாமம்|வைகறை|காலை|நண்பகல்|எற்பாடு|மாலை/,meridiem:function(e,t,a){return e<2?" யாமம்":e<6?" வைகறை":e<10?" காலை":e<14?" நண்பகல்":e<18?" எற்பாடு":e<22?" மாலை":" யாமம்"},meridiemHour:function(e,t){return 12===e&&(e=0),"யாமம்"===t?e<2?e:e+12:"வைகறை"===t||"காலை"===t||"நண்பகல்"===t&&e>=10?e:e+12},week:{dow:0,doy:6}})}(a(43936))},27636:function(e,t,a){!function(e){"use strict";e.defineLocale("te",{months:"జనవరి_ఫిబ్రవరి_మార్చి_ఏప్రిల్_మే_జూన్_జులై_ఆగస్టు_సెప్టెంబర్_అక్టోబర్_నవంబర్_డిసెంబర్".split("_"),monthsShort:"జన._ఫిబ్ర._మార్చి_ఏప్రి._మే_జూన్_జులై_ఆగ._సెప్._అక్టో._నవ._డిసె.".split("_"),monthsParseExact:!0,weekdays:"ఆదివారం_సోమవారం_మంగళవారం_బుధవారం_గురువారం_శుక్రవారం_శనివారం".split("_"),weekdaysShort:"ఆది_సోమ_మంగళ_బుధ_గురు_శుక్ర_శని".split("_"),weekdaysMin:"ఆ_సో_మం_బు_గు_శు_శ".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[నేడు] LT",nextDay:"[రేపు] LT",nextWeek:"dddd, LT",lastDay:"[నిన్న] LT",lastWeek:"[గత] dddd, LT",sameElse:"L"},relativeTime:{future:"%s లో",past:"%s క్రితం",s:"కొన్ని క్షణాలు",ss:"%d సెకన్లు",m:"ఒక నిమిషం",mm:"%d నిమిషాలు",h:"ఒక గంట",hh:"%d గంటలు",d:"ఒక రోజు",dd:"%d రోజులు",M:"ఒక నెల",MM:"%d నెలలు",y:"ఒక సంవత్సరం",yy:"%d సంవత్సరాలు"},dayOfMonthOrdinalParse:/\d{1,2}వ/,ordinal:"%dవ",meridiemParse:/రాత్రి|ఉదయం|మధ్యాహ్నం|సాయంత్రం/,meridiemHour:function(e,t){return 12===e&&(e=0),"రాత్రి"===t?e<4?e:e+12:"ఉదయం"===t?e:"మధ్యాహ్నం"===t?e>=10?e:e+12:"సాయంత్రం"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"రాత్రి":e<10?"ఉదయం":e<17?"మధ్యాహ్నం":e<20?"సాయంత్రం":"రాత్రి"},week:{dow:0,doy:6}})}(a(43936))},62376:function(e,t,a){!function(e){"use strict";e.defineLocale("tet",{months:"Janeiru_Fevereiru_Marsu_Abril_Maiu_Juñu_Jullu_Agustu_Setembru_Outubru_Novembru_Dezembru".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingu_Segunda_Tersa_Kuarta_Kinta_Sesta_Sabadu".split("_"),weekdaysShort:"Dom_Seg_Ters_Kua_Kint_Sest_Sab".split("_"),weekdaysMin:"Do_Seg_Te_Ku_Ki_Ses_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Ohin iha] LT",nextDay:"[Aban iha] LT",nextWeek:"dddd [iha] LT",lastDay:"[Horiseik iha] LT",lastWeek:"dddd [semana kotuk] [iha] LT",sameElse:"L"},relativeTime:{future:"iha %s",past:"%s liuba",s:"segundu balun",ss:"segundu %d",m:"minutu ida",mm:"minutu %d",h:"oras ida",hh:"oras %d",d:"loron ida",dd:"loron %d",M:"fulan ida",MM:"fulan %d",y:"tinan ida",yy:"tinan %d"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(a(43936))},8576:function(e,t,a){!function(e){"use strict";var t={0:"-ум",1:"-ум",2:"-юм",3:"-юм",4:"-ум",5:"-ум",6:"-ум",7:"-ум",8:"-ум",9:"-ум",10:"-ум",12:"-ум",13:"-ум",20:"-ум",30:"-юм",40:"-ум",50:"-ум",60:"-ум",70:"-ум",80:"-ум",90:"-ум",100:"-ум"};e.defineLocale("tg",{months:{format:"январи_феврали_марти_апрели_майи_июни_июли_августи_сентябри_октябри_ноябри_декабри".split("_"),standalone:"январ_феврал_март_апрел_май_июн_июл_август_сентябр_октябр_ноябр_декабр".split("_")},monthsShort:"янв_фев_мар_апр_май_июн_июл_авг_сен_окт_ноя_дек".split("_"),weekdays:"якшанбе_душанбе_сешанбе_чоршанбе_панҷшанбе_ҷумъа_шанбе".split("_"),weekdaysShort:"яшб_дшб_сшб_чшб_пшб_ҷум_шнб".split("_"),weekdaysMin:"яш_дш_сш_чш_пш_ҷм_шб".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Имрӯз соати] LT",nextDay:"[Фардо соати] LT",lastDay:"[Дирӯз соати] LT",nextWeek:"dddd[и] [ҳафтаи оянда соати] LT",lastWeek:"dddd[и] [ҳафтаи гузашта соати] LT",sameElse:"L"},relativeTime:{future:"баъди %s",past:"%s пеш",s:"якчанд сония",m:"як дақиқа",mm:"%d дақиқа",h:"як соат",hh:"%d соат",d:"як рӯз",dd:"%d рӯз",M:"як моҳ",MM:"%d моҳ",y:"як сол",yy:"%d сол"},meridiemParse:/шаб|субҳ|рӯз|бегоҳ/,meridiemHour:function(e,t){return 12===e&&(e=0),"шаб"===t?e<4?e:e+12:"субҳ"===t?e:"рӯз"===t?e>=11?e:e+12:"бегоҳ"===t?e+12:void 0},meridiem:function(e,t,a){return e<4?"шаб":e<11?"субҳ":e<16?"рӯз":e<19?"бегоҳ":"шаб"},dayOfMonthOrdinalParse:/\d{1,2}-(ум|юм)/,ordinal:function(e){var a=e%10,i=e>=100?100:null;return e+(t[e]||t[a]||t[i])},week:{dow:1,doy:7}})}(a(43936))},8196:function(e,t,a){!function(e){"use strict";e.defineLocale("th",{months:"มกราคม_กุมภาพันธ์_มีนาคม_เมษายน_พฤษภาคม_มิถุนายน_กรกฎาคม_สิงหาคม_กันยายน_ตุลาคม_พฤศจิกายน_ธันวาคม".split("_"),monthsShort:"ม.ค._ก.พ._มี.ค._เม.ย._พ.ค._มิ.ย._ก.ค._ส.ค._ก.ย._ต.ค._พ.ย._ธ.ค.".split("_"),monthsParseExact:!0,weekdays:"อาทิตย์_จันทร์_อังคาร_พุธ_พฤหัสบดี_ศุกร์_เสาร์".split("_"),weekdaysShort:"อาทิตย์_จันทร์_อังคาร_พุธ_พฤหัส_ศุกร์_เสาร์".split("_"),weekdaysMin:"อา._จ._อ._พ._พฤ._ศ._ส.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY เวลา H:mm",LLLL:"วันddddที่ D MMMM YYYY เวลา H:mm"},meridiemParse:/ก่อนเที่ยง|หลังเที่ยง/,isPM:function(e){return"หลังเที่ยง"===e},meridiem:function(e,t,a){return e<12?"ก่อนเที่ยง":"หลังเที่ยง"},calendar:{sameDay:"[วันนี้ เวลา] LT",nextDay:"[พรุ่งนี้ เวลา] LT",nextWeek:"dddd[หน้า เวลา] LT",lastDay:"[เมื่อวานนี้ เวลา] LT",lastWeek:"[วัน]dddd[ที่แล้ว เวลา] LT",sameElse:"L"},relativeTime:{future:"อีก %s",past:"%sที่แล้ว",s:"ไม่กี่วินาที",ss:"%d วินาที",m:"1 นาที",mm:"%d นาที",h:"1 ชั่วโมง",hh:"%d ชั่วโมง",d:"1 วัน",dd:"%d วัน",w:"1 สัปดาห์",ww:"%d สัปดาห์",M:"1 เดือน",MM:"%d เดือน",y:"1 ปี",yy:"%d ปี"}})}(a(43936))},20015:function(e,t,a){!function(e){"use strict";var t={1:"'inji",5:"'inji",8:"'inji",70:"'inji",80:"'inji",2:"'nji",7:"'nji",20:"'nji",50:"'nji",3:"'ünji",4:"'ünji",100:"'ünji",6:"'njy",9:"'unjy",10:"'unjy",30:"'unjy",60:"'ynjy",90:"'ynjy"};e.defineLocale("tk",{months:"Ýanwar_Fewral_Mart_Aprel_Maý_Iýun_Iýul_Awgust_Sentýabr_Oktýabr_Noýabr_Dekabr".split("_"),monthsShort:"Ýan_Few_Mar_Apr_Maý_Iýn_Iýl_Awg_Sen_Okt_Noý_Dek".split("_"),weekdays:"Ýekşenbe_Duşenbe_Sişenbe_Çarşenbe_Penşenbe_Anna_Şenbe".split("_"),weekdaysShort:"Ýek_Duş_Siş_Çar_Pen_Ann_Şen".split("_"),weekdaysMin:"Ýk_Dş_Sş_Çr_Pn_An_Şn".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugün sagat] LT",nextDay:"[ertir sagat] LT",nextWeek:"[indiki] dddd [sagat] LT",lastDay:"[düýn] LT",lastWeek:"[geçen] dddd [sagat] LT",sameElse:"L"},relativeTime:{future:"%s soň",past:"%s öň",s:"birnäçe sekunt",m:"bir minut",mm:"%d minut",h:"bir sagat",hh:"%d sagat",d:"bir gün",dd:"%d gün",M:"bir aý",MM:"%d aý",y:"bir ýyl",yy:"%d ýyl"},ordinal:function(e,a){switch(a){case"d":case"D":case"Do":case"DD":return e;default:if(0===e)return e+"'unjy";var i=e%10,s=e%100-i,r=e>=100?100:null;return e+(t[i]||t[s]||t[r])}},week:{dow:1,doy:7}})}(a(43936))},41445:function(e,t,a){!function(e){"use strict";e.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(a(43936))},45420:function(e,t,a){!function(e){"use strict";var t="pagh_wa’_cha’_wej_loS_vagh_jav_Soch_chorgh_Hut".split("_");function a(e){var t=e;return t=-1!==e.indexOf("jaj")?t.slice(0,-3)+"leS":-1!==e.indexOf("jar")?t.slice(0,-3)+"waQ":-1!==e.indexOf("DIS")?t.slice(0,-3)+"nem":t+" pIq"}function i(e){var t=e;return t=-1!==e.indexOf("jaj")?t.slice(0,-3)+"Hu’":-1!==e.indexOf("jar")?t.slice(0,-3)+"wen":-1!==e.indexOf("DIS")?t.slice(0,-3)+"ben":t+" ret"}function s(e,t,a,i){var s=r(e);switch(a){case"ss":return s+" lup";case"mm":return s+" tup";case"hh":return s+" rep";case"dd":return s+" jaj";case"MM":return s+" jar";case"yy":return s+" DIS"}}function r(e){var a=Math.floor(e%1e3/100),i=Math.floor(e%100/10),s=e%10,r="";return a>0&&(r+=t[a]+"vatlh"),i>0&&(r+=(""!==r?" ":"")+t[i]+"maH"),s>0&&(r+=(""!==r?" ":"")+t[s]),""===r?"pagh":r}e.defineLocale("tlh",{months:"tera’ jar wa’_tera’ jar cha’_tera’ jar wej_tera’ jar loS_tera’ jar vagh_tera’ jar jav_tera’ jar Soch_tera’ jar chorgh_tera’ jar Hut_tera’ jar wa’maH_tera’ jar wa’maH wa’_tera’ jar wa’maH cha’".split("_"),monthsShort:"jar wa’_jar cha’_jar wej_jar loS_jar vagh_jar jav_jar Soch_jar chorgh_jar Hut_jar wa’maH_jar wa’maH wa’_jar wa’maH cha’".split("_"),monthsParseExact:!0,weekdays:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysShort:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysMin:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[DaHjaj] LT",nextDay:"[wa’leS] LT",nextWeek:"LLL",lastDay:"[wa’Hu’] LT",lastWeek:"LLL",sameElse:"L"},relativeTime:{future:a,past:i,s:"puS lup",ss:s,m:"wa’ tup",mm:s,h:"wa’ rep",hh:s,d:"wa’ jaj",dd:s,M:"wa’ jar",MM:s,y:"wa’ DIS",yy:s},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},65032:function(e,t,a){!function(e){"use strict";var t={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'üncü",4:"'üncü",100:"'üncü",6:"'ncı",9:"'uncu",10:"'uncu",30:"'uncu",60:"'ıncı",90:"'ıncı"};e.defineLocale("tr",{months:"Ocak_Şubat_Mart_Nisan_Mayıs_Haziran_Temmuz_Ağustos_Eylül_Ekim_Kasım_Aralık".split("_"),monthsShort:"Oca_Şub_Mar_Nis_May_Haz_Tem_Ağu_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Salı_Çarşamba_Perşembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pzt_Sal_Çar_Per_Cum_Cmt".split("_"),weekdaysMin:"Pz_Pt_Sa_Ça_Pe_Cu_Ct".split("_"),meridiem:function(e,t,a){return e<12?a?"öö":"ÖÖ":a?"ös":"ÖS"},meridiemParse:/öö|ÖÖ|ös|ÖS/,isPM:function(e){return"ös"===e||"ÖS"===e},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugün saat] LT",nextDay:"[yarın saat] LT",nextWeek:"[gelecek] dddd [saat] LT",lastDay:"[dün] LT",lastWeek:"[geçen] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s önce",s:"birkaç saniye",ss:"%d saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gün",dd:"%d gün",w:"bir hafta",ww:"%d hafta",M:"bir ay",MM:"%d ay",y:"bir yıl",yy:"%d yıl"},ordinal:function(e,a){switch(a){case"d":case"D":case"Do":case"DD":return e;default:if(0===e)return e+"'ıncı";var i=e%10,s=e%100-i,r=e>=100?100:null;return e+(t[i]||t[s]||t[r])}},week:{dow:1,doy:7}})}(a(43936))},67036:function(e,t,a){!function(e){"use strict";function t(e,t,a,i){var s={s:["viensas secunds","'iensas secunds"],ss:[e+" secunds",e+" secunds"],m:["'n míut","'iens míut"],mm:[e+" míuts",e+" míuts"],h:["'n þora","'iensa þora"],hh:[e+" þoras",e+" þoras"],d:["'n ziua","'iensa ziua"],dd:[e+" ziuas",e+" ziuas"],M:["'n mes","'iens mes"],MM:[e+" mesen",e+" mesen"],y:["'n ar","'iens ar"],yy:[e+" ars",e+" ars"]};return i||t?s[a][0]:s[a][1]}e.defineLocale("tzl",{months:"Januar_Fevraglh_Març_Avrïu_Mai_Gün_Julia_Guscht_Setemvar_Listopäts_Noemvar_Zecemvar".split("_"),monthsShort:"Jan_Fev_Mar_Avr_Mai_Gün_Jul_Gus_Set_Lis_Noe_Zec".split("_"),weekdays:"Súladi_Lúneçi_Maitzi_Márcuri_Xhúadi_Viénerçi_Sáturi".split("_"),weekdaysShort:"Súl_Lún_Mai_Már_Xhú_Vié_Sát".split("_"),weekdaysMin:"Sú_Lú_Ma_Má_Xh_Vi_Sá".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"D. MMMM [dallas] YYYY",LLL:"D. MMMM [dallas] YYYY HH.mm",LLLL:"dddd, [li] D. MMMM [dallas] YYYY HH.mm"},meridiemParse:/d\'o|d\'a/i,isPM:function(e){return"d'o"===e.toLowerCase()},meridiem:function(e,t,a){return e>11?a?"d'o":"D'O":a?"d'a":"D'A"},calendar:{sameDay:"[oxhi à] LT",nextDay:"[demà à] LT",nextWeek:"dddd [à] LT",lastDay:"[ieiri à] LT",lastWeek:"[sür el] dddd [lasteu à] LT",sameElse:"L"},relativeTime:{future:"osprei %s",past:"ja%s",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(a(43936))},87892:function(e,t,a){!function(e){"use strict";e.defineLocale("tzm-latn",{months:"innayr_brˤayrˤ_marˤsˤ_ibrir_mayyw_ywnyw_ywlywz_ɣwšt_šwtanbir_ktˤwbrˤ_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brˤayrˤ_marˤsˤ_ibrir_mayyw_ywnyw_ywlywz_ɣwšt_šwtanbir_ktˤwbrˤ_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiḍyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiḍyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiḍyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",ss:"%d imik",m:"minuḍ",mm:"%d minuḍ",h:"saɛa",hh:"%d tassaɛin",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}(a(43936))},2924:function(e,t,a){!function(e){"use strict";e.defineLocale("tzm",{months:"ⵉⵏⵏⴰⵢⵔ_ⴱⵕⴰⵢⵕ_ⵎⴰⵕⵚ_ⵉⴱⵔⵉⵔ_ⵎⴰⵢⵢⵓ_ⵢⵓⵏⵢⵓ_ⵢⵓⵍⵢⵓⵣ_ⵖⵓⵛⵜ_ⵛⵓⵜⴰⵏⴱⵉⵔ_ⴽⵟⵓⴱⵕ_ⵏⵓⵡⴰⵏⴱⵉⵔ_ⴷⵓⵊⵏⴱⵉⵔ".split("_"),monthsShort:"ⵉⵏⵏⴰⵢⵔ_ⴱⵕⴰⵢⵕ_ⵎⴰⵕⵚ_ⵉⴱⵔⵉⵔ_ⵎⴰⵢⵢⵓ_ⵢⵓⵏⵢⵓ_ⵢⵓⵍⵢⵓⵣ_ⵖⵓⵛⵜ_ⵛⵓⵜⴰⵏⴱⵉⵔ_ⴽⵟⵓⴱⵕ_ⵏⵓⵡⴰⵏⴱⵉⵔ_ⴷⵓⵊⵏⴱⵉⵔ".split("_"),weekdays:"ⴰⵙⴰⵎⴰⵙ_ⴰⵢⵏⴰⵙ_ⴰⵙⵉⵏⴰⵙ_ⴰⴽⵔⴰⵙ_ⴰⴽⵡⴰⵙ_ⴰⵙⵉⵎⵡⴰⵙ_ⴰⵙⵉⴹⵢⴰⵙ".split("_"),weekdaysShort:"ⴰⵙⴰⵎⴰⵙ_ⴰⵢⵏⴰⵙ_ⴰⵙⵉⵏⴰⵙ_ⴰⴽⵔⴰⵙ_ⴰⴽⵡⴰⵙ_ⴰⵙⵉⵎⵡⴰⵙ_ⴰⵙⵉⴹⵢⴰⵙ".split("_"),weekdaysMin:"ⴰⵙⴰⵎⴰⵙ_ⴰⵢⵏⴰⵙ_ⴰⵙⵉⵏⴰⵙ_ⴰⴽⵔⴰⵙ_ⴰⴽⵡⴰⵙ_ⴰⵙⵉⵎⵡⴰⵙ_ⴰⵙⵉⴹⵢⴰⵙ".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[ⴰⵙⴷⵅ ⴴ] LT",nextDay:"[ⴰⵙⴽⴰ ⴴ] LT",nextWeek:"dddd [ⴴ] LT",lastDay:"[ⴰⵚⴰⵏⵜ ⴴ] LT",lastWeek:"dddd [ⴴ] LT",sameElse:"L"},relativeTime:{future:"ⴷⴰⴷⵅ ⵙ ⵢⴰⵏ %s",past:"ⵢⴰⵏ %s",s:"ⵉⵎⵉⴽ",ss:"%d ⵉⵎⵉⴽ",m:"ⵎⵉⵏⵓⴺ",mm:"%d ⵎⵉⵏⵓⴺ",h:"ⵙⴰⵄⴰ",hh:"%d ⵜⴰⵙⵙⴰⵄⵉⵏ",d:"ⴰⵙⵙ",dd:"%d oⵙⵙⴰⵏ",M:"ⴰⵢoⵓⵔ",MM:"%d ⵉⵢⵢⵉⵔⵏ",y:"ⴰⵙⴳⴰⵙ",yy:"%d ⵉⵙⴳⴰⵙⵏ"},week:{dow:6,doy:12}})}(a(43936))},32128:function(e,t,a){!function(e){"use strict";e.defineLocale("ug-cn",{months:"يانۋار_فېۋرال_مارت_ئاپرېل_ماي_ئىيۇن_ئىيۇل_ئاۋغۇست_سېنتەبىر_ئۆكتەبىر_نويابىر_دېكابىر".split("_"),monthsShort:"يانۋار_فېۋرال_مارت_ئاپرېل_ماي_ئىيۇن_ئىيۇل_ئاۋغۇست_سېنتەبىر_ئۆكتەبىر_نويابىر_دېكابىر".split("_"),weekdays:"يەكشەنبە_دۈشەنبە_سەيشەنبە_چارشەنبە_پەيشەنبە_جۈمە_شەنبە".split("_"),weekdaysShort:"يە_دۈ_سە_چا_پە_جۈ_شە".split("_"),weekdaysMin:"يە_دۈ_سە_چا_پە_جۈ_شە".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY-يىلىM-ئاينىڭD-كۈنى",LLL:"YYYY-يىلىM-ئاينىڭD-كۈنى، HH:mm",LLLL:"dddd، YYYY-يىلىM-ئاينىڭD-كۈنى، HH:mm"},meridiemParse:/يېرىم كېچە|سەھەر|چۈشتىن بۇرۇن|چۈش|چۈشتىن كېيىن|كەچ/,meridiemHour:function(e,t){return 12===e&&(e=0),"يېرىم كېچە"===t||"سەھەر"===t||"چۈشتىن بۇرۇن"===t?e:"چۈشتىن كېيىن"===t||"كەچ"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,a){var i=100*e+t;return i<600?"يېرىم كېچە":i<900?"سەھەر":i<1130?"چۈشتىن بۇرۇن":i<1230?"چۈش":i<1800?"چۈشتىن كېيىن":"كەچ"},calendar:{sameDay:"[بۈگۈن سائەت] LT",nextDay:"[ئەتە سائەت] LT",nextWeek:"[كېلەركى] dddd [سائەت] LT",lastDay:"[تۆنۈگۈن] LT",lastWeek:"[ئالدىنقى] dddd [سائەت] LT",sameElse:"L"},relativeTime:{future:"%s كېيىن",past:"%s بۇرۇن",s:"نەچچە سېكونت",ss:"%d سېكونت",m:"بىر مىنۇت",mm:"%d مىنۇت",h:"بىر سائەت",hh:"%d سائەت",d:"بىر كۈن",dd:"%d كۈن",M:"بىر ئاي",MM:"%d ئاي",y:"بىر يىل",yy:"%d يىل"},dayOfMonthOrdinalParse:/\d{1,2}(-كۈنى|-ئاي|-ھەپتە)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"-كۈنى";case"w":case"W":return e+"-ھەپتە";default:return e}},preparse:function(e){return e.replace(/،/g,",")},postformat:function(e){return e.replace(/,/g,"،")},week:{dow:1,doy:7}})}(a(43936))},47760:function(e,t,a){!function(e){"use strict";function t(e,t){var a=e.split("_");return t%10==1&&t%100!=11?a[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?a[1]:a[2]}function a(e,a,i){return"m"===i?a?"хвилина":"хвилину":"h"===i?a?"година":"годину":e+" "+t({ss:a?"секунда_секунди_секунд":"секунду_секунди_секунд",mm:a?"хвилина_хвилини_хвилин":"хвилину_хвилини_хвилин",hh:a?"година_години_годин":"годину_години_годин",dd:"день_дні_днів",MM:"місяць_місяці_місяців",yy:"рік_роки_років"}[i],+e)}function i(e,t){var a={nominative:"неділя_понеділок_вівторок_середа_четвер_п’ятниця_субота".split("_"),accusative:"неділю_понеділок_вівторок_середу_четвер_п’ятницю_суботу".split("_"),genitive:"неділі_понеділка_вівторка_середи_четверга_п’ятниці_суботи".split("_")};return!0===e?a.nominative.slice(1,7).concat(a.nominative.slice(0,1)):e?a[/(\[[ВвУу]\]) ?dddd/.test(t)?"accusative":/\[?(?:минулої|наступної)? ?\] ?dddd/.test(t)?"genitive":"nominative"][e.day()]:a.nominative}function s(e){return function(){return e+"о"+(11===this.hours()?"б":"")+"] LT"}}e.defineLocale("uk",{months:{format:"січня_лютого_березня_квітня_травня_червня_липня_серпня_вересня_жовтня_листопада_грудня".split("_"),standalone:"січень_лютий_березень_квітень_травень_червень_липень_серпень_вересень_жовтень_листопад_грудень".split("_")},monthsShort:"січ_лют_бер_квіт_трав_черв_лип_серп_вер_жовт_лист_груд".split("_"),weekdays:i,weekdaysShort:"нд_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"нд_пн_вт_ср_чт_пт_сб".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY р.",LLL:"D MMMM YYYY р., HH:mm",LLLL:"dddd, D MMMM YYYY р., HH:mm"},calendar:{sameDay:s("[Сьогодні "),nextDay:s("[Завтра "),lastDay:s("[Вчора "),nextWeek:s("[У] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return s("[Минулої] dddd [").call(this);case 1:case 2:case 4:return s("[Минулого] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:"за %s",past:"%s тому",s:"декілька секунд",ss:a,m:a,mm:a,h:"годину",hh:a,d:"день",dd:a,M:"місяць",MM:a,y:"рік",yy:a},meridiemParse:/ночі|ранку|дня|вечора/,isPM:function(e){return/^(дня|вечора)$/.test(e)},meridiem:function(e,t,a){return e<4?"ночі":e<12?"ранку":e<17?"дня":"вечора"},dayOfMonthOrdinalParse:/\d{1,2}-(й|го)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e+"-й";case"D":return e+"-го";default:return e}},week:{dow:1,doy:7}})}(a(43936))},99144:function(e,t,a){!function(e){"use strict";var t=["جنوری","فروری","مارچ","اپریل","مئی","جون","جولائی","اگست","ستمبر","اکتوبر","نومبر","دسمبر"],a=["اتوار","پیر","منگل","بدھ","جمعرات","جمعہ","ہفتہ"];e.defineLocale("ur",{months:t,monthsShort:t,weekdays:a,weekdaysShort:a,weekdaysMin:a,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd، D MMMM YYYY HH:mm"},meridiemParse:/صبح|شام/,isPM:function(e){return"شام"===e},meridiem:function(e,t,a){return e<12?"صبح":"شام"},calendar:{sameDay:"[آج بوقت] LT",nextDay:"[کل بوقت] LT",nextWeek:"dddd [بوقت] LT",lastDay:"[گذشتہ روز بوقت] LT",lastWeek:"[گذشتہ] dddd [بوقت] LT",sameElse:"L"},relativeTime:{future:"%s بعد",past:"%s قبل",s:"چند سیکنڈ",ss:"%d سیکنڈ",m:"ایک منٹ",mm:"%d منٹ",h:"ایک گھنٹہ",hh:"%d گھنٹے",d:"ایک دن",dd:"%d دن",M:"ایک ماہ",MM:"%d ماہ",y:"ایک سال",yy:"%d سال"},preparse:function(e){return e.replace(/،/g,",")},postformat:function(e){return e.replace(/,/g,"،")},week:{dow:1,doy:4}})}(a(43936))},60368:function(e,t,a){!function(e){"use strict";e.defineLocale("uz-latn",{months:"Yanvar_Fevral_Mart_Aprel_May_Iyun_Iyul_Avgust_Sentabr_Oktabr_Noyabr_Dekabr".split("_"),monthsShort:"Yan_Fev_Mar_Apr_May_Iyun_Iyul_Avg_Sen_Okt_Noy_Dek".split("_"),weekdays:"Yakshanba_Dushanba_Seshanba_Chorshanba_Payshanba_Juma_Shanba".split("_"),weekdaysShort:"Yak_Dush_Sesh_Chor_Pay_Jum_Shan".split("_"),weekdaysMin:"Ya_Du_Se_Cho_Pa_Ju_Sha".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Bugun soat] LT [da]",nextDay:"[Ertaga] LT [da]",nextWeek:"dddd [kuni soat] LT [da]",lastDay:"[Kecha soat] LT [da]",lastWeek:"[O'tgan] dddd [kuni soat] LT [da]",sameElse:"L"},relativeTime:{future:"Yaqin %s ichida",past:"Bir necha %s oldin",s:"soniya",ss:"%d soniya",m:"bir daqiqa",mm:"%d daqiqa",h:"bir soat",hh:"%d soat",d:"bir kun",dd:"%d kun",M:"bir oy",MM:"%d oy",y:"bir yil",yy:"%d yil"},week:{dow:1,doy:7}})}(a(43936))},86628:function(e,t,a){!function(e){"use strict";e.defineLocale("uz",{months:"январ_феврал_март_апрел_май_июн_июл_август_сентябр_октябр_ноябр_декабр".split("_"),monthsShort:"янв_фев_мар_апр_май_июн_июл_авг_сен_окт_ноя_дек".split("_"),weekdays:"Якшанба_Душанба_Сешанба_Чоршанба_Пайшанба_Жума_Шанба".split("_"),weekdaysShort:"Якш_Душ_Сеш_Чор_Пай_Жум_Шан".split("_"),weekdaysMin:"Як_Ду_Се_Чо_Па_Жу_Ша".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Бугун соат] LT [да]",nextDay:"[Эртага] LT [да]",nextWeek:"dddd [куни соат] LT [да]",lastDay:"[Кеча соат] LT [да]",lastWeek:"[Утган] dddd [куни соат] LT [да]",sameElse:"L"},relativeTime:{future:"Якин %s ичида",past:"Бир неча %s олдин",s:"фурсат",ss:"%d фурсат",m:"бир дакика",mm:"%d дакика",h:"бир соат",hh:"%d соат",d:"бир кун",dd:"%d кун",M:"бир ой",MM:"%d ой",y:"бир йил",yy:"%d йил"},week:{dow:1,doy:7}})}(a(43936))},72736:function(e,t,a){!function(e){"use strict";e.defineLocale("vi",{months:"tháng 1_tháng 2_tháng 3_tháng 4_tháng 5_tháng 6_tháng 7_tháng 8_tháng 9_tháng 10_tháng 11_tháng 12".split("_"),monthsShort:"Thg 01_Thg 02_Thg 03_Thg 04_Thg 05_Thg 06_Thg 07_Thg 08_Thg 09_Thg 10_Thg 11_Thg 12".split("_"),monthsParseExact:!0,weekdays:"chủ nhật_thứ hai_thứ ba_thứ tư_thứ năm_thứ sáu_thứ bảy".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysParseExact:!0,meridiemParse:/sa|ch/i,isPM:function(e){return/^ch$/i.test(e)},meridiem:function(e,t,a){return e<12?a?"sa":"SA":a?"ch":"CH"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [năm] YYYY",LLL:"D MMMM [năm] YYYY HH:mm",LLLL:"dddd, D MMMM [năm] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[Hôm nay lúc] LT",nextDay:"[Ngày mai lúc] LT",nextWeek:"dddd [tuần tới lúc] LT",lastDay:"[Hôm qua lúc] LT",lastWeek:"dddd [tuần trước lúc] LT",sameElse:"L"},relativeTime:{future:"%s tới",past:"%s trước",s:"vài giây",ss:"%d giây",m:"một phút",mm:"%d phút",h:"một giờ",hh:"%d giờ",d:"một ngày",dd:"%d ngày",w:"một tuần",ww:"%d tuần",M:"một tháng",MM:"%d tháng",y:"một năm",yy:"%d năm"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(a(43936))},57236:function(e,t,a){!function(e){"use strict";e.defineLocale("x-pseudo",{months:"J~áñúá~rý_F~ébrú~árý_~Márc~h_Áp~ríl_~Máý_~Júñé~_Júl~ý_Áú~gúst~_Sép~témb~ér_Ó~ctób~ér_Ñ~óvém~bér_~Décé~mbér".split("_"),monthsShort:"J~áñ_~Féb_~Már_~Ápr_~Máý_~Júñ_~Júl_~Áúg_~Sép_~Óct_~Ñóv_~Déc".split("_"),monthsParseExact:!0,weekdays:"S~úñdá~ý_Mó~ñdáý~_Túé~sdáý~_Wéd~ñésd~áý_T~húrs~dáý_~Fríd~áý_S~átúr~dáý".split("_"),weekdaysShort:"S~úñ_~Móñ_~Túé_~Wéd_~Thú_~Frí_~Sát".split("_"),weekdaysMin:"S~ú_Mó~_Tú_~Wé_T~h_Fr~_Sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[T~ódá~ý át] LT",nextDay:"[T~ómó~rró~w át] LT",nextWeek:"dddd [át] LT",lastDay:"[Ý~ést~érdá~ý át] LT",lastWeek:"[L~ást] dddd [át] LT",sameElse:"L"},relativeTime:{future:"í~ñ %s",past:"%s á~gó",s:"á ~féw ~sécó~ñds",ss:"%d s~écóñ~ds",m:"á ~míñ~úté",mm:"%d m~íñú~tés",h:"á~ñ hó~úr",hh:"%d h~óúrs",d:"á ~dáý",dd:"%d d~áýs",M:"á ~móñ~th",MM:"%d m~óñt~hs",y:"á ~ýéár",yy:"%d ý~éárs"},dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(a(43936))},82720:function(e,t,a){!function(e){"use strict";e.defineLocale("yo",{months:"Sẹ́rẹ́_Èrèlè_Ẹrẹ̀nà_Ìgbé_Èbibi_Òkùdu_Agẹmo_Ògún_Owewe_Ọ̀wàrà_Bélú_Ọ̀pẹ̀̀".split("_"),monthsShort:"Sẹ́r_Èrl_Ẹrn_Ìgb_Èbi_Òkù_Agẹ_Ògú_Owe_Ọ̀wà_Bél_Ọ̀pẹ̀̀".split("_"),weekdays:"Àìkú_Ajé_Ìsẹ́gun_Ọjọ́rú_Ọjọ́bọ_Ẹtì_Àbámẹ́ta".split("_"),weekdaysShort:"Àìk_Ajé_Ìsẹ́_Ọjr_Ọjb_Ẹtì_Àbá".split("_"),weekdaysMin:"Àì_Aj_Ìs_Ọr_Ọb_Ẹt_Àb".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Ònì ni] LT",nextDay:"[Ọ̀la ni] LT",nextWeek:"dddd [Ọsẹ̀ tón'bọ] [ni] LT",lastDay:"[Àna ni] LT",lastWeek:"dddd [Ọsẹ̀ tólọ́] [ni] LT",sameElse:"L"},relativeTime:{future:"ní %s",past:"%s kọjá",s:"ìsẹjú aayá die",ss:"aayá %d",m:"ìsẹjú kan",mm:"ìsẹjú %d",h:"wákati kan",hh:"wákati %d",d:"ọjọ́ kan",dd:"ọjọ́ %d",M:"osù kan",MM:"osù %d",y:"ọdún kan",yy:"ọdún %d"},dayOfMonthOrdinalParse:/ọjọ́\s\d{1,2}/,ordinal:"ọjọ́ %d",week:{dow:1,doy:4}})}(a(43936))},17672:function(e,t,a){!function(e){"use strict";e.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"下午"===t||"晚上"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,a){var i=100*e+t;return i<600?"凌晨":i<900?"早上":i<1130?"上午":i<1230?"中午":i<1800?"下午":"晚上"},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:function(e){return e.week()!==this.week()?"[下]dddLT":"[本]dddLT"},lastDay:"[昨天]LT",lastWeek:function(e){return this.week()!==e.week()?"[上]dddLT":"[本]dddLT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s后",past:"%s前",s:"几秒",ss:"%d 秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",w:"1 周",ww:"%d 周",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}})}(a(43936))},87984:function(e,t,a){!function(e){"use strict";e.defineLocale("zh-hk",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日 HH:mm",LLLL:"YYYY年M月D日dddd HH:mm",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"中午"===t?e>=11?e:e+12:"下午"===t||"晚上"===t?e+12:void 0},meridiem:function(e,t,a){var i=100*e+t;return i<600?"凌晨":i<900?"早上":i<1200?"上午":1200===i?"中午":i<1800?"下午":"晚上"},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:"[下]ddddLT",lastDay:"[昨天]LT",lastWeek:"[上]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|週)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"週";default:return e}},relativeTime:{future:"%s後",past:"%s前",s:"幾秒",ss:"%d 秒",m:"1 分鐘",mm:"%d 分鐘",h:"1 小時",hh:"%d 小時",d:"1 天",dd:"%d 天",M:"1 個月",MM:"%d 個月",y:"1 年",yy:"%d 年"}})}(a(43936))},86676:function(e,t,a){!function(e){"use strict";e.defineLocale("zh-mo",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"YYYY年M月D日",LLL:"YYYY年M月D日 HH:mm",LLLL:"YYYY年M月D日dddd HH:mm",l:"D/M/YYYY",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"中午"===t?e>=11?e:e+12:"下午"===t||"晚上"===t?e+12:void 0},meridiem:function(e,t,a){var i=100*e+t;return i<600?"凌晨":i<900?"早上":i<1130?"上午":i<1230?"中午":i<1800?"下午":"晚上"},calendar:{sameDay:"[今天] LT",nextDay:"[明天] LT",nextWeek:"[下]dddd LT",lastDay:"[昨天] LT",lastWeek:"[上]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|週)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"週";default:return e}},relativeTime:{future:"%s內",past:"%s前",s:"幾秒",ss:"%d 秒",m:"1 分鐘",mm:"%d 分鐘",h:"1 小時",hh:"%d 小時",d:"1 天",dd:"%d 天",M:"1 個月",MM:"%d 個月",y:"1 年",yy:"%d 年"}})}(a(43936))},84536:function(e,t,a){!function(e){"use strict";e.defineLocale("zh-tw",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日 HH:mm",LLLL:"YYYY年M月D日dddd HH:mm",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"中午"===t?e>=11?e:e+12:"下午"===t||"晚上"===t?e+12:void 0},meridiem:function(e,t,a){var i=100*e+t;return i<600?"凌晨":i<900?"早上":i<1130?"上午":i<1230?"中午":i<1800?"下午":"晚上"},calendar:{sameDay:"[今天] LT",nextDay:"[明天] LT",nextWeek:"[下]dddd LT",lastDay:"[昨天] LT",lastWeek:"[上]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|週)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"週";default:return e}},relativeTime:{future:"%s後",past:"%s前",s:"幾秒",ss:"%d 秒",m:"1 分鐘",mm:"%d 分鐘",h:"1 小時",hh:"%d 小時",d:"1 天",dd:"%d 天",M:"1 個月",MM:"%d 個月",y:"1 年",yy:"%d 年"}})}(a(43936))},76864:(e,t,a)=>{var i={"./af":6656,"./af.js":6656,"./ar":87248,"./ar-dz":69264,"./ar-dz.js":69264,"./ar-kw":28420,"./ar-kw.js":28420,"./ar-ly":83280,"./ar-ly.js":83280,"./ar-ma":764,"./ar-ma.js":764,"./ar-sa":22096,"./ar-sa.js":22096,"./ar-tn":60480,"./ar-tn.js":60480,"./ar.js":87248,"./az":81995,"./az.js":81995,"./be":47243,"./be.js":47243,"./bg":61964,"./bg.js":61964,"./bm":82912,"./bm.js":82912,"./bn":12104,"./bn-bd":52552,"./bn-bd.js":52552,"./bn.js":12104,"./bo":1972,"./bo.js":1972,"./br":90744,"./br.js":90744,"./bs":23928,"./bs.js":23928,"./ca":29780,"./ca.js":29780,"./cs":40112,"./cs.js":40112,"./cv":92808,"./cv.js":92808,"./cy":19824,"./cy.js":19824,"./da":52780,"./da.js":52780,"./de":17380,"./de-at":72320,"./de-at.js":72320,"./de-ch":25835,"./de-ch.js":25835,"./de.js":17380,"./dv":71876,"./dv.js":71876,"./el":13996,"./el.js":13996,"./en-au":66584,"./en-au.js":66584,"./en-ca":28272,"./en-ca.js":28272,"./en-gb":53424,"./en-gb.js":53424,"./en-ie":36256,"./en-ie.js":36256,"./en-il":79088,"./en-il.js":79088,"./en-in":98792,"./en-in.js":98792,"./en-nz":51208,"./en-nz.js":51208,"./en-sg":72576,"./en-sg.js":72576,"./eo":83e3,"./eo.js":83e3,"./es":19676,"./es-do":5640,"./es-do.js":5640,"./es-mx":77844,"./es-mx.js":77844,"./es-us":77932,"./es-us.js":77932,"./es.js":19676,"./et":12692,"./et.js":12692,"./eu":83344,"./eu.js":83344,"./fa":17828,"./fa.js":17828,"./fi":11e3,"./fi.js":11e3,"./fil":65600,"./fil.js":65600,"./fo":75328,"./fo.js":75328,"./fr":73940,"./fr-ca":72876,"./fr-ca.js":72876,"./fr-ch":12220,"./fr-ch.js":12220,"./fr.js":73940,"./fy":58880,"./fy.js":58880,"./ga":39188,"./ga.js":39188,"./gd":1748,"./gd.js":1748,"./gl":35112,"./gl.js":35112,"./gom-deva":80352,"./gom-deva.js":80352,"./gom-latn":86051,"./gom-latn.js":86051,"./gu":60700,"./gu.js":60700,"./he":79384,"./he.js":79384,"./hi":87759,"./hi.js":87759,"./hr":74256,"./hr.js":74256,"./hu":61128,"./hu.js":61128,"./hy-am":91120,"./hy-am.js":91120,"./id":60776,"./id.js":60776,"./is":67956,"./is.js":67956,"./it":29560,"./it-ch":39952,"./it-ch.js":39952,"./it.js":29560,"./ja":20232,"./ja.js":20232,"./jv":14024,"./jv.js":14024,"./ka":74796,"./ka.js":74796,"./kk":95744,"./kk.js":95744,"./km":95624,"./km.js":95624,"./kn":99340,"./kn.js":99340,"./ko":92612,"./ko.js":92612,"./ku":30928,"./ku.js":30928,"./ky":84388,"./ky.js":84388,"./lb":24728,"./lb.js":24728,"./lo":17464,"./lo.js":17464,"./lt":60256,"./lt.js":60256,"./lv":86312,"./lv.js":86312,"./me":49260,"./me.js":49260,"./mi":24636,"./mi.js":24636,"./mk":31952,"./mk.js":31952,"./ml":62252,"./ml.js":62252,"./mn":82024,"./mn.js":82024,"./mr":84707,"./mr.js":84707,"./ms":59904,"./ms-my":49444,"./ms-my.js":49444,"./ms.js":59904,"./mt":1516,"./mt.js":1516,"./my":38956,"./my.js":38956,"./nb":44508,"./nb.js":44508,"./ne":95831,"./ne.js":95831,"./nl":88036,"./nl-be":28640,"./nl-be.js":28640,"./nl.js":88036,"./nn":20964,"./nn.js":20964,"./oc-lnc":15632,"./oc-lnc.js":15632,"./pa-in":14243,"./pa-in.js":14243,"./pl":16928,"./pl.js":16928,"./pt":83992,"./pt-br":80952,"./pt-br.js":80952,"./pt.js":83992,"./ro":43464,"./ro.js":43464,"./ru":8012,"./ru.js":8012,"./sd":27311,"./sd.js":27311,"./se":49976,"./se.js":49976,"./si":46416,"./si.js":46416,"./sk":18784,"./sk.js":18784,"./sl":87400,"./sl.js":87400,"./sq":40020,"./sq.js":40020,"./sr":27952,"./sr-cyrl":8296,"./sr-cyrl.js":8296,"./sr.js":27952,"./ss":38240,"./ss.js":38240,"./sv":7660,"./sv.js":7660,"./sw":42948,"./sw.js":42948,"./ta":8456,"./ta.js":8456,"./te":27636,"./te.js":27636,"./tet":62376,"./tet.js":62376,"./tg":8576,"./tg.js":8576,"./th":8196,"./th.js":8196,"./tk":20015,"./tk.js":20015,"./tl-ph":41445,"./tl-ph.js":41445,"./tlh":45420,"./tlh.js":45420,"./tr":65032,"./tr.js":65032,"./tzl":67036,"./tzl.js":67036,"./tzm":2924,"./tzm-latn":87892,"./tzm-latn.js":87892,"./tzm.js":2924,"./ug-cn":32128,"./ug-cn.js":32128,"./uk":47760,"./uk.js":47760,"./ur":99144,"./ur.js":99144,"./uz":86628,"./uz-latn":60368,"./uz-latn.js":60368,"./uz.js":86628,"./vi":72736,"./vi.js":72736,"./x-pseudo":57236,"./x-pseudo.js":57236,"./yo":82720,"./yo.js":82720,"./zh-cn":17672,"./zh-cn.js":17672,"./zh-hk":87984,"./zh-hk.js":87984,"./zh-mo":86676,"./zh-mo.js":86676,"./zh-tw":84536,"./zh-tw.js":84536};function s(e){var t=r(e);return a(t)}function r(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}s.keys=function(){return Object.keys(i)},s.resolve=r,e.exports=s,s.id=76864},43936:function(e,t,a){(e=a.nmd(e)).exports=function(){"use strict";var t,i;function s(){return t.apply(null,arguments)}function r(e){t=e}function l(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function c(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function d(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(d(e,t))return!1;return!0}function p(e){return void 0===e}function m(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function _(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function f(e,t){var a,i=[],s=e.length;for(a=0;a<s;++a)i.push(t(e[a],a));return i}function h(e,t){for(var a in t)d(t,a)&&(e[a]=t[a]);return d(t,"toString")&&(e.toString=t.toString),d(t,"valueOf")&&(e.valueOf=t.valueOf),e}function g(e,t,a,i){return Ka(e,t,a,i,!0).utc()}function y(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function b(e){return null==e._pf&&(e._pf=y()),e._pf}function w(e){if(null==e._isValid){var t=b(e),a=i.call(t.parsedDateParts,(function(e){return null!=e})),s=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&a);if(e._strict&&(s=s&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return s;e._isValid=s}return e._isValid}function v(e){var t=g(NaN);return null!=e?h(b(t),e):b(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){var t,a=Object(this),i=a.length>>>0;for(t=0;t<i;t++)if(t in a&&e.call(this,a[t],t,a))return!0;return!1};var T=s.momentProperties=[],k=!1;function S(e,t){var a,i,s,r=T.length;if(p(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),p(t._i)||(e._i=t._i),p(t._f)||(e._f=t._f),p(t._l)||(e._l=t._l),p(t._strict)||(e._strict=t._strict),p(t._tzm)||(e._tzm=t._tzm),p(t._isUTC)||(e._isUTC=t._isUTC),p(t._offset)||(e._offset=t._offset),p(t._pf)||(e._pf=b(t)),p(t._locale)||(e._locale=t._locale),r>0)for(a=0;a<r;a++)p(s=t[i=T[a]])||(e[i]=s);return e}function M(e){S(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===k&&(k=!0,s.updateOffset(this),k=!1)}function O(e){return e instanceof M||null!=e&&null!=e._isAMomentObject}function I(e){!1===s.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function C(e,t){var a=!0;return h((function(){if(null!=s.deprecationHandler&&s.deprecationHandler(null,e),a){var i,r,l,c=[],u=arguments.length;for(r=0;r<u;r++){if(i="","object"==typeof arguments[r]){for(l in i+="\n["+r+"] ",arguments[0])d(arguments[0],l)&&(i+=l+": "+arguments[0][l]+", ");i=i.slice(0,-2)}else i=arguments[r];c.push(i)}I(e+"\nArguments: "+Array.prototype.slice.call(c).join("")+"\n"+(new Error).stack),a=!1}return t.apply(this,arguments)}),t)}var E,x={};function L(e,t){null!=s.deprecationHandler&&s.deprecationHandler(e,t),x[e]||(I(t),x[e]=!0)}function R(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function N(e){var t,a;for(a in e)d(e,a)&&(R(t=e[a])?this[a]=t:this["_"+a]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function A(e,t){var a,i=h({},e);for(a in t)d(t,a)&&(c(e[a])&&c(t[a])?(i[a]={},h(i[a],e[a]),h(i[a],t[a])):null!=t[a]?i[a]=t[a]:delete i[a]);for(a in e)d(e,a)&&!d(t,a)&&c(e[a])&&(i[a]=h({},i[a]));return i}function D(e){null!=e&&this.set(e)}s.suppressDeprecationWarnings=!1,s.deprecationHandler=null,E=Object.keys?Object.keys:function(e){var t,a=[];for(t in e)d(e,t)&&a.push(t);return a};var j={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function P(e,t,a){var i=this._calendar[e]||this._calendar.sameElse;return R(i)?i.call(t,a):i}function q(e,t,a){var i=""+Math.abs(e),s=t-i.length;return(e>=0?a?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+i}var U=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,$=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Y={},B={};function F(e,t,a,i){var s=i;"string"==typeof i&&(s=function(){return this[i]()}),e&&(B[e]=s),t&&(B[t[0]]=function(){return q(s.apply(this,arguments),t[1],t[2])}),a&&(B[a]=function(){return this.localeData().ordinal(s.apply(this,arguments),e)})}function V(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function H(e){var t,a,i=e.match(U);for(t=0,a=i.length;t<a;t++)B[i[t]]?i[t]=B[i[t]]:i[t]=V(i[t]);return function(t){var s,r="";for(s=0;s<a;s++)r+=R(i[s])?i[s].call(t,e):i[s];return r}}function G(e,t){return e.isValid()?(t=W(t,e.localeData()),Y[t]=Y[t]||H(t),Y[t](e)):e.localeData().invalidDate()}function W(e,t){var a=5;function i(e){return t.longDateFormat(e)||e}for($.lastIndex=0;a>=0&&$.test(e);)e=e.replace($,i),$.lastIndex=0,a-=1;return e}var z={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function J(e){var t=this._longDateFormat[e],a=this._longDateFormat[e.toUpperCase()];return t||!a?t:(this._longDateFormat[e]=a.match(U).map((function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e})).join(""),this._longDateFormat[e])}var K="Invalid date";function Q(){return this._invalidDate}var X="%d",Z=/\d{1,2}/;function ee(e){return this._ordinal.replace("%d",e)}var te={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function ae(e,t,a,i){var s=this._relativeTime[a];return R(s)?s(e,t,a,i):s.replace(/%d/i,e)}function ie(e,t){var a=this._relativeTime[e>0?"future":"past"];return R(a)?a(t):a.replace(/%s/i,t)}var ne={};function se(e,t){var a=e.toLowerCase();ne[a]=ne[a+"s"]=ne[t]=e}function oe(e){return"string"==typeof e?ne[e]||ne[e.toLowerCase()]:void 0}function re(e){var t,a,i={};for(a in e)d(e,a)&&(t=oe(a))&&(i[t]=e[a]);return i}var le={};function ce(e,t){le[e]=t}function de(e){var t,a=[];for(t in e)d(e,t)&&a.push({unit:t,priority:le[t]});return a.sort((function(e,t){return e.priority-t.priority})),a}function ue(e){return e%4==0&&e%100!=0||e%400==0}function pe(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function me(e){var t=+e,a=0;return 0!==t&&isFinite(t)&&(a=pe(t)),a}function _e(e,t){return function(a){return null!=a?(he(this,e,a),s.updateOffset(this,t),this):fe(this,e)}}function fe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function he(e,t,a){e.isValid()&&!isNaN(a)&&("FullYear"===t&&ue(e.year())&&1===e.month()&&29===e.date()?(a=me(a),e._d["set"+(e._isUTC?"UTC":"")+t](a,e.month(),at(a,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](a))}function ge(e){return R(this[e=oe(e)])?this[e]():this}function ye(e,t){if("object"==typeof e){var a,i=de(e=re(e)),s=i.length;for(a=0;a<s;a++)this[i[a].unit](e[i[a].unit])}else if(R(this[e=oe(e)]))return this[e](t);return this}var be,we=/\d/,ve=/\d\d/,Te=/\d{3}/,ke=/\d{4}/,Se=/[+-]?\d{6}/,Me=/\d\d?/,Oe=/\d\d\d\d?/,Ie=/\d\d\d\d\d\d?/,Ce=/\d{1,3}/,Ee=/\d{1,4}/,xe=/[+-]?\d{1,6}/,Le=/\d+/,Re=/[+-]?\d+/,Ne=/Z|[+-]\d\d:?\d\d/gi,Ae=/Z|[+-]\d\d(?::?\d\d)?/gi,De=/[+-]?\d+(\.\d{1,3})?/,je=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function Pe(e,t,a){be[e]=R(t)?t:function(e,i){return e&&a?a:t}}function qe(e,t){return d(be,e)?be[e](t._strict,t._locale):new RegExp(Ue(e))}function Ue(e){return $e(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(e,t,a,i,s){return t||a||i||s})))}function $e(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}be={};var Ye={};function Be(e,t){var a,i,s=t;for("string"==typeof e&&(e=[e]),m(t)&&(s=function(e,a){a[t]=me(e)}),i=e.length,a=0;a<i;a++)Ye[e[a]]=s}function Fe(e,t){Be(e,(function(e,a,i,s){i._w=i._w||{},t(e,i._w,i,s)}))}function Ve(e,t,a){null!=t&&d(Ye,e)&&Ye[e](t,a._a,a,e)}var He,Ge=0,We=1,ze=2,Je=3,Ke=4,Qe=5,Xe=6,Ze=7,et=8;function tt(e,t){return(e%t+t)%t}function at(e,t){if(isNaN(e)||isNaN(t))return NaN;var a=tt(t,12);return e+=(t-a)/12,1===a?ue(e)?29:28:31-a%7%2}He=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},F("M",["MM",2],"Mo",(function(){return this.month()+1})),F("MMM",0,0,(function(e){return this.localeData().monthsShort(this,e)})),F("MMMM",0,0,(function(e){return this.localeData().months(this,e)})),se("month","M"),ce("month",8),Pe("M",Me),Pe("MM",Me,ve),Pe("MMM",(function(e,t){return t.monthsShortRegex(e)})),Pe("MMMM",(function(e,t){return t.monthsRegex(e)})),Be(["M","MM"],(function(e,t){t[We]=me(e)-1})),Be(["MMM","MMMM"],(function(e,t,a,i){var s=a._locale.monthsParse(e,i,a._strict);null!=s?t[We]=s:b(a).invalidMonth=e}));var it="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),nt="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),st=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,ot=je,rt=je;function lt(e,t){return e?l(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||st).test(t)?"format":"standalone"][e.month()]:l(this._months)?this._months:this._months.standalone}function ct(e,t){return e?l(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[st.test(t)?"format":"standalone"][e.month()]:l(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function dt(e,t,a){var i,s,r,l=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)r=g([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(r,"").toLocaleLowerCase();return a?"MMM"===t?-1!==(s=He.call(this._shortMonthsParse,l))?s:null:-1!==(s=He.call(this._longMonthsParse,l))?s:null:"MMM"===t?-1!==(s=He.call(this._shortMonthsParse,l))||-1!==(s=He.call(this._longMonthsParse,l))?s:null:-1!==(s=He.call(this._longMonthsParse,l))||-1!==(s=He.call(this._shortMonthsParse,l))?s:null}function ut(e,t,a){var i,s,r;if(this._monthsParseExact)return dt.call(this,e,t,a);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(s=g([2e3,i]),a&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),a||this._monthsParse[i]||(r="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[i]=new RegExp(r.replace(".",""),"i")),a&&"MMMM"===t&&this._longMonthsParse[i].test(e))return i;if(a&&"MMM"===t&&this._shortMonthsParse[i].test(e))return i;if(!a&&this._monthsParse[i].test(e))return i}}function pt(e,t){var a;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=me(t);else if(!m(t=e.localeData().monthsParse(t)))return e;return a=Math.min(e.date(),at(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,a),e}function mt(e){return null!=e?(pt(this,e),s.updateOffset(this,!0),this):fe(this,"Month")}function _t(){return at(this.year(),this.month())}function ft(e){return this._monthsParseExact?(d(this,"_monthsRegex")||gt.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(d(this,"_monthsShortRegex")||(this._monthsShortRegex=ot),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)}function ht(e){return this._monthsParseExact?(d(this,"_monthsRegex")||gt.call(this),e?this._monthsStrictRegex:this._monthsRegex):(d(this,"_monthsRegex")||(this._monthsRegex=rt),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)}function gt(){function e(e,t){return t.length-e.length}var t,a,i=[],s=[],r=[];for(t=0;t<12;t++)a=g([2e3,t]),i.push(this.monthsShort(a,"")),s.push(this.months(a,"")),r.push(this.months(a,"")),r.push(this.monthsShort(a,""));for(i.sort(e),s.sort(e),r.sort(e),t=0;t<12;t++)i[t]=$e(i[t]),s[t]=$e(s[t]);for(t=0;t<24;t++)r[t]=$e(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+i.join("|")+")","i")}function yt(e){return ue(e)?366:365}F("Y",0,0,(function(){var e=this.year();return e<=9999?q(e,4):"+"+e})),F(0,["YY",2],0,(function(){return this.year()%100})),F(0,["YYYY",4],0,"year"),F(0,["YYYYY",5],0,"year"),F(0,["YYYYYY",6,!0],0,"year"),se("year","y"),ce("year",1),Pe("Y",Re),Pe("YY",Me,ve),Pe("YYYY",Ee,ke),Pe("YYYYY",xe,Se),Pe("YYYYYY",xe,Se),Be(["YYYYY","YYYYYY"],Ge),Be("YYYY",(function(e,t){t[Ge]=2===e.length?s.parseTwoDigitYear(e):me(e)})),Be("YY",(function(e,t){t[Ge]=s.parseTwoDigitYear(e)})),Be("Y",(function(e,t){t[Ge]=parseInt(e,10)})),s.parseTwoDigitYear=function(e){return me(e)+(me(e)>68?1900:2e3)};var bt=_e("FullYear",!0);function wt(){return ue(this.year())}function vt(e,t,a,i,s,r,l){var c;return e<100&&e>=0?(c=new Date(e+400,t,a,i,s,r,l),isFinite(c.getFullYear())&&c.setFullYear(e)):c=new Date(e,t,a,i,s,r,l),c}function Tt(e){var t,a;return e<100&&e>=0?((a=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,a)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function kt(e,t,a){var i=7+t-a;return-(7+Tt(e,0,i).getUTCDay()-t)%7+i-1}function St(e,t,a,i,s){var r,l,c=1+7*(t-1)+(7+a-i)%7+kt(e,i,s);return c<=0?l=yt(r=e-1)+c:c>yt(e)?(r=e+1,l=c-yt(e)):(r=e,l=c),{year:r,dayOfYear:l}}function Mt(e,t,a){var i,s,r=kt(e.year(),t,a),l=Math.floor((e.dayOfYear()-r-1)/7)+1;return l<1?i=l+Ot(s=e.year()-1,t,a):l>Ot(e.year(),t,a)?(i=l-Ot(e.year(),t,a),s=e.year()+1):(s=e.year(),i=l),{week:i,year:s}}function Ot(e,t,a){var i=kt(e,t,a),s=kt(e+1,t,a);return(yt(e)-i+s)/7}function It(e){return Mt(e,this._week.dow,this._week.doy).week}F("w",["ww",2],"wo","week"),F("W",["WW",2],"Wo","isoWeek"),se("week","w"),se("isoWeek","W"),ce("week",5),ce("isoWeek",5),Pe("w",Me),Pe("ww",Me,ve),Pe("W",Me),Pe("WW",Me,ve),Fe(["w","ww","W","WW"],(function(e,t,a,i){t[i.substr(0,1)]=me(e)}));var Ct={dow:0,doy:6};function Et(){return this._week.dow}function xt(){return this._week.doy}function Lt(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")}function Rt(e){var t=Mt(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")}function Nt(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}function At(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function Dt(e,t){return e.slice(t,7).concat(e.slice(0,t))}F("d",0,"do","day"),F("dd",0,0,(function(e){return this.localeData().weekdaysMin(this,e)})),F("ddd",0,0,(function(e){return this.localeData().weekdaysShort(this,e)})),F("dddd",0,0,(function(e){return this.localeData().weekdays(this,e)})),F("e",0,0,"weekday"),F("E",0,0,"isoWeekday"),se("day","d"),se("weekday","e"),se("isoWeekday","E"),ce("day",11),ce("weekday",11),ce("isoWeekday",11),Pe("d",Me),Pe("e",Me),Pe("E",Me),Pe("dd",(function(e,t){return t.weekdaysMinRegex(e)})),Pe("ddd",(function(e,t){return t.weekdaysShortRegex(e)})),Pe("dddd",(function(e,t){return t.weekdaysRegex(e)})),Fe(["dd","ddd","dddd"],(function(e,t,a,i){var s=a._locale.weekdaysParse(e,i,a._strict);null!=s?t.d=s:b(a).invalidWeekday=e})),Fe(["d","e","E"],(function(e,t,a,i){t[i]=me(e)}));var jt="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Pt="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),qt="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ut=je,$t=je,Yt=je;function Bt(e,t){var a=l(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?Dt(a,this._week.dow):e?a[e.day()]:a}function Ft(e){return!0===e?Dt(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}function Vt(e){return!0===e?Dt(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function Ht(e,t,a){var i,s,r,l=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)r=g([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(r,"").toLocaleLowerCase();return a?"dddd"===t?-1!==(s=He.call(this._weekdaysParse,l))?s:null:"ddd"===t?-1!==(s=He.call(this._shortWeekdaysParse,l))?s:null:-1!==(s=He.call(this._minWeekdaysParse,l))?s:null:"dddd"===t?-1!==(s=He.call(this._weekdaysParse,l))||-1!==(s=He.call(this._shortWeekdaysParse,l))||-1!==(s=He.call(this._minWeekdaysParse,l))?s:null:"ddd"===t?-1!==(s=He.call(this._shortWeekdaysParse,l))||-1!==(s=He.call(this._weekdaysParse,l))||-1!==(s=He.call(this._minWeekdaysParse,l))?s:null:-1!==(s=He.call(this._minWeekdaysParse,l))||-1!==(s=He.call(this._weekdaysParse,l))||-1!==(s=He.call(this._shortWeekdaysParse,l))?s:null}function Gt(e,t,a){var i,s,r;if(this._weekdaysParseExact)return Ht.call(this,e,t,a);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(s=g([2e3,1]).day(i),a&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[i]||(r="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[i]=new RegExp(r.replace(".",""),"i")),a&&"dddd"===t&&this._fullWeekdaysParse[i].test(e))return i;if(a&&"ddd"===t&&this._shortWeekdaysParse[i].test(e))return i;if(a&&"dd"===t&&this._minWeekdaysParse[i].test(e))return i;if(!a&&this._weekdaysParse[i].test(e))return i}}function Wt(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=Nt(e,this.localeData()),this.add(e-t,"d")):t}function zt(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")}function Jt(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=At(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7}function Kt(e){return this._weekdaysParseExact?(d(this,"_weekdaysRegex")||Zt.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(d(this,"_weekdaysRegex")||(this._weekdaysRegex=Ut),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)}function Qt(e){return this._weekdaysParseExact?(d(this,"_weekdaysRegex")||Zt.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(d(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=$t),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Xt(e){return this._weekdaysParseExact?(d(this,"_weekdaysRegex")||Zt.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(d(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Yt),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Zt(){function e(e,t){return t.length-e.length}var t,a,i,s,r,l=[],c=[],d=[],u=[];for(t=0;t<7;t++)a=g([2e3,1]).day(t),i=$e(this.weekdaysMin(a,"")),s=$e(this.weekdaysShort(a,"")),r=$e(this.weekdays(a,"")),l.push(i),c.push(s),d.push(r),u.push(i),u.push(s),u.push(r);l.sort(e),c.sort(e),d.sort(e),u.sort(e),this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+d.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+l.join("|")+")","i")}function ea(){return this.hours()%12||12}function ta(){return this.hours()||24}function aa(e,t){F(e,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)}))}function ia(e,t){return t._meridiemParse}function na(e){return"p"===(e+"").toLowerCase().charAt(0)}F("H",["HH",2],0,"hour"),F("h",["hh",2],0,ea),F("k",["kk",2],0,ta),F("hmm",0,0,(function(){return""+ea.apply(this)+q(this.minutes(),2)})),F("hmmss",0,0,(function(){return""+ea.apply(this)+q(this.minutes(),2)+q(this.seconds(),2)})),F("Hmm",0,0,(function(){return""+this.hours()+q(this.minutes(),2)})),F("Hmmss",0,0,(function(){return""+this.hours()+q(this.minutes(),2)+q(this.seconds(),2)})),aa("a",!0),aa("A",!1),se("hour","h"),ce("hour",13),Pe("a",ia),Pe("A",ia),Pe("H",Me),Pe("h",Me),Pe("k",Me),Pe("HH",Me,ve),Pe("hh",Me,ve),Pe("kk",Me,ve),Pe("hmm",Oe),Pe("hmmss",Ie),Pe("Hmm",Oe),Pe("Hmmss",Ie),Be(["H","HH"],Je),Be(["k","kk"],(function(e,t,a){var i=me(e);t[Je]=24===i?0:i})),Be(["a","A"],(function(e,t,a){a._isPm=a._locale.isPM(e),a._meridiem=e})),Be(["h","hh"],(function(e,t,a){t[Je]=me(e),b(a).bigHour=!0})),Be("hmm",(function(e,t,a){var i=e.length-2;t[Je]=me(e.substr(0,i)),t[Ke]=me(e.substr(i)),b(a).bigHour=!0})),Be("hmmss",(function(e,t,a){var i=e.length-4,s=e.length-2;t[Je]=me(e.substr(0,i)),t[Ke]=me(e.substr(i,2)),t[Qe]=me(e.substr(s)),b(a).bigHour=!0})),Be("Hmm",(function(e,t,a){var i=e.length-2;t[Je]=me(e.substr(0,i)),t[Ke]=me(e.substr(i))})),Be("Hmmss",(function(e,t,a){var i=e.length-4,s=e.length-2;t[Je]=me(e.substr(0,i)),t[Ke]=me(e.substr(i,2)),t[Qe]=me(e.substr(s))}));var sa=/[ap]\.?m?\.?/i,oa=_e("Hours",!0);function ra(e,t,a){return e>11?a?"pm":"PM":a?"am":"AM"}var la,ca={calendar:j,longDateFormat:z,invalidDate:K,ordinal:X,dayOfMonthOrdinalParse:Z,relativeTime:te,months:it,monthsShort:nt,week:Ct,weekdays:jt,weekdaysMin:qt,weekdaysShort:Pt,meridiemParse:sa},da={},ua={};function pa(e,t){var a,i=Math.min(e.length,t.length);for(a=0;a<i;a+=1)if(e[a]!==t[a])return a;return i}function ma(e){return e?e.toLowerCase().replace("_","-"):e}function _a(e){for(var t,a,i,s,r=0;r<e.length;){for(t=(s=ma(e[r]).split("-")).length,a=(a=ma(e[r+1]))?a.split("-"):null;t>0;){if(i=ha(s.slice(0,t).join("-")))return i;if(a&&a.length>=t&&pa(s,a)>=t-1)break;t--}r++}return la}function fa(e){return null!=e.match("^[^/\\\\]*$")}function ha(t){var i=null;if(void 0===da[t]&&e&&e.exports&&fa(t))try{i=la._abbr,a(76864)("./"+t),ga(i)}catch(e){da[t]=null}return da[t]}function ga(e,t){var a;return e&&((a=p(t)?wa(e):ya(e,t))?la=a:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),la._abbr}function ya(e,t){if(null!==t){var a,i=ca;if(t.abbr=e,null!=da[e])L("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),i=da[e]._config;else if(null!=t.parentLocale)if(null!=da[t.parentLocale])i=da[t.parentLocale]._config;else{if(null==(a=ha(t.parentLocale)))return ua[t.parentLocale]||(ua[t.parentLocale]=[]),ua[t.parentLocale].push({name:e,config:t}),null;i=a._config}return da[e]=new D(A(i,t)),ua[e]&&ua[e].forEach((function(e){ya(e.name,e.config)})),ga(e),da[e]}return delete da[e],null}function ba(e,t){if(null!=t){var a,i,s=ca;null!=da[e]&&null!=da[e].parentLocale?da[e].set(A(da[e]._config,t)):(null!=(i=ha(e))&&(s=i._config),t=A(s,t),null==i&&(t.abbr=e),(a=new D(t)).parentLocale=da[e],da[e]=a),ga(e)}else null!=da[e]&&(null!=da[e].parentLocale?(da[e]=da[e].parentLocale,e===ga()&&ga(e)):null!=da[e]&&delete da[e]);return da[e]}function wa(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return la;if(!l(e)){if(t=ha(e))return t;e=[e]}return _a(e)}function va(){return E(da)}function Ta(e){var t,a=e._a;return a&&-2===b(e).overflow&&(t=a[We]<0||a[We]>11?We:a[ze]<1||a[ze]>at(a[Ge],a[We])?ze:a[Je]<0||a[Je]>24||24===a[Je]&&(0!==a[Ke]||0!==a[Qe]||0!==a[Xe])?Je:a[Ke]<0||a[Ke]>59?Ke:a[Qe]<0||a[Qe]>59?Qe:a[Xe]<0||a[Xe]>999?Xe:-1,b(e)._overflowDayOfYear&&(t<Ge||t>ze)&&(t=ze),b(e)._overflowWeeks&&-1===t&&(t=Ze),b(e)._overflowWeekday&&-1===t&&(t=et),b(e).overflow=t),e}var ka=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Sa=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ma=/Z|[+-]\d\d(?::?\d\d)?/,Oa=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Ia=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Ca=/^\/?Date\((-?\d+)/i,Ea=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,xa={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function La(e){var t,a,i,s,r,l,c=e._i,d=ka.exec(c)||Sa.exec(c),u=Oa.length,p=Ia.length;if(d){for(b(e).iso=!0,t=0,a=u;t<a;t++)if(Oa[t][1].exec(d[1])){s=Oa[t][0],i=!1!==Oa[t][2];break}if(null==s)return void(e._isValid=!1);if(d[3]){for(t=0,a=p;t<a;t++)if(Ia[t][1].exec(d[3])){r=(d[2]||" ")+Ia[t][0];break}if(null==r)return void(e._isValid=!1)}if(!i&&null!=r)return void(e._isValid=!1);if(d[4]){if(!Ma.exec(d[4]))return void(e._isValid=!1);l="Z"}e._f=s+(r||"")+(l||""),Fa(e)}else e._isValid=!1}function Ra(e,t,a,i,s,r){var l=[Na(e),nt.indexOf(t),parseInt(a,10),parseInt(i,10),parseInt(s,10)];return r&&l.push(parseInt(r,10)),l}function Na(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function Aa(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Da(e,t,a){return!e||Pt.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(b(a).weekdayMismatch=!0,a._isValid=!1,!1)}function ja(e,t,a){if(e)return xa[e];if(t)return 0;var i=parseInt(a,10),s=i%100;return(i-s)/100*60+s}function Pa(e){var t,a=Ea.exec(Aa(e._i));if(a){if(t=Ra(a[4],a[3],a[2],a[5],a[6],a[7]),!Da(a[1],t,e))return;e._a=t,e._tzm=ja(a[8],a[9],a[10]),e._d=Tt.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),b(e).rfc2822=!0}else e._isValid=!1}function qa(e){var t=Ca.exec(e._i);null===t?(La(e),!1===e._isValid&&(delete e._isValid,Pa(e),!1===e._isValid&&(delete e._isValid,e._strict?e._isValid=!1:s.createFromInputFallback(e)))):e._d=new Date(+t[1])}function Ua(e,t,a){return null!=e?e:null!=t?t:a}function $a(e){var t=new Date(s.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function Ya(e){var t,a,i,s,r,l=[];if(!e._d){for(i=$a(e),e._w&&null==e._a[ze]&&null==e._a[We]&&Ba(e),null!=e._dayOfYear&&(r=Ua(e._a[Ge],i[Ge]),(e._dayOfYear>yt(r)||0===e._dayOfYear)&&(b(e)._overflowDayOfYear=!0),a=Tt(r,0,e._dayOfYear),e._a[We]=a.getUTCMonth(),e._a[ze]=a.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=l[t]=i[t];for(;t<7;t++)e._a[t]=l[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Je]&&0===e._a[Ke]&&0===e._a[Qe]&&0===e._a[Xe]&&(e._nextDay=!0,e._a[Je]=0),e._d=(e._useUTC?Tt:vt).apply(null,l),s=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Je]=24),e._w&&void 0!==e._w.d&&e._w.d!==s&&(b(e).weekdayMismatch=!0)}}function Ba(e){var t,a,i,s,r,l,c,d,u;null!=(t=e._w).GG||null!=t.W||null!=t.E?(r=1,l=4,a=Ua(t.GG,e._a[Ge],Mt(Qa(),1,4).year),i=Ua(t.W,1),((s=Ua(t.E,1))<1||s>7)&&(d=!0)):(r=e._locale._week.dow,l=e._locale._week.doy,u=Mt(Qa(),r,l),a=Ua(t.gg,e._a[Ge],u.year),i=Ua(t.w,u.week),null!=t.d?((s=t.d)<0||s>6)&&(d=!0):null!=t.e?(s=t.e+r,(t.e<0||t.e>6)&&(d=!0)):s=r),i<1||i>Ot(a,r,l)?b(e)._overflowWeeks=!0:null!=d?b(e)._overflowWeekday=!0:(c=St(a,i,s,r,l),e._a[Ge]=c.year,e._dayOfYear=c.dayOfYear)}function Fa(e){if(e._f!==s.ISO_8601)if(e._f!==s.RFC_2822){e._a=[],b(e).empty=!0;var t,a,i,r,l,c,d,u=""+e._i,p=u.length,m=0;for(d=(i=W(e._f,e._locale).match(U)||[]).length,t=0;t<d;t++)r=i[t],(a=(u.match(qe(r,e))||[])[0])&&((l=u.substr(0,u.indexOf(a))).length>0&&b(e).unusedInput.push(l),u=u.slice(u.indexOf(a)+a.length),m+=a.length),B[r]?(a?b(e).empty=!1:b(e).unusedTokens.push(r),Ve(r,a,e)):e._strict&&!a&&b(e).unusedTokens.push(r);b(e).charsLeftOver=p-m,u.length>0&&b(e).unusedInput.push(u),e._a[Je]<=12&&!0===b(e).bigHour&&e._a[Je]>0&&(b(e).bigHour=void 0),b(e).parsedDateParts=e._a.slice(0),b(e).meridiem=e._meridiem,e._a[Je]=Va(e._locale,e._a[Je],e._meridiem),null!==(c=b(e).era)&&(e._a[Ge]=e._locale.erasConvertYear(c,e._a[Ge])),Ya(e),Ta(e)}else Pa(e);else La(e)}function Va(e,t,a){var i;return null==a?t:null!=e.meridiemHour?e.meridiemHour(t,a):null!=e.isPM?((i=e.isPM(a))&&t<12&&(t+=12),i||12!==t||(t=0),t):t}function Ha(e){var t,a,i,s,r,l,c=!1,d=e._f.length;if(0===d)return b(e).invalidFormat=!0,void(e._d=new Date(NaN));for(s=0;s<d;s++)r=0,l=!1,t=S({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[s],Fa(t),w(t)&&(l=!0),r+=b(t).charsLeftOver,r+=10*b(t).unusedTokens.length,b(t).score=r,c?r<i&&(i=r,a=t):(null==i||r<i||l)&&(i=r,a=t,l&&(c=!0));h(e,a||t)}function Ga(e){if(!e._d){var t=re(e._i),a=void 0===t.day?t.date:t.day;e._a=f([t.year,t.month,a,t.hour,t.minute,t.second,t.millisecond],(function(e){return e&&parseInt(e,10)})),Ya(e)}}function Wa(e){var t=new M(Ta(za(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function za(e){var t=e._i,a=e._f;return e._locale=e._locale||wa(e._l),null===t||void 0===a&&""===t?v({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),O(t)?new M(Ta(t)):(_(t)?e._d=t:l(a)?Ha(e):a?Fa(e):Ja(e),w(e)||(e._d=null),e))}function Ja(e){var t=e._i;p(t)?e._d=new Date(s.now()):_(t)?e._d=new Date(t.valueOf()):"string"==typeof t?qa(e):l(t)?(e._a=f(t.slice(0),(function(e){return parseInt(e,10)})),Ya(e)):c(t)?Ga(e):m(t)?e._d=new Date(t):s.createFromInputFallback(e)}function Ka(e,t,a,i,s){var r={};return!0!==t&&!1!==t||(i=t,t=void 0),!0!==a&&!1!==a||(i=a,a=void 0),(c(e)&&u(e)||l(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=s,r._l=a,r._i=e,r._f=t,r._strict=i,Wa(r)}function Qa(e,t,a,i){return Ka(e,t,a,i,!1)}s.createFromInputFallback=C("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))})),s.ISO_8601=function(){},s.RFC_2822=function(){};var Xa=C("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=Qa.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:v()})),Za=C("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=Qa.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:v()}));function ei(e,t){var a,i;if(1===t.length&&l(t[0])&&(t=t[0]),!t.length)return Qa();for(a=t[0],i=1;i<t.length;++i)t[i].isValid()&&!t[i][e](a)||(a=t[i]);return a}function ti(){return ei("isBefore",[].slice.call(arguments,0))}function ai(){return ei("isAfter",[].slice.call(arguments,0))}var ii=function(){return Date.now?Date.now():+new Date},ni=["year","quarter","month","week","day","hour","minute","second","millisecond"];function si(e){var t,a,i=!1,s=ni.length;for(t in e)if(d(e,t)&&(-1===He.call(ni,t)||null!=e[t]&&isNaN(e[t])))return!1;for(a=0;a<s;++a)if(e[ni[a]]){if(i)return!1;parseFloat(e[ni[a]])!==me(e[ni[a]])&&(i=!0)}return!0}function oi(){return this._isValid}function ri(){return xi(NaN)}function li(e){var t=re(e),a=t.year||0,i=t.quarter||0,s=t.month||0,r=t.week||t.isoWeek||0,l=t.day||0,c=t.hour||0,d=t.minute||0,u=t.second||0,p=t.millisecond||0;this._isValid=si(t),this._milliseconds=+p+1e3*u+6e4*d+1e3*c*60*60,this._days=+l+7*r,this._months=+s+3*i+12*a,this._data={},this._locale=wa(),this._bubble()}function ci(e){return e instanceof li}function di(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function ui(e,t,a){var i,s=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),l=0;for(i=0;i<s;i++)(a&&e[i]!==t[i]||!a&&me(e[i])!==me(t[i]))&&l++;return l+r}function pi(e,t){F(e,0,0,(function(){var e=this.utcOffset(),a="+";return e<0&&(e=-e,a="-"),a+q(~~(e/60),2)+t+q(~~e%60,2)}))}pi("Z",":"),pi("ZZ",""),Pe("Z",Ae),Pe("ZZ",Ae),Be(["Z","ZZ"],(function(e,t,a){a._useUTC=!0,a._tzm=_i(Ae,e)}));var mi=/([\+\-]|\d\d)/gi;function _i(e,t){var a,i,s=(t||"").match(e);return null===s?null:0===(i=60*(a=((s[s.length-1]||[])+"").match(mi)||["-",0,0])[1]+me(a[2]))?0:"+"===a[0]?i:-i}function fi(e,t){var a,i;return t._isUTC?(a=t.clone(),i=(O(e)||_(e)?e.valueOf():Qa(e).valueOf())-a.valueOf(),a._d.setTime(a._d.valueOf()+i),s.updateOffset(a,!1),a):Qa(e).local()}function hi(e){return-Math.round(e._d.getTimezoneOffset())}function gi(e,t,a){var i,r=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=_i(Ae,e)))return this}else Math.abs(e)<16&&!a&&(e*=60);return!this._isUTC&&t&&(i=hi(this)),this._offset=e,this._isUTC=!0,null!=i&&this.add(i,"m"),r!==e&&(!t||this._changeInProgress?Di(this,xi(e-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,s.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?r:hi(this)}function yi(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function bi(e){return this.utcOffset(0,e)}function wi(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(hi(this),"m")),this}function vi(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=_i(Ne,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this}function Ti(e){return!!this.isValid()&&(e=e?Qa(e).utcOffset():0,(this.utcOffset()-e)%60==0)}function ki(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Si(){if(!p(this._isDSTShifted))return this._isDSTShifted;var e,t={};return S(t,this),(t=za(t))._a?(e=t._isUTC?g(t._a):Qa(t._a),this._isDSTShifted=this.isValid()&&ui(t._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function Mi(){return!!this.isValid()&&!this._isUTC}function Oi(){return!!this.isValid()&&this._isUTC}function Ii(){return!!this.isValid()&&this._isUTC&&0===this._offset}s.updateOffset=function(){};var Ci=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Ei=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function xi(e,t){var a,i,s,r=e,l=null;return ci(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:m(e)||!isNaN(+e)?(r={},t?r[t]=+e:r.milliseconds=+e):(l=Ci.exec(e))?(a="-"===l[1]?-1:1,r={y:0,d:me(l[ze])*a,h:me(l[Je])*a,m:me(l[Ke])*a,s:me(l[Qe])*a,ms:me(di(1e3*l[Xe]))*a}):(l=Ei.exec(e))?(a="-"===l[1]?-1:1,r={y:Li(l[2],a),M:Li(l[3],a),w:Li(l[4],a),d:Li(l[5],a),h:Li(l[6],a),m:Li(l[7],a),s:Li(l[8],a)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(s=Ni(Qa(r.from),Qa(r.to)),(r={}).ms=s.milliseconds,r.M=s.months),i=new li(r),ci(e)&&d(e,"_locale")&&(i._locale=e._locale),ci(e)&&d(e,"_isValid")&&(i._isValid=e._isValid),i}function Li(e,t){var a=e&&parseFloat(e.replace(",","."));return(isNaN(a)?0:a)*t}function Ri(e,t){var a={};return a.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(a.months,"M").isAfter(t)&&--a.months,a.milliseconds=+t-+e.clone().add(a.months,"M"),a}function Ni(e,t){var a;return e.isValid()&&t.isValid()?(t=fi(t,e),e.isBefore(t)?a=Ri(e,t):((a=Ri(t,e)).milliseconds=-a.milliseconds,a.months=-a.months),a):{milliseconds:0,months:0}}function Ai(e,t){return function(a,i){var s;return null===i||isNaN(+i)||(L(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=a,a=i,i=s),Di(this,xi(a,i),e),this}}function Di(e,t,a,i){var r=t._milliseconds,l=di(t._days),c=di(t._months);e.isValid()&&(i=null==i||i,c&&pt(e,fe(e,"Month")+c*a),l&&he(e,"Date",fe(e,"Date")+l*a),r&&e._d.setTime(e._d.valueOf()+r*a),i&&s.updateOffset(e,l||c))}xi.fn=li.prototype,xi.invalid=ri;var ji=Ai(1,"add"),Pi=Ai(-1,"subtract");function qi(e){return"string"==typeof e||e instanceof String}function Ui(e){return O(e)||_(e)||qi(e)||m(e)||Yi(e)||$i(e)||null==e}function $i(e){var t,a,i=c(e)&&!u(e),s=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],l=r.length;for(t=0;t<l;t+=1)a=r[t],s=s||d(e,a);return i&&s}function Yi(e){var t=l(e),a=!1;return t&&(a=0===e.filter((function(t){return!m(t)&&qi(e)})).length),t&&a}function Bi(e){var t,a,i=c(e)&&!u(e),s=!1,r=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(t=0;t<r.length;t+=1)a=r[t],s=s||d(e,a);return i&&s}function Fi(e,t){var a=e.diff(t,"days",!0);return a<-6?"sameElse":a<-1?"lastWeek":a<0?"lastDay":a<1?"sameDay":a<2?"nextDay":a<7?"nextWeek":"sameElse"}function Vi(e,t){1===arguments.length&&(arguments[0]?Ui(arguments[0])?(e=arguments[0],t=void 0):Bi(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var a=e||Qa(),i=fi(a,this).startOf("day"),r=s.calendarFormat(this,i)||"sameElse",l=t&&(R(t[r])?t[r].call(this,a):t[r]);return this.format(l||this.localeData().calendar(r,this,Qa(a)))}function Hi(){return new M(this)}function Gi(e,t){var a=O(e)?e:Qa(e);return!(!this.isValid()||!a.isValid())&&("millisecond"===(t=oe(t)||"millisecond")?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(t).valueOf())}function Wi(e,t){var a=O(e)?e:Qa(e);return!(!this.isValid()||!a.isValid())&&("millisecond"===(t=oe(t)||"millisecond")?this.valueOf()<a.valueOf():this.clone().endOf(t).valueOf()<a.valueOf())}function zi(e,t,a,i){var s=O(e)?e:Qa(e),r=O(t)?t:Qa(t);return!!(this.isValid()&&s.isValid()&&r.isValid())&&("("===(i=i||"()")[0]?this.isAfter(s,a):!this.isBefore(s,a))&&(")"===i[1]?this.isBefore(r,a):!this.isAfter(r,a))}function Ji(e,t){var a,i=O(e)?e:Qa(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=oe(t)||"millisecond")?this.valueOf()===i.valueOf():(a=i.valueOf(),this.clone().startOf(t).valueOf()<=a&&a<=this.clone().endOf(t).valueOf()))}function Ki(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function Qi(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function Xi(e,t,a){var i,s,r;if(!this.isValid())return NaN;if(!(i=fi(e,this)).isValid())return NaN;switch(s=6e4*(i.utcOffset()-this.utcOffset()),t=oe(t)){case"year":r=Zi(this,i)/12;break;case"month":r=Zi(this,i);break;case"quarter":r=Zi(this,i)/3;break;case"second":r=(this-i)/1e3;break;case"minute":r=(this-i)/6e4;break;case"hour":r=(this-i)/36e5;break;case"day":r=(this-i-s)/864e5;break;case"week":r=(this-i-s)/6048e5;break;default:r=this-i}return a?r:pe(r)}function Zi(e,t){if(e.date()<t.date())return-Zi(t,e);var a=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(a,"months");return-(a+(t-i<0?(t-i)/(i-e.clone().add(a-1,"months")):(t-i)/(e.clone().add(a+1,"months")-i)))||0}function en(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function tn(e){if(!this.isValid())return null;var t=!0!==e,a=t?this.clone().utc():this;return a.year()<0||a.year()>9999?G(a,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):R(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",G(a,"Z")):G(a,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function an(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,a,i,s="moment",r="";return this.isLocal()||(s=0===this.utcOffset()?"moment.utc":"moment.parseZone",r="Z"),e="["+s+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",a="-MM-DD[T]HH:mm:ss.SSS",i=r+'[")]',this.format(e+t+a+i)}function nn(e){e||(e=this.isUtc()?s.defaultFormatUtc:s.defaultFormat);var t=G(this,e);return this.localeData().postformat(t)}function sn(e,t){return this.isValid()&&(O(e)&&e.isValid()||Qa(e).isValid())?xi({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function on(e){return this.from(Qa(),e)}function rn(e,t){return this.isValid()&&(O(e)&&e.isValid()||Qa(e).isValid())?xi({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function ln(e){return this.to(Qa(),e)}function cn(e){var t;return void 0===e?this._locale._abbr:(null!=(t=wa(e))&&(this._locale=t),this)}s.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",s.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var dn=C("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(e){return void 0===e?this.localeData():this.locale(e)}));function un(){return this._locale}var pn=1e3,mn=60*pn,fn=60*mn,hn=3506328*fn;function gn(e,t){return(e%t+t)%t}function yn(e,t,a){return e<100&&e>=0?new Date(e+400,t,a)-hn:new Date(e,t,a).valueOf()}function bn(e,t,a){return e<100&&e>=0?Date.UTC(e+400,t,a)-hn:Date.UTC(e,t,a)}function wn(e){var t,a;if(void 0===(e=oe(e))||"millisecond"===e||!this.isValid())return this;switch(a=this._isUTC?bn:yn,e){case"year":t=a(this.year(),0,1);break;case"quarter":t=a(this.year(),this.month()-this.month()%3,1);break;case"month":t=a(this.year(),this.month(),1);break;case"week":t=a(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=a(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=a(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=gn(t+(this._isUTC?0:this.utcOffset()*mn),fn);break;case"minute":t=this._d.valueOf(),t-=gn(t,mn);break;case"second":t=this._d.valueOf(),t-=gn(t,pn)}return this._d.setTime(t),s.updateOffset(this,!0),this}function vn(e){var t,a;if(void 0===(e=oe(e))||"millisecond"===e||!this.isValid())return this;switch(a=this._isUTC?bn:yn,e){case"year":t=a(this.year()+1,0,1)-1;break;case"quarter":t=a(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=a(this.year(),this.month()+1,1)-1;break;case"week":t=a(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=a(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=a(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=fn-gn(t+(this._isUTC?0:this.utcOffset()*mn),fn)-1;break;case"minute":t=this._d.valueOf(),t+=mn-gn(t,mn)-1;break;case"second":t=this._d.valueOf(),t+=pn-gn(t,pn)-1}return this._d.setTime(t),s.updateOffset(this,!0),this}function Tn(){return this._d.valueOf()-6e4*(this._offset||0)}function kn(){return Math.floor(this.valueOf()/1e3)}function Sn(){return new Date(this.valueOf())}function Mn(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function On(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function In(){return this.isValid()?this.toISOString():null}function Cn(){return w(this)}function En(){return h({},b(this))}function xn(){return b(this).overflow}function Ln(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Rn(e,t){var a,i,r,l=this._eras||wa("en")._eras;for(a=0,i=l.length;a<i;++a)switch("string"==typeof l[a].since&&(r=s(l[a].since).startOf("day"),l[a].since=r.valueOf()),typeof l[a].until){case"undefined":l[a].until=1/0;break;case"string":r=s(l[a].until).startOf("day").valueOf(),l[a].until=r.valueOf()}return l}function Nn(e,t,a){var i,s,r,l,c,d=this.eras();for(e=e.toUpperCase(),i=0,s=d.length;i<s;++i)if(r=d[i].name.toUpperCase(),l=d[i].abbr.toUpperCase(),c=d[i].narrow.toUpperCase(),a)switch(t){case"N":case"NN":case"NNN":if(l===e)return d[i];break;case"NNNN":if(r===e)return d[i];break;case"NNNNN":if(c===e)return d[i]}else if([r,l,c].indexOf(e)>=0)return d[i]}function An(e,t){var a=e.since<=e.until?1:-1;return void 0===t?s(e.since).year():s(e.since).year()+(t-e.offset)*a}function Dn(){var e,t,a,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e){if(a=this.clone().startOf("day").valueOf(),i[e].since<=a&&a<=i[e].until)return i[e].name;if(i[e].until<=a&&a<=i[e].since)return i[e].name}return""}function jn(){var e,t,a,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e){if(a=this.clone().startOf("day").valueOf(),i[e].since<=a&&a<=i[e].until)return i[e].narrow;if(i[e].until<=a&&a<=i[e].since)return i[e].narrow}return""}function Pn(){var e,t,a,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e){if(a=this.clone().startOf("day").valueOf(),i[e].since<=a&&a<=i[e].until)return i[e].abbr;if(i[e].until<=a&&a<=i[e].since)return i[e].abbr}return""}function qn(){var e,t,a,i,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e)if(a=r[e].since<=r[e].until?1:-1,i=this.clone().startOf("day").valueOf(),r[e].since<=i&&i<=r[e].until||r[e].until<=i&&i<=r[e].since)return(this.year()-s(r[e].since).year())*a+r[e].offset;return this.year()}function Un(e){return d(this,"_erasNameRegex")||Gn.call(this),e?this._erasNameRegex:this._erasRegex}function $n(e){return d(this,"_erasAbbrRegex")||Gn.call(this),e?this._erasAbbrRegex:this._erasRegex}function Yn(e){return d(this,"_erasNarrowRegex")||Gn.call(this),e?this._erasNarrowRegex:this._erasRegex}function Bn(e,t){return t.erasAbbrRegex(e)}function Fn(e,t){return t.erasNameRegex(e)}function Vn(e,t){return t.erasNarrowRegex(e)}function Hn(e,t){return t._eraYearOrdinalRegex||Le}function Gn(){var e,t,a=[],i=[],s=[],r=[],l=this.eras();for(e=0,t=l.length;e<t;++e)i.push($e(l[e].name)),a.push($e(l[e].abbr)),s.push($e(l[e].narrow)),r.push($e(l[e].name)),r.push($e(l[e].abbr)),r.push($e(l[e].narrow));this._erasRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+i.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+s.join("|")+")","i")}function Wn(e,t){F(0,[e,e.length],0,t)}function zn(e){return es.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function Jn(e){return es.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function Kn(){return Ot(this.year(),1,4)}function Qn(){return Ot(this.isoWeekYear(),1,4)}function Xn(){var e=this.localeData()._week;return Ot(this.year(),e.dow,e.doy)}function Zn(){var e=this.localeData()._week;return Ot(this.weekYear(),e.dow,e.doy)}function es(e,t,a,i,s){var r;return null==e?Mt(this,i,s).year:(t>(r=Ot(e,i,s))&&(t=r),ts.call(this,e,t,a,i,s))}function ts(e,t,a,i,s){var r=St(e,t,a,i,s),l=Tt(r.year,0,r.dayOfYear);return this.year(l.getUTCFullYear()),this.month(l.getUTCMonth()),this.date(l.getUTCDate()),this}function as(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}F("N",0,0,"eraAbbr"),F("NN",0,0,"eraAbbr"),F("NNN",0,0,"eraAbbr"),F("NNNN",0,0,"eraName"),F("NNNNN",0,0,"eraNarrow"),F("y",["y",1],"yo","eraYear"),F("y",["yy",2],0,"eraYear"),F("y",["yyy",3],0,"eraYear"),F("y",["yyyy",4],0,"eraYear"),Pe("N",Bn),Pe("NN",Bn),Pe("NNN",Bn),Pe("NNNN",Fn),Pe("NNNNN",Vn),Be(["N","NN","NNN","NNNN","NNNNN"],(function(e,t,a,i){var s=a._locale.erasParse(e,i,a._strict);s?b(a).era=s:b(a).invalidEra=e})),Pe("y",Le),Pe("yy",Le),Pe("yyy",Le),Pe("yyyy",Le),Pe("yo",Hn),Be(["y","yy","yyy","yyyy"],Ge),Be(["yo"],(function(e,t,a,i){var s;a._locale._eraYearOrdinalRegex&&(s=e.match(a._locale._eraYearOrdinalRegex)),a._locale.eraYearOrdinalParse?t[Ge]=a._locale.eraYearOrdinalParse(e,s):t[Ge]=parseInt(e,10)})),F(0,["gg",2],0,(function(){return this.weekYear()%100})),F(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),Wn("gggg","weekYear"),Wn("ggggg","weekYear"),Wn("GGGG","isoWeekYear"),Wn("GGGGG","isoWeekYear"),se("weekYear","gg"),se("isoWeekYear","GG"),ce("weekYear",1),ce("isoWeekYear",1),Pe("G",Re),Pe("g",Re),Pe("GG",Me,ve),Pe("gg",Me,ve),Pe("GGGG",Ee,ke),Pe("gggg",Ee,ke),Pe("GGGGG",xe,Se),Pe("ggggg",xe,Se),Fe(["gggg","ggggg","GGGG","GGGGG"],(function(e,t,a,i){t[i.substr(0,2)]=me(e)})),Fe(["gg","GG"],(function(e,t,a,i){t[i]=s.parseTwoDigitYear(e)})),F("Q",0,"Qo","quarter"),se("quarter","Q"),ce("quarter",7),Pe("Q",we),Be("Q",(function(e,t){t[We]=3*(me(e)-1)})),F("D",["DD",2],"Do","date"),se("date","D"),ce("date",9),Pe("D",Me),Pe("DD",Me,ve),Pe("Do",(function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient})),Be(["D","DD"],ze),Be("Do",(function(e,t){t[ze]=me(e.match(Me)[0])}));var is=_e("Date",!0);function ns(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")}F("DDD",["DDDD",3],"DDDo","dayOfYear"),se("dayOfYear","DDD"),ce("dayOfYear",4),Pe("DDD",Ce),Pe("DDDD",Te),Be(["DDD","DDDD"],(function(e,t,a){a._dayOfYear=me(e)})),F("m",["mm",2],0,"minute"),se("minute","m"),ce("minute",14),Pe("m",Me),Pe("mm",Me,ve),Be(["m","mm"],Ke);var ss=_e("Minutes",!1);F("s",["ss",2],0,"second"),se("second","s"),ce("second",15),Pe("s",Me),Pe("ss",Me,ve),Be(["s","ss"],Qe);var os,rs,ls=_e("Seconds",!1);for(F("S",0,0,(function(){return~~(this.millisecond()/100)})),F(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),F(0,["SSS",3],0,"millisecond"),F(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),F(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),F(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),F(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),F(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),F(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),se("millisecond","ms"),ce("millisecond",16),Pe("S",Ce,we),Pe("SS",Ce,ve),Pe("SSS",Ce,Te),os="SSSS";os.length<=9;os+="S")Pe(os,Le);function cs(e,t){t[Xe]=me(1e3*("0."+e))}for(os="S";os.length<=9;os+="S")Be(os,cs);function ds(){return this._isUTC?"UTC":""}function us(){return this._isUTC?"Coordinated Universal Time":""}rs=_e("Milliseconds",!1),F("z",0,0,"zoneAbbr"),F("zz",0,0,"zoneName");var ps=M.prototype;function ms(e){return Qa(1e3*e)}function _s(){return Qa.apply(null,arguments).parseZone()}function fs(e){return e}ps.add=ji,ps.calendar=Vi,ps.clone=Hi,ps.diff=Xi,ps.endOf=vn,ps.format=nn,ps.from=sn,ps.fromNow=on,ps.to=rn,ps.toNow=ln,ps.get=ge,ps.invalidAt=xn,ps.isAfter=Gi,ps.isBefore=Wi,ps.isBetween=zi,ps.isSame=Ji,ps.isSameOrAfter=Ki,ps.isSameOrBefore=Qi,ps.isValid=Cn,ps.lang=dn,ps.locale=cn,ps.localeData=un,ps.max=Za,ps.min=Xa,ps.parsingFlags=En,ps.set=ye,ps.startOf=wn,ps.subtract=Pi,ps.toArray=Mn,ps.toObject=On,ps.toDate=Sn,ps.toISOString=tn,ps.inspect=an,"undefined"!=typeof Symbol&&null!=Symbol.for&&(ps[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ps.toJSON=In,ps.toString=en,ps.unix=kn,ps.valueOf=Tn,ps.creationData=Ln,ps.eraName=Dn,ps.eraNarrow=jn,ps.eraAbbr=Pn,ps.eraYear=qn,ps.year=bt,ps.isLeapYear=wt,ps.weekYear=zn,ps.isoWeekYear=Jn,ps.quarter=ps.quarters=as,ps.month=mt,ps.daysInMonth=_t,ps.week=ps.weeks=Lt,ps.isoWeek=ps.isoWeeks=Rt,ps.weeksInYear=Xn,ps.weeksInWeekYear=Zn,ps.isoWeeksInYear=Kn,ps.isoWeeksInISOWeekYear=Qn,ps.date=is,ps.day=ps.days=Wt,ps.weekday=zt,ps.isoWeekday=Jt,ps.dayOfYear=ns,ps.hour=ps.hours=oa,ps.minute=ps.minutes=ss,ps.second=ps.seconds=ls,ps.millisecond=ps.milliseconds=rs,ps.utcOffset=gi,ps.utc=bi,ps.local=wi,ps.parseZone=vi,ps.hasAlignedHourOffset=Ti,ps.isDST=ki,ps.isLocal=Mi,ps.isUtcOffset=Oi,ps.isUtc=Ii,ps.isUTC=Ii,ps.zoneAbbr=ds,ps.zoneName=us,ps.dates=C("dates accessor is deprecated. Use date instead.",is),ps.months=C("months accessor is deprecated. Use month instead",mt),ps.years=C("years accessor is deprecated. Use year instead",bt),ps.zone=C("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",yi),ps.isDSTShifted=C("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Si);var hs=D.prototype;function gs(e,t,a,i){var s=wa(),r=g().set(i,t);return s[a](r,e)}function ys(e,t,a){if(m(e)&&(t=e,e=void 0),e=e||"",null!=t)return gs(e,t,a,"month");var i,s=[];for(i=0;i<12;i++)s[i]=gs(e,i,a,"month");return s}function bs(e,t,a,i){"boolean"==typeof e?(m(t)&&(a=t,t=void 0),t=t||""):(a=t=e,e=!1,m(t)&&(a=t,t=void 0),t=t||"");var s,r=wa(),l=e?r._week.dow:0,c=[];if(null!=a)return gs(t,(a+l)%7,i,"day");for(s=0;s<7;s++)c[s]=gs(t,(s+l)%7,i,"day");return c}function ws(e,t){return ys(e,t,"months")}function vs(e,t){return ys(e,t,"monthsShort")}function Ts(e,t,a){return bs(e,t,a,"weekdays")}function ks(e,t,a){return bs(e,t,a,"weekdaysShort")}function Ss(e,t,a){return bs(e,t,a,"weekdaysMin")}hs.calendar=P,hs.longDateFormat=J,hs.invalidDate=Q,hs.ordinal=ee,hs.preparse=fs,hs.postformat=fs,hs.relativeTime=ae,hs.pastFuture=ie,hs.set=N,hs.eras=Rn,hs.erasParse=Nn,hs.erasConvertYear=An,hs.erasAbbrRegex=$n,hs.erasNameRegex=Un,hs.erasNarrowRegex=Yn,hs.months=lt,hs.monthsShort=ct,hs.monthsParse=ut,hs.monthsRegex=ht,hs.monthsShortRegex=ft,hs.week=It,hs.firstDayOfYear=xt,hs.firstDayOfWeek=Et,hs.weekdays=Bt,hs.weekdaysMin=Vt,hs.weekdaysShort=Ft,hs.weekdaysParse=Gt,hs.weekdaysRegex=Kt,hs.weekdaysShortRegex=Qt,hs.weekdaysMinRegex=Xt,hs.isPM=na,hs.meridiem=ra,ga("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===me(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),s.lang=C("moment.lang is deprecated. Use moment.locale instead.",ga),s.langData=C("moment.langData is deprecated. Use moment.localeData instead.",wa);var Ms=Math.abs;function Os(){var e=this._data;return this._milliseconds=Ms(this._milliseconds),this._days=Ms(this._days),this._months=Ms(this._months),e.milliseconds=Ms(e.milliseconds),e.seconds=Ms(e.seconds),e.minutes=Ms(e.minutes),e.hours=Ms(e.hours),e.months=Ms(e.months),e.years=Ms(e.years),this}function Is(e,t,a,i){var s=xi(t,a);return e._milliseconds+=i*s._milliseconds,e._days+=i*s._days,e._months+=i*s._months,e._bubble()}function Cs(e,t){return Is(this,e,t,1)}function Es(e,t){return Is(this,e,t,-1)}function xs(e){return e<0?Math.floor(e):Math.ceil(e)}function Ls(){var e,t,a,i,s,r=this._milliseconds,l=this._days,c=this._months,d=this._data;return r>=0&&l>=0&&c>=0||r<=0&&l<=0&&c<=0||(r+=864e5*xs(Ns(c)+l),l=0,c=0),d.milliseconds=r%1e3,e=pe(r/1e3),d.seconds=e%60,t=pe(e/60),d.minutes=t%60,a=pe(t/60),d.hours=a%24,l+=pe(a/24),c+=s=pe(Rs(l)),l-=xs(Ns(s)),i=pe(c/12),c%=12,d.days=l,d.months=c,d.years=i,this}function Rs(e){return 4800*e/146097}function Ns(e){return 146097*e/4800}function As(e){if(!this.isValid())return NaN;var t,a,i=this._milliseconds;if("month"===(e=oe(e))||"quarter"===e||"year"===e)switch(t=this._days+i/864e5,a=this._months+Rs(t),e){case"month":return a;case"quarter":return a/3;case"year":return a/12}else switch(t=this._days+Math.round(Ns(this._months)),e){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return 24*t+i/36e5;case"minute":return 1440*t+i/6e4;case"second":return 86400*t+i/1e3;case"millisecond":return Math.floor(864e5*t)+i;default:throw new Error("Unknown unit "+e)}}function Ds(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*me(this._months/12):NaN}function js(e){return function(){return this.as(e)}}var Ps=js("ms"),qs=js("s"),Us=js("m"),$s=js("h"),Ys=js("d"),Bs=js("w"),Fs=js("M"),Vs=js("Q"),Hs=js("y");function Gs(){return xi(this)}function Ws(e){return e=oe(e),this.isValid()?this[e+"s"]():NaN}function zs(e){return function(){return this.isValid()?this._data[e]:NaN}}var Js=zs("milliseconds"),Ks=zs("seconds"),Qs=zs("minutes"),Xs=zs("hours"),Zs=zs("days"),eo=zs("months"),to=zs("years");function ao(){return pe(this.days()/7)}var io=Math.round,no={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function so(e,t,a,i,s){return s.relativeTime(t||1,!!a,e,i)}function oo(e,t,a,i){var s=xi(e).abs(),r=io(s.as("s")),l=io(s.as("m")),c=io(s.as("h")),d=io(s.as("d")),u=io(s.as("M")),p=io(s.as("w")),m=io(s.as("y")),_=r<=a.ss&&["s",r]||r<a.s&&["ss",r]||l<=1&&["m"]||l<a.m&&["mm",l]||c<=1&&["h"]||c<a.h&&["hh",c]||d<=1&&["d"]||d<a.d&&["dd",d];return null!=a.w&&(_=_||p<=1&&["w"]||p<a.w&&["ww",p]),(_=_||u<=1&&["M"]||u<a.M&&["MM",u]||m<=1&&["y"]||["yy",m])[2]=t,_[3]=+e>0,_[4]=i,so.apply(null,_)}function ro(e){return void 0===e?io:"function"==typeof e&&(io=e,!0)}function lo(e,t){return void 0!==no[e]&&(void 0===t?no[e]:(no[e]=t,"s"===e&&(no.ss=t-1),!0))}function co(e,t){if(!this.isValid())return this.localeData().invalidDate();var a,i,s=!1,r=no;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(s=e),"object"==typeof t&&(r=Object.assign({},no,t),null!=t.s&&null==t.ss&&(r.ss=t.s-1)),i=oo(this,!s,r,a=this.localeData()),s&&(i=a.pastFuture(+this,i)),a.postformat(i)}var uo=Math.abs;function po(e){return(e>0)-(e<0)||+e}function mo(){if(!this.isValid())return this.localeData().invalidDate();var e,t,a,i,s,r,l,c,d=uo(this._milliseconds)/1e3,u=uo(this._days),p=uo(this._months),m=this.asSeconds();return m?(e=pe(d/60),t=pe(e/60),d%=60,e%=60,a=pe(p/12),p%=12,i=d?d.toFixed(3).replace(/\.?0+$/,""):"",s=m<0?"-":"",r=po(this._months)!==po(m)?"-":"",l=po(this._days)!==po(m)?"-":"",c=po(this._milliseconds)!==po(m)?"-":"",s+"P"+(a?r+a+"Y":"")+(p?r+p+"M":"")+(u?l+u+"D":"")+(t||e||d?"T":"")+(t?c+t+"H":"")+(e?c+e+"M":"")+(d?c+i+"S":"")):"P0D"}var fo=li.prototype;return fo.isValid=oi,fo.abs=Os,fo.add=Cs,fo.subtract=Es,fo.as=As,fo.asMilliseconds=Ps,fo.asSeconds=qs,fo.asMinutes=Us,fo.asHours=$s,fo.asDays=Ys,fo.asWeeks=Bs,fo.asMonths=Fs,fo.asQuarters=Vs,fo.asYears=Hs,fo.valueOf=Ds,fo._bubble=Ls,fo.clone=Gs,fo.get=Ws,fo.milliseconds=Js,fo.seconds=Ks,fo.minutes=Qs,fo.hours=Xs,fo.days=Zs,fo.weeks=ao,fo.months=eo,fo.years=to,fo.humanize=co,fo.toISOString=mo,fo.toString=mo,fo.toJSON=mo,fo.locale=cn,fo.localeData=un,fo.toIsoString=C("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",mo),fo.lang=dn,F("X",0,0,"unix"),F("x",0,0,"valueOf"),Pe("x",Re),Pe("X",De),Be("X",(function(e,t,a){a._d=new Date(1e3*parseFloat(e))})),Be("x",(function(e,t,a){a._d=new Date(me(e))})),s.version="2.29.4",r(Qa),s.fn=ps,s.min=ti,s.max=ai,s.now=ii,s.utc=g,s.unix=ms,s.months=ws,s.isDate=_,s.locale=ga,s.invalid=v,s.duration=xi,s.isMoment=O,s.weekdays=Ts,s.parseZone=_s,s.localeData=wa,s.isDuration=ci,s.monthsShort=vs,s.weekdaysMin=Ss,s.defineLocale=ya,s.updateLocale=ba,s.locales=va,s.weekdaysShort=ks,s.normalizeUnits=oe,s.relativeTimeRounding=ro,s.relativeTimeThreshold=lo,s.calendarFormat=Fi,s.prototype=ps,s.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},s}()},93764:function(e,t,a){e.exports=(a(84368),a(87968),function(e){function t(i){if(a[i])return a[i].exports;var s=a[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){e.exports=a(34)},function(e,t,a){var i=a(29)("wks"),s=a(33),r=a(2).Symbol,l="function"==typeof r;(e.exports=function(e){return i[e]||(i[e]=l&&r[e]||(l?r:s)("Symbol."+e))}).store=i},function(e,t){var a=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=a)},function(e,t,a){var i=a(9);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,a){e.exports=!a(24)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,a){var i=a(12),s=a(17);e.exports=a(4)?function(e,t,a){return i.f(e,t,s(1,a))}:function(e,t,a){return e[t]=a,e}},function(e,t){var a=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=a)},function(e,t,a){var i=a(14);e.exports=function(e,t,a){if(i(e),void 0===t)return e;switch(a){case 1:return function(a){return e.call(t,a)};case 2:return function(a,i){return e.call(t,a,i)};case 3:return function(a,i,s){return e.call(t,a,i,s)}}return function(){return e.apply(t,arguments)}}},function(e,t){var a={}.hasOwnProperty;e.exports=function(e,t){return a.call(e,t)}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports={}},function(e,t){var a={}.toString;e.exports=function(e){return a.call(e).slice(8,-1)}},function(e,t,a){var i=a(3),s=a(26),r=a(32),l=Object.defineProperty;t.f=a(4)?Object.defineProperty:function(e,t,a){if(i(e),t=r(t,!0),i(a),s)try{return l(e,t,a)}catch(e){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");return"value"in a&&(e[t]=a.value),e}},function(e,t,a){var i=a(42),s=a(15);e.exports=function(e){return i(s(e))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,a){var i=a(9),s=a(2).document,r=i(s)&&i(s.createElement);e.exports=function(e){return r?s.createElement(e):{}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,a){var i=a(12).f,s=a(8),r=a(1)("toStringTag");e.exports=function(e,t,a){e&&!s(e=a?e:e.prototype,r)&&i(e,r,{configurable:!0,value:t})}},function(e,t,a){var i=a(29)("keys"),s=a(33);e.exports=function(e){return i[e]||(i[e]=s(e))}},function(e,t){var a=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:a)(e)}},function(e,t,a){var i=a(11),s=a(1)("toStringTag"),r="Arguments"==i(function(){return arguments}()),l=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,a,c;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(a=l(t=Object(e),s))?a:r?i(t):"Object"==(c=i(t))&&"function"==typeof t.callee?"Arguments":c}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,a){var i=a(2),s=a(6),r=a(7),l=a(5),c="prototype",d=function(e,t,a){var u,p,m,_=e&d.F,f=e&d.G,h=e&d.S,g=e&d.P,y=e&d.B,b=e&d.W,w=f?s:s[t]||(s[t]={}),v=w[c],T=f?i:h?i[t]:(i[t]||{})[c];for(u in f&&(a=t),a)(p=!_&&T&&void 0!==T[u])&&u in w||(m=p?T[u]:a[u],w[u]=f&&"function"!=typeof T[u]?a[u]:y&&p?r(m,i):b&&T[u]==m?function(e){var t=function(t,a,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,a)}return new e(t,a,i)}return e.apply(this,arguments)};return t[c]=e[c],t}(m):g&&"function"==typeof m?r(Function.call,m):m,g&&((w.virtual||(w.virtual={}))[u]=m,e&d.R&&v&&!v[u]&&l(v,u,m)))};d.F=1,d.G=2,d.S=4,d.P=8,d.B=16,d.W=32,d.U=64,d.R=128,e.exports=d},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,a){e.exports=a(2).document&&document.documentElement},function(e,t,a){e.exports=!a(4)&&!a(24)((function(){return 7!=Object.defineProperty(a(16)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,a){"use strict";var i=a(28),s=a(23),r=a(57),l=a(5),c=a(8),d=a(10),u=a(45),p=a(18),m=a(52),_=a(1)("iterator"),f=!([].keys&&"next"in[].keys()),h="@@iterator",g="keys",y="values",b=function(){return this};e.exports=function(e,t,a,w,v,T,k){u(a,t,w);var S,M,O,I=function(e){if(!f&&e in L)return L[e];switch(e){case g:case y:return function(){return new a(this,e)}}return function(){return new a(this,e)}},C=t+" Iterator",E=v==y,x=!1,L=e.prototype,R=L[_]||L[h]||v&&L[v],N=R||I(v),A=v?E?I("entries"):N:void 0,D="Array"==t&&L.entries||R;if(D&&(O=m(D.call(new e)))!==Object.prototype&&(p(O,C,!0),i||c(O,_)||l(O,_,b)),E&&R&&R.name!==y&&(x=!0,N=function(){return R.call(this)}),i&&!k||!f&&!x&&L[_]||l(L,_,N),d[t]=N,d[C]=b,v)if(S={values:E?N:I(y),keys:T?N:I(g),entries:A},k)for(M in S)M in L||r(L,M,S[M]);else s(s.P+s.F*(f||x),t,S);return S}},function(e,t){e.exports=!0},function(e,t,a){var i=a(2),s="__core-js_shared__",r=i[s]||(i[s]={});e.exports=function(e){return r[e]||(r[e]={})}},function(e,t,a){var i,s,r,l=a(7),c=a(41),d=a(25),u=a(16),p=a(2),m=p.process,_=p.setImmediate,f=p.clearImmediate,h=p.MessageChannel,g=0,y={},b="onreadystatechange",w=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},v=function(e){w.call(e.data)};_&&f||(_=function(e){for(var t=[],a=1;arguments.length>a;)t.push(arguments[a++]);return y[++g]=function(){c("function"==typeof e?e:Function(e),t)},i(g),g},f=function(e){delete y[e]},"process"==a(11)(m)?i=function(e){m.nextTick(l(w,e,1))}:h?(r=(s=new h).port2,s.port1.onmessage=v,i=l(r.postMessage,r,1)):p.addEventListener&&"function"==typeof postMessage&&!p.importScripts?(i=function(e){p.postMessage(e+"","*")},p.addEventListener("message",v,!1)):i=b in u("script")?function(e){d.appendChild(u("script"))[b]=function(){d.removeChild(this),w.call(e)}}:function(e){setTimeout(l(w,e,1),0)}),e.exports={set:_,clear:f}},function(e,t,a){var i=a(20),s=Math.min;e.exports=function(e){return e>0?s(i(e),9007199254740991):0}},function(e,t,a){var i=a(9);e.exports=function(e,t){if(!i(e))return e;var a,s;if(t&&"function"==typeof(a=e.toString)&&!i(s=a.call(e)))return s;if("function"==typeof(a=e.valueOf)&&!i(s=a.call(e)))return s;if(!t&&"function"==typeof(a=e.toString)&&!i(s=a.call(e)))return s;throw TypeError("Can't convert object to primitive value")}},function(e,t){var a=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++a+i).toString(36))}},function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(){return"win32"!==process.platform?"":"ia32"===process.arch&&process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432")?"mixed":"native"}function r(e){return(0,m.createHash)("sha256").update(e).digest("hex")}function l(e){switch(_){case"darwin":return e.split("IOPlatformUUID")[1].split("\n")[0].replace(/\=|\s+|\"/gi,"").toLowerCase();case"win32":return e.toString().split("REG_SZ")[1].replace(/\r+|\n+|\s+/gi,"").toLowerCase();case"linux":case"freebsd":return e.toString().replace(/\r+|\n+|\s+/gi,"").toLowerCase();default:throw new Error("Unsupported platform: "+process.platform)}}function c(e){var t=l((0,p.execSync)(f[_]).toString());return e?t:r(t)}function d(e){return new u.default((function(t,a){return(0,p.exec)(f[_],{},(function(i,s,c){if(i)return a(new Error("Error while obtaining machine id: "+i.stack));var d=l(s.toString());return t(e?d:r(d))}))}))}Object.defineProperty(t,"__esModule",{value:!0});var u=i(a(35));t.machineIdSync=c,t.machineId=d;var p=a(70),m=a(71),_=process.platform,f={darwin:"ioreg -rd1 -c IOPlatformExpertDevice",win32:{native:"%windir%\\System32",mixed:"%windir%\\sysnative\\cmd.exe /c %windir%\\System32"}[s()]+"\\REG.exe QUERY HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid",linux:"( cat /var/lib/dbus/machine-id /etc/machine-id 2> /dev/null || hostname ) | head -n 1 || :",freebsd:"kenv -q smbios.system.uuid || sysctl -n kern.hostuuid"}},function(e,t,a){e.exports={default:a(36),__esModule:!0}},function(e,t,a){a(66),a(68),a(69),a(67),e.exports=a(6).Promise},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t,a,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(a+": incorrect invocation!");return e}},function(e,t,a){var i=a(13),s=a(31),r=a(62);e.exports=function(e){return function(t,a,l){var c,d=i(t),u=s(d.length),p=r(l,u);if(e&&a!=a){for(;u>p;)if((c=d[p++])!=c)return!0}else for(;u>p;p++)if((e||p in d)&&d[p]===a)return e||p||0;return!e&&-1}}},function(e,t,a){var i=a(7),s=a(44),r=a(43),l=a(3),c=a(31),d=a(64),u={},p={};t=e.exports=function(e,t,a,m,_){var f,h,g,y,b=_?function(){return e}:d(e),w=i(a,m,t?2:1),v=0;if("function"!=typeof b)throw TypeError(e+" is not iterable!");if(r(b)){for(f=c(e.length);f>v;v++)if((y=t?w(l(h=e[v])[0],h[1]):w(e[v]))===u||y===p)return y}else for(g=b.call(e);!(h=g.next()).done;)if((y=s(g,w,h.value,t))===u||y===p)return y},t.BREAK=u,t.RETURN=p},function(e,t){e.exports=function(e,t,a){var i=void 0===a;switch(t.length){case 0:return i?e():e.call(a);case 1:return i?e(t[0]):e.call(a,t[0]);case 2:return i?e(t[0],t[1]):e.call(a,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(a,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(a,t[0],t[1],t[2],t[3])}return e.apply(a,t)}},function(e,t,a){var i=a(11);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,a){var i=a(10),s=a(1)("iterator"),r=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||r[s]===e)}},function(e,t,a){var i=a(3);e.exports=function(e,t,a,s){try{return s?t(i(a)[0],a[1]):t(a)}catch(t){var r=e.return;throw void 0!==r&&i(r.call(e)),t}}},function(e,t,a){"use strict";var i=a(49),s=a(17),r=a(18),l={};a(5)(l,a(1)("iterator"),(function(){return this})),e.exports=function(e,t,a){e.prototype=i(l,{next:s(1,a)}),r(e,t+" Iterator")}},function(e,t,a){var i=a(1)("iterator"),s=!1;try{var r=[7][i]();r.return=function(){s=!0},Array.from(r,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!s)return!1;var a=!1;try{var r=[7],l=r[i]();l.next=function(){return{done:a=!0}},r[i]=function(){return l},e(r)}catch(e){}return a}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,a){var i=a(2),s=a(30).set,r=i.MutationObserver||i.WebKitMutationObserver,l=i.process,c=i.Promise,d="process"==a(11)(l);e.exports=function(){var e,t,a,u=function(){var i,s;for(d&&(i=l.domain)&&i.exit();e;){s=e.fn,e=e.next;try{s()}catch(i){throw e?a():t=void 0,i}}t=void 0,i&&i.enter()};if(d)a=function(){l.nextTick(u)};else if(r){var p=!0,m=document.createTextNode("");new r(u).observe(m,{characterData:!0}),a=function(){m.data=p=!p}}else if(c&&c.resolve){var _=c.resolve();a=function(){_.then(u)}}else a=function(){s.call(i,u)};return function(i){var s={fn:i,next:void 0};t&&(t.next=s),e||(e=s,a()),t=s}}},function(e,t,a){var i=a(3),s=a(50),r=a(22),l=a(19)("IE_PROTO"),c=function(){},d="prototype",u=function(){var e,t=a(16)("iframe"),i=r.length,s=">";for(t.style.display="none",a(25).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object</script"+s),e.close(),u=e.F;i--;)delete u[d][r[i]];return u()};e.exports=Object.create||function(e,t){var a;return null!==e?(c[d]=i(e),a=new c,c[d]=null,a[l]=e):a=u(),void 0===t?a:s(a,t)}},function(e,t,a){var i=a(12),s=a(3),r=a(54);e.exports=a(4)?Object.defineProperties:function(e,t){s(e);for(var a,l=r(t),c=l.length,d=0;c>d;)i.f(e,a=l[d++],t[a]);return e}},function(e,t,a){var i=a(55),s=a(17),r=a(13),l=a(32),c=a(8),d=a(26),u=Object.getOwnPropertyDescriptor;t.f=a(4)?u:function(e,t){if(e=r(e),t=l(t,!0),d)try{return u(e,t)}catch(e){}if(c(e,t))return s(!i.f.call(e,t),e[t])}},function(e,t,a){var i=a(8),s=a(63),r=a(19)("IE_PROTO"),l=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=s(e),i(e,r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?l:null}},function(e,t,a){var i=a(8),s=a(13),r=a(39)(!1),l=a(19)("IE_PROTO");e.exports=function(e,t){var a,c=s(e),d=0,u=[];for(a in c)a!=l&&i(c,a)&&u.push(a);for(;t.length>d;)i(c,a=t[d++])&&(~r(u,a)||u.push(a));return u}},function(e,t,a){var i=a(53),s=a(22);e.exports=Object.keys||function(e){return i(e,s)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,a){var i=a(5);e.exports=function(e,t,a){for(var s in t)a&&e[s]?e[s]=t[s]:i(e,s,t[s]);return e}},function(e,t,a){e.exports=a(5)},function(e,t,a){var i=a(9),s=a(3),r=function(e,t){if(s(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{(i=a(7)(Function.call,a(51).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,a){return r(e,a),t?e.__proto__=a:i(e,a),e}}({},!1):void 0),check:r}},function(e,t,a){"use strict";var i=a(2),s=a(6),r=a(12),l=a(4),c=a(1)("species");e.exports=function(e){var t="function"==typeof s[e]?s[e]:i[e];l&&t&&!t[c]&&r.f(t,c,{configurable:!0,get:function(){return this}})}},function(e,t,a){var i=a(3),s=a(14),r=a(1)("species");e.exports=function(e,t){var a,l=i(e).constructor;return void 0===l||null==(a=i(l)[r])?t:s(a)}},function(e,t,a){var i=a(20),s=a(15);e.exports=function(e){return function(t,a){var r,l,c=String(s(t)),d=i(a),u=c.length;return d<0||d>=u?e?"":void 0:(r=c.charCodeAt(d))<55296||r>56319||d+1===u||(l=c.charCodeAt(d+1))<56320||l>57343?e?c.charAt(d):r:e?c.slice(d,d+2):l-56320+(r-55296<<10)+65536}}},function(e,t,a){var i=a(20),s=Math.max,r=Math.min;e.exports=function(e,t){return(e=i(e))<0?s(e+t,0):r(e,t)}},function(e,t,a){var i=a(15);e.exports=function(e){return Object(i(e))}},function(e,t,a){var i=a(21),s=a(1)("iterator"),r=a(10);e.exports=a(6).getIteratorMethod=function(e){if(null!=e)return e[s]||e["@@iterator"]||r[i(e)]}},function(e,t,a){"use strict";var i=a(37),s=a(47),r=a(10),l=a(13);e.exports=a(27)(Array,"Array",(function(e,t){this._t=l(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,a=this._i++;return!e||a>=e.length?(this._t=void 0,s(1)):s(0,"keys"==t?a:"values"==t?e[a]:[a,e[a]])}),"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},function(e,t){},function(e,t,a){"use strict";var i,s,r,l=a(28),c=a(2),d=a(7),u=a(21),p=a(23),m=a(9),_=(a(3),a(14)),f=a(38),h=a(40),g=(a(58).set,a(60)),y=a(30).set,b=a(48)(),w="Promise",v=c.TypeError,T=c.process,k=c[w],S="process"==u(T=c.process),M=function(){},O=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[a(1)("species")]=function(e){e(M,M)};return(S||"function"==typeof PromiseRejectionEvent)&&e.then(M)instanceof t}catch(e){}}(),I=function(e,t){return e===t||e===k&&t===r},C=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},E=function(e){return I(k,e)?new x(e):new s(e)},x=s=function(e){var t,a;this.promise=new e((function(e,i){if(void 0!==t||void 0!==a)throw v("Bad Promise constructor");t=e,a=i})),this.resolve=_(t),this.reject=_(a)},L=function(e){try{e()}catch(e){return{error:e}}},R=function(e,t){if(!e._n){e._n=!0;var a=e._c;b((function(){for(var i=e._v,s=1==e._s,r=0,l=function(t){var a,r,l=s?t.ok:t.fail,c=t.resolve,d=t.reject,u=t.domain;try{l?(s||(2==e._h&&D(e),e._h=1),!0===l?a=i:(u&&u.enter(),a=l(i),u&&u.exit()),a===t.promise?d(v("Promise-chain cycle")):(r=C(a))?r.call(a,c,d):c(a)):d(i)}catch(e){d(e)}};a.length>r;)l(a[r++]);e._c=[],e._n=!1,t&&!e._h&&N(e)}))}},N=function(e){y.call(c,(function(){var t,a,i,s=e._v;if(A(e)&&(t=L((function(){S?T.emit("unhandledRejection",s,e):(a=c.onunhandledrejection)?a({promise:e,reason:s}):(i=c.console)&&i.error&&i.error("Unhandled promise rejection",s)})),e._h=S||A(e)?2:1),e._a=void 0,t)throw t.error}))},A=function(e){if(1==e._h)return!1;for(var t,a=e._a||e._c,i=0;a.length>i;)if((t=a[i++]).fail||!A(t.promise))return!1;return!0},D=function(e){y.call(c,(function(){var t;S?T.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},P=function(e){var t,a=this;if(!a._d){a._d=!0,a=a._w||a;try{if(a===e)throw v("Promise can't be resolved itself");(t=C(e))?b((function(){var i={_w:a,_d:!1};try{t.call(e,d(P,i,1),d(j,i,1))}catch(e){j.call(i,e)}})):(a._v=e,a._s=1,R(a,!1))}catch(e){j.call({_w:a,_d:!1},e)}}};O||(k=function(e){f(this,k,w,"_h"),_(e),i.call(this);try{e(d(P,this,1),d(j,this,1))}catch(e){j.call(this,e)}},(i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=a(56)(k.prototype,{then:function(e,t){var a=E(g(this,k));return a.ok="function"!=typeof e||e,a.fail="function"==typeof t&&t,a.domain=S?T.domain:void 0,this._c.push(a),this._a&&this._a.push(a),this._s&&R(this,!1),a.promise},catch:function(e){return this.then(void 0,e)}}),x=function(){var e=new i;this.promise=e,this.resolve=d(P,e,1),this.reject=d(j,e,1)}),p(p.G+p.W+p.F*!O,{Promise:k}),a(18)(k,w),a(59)(w),r=a(6)[w],p(p.S+p.F*!O,w,{reject:function(e){var t=E(this);return(0,t.reject)(e),t.promise}}),p(p.S+p.F*(l||!O),w,{resolve:function(e){if(e instanceof k&&I(e.constructor,this))return e;var t=E(this);return(0,t.resolve)(e),t.promise}}),p(p.S+p.F*!(O&&a(46)((function(e){k.all(e).catch(M)}))),w,{all:function(e){var t=this,a=E(t),i=a.resolve,s=a.reject,r=L((function(){var a=[],r=0,l=1;h(e,!1,(function(e){var c=r++,d=!1;a.push(void 0),l++,t.resolve(e).then((function(e){d||(d=!0,a[c]=e,--l||i(a))}),s)})),--l||i(a)}));return r&&s(r.error),a.promise},race:function(e){var t=this,a=E(t),i=a.reject,s=L((function(){h(e,!1,(function(e){t.resolve(e).then(a.resolve,i)}))}));return s&&i(s.error),a.promise}})},function(e,t,a){"use strict";var i=a(61)(!0);a(27)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,a=this._i;return a>=t.length?{value:void 0,done:!0}:(e=i(t,a),this._i+=e.length,{value:e,done:!1})}))},function(e,t,a){a(65);for(var i=a(2),s=a(5),r=a(10),l=a(1)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],d=0;d<5;d++){var u=c[d],p=i[u],m=p&&p.prototype;m&&!m[l]&&s(m,l,u),r[u]=r.Array}},function(e,t){e.exports=a(84368)},function(e,t){e.exports=a(87968)}]))},4536:(e,t,a)=>{"use strict";const{Readable:i,Writable:s,Duplex:r,Transform:l}=a(48378),c=Symbol.for("object-stream.none"),d=Symbol.for("object-stream.final"),u=Symbol.for("object-stream.many"),p=e=>new l({writableObjectMode:!0,readableObjectMode:!0,transform(t,a,i){try{const s=e.call(this,t,a);if(s&&"function"==typeof s.then)return void s.then((e=>(Chain.sanitize(e,this),i(null))),(e=>i(e)));if(s&&"function"==typeof s.next)return void(async(e,t)=>{for(;;){let a=e.next();if(a&&"function"==typeof a.then&&(a=await a),a.done)break;let i=a.value;i&&"function"==typeof i.then&&(i=await i),Chain.sanitize(i,t)}})(s,this).then((()=>i(null)),(e=>i(e)));Chain.sanitize(s,this),i(null)}catch(e){i(e)}}}),m=e=>new l({writableObjectMode:!0,readableObjectMode:!0,transform(t,a,i){try{let s=t;for(let t=0;t<e.length;++t){const r=e[t].call(this,s,a);if(r===Chain.none)return void i(null);if(Chain.isFinal(r)){s=Chain.getFinalValue(r);break}s=r}Chain.sanitize(s,this),i(null)}catch(e){i(e)}}}),_=e=>e&&"function"==typeof e.pipe&&"function"==typeof e.on&&(!e._writableState||!1!==("object"==typeof e._readableState?e._readableState.readable:null))&&(!e._writableState||e._readableState),f=e=>e&&"function"==typeof e.write&&"function"==typeof e.on&&(!e._readableState||!1!==("object"==typeof e._writableState?e._writableState.writable:null));class Chain extends r{constructor(e,t){if(super(t||{writableObjectMode:!0,readableObjectMode:!0}),!(e instanceof Array&&e.length))throw Error("Chain's argument should be a non-empty array.");this.streams=e.filter((e=>e)).map(((e,t,a)=>{if("function"==typeof e||e instanceof Array)return Chain.convertToTransform(e);if((i=e)&&"function"==typeof i.pipe&&i._readableState&&"function"==typeof i.on&&"function"==typeof i.write||!t&&_(e)||t===a.length-1&&f(e))return e;var i;throw Error("Arguments should be functions, arrays or streams.")})).filter((e=>e)),this.input=this.streams[0],this.output=this.streams.reduce(((e,t)=>e&&e.pipe(t)||t)),f(this.input)||(this._write=(e,t,a)=>a(null),this._final=e=>e(null),this.input.on("end",(()=>this.end()))),_(this.output)?(this.output.on("data",(e=>!this.push(e)&&this.output.pause())),this.output.on("end",(()=>this.push(null)))):(this._read=()=>{},this.resume(),this.output.on("finish",(()=>this.push(null)))),t&&t.skipEvents||this.streams.forEach((e=>e.on("error",(e=>this.emit("error",e)))))}_write(e,t,a){let i=null;try{this.input.write(e,t,(e=>a(e||i)))}catch(e){i=e}}_final(e){let t=null;try{this.input.end(null,null,(a=>e(a||t)))}catch(e){t=e}}_read(){this.output.resume()}static make(e,t){return new Chain(e,t)}static sanitize(e,t){Chain.isFinal(e)?e=Chain.getFinalValue(e):Chain.isMany(e)&&(e=Chain.getManyValues(e)),null!=e&&e!==Chain.none&&(e instanceof Array?e.forEach((e=>null!=e&&t.push(e))):t.push(e))}static convertToTransform(e){return"function"==typeof e?p(e):e instanceof Array&&e.length?m(e):null}}Chain.none=c,Chain.final=e=>({[d]:e}),Chain.isFinal=e=>e&&"object"==typeof e&&d in e,Chain.getFinalValue=e=>e[d],Chain.many=e=>({[u]:e}),Chain.isMany=e=>e&&"object"==typeof e&&u in e,Chain.getManyValues=e=>e[u],Chain.chain=Chain.make,Chain.make.Constructor=Chain,e.exports=Chain},71192:(e,t,a)=>{"use strict";const i=a(90467),s=e=>function(){this.done?this.done=!1:this.stack.push(this.current,this.key),this.current=new e,this.key=null};class Assembler extends i{static connectTo(e,t){return new Assembler(t).connectTo(e)}constructor(e){super(),this.stack=[],this.current=this.key=null,this.done=!0,e&&(this.reviver="function"==typeof e.reviver&&e.reviver,this.reviver&&(this.stringValue=this._saveValue=this._saveValueWithReviver),e.numberAsString&&(this.numberValue=this.stringValue))}connectTo(e){return e.on("data",(e=>{this[e.name]&&(this[e.name](e.value),this.done&&this.emit("done",this))})),this}get depth(){return(this.stack.length>>1)+(this.done?0:1)}get path(){const e=[];for(let t=0;t<this.stack.length;t+=2){const a=this.stack[t+1];e.push(null===a?this.stack[t].length:a)}return e}dropToLevel(e){if(e<this.depth)if(e){const t=e-1<<1;this.current=this.stack[t],this.key=this.stack[t+1],this.stack.splice(t)}else this.stack=[],this.current=this.key=null,this.done=!0;return this}consume(e){return this[e.name]&&this[e.name](e.value),this}keyValue(e){this.key=e}numberValue(e){this._saveValue(parseFloat(e))}nullValue(){this._saveValue(null)}trueValue(){this._saveValue(!0)}falseValue(){this._saveValue(!1)}endObject(){if(this.stack.length){const e=this.current;this.key=this.stack.pop(),this.current=this.stack.pop(),this._saveValue(e)}else this.done=!0}_saveValue(e){this.done?this.current=e:this.current instanceof Array?this.current.push(e):(this.current[this.key]=e,this.key=null)}_saveValueWithReviver(e){this.done?this.current=this.reviver("",e):this.current instanceof Array?(e=this.reviver(""+this.current.length,e),this.current.push(e),void 0===e&&delete this.current[this.current.length-1]):(void 0!==(e=this.reviver(this.key,e))&&(this.current[this.key]=e),this.key=null)}}Assembler.prototype.stringValue=Assembler.prototype._saveValue,Assembler.prototype.startObject=s(Object),Assembler.prototype.startArray=s(Array),Assembler.prototype.endArray=Assembler.prototype.endObject,e.exports=Assembler},44680:(e,t,a)=>{"use strict";const i=a(68240),s={value1:/^(?:[\"\{\[\]\-\d]|true\b|false\b|null\b|\s{1,256})/,string:/^(?:[^\"\\]{1,256}|\\[bfnrt\"\\\/]|\\u[\da-fA-F]{4}|\")/,key1:/^(?:[\"\}]|\s{1,256})/,colon:/^(?:\:|\s{1,256})/,comma:/^(?:[\,\]\}]|\s{1,256})/,ws:/^\s{1,256}/,numberStart:/^\d/,numberDigit:/^\d{0,256}/,numberFraction:/^[\.eE]/,numberExponent:/^[eE]/,numberExpSign:/^[-+]/};let r=!0;try{new RegExp(".","y"),r=!1}catch(e){}!r&&Object.keys(s).forEach((e=>{let t=s[e].source.slice(1);"(?:"===t.slice(0,3)&&")"===t.slice(-1)&&(t=t.slice(3,-1)),s[e]=new RegExp(t,"y")})),s.numberFracStart=s.numberExpStart=s.numberStart,s.numberFracDigit=s.numberExpDigit=s.numberDigit;const l={true:!0,false:!1,null:null},c={object:"objectStop",array:"arrayStop","":"done"},d={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",'"':'"',"\\":"\\","/":"/"};class Parser extends i{static make(e){return new Parser(e)}constructor(e){super(Object.assign({},e,{readableObjectMode:!0})),this._packKeys=this._packStrings=this._packNumbers=this._streamKeys=this._streamStrings=this._streamNumbers=!0,e&&("packValues"in e&&(this._packKeys=this._packStrings=this._packNumbers=e.packValues),"packKeys"in e&&(this._packKeys=e.packKeys),"packStrings"in e&&(this._packStrings=e.packStrings),"packNumbers"in e&&(this._packNumbers=e.packNumbers),"streamValues"in e&&(this._streamKeys=this._streamStrings=this._streamNumbers=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys),"streamStrings"in e&&(this._streamStrings=e.streamStrings),"streamNumbers"in e&&(this._streamNumbers=e.streamNumbers),this._jsonStreaming=e.jsonStreaming),!this._packKeys&&(this._streamKeys=!0),!this._packStrings&&(this._streamStrings=!0),!this._packNumbers&&(this._streamNumbers=!0),this._done=!1,this._expect=this._jsonStreaming?"done":"value",this._stack=[],this._parent="",this._open_number=!1,this._accumulator=""}_flush(e){this._done=!0,super._flush((t=>{if(t)return e(t);this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),e(null)}))}_processBuffer(e){let t,a,i=0;e:for(;;)switch(this._expect){case"value1":case"value":if(s.value1.lastIndex=i,t=s.value1.exec(this._buffer),!t){if(this._done||i+16<this._buffer.length)return i<this._buffer.length?e(new Error("Parser cannot parse input: expected a value")):e(new Error("Parser has expected a value"));break e}switch(a=t[0],a){case'"':this._streamStrings&&this.push({name:"startString"}),this._expect="string";break;case"{":this.push({name:"startObject"}),this._stack.push(this._parent),this._parent="object",this._expect="key1";break;case"[":this.push({name:"startArray"}),this._stack.push(this._parent),this._parent="array",this._expect="value1";break;case"]":if("value1"!==this._expect)return e(new Error("Parser cannot parse input: unexpected token ']'"));this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),this.push({name:"endArray"}),this._parent=this._stack.pop(),this._expect=c[this._parent];break;case"-":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"-"})),this._packNumbers&&(this._accumulator="-"),this._expect="numberStart";break;case"0":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"0"})),this._packNumbers&&(this._accumulator="0"),this._expect="numberFraction";break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:a})),this._packNumbers&&(this._accumulator=a),this._expect="numberDigit";break;case"true":case"false":case"null":if(this._buffer.length-i===a.length&&!this._done)break e;this.push({name:a+"Value",value:l[a]}),this._expect=c[this._parent]}r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"keyVal":case"string":if(s.string.lastIndex=i,t=s.string.exec(this._buffer),!t){if(i<this._buffer.length&&(this._done||this._buffer.length-i>=6))return e(new Error("Parser cannot parse input: escaped characters"));if(this._done)return e(new Error("Parser has expected a string value"));break e}if(a=t[0],'"'===a)"keyVal"===this._expect?(this._streamKeys&&this.push({name:"endKey"}),this._packKeys&&(this.push({name:"keyValue",value:this._accumulator}),this._accumulator=""),this._expect="colon"):(this._streamStrings&&this.push({name:"endString"}),this._packStrings&&(this.push({name:"stringValue",value:this._accumulator}),this._accumulator=""),this._expect=c[this._parent]);else if(a.length>1&&"\\"===a.charAt(0)){const e=2==a.length?d[a.charAt(1)]:(u=a,String.fromCharCode(parseInt(u.slice(2),16)));("keyVal"===this._expect?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:e}),("keyVal"===this._expect?this._packKeys:this._packStrings)&&(this._accumulator+=e)}else("keyVal"===this._expect?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:a}),("keyVal"===this._expect?this._packKeys:this._packStrings)&&(this._accumulator+=a);r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"key1":case"key":if(s.key1.lastIndex=i,t=s.key1.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an object key"));break e}if(a=t[0],'"'===a)this._streamKeys&&this.push({name:"startKey"}),this._expect="keyVal";else if("}"===a){if("key1"!==this._expect)return e(new Error("Parser cannot parse input: unexpected token '}'"));this.push({name:"endObject"}),this._parent=this._stack.pop(),this._expect=c[this._parent]}r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"colon":if(s.colon.lastIndex=i,t=s.colon.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ':'"));break e}a=t[0],":"===a&&(this._expect="value"),r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"arrayStop":case"objectStop":if(s.comma.lastIndex=i,t=s.comma.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ','"));break e}if(this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),a=t[0],","===a)this._expect="arrayStop"===this._expect?"value":"key";else if("}"===a||"]"===a){if("}"===a?"arrayStop"===this._expect:"arrayStop"!==this._expect)return e(new Error("Parser cannot parse input: expected '"+("arrayStop"===this._expect?"]":"}")+"'"));this.push({name:"}"===a?"endObject":"endArray"}),this._parent=this._stack.pop(),this._expect=c[this._parent]}r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberStart":if(s.numberStart.lastIndex=i,t=s.numberStart.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a starting digit"));break e}a=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),this._expect="0"===a?"numberFraction":"numberDigit",r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberDigit":if(s.numberDigit.lastIndex=i,t=s.numberDigit.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a digit"));break e}if(a=t[0],!a){if(i<this._buffer.length){this._expect="numberFraction";break}if(this._done){this._expect=c[this._parent];break}break e}this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberFraction":if(s.numberFraction.lastIndex=i,t=s.numberFraction.exec(this._buffer),!t){if(i<this._buffer.length||this._done){this._expect=c[this._parent];break}break e}a=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),this._expect="."===a?"numberFracStart":"numberExpSign",r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberFracStart":if(s.numberFracStart.lastIndex=i,t=s.numberFracStart.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a fractional part of a number"));break e}a=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),this._expect="numberFracDigit",r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberFracDigit":if(s.numberFracDigit.lastIndex=i,t=s.numberFracDigit.exec(this._buffer),a=t[0],!a){if(i<this._buffer.length){this._expect="numberExponent";break}if(this._done){this._expect=c[this._parent];break}break e}this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberExponent":if(s.numberExponent.lastIndex=i,t=s.numberExponent.exec(this._buffer),!t){if(i<this._buffer.length){this._expect=c[this._parent];break}if(this._done){this._expect="done";break}break e}a=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),this._expect="numberExpSign",r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberExpSign":if(s.numberExpSign.lastIndex=i,t=s.numberExpSign.exec(this._buffer),!t){if(i<this._buffer.length){this._expect="numberExpStart";break}if(this._done)return e(new Error("Parser has expected an exponent value of a number"));break e}a=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),this._expect="numberExpStart",r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberExpStart":if(s.numberExpStart.lastIndex=i,t=s.numberExpStart.exec(this._buffer),!t){if(i<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an exponent part of a number"));break e}a=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),this._expect="numberExpDigit",r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"numberExpDigit":if(s.numberExpDigit.lastIndex=i,t=s.numberExpDigit.exec(this._buffer),a=t[0],!a){if(i<this._buffer.length||this._done){this._expect=c[this._parent];break}break e}this._streamNumbers&&this.push({name:"numberChunk",value:a}),this._packNumbers&&(this._accumulator+=a),r?this._buffer=this._buffer.slice(a.length):i+=a.length;break;case"done":if(s.ws.lastIndex=i,t=s.ws.exec(this._buffer),!t){if(i<this._buffer.length){if(this._jsonStreaming){this._expect="value";break}return e(new Error("Parser cannot parse input: unexpected characters"))}break e}a=t[0],this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),r?this._buffer=this._buffer.slice(a.length):i+=a.length}var u;!r&&(this._buffer=this._buffer.slice(i)),e(null)}}Parser.parser=Parser.make,Parser.make.Constructor=Parser,e.exports=Parser},47448:(e,t,a)=>{"use strict";const{Transform:i}=a(48378);class FilterBase extends i{static stringFilter(e,t){return a=>{const i=a.join(t);return i.length===e.length&&i===e||i.length>e.length&&i.substr(0,e.length)===e&&i.substr(e.length,t.length)===t}}static regExpFilter(e,t){return a=>e.test(a.join(t))}static arrayReplacement(e){return()=>e}constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),this._transform=this._check,this._stack=[];const t=e&&e.filter,a=e&&e.pathSeparator||".";"string"==typeof t?this._filter=FilterBase.stringFilter(t,a):"function"==typeof t?this._filter=t:t instanceof RegExp&&(this._filter=FilterBase.regExpFilter(t,a));const i=e&&e.replacement;this._replacement="function"==typeof i?i:FilterBase.arrayReplacement(i||FilterBase.defaultReplacement),this._allowEmptyReplacement=e&&e.allowEmptyReplacement,this._streamKeys=!0,e&&("streamValues"in e&&(this._streamKeys=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys)),this._once=e&&e.once,this._previousToken=""}_check(e,t,a){switch(e.name){case"startObject":case"startArray":case"startString":case"startNumber":case"nullValue":case"trueValue":case"falseValue":"number"==typeof this._stack[this._stack.length-1]&&++this._stack[this._stack.length-1];break;case"keyValue":this._stack[this._stack.length-1]=e.value;break;case"numberValue":"endNumber"!==this._previousToken&&"number"==typeof this._stack[this._stack.length-1]&&++this._stack[this._stack.length-1];break;case"stringValue":"endString"!==this._previousToken&&"number"==typeof this._stack[this._stack.length-1]&&++this._stack[this._stack.length-1]}if(this._previousToken=e.name,this._checkChunk(e))return a(null);switch(e.name){case"startObject":this._stack.push(null);break;case"startArray":this._stack.push(-1);break;case"endObject":case"endArray":this._stack.pop()}a(null)}_passObject(e,t,a){switch(this.push(e),e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth}this._depth||(this._transform=this._once?this._skip:this._check),a(null)}_pass(e,t,a){this.push(e),a(null)}_skipObject(e,t,a){switch(e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth}this._depth||(this._transform=this._once?this._pass:this._check),a(null)}_skip(e,t,a){a(null)}}FilterBase.defaultReplacement=[{name:"nullValue",value:null}];const s=(e,t)=>function(a,i,s){if(this._expected){const e=this._expected;if(this._expected="",this._transform=this._once?this._skip:this._check,e!==a.name)return this._transform(a,i,s);this.push(a)}else this.push(a),a.name===e&&(this._expected=t);s(null)};FilterBase.prototype._passNumber=s("endNumber","numberValue"),FilterBase.prototype._passString=s("endString","stringValue"),FilterBase.prototype._passKey=s("endKey","keyValue");const r=(e,t)=>function(a,i,s){if(this._expected){const e=this._expected;if(this._expected="",this._transform=this._once?this._pass:this._check,e!==a.name)return this._transform(a,i,s)}else a.name===e&&(this._expected=t);s(null)};FilterBase.prototype._skipNumber=r("endNumber","numberValue"),FilterBase.prototype._skipString=r("endString","stringValue"),FilterBase.prototype._skipKey=r("endKey","keyValue"),e.exports=FilterBase},74712:(e,t,a)=>{"use strict";const i=a(69804),s=a(77576);class Ignore extends i{static make(e){return new Ignore(e)}static withParser(e){return s(Ignore.make,e)}constructor(e){super(e),this._replacement=i.arrayReplacement([]),this._allowEmptyReplacement=!0}}Ignore.ignore=Ignore.make,Ignore.make.Constructor=Ignore,e.exports=Ignore},69804:(e,t,a)=>{"use strict";const i=a(47448),s=a(77576);class Replace extends i{static make(e){return new Replace(e)}static withParser(e){return s(Replace.make,e)}_checkChunk(e){switch(e.name){case"startKey":if(this._allowEmptyReplacement)return this._transform=this._skipKeyChunks,!0;break;case"keyValue":if(this._allowEmptyReplacement)return!0;break;case"startObject":case"startArray":case"startString":case"startNumber":case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":if(this._filter(this._stack,e)){let t=this._replacement(this._stack,e);if(this._allowEmptyReplacement){if(t.length){const e=this._stack[this._stack.length-1];"string"==typeof e&&(this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:e}),this.push({name:"endKey"})),this.push({name:"keyValue",value:e}))}}else t.length||(t=i.defaultReplacement);switch(t.forEach((e=>this.push(e))),e.name){case"startObject":case"startArray":this._transform=this._skipObject,this._depth=1;break;case"startString":this._transform=this._skipString;break;case"startNumber":this._transform=this._skipNumber;break;case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":this._transform=this._once?this._pass:this._check}return!0}}if(this._allowEmptyReplacement){const t=this._stack[this._stack.length-1];if("string"==typeof t)switch(e.name){case"startObject":case"startArray":case"startString":case"startNumber":case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:t}),this.push({name:"endKey"})),this.push({name:"keyValue",value:t})}}return this.push(e),!1}_skipKeyChunks(e,t,a){"endKey"===e.name&&(this._transform=this._check),a(null)}}Replace.replace=Replace.make,Replace.make.Constructor=Replace,e.exports=Replace},34416:(e,t,a)=>{"use strict";const{Transform:i}=a(48378),s=a(71192);class Counter{constructor(e){this.depth=e}startObject(){++this.depth}endObject(){--this.depth}startArray(){++this.depth}endArray(){--this.depth}}e.exports=class StreamBase extends i{constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),e&&(this.objectFilter=e.objectFilter,this.includeUndecided=e.includeUndecided),"function"!=typeof this.objectFilter&&(this._filter=this._transform),this._transform=this._wait||this._filter,this._assembler=new s(e)}_transform(e,t,a){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&this._push()),a(null)}_filter(e,t,a){if(this._assembler[e.name]){this._assembler[e.name](e.value);const t=this.objectFilter(this._assembler);if(t)return this._assembler.depth===this._level&&(this._push(),this._transform=this._filter),this._transform=this._accept,a(null);if(!1===t)return this._saved_assembler=this._assembler,this._assembler=new Counter(this._saved_assembler.depth),this._saved_assembler.dropToLevel(this._level),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter),this._transform=this._reject,a(null);this._assembler.depth===this._level&&this._push(!this.includeUndecided)}a(null)}_accept(e,t,a){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._push(),this._transform=this._filter)),a(null)}_reject(e,t,a){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter)),a(null)}}},91196:(e,t,a)=>{"use strict";const i=a(34416),s=a(77576);class StreamObject extends i{static make(e){return new StreamObject(e)}static withParser(e){return s(StreamObject.make,e)}constructor(e){super(e),this._level=1,this._lastKey=null}_wait(e,t,a){return"startObject"!==e.name?a(new Error("Top-level object should be an object.")):(this._transform=this._filter,this._transform(e,t,a))}_push(e){null===this._lastKey?this._lastKey=this._assembler.key:(!e&&this.push({key:this._lastKey,value:this._assembler.current[this._lastKey]}),this._assembler.current={},this._lastKey=null)}}StreamObject.streamObject=StreamObject.make,StreamObject.make.Constructor=StreamObject,e.exports=StreamObject},68240:(e,t,a)=>{"use strict";const{Transform:i}=a(48378),{StringDecoder:s}=a(98680);e.exports=class Utf8Stream extends i{constructor(e){super(Object.assign({},e,{writableObjectMode:!1})),this._buffer=""}_transform(e,t,a){"string"==typeof e?this._transform=this._transformString:(this._stringDecoder=new s,this._transform=this._transformBuffer),this._transform(e,t,a)}_transformBuffer(e,t,a){this._buffer+=this._stringDecoder.write(e),this._processBuffer(a)}_transformString(e,t,a){this._buffer+=e.toString(),this._processBuffer(a)}_processBuffer(e){this._buffer&&(this.push(this._buffer,"utf8"),this._buffer=""),e(null)}_flushInput(){this._stringDecoder&&(this._buffer+=this._stringDecoder.end())}_flush(e){this._flushInput(),this._processBuffer(e)}}},77576:(e,t,a)=>{"use strict";const i=a(4536),s=a(44680);e.exports=(e,t)=>new i([new s(t),e(t)],Object.assign({},t,{writableObjectMode:!1,readableObjectMode:!0}))},76584:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=l(a(67072)),d=a(98496),u=l(a(40274)),p=r(a(79224)),m=a(81104),_=l(a(46520)),f=a(34816),h=l(a(95396)),g=l(a(11068)),y=a(64612),b=a(34052),w=a(62304);_.default.config();class Noco{static get dashboardUrl(){var e,t;return`${`http://localhost:${process.env.PORT||8080}`}${null===(t=null===(e=this._this)||void 0===e?void 0:e.config)||void 0===t?void 0:t.dashboardPath}`}constructor(){process.env.PORT=process.env.PORT||"8080","true"===process.env.NC_MINIMAL_DBS&&(process.env.NC_CONNECT_TO_EXTERNAL_DB_DISABLED="true"),this.router=p.Router(),this.baseRouter=p.Router(),(0,u.default)()}getConfig(){return this.config}getToolDir(){var e;return null===(e=this.getConfig())||void 0===e?void 0:e.toolDir}addToContext(e){this.requestContext=e}static get ncMeta(){return this._ncMeta}get ncMeta(){return Noco._ncMeta}static getConfig(){return this.config}static isEE(){return this.ee||"true"===process.env.NC_CLOUD}static async loadEEState(){try{return this.ee=w.isEE}catch(e){}return this.ee=!1}static async init(e,t,i){var s;const l=await d.NestFactory.create(b.AppModule,{bufferLogs:!0});this.initCustomLogger(l),l.flushLogs();try{this.sharp=(await Promise.resolve().then((()=>r(a(26516))))).default}catch(e){console.error("Sharp is not available for your platform, thumbnail generation will be skipped")}if("true"===process.env.NC_WORKER_CONTAINER){if(!process.env.NC_REDIS_URL)throw new Error("NC_REDIS_URL is required");process.env.NC_DISABLE_TELE="true"}l.useWebSocketAdapter(new f.IoAdapter(t)),this._httpServer=l.getHttpAdapter().getInstance(),this._server=i,l.use(h.default.mw()),l.use((0,g.default)()),l.useWebSocketAdapter(new f.IoAdapter(t)),l.use(p.json({limit:process.env.NC_REQUEST_BODY_SIZE||"50mb"})),await l.init();const u=null!==(s=process.env.NC_DASHBOARD_URL)&&void 0!==s?s:"/dashboard";return i.use(p.static(c.default.join(__dirname,"public"))),"/"!==u&&""!==u&&i.get("/",((e,t)=>t.redirect(u))),l.getHttpAdapter().getInstance()}static get httpServer(){return this._httpServer}static get server(){return this._server}static async initJwt(){var e,t,a,i,s,r;if(null===(t=null===(e=this.config)||void 0===e?void 0:e.auth)||void 0===t?void 0:t.jwt){if(!this.config.auth.jwt.secret){let e=null===(a=await this._ncMeta.metaGet(y.RootScopes.ROOT,y.RootScopes.ROOT,y.MetaTable.STORE,{key:"nc_auth_jwt_secret"}))||void 0===a?void 0:a.value;e||await this._ncMeta.metaInsert2(y.RootScopes.ROOT,y.RootScopes.ROOT,y.MetaTable.STORE,{key:"nc_auth_jwt_secret",value:e=(0,m.v4)()},!0),this.config.auth.jwt.secret=e}this.config.auth.jwt.options=this.config.auth.jwt.options||{},(null===(i=this.config.auth.jwt.options)||void 0===i?void 0:i.expiresIn)||(this.config.auth.jwt.options.expiresIn=null!==(s=process.env.NC_JWT_EXPIRES_IN)&&void 0!==s?s:"10h")}let l=null===(r=await this._ncMeta.metaGet(y.RootScopes.ROOT,y.RootScopes.ROOT,y.MetaTable.STORE,{key:"nc_server_id"}))||void 0===r?void 0:r.value;l||await this._ncMeta.metaInsert2(y.RootScopes.ROOT,y.RootScopes.ROOT,y.MetaTable.STORE,{key:"nc_server_id",value:l=w.T.id},!0),process.env.NC_SERVER_UUID=l}static initCustomLogger(e){}}Noco.env="_noco",t.default=Noco},36136:(e,t)=>{"use strict";var a,i,s,r;Object.defineProperty(t,"__esModule",{value:!0});const l={throttler:{calc_execution_time:!1},basicAuth:{username:null!==(a=process.env.NC_HTTP_BASIC_USER)&&void 0!==a?a:"defaultusername",password:null!==(i=process.env.NC_HTTP_BASIC_PASS)&&void 0!==i?i:"defaultpassword"},auth:{emailPattern:process.env.NC_EMAIL_PATTERN&&new RegExp(process.env.NC_EMAIL_PATTERN),disableEmailAuth:!!process.env.NC_DISABLE_EMAIL_AUTH},mainSubDomain:null!==(s=process.env.NC_MAIN_SUBDOMAIN)&&void 0!==s?s:"app",dashboardPath:null!==(r=process.env.NC_DASHBOARD_URL)&&void 0!==r?r:"/dashboard"};t.default=l},34052:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=t.ceModuleConfig=void 0;const r=a(23324),l=a(98496),c=a(16184),d=a(40628),u=a(62192),p=a(89096),m=a(360),_=a(68544),f=a(32759),h=a(27756),g=a(22120),y=a(5636),b=s(a(36136)),w=a(47932),v=a(45408);t.ceModuleConfig={imports:[m.AuthModule,p.NocoModule,g.EventEmitterModule,y.JobsModule,d.EventEmitterModule.forRoot(),c.ConfigModule.forRoot({load:[()=>b.default],isGlobal:!0}),...process.env.NC_SENTRY_DSN?[u.SentryModule.forRoot({dsn:process.env.NC_SENTRY_DSN,debug:!1,environment:process.env.NODE_ENV,release:v.packageInfo.version,logLevels:["debug"]})]:[]],providers:[{provide:l.APP_FILTER,useClass:_.GlobalExceptionFilter},{provide:l.APP_GUARD,useClass:w.ExtractIdsMiddleware}]};let T=class AppModule{configure(e){var t;const a=null!==(t=process.env.NC_DASHBOARD_URL)&&void 0!==t?t:"/dashboard";e.apply(h.GuiMiddleware).forRoutes({path:`${a}*`,method:r.RequestMethod.GET}).apply(f.GlobalMiddleware).forRoutes({path:"*",method:r.RequestMethod.ALL})}};t.AppModule=T,t.AppModule=T=i([(0,r.Module)(t.ceModuleConfig)],T)},83352:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(89576)),r=a(23324),l=a(64612),c=(0,s.default)("nc:cache"),d=new r.Logger("CacheMgr"),u=+process.env.NC_REDIS_TTL||259200,p=+process.env.NC_REDIS_GRACE_TTL||86400;t.default=class CacheMgr{constructor(){this.getCircularReplacer=()=>{const e=new WeakSet;return(t,a)=>{if("object"==typeof a&&null!==a){if(e.has(a))return;e.add(a)}return a}}}async del(e){if(c(`${this.context}::del: deleting key ${e}`),Array.isArray(e)){if(e.length)return this.client.del(e)}else if(e)return this.client.del(e)}async getRaw(e,t,a=!1){if(c(`${this.context}::getRaw: getting key ${e} with type ${t}`),t===l.CacheGetType.TYPE_ARRAY)return this.client.smembers(e);{const t=await this.client.get(e);if(t)try{const i=JSON.parse(t);if("object"==typeof i){if(i&&0===Object.keys(i).length&&Object.getPrototypeOf(i)===Object.prototype&&c(`${this.context}::get: object is empty!`),!a&&i.timestamp){Date.now()-i.timestamp>1e3*p&&await this.execRefreshTTL(e)}return Promise.resolve(i)}}catch(a){return d.error(`Bad value stored for key ${e} : ${t}`),Promise.resolve(t)}return Promise.resolve(t)}}async get(e,t){return this.getRaw(e,t).then((e=>e&&e.value?e.value:e))}async set(e,t,a={skipPrepare:!1}){const{skipPrepare:i,timestamp:s}=a;if(void 0!==t&&t){if(c(`${this.context}::set: setting key ${e} with value ${this.stringify(t)}`),Array.isArray(t)&&t.length)return new Promise((a=>{this.client.pipeline().sadd(e,t).expire(e,u-60).exec((i=>{i&&d.error(`${this.context}::set: error setting key ${e} with value ${this.stringify(t)}`),a(!0)}))}));if(!i){const a=await this.getRaw(e);t=this.prepareValue({value:t,parentKeys:this.getParents(a),timestamp:s})}return this.client.set(e,JSON.stringify(t,this.getCircularReplacer()),"EX",u).then((async()=>(await this.execRefreshTTL(e,s),!0)))}return c(`${this.context}::set: value is empty for ${e}. Skipping ...`),Promise.resolve(!0)}async setExpiring(e,t,a,i={skipPrepare:!1}){const{skipPrepare:s,timestamp:r}=i;if(void 0!==t&&t){if(c(`${this.context}::setExpiring: setting key ${e} with value ${this.stringify(t)}`),Array.isArray(t)&&t.length)return new Promise((i=>{this.client.pipeline().sadd(e,t).expire(e,a).exec((a=>{a&&d.error(`${this.context}::set: error setting key ${e} with value ${this.stringify(t)}`),i(!0)}))}));if(!s){const a=await this.getRaw(e);t=this.prepareValue({value:t,parentKeys:this.getParents(a),timestamp:r})}return this.client.set(e,JSON.stringify(t,this.getCircularReplacer()),"EX",a)}return c(`${this.context}::set: value is empty for ${e}. Skipping ...`),Promise.resolve(!0)}async incrby(e,t=1){return this.client.incrby(e,t)}async getList(e,t,a){const i=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`,s=await this.get(i,l.CacheGetType.TYPE_ARRAY)||[];c(`${this.context}::getList: getting list with key ${i}`);const r=s.length&&s.includes("NONE");if(r||!s.length)return Promise.resolve({list:[],isNoneList:r});c(`${this.context}::getList: getting list with keys ${s}`);const u=await this.client.mget(s);if(u.some((e=>null===e))){d.error(`${this.context}::getList: missing value for ${i}`);const e=[];u.forEach((t=>{if(t)try{const a=JSON.parse(t);"object"==typeof a&&e.push(...this.getParents(a))}catch(e){d.error(`${this.context}::getList: Bad value stored for key ${s[0]} : ${this.stringify(t)}`)}}));const t=[...new Set(e)];return await Promise.all(t.map((async e=>{await this.deepDel(e,l.CacheDelDirection.PARENT_TO_CHILD)}))),Promise.resolve({list:[],isNoneList:r})}if(u.length)try{const e=JSON.parse(u[0]);if("object"==typeof e){Date.now()-e.timestamp>1e3*p&&await this.execRefreshTTL(i)}}catch(e){d.error(`${this.context}::getList: Bad value stored for key ${s[0]} : ${u[0]}`)}const m=u.map((e=>{try{const t=JSON.parse(e);if("object"==typeof t)return t.value}catch(t){return e}return e}));if(null==a?void 0:a.key){const{key:e,dir:t,isString:i}=a,s="desc"===t?-1:1;m.sort(((t,a)=>{const r=null==t?void 0:t[e],l=null==a?void 0:a[e];return null==r?1:null==l?-1:i?s*String(r).localeCompare(String(l)):s*(r-l)}))}return{list:m,isNoneList:r}}async setList(e,t,a,i=[]){const s=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`;if(!a.length)return this.set(s,["NONE"]);const r=Date.now();await this.deepDel(s,l.CacheDelDirection.PARENT_TO_CHILD);const d=[];for(const t of a){let a=`${this.prefix}:${e}:${t.id}`;if(i.length){const s=i.map((e=>t[e]));a=`${this.prefix}:${e}:${s.join(":")}`}c(`${this.context}::setList: get key ${a}`);let u=await this.getRaw(a,l.CacheGetType.TYPE_OBJECT);u?(c(`${this.context}::setList: preparing key ${a}`),u=this.prepareValue({value:t,parentKeys:this.getParents(u),newKey:s,timestamp:r})):u=this.prepareValue({value:t,parentKeys:[s],timestamp:r}),c(`${this.context}::setList: setting key ${a}`),await this.set(a,u,{skipPrepare:!0,timestamp:r}),d.push(a)}return c(`${this.context}::setList: setting list with key ${s}`),this.set(s,d)}async deepDel(e,t){if(c(`${this.context}::deepDel: choose direction ${t}`),t===l.CacheDelDirection.CHILD_TO_PARENT){const t=await this.getRaw(e,l.CacheGetType.TYPE_OBJECT),a=this.getParents(t);for(const t of a){let a=await this.get(t,l.CacheGetType.TYPE_ARRAY)||[];a.length&&(a=a.filter((t=>t!==e)),c(`${this.context}::deepDel: remove listKey ${t}`),await this.del(t),a.length&&(c(`${this.context}::deepDel: set key ${t}`),await this.set(t,a)))}return c(`${this.context}::deepDel: remove key ${e}`),await this.del(e)}if(t===l.CacheDelDirection.PARENT_TO_CHILD){e=/:list$/.test(e)?e:`${e}:list`;const t=await this.get(e,l.CacheGetType.TYPE_ARRAY);return await this.del(t),await this.del(e)}return c(`Invalid deepDel direction found : ${t}`),Promise.resolve(!1)}async appendToList(e,t,a){var i;const s=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`;c(`${this.context}::appendToList: append key ${a} to ${s}`);let r=await this.get(s,l.CacheGetType.TYPE_ARRAY);if(!r||!r.length)return!1;r.includes("NONE")&&(r=[],await this.del(s)),c(`${this.context}::appendToList: get key ${a}`);const u=await this.getRaw(a,l.CacheGetType.TYPE_OBJECT);if(c(`${this.context}::appendToList: preparing key ${a}`),!u){d.error(`${this.context}::appendToList: value is empty for ${a}`);const i=[];(await this.getList(e,t)).list.forEach((e=>{i.push(...this.getParents(e))}));const s=[...new Set(i)];return await Promise.all(s.map((async e=>{await this.deepDel(e,l.CacheDelDirection.PARENT_TO_CHILD)}))),!1}const p=this.prepareValue({value:null!==(i=u.value)&&void 0!==i?i:u,parentKeys:this.getParents(u),newKey:s});return c(`${this.context}::appendToList: setting key ${a}`),await this.set(a,p,{skipPrepare:!0}),r.push(a),this.set(s,r)}async update(e,t){let a=await this.get(e,l.CacheGetType.TYPE_OBJECT);return a&&(a=Object.assign(Object.assign({},a),t),await this.set(e,a)),!0}prepareValue(e){const{value:t,parentKeys:a,newKey:i,timestamp:s}=e;i&&!a.includes(i)&&a.push(i);return{value:t,parentKeys:a,timestamp:s||Date.now()}}getParents(e){return e&&e.parentKeys?e.parentKeys:e?(d.error(`${this.context}::getParents: parentKeys not found ${JSON.stringify(e)}`),[]):[]}async execRefreshTTL(e,t){const a=await this.refreshTTL(this.client.pipeline(),e,t);await a.exec()}async refreshTTL(e,t,a){c(`${this.context}::refreshTTL: refreshing TTL for ${t}`);const i=/:list$/.test(t);if(a=a||Date.now(),i){const i=await this.getRaw(t,l.CacheGetType.TYPE_ARRAY,!0)||[];if(i&&i.length){const s=await this.client.mget(i);for(const[t,r]of s.entries()){const s=i[t];if(r)try{const t=JSON.parse(r);"object"==typeof t&&t.timestamp!==a&&(t.timestamp=a,e.set(s,JSON.stringify(t,this.getCircularReplacer()),"EX",u))}catch(e){d.error(`${this.context}::refreshTTL: Bad value stored for key ${s} : ${this.stringify(r)}`)}}e.expire(t,u-60)}}else{const i=await this.getRaw(t,null,!0);if(i)if(i.parentKeys&&i.parentKeys.length)for(const t of i.parentKeys)e=await this.refreshTTL(e,t,a);else i.timestamp!==a&&(i.timestamp=a,e.set(t,JSON.stringify(i,this.getCircularReplacer()),"EX",u))}return e}async destroy(){return c("${this.context}::destroy: destroy redis"),this.client.flushdb().then((e=>"OK"===e))}async export(){c("${this.context}::export: export data");const e=await this.client.keys("*"),t={};return await Promise.all(e.map((async e=>{t[e]=await this.get(e,"list"===e.slice(-4)?l.CacheGetType.TYPE_ARRAY:l.CacheGetType.TYPE_OBJECT)}))).then((()=>t))}stringify(e){return Object.prototype.hasOwnProperty.call(e,"toString")?e:JSON.stringify(e,this.getCircularReplacer())}}},57804:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(91263)),r=i(a(73947)),l=a(64612);t.default=class NocoCache{static init(){if(this.cacheDisabled="true"===(process.env.NC_DISABLE_CACHE||!1),this.cacheDisabled)return;process.env.NC_REDIS_URL?this.client=new s.default(process.env.NC_REDIS_URL):this.client=new r.default;this.prefix="nc:noco"}static async set(e,t){return this.cacheDisabled?Promise.resolve(!0):this.client.set(`${this.prefix}:${e}`,t)}static async setExpiring(e,t,a){return this.cacheDisabled?Promise.resolve(!0):this.client.setExpiring(`${this.prefix}:${e}`,t,a)}static async incrby(e,t){return this.cacheDisabled?Promise.resolve(!0):this.client.incrby(`${this.prefix}:${e}`,t)}static async get(e,t){return this.cacheDisabled?t===l.CacheGetType.TYPE_ARRAY?Promise.resolve([]):(l.CacheGetType.TYPE_OBJECT,Promise.resolve(null)):this.client.get(`${this.prefix}:${e}`,t)}static async del(e){return this.cacheDisabled?Promise.resolve(!0):Array.isArray(e)?this.client.del(e.map((e=>`${this.prefix}:${e}`))):this.client.del(`${this.prefix}:${e}`)}static async getList(e,t,a){return this.cacheDisabled?Promise.resolve({list:[],isNoneList:!1}):this.client.getList(e,t,a)}static async setList(e,t,a,i=[]){return this.cacheDisabled?Promise.resolve(!0):this.client.setList(e,t,a,i)}static async deepDel(e,t){return this.cacheDisabled?Promise.resolve(!0):this.client.deepDel(`${this.prefix}:${e}`,t)}static async appendToList(e,t,a){return this.cacheDisabled?Promise.resolve(!0):this.client.appendToList(e,t,`${this.prefix}:${a}`)}static async update(e,t){return this.cacheDisabled?Promise.resolve(!0):this.client.update(`${this.prefix}:${e}`,t)}static async destroy(){return this.cacheDisabled?Promise.resolve(!0):this.client.destroy()}static async export(){return this.cacheDisabled?Promise.resolve({}):this.client.export()}}},91263:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(89576)),r=i(a(44696)),l=i(a(83352));(0,s.default)("nc:cache");class RedisCacheMgr extends l.default{constructor(e){super(),this.client=new r.default(e),"true"===process.env.NC_WORKER_CONTAINER||"true"!==process.env.NC_FLUSH_CACHE&&"true"===process.env.NC_CLOUD||"true"===process.env.NC_KEEP_CACHE||this.client.flushdb();this.prefix="nc:noco",this.context="RedisCacheMgr"}}t.default=RedisCacheMgr},73947:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(89576)),r=i(a(22840)),l=i(a(83352));(0,s.default)("nc:cache");class RedisMockCacheMgr extends l.default{constructor(){super(),this.client=new r.default,this.client.flushdb();this.prefix="nc:noco",this.context="RedisMockCacheMgr"}}t.default=RedisMockCacheMgr},12916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NC_ATTACHMENT_FIELD_SIZE=t.NC_APP_SETTINGS=t.NC_LICENSE_KEY=void 0,t.NC_LICENSE_KEY="nc-license-key",t.NC_APP_SETTINGS="nc-app-settings",t.NC_ATTACHMENT_FIELD_SIZE=+process.env.NC_ATTACHMENT_FIELD_SIZE||20971520},65472:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiDocsController=void 0;const p=a(23324),m=u(a(88320)),_=u(a(38264)),f=a(23668),h=a(47932),g=a(57116),y=a(53432),b=a(67240),w=a(26212),v=a(48967),T=u(a(76584));let k=class ApiDocsController{constructor(e){this.apiDocsService=e}async swaggerJson(e,t,a){return await this.apiDocsService.swaggerJson(e,{baseId:t,siteUrl:a.ncSiteUrl})}async swaggerJsonV2(e,t,a){return await this.apiDocsService.swaggerJsonV2(e,{baseId:t,siteUrl:a.ncSiteUrl})}swaggerHtml(e,t){t.send((0,m.default)({ncSiteUrl:process.env.NC_PUBLIC_URL||"",dashboardPath:T.default.getConfig().dashboardPath||""}))}redocHtml(e,t){t.send((0,_.default)({ncSiteUrl:process.env.NC_PUBLIC_URL||"",dashboardPath:T.default.getConfig().dashboardPath||""}))}swaggerHtmlV2(e,t){t.send((0,m.default)({ncSiteUrl:process.env.NC_PUBLIC_URL||"",dashboardPath:T.default.getConfig().dashboardPath||""}))}redocHtmlV2(e,t){t.send((0,_.default)({ncSiteUrl:process.env.NC_PUBLIC_URL||"",dashboardPath:T.default.getConfig().dashboardPath||""}))}};t.ApiDocsController=k,l([(0,p.Get)(["/api/v1/db/meta/projects/:baseId/swagger.json"]),(0,p.UseGuards)(b.MetaApiLimiterGuard,f.GlobalGuard),(0,h.Acl)("swaggerJson"),d(0,(0,w.TenantContext)()),d(1,(0,p.Param)("baseId")),d(2,(0,p.Request)()),c("design:type",Function),c("design:paramtypes",["function"==typeof(s=void 0!==v.NcContext&&v.NcContext)?s:Object,String,Object]),c("design:returntype",Promise)],k.prototype,"swaggerJson",null),l([(0,p.Get)(["/api/v2/meta/bases/:baseId/swagger.json"]),(0,p.UseGuards)(b.MetaApiLimiterGuard,f.GlobalGuard),(0,h.Acl)("swaggerJson"),d(0,(0,w.TenantContext)()),d(1,(0,p.Param)("baseId")),d(2,(0,p.Request)()),c("design:type",Function),c("design:paramtypes",["function"==typeof(r=void 0!==v.NcContext&&v.NcContext)?r:Object,String,Object]),c("design:returntype",Promise)],k.prototype,"swaggerJsonV2",null),l([(0,p.Get)(["/api/v1/db/meta/projects/:baseId/swagger"]),(0,p.UseGuards)(y.PublicApiLimiterGuard),d(0,(0,p.Param)("baseId")),d(1,(0,p.Response)()),c("design:type",Function),c("design:paramtypes",[String,Object]),c("design:returntype",void 0)],k.prototype,"swaggerHtml",null),l([(0,p.UseGuards)(y.PublicApiLimiterGuard),(0,p.Get)(["/api/v1/db/meta/projects/:baseId/redoc"]),d(0,(0,p.Param)("baseId")),d(1,(0,p.Response)()),c("design:type",Function),c("design:paramtypes",[String,Object]),c("design:returntype",void 0)],k.prototype,"redocHtml",null),l([(0,p.Get)(["/api/v2/meta/bases/:baseId/swagger"]),(0,p.UseGuards)(y.PublicApiLimiterGuard),d(0,(0,p.Param)("baseId")),d(1,(0,p.Response)()),c("design:type",Function),c("design:paramtypes",[String,Object]),c("design:returntype",void 0)],k.prototype,"swaggerHtmlV2",null),l([(0,p.UseGuards)(y.PublicApiLimiterGuard),(0,p.Get)(["/api/v2/meta/bases/:baseId/redoc"]),d(0,(0,p.Param)("baseId")),d(1,(0,p.Response)()),c("design:type",Function),c("design:paramtypes",[String,Object]),c("design:returntype",void 0)],k.prototype,"redocHtmlV2",null),t.ApiDocsController=k=l([(0,p.Controller)(),c("design:paramtypes",["function"==typeof(i=void 0!==g.ApiDocsService&&g.ApiDocsService)?i:Object])],k)},38264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=({ncSiteUrl:e,dashboardPath:t})=>`<!DOCTYPE html>\n<html>\n<head>\n    <title>NocoDB API Documentation</title>\n    \x3c!-- needed for adaptive design --\x3e\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link href="${e}/css/fonts.montserrat.css" rel="stylesheet">\n    \x3c!--\n    Redoc doesn't change outer page styles\n    --\x3e\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n<div id="redoc"></div>\n<script src="${e}/js/redoc.standalone.min.js"><\/script>\n<script>\n  let initialLocalStorage = {}\n  \n  try {\n    initialLocalStorage = JSON.parse(localStorage.getItem('nocodb-gui-v2') || '{}');\n  } catch (e) {\n    console.error('Failed to parse local storage', e);\n  }\n\n  const xhttp = new XMLHttpRequest();\n  \n  xhttp.open("GET", "./swagger.json");\n  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");\n  xhttp.setRequestHeader("xc-auth", initialLocalStorage && initialLocalStorage.token);\n\n  xhttp.onload = function () {\n    \n      // if invalid token then redirect to signin page\n      if (xmlhttp.status === 401) {\n        window.location.href = ${JSON.stringify(e)} + ${JSON.stringify(t)} + '#/signin?continueAfterSignIn=' + encodeURIComponent(window.location.href);\n        return;\n      } \n    \n      const swaggerJson = this.responseText;\n      const swagger = JSON.parse(swaggerJson);\n      Redoc.init(swagger, {\n        scrollYOffset: 50\n      }, document.getElementById('redoc'))\n  };\n  \n  xhttp.send();\n<\/script>\n<script>\n console.log('%c🚀 We are Hiring!!! 🚀%c\\n%cJoin the forces http://careers.nocodb.com', 'color:#1348ba;font-size:3rem;padding:20px;', 'display:none', 'font-size:1.5rem;padding:20px')\n   const linkEl = document.createElement('a')\n  linkEl.setAttribute('href', "http://careers.nocodb.com")\n  linkEl.setAttribute('target', '_blank')\n  linkEl.setAttribute('class', 'we-are-hiring')\n  linkEl.innerHTML = '🚀 We are Hiring!!! 🚀'\n  const styleEl = document.createElement('style');\n  styleEl.innerHTML = \`\n.we-are-hiring {\n  position: fixed;\n  bottom: 50px;\n  right: -250px;\n  opacity: 0;\n  background: orange;\n  border-radius: 4px;\n  padding: 19px;\n  z-index: 200;\n  text-decoration: none; \n  text-transform: uppercase;\n  color: black;\n  transition: 1s opacity, 1s right;\n  display: block;\n  font-weight: bold;\n}        \n\n.we-are-hiring.active {\n  opacity: 1;\n  right:25px;\n}\n\n@media only screen and (max-width: 600px) {\n  .we-are-hiring {\n    display: none;\n  }\n}\n        \`\n  document.body.appendChild(linkEl, document.body.firstChild)\n  document.body.appendChild(styleEl, document.body.firstChild)\n  setTimeout(() => linkEl.classList.add('active'), 2000)\n<\/script>\n</body>\n</html>`},88320:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=({ncSiteUrl:e,dashboardPath:t})=>`<!DOCTYPE html>\n<html>\n<head>\n    <title>NocoDB : API Docs</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">\n    <link rel="shortcut icon" href="${e}/favicon.ico" />\n    <link rel="stylesheet" href="${e}/css/swagger-ui-bundle.4.5.2.min.css"/>\n    <script src="${e}/js/swagger-ui-bundle.4.5.2.min.js"><\/script>\n</head>\n<body>\n<div id="app"></div>\n<script>\n\nlet initialLocalStorage = {}\n\ntry {\n  initialLocalStorage = JSON.parse(localStorage.getItem('nocodb-gui-v2') || '{}');\n} catch (e) {\n  console.error('Failed to parse local storage', e);\n}\n\nvar xmlhttp = new XMLHttpRequest();   // new HttpRequest instance \nxmlhttp.open("GET", "./swagger.json");\nxmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");\nxmlhttp.setRequestHeader("xc-auth", initialLocalStorage && initialLocalStorage.token);\nxmlhttp.onload = function () {\n  \n  // if invalid token then redirect to signin page\n  if (xmlhttp.status === 401) {\n    window.location.href = ${JSON.stringify(e)} + ${JSON.stringify(t)} + '#/signin?continueAfterSignIn=' + encodeURIComponent(window.location.href);\n    return;\n  } \n\n  const ui = SwaggerUIBundle({\n    // url: ,\n    spec: JSON.parse(xmlhttp.responseText),\n    dom_id: '#app',\n    presets: [\n      SwaggerUIBundle.presets.apis,\n      SwaggerUIBundle.SwaggerUIStandalonePreset\n    ],\n  })\n}\nxmlhttp.send();\n\n  \n  console.log('%c🚀 We are Hiring!!! 🚀%c\\n%cJoin the forces http://careers.nocodb.com', 'color:#1348ba;font-size:3rem;padding:20px;', 'display:none', 'font-size:1.5rem;padding:20px');\n    const linkEl = document.createElement('a')\n  linkEl.setAttribute('href', "http://careers.nocodb.com")\n  linkEl.setAttribute('target', '_blank')\n  linkEl.setAttribute('class', 'we-are-hiring')\n  linkEl.innerHTML = '🚀 We are Hiring!!! 🚀'\n  const styleEl = document.createElement('style');\n  styleEl.innerHTML = \`\n.we-are-hiring {\n  position: fixed;\n  bottom: 50px;\n  right: -250px;\n  opacity: 0;\n  background: orange;\n  border-radius: 4px;\n  padding: 19px;\n  z-index: 200;\n  text-decoration: none; \n  text-transform: uppercase;\n  color: black;\n  transition: 1s opacity, 1s right;\n  display: block;\n  font-weight: bold;\n}        \n\n.we-are-hiring.active {\n  opacity: 1;\n  right:25px;\n}\n\n@media only screen and (max-width: 600px) {\n  .we-are-hiring {\n    display: none;\n  }\n}\n        \`\n  document.body.appendChild(linkEl, document.body.firstChild)\n  document.body.appendChild(styleEl, document.body.firstChild)\n  setTimeout(() => linkEl.classList.add('active'), 2000)\n<\/script>\n</body>\n</html>\n`},62828:function(e,t,a){"use strict";var i,s,r,l,c=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiTokensController=void 0;const p=a(23324),m=a(23668),_=a(99572),f=a(26580),h=a(47932),g=a(67240),y=a(48967);let b=class ApiTokensController{constructor(e){this.apiTokensService=e}async apiTokenList(e){return new _.PagedResponseImpl(await this.apiTokensService.apiTokenList({userId:e.user.id}))}async apiTokenCreate(e,t){return await this.apiTokensService.apiTokenCreate({tokenBody:t,userId:e.user.id,req:e})}async apiTokenDelete(e,t){return await this.apiTokensService.apiTokenDelete({tokenId:t,user:e.user,req:e})}};t.ApiTokensController=b,c([(0,p.Get)(["/api/v1/db/meta/projects/:baseId/api-tokens","/api/v2/meta/bases/:baseId/api-tokens"]),(0,h.Acl)("baseApiTokenList"),u(0,(0,p.Req)()),d("design:type",Function),d("design:paramtypes",["function"==typeof(s=void 0!==y.NcRequest&&y.NcRequest)?s:Object]),d("design:returntype",Promise)],b.prototype,"apiTokenList",null),c([(0,p.Post)(["/api/v1/db/meta/projects/:baseId/api-tokens","/api/v2/meta/bases/:baseId/api-tokens"]),(0,p.HttpCode)(200),(0,h.Acl)("baseApiTokenCreate"),u(0,(0,p.Req)()),u(1,(0,p.Body)()),d("design:type",Function),d("design:paramtypes",["function"==typeof(r=void 0!==y.NcRequest&&y.NcRequest)?r:Object,Object]),d("design:returntype",Promise)],b.prototype,"apiTokenCreate",null),c([(0,p.Delete)(["/api/v1/db/meta/projects/:baseId/api-tokens/:tokenId","/api/v2/meta/bases/:baseId/api-tokens/:tokenId"]),(0,h.Acl)("baseApiTokenDelete"),u(0,(0,p.Req)()),u(1,(0,p.Param)("tokenId")),d("design:type",Function),d("design:paramtypes",["function"==typeof(l=void 0!==y.NcRequest&&y.NcRequest)?l:Object,String]),d("design:returntype",Promise)],b.prototype,"apiTokenDelete",null),t.ApiTokensController=b=c([(0,p.Controller)(),(0,p.UseGuards)(g.MetaApiLimiterGuard,m.GlobalGuard),d("design:paramtypes",["function"==typeof(i=void 0!==f.ApiTokensService&&f.ApiTokensService)?i:Object])],b)},23976:function(e,t,a){"use strict";var i,s,r,l,c,d,u=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},_=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentsSecureController=void 0;const f=_(a(67072)),h=a(23324),g=a(17376),y=a(79224),b=a(48967),w=a(23668),v=a(58504),T=a(19684),k=a(60395),S=a(67240),M=a(15132),O=a(34608),I=a(26212),C=a(47932),E=a(43820),x=a(19176);let L=class AttachmentsSecureController{constructor(e,t){this.attachmentsService=e,this.dataTableService=t}async upload(e,t){return await this.attachmentsService.upload({files:e,req:t})}async uploadViaURL(e,t){return await this.attachmentsService.uploadViaURL({urls:e,req:t})}async fileReadv3(e,t){try{const a=(await T.PresignedUrl.getPath(`dltemp/${e}`)).split("?"),i=a[0];let s=null,r=null;if(a.length>1){const e=new URLSearchParams(a[1]);s=e.get("response-content-type"),r=e.get("response-content-disposition")}const l="thumbnails"===e.split("/")[2]?"":"uploads",c=await this.attachmentsService.getFile({path:f.default.join("nc",l,i)});if(!await(0,x.localFileExists)(c.path))return t.status(404).send("File not found");s&&t.setHeader("Content-Type",s),r&&t.setHeader("Content-Disposition",r),t.sendFile(c.path)}catch(e){t.status(404).send("Not found")}}async downloadAttachment(e,t,a,i,s){const r=await T.Column.get(e,{colId:a});r||E.NcError.fieldNotFound(a);const l=await this.dataTableService.dataRead(e,{baseId:e.base_id,modelId:t,rowId:i,query:{fields:r.title}});return l||E.NcError.recordNotFound(i),this.attachmentsService.getAttachmentFromRecord({record:l,column:r,urlOrPath:s})}};t.AttachmentsSecureController=L,u([(0,h.UseGuards)(S.MetaApiLimiterGuard,w.GlobalGuard),(0,h.Post)(["/api/v1/db/storage/upload","/api/v2/storage/upload"]),(0,h.HttpCode)(200),(0,h.UseInterceptors)(k.UploadAllowedInterceptor,(0,g.AnyFilesInterceptor)()),m(0,(0,h.UploadedFiles)()),m(1,(0,h.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(r="undefined"!=typeof Array&&Array)?r:Object,Object]),p("design:returntype",Promise)],L.prototype,"upload",null),u([(0,h.Post)(["/api/v1/db/storage/upload-by-url","/api/v2/storage/upload-by-url"]),(0,h.HttpCode)(200),(0,h.UseInterceptors)(k.UploadAllowedInterceptor),(0,h.UseGuards)(S.MetaApiLimiterGuard,w.GlobalGuard),m(0,(0,h.Body)()),m(1,(0,h.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(l="undefined"!=typeof Array&&Array)?l:Object,Object]),p("design:returntype",Promise)],L.prototype,"uploadViaURL",null),u([(0,h.Get)("/dltemp/:param(*)"),m(0,(0,h.Param)("param")),m(1,(0,h.Res)()),p("design:type",Function),p("design:paramtypes",[String,"function"==typeof(c=void 0!==y.Response&&y.Response)?c:Object]),p("design:returntype",Promise)],L.prototype,"fileReadv3",null),u([(0,h.UseGuards)(O.DataApiLimiterGuard,w.GlobalGuard),(0,h.Get)("/api/v2/downloadAttachment/:modelId/:columnId/:rowId"),(0,C.Acl)("dataRead"),m(0,(0,I.TenantContext)()),m(1,(0,h.Param)("modelId")),m(2,(0,h.Param)("columnId")),m(3,(0,h.Param)("rowId")),m(4,(0,h.Query)("urlOrPath")),p("design:type",Function),p("design:paramtypes",["function"==typeof(d=void 0!==b.NcContext&&b.NcContext)?d:Object,String,String,String,String]),p("design:returntype",Promise)],L.prototype,"downloadAttachment",null),t.AttachmentsSecureController=L=u([(0,h.Controller)(),p("design:paramtypes",["function"==typeof(i=void 0!==v.AttachmentsService&&v.AttachmentsService)?i:Object,"function"==typeof(s=void 0!==M.DataTableService&&M.DataTableService)?s:Object])],L)},66364:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},y=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentsController=void 0;const b=y(a(67072)),w=a(23324),v=a(17376),T=a(79224),k=y(a(20112)),S=a(60395),M=a(23668),O=a(58504),I=a(19684),C=a(67240),E=a(48967),x=a(19176),L=a(15132),R=a(26212),N=a(34608),A=a(47932),D=a(19684),j=a(43820);let P=class AttachmentsController{constructor(e,t){this.attachmentsService=e,this.dataTableService=t}async upload(e,t){var a,i;return await this.attachmentsService.upload({files:e,path:null===(i=null===(a=t.query)||void 0===a?void 0:a.path)||void 0===i?void 0:i.toString(),req:t})}async uploadViaURL(e,t,a){return await this.attachmentsService.uploadViaURL({urls:e,path:t,req:a})}async fileRead(e,t,a){try{const i=await this.attachmentsService.getFile({path:b.default.join("nc","uploads",e)});if(!await(0,x.localFileExists)(i.path))return t.status(404).send("File not found");(0,x.isPreviewAllowed)({mimetype:i.type,path:i.path})?(a&&t.setHeader("Content-Disposition",(0,k.default)(a,{type:"attachment"})),t.sendFile(i.path)):t.download(i.path,a)}catch(e){t.status(404).send("Not found")}}async fileReadv2(e,t,a,i,s){try{const r=await this.attachmentsService.getFile({path:b.default.join("nc",e,t,"uploads",...a.split("/"))});if(!await(0,x.localFileExists)(r.path))return i.status(404).send("File not found");(0,x.isPreviewAllowed)({mimetype:r.type,path:r.path})?(s&&i.setHeader("Content-Disposition",(0,k.default)(s,{type:"attachment"})),i.sendFile(r.path)):i.download(r.path,s)}catch(e){i.status(404).send("Not found")}}async fileReadv3(e,t){try{const a=(await I.PresignedUrl.getPath(`dltemp/${e}`)).split("?"),i=a[0];let s=null,r=null;if(a.length>1){const e=new URLSearchParams(a[1]);s=e.get("ResponseContentType"),r=e.get("ResponseContentDisposition")}const l="thumbnails"===e.split("/")[2]?"":"uploads",c=await this.attachmentsService.getFile({path:b.default.join("nc",l,i)});if(!await(0,x.localFileExists)(c.path))return t.status(404).send("File not found");s&&t.setHeader("Content-Type",s),r&&t.setHeader("Content-Disposition",r),t.sendFile(c.path)}catch(e){t.status(404).send("Not found")}}async downloadAttachment(e,t,a,i,s){const r=await D.Column.get(e,{colId:a});r||j.NcError.fieldNotFound(a);const l=await this.dataTableService.dataRead(e,{baseId:e.base_id,modelId:t,rowId:i,query:{fields:r.title}});return l||j.NcError.recordNotFound(i),this.attachmentsService.getAttachmentFromRecord({record:l,column:r,urlOrPath:s})}};t.AttachmentsController=P,f([(0,w.UseGuards)(C.MetaApiLimiterGuard,M.GlobalGuard),(0,w.Post)(["/api/v1/db/storage/upload","/api/v2/storage/upload"]),(0,w.HttpCode)(200),(0,w.UseInterceptors)(S.UploadAllowedInterceptor,(0,v.AnyFilesInterceptor)()),g(0,(0,w.UploadedFiles)()),g(1,(0,w.Req)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(r="undefined"!=typeof Array&&Array)?r:Object,"function"==typeof(l=void 0!==E.NcRequest&&E.NcRequest)?l:Object]),h("design:returntype",Promise)],P.prototype,"upload",null),f([(0,w.Post)(["/api/v1/db/storage/upload-by-url","/api/v2/storage/upload-by-url"]),(0,w.HttpCode)(200),(0,w.UseInterceptors)(S.UploadAllowedInterceptor),(0,w.UseGuards)(C.MetaApiLimiterGuard,M.GlobalGuard),g(0,(0,w.Body)()),g(1,(0,w.Query)("path")),g(2,(0,w.Req)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(c="undefined"!=typeof Array&&Array)?c:Object,String,"function"==typeof(d=void 0!==E.NcRequest&&E.NcRequest)?d:Object]),h("design:returntype",Promise)],P.prototype,"uploadViaURL",null),f([(0,w.Get)("/download/:filename(*)"),g(0,(0,w.Param)("filename")),g(1,(0,w.Res)()),g(2,(0,w.Query)("filename")),h("design:type",Function),h("design:paramtypes",[String,"function"==typeof(u=void 0!==T.Response&&T.Response)?u:Object,String]),h("design:returntype",Promise)],P.prototype,"fileRead",null),f([(0,w.Get)("/dl/:param1([a-zA-Z0-9_-]+)/:param2([a-zA-Z0-9_-]+)/:filename(*)"),g(0,(0,w.Param)("param1")),g(1,(0,w.Param)("param2")),g(2,(0,w.Param)("filename")),g(3,(0,w.Res)()),g(4,(0,w.Query)("filename")),h("design:type",Function),h("design:paramtypes",[String,String,String,"function"==typeof(p=void 0!==T.Response&&T.Response)?p:Object,String]),h("design:returntype",Promise)],P.prototype,"fileReadv2",null),f([(0,w.Get)("/dltemp/:param(*)"),g(0,(0,w.Param)("param")),g(1,(0,w.Res)()),h("design:type",Function),h("design:paramtypes",[String,"function"==typeof(m=void 0!==T.Response&&T.Response)?m:Object]),h("design:returntype",Promise)],P.prototype,"fileReadv3",null),f([(0,w.UseGuards)(N.DataApiLimiterGuard,M.GlobalGuard),(0,w.Get)("/api/v2/downloadAttachment/:modelId/:columnId/:rowId"),(0,A.Acl)("dataRead"),g(0,(0,R.TenantContext)()),g(1,(0,w.Param)("modelId")),g(2,(0,w.Param)("columnId")),g(3,(0,w.Param)("rowId")),g(4,(0,w.Query)("urlOrPath")),h("design:type",Function),h("design:paramtypes",["function"==typeof(_=void 0!==E.NcContext&&E.NcContext)?_:Object,String,String,String,String]),h("design:returntype",Promise)],P.prototype,"downloadAttachment",null),t.AttachmentsController=P=f([(0,w.Controller)(),h("design:paramtypes",["function"==typeof(i=void 0!==O.AttachmentsService&&O.AttachmentsService)?i:Object,"function"==typeof(s=void 0!==L.DataTableService&&L.DataTableService)?s:Object])],P)},60468:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuditsController=void 0;const m=a(23324),_=a(23668),f=a(99572),h=a(15404),g=a(47932),y=a(67240),b=a(26212),w=a(48967);let v=class AuditsController{constructor(e){this.auditsService=e}async auditListRow(e){return new f.PagedResponseImpl(await this.auditsService.auditOnlyList({query:e.query}))}async auditRowUpdate(e,t,a){return await this.auditsService.auditRowUpdate(e,{rowId:t,body:a})}async auditList(e,t){return new f.PagedResponseImpl(await this.auditsService.auditList({query:e.query,baseId:t}),Object.assign({count:await this.auditsService.auditCount({query:e.query,baseId:t})},e.query))}async projectAuditList(e){return new f.PagedResponseImpl(await this.auditsService.projectAuditList({query:e.query}),Object.assign({count:await this.auditsService.projectAuditCount()},e.query))}};t.AuditsController=v,d([(0,m.Get)(["/api/v1/db/meta/audits/","/api/v2/meta/audits/"]),(0,g.Acl)("auditListRow"),p(0,(0,m.Req)()),u("design:type",Function),u("design:paramtypes",["function"==typeof(s=void 0!==w.NcRequest&&w.NcRequest)?s:Object]),u("design:returntype",Promise)],v.prototype,"auditListRow",null),d([(0,m.Post)(["/api/v1/db/meta/audits/rows/:rowId/update","/api/v2/meta/audits/rows/:rowId/update"]),(0,m.HttpCode)(200),(0,g.Acl)("auditRowUpdate"),p(0,(0,b.TenantContext)()),p(1,(0,m.Param)("rowId")),p(2,(0,m.Body)()),u("design:type",Function),u("design:paramtypes",["function"==typeof(r=void 0!==w.NcContext&&w.NcContext)?r:Object,String,Object]),u("design:returntype",Promise)],v.prototype,"auditRowUpdate",null),d([(0,m.Get)(["/api/v1/db/meta/projects/:baseId/audits/","/api/v2/meta/bases/:baseId/audits/"]),(0,g.Acl)("baseAuditList"),p(0,(0,m.Req)()),p(1,(0,m.Param)("baseId")),u("design:type",Function),u("design:paramtypes",["function"==typeof(l=void 0!==w.NcRequest&&w.NcRequest)?l:Object,String]),u("design:returntype",Promise)],v.prototype,"auditList",null),d([(0,m.Get)(["/api/v1/db/meta/projects/audits/","/api/v2/meta/projects/audits/"]),(0,g.Acl)("projectAuditList"),p(0,(0,m.Req)()),u("design:type",Function),u("design:paramtypes",["function"==typeof(c=void 0!==w.NcRequest&&w.NcRequest)?c:Object]),u("design:returntype",Promise)],v.prototype,"projectAuditList",null),t.AuditsController=v=d([(0,m.Controller)(),(0,m.UseGuards)(y.MetaApiLimiterGuard,_.GlobalGuard),u("design:paramtypes",["function"==typeof(i=void 0!==h.AuditsService&&h.AuditsService)?i:Object])],v)},84828:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k,S,M,O=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},I=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},C=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseUsersController=void 0;const E=a(23324),x=a(71040),L=a(23668),R=a(54024),N=a(43820),A=a(47932),D=a(67240),j=a(26212),P=a(48967);let q=class BaseUsersController{constructor(e){this.baseUsersService=e}async userList(e,t,a){var i,s;const r=Object.keys(null!==(s=null===(i=a.user)||void 0===i?void 0:i.base_roles)&&void 0!==s?s:{}),l=r.includes(x.ProjectRoles.OWNER)||r.includes(x.ProjectRoles.CREATOR)?"full":"viewer";return{users:await this.baseUsersService.userList(e,{baseId:t,mode:l})}}async userInvite(e,t,a,i){return i.email||N.NcError.badRequest("Email is required"),await this.baseUsersService.userInvite(e,{baseId:t,baseUser:i,req:a})}async baseUserUpdate(e,t,a,i,s){return await this.baseUsersService.baseUserUpdate(e,{baseUser:s,baseId:t,userId:a,req:i}),{msg:"The user has been updated successfully"}}async baseUserDelete(e,t,a,i){return await this.baseUsersService.baseUserDelete(e,{baseId:t,userId:a,req:i}),{msg:"The user has been deleted successfully"}}async baseUserInviteResend(e,t,a,i,s){return await this.baseUsersService.baseUserInviteResend(e,{baseId:t,userId:a,baseUser:s,req:i}),{msg:"The invitation has been sent to the user"}}async baseUserMetaUpdate(e,t,a,i){return await this.baseUsersService.baseUserMetaUpdate(e,{baseId:t,body:i,user:a.user})}};t.BaseUsersController=q,O([(0,E.Get)(["/api/v1/db/meta/projects/:baseId/users","/api/v2/meta/bases/:baseId/users"]),(0,A.Acl)("baseUserList"),C(0,(0,j.TenantContext)()),C(1,(0,E.Param)("baseId")),C(2,(0,E.Req)()),I("design:type",Function),I("design:paramtypes",["function"==typeof(s=void 0!==P.NcContext&&P.NcContext)?s:Object,String,"function"==typeof(r=void 0!==P.NcRequest&&P.NcRequest)?r:Object]),I("design:returntype",Promise)],q.prototype,"userList",null),O([(0,E.Post)(["/api/v1/db/meta/projects/:baseId/users","/api/v2/meta/bases/:baseId/users"]),(0,E.HttpCode)(200),(0,A.Acl)("userInvite"),C(0,(0,j.TenantContext)()),C(1,(0,E.Param)("baseId")),C(2,(0,E.Req)()),C(3,(0,E.Body)()),I("design:type",Function),I("design:paramtypes",["function"==typeof(l=void 0!==P.NcContext&&P.NcContext)?l:Object,String,"function"==typeof(c=void 0!==P.NcRequest&&P.NcRequest)?c:Object,"function"==typeof(d=void 0!==x.ProjectUserReqType&&x.ProjectUserReqType)?d:Object]),I("design:returntype","function"==typeof(u="undefined"!=typeof Promise&&Promise)?u:Object)],q.prototype,"userInvite",null),O([(0,E.Patch)(["/api/v1/db/meta/projects/:baseId/users/:userId","/api/v2/meta/bases/:baseId/users/:userId"]),(0,A.Acl)("baseUserUpdate"),C(0,(0,j.TenantContext)()),C(1,(0,E.Param)("baseId")),C(2,(0,E.Param)("userId")),C(3,(0,E.Req)()),C(4,(0,E.Body)()),I("design:type",Function),I("design:paramtypes",["function"==typeof(p=void 0!==P.NcContext&&P.NcContext)?p:Object,String,String,"function"==typeof(m=void 0!==P.NcRequest&&P.NcRequest)?m:Object,Object]),I("design:returntype","function"==typeof(_="undefined"!=typeof Promise&&Promise)?_:Object)],q.prototype,"baseUserUpdate",null),O([(0,E.Delete)(["/api/v1/db/meta/projects/:baseId/users/:userId","/api/v2/meta/bases/:baseId/users/:userId"]),(0,A.Acl)("baseUserDelete"),C(0,(0,j.TenantContext)()),C(1,(0,E.Param)("baseId")),C(2,(0,E.Param)("userId")),C(3,(0,E.Req)()),I("design:type",Function),I("design:paramtypes",["function"==typeof(f=void 0!==P.NcContext&&P.NcContext)?f:Object,String,String,"function"==typeof(h=void 0!==P.NcRequest&&P.NcRequest)?h:Object]),I("design:returntype","function"==typeof(g="undefined"!=typeof Promise&&Promise)?g:Object)],q.prototype,"baseUserDelete",null),O([(0,E.Post)(["/api/v1/db/meta/projects/:baseId/users/:userId/resend-invite","/api/v2/meta/bases/:baseId/users/:userId/resend-invite"]),(0,E.HttpCode)(200),(0,A.Acl)("baseUserInviteResend"),C(0,(0,j.TenantContext)()),C(1,(0,E.Param)("baseId")),C(2,(0,E.Param)("userId")),C(3,(0,E.Req)()),C(4,(0,E.Body)()),I("design:type",Function),I("design:paramtypes",["function"==typeof(y=void 0!==P.NcContext&&P.NcContext)?y:Object,String,String,"function"==typeof(b=void 0!==P.NcRequest&&P.NcRequest)?b:Object,"function"==typeof(w=void 0!==x.ProjectUserReqType&&x.ProjectUserReqType)?w:Object]),I("design:returntype","function"==typeof(v="undefined"!=typeof Promise&&Promise)?v:Object)],q.prototype,"baseUserInviteResend",null),O([(0,E.Patch)(["/api/v1/db/meta/projects/:baseId/user","/api/v2/meta/bases/:baseId/user"]),(0,A.Acl)("baseUserMetaUpdate"),C(0,(0,j.TenantContext)()),C(1,(0,E.Param)("baseId")),C(2,(0,E.Req)()),C(3,(0,E.Body)()),I("design:type",Function),I("design:paramtypes",["function"==typeof(T=void 0!==P.NcContext&&P.NcContext)?T:Object,String,"function"==typeof(k=void 0!==P.NcRequest&&P.NcRequest)?k:Object,"function"==typeof(S=void 0!==x.ProjectUserReqType&&x.ProjectUserReqType)?S:Object]),I("design:returntype","function"==typeof(M="undefined"!=typeof Promise&&Promise)?M:Object)],q.prototype,"baseUserMetaUpdate",null),t.BaseUsersController=q=O([(0,E.UseGuards)(D.MetaApiLimiterGuard,L.GlobalGuard),(0,E.Controller)(),I("design:paramtypes",["function"==typeof(i=void 0!==R.BaseUsersService&&R.BaseUsersService)?i:Object])],q)},22820:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},w=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},T=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BasesController=void 0;const k=a(23324),S=T(a(54048)),M=a(71040),O=a(23668),I=a(99572),C=T(a(76584)),E=a(45408),x=a(40668),L=a(47932),R=a(19684),N=a(67240),A=a(26212),D=a(48967);let j=class BasesController{constructor(e){this.projectsService=e}async list(e,t,a){const i=await this.projectsService.baseList(e,{user:a.user,query:t});return new I.PagedResponseImpl(i,{count:i.length,limit:i.length})}async baseInfoGet(){var e,t,a;return{Node:process.version,Arch:process.arch,Platform:process.platform,Docker:(0,S.default)(),RootDB:null===(a=null===(t=null===(e=C.default.getConfig())||void 0===e?void 0:e.meta)||void 0===t?void 0:t.db)||void 0===a?void 0:a.client,PackageVersion:E.packageVersion}}async baseGet(e,t){const a=await this.projectsService.getProjectWithInfo(e,{baseId:t,includeConfig:!1});return this.projectsService.sanitizeProject(a),a}async baseUpdate(e,t,a,i){return await this.projectsService.baseUpdate(e,{baseId:t,base:a,user:i.user,req:i})}async baseDelete(e,t,a){return await this.projectsService.baseSoftDelete(e,{baseId:t,user:a.user,req:a})}async baseCreate(e,t,a){return await this.projectsService.baseCreate({base:t,req:a,user:a.user})}async hasEmptyOrNullFilters(e,t){return await R.Filter.hasEmptyOrNullFilters(e,t)}};t.BasesController=j,b([(0,L.Acl)("baseList",{scope:"org"}),(0,k.Get)(["/api/v1/db/meta/projects/","/api/v2/meta/bases/"]),v(0,(0,A.TenantContext)()),v(1,(0,k.Query)()),v(2,(0,k.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(s=void 0!==D.NcContext&&D.NcContext)?s:Object,"function"==typeof(r="undefined"!=typeof Record&&Record)?r:Object,"function"==typeof(l=void 0!==D.NcRequest&&D.NcRequest)?l:Object]),w("design:returntype",Promise)],j.prototype,"list",null),b([(0,L.Acl)("baseInfoGet"),(0,k.Get)(["/api/v1/db/meta/projects/:baseId/info","/api/v2/meta/bases/:baseId/info"]),w("design:type",Function),w("design:paramtypes",[]),w("design:returntype",Promise)],j.prototype,"baseInfoGet",null),b([(0,L.Acl)("baseGet"),(0,k.Get)(["/api/v1/db/meta/projects/:baseId","/api/v2/meta/bases/:baseId"]),v(0,(0,A.TenantContext)()),v(1,(0,k.Param)("baseId")),w("design:type",Function),w("design:paramtypes",["function"==typeof(c=void 0!==D.NcContext&&D.NcContext)?c:Object,String]),w("design:returntype",Promise)],j.prototype,"baseGet",null),b([(0,L.Acl)("baseUpdate"),(0,k.Patch)(["/api/v1/db/meta/projects/:baseId","/api/v2/meta/bases/:baseId"]),v(0,(0,A.TenantContext)()),v(1,(0,k.Param)("baseId")),v(2,(0,k.Body)()),v(3,(0,k.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(d=void 0!==D.NcContext&&D.NcContext)?d:Object,String,"function"==typeof(u="undefined"!=typeof Record&&Record)?u:Object,"function"==typeof(p=void 0!==D.NcRequest&&D.NcRequest)?p:Object]),w("design:returntype",Promise)],j.prototype,"baseUpdate",null),b([(0,L.Acl)("baseDelete"),(0,k.Delete)(["/api/v1/db/meta/projects/:baseId","/api/v2/meta/bases/:baseId"]),v(0,(0,A.TenantContext)()),v(1,(0,k.Param)("baseId")),v(2,(0,k.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(m=void 0!==D.NcContext&&D.NcContext)?m:Object,String,"function"==typeof(_=void 0!==D.NcRequest&&D.NcRequest)?_:Object]),w("design:returntype",Promise)],j.prototype,"baseDelete",null),b([(0,L.Acl)("baseCreate",{scope:"org"}),(0,k.Post)(["/api/v1/db/meta/projects","/api/v2/meta/bases"]),(0,k.HttpCode)(200),v(0,(0,A.TenantContext)()),v(1,(0,k.Body)()),v(2,(0,k.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(f=void 0!==D.NcContext&&D.NcContext)?f:Object,"function"==typeof(h=void 0!==M.ProjectReqType&&M.ProjectReqType)?h:Object,"function"==typeof(g=void 0!==D.NcRequest&&D.NcRequest)?g:Object]),w("design:returntype",Promise)],j.prototype,"baseCreate",null),b([(0,L.Acl)("hasEmptyOrNullFilters"),(0,k.Get)(["/api/v1/db/meta/projects/:baseId/has-empty-or-null-filters","/api/v2/meta/bases/:baseId/has-empty-or-null-filters"]),v(0,(0,A.TenantContext)()),v(1,(0,k.Param)("baseId")),w("design:type",Function),w("design:paramtypes",["function"==typeof(y=void 0!==D.NcContext&&D.NcContext)?y:Object,String]),w("design:returntype",Promise)],j.prototype,"hasEmptyOrNullFilters",null),t.BasesController=j=b([(0,k.UseGuards)(N.MetaApiLimiterGuard,O.GlobalGuard),(0,k.Controller)(),w("design:paramtypes",["function"==typeof(i=void 0!==x.BasesService&&x.BasesService)?i:Object])],j)},84844:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BulkDataAliasController=void 0;const w=a(23324),v=a(79224),T=a(23668),k=a(26272),S=a(47932),M=a(34608),O=a(26212),I=a(48967);let C=class BulkDataAliasController{constructor(e){this.bulkDataAliasService=e}async bulkDataInsert(e,t,a,i,s,r){const l=await this.bulkDataAliasService.bulkDataInsert(e,{body:r,cookie:t,baseName:i,tableName:s});a.json(l)}async bulkDataUpdate(e,t,a,i,s){return await this.bulkDataAliasService.bulkDataUpdate(e,{body:s,cookie:t,baseName:a,tableName:i})}async bulkDataUpdateAll(e,t,a,i,s){return await this.bulkDataAliasService.bulkDataUpdateAll(e,{body:s,cookie:t,baseName:a,tableName:i,query:t.query})}async bulkDataDelete(e,t,a,i,s){return await this.bulkDataAliasService.bulkDataDelete(e,{body:s,cookie:t,baseName:a,tableName:i})}async bulkDataDeleteAll(e,t,a,i){return await this.bulkDataAliasService.bulkDataDeleteAll(e,{baseName:a,tableName:i,query:t.query})}};t.BulkDataAliasController=C,g([(0,w.Post)(["/api/v1/db/data/bulk/:orgs/:baseName/:tableName"]),(0,w.HttpCode)(200),(0,S.Acl)("bulkDataInsert"),b(0,(0,O.TenantContext)()),b(1,(0,w.Req)()),b(2,(0,w.Res)()),b(3,(0,w.Param)("baseName")),b(4,(0,w.Param)("tableName")),b(5,(0,w.Body)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(s=void 0!==I.NcContext&&I.NcContext)?s:Object,"function"==typeof(r=void 0!==I.NcRequest&&I.NcRequest)?r:Object,"function"==typeof(l=void 0!==v.Response&&v.Response)?l:Object,String,String,Object]),y("design:returntype",Promise)],C.prototype,"bulkDataInsert",null),g([(0,w.Patch)(["/api/v1/db/data/bulk/:orgs/:baseName/:tableName"]),(0,S.Acl)("bulkDataUpdate"),b(0,(0,O.TenantContext)()),b(1,(0,w.Req)()),b(2,(0,w.Param)("baseName")),b(3,(0,w.Param)("tableName")),b(4,(0,w.Body)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(c=void 0!==I.NcContext&&I.NcContext)?c:Object,"function"==typeof(d=void 0!==I.NcRequest&&I.NcRequest)?d:Object,String,String,Object]),y("design:returntype",Promise)],C.prototype,"bulkDataUpdate",null),g([(0,w.Patch)(["/api/v1/db/data/bulk/:orgs/:baseName/:tableName/all"]),(0,S.Acl)("bulkDataUpdateAll"),b(0,(0,O.TenantContext)()),b(1,(0,w.Req)()),b(2,(0,w.Param)("baseName")),b(3,(0,w.Param)("tableName")),b(4,(0,w.Body)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(u=void 0!==I.NcContext&&I.NcContext)?u:Object,"function"==typeof(p=void 0!==I.NcRequest&&I.NcRequest)?p:Object,String,String,Object]),y("design:returntype",Promise)],C.prototype,"bulkDataUpdateAll",null),g([(0,w.Delete)(["/api/v1/db/data/bulk/:orgs/:baseName/:tableName"]),(0,S.Acl)("bulkDataDelete"),b(0,(0,O.TenantContext)()),b(1,(0,w.Req)()),b(2,(0,w.Param)("baseName")),b(3,(0,w.Param)("tableName")),b(4,(0,w.Body)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(m=void 0!==I.NcContext&&I.NcContext)?m:Object,"function"==typeof(_=void 0!==I.NcRequest&&I.NcRequest)?_:Object,String,String,Object]),y("design:returntype",Promise)],C.prototype,"bulkDataDelete",null),g([(0,w.Delete)(["/api/v1/db/data/bulk/:orgs/:baseName/:tableName/all"]),(0,S.Acl)("bulkDataDeleteAll"),b(0,(0,O.TenantContext)()),b(1,(0,w.Req)()),b(2,(0,w.Param)("baseName")),b(3,(0,w.Param)("tableName")),y("design:type",Function),y("design:paramtypes",["function"==typeof(f=void 0!==I.NcContext&&I.NcContext)?f:Object,"function"==typeof(h=void 0!==I.NcRequest&&I.NcRequest)?h:Object,String,String]),y("design:returntype",Promise)],C.prototype,"bulkDataDeleteAll",null),t.BulkDataAliasController=C=g([(0,w.Controller)(),(0,w.UseGuards)(M.DataApiLimiterGuard,T.GlobalGuard),y("design:paramtypes",["function"==typeof(i=void 0!==k.BulkDataAliasService&&k.BulkDataAliasService)?i:Object])],C)},84520:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CachesController=void 0;const l=a(23324),c=a(71040),d=a(73548),u=a(23668),p=a(47932),m=a(67240);let _=class CachesController{constructor(e){this.cachesService=e}async cacheGet(e,t){const a=await this.cachesService.cacheGet();return t.set({"Content-Type":"application/json","Content-Disposition":'attachment; filename="cache-export.json"'}),JSON.stringify(a)}async cacheDelete(){return await this.cachesService.cacheDelete()}};t.CachesController=_,s([(0,l.Get)(["/api/v1/db/meta/cache","/api/v2/meta/cache"]),(0,p.Acl)("cacheGet",{scope:"org",allowedRoles:[c.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],_.prototype,"cacheGet",null),s([(0,l.Delete)(["/api/v1/db/meta/cache","/api/v2/meta/cache"]),(0,p.Acl)("cacheDelete",{scope:"org",allowedRoles:[c.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],_.prototype,"cacheDelete",null),t.CachesController=_=s([(0,l.Controller)(),(0,l.UseGuards)(m.MetaApiLimiterGuard,u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==d.CachesService&&d.CachesService)?i:Object])],_)},33888:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CalendarDatasController=void 0;const y=a(23324),b=a(79224),w=a(23668),v=a(34608),T=a(70636),k=a(43468),S=a(47932),M=a(26212),O=a(48967);let I=class CalendarDatasController{constructor(e){this.calendarDatasService=e}async dataList(e,t,a,i,s){return await this.calendarDatasService.getCalendarDataList(e,{viewId:a,query:t.query,from_date:i,to_date:s})}async calendarDataCount(e,t,a,i,s,r,l,c){const d=process.hrtime(),u=await this.calendarDatasService.getCalendarRecordCount(e,{query:t.query,viewId:r,from_date:l,to_date:c}),p=(0,k.parseHrtimeToMilliSeconds)(process.hrtime(d));a.setHeader("xc-db-response",p),a.json(u)}async countByDate(e,t,a,i,s){var r;return await this.calendarDatasService.getPublicCalendarRecordCount(e,{query:t.query,password:null===(r=t.headers)||void 0===r?void 0:r["xc-password"],sharedViewUuid:a,from_date:i,to_date:s})}async getPublicCalendarDataList(e,t,a,i,s){var r;return await this.calendarDatasService.getPublicCalendarDataList(e,{query:t.query,password:null===(r=t.headers)||void 0===r?void 0:r["xc-password"],sharedViewUuid:a,from_date:i,to_date:s})}};t.CalendarDatasController=I,f([(0,y.Get)(["/api/v1/db/calendar-data/:orgs/:baseName/:tableName/views/:viewName"]),(0,S.Acl)("dataList"),g(0,(0,M.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("viewName")),g(3,(0,y.Query)("from_date")),g(4,(0,y.Query)("to_date")),h("design:type",Function),h("design:paramtypes",["function"==typeof(s=void 0!==O.NcContext&&O.NcContext)?s:Object,"function"==typeof(r=void 0!==O.NcRequest&&O.NcRequest)?r:Object,String,String,String]),h("design:returntype",Promise)],I.prototype,"dataList",null),f([(0,y.Get)(["/api/v1/db/calendar-data/:orgs/:baseName/:tableName/views/:viewName/countByDate/"]),(0,S.Acl)("dataList"),g(0,(0,M.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Res)()),g(3,(0,y.Param)("baseName")),g(4,(0,y.Param)("tableName")),g(5,(0,y.Param)("viewName")),g(6,(0,y.Query)("from_date")),g(7,(0,y.Query)("to_date")),h("design:type",Function),h("design:paramtypes",["function"==typeof(l=void 0!==O.NcContext&&O.NcContext)?l:Object,"function"==typeof(c=void 0!==O.NcRequest&&O.NcRequest)?c:Object,"function"==typeof(d=void 0!==b.Response&&b.Response)?d:Object,String,String,String,String,String]),h("design:returntype",Promise)],I.prototype,"calendarDataCount",null),f([(0,y.Get)(["/api/v1/db/public/calendar-view/:sharedViewUuid/countByDate","/api/v2/public/calendar-view/:sharedViewUuid/countByDate"]),g(0,(0,M.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("sharedViewUuid")),g(3,(0,y.Query)("from_date")),g(4,(0,y.Query)("to_date")),h("design:type",Function),h("design:paramtypes",["function"==typeof(u=void 0!==O.NcContext&&O.NcContext)?u:Object,"function"==typeof(p=void 0!==O.NcRequest&&O.NcRequest)?p:Object,String,String,String]),h("design:returntype",Promise)],I.prototype,"countByDate",null),f([(0,y.Get)(["/api/v1/db/public/calendar-view/:sharedViewUuid","/api/v2/public/calendar-view/:sharedViewUuid"]),g(0,(0,M.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("sharedViewUuid")),g(3,(0,y.Query)("from_date")),g(4,(0,y.Query)("to_date")),h("design:type",Function),h("design:paramtypes",["function"==typeof(m=void 0!==O.NcContext&&O.NcContext)?m:Object,"function"==typeof(_=void 0!==O.NcRequest&&O.NcRequest)?_:Object,String,String,String]),h("design:returntype",Promise)],I.prototype,"getPublicCalendarDataList",null),t.CalendarDatasController=I=f([(0,y.Controller)(),(0,y.UseGuards)(v.DataApiLimiterGuard,w.GlobalGuard),h("design:paramtypes",["function"==typeof(i=void 0!==T.CalendarDatasService&&T.CalendarDatasService)?i:Object])],I)},45996:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CalendarsController=void 0;const f=a(23324),h=a(71040),g=a(23668),y=a(10140),b=a(67240),w=a(47932),v=a(26212),T=a(48967);let k=class CalendarsController{constructor(e){this.calendarsService=e}async calendarViewGet(e,t){return await this.calendarsService.calendarViewGet(e,{calendarViewId:t})}async calendarViewCreate(e,t,a,i){return await this.calendarsService.calendarViewCreate(e,{tableId:t,calendar:a,user:i.user,req:i})}async calendarViewUpdate(e,t,a,i){return await this.calendarsService.calendarViewUpdate(e,{calendarViewId:t,calendar:a,req:i})}};t.CalendarsController=k,p([(0,f.Get)(["/api/v1/db/meta/calendars/:calendarViewId","/api/v2/meta/calendars/:calendarViewId"]),(0,w.Acl)("calendarViewGet"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("calendarViewId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(s=void 0!==T.NcContext&&T.NcContext)?s:Object,String]),m("design:returntype",Promise)],k.prototype,"calendarViewGet",null),p([(0,f.Post)(["/api/v1/db/meta/tables/:tableId/calendars","/api/v2/meta/tables/:tableId/calendars"]),(0,f.HttpCode)(200),(0,w.Acl)("calendarViewCreate"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("tableId")),_(2,(0,f.Body)()),_(3,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(r=void 0!==T.NcContext&&T.NcContext)?r:Object,String,"function"==typeof(l=void 0!==h.ViewCreateReqType&&h.ViewCreateReqType)?l:Object,"function"==typeof(c=void 0!==T.NcRequest&&T.NcRequest)?c:Object]),m("design:returntype",Promise)],k.prototype,"calendarViewCreate",null),p([(0,f.Patch)(["/api/v1/db/meta/calendars/:calendarViewId","/api/v2/meta/calendars/:calendarViewId"]),(0,w.Acl)("calendarViewUpdate"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("calendarViewId")),_(2,(0,f.Body)()),_(3,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(d=void 0!==T.NcContext&&T.NcContext)?d:Object,String,Object,"function"==typeof(u=void 0!==T.NcRequest&&T.NcRequest)?u:Object]),m("design:returntype",Promise)],k.prototype,"calendarViewUpdate",null),t.CalendarsController=k=p([(0,f.Controller)(),(0,f.UseGuards)(b.MetaApiLimiterGuard,g.GlobalGuard),m("design:paramtypes",["function"==typeof(i=void 0!==y.CalendarsService&&y.CalendarsService)?i:Object])],k)},48204:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},w=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnsController=void 0;const T=a(23324),k=a(71040),S=a(23668),M=a(74056),O=a(47932),I=a(67240),C=a(26212),E=a(48967);let x=class ColumnsController{constructor(e){this.columnsService=e}async columnAdd(e,t,a,i){return await this.columnsService.columnAdd(e,{tableId:t,column:a,req:i,user:i.user})}async columnUpdate(e,t,a,i){return await this.columnsService.columnUpdate(e,{columnId:t,column:a,req:i,user:i.user})}async columnDelete(e,t,a){return await this.columnsService.columnDelete(e,{columnId:t,req:a,user:a.user})}async columnGet(e,t){return await this.columnsService.columnGet(e,{columnId:t})}async columnSetAsPrimary(e,t){return await this.columnsService.columnSetAsPrimary(e,{columnId:t})}async columnsHash(e,t){return await this.columnsService.columnsHash(e,t)}async columnBulk(e,t,a,i){return await this.columnsService.columnBulk(e,t,a,i)}};t.ColumnsController=x,b([(0,T.Post)(["/api/v1/db/meta/tables/:tableId/columns/","/api/v2/meta/tables/:tableId/columns/"]),(0,T.HttpCode)(200),(0,O.Acl)("columnAdd"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("tableId")),v(2,(0,T.Body)()),v(3,(0,T.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(s=void 0!==E.NcContext&&E.NcContext)?s:Object,String,"function"==typeof(r=void 0!==k.ColumnReqType&&k.ColumnReqType)?r:Object,"function"==typeof(l=void 0!==E.NcRequest&&E.NcRequest)?l:Object]),w("design:returntype",Promise)],x.prototype,"columnAdd",null),b([(0,T.Patch)(["/api/v1/db/meta/columns/:columnId","/api/v2/meta/columns/:columnId"]),(0,O.Acl)("columnUpdate"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("columnId")),v(2,(0,T.Body)()),v(3,(0,T.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(c=void 0!==E.NcContext&&E.NcContext)?c:Object,String,"function"==typeof(d=void 0!==k.ColumnReqType&&k.ColumnReqType)?d:Object,"function"==typeof(u=void 0!==E.NcRequest&&E.NcRequest)?u:Object]),w("design:returntype",Promise)],x.prototype,"columnUpdate",null),b([(0,T.Delete)(["/api/v1/db/meta/columns/:columnId","/api/v2/meta/columns/:columnId"]),(0,O.Acl)("columnDelete"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("columnId")),v(2,(0,T.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(p=void 0!==E.NcContext&&E.NcContext)?p:Object,String,"function"==typeof(m=void 0!==E.NcRequest&&E.NcRequest)?m:Object]),w("design:returntype",Promise)],x.prototype,"columnDelete",null),b([(0,T.Get)(["/api/v1/db/meta/columns/:columnId","/api/v2/meta/columns/:columnId"]),(0,O.Acl)("columnGet"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("columnId")),w("design:type",Function),w("design:paramtypes",["function"==typeof(_=void 0!==E.NcContext&&E.NcContext)?_:Object,String]),w("design:returntype",Promise)],x.prototype,"columnGet",null),b([(0,T.Post)(["/api/v1/db/meta/columns/:columnId/primary","/api/v2/meta/columns/:columnId/primary"]),(0,T.HttpCode)(200),(0,O.Acl)("columnSetAsPrimary"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("columnId")),w("design:type",Function),w("design:paramtypes",["function"==typeof(f=void 0!==E.NcContext&&E.NcContext)?f:Object,String]),w("design:returntype",Promise)],x.prototype,"columnSetAsPrimary",null),b([(0,T.Get)(["/api/v1/db/meta/tables/:tableId/columns/hash","/api/v2/meta/tables/:tableId/columns/hash"]),(0,O.Acl)("columnsHash"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("tableId")),w("design:type",Function),w("design:paramtypes",["function"==typeof(h=void 0!==E.NcContext&&E.NcContext)?h:Object,String]),w("design:returntype",Promise)],x.prototype,"columnsHash",null),b([(0,T.Post)(["/api/v1/db/meta/tables/:tableId/columns/bulk","/api/v2/meta/tables/:tableId/columns/bulk"]),(0,T.HttpCode)(200),(0,O.Acl)("columnBulk"),v(0,(0,C.TenantContext)()),v(1,(0,T.Param)("tableId")),v(2,(0,T.Body)()),v(3,(0,T.Req)()),w("design:type",Function),w("design:paramtypes",["function"==typeof(g=void 0!==E.NcContext&&E.NcContext)?g:Object,String,Object,"function"==typeof(y=void 0!==E.NcRequest&&E.NcRequest)?y:Object]),w("design:returntype",Promise)],x.prototype,"columnBulk",null),t.ColumnsController=x=b([(0,T.Controller)(),(0,T.UseGuards)(I.MetaApiLimiterGuard,S.GlobalGuard),w("design:paramtypes",["function"==typeof(i=void 0!==M.ColumnsService&&M.ColumnsService)?i:Object])],x)},31188:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CommandPaletteController=void 0;const d=a(23324),u=a(23668),p=a(41004),m=a(47932),_=a(67240),f=a(48967);let h=class CommandPaletteController{constructor(e){this.commandPaletteService=e}async commandPalette(e){return this.commandPaletteService.commandPalette({user:null==e?void 0:e.user,body:e.body})}};t.CommandPaletteController=h,r([(0,d.Post)("/api/v1/command_palette"),(0,m.Acl)("commandPalette",{scope:"org"}),(0,d.HttpCode)(200),c(0,(0,d.Req)()),l("design:type",Function),l("design:paramtypes",["function"==typeof(s=void 0!==f.NcRequest&&f.NcRequest)?s:Object]),l("design:returntype",Promise)],h.prototype,"commandPalette",null),t.CommandPaletteController=h=r([(0,d.Controller)(),(0,d.UseGuards)(_.MetaApiLimiterGuard,u.GlobalGuard),l("design:paramtypes",["function"==typeof(i=void 0!==p.CommandPaletteService&&p.CommandPaletteService)?i:Object])],h)},28924:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsController=void 0;const h=a(23324),g=a(23668),y=a(99572),b=a(80948),w=a(47932),v=a(67240),T=a(26212),k=a(48967);let S=class CommentsController{constructor(e){this.commentsService=e}async commentList(e,t){return new y.PagedResponseImpl(await this.commentsService.commentList(e,{query:t.query}))}async commentRow(e,t,a){return await this.commentsService.commentRow(e,{user:t.user,body:a,req:t})}async commentDelete(e,t,a){return await this.commentsService.commentDelete(e,{commentId:a,user:t.user,req:t})}async commentUpdate(e,t,a,i){return await this.commentsService.commentUpdate(e,{commentId:t,user:a.user,body:i,req:a})}async commentsCount(e,t,a){return await this.commentsService.commentsCount(e,{fk_model_id:t,ids:a})}};t.CommentsController=S,m([(0,h.Get)(["/api/v1/db/meta/comments","/api/v2/meta/comments"]),(0,w.Acl)("commentList"),f(0,(0,T.TenantContext)()),f(1,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(s=void 0!==k.NcContext&&k.NcContext)?s:Object,Object]),_("design:returntype",Promise)],S.prototype,"commentList",null),m([(0,h.Post)(["/api/v1/db/meta/comments","/api/v2/meta/comments"]),(0,h.HttpCode)(200),(0,w.Acl)("commentRow"),f(0,(0,T.TenantContext)()),f(1,(0,h.Req)()),f(2,(0,h.Body)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(r=void 0!==k.NcContext&&k.NcContext)?r:Object,"function"==typeof(l=void 0!==k.NcRequest&&k.NcRequest)?l:Object,Object]),_("design:returntype",Promise)],S.prototype,"commentRow",null),m([(0,h.Delete)(["/api/v1/db/meta/comment/:commentId","/api/v2/meta/comment/:commentId"]),(0,w.Acl)("commentDelete"),f(0,(0,T.TenantContext)()),f(1,(0,h.Req)()),f(2,(0,h.Param)("commentId")),_("design:type",Function),_("design:paramtypes",["function"==typeof(c=void 0!==k.NcContext&&k.NcContext)?c:Object,"function"==typeof(d=void 0!==k.NcRequest&&k.NcRequest)?d:Object,String]),_("design:returntype",Promise)],S.prototype,"commentDelete",null),m([(0,h.Patch)(["/api/v1/db/meta/comment/:commentId","/api/v2/meta/comment/:commentId"]),(0,w.Acl)("commentUpdate"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("commentId")),f(2,(0,h.Req)()),f(3,(0,h.Body)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(u=void 0!==k.NcContext&&k.NcContext)?u:Object,String,Object,Object]),_("design:returntype",Promise)],S.prototype,"commentUpdate",null),m([(0,h.Get)(["/api/v1/db/meta/comments/count","/api/v2/meta/comments/count"]),(0,w.Acl)("commentsCount"),f(0,(0,T.TenantContext)()),f(1,(0,h.Query)("fk_model_id")),f(2,(0,h.Query)("ids")),_("design:type",Function),_("design:paramtypes",["function"==typeof(p=void 0!==k.NcContext&&k.NcContext)?p:Object,String,Array]),_("design:returntype",Promise)],S.prototype,"commentsCount",null),t.CommentsController=S=m([(0,h.Controller)(),(0,h.UseGuards)(v.MetaApiLimiterGuard,g.GlobalGuard),_("design:paramtypes",["function"==typeof(i=void 0!==b.CommentsService&&b.CommentsService)?i:Object])],S)},25040:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),_=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},f=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&p(t,e,a);return m(t,e),t},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasExportController=void 0;const y=a(23324),b=a(79224),w=f(a(42056)),v=a(23668),T=a(68144),k=a(44980),S=a(19684),M=a(47932),O=a(34608),I=a(26212),C=a(48967);let E=class DataAliasExportController{constructor(e){this.datasService=e}async excelDataExport(e,t,a){const{model:i,view:s}=await this.datasService.getViewAndModelFromRequestByAliasOrId(e,t);let r=s;r||(r=await S.View.getDefaultView(e,i.id));const{offset:l,elapsed:c,data:d}=await(0,k.extractXlsxData)(e,r,t),u=w.utils.book_new();w.utils.book_append_sheet(u,d,r.title);const p=w.write(u,{type:"base64",bookType:"xlsx"});a.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":l,"nc-export-elapsed-time":c,"Content-Disposition":`attachment; filename="${encodeURI(r.title)}-export.xlsx"`}),a.end(p)}async csvDataExport(e,t,a){const{model:i,view:s}=await this.datasService.getViewAndModelFromRequestByAliasOrId(e,t);let r=s;r||(r=await S.View.getDefaultView(e,i.id));const{offset:l,elapsed:c,data:d}=await(0,k.extractCsvData)(e,r,t);a.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":l,"nc-export-elapsed-time":c,"Content-Disposition":`attachment; filename="${encodeURI(r.title)}-export.csv"`}),a.send(d)}};t.DataAliasExportController=E,_([(0,y.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/export/excel","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/export/excel"]),(0,M.Acl)("exportExcel"),g(0,(0,I.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Res)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(s=void 0!==C.NcContext&&C.NcContext)?s:Object,"function"==typeof(r=void 0!==C.NcRequest&&C.NcRequest)?r:Object,"function"==typeof(l=void 0!==b.Response&&b.Response)?l:Object]),h("design:returntype",Promise)],E.prototype,"excelDataExport",null),_([(0,y.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/export/csv","/api/v1/db/data/:orgs/:baseName/:tableName/export/csv"]),(0,M.Acl)("exportCsv"),g(0,(0,I.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Res)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(c=void 0!==C.NcContext&&C.NcContext)?c:Object,"function"==typeof(d=void 0!==C.NcRequest&&C.NcRequest)?d:Object,"function"==typeof(u=void 0!==b.Response&&b.Response)?u:Object]),h("design:returntype",Promise)],E.prototype,"csvDataExport",null),t.DataAliasExportController=E=_([(0,y.Controller)(),(0,y.UseGuards)(O.DataApiLimiterGuard,v.GlobalGuard),h("design:paramtypes",["function"==typeof(i=void 0!==T.DatasService&&T.DatasService)?i:Object])],E)},93680:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},k=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasNestedController=void 0;const M=a(23324),O=a(15952),I=a(23668),C=a(47932),E=a(34608),x=a(26212),L=a(48967);let R=class DataAliasNestedController{constructor(e){this.dataAliasNestedService=e}async mmList(e,t,a,i,s,r){return await this.dataAliasNestedService.mmList(e,{query:t.query,columnName:a,rowId:i,baseName:s,tableName:r})}async mmExcludedList(e,t,a,i,s,r){return await this.dataAliasNestedService.mmExcludedList(e,{query:t.query,columnName:a,rowId:i,baseName:s,tableName:r})}async hmExcludedList(e,t,a,i,s,r){return await this.dataAliasNestedService.hmExcludedList(e,{query:t.query,columnName:a,rowId:i,baseName:s,tableName:r})}async btExcludedList(e,t,a,i,s,r){return await this.dataAliasNestedService.btExcludedList(e,{query:t.query,columnName:a,rowId:i,baseName:s,tableName:r})}async ooExcludedList(e,t,a,i,s,r){return await this.dataAliasNestedService.ooExcludedList(e,{query:t.query,columnName:a,rowId:i,baseName:s,tableName:r})}async hmList(e,t,a,i,s,r){return await this.dataAliasNestedService.hmList(e,{query:t.query,columnName:a,rowId:i,baseName:s,tableName:r})}async relationDataRemove(e,t,a,i,s,r,l){return await this.dataAliasNestedService.relationDataRemove(e,{columnName:a,rowId:i,baseName:s,tableName:r,cookie:t,refRowId:l}),{msg:"The relation data has been deleted successfully"}}async relationDataAdd(e,t,a,i,s,r,l){return await this.dataAliasNestedService.relationDataAdd(e,{columnName:a,rowId:i,baseName:s,tableName:r,cookie:t,refRowId:l}),{msg:"The relation data has been created successfully"}}};t.DataAliasNestedController=R,T([(0,M.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/mm/:columnName"]),(0,C.Acl)("mmList"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),k("design:type",Function),k("design:paramtypes",["function"==typeof(s=void 0!==L.NcContext&&L.NcContext)?s:Object,"function"==typeof(r=void 0!==L.NcRequest&&L.NcRequest)?r:Object,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"mmList",null),T([(0,M.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/mm/:columnName/exclude"]),(0,C.Acl)("mmExcludedList"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),k("design:type",Function),k("design:paramtypes",["function"==typeof(l=void 0!==L.NcContext&&L.NcContext)?l:Object,"function"==typeof(c=void 0!==L.NcRequest&&L.NcRequest)?c:Object,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"mmExcludedList",null),T([(0,M.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/hm/:columnName/exclude"]),(0,C.Acl)("hmExcludedList"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),k("design:type",Function),k("design:paramtypes",["function"==typeof(d=void 0!==L.NcContext&&L.NcContext)?d:Object,"function"==typeof(u=void 0!==L.NcRequest&&L.NcRequest)?u:Object,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"hmExcludedList",null),T([(0,M.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/bt/:columnName/exclude"]),(0,C.Acl)("btExcludedList"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),k("design:type",Function),k("design:paramtypes",["function"==typeof(p=void 0!==L.NcContext&&L.NcContext)?p:Object,"function"==typeof(m=void 0!==L.NcRequest&&L.NcRequest)?m:Object,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"btExcludedList",null),T([(0,M.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/oo/:columnName/exclude"]),(0,C.Acl)("ooExcludedList"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),k("design:type",Function),k("design:paramtypes",["function"==typeof(_=void 0!==L.NcContext&&L.NcContext)?_:Object,"function"==typeof(f=void 0!==L.NcRequest&&L.NcRequest)?f:Object,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"ooExcludedList",null),T([(0,M.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/hm/:columnName"]),(0,C.Acl)("hmList"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),k("design:type",Function),k("design:paramtypes",["function"==typeof(h=void 0!==L.NcContext&&L.NcContext)?h:Object,"function"==typeof(g=void 0!==L.NcRequest&&L.NcRequest)?g:Object,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"hmList",null),T([(0,M.Delete)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/:relationType/:columnName/:refRowId"]),(0,C.Acl)("relationDataRemove"),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),S(6,(0,M.Param)("refRowId")),k("design:type",Function),k("design:paramtypes",["function"==typeof(y=void 0!==L.NcContext&&L.NcContext)?y:Object,"function"==typeof(b=void 0!==L.NcRequest&&L.NcRequest)?b:Object,String,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"relationDataRemove",null),T([(0,M.Post)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/:relationType/:columnName/:refRowId"]),(0,C.Acl)("relationDataAdd"),(0,M.HttpCode)(200),S(0,(0,x.TenantContext)()),S(1,(0,M.Req)()),S(2,(0,M.Param)("columnName")),S(3,(0,M.Param)("rowId")),S(4,(0,M.Param)("baseName")),S(5,(0,M.Param)("tableName")),S(6,(0,M.Param)("refRowId")),k("design:type",Function),k("design:paramtypes",["function"==typeof(w=void 0!==L.NcContext&&L.NcContext)?w:Object,"function"==typeof(v=void 0!==L.NcRequest&&L.NcRequest)?v:Object,String,String,String,String,String]),k("design:returntype",Promise)],R.prototype,"relationDataAdd",null),t.DataAliasNestedController=R=T([(0,M.Controller)(),(0,M.UseGuards)(E.DataApiLimiterGuard,I.GlobalGuard),k("design:paramtypes",["function"==typeof(i=void 0!==O.DataAliasNestedService&&O.DataAliasNestedService)?i:Object])],R)},45916:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k,S,M,O,I,C,E,x=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},L=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasController=void 0;const N=a(23324),A=a(79224),D=a(23668),j=a(43468),P=a(47932),q=a(68144),U=a(34608),$=a(26212),Y=a(48967);let B=class DataAliasController{constructor(e){this.datasService=e}async dataList(e,t,a,i,s,r,l){const c=process.hrtime(),d=await this.datasService.dataList(e,{query:t.query,baseName:i,tableName:s,viewName:r,disableOptimization:"false"===l}),u=(0,j.parseHrtimeToMilliSeconds)(process.hrtime(c));a.setHeader("xc-db-response",u),d.stats&&(d.stats.apiHandlingTime=u),a.json(d)}async dataFindOne(e,t,a,i,s){return await this.datasService.dataFindOne(e,{query:t.query,baseName:a,tableName:i,viewName:s})}async dataGroupBy(e,t,a,i,s){return await this.datasService.dataGroupBy(e,{query:t.query,baseName:a,tableName:i,viewName:s})}async dataCount(e,t,a,i,s,r){const l=await this.datasService.dataCount(e,{query:t.query,baseName:i,tableName:s,viewName:r});a.json(l)}async dataInsert(e,t,a,i,s,r,l){return await this.datasService.dataInsert(e,{baseName:a,tableName:i,viewName:s,body:r,cookie:t,disableOptimization:"false"===l})}async dataUpdate(e,t,a,i,s,r,l){return await this.datasService.dataUpdate(e,{baseName:a,tableName:i,viewName:s,body:t.body,cookie:t,rowId:r,disableOptimization:"false"===l})}async dataDelete(e,t,a,i,s,r){return await this.datasService.dataDelete(e,{baseName:a,tableName:i,viewName:s,cookie:t,rowId:r})}async dataRead(e,t,a,i,s,r,l,c){return await this.datasService.dataRead(e,{baseName:a,tableName:i,viewName:s,rowId:r,query:t.query,disableOptimization:"false"===l,getHiddenColumn:c})}async dataExist(e,t,a,i,s,r,l){const c=await this.datasService.dataExist(e,{baseName:i,tableName:s,viewName:r,rowId:l,query:t.query});a.json(c)}async groupedDataList(e,t,a,i,s,r,l){const c=process.hrtime(),d=await this.datasService.groupedDataList(e,{baseName:i,tableName:s,viewName:r,query:t.query,columnId:l}),u=(0,j.parseHrtimeToMilliSeconds)(process.hrtime(c));a.setHeader("xc-db-response",u),a.json(d)}};t.DataAliasController=B,x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName"]),(0,P.Acl)("dataList"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Res)()),R(3,(0,N.Param)("baseName")),R(4,(0,N.Param)("tableName")),R(5,(0,N.Param)("viewName")),R(6,(0,N.Query)("opt")),L("design:type",Function),L("design:paramtypes",["function"==typeof(s=void 0!==Y.NcContext&&Y.NcContext)?s:Object,"function"==typeof(r=void 0!==Y.NcRequest&&Y.NcRequest)?r:Object,"function"==typeof(l=void 0!==A.Response&&A.Response)?l:Object,String,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataList",null),x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/find-one","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/find-one"]),(0,P.Acl)("dataFindOne"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("baseName")),R(3,(0,N.Param)("tableName")),R(4,(0,N.Param)("viewName")),L("design:type",Function),L("design:paramtypes",["function"==typeof(c=void 0!==Y.NcContext&&Y.NcContext)?c:Object,"function"==typeof(d=void 0!==Y.NcRequest&&Y.NcRequest)?d:Object,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataFindOne",null),x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/groupby","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/groupby"]),(0,P.Acl)("dataGroupBy"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("baseName")),R(3,(0,N.Param)("tableName")),R(4,(0,N.Param)("viewName")),L("design:type",Function),L("design:paramtypes",["function"==typeof(u=void 0!==Y.NcContext&&Y.NcContext)?u:Object,"function"==typeof(p=void 0!==Y.NcRequest&&Y.NcRequest)?p:Object,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataGroupBy",null),x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/count","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/count"]),(0,P.Acl)("dataCount"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Res)()),R(3,(0,N.Param)("baseName")),R(4,(0,N.Param)("tableName")),R(5,(0,N.Param)("viewName")),L("design:type",Function),L("design:paramtypes",["function"==typeof(m=void 0!==Y.NcContext&&Y.NcContext)?m:Object,"function"==typeof(_=void 0!==Y.NcRequest&&Y.NcRequest)?_:Object,"function"==typeof(f=void 0!==A.Response&&A.Response)?f:Object,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataCount",null),x([(0,N.Post)(["/api/v1/db/data/:orgs/:baseName/:tableName","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName"]),(0,N.HttpCode)(200),(0,P.Acl)("dataInsert"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("baseName")),R(3,(0,N.Param)("tableName")),R(4,(0,N.Param)("viewName")),R(5,(0,N.Body)()),R(6,(0,N.Query)("opt")),L("design:type",Function),L("design:paramtypes",["function"==typeof(h=void 0!==Y.NcContext&&Y.NcContext)?h:Object,"function"==typeof(g=void 0!==Y.NcRequest&&Y.NcRequest)?g:Object,String,String,String,Object,String]),L("design:returntype",Promise)],B.prototype,"dataInsert",null),x([(0,N.Patch)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/:rowId"]),(0,P.Acl)("dataUpdate"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("baseName")),R(3,(0,N.Param)("tableName")),R(4,(0,N.Param)("viewName")),R(5,(0,N.Param)("rowId")),R(6,(0,N.Query)("opt")),L("design:type",Function),L("design:paramtypes",["function"==typeof(y=void 0!==Y.NcContext&&Y.NcContext)?y:Object,"function"==typeof(b=void 0!==Y.NcRequest&&Y.NcRequest)?b:Object,String,String,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataUpdate",null),x([(0,N.Delete)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/:rowId"]),(0,P.Acl)("dataDelete"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("baseName")),R(3,(0,N.Param)("tableName")),R(4,(0,N.Param)("viewName")),R(5,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(w=void 0!==Y.NcContext&&Y.NcContext)?w:Object,"function"==typeof(v=void 0!==Y.NcRequest&&Y.NcRequest)?v:Object,String,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataDelete",null),x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/:rowId"]),(0,P.Acl)("dataRead"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("baseName")),R(3,(0,N.Param)("tableName")),R(4,(0,N.Param)("viewName")),R(5,(0,N.Param)("rowId")),R(6,(0,N.Query)("opt")),R(7,(0,N.Query)("getHiddenColumn")),L("design:type",Function),L("design:paramtypes",["function"==typeof(T=void 0!==Y.NcContext&&Y.NcContext)?T:Object,"function"==typeof(k=void 0!==Y.NcRequest&&Y.NcRequest)?k:Object,String,String,String,String,String,Boolean]),L("design:returntype",Promise)],B.prototype,"dataRead",null),x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/:rowId/exist","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/:rowId/exist"]),(0,P.Acl)("dataExist"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Res)()),R(3,(0,N.Param)("baseName")),R(4,(0,N.Param)("tableName")),R(5,(0,N.Param)("viewName")),R(6,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(S=void 0!==Y.NcContext&&Y.NcContext)?S:Object,"function"==typeof(M=void 0!==Y.NcRequest&&Y.NcRequest)?M:Object,"function"==typeof(O=void 0!==A.Response&&A.Response)?O:Object,String,String,String,String]),L("design:returntype",Promise)],B.prototype,"dataExist",null),x([(0,N.Get)(["/api/v1/db/data/:orgs/:baseName/:tableName/group/:columnId","/api/v1/db/data/:orgs/:baseName/:tableName/views/:viewName/group/:columnId"]),(0,P.Acl)("groupedDataList"),R(0,(0,$.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Res)()),R(3,(0,N.Param)("baseName")),R(4,(0,N.Param)("tableName")),R(5,(0,N.Param)("viewName")),R(6,(0,N.Param)("columnId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(I=void 0!==Y.NcContext&&Y.NcContext)?I:Object,"function"==typeof(C=void 0!==Y.NcRequest&&Y.NcRequest)?C:Object,"function"==typeof(E=void 0!==A.Response&&A.Response)?E:Object,String,String,String,String]),L("design:returntype",Promise)],B.prototype,"groupedDataList",null),t.DataAliasController=B=x([(0,N.Controller)(),(0,N.UseGuards)(U.DataApiLimiterGuard,D.GlobalGuard),L("design:paramtypes",["function"==typeof(i=void 0!==q.DatasService&&q.DatasService)?i:Object])],B)},77108:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k,S,M,O,I,C,E,x,L,R,N,A=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},D=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},j=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataTableController=void 0;const P=a(23324),q=a(79224),U=a(47932),$=a(15132),Y=a(43468),B=a(34608),F=a(23668),V=a(26212),H=a(48967);let G=class DataTableController{constructor(e){this.dataTableService=e}async dataList(e,t,a,i,s){const r=process.hrtime(),l=await this.dataTableService.dataList(e,{query:t.query,modelId:i,viewId:s}),c=(0,Y.parseHrtimeToMilliSeconds)(process.hrtime(r));a.setHeader("xc-db-response",c),a.json(l)}async dataCount(e,t,a,i,s){const r=await this.dataTableService.dataCount(e,{query:t.query,modelId:i,viewId:s});a.json(r)}async dataInsert(e,t,a,i,s){return await this.dataTableService.dataInsert(e,{modelId:a,body:s,viewId:i,cookie:t})}async dataUpdate(e,t,a,i,s){return await this.dataTableService.dataUpdate(e,{modelId:a,body:t.body,cookie:t,viewId:i})}async dataDelete(e,t,a,i,s){return await this.dataTableService.dataDelete(e,{modelId:a,cookie:t,viewId:i,body:t.body})}async dataAggregate(e,t,a,i){return await this.dataTableService.dataAggregate(e,{query:t.query,modelId:a,viewId:i})}async bulkGroupBy(e,t,a,i){return await this.dataTableService.bulkGroupBy(e,{query:t.query,modelId:a,viewId:i,body:t.body})}async bulkDataList(e,t,a,i){return await this.dataTableService.bulkDataList(e,{query:t.query,modelId:a,viewId:i,body:t.body})}async dataRead(e,t,a,i,s){return await this.dataTableService.dataRead(e,{modelId:a,rowId:s,query:t.query,viewId:i})}async nestedDataList(e,t,a,i,s,r){return await this.dataTableService.nestedDataList(e,{modelId:a,rowId:r,query:t.query,viewId:i,columnId:s})}async nestedLink(e,t,a,i,s,r,l){return await this.dataTableService.nestedLink(e,{modelId:a,rowId:r,query:t.query,viewId:i,columnId:s,refRowIds:l,cookie:t})}async nestedUnlink(e,t,a,i,s,r,l){return await this.dataTableService.nestedUnlink(e,{modelId:a,rowId:r,query:t.query,viewId:i,columnId:s,refRowIds:l,cookie:t})}async nestedListCopyPasteOrDeleteAll(e,t,a,i,s,r){return await this.dataTableService.nestedListCopyPasteOrDeleteAll(e,{modelId:a,query:t.query,viewId:i,columnId:s,data:r,cookie:t})}};t.DataTableController=G,A([(0,P.Get)("/api/v2/tables/:modelId/records"),(0,U.Acl)("dataList"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Res)()),j(3,(0,P.Param)("modelId")),j(4,(0,P.Query)("viewId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(s=void 0!==H.NcContext&&H.NcContext)?s:Object,"function"==typeof(r=void 0!==H.NcRequest&&H.NcRequest)?r:Object,"function"==typeof(l=void 0!==q.Response&&q.Response)?l:Object,String,String]),D("design:returntype",Promise)],G.prototype,"dataList",null),A([(0,P.Get)(["/api/v2/tables/:modelId/records/count"]),(0,U.Acl)("dataCount"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Res)()),j(3,(0,P.Param)("modelId")),j(4,(0,P.Query)("viewId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(c=void 0!==H.NcContext&&H.NcContext)?c:Object,"function"==typeof(d=void 0!==H.NcRequest&&H.NcRequest)?d:Object,"function"==typeof(u=void 0!==q.Response&&q.Response)?u:Object,String,String]),D("design:returntype",Promise)],G.prototype,"dataCount",null),A([(0,P.Post)(["/api/v2/tables/:modelId/records"]),(0,P.HttpCode)(200),(0,U.Acl)("dataInsert"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Body)()),D("design:type",Function),D("design:paramtypes",["function"==typeof(p=void 0!==H.NcContext&&H.NcContext)?p:Object,"function"==typeof(m=void 0!==H.NcRequest&&H.NcRequest)?m:Object,String,String,Object]),D("design:returntype",Promise)],G.prototype,"dataInsert",null),A([(0,P.Patch)(["/api/v2/tables/:modelId/records"]),(0,U.Acl)("dataUpdate"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("rowId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(_=void 0!==H.NcContext&&H.NcContext)?_:Object,"function"==typeof(f=void 0!==H.NcRequest&&H.NcRequest)?f:Object,String,String,String]),D("design:returntype",Promise)],G.prototype,"dataUpdate",null),A([(0,P.Delete)(["/api/v2/tables/:modelId/records"]),(0,U.Acl)("dataDelete"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("rowId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(h=void 0!==H.NcContext&&H.NcContext)?h:Object,"function"==typeof(g=void 0!==H.NcRequest&&H.NcRequest)?g:Object,String,String,String]),D("design:returntype",Promise)],G.prototype,"dataDelete",null),A([(0,P.Get)(["/api/v2/tables/:modelId/aggregate"]),(0,U.Acl)("dataAggregate"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(y=void 0!==H.NcContext&&H.NcContext)?y:Object,"function"==typeof(b=void 0!==H.NcRequest&&H.NcRequest)?b:Object,String,String]),D("design:returntype",Promise)],G.prototype,"dataAggregate",null),A([(0,P.Post)(["/api/v2/tables/:modelId/bulk/group"]),(0,U.Acl)("dataGroupBy"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(w=void 0!==H.NcContext&&H.NcContext)?w:Object,"function"==typeof(v=void 0!==H.NcRequest&&H.NcRequest)?v:Object,String,String]),D("design:returntype",Promise)],G.prototype,"bulkGroupBy",null),A([(0,P.Post)(["/api/v2/tables/:modelId/bulk/datalist"]),(0,U.Acl)("dataList"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(T=void 0!==H.NcContext&&H.NcContext)?T:Object,"function"==typeof(k=void 0!==H.NcRequest&&H.NcRequest)?k:Object,String,String]),D("design:returntype",Promise)],G.prototype,"bulkDataList",null),A([(0,P.Get)(["/api/v2/tables/:modelId/records/:rowId"]),(0,U.Acl)("dataRead"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("rowId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(S=void 0!==H.NcContext&&H.NcContext)?S:Object,"function"==typeof(M=void 0!==H.NcRequest&&H.NcRequest)?M:Object,String,String,String]),D("design:returntype",Promise)],G.prototype,"dataRead",null),A([(0,P.Get)(["/api/v2/tables/:modelId/links/:columnId/records/:rowId"]),(0,U.Acl)("nestedDataList"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("columnId")),j(5,(0,P.Param)("rowId")),D("design:type",Function),D("design:paramtypes",["function"==typeof(O=void 0!==H.NcContext&&H.NcContext)?O:Object,"function"==typeof(I=void 0!==H.NcRequest&&H.NcRequest)?I:Object,String,String,String,String]),D("design:returntype",Promise)],G.prototype,"nestedDataList",null),A([(0,P.Post)(["/api/v2/tables/:modelId/links/:columnId/records/:rowId"]),(0,U.Acl)("nestedDataLink"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("columnId")),j(5,(0,P.Param)("rowId")),j(6,(0,P.Body)()),D("design:type",Function),D("design:paramtypes",["function"==typeof(C=void 0!==H.NcContext&&H.NcContext)?C:Object,"function"==typeof(E=void 0!==H.NcRequest&&H.NcRequest)?E:Object,String,String,String,String,Object]),D("design:returntype",Promise)],G.prototype,"nestedLink",null),A([(0,P.Delete)(["/api/v2/tables/:modelId/links/:columnId/records/:rowId"]),(0,U.Acl)("nestedDataUnlink"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("columnId")),j(5,(0,P.Param)("rowId")),j(6,(0,P.Body)()),D("design:type",Function),D("design:paramtypes",["function"==typeof(x=void 0!==H.NcContext&&H.NcContext)?x:Object,"function"==typeof(L=void 0!==H.NcRequest&&H.NcRequest)?L:Object,String,String,String,String,Object]),D("design:returntype",Promise)],G.prototype,"nestedUnlink",null),A([(0,P.Post)(["/api/v2/tables/:modelId/links/:columnId/records"]),(0,U.Acl)("nestedDataListCopyPasteOrDeleteAll"),j(0,(0,V.TenantContext)()),j(1,(0,P.Req)()),j(2,(0,P.Param)("modelId")),j(3,(0,P.Query)("viewId")),j(4,(0,P.Param)("columnId")),j(5,(0,P.Body)()),D("design:type",Function),D("design:paramtypes",["function"==typeof(R=void 0!==H.NcContext&&H.NcContext)?R:Object,"function"==typeof(N=void 0!==H.NcRequest&&H.NcRequest)?N:Object,String,String,String,Array]),D("design:returntype",Promise)],G.prototype,"nestedListCopyPasteOrDeleteAll",null),t.DataTableController=G=A([(0,P.Controller)(),(0,P.UseGuards)(B.DataApiLimiterGuard,F.GlobalGuard),D("design:paramtypes",["function"==typeof(i=void 0!==$.DataTableService&&$.DataTableService)?i:Object])],G)},21388:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k,S,M,O,I,C,E,x=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},L=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasController=void 0;const N=a(23324),A=a(23668),D=a(68144),j=a(47932),P=a(34608),q=a(26212),U=a(48967);let $=class DatasController{constructor(e){this.datasService=e}async dataList(e,t,a){return await this.datasService.dataListByViewId(e,{viewId:a,query:t.query})}async mmList(e,t,a,i,s){return await this.datasService.mmList(e,{viewId:a,colId:i,rowId:s,query:t.query})}async mmExcludedList(e,t,a,i,s){return await this.datasService.mmExcludedList(e,{viewId:a,colId:i,rowId:s,query:t.query})}async hmExcludedList(e,t,a,i,s){await this.datasService.hmExcludedList(e,{viewId:a,colId:i,rowId:s,query:t.query})}async btExcludedList(e,t,a,i,s){return await this.datasService.btExcludedList(e,{viewId:a,colId:i,rowId:s,query:t.query})}async hmList(e,t,a,i,s){return await this.datasService.hmList(e,{viewId:a,colId:i,rowId:s,query:t.query})}async dataRead(e,t,a,i){return await this.datasService.dataReadByViewId(e,{viewId:a,rowId:i,query:t.query})}async dataInsert(e,t,a,i){return await this.datasService.dataInsertByViewId(e,{viewId:a,body:i,cookie:t})}async dataUpdate(e,t,a,i,s){return await this.datasService.dataUpdateByViewId(e,{viewId:a,rowId:i,body:s,cookie:t})}async dataDelete(e,t,a,i){return await this.datasService.dataDeleteByViewId(e,{viewId:a,rowId:i,cookie:t})}async relationDataDelete(e,t,a,i,s,r,l){return await this.datasService.relationDataDelete(e,{viewId:a,colId:r,childId:l,rowId:i,cookie:t}),{msg:"The relation data has been deleted successfully"}}async relationDataAdd(e,t,a,i,s,r,l){return await this.datasService.relationDataAdd(e,{viewId:a,colId:r,childId:l,rowId:i,cookie:t}),{msg:"The relation data has been created successfully"}}};t.DatasController=$,x([(0,N.Get)("/data/:viewId/"),(0,j.Acl)("dataList"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(s=void 0!==U.NcContext&&U.NcContext)?s:Object,"function"==typeof(r=void 0!==U.NcRequest&&U.NcRequest)?r:Object,String]),L("design:returntype",Promise)],$.prototype,"dataList",null),x([(0,N.Get)("/data/:viewId/:rowId/mm/:colId"),(0,j.Acl)("mmList"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("colId")),R(4,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(l=void 0!==U.NcContext&&U.NcContext)?l:Object,"function"==typeof(c=void 0!==U.NcRequest&&U.NcRequest)?c:Object,String,String,String]),L("design:returntype",Promise)],$.prototype,"mmList",null),x([(0,N.Get)("/data/:viewId/:rowId/mm/:colId/exclude"),(0,j.Acl)("mmExcludedList"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("colId")),R(4,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(d=void 0!==U.NcContext&&U.NcContext)?d:Object,"function"==typeof(u=void 0!==U.NcRequest&&U.NcRequest)?u:Object,String,String,String]),L("design:returntype",Promise)],$.prototype,"mmExcludedList",null),x([(0,N.Get)("/data/:viewId/:rowId/hm/:colId/exclude"),(0,j.Acl)("hmExcludedList"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("colId")),R(4,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(p=void 0!==U.NcContext&&U.NcContext)?p:Object,"function"==typeof(m=void 0!==U.NcRequest&&U.NcRequest)?m:Object,String,String,String]),L("design:returntype",Promise)],$.prototype,"hmExcludedList",null),x([(0,N.Get)("/data/:viewId/:rowId/bt/:colId/exclude"),(0,j.Acl)("btExcludedList"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("colId")),R(4,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(_=void 0!==U.NcContext&&U.NcContext)?_:Object,"function"==typeof(f=void 0!==U.NcRequest&&U.NcRequest)?f:Object,String,String,String]),L("design:returntype",Promise)],$.prototype,"btExcludedList",null),x([(0,N.Get)("/data/:viewId/:rowId/hm/:colId"),(0,j.Acl)("hmList"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("colId")),R(4,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(h=void 0!==U.NcContext&&U.NcContext)?h:Object,"function"==typeof(g=void 0!==U.NcRequest&&U.NcRequest)?g:Object,String,String,String]),L("design:returntype",Promise)],$.prototype,"hmList",null),x([(0,N.Get)("/data/:viewId/:rowId"),(0,j.Acl)("dataRead"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(y=void 0!==U.NcContext&&U.NcContext)?y:Object,"function"==typeof(b=void 0!==U.NcRequest&&U.NcRequest)?b:Object,String,String]),L("design:returntype",Promise)],$.prototype,"dataRead",null),x([(0,N.Post)("/data/:viewId/"),(0,N.HttpCode)(200),(0,j.Acl)("dataInsert"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Body)()),L("design:type",Function),L("design:paramtypes",["function"==typeof(w=void 0!==U.NcContext&&U.NcContext)?w:Object,"function"==typeof(v=void 0!==U.NcRequest&&U.NcRequest)?v:Object,String,Object]),L("design:returntype",Promise)],$.prototype,"dataInsert",null),x([(0,N.Patch)("/data/:viewId/:rowId"),(0,j.Acl)("dataUpdate"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("rowId")),R(4,(0,N.Body)()),L("design:type",Function),L("design:paramtypes",["function"==typeof(T=void 0!==U.NcContext&&U.NcContext)?T:Object,"function"==typeof(k=void 0!==U.NcRequest&&U.NcRequest)?k:Object,String,String,Object]),L("design:returntype",Promise)],$.prototype,"dataUpdate",null),x([(0,N.Delete)("/data/:viewId/:rowId"),(0,j.Acl)("dataDelete"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("rowId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(S=void 0!==U.NcContext&&U.NcContext)?S:Object,"function"==typeof(M=void 0!==U.NcRequest&&U.NcRequest)?M:Object,String,String]),L("design:returntype",Promise)],$.prototype,"dataDelete",null),x([(0,N.Delete)("/data/:viewId/:rowId/:relationType/:colId/:childId"),(0,j.Acl)("relationDataDelete"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("rowId")),R(4,(0,N.Param)("relationType")),R(5,(0,N.Param)("colId")),R(6,(0,N.Param)("childId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(O=void 0!==U.NcContext&&U.NcContext)?O:Object,"function"==typeof(I=void 0!==U.NcRequest&&U.NcRequest)?I:Object,String,String,String,String,String]),L("design:returntype",Promise)],$.prototype,"relationDataDelete",null),x([(0,N.Post)("/data/:viewId/:rowId/:relationType/:colId/:childId"),(0,N.HttpCode)(200),(0,j.Acl)("relationDataAdd"),R(0,(0,q.TenantContext)()),R(1,(0,N.Req)()),R(2,(0,N.Param)("viewId")),R(3,(0,N.Param)("rowId")),R(4,(0,N.Param)("relationType")),R(5,(0,N.Param)("colId")),R(6,(0,N.Param)("childId")),L("design:type",Function),L("design:paramtypes",["function"==typeof(C=void 0!==U.NcContext&&U.NcContext)?C:Object,"function"==typeof(E=void 0!==U.NcRequest&&U.NcRequest)?E:Object,String,String,String,String,String]),L("design:returntype",Promise)],$.prototype,"relationDataAdd",null),t.DatasController=$=x([(0,N.Controller)(),(0,N.UseGuards)(P.DataApiLimiterGuard,A.GlobalGuard),L("design:paramtypes",["function"==typeof(i=void 0!==D.DatasService&&D.DatasService)?i:Object])],$)},54596:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionsController=void 0;const w=a(23324),v=a(23668),T=a(44596),k=a(47932),S=a(67240),M=a(99572),O=a(26212),I=a(48967);let C=class ExtensionsController{constructor(e){this.extensionsService=e}async extensionList(e,t,a){return new M.PagedResponseImpl(await this.extensionsService.extensionList(e,{baseId:t}))}async extensionCreate(e,t,a,i){return await this.extensionsService.extensionCreate(e,{extension:Object.assign(Object.assign({},a),{base_id:t}),req:i})}async extensionRead(e,t){return await this.extensionsService.extensionRead(e,{extensionId:t})}async extensionUpdate(e,t,a,i){return await this.extensionsService.extensionUpdate(e,{extensionId:t,extension:a,req:i})}async extensionDelete(e,t,a){return await this.extensionsService.extensionDelete(e,{extensionId:t,req:a})}};t.ExtensionsController=C,g([(0,w.Get)(["/api/v2/extensions/:baseId"]),(0,k.Acl)("extensionList"),b(0,(0,O.TenantContext)()),b(1,(0,w.Param)("baseId")),b(2,(0,w.Req)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(s=void 0!==I.NcContext&&I.NcContext)?s:Object,String,"function"==typeof(r=void 0!==I.NcRequest&&I.NcRequest)?r:Object]),y("design:returntype",Promise)],C.prototype,"extensionList",null),g([(0,w.Post)(["/api/v2/extensions/:baseId"]),(0,k.Acl)("extensionCreate"),b(0,(0,O.TenantContext)()),b(1,(0,w.Param)("baseId")),b(2,(0,w.Body)()),b(3,(0,w.Req)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(l=void 0!==I.NcContext&&I.NcContext)?l:Object,String,"function"==typeof(c="undefined"!=typeof Partial&&Partial)?c:Object,"function"==typeof(d=void 0!==I.NcRequest&&I.NcRequest)?d:Object]),y("design:returntype",Promise)],C.prototype,"extensionCreate",null),g([(0,w.Get)(["/api/v2/extensions/:extensionId"]),(0,k.Acl)("extensionRead"),b(0,(0,O.TenantContext)()),b(1,(0,w.Param)("extensionId")),y("design:type",Function),y("design:paramtypes",["function"==typeof(u=void 0!==I.NcContext&&I.NcContext)?u:Object,String]),y("design:returntype",Promise)],C.prototype,"extensionRead",null),g([(0,w.Patch)(["/api/v2/extensions/:extensionId"]),(0,k.Acl)("extensionUpdate"),b(0,(0,O.TenantContext)()),b(1,(0,w.Param)("extensionId")),b(2,(0,w.Body)()),b(3,(0,w.Req)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(p=void 0!==I.NcContext&&I.NcContext)?p:Object,String,"function"==typeof(m="undefined"!=typeof Partial&&Partial)?m:Object,"function"==typeof(_=void 0!==I.NcRequest&&I.NcRequest)?_:Object]),y("design:returntype",Promise)],C.prototype,"extensionUpdate",null),g([(0,w.Delete)(["/api/v2/extensions/:extensionId"]),(0,k.Acl)("extensionDelete"),b(0,(0,O.TenantContext)()),b(1,(0,w.Param)("extensionId")),b(2,(0,w.Req)()),y("design:type",Function),y("design:paramtypes",["function"==typeof(f=void 0!==I.NcContext&&I.NcContext)?f:Object,String,"function"==typeof(h=void 0!==I.NcRequest&&I.NcRequest)?h:Object]),y("design:returntype",Promise)],C.prototype,"extensionDelete",null),t.ExtensionsController=C=g([(0,w.Controller)(),(0,w.UseGuards)(S.MetaApiLimiterGuard,v.GlobalGuard),y("design:paramtypes",["function"==typeof(i=void 0!==T.ExtensionsService&&T.ExtensionsService)?i:Object])],C)},74580:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},T=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},k=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FiltersController=void 0;const S=a(23324),M=a(71040),O=a(23668),I=a(99572),C=a(53311),E=a(47932),x=a(67240),L=a(26212),R=a(48967);let N=class FiltersController{constructor(e){this.filtersService=e}async filterList(e,t,a){return new I.PagedResponseImpl(await this.filtersService.filterList(e,{viewId:t,includeAllFilters:"true"===a}))}async filterCreate(e,t,a,i){return await this.filtersService.filterCreate(e,{filter:a,viewId:t,user:i.user,req:i})}async hookFilterCreate(e,t,a,i){return await this.filtersService.hookFilterCreate(e,{filter:a,hookId:t,user:i.user,req:i})}async filterGet(e,t){return await this.filtersService.filterGet(e,{filterId:t})}async filterChildrenRead(e,t){return new I.PagedResponseImpl(await this.filtersService.filterChildrenList(e,{filterId:t}))}async filterUpdate(e,t,a,i){return await this.filtersService.filterUpdate(e,{filterId:t,filter:a,user:i.user,req:i})}async filterDelete(e,t,a){return await this.filtersService.filterDelete(e,{req:a,filterId:t})}async hookFilterList(e,t){return new I.PagedResponseImpl(await this.filtersService.hookFilterList(e,{hookId:t}))}};t.FiltersController=N,v([(0,S.Get)(["/api/v1/db/meta/views/:viewId/filters","/api/v2/meta/views/:viewId/filters"]),(0,E.Acl)("filterList"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("viewId")),k(2,(0,S.Query)("includeAllFilters")),T("design:type",Function),T("design:paramtypes",["function"==typeof(s=void 0!==R.NcContext&&R.NcContext)?s:Object,String,String]),T("design:returntype",Promise)],N.prototype,"filterList",null),v([(0,S.Post)(["/api/v1/db/meta/views/:viewId/filters","/api/v2/meta/views/:viewId/filters"]),(0,S.HttpCode)(200),(0,E.Acl)("filterCreate"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("viewId")),k(2,(0,S.Body)()),k(3,(0,S.Req)()),T("design:type",Function),T("design:paramtypes",["function"==typeof(r=void 0!==R.NcContext&&R.NcContext)?r:Object,String,"function"==typeof(l=void 0!==M.FilterReqType&&M.FilterReqType)?l:Object,"function"==typeof(c=void 0!==R.NcRequest&&R.NcRequest)?c:Object]),T("design:returntype",Promise)],N.prototype,"filterCreate",null),v([(0,S.Post)(["/api/v1/db/meta/hooks/:hookId/filters","/api/v2/meta/hooks/:hookId/filters"]),(0,S.HttpCode)(200),(0,E.Acl)("hookFilterCreate"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("hookId")),k(2,(0,S.Body)()),k(3,(0,S.Req)()),T("design:type",Function),T("design:paramtypes",["function"==typeof(d=void 0!==R.NcContext&&R.NcContext)?d:Object,String,"function"==typeof(u=void 0!==M.FilterReqType&&M.FilterReqType)?u:Object,"function"==typeof(p=void 0!==R.NcRequest&&R.NcRequest)?p:Object]),T("design:returntype",Promise)],N.prototype,"hookFilterCreate",null),v([(0,S.Get)(["/api/v1/db/meta/filters/:filterId","/api/v2/meta/filters/:filterId"]),(0,E.Acl)("filterGet"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("filterId")),T("design:type",Function),T("design:paramtypes",["function"==typeof(m=void 0!==R.NcContext&&R.NcContext)?m:Object,String]),T("design:returntype",Promise)],N.prototype,"filterGet",null),v([(0,S.Get)(["/api/v1/db/meta/filters/:filterParentId/children","/api/v2/meta/filters/:filterParentId/children"]),(0,E.Acl)("filterChildrenList"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("filterParentId")),T("design:type",Function),T("design:paramtypes",["function"==typeof(_=void 0!==R.NcContext&&R.NcContext)?_:Object,String]),T("design:returntype",Promise)],N.prototype,"filterChildrenRead",null),v([(0,S.Patch)(["/api/v1/db/meta/filters/:filterId","/api/v2/meta/filters/:filterId"]),(0,E.Acl)("filterUpdate"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("filterId")),k(2,(0,S.Body)()),k(3,(0,S.Req)()),T("design:type",Function),T("design:paramtypes",["function"==typeof(f=void 0!==R.NcContext&&R.NcContext)?f:Object,String,"function"==typeof(h=void 0!==M.FilterReqType&&M.FilterReqType)?h:Object,"function"==typeof(g=void 0!==R.NcRequest&&R.NcRequest)?g:Object]),T("design:returntype",Promise)],N.prototype,"filterUpdate",null),v([(0,S.Delete)(["/api/v1/db/meta/filters/:filterId","/api/v2/meta/filters/:filterId"]),(0,E.Acl)("filterDelete"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("filterId")),k(2,(0,S.Req)()),T("design:type",Function),T("design:paramtypes",["function"==typeof(y=void 0!==R.NcContext&&R.NcContext)?y:Object,String,"function"==typeof(b=void 0!==R.NcRequest&&R.NcRequest)?b:Object]),T("design:returntype",Promise)],N.prototype,"filterDelete",null),v([(0,S.Get)(["/api/v1/db/meta/hooks/:hookId/filters","/api/v2/meta/hooks/:hookId/filters"]),(0,E.Acl)("hookFilterList"),k(0,(0,L.TenantContext)()),k(1,(0,S.Param)("hookId")),T("design:type",Function),T("design:paramtypes",["function"==typeof(w=void 0!==R.NcContext&&R.NcContext)?w:Object,String]),T("design:returntype",Promise)],N.prototype,"hookFilterList",null),t.FiltersController=N=v([(0,S.Controller)(),(0,S.UseGuards)(x.MetaApiLimiterGuard,O.GlobalGuard),T("design:paramtypes",["function"==typeof(i=void 0!==C.FiltersService&&C.FiltersService)?i:Object])],N)},64228:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormColumnsController=void 0;const u=a(23324),p=a(23668),m=a(69200),_=a(47932),f=a(67240),h=a(26212),g=a(48967);let y=class FormColumnsController{constructor(e){this.formColumnsService=e}async columnUpdate(e,t,a,i){return await this.formColumnsService.columnUpdate(e,{formViewColumnId:t,formViewColumn:a,req:i})}};t.FormColumnsController=y,l([(0,u.Patch)(["/api/v1/db/meta/form-columns/:formViewColumnId","/api/v2/meta/form-columns/:formViewColumnId"]),(0,_.Acl)("formViewUpdate"),d(0,(0,h.TenantContext)()),d(1,(0,u.Param)("formViewColumnId")),d(2,(0,u.Body)()),d(3,(0,u.Req)()),c("design:type",Function),c("design:paramtypes",["function"==typeof(s=void 0!==g.NcContext&&g.NcContext)?s:Object,String,class FormColumnUpdateReqType{},"function"==typeof(r=void 0!==g.NcRequest&&g.NcRequest)?r:Object]),c("design:returntype",Promise)],y.prototype,"columnUpdate",null),t.FormColumnsController=y=l([(0,u.Controller)(),(0,u.UseGuards)(f.MetaApiLimiterGuard,p.GlobalGuard),c("design:paramtypes",["function"==typeof(i=void 0!==m.FormColumnsService&&m.FormColumnsService)?i:Object])],y)},31004:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormsController=void 0;const f=a(23324),h=a(71040),g=a(23668),y=a(76383),b=a(47932),w=a(67240),v=a(26212),T=a(48967);let k=class FormsController{constructor(e){this.formsService=e}async formViewGet(e,t){return await this.formsService.formViewGet(e,{formViewId:t})}async formViewCreate(e,t,a,i){return await this.formsService.formViewCreate(e,{body:a,tableId:t,user:i.user,req:i})}async formViewUpdate(e,t,a,i){return await this.formsService.formViewUpdate(e,{formViewId:t,form:a,req:i})}};t.FormsController=k,p([(0,f.Get)(["/api/v1/db/meta/forms/:formViewId","/api/v2/meta/forms/:formViewId"]),(0,b.Acl)("formViewGet"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("formViewId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(s=void 0!==T.NcContext&&T.NcContext)?s:Object,String]),m("design:returntype",Promise)],k.prototype,"formViewGet",null),p([(0,f.Post)(["/api/v1/db/meta/tables/:tableId/forms","/api/v2/meta/tables/:tableId/forms"]),(0,f.HttpCode)(200),(0,b.Acl)("formViewCreate"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("tableId")),_(2,(0,f.Body)()),_(3,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(r=void 0!==T.NcContext&&T.NcContext)?r:Object,String,"function"==typeof(l=void 0!==h.ViewCreateReqType&&h.ViewCreateReqType)?l:Object,"function"==typeof(c=void 0!==T.NcRequest&&T.NcRequest)?c:Object]),m("design:returntype",Promise)],k.prototype,"formViewCreate",null),p([(0,f.Patch)(["/api/v1/db/meta/forms/:formViewId","/api/v2/meta/forms/:formViewId"]),(0,b.Acl)("formViewUpdate"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("formViewId")),_(2,(0,f.Body)()),_(3,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(d=void 0!==T.NcContext&&T.NcContext)?d:Object,String,Object,"function"==typeof(u=void 0!==T.NcRequest&&T.NcRequest)?u:Object]),m("design:returntype",Promise)],k.prototype,"formViewUpdate",null),t.FormsController=k=p([(0,f.Controller)(),(0,f.UseGuards)(w.MetaApiLimiterGuard,g.GlobalGuard),m("design:paramtypes",["function"==typeof(i=void 0!==y.FormsService&&y.FormsService)?i:Object])],k)},69860:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GalleriesController=void 0;const h=a(23324),g=a(71040),y=a(23668),b=a(48968),w=a(47932),v=a(67240),T=a(26212),k=a(48967);let S=class GalleriesController{constructor(e){this.galleriesService=e}async galleryViewGet(e,t){return await this.galleriesService.galleryViewGet(e,{galleryViewId:t})}async galleryViewCreate(e,t,a,i){return await this.galleriesService.galleryViewCreate(e,{gallery:a,tableId:t,req:i,user:i.user})}async galleryViewUpdate(e,t,a,i){return await this.galleriesService.galleryViewUpdate(e,{galleryViewId:t,gallery:a,req:i})}};t.GalleriesController=S,m([(0,h.Get)(["/api/v1/db/meta/galleries/:galleryViewId","/api/v2/meta/galleries/:galleryViewId"]),(0,w.Acl)("galleryViewGet"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("galleryViewId")),_("design:type",Function),_("design:paramtypes",["function"==typeof(s=void 0!==k.NcContext&&k.NcContext)?s:Object,String]),_("design:returntype",Promise)],S.prototype,"galleryViewGet",null),m([(0,h.Post)(["/api/v1/db/meta/tables/:tableId/galleries","/api/v2/meta/tables/:tableId/galleries"]),(0,h.HttpCode)(200),(0,w.Acl)("galleryViewCreate"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("tableId")),f(2,(0,h.Body)()),f(3,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(r=void 0!==k.NcContext&&k.NcContext)?r:Object,String,"function"==typeof(l=void 0!==g.ViewCreateReqType&&g.ViewCreateReqType)?l:Object,"function"==typeof(c=void 0!==k.NcRequest&&k.NcRequest)?c:Object]),_("design:returntype",Promise)],S.prototype,"galleryViewCreate",null),m([(0,h.Patch)(["/api/v1/db/meta/galleries/:galleryViewId","/api/v2/meta/galleries/:galleryViewId"]),(0,w.Acl)("galleryViewUpdate"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("galleryViewId")),f(2,(0,h.Body)()),f(3,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(d=void 0!==k.NcContext&&k.NcContext)?d:Object,String,"function"==typeof(u=void 0!==g.GalleryUpdateReqType&&g.GalleryUpdateReqType)?u:Object,"function"==typeof(p=void 0!==k.NcRequest&&k.NcRequest)?p:Object]),_("design:returntype",Promise)],S.prototype,"galleryViewUpdate",null),t.GalleriesController=S=m([(0,h.Controller)(),(0,h.UseGuards)(v.MetaApiLimiterGuard,y.GlobalGuard),_("design:paramtypes",["function"==typeof(i=void 0!==b.GalleriesService&&b.GalleriesService)?i:Object])],S)},28972:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GridColumnsController=void 0;const m=a(23324),_=a(71040),f=a(23668),h=a(75564),g=a(47932),y=a(67240),b=a(26212),w=a(48967);let v=class GridColumnsController{constructor(e){this.gridColumnsService=e}async columnList(e,t){return await this.gridColumnsService.columnList(e,{gridViewId:t})}async gridColumnUpdate(e,t,a,i){return this.gridColumnsService.gridColumnUpdate(e,{gridViewColumnId:t,grid:a,req:i})}};t.GridColumnsController=v,d([(0,m.Get)(["/api/v1/db/meta/grids/:gridViewId/grid-columns","/api/v2/meta/grids/:gridViewId/grid-columns"]),(0,g.Acl)("columnList"),p(0,(0,b.TenantContext)()),p(1,(0,m.Param)("gridViewId")),u("design:type",Function),u("design:paramtypes",["function"==typeof(s=void 0!==w.NcContext&&w.NcContext)?s:Object,String]),u("design:returntype",Promise)],v.prototype,"columnList",null),d([(0,m.Patch)(["/api/v1/db/meta/grid-columns/:gridViewColumnId","/api/v2/meta/grid-columns/:gridViewColumnId"]),(0,g.Acl)("gridColumnUpdate"),p(0,(0,b.TenantContext)()),p(1,(0,m.Param)("gridViewColumnId")),p(2,(0,m.Body)()),p(3,(0,m.Req)()),u("design:type",Function),u("design:paramtypes",["function"==typeof(r=void 0!==w.NcContext&&w.NcContext)?r:Object,String,"function"==typeof(l=void 0!==_.GridColumnReqType&&_.GridColumnReqType)?l:Object,"function"==typeof(c=void 0!==w.NcRequest&&w.NcRequest)?c:Object]),u("design:returntype",Promise)],v.prototype,"gridColumnUpdate",null),t.GridColumnsController=v=d([(0,m.Controller)(),(0,m.UseGuards)(y.MetaApiLimiterGuard,f.GlobalGuard),u("design:paramtypes",["function"==typeof(i=void 0!==h.GridColumnsService&&h.GridColumnsService)?i:Object])],v)},76020:function(e,t,a){"use strict";var i,s,r,l,c,d,u=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GridsController=void 0;const _=a(23324),f=a(71040),h=a(23668),g=a(98348),y=a(47932),b=a(67240),w=a(26212),v=a(48967);let T=class GridsController{constructor(e){this.gridsService=e}async gridViewCreate(e,t,a,i){return await this.gridsService.gridViewCreate(e,{grid:a,tableId:t,req:i})}async gridViewUpdate(e,t,a,i){return await this.gridsService.gridViewUpdate(e,{viewId:t,grid:a,req:i})}};t.GridsController=T,u([(0,_.Post)(["/api/v1/db/meta/tables/:tableId/grids/","/api/v2/meta/tables/:tableId/grids/"]),(0,_.HttpCode)(200),(0,y.Acl)("gridViewCreate"),m(0,(0,w.TenantContext)()),m(1,(0,_.Param)("tableId")),m(2,(0,_.Body)()),m(3,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(s=void 0!==v.NcContext&&v.NcContext)?s:Object,String,"function"==typeof(r=void 0!==f.ViewCreateReqType&&f.ViewCreateReqType)?r:Object,"function"==typeof(l=void 0!==v.NcRequest&&v.NcRequest)?l:Object]),p("design:returntype",Promise)],T.prototype,"gridViewCreate",null),u([(0,_.Patch)(["/api/v1/db/meta/grids/:viewId","/api/v2/meta/grids/:viewId"]),(0,y.Acl)("gridViewUpdate"),m(0,(0,w.TenantContext)()),m(1,(0,_.Param)("viewId")),m(2,(0,_.Body)()),m(3,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(c=void 0!==v.NcContext&&v.NcContext)?c:Object,String,Object,"function"==typeof(d=void 0!==v.NcRequest&&v.NcRequest)?d:Object]),p("design:returntype",Promise)],T.prototype,"gridViewUpdate",null),t.GridsController=T=u([(0,_.Controller)(),(0,_.UseGuards)(b.MetaApiLimiterGuard,h.GlobalGuard),p("design:paramtypes",["function"==typeof(i=void 0!==g.GridsService&&g.GridsService)?i:Object])],T)},93052:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},S=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},M=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.HooksController=void 0;const O=a(23324),I=a(71040),C=a(23668),E=a(99572),x=a(5348),L=a(47932),R=a(67240),N=a(26212),A=a(48967);let D=class HooksController{constructor(e){this.hooksService=e}async hookList(e,t){return new E.PagedResponseImpl(await this.hooksService.hookList(e,{tableId:t}))}async hookCreate(e,t,a,i){return await this.hooksService.hookCreate(e,{hook:a,tableId:t,req:i})}async hookDelete(e,t,a){return await this.hooksService.hookDelete(e,{hookId:t,req:a})}async hookUpdate(e,t,a,i){return await this.hooksService.hookUpdate(e,{hookId:t,hook:a,req:i})}async hookTest(e,t,a){try{return await this.hooksService.hookTest(e,{hookTest:Object.assign(Object.assign({},t),{payload:Object.assign(Object.assign({},t.payload),{user:null==a?void 0:a.user})}),tableId:a.params.tableId,req:a}),{msg:"The hook has been tested successfully"}}catch(e){throw console.error(e),e}}async tableSampleData(e,t,a,i){return await this.hooksService.tableSampleData(e,{tableId:t,operation:a,version:i})}async hookLogList(e,t,a){return new E.PagedResponseImpl(await this.hooksService.hookLogList(e,{query:a.query,hookId:t}),Object.assign(Object.assign({},a.query),{count:await this.hooksService.hookLogCount(e,{hookId:t})}))}async hookTrigger(e,t,a,i){return await this.hooksService.hookTrigger(e,{hookId:t,req:i,rowId:a})}};t.HooksController=D,k([(0,O.Get)(["/api/v1/db/meta/tables/:tableId/hooks","/api/v2/meta/tables/:tableId/hooks"]),(0,L.Acl)("hookList"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("tableId")),S("design:type",Function),S("design:paramtypes",["function"==typeof(s=void 0!==A.NcContext&&A.NcContext)?s:Object,String]),S("design:returntype",Promise)],D.prototype,"hookList",null),k([(0,O.Post)(["/api/v1/db/meta/tables/:tableId/hooks","/api/v2/meta/tables/:tableId/hooks"]),(0,O.HttpCode)(200),(0,L.Acl)("hookCreate"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("tableId")),M(2,(0,O.Body)()),M(3,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(r=void 0!==A.NcContext&&A.NcContext)?r:Object,String,"function"==typeof(l=void 0!==I.HookReqType&&I.HookReqType)?l:Object,"function"==typeof(c=void 0!==A.NcRequest&&A.NcRequest)?c:Object]),S("design:returntype",Promise)],D.prototype,"hookCreate",null),k([(0,O.Delete)(["/api/v1/db/meta/hooks/:hookId","/api/v2/meta/hooks/:hookId"]),(0,L.Acl)("hookDelete"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("hookId")),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(d=void 0!==A.NcContext&&A.NcContext)?d:Object,String,"function"==typeof(u=void 0!==A.NcRequest&&A.NcRequest)?u:Object]),S("design:returntype",Promise)],D.prototype,"hookDelete",null),k([(0,O.Patch)(["/api/v1/db/meta/hooks/:hookId","/api/v2/meta/hooks/:hookId"]),(0,L.Acl)("hookUpdate"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("hookId")),M(2,(0,O.Body)()),M(3,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(p=void 0!==A.NcContext&&A.NcContext)?p:Object,String,"function"==typeof(m=void 0!==I.HookReqType&&I.HookReqType)?m:Object,"function"==typeof(_=void 0!==A.NcRequest&&A.NcRequest)?_:Object]),S("design:returntype",Promise)],D.prototype,"hookUpdate",null),k([(0,O.Post)(["/api/v1/db/meta/tables/:tableId/hooks/test","/api/v2/meta/tables/:tableId/hooks/test"]),(0,O.HttpCode)(200),(0,L.Acl)("hookTest"),M(0,(0,N.TenantContext)()),M(1,(0,O.Body)()),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(f=void 0!==A.NcContext&&A.NcContext)?f:Object,"function"==typeof(h=void 0!==I.HookTestReqType&&I.HookTestReqType)?h:Object,"function"==typeof(g=void 0!==A.NcRequest&&A.NcRequest)?g:Object]),S("design:returntype",Promise)],D.prototype,"hookTest",null),k([(0,O.Get)(["/api/v1/db/meta/tables/:tableId/hooks/samplePayload/:operation/:version","/api/v2/meta/tables/:tableId/hooks/samplePayload/:operation/:version"]),(0,L.Acl)("tableSampleData"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("tableId")),M(2,(0,O.Param)("operation")),M(3,(0,O.Param)("version")),S("design:type",Function),S("design:paramtypes",["function"==typeof(y=void 0!==A.NcContext&&A.NcContext)?y:Object,String,Object,Object]),S("design:returntype",Promise)],D.prototype,"tableSampleData",null),k([(0,O.Get)(["/api/v1/db/meta/hooks/:hookId/logs","/api/v2/meta/hooks/:hookId/logs"]),(0,L.Acl)("hookLogList"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("hookId")),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(b=void 0!==A.NcContext&&A.NcContext)?b:Object,String,"function"==typeof(w=void 0!==A.NcRequest&&A.NcRequest)?w:Object]),S("design:returntype",Promise)],D.prototype,"hookLogList",null),k([(0,O.Post)(["/api/v2/meta/hooks/:hookId/trigger/:rowId"]),(0,L.Acl)("hookTrigger"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("hookId")),M(2,(0,O.Param)("rowId")),M(3,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(v=void 0!==A.NcContext&&A.NcContext)?v:Object,String,String,"function"==typeof(T=void 0!==A.NcRequest&&A.NcRequest)?T:Object]),S("design:returntype",Promise)],D.prototype,"hookTrigger",null),t.HooksController=D=k([(0,O.Controller)(),(0,O.UseGuards)(R.MetaApiLimiterGuard,C.GlobalGuard),S("design:paramtypes",["function"==typeof(i=void 0!==x.HooksService&&x.HooksService)?i:Object])],D)},34936:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},w=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.IntegrationsController=void 0;const v=a(23324),T=a(71040),k=a(23668),S=a(47932),M=a(47132),O=a(67240),I=a(26212),C=a(48967);let E=class IntegrationsController{constructor(e){this.integrationsService=e}async integrationGet(e,t,a,i,s){const r=await this.integrationsService.integrationGetWithConfig(e,{integrationId:t,includeSources:"true"===i});return("true"!==a||r.is_private&&s.user.id!==r.created_by)&&(r.config=void 0),r}async integrationCreate(e,t,a){return await this.integrationsService.integrationCreate(e,{integration:t,req:a})}async integrationDelete(e,t,a,i){return await this.integrationsService.integrationDelete(e,{req:a,integrationId:t,force:"true"===i})}async integrationUpdate(e,t,a,i){return await this.integrationsService.integrationUpdate(e,{integration:a,integrationId:t,req:i})}async integrationList(e,t,a,i,s,r){const l=await this.integrationsService.integrationList({req:e,includeDatabaseInfo:"true"===a,type:t,limit:i&&(+i||25),offset:s&&(+s||0),query:r});if(!a)for(const e of l.list)e.config=void 0;return l}};t.IntegrationsController=E,y([(0,v.Get)(["/api/v2/meta/integrations/:integrationId"]),(0,S.Acl)("integrationGet",{scope:"org"}),w(0,(0,I.TenantContext)()),w(1,(0,v.Param)("integrationId")),w(2,(0,v.Query)("includeConfig")),w(3,(0,v.Query)("includeSources")),w(4,(0,v.Req)()),b("design:type",Function),b("design:paramtypes",["function"==typeof(s=void 0!==C.NcContext&&C.NcContext)?s:Object,String,String,String,"function"==typeof(r=void 0!==C.NcRequest&&C.NcRequest)?r:Object]),b("design:returntype",Promise)],E.prototype,"integrationGet",null),y([(0,v.Post)(["/api/v2/meta/integrations"]),(0,S.Acl)("integrationCreate",{scope:"org"}),w(0,(0,I.TenantContext)()),w(1,(0,v.Body)()),w(2,(0,v.Req)()),b("design:type",Function),b("design:paramtypes",["function"==typeof(l=void 0!==C.NcContext&&C.NcContext)?l:Object,"function"==typeof(c=void 0!==T.IntegrationReqType&&T.IntegrationReqType)?c:Object,"function"==typeof(d=void 0!==C.NcRequest&&C.NcRequest)?d:Object]),b("design:returntype",Promise)],E.prototype,"integrationCreate",null),y([(0,v.Delete)(["/api/v2/meta/integrations/:integrationId"]),(0,S.Acl)("integrationDelete",{scope:"org"}),w(0,(0,I.TenantContext)()),w(1,(0,v.Param)("integrationId")),w(2,(0,v.Req)()),w(3,(0,v.Query)("force")),b("design:type",Function),b("design:paramtypes",["function"==typeof(u=void 0!==C.NcContext&&C.NcContext)?u:Object,String,"function"==typeof(p=void 0!==C.NcRequest&&C.NcRequest)?p:Object,String]),b("design:returntype",Promise)],E.prototype,"integrationDelete",null),y([(0,v.Patch)(["/api/v2/meta/integrations/:integrationId"]),(0,S.Acl)("integrationUpdate",{scope:"org"}),w(0,(0,I.TenantContext)()),w(1,(0,v.Param)("integrationId")),w(2,(0,v.Body)()),w(3,(0,v.Req)()),b("design:type",Function),b("design:paramtypes",["function"==typeof(m=void 0!==C.NcContext&&C.NcContext)?m:Object,String,"function"==typeof(_=void 0!==T.IntegrationReqType&&T.IntegrationReqType)?_:Object,"function"==typeof(f=void 0!==C.NcRequest&&C.NcRequest)?f:Object]),b("design:returntype",Promise)],E.prototype,"integrationUpdate",null),y([(0,v.Get)(["/api/v2/meta/integrations"]),(0,S.Acl)("integrationList",{scope:"org",extendedScope:"base"}),w(0,(0,v.Req)()),w(1,(0,v.Query)("type")),w(2,(0,v.Query)("includeDatabaseInfo")),w(3,(0,v.Query)("limit")),w(4,(0,v.Query)("offset")),w(5,(0,v.Query)("query")),b("design:type",Function),b("design:paramtypes",["function"==typeof(h=void 0!==C.NcRequest&&C.NcRequest)?h:Object,"function"==typeof(g=void 0!==T.IntegrationsType&&T.IntegrationsType)?g:Object,String,String,String,String]),b("design:returntype",Promise)],E.prototype,"integrationList",null),t.IntegrationsController=E=y([(0,v.Controller)(),(0,v.UseGuards)(O.MetaApiLimiterGuard,k.GlobalGuard),b("design:paramtypes",["function"==typeof(i=void 0!==M.IntegrationsService&&M.IntegrationsService)?i:Object])],E)},40824:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsMetaController=void 0;const u=a(23324),p=a(23668),m=a(47932),_=a(67240),f=a(26212),h=a(48967),g=a(35300);let y=class JobsMetaController{constructor(e){this.jobsMetaService=e}async jobList(e,t,a){return await this.jobsMetaService.list(e,a,t)}};t.JobsMetaController=y,l([(0,u.Post)(["/api/v2/jobs/:baseId"]),(0,m.Acl)("jobList"),d(0,(0,f.TenantContext)()),d(1,(0,u.Req)()),d(2,(0,u.Body)()),c("design:type",Function),c("design:paramtypes",["function"==typeof(s=void 0!==h.NcContext&&h.NcContext)?s:Object,"function"==typeof(r=void 0!==h.NcRequest&&h.NcRequest)?r:Object,Object]),c("design:returntype",Promise)],y.prototype,"jobList",null),t.JobsMetaController=y=l([(0,u.Controller)(),(0,u.UseGuards)(_.MetaApiLimiterGuard,p.GlobalGuard),c("design:paramtypes",["function"==typeof(i=void 0!==g.JobsMetaService&&g.JobsMetaService)?i:Object])],y)},78804:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.KanbansController=void 0;const f=a(23324),h=a(71040),g=a(23668),y=a(86935),b=a(47932),w=a(67240),v=a(26212),T=a(48967);let k=class KanbansController{constructor(e){this.kanbansService=e}async kanbanViewGet(e,t){return await this.kanbansService.kanbanViewGet(e,{kanbanViewId:t})}async kanbanViewCreate(e,t,a,i){return await this.kanbansService.kanbanViewCreate(e,{tableId:t,kanban:a,user:i.user,req:i})}async kanbanViewUpdate(e,t,a,i){return await this.kanbansService.kanbanViewUpdate(e,{kanbanViewId:t,kanban:a,req:i})}};t.KanbansController=k,p([(0,f.Get)(["/api/v1/db/meta/kanbans/:kanbanViewId","/api/v2/meta/kanbans/:kanbanViewId"]),(0,b.Acl)("kanbanViewGet"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("kanbanViewId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(s=void 0!==T.NcContext&&T.NcContext)?s:Object,String]),m("design:returntype",Promise)],k.prototype,"kanbanViewGet",null),p([(0,f.Post)(["/api/v1/db/meta/tables/:tableId/kanbans","/api/v2/meta/tables/:tableId/kanbans"]),(0,f.HttpCode)(200),(0,b.Acl)("kanbanViewCreate"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("tableId")),_(2,(0,f.Body)()),_(3,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(r=void 0!==T.NcContext&&T.NcContext)?r:Object,String,"function"==typeof(l=void 0!==h.ViewCreateReqType&&h.ViewCreateReqType)?l:Object,"function"==typeof(c=void 0!==T.NcRequest&&T.NcRequest)?c:Object]),m("design:returntype",Promise)],k.prototype,"kanbanViewCreate",null),p([(0,f.Patch)(["/api/v1/db/meta/kanbans/:kanbanViewId","/api/v2/meta/kanbans/:kanbanViewId"]),(0,b.Acl)("kanbanViewUpdate"),_(0,(0,v.TenantContext)()),_(1,(0,f.Param)("kanbanViewId")),_(2,(0,f.Body)()),_(3,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(d=void 0!==T.NcContext&&T.NcContext)?d:Object,String,Object,"function"==typeof(u=void 0!==T.NcRequest&&T.NcRequest)?u:Object]),m("design:returntype",Promise)],k.prototype,"kanbanViewUpdate",null),t.KanbansController=k=p([(0,f.Controller)(),(0,f.UseGuards)(w.MetaApiLimiterGuard,g.GlobalGuard),m("design:paramtypes",["function"==typeof(i=void 0!==y.KanbansService&&y.KanbansService)?i:Object])],k)},6660:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MapsController=void 0;const h=a(23324),g=a(71040),y=a(23668),b=a(54256),w=a(47932),v=a(67240),T=a(26212),k=a(48967);let S=class MapsController{constructor(e){this.mapsService=e}async mapViewGet(e,t){return await this.mapsService.mapViewGet(e,{mapViewId:t})}async mapViewCreate(e,t,a,i){return await this.mapsService.mapViewCreate(e,{tableId:t,map:a,user:i.user,req:i})}async mapViewUpdate(e,t,a,i){return await this.mapsService.mapViewUpdate(e,{mapViewId:t,map:a,req:i})}};t.MapsController=S,m([(0,h.Get)(["/api/v1/db/meta/maps/:mapViewId","/api/v2/meta/maps/:mapViewId"]),(0,w.Acl)("mapViewGet"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("mapViewId")),_("design:type",Function),_("design:paramtypes",["function"==typeof(s=void 0!==k.NcContext&&k.NcContext)?s:Object,String]),_("design:returntype",Promise)],S.prototype,"mapViewGet",null),m([(0,h.Post)(["/api/v1/db/meta/tables/:tableId/maps","/api/v2/meta/tables/:tableId/maps"]),(0,h.HttpCode)(200),(0,w.Acl)("mapViewCreate"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("tableId")),f(2,(0,h.Body)()),f(3,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(r=void 0!==k.NcContext&&k.NcContext)?r:Object,String,"function"==typeof(l=void 0!==g.ViewCreateReqType&&g.ViewCreateReqType)?l:Object,"function"==typeof(c=void 0!==k.NcRequest&&k.NcRequest)?c:Object]),_("design:returntype",Promise)],S.prototype,"mapViewCreate",null),m([(0,h.Patch)(["/api/v1/db/meta/maps/:mapViewId","/api/v2/meta/maps/:mapViewId"]),(0,w.Acl)("mapViewUpdate"),f(0,(0,T.TenantContext)()),f(1,(0,h.Param)("mapViewId")),f(2,(0,h.Body)()),f(3,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(d=void 0!==k.NcContext&&k.NcContext)?d:Object,String,"function"==typeof(u=void 0!==g.MapUpdateReqType&&g.MapUpdateReqType)?u:Object,"function"==typeof(p=void 0!==k.NcRequest&&k.NcRequest)?p:Object]),_("design:returntype",Promise)],S.prototype,"mapViewUpdate",null),t.MapsController=S=m([(0,h.Controller)(),(0,h.UseGuards)(v.MetaApiLimiterGuard,y.GlobalGuard),_("design:paramtypes",["function"==typeof(i=void 0!==b.MapsService&&b.MapsService)?i:Object])],S)},56356:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaDiffsController=void 0;const u=a(23324),p=a(23668),m=a(69484),_=a(47932),f=a(67240),h=a(26212),g=a(48967);let y=class MetaDiffsController{constructor(e){this.metaDiffsService=e}async metaDiff(e,t){return await this.metaDiffsService.metaDiff(e,{baseId:t})}async baseMetaDiff(e,t,a){return await this.metaDiffsService.baseMetaDiff(e,{sourceId:a,baseId:t})}};t.MetaDiffsController=y,l([(0,u.Get)(["/api/v1/db/meta/projects/:baseId/meta-diff","/api/v2/meta/bases/:baseId/meta-diff"]),(0,_.Acl)("metaDiff"),d(0,(0,h.TenantContext)()),d(1,(0,u.Param)("baseId")),c("design:type",Function),c("design:paramtypes",["function"==typeof(s=void 0!==g.NcContext&&g.NcContext)?s:Object,String]),c("design:returntype",Promise)],y.prototype,"metaDiff",null),l([(0,u.Get)(["/api/v1/db/meta/projects/:baseId/meta-diff/:sourceId","/api/v2/meta/bases/:baseId/meta-diff/:sourceId"]),(0,_.Acl)("metaDiff"),d(0,(0,h.TenantContext)()),d(1,(0,u.Param)("baseId")),d(2,(0,u.Param)("sourceId")),c("design:type",Function),c("design:paramtypes",["function"==typeof(r=void 0!==g.NcContext&&g.NcContext)?r:Object,String,String]),c("design:returntype",Promise)],y.prototype,"baseMetaDiff",null),t.MetaDiffsController=y=l([(0,u.Controller)(),(0,u.UseGuards)(f.MetaApiLimiterGuard,p.GlobalGuard),c("design:paramtypes",["function"==typeof(i=void 0!==m.MetaDiffsService&&m.MetaDiffsService)?i:Object])],y)},36536:function(e,t,a){"use strict";var i,s,r,l,c=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelVisibilitiesController=void 0;const p=a(23324),m=a(23668),_=a(80348),f=a(47932),h=a(67240),g=a(26212),y=a(48967);let b=class ModelVisibilitiesController{constructor(e){this.modelVisibilitiesService=e}async xcVisibilityMetaSetAll(e,t,a,i){return await this.modelVisibilitiesService.xcVisibilityMetaSetAll(e,{visibilityRule:a,baseId:t,req:i}),{msg:"UI ACL has been created successfully"}}async modelVisibilityList(e,t,a){return await this.modelVisibilitiesService.xcVisibilityMetaGet(e,{baseId:t,includeM2M:!0===a||"true"===a})}};t.ModelVisibilitiesController=b,c([(0,p.Post)(["/api/v1/db/meta/projects/:baseId/visibility-rules","/api/v2/meta/bases/:baseId/visibility-rules"]),(0,p.HttpCode)(200),(0,f.Acl)("modelVisibilitySet"),u(0,(0,g.TenantContext)()),u(1,(0,p.Param)("baseId")),u(2,(0,p.Body)()),u(3,(0,p.Req)()),d("design:type",Function),d("design:paramtypes",["function"==typeof(s=void 0!==y.NcContext&&y.NcContext)?s:Object,String,Object,"function"==typeof(r=void 0!==y.NcRequest&&y.NcRequest)?r:Object]),d("design:returntype",Promise)],b.prototype,"xcVisibilityMetaSetAll",null),c([(0,p.Get)(["/api/v1/db/meta/projects/:baseId/visibility-rules","/api/v2/meta/bases/:baseId/visibility-rules"]),(0,f.Acl)("modelVisibilityList"),u(0,(0,g.TenantContext)()),u(1,(0,p.Param)("baseId")),u(2,(0,p.Query)("includeM2M")),d("design:type",Function),d("design:paramtypes",["function"==typeof(l=void 0!==y.NcContext&&y.NcContext)?l:Object,String,Object]),d("design:returntype",Promise)],b.prototype,"modelVisibilityList",null),t.ModelVisibilitiesController=b=c([(0,p.Controller)(),(0,p.UseGuards)(h.MetaApiLimiterGuard,m.GlobalGuard),d("design:paramtypes",["function"==typeof(i=void 0!==_.ModelVisibilitiesService&&_.ModelVisibilitiesService)?i:Object])],b)},54268:function(e,t,a){"use strict";var i,s,r,l,c,d,u=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsController=void 0;const _=a(23324),f=a(92080),h=a(50264),g=a(23668),y=a(70220),b=a(67240),w=a(48967),v=a(88228),T=a(47932),k=(0,f.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);let S=class NotificationsController{constructor(e){this.notificationsService=e}async notificationPoll(e,t){t.setHeader("Cache-Control","no-cache, must-revalidate"),t.resId=k(),this.notificationsService.addConnection(e.user.id,t);let a=null;v.PubSubRedis.available&&(a=await v.PubSubRedis.subscribe(`notification:${e.user.id}`,(async t=>{this.notificationsService.sendToConnections(e.user.id,t)}))),t.on("close",(async()=>{await this.notificationsService.removeConnection(e.user.id,t,a)})),setTimeout((()=>{t.headersSent||t.send({status:"refresh"})}),3e4)}async notificationList(e){return this.notificationsService.notificationList(Object.assign(Object.assign({user:e.user,is_deleted:!1},e.query),{is_read:"true"===e.query.is_read}))}async notificationUpdate(e,t,a){return this.notificationsService.notificationUpdate({notificationId:e,body:(0,y.extractProps)(t,["is_read"]),user:a.user})}async notificationDelete(e,t){return this.notificationsService.notificationDelete({notificationId:e,user:t.user})}async markAllRead(e){return this.notificationsService.markAllRead({user:e.user})}};t.NotificationsController=S,u([(0,_.Get)("/api/v1/notifications/poll"),(0,T.Acl)("notification",{scope:"org"}),m(0,(0,_.Req)()),m(1,(0,_.Res)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(s=void 0!==w.NcRequest&&w.NcRequest)?s:Object,Object]),p("design:returntype",Promise)],S.prototype,"notificationPoll",null),u([(0,_.Get)("/api/v1/notifications"),(0,T.Acl)("notification",{scope:"org"}),m(0,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(r=void 0!==w.NcRequest&&w.NcRequest)?r:Object]),p("design:returntype",Promise)],S.prototype,"notificationList",null),u([(0,_.Patch)("/api/v1/notifications/:notificationId"),(0,T.Acl)("notification",{scope:"org"}),m(0,(0,_.Param)("notificationId")),m(1,(0,_.Body)()),m(2,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",[Object,Object,"function"==typeof(l=void 0!==w.NcRequest&&w.NcRequest)?l:Object]),p("design:returntype",Promise)],S.prototype,"notificationUpdate",null),u([(0,_.Delete)("/api/v1/notifications/:notificationId"),(0,T.Acl)("notification",{scope:"org"}),m(0,(0,_.Param)("notificationId")),m(1,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",[Object,"function"==typeof(c=void 0!==w.NcRequest&&w.NcRequest)?c:Object]),p("design:returntype",Promise)],S.prototype,"notificationDelete",null),u([(0,_.Post)("/api/v1/notifications/mark-all-read"),(0,T.Acl)("notification",{scope:"org"}),(0,_.HttpCode)(200),m(0,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(d=void 0!==w.NcRequest&&w.NcRequest)?d:Object]),p("design:returntype",Promise)],S.prototype,"markAllRead",null),t.NotificationsController=S=u([(0,_.Controller)(),(0,_.UseGuards)(b.MetaApiLimiterGuard,g.GlobalGuard),p("design:paramtypes",["function"==typeof(i=void 0!==h.NotificationsService&&h.NotificationsService)?i:Object])],S)},50960:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OldDatasController=void 0;const f=a(23324),h=a(6012),g=a(23668),y=a(47932),b=a(34608),w=a(26212),v=a(48967);let T=class OldDatasController{constructor(e){this.oldDatasService=e}async dataList(e,t,a,i,s){a.json(await this.oldDatasService.dataList(e,{query:t.query,baseId:i,tableName:s}))}async dataCount(e,t,a,i,s){a.json(await this.oldDatasService.dataCount(e,{query:t.query,baseId:i,tableName:s}))}async dataInsert(e,t,a,i,s,r){a.json(await this.oldDatasService.dataInsert(e,{baseId:i,tableName:s,body:r,cookie:t}))}async dataRead(e,t,a,i,s,r){a.json(await this.oldDatasService.dataRead(e,{baseId:i,tableName:s,rowId:r,query:t.query}))}async dataUpdate(e,t,a,i,s,r){a.json(await this.oldDatasService.dataUpdate(e,{baseId:i,tableName:s,body:t.body,cookie:t,rowId:r}))}async dataDelete(e,t,a,i,s,r){a.json(await this.oldDatasService.dataDelete(e,{baseId:i,tableName:s,cookie:t,rowId:r}))}};t.OldDatasController=T,p([(0,f.Get)("/nc/:baseId/api/v1/:tableName"),(0,y.Acl)("dataList"),_(0,(0,w.TenantContext)()),_(1,(0,f.Request)()),_(2,(0,f.Response)()),_(3,(0,f.Param)("baseId")),_(4,(0,f.Param)("tableName")),m("design:type",Function),m("design:paramtypes",["function"==typeof(s=void 0!==v.NcContext&&v.NcContext)?s:Object,Object,Object,String,String]),m("design:returntype",Promise)],T.prototype,"dataList",null),p([(0,f.Get)("/nc/:baseId/api/v1/:tableName/count"),(0,y.Acl)("dataCount"),_(0,(0,w.TenantContext)()),_(1,(0,f.Request)()),_(2,(0,f.Response)()),_(3,(0,f.Param)("baseId")),_(4,(0,f.Param)("tableName")),m("design:type",Function),m("design:paramtypes",["function"==typeof(r=void 0!==v.NcContext&&v.NcContext)?r:Object,Object,Object,String,String]),m("design:returntype",Promise)],T.prototype,"dataCount",null),p([(0,f.Post)("/nc/:baseId/api/v1/:tableName"),(0,f.HttpCode)(200),(0,y.Acl)("dataInsert"),_(0,(0,w.TenantContext)()),_(1,(0,f.Request)()),_(2,(0,f.Response)()),_(3,(0,f.Param)("baseId")),_(4,(0,f.Param)("tableName")),_(5,(0,f.Body)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(l=void 0!==v.NcContext&&v.NcContext)?l:Object,Object,Object,String,String,Object]),m("design:returntype",Promise)],T.prototype,"dataInsert",null),p([(0,f.Get)("/nc/:baseId/api/v1/:tableName/:rowId"),(0,y.Acl)("dataRead"),_(0,(0,w.TenantContext)()),_(1,(0,f.Request)()),_(2,(0,f.Response)()),_(3,(0,f.Param)("baseId")),_(4,(0,f.Param)("tableName")),_(5,(0,f.Param)("rowId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(c=void 0!==v.NcContext&&v.NcContext)?c:Object,Object,Object,String,String,String]),m("design:returntype",Promise)],T.prototype,"dataRead",null),p([(0,f.Patch)("/nc/:baseId/api/v1/:tableName/:rowId"),(0,y.Acl)("dataUpdate"),_(0,(0,w.TenantContext)()),_(1,(0,f.Request)()),_(2,(0,f.Response)()),_(3,(0,f.Param)("baseId")),_(4,(0,f.Param)("tableName")),_(5,(0,f.Param)("rowId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(d=void 0!==v.NcContext&&v.NcContext)?d:Object,Object,Object,String,String,String]),m("design:returntype",Promise)],T.prototype,"dataUpdate",null),p([(0,f.Delete)("/nc/:baseId/api/v1/:tableName/:rowId"),(0,y.Acl)("dataDelete"),_(0,(0,w.TenantContext)()),_(1,(0,f.Request)()),_(2,(0,f.Response)()),_(3,(0,f.Param)("baseId")),_(4,(0,f.Param)("tableName")),_(5,(0,f.Param)("rowId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(u=void 0!==v.NcContext&&v.NcContext)?u:Object,Object,Object,String,String,String]),m("design:returntype",Promise)],T.prototype,"dataDelete",null),t.OldDatasController=T=p([(0,f.Controller)(),(0,f.UseGuards)(b.DataApiLimiterGuard,g.GlobalGuard),m("design:paramtypes",["function"==typeof(i=void 0!==h.OldDatasService&&h.OldDatasService)?i:Object])],T)},6012:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OldDatasService=void 0;const r=a(23324),l=a(62304),c=s(a(4456)),d=a(43820),u=a(19684),p=s(a(82096));let m=class OldDatasService{async dataList(e,t){const{model:a,view:i}=await this.getViewAndModelFromRequest(e,t),s=await u.Source.get(e,a.source_id),r=await u.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await p.default.get(s)}),{ast:d}=await(0,c.default)(e,{query:t.query,model:a,view:i}),m=Object.assign({},t.query);try{m.filterArr=JSON.parse(m.filterArrJson)}catch(e){}try{m.sortArr=JSON.parse(m.sortArrJson)}catch(e){}return await(0,l.nocoExecute)(d,await r.list(m),{},m)}async dataCount(e,t){const{model:a,view:i}=await this.getViewAndModelFromRequest(e,t),s=await u.Source.get(e,a.source_id),r=await u.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await p.default.get(s)}),l=Object.assign({},t.query);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}return await r.count(l)}async dataInsert(e,t){const{model:a,view:i}=await this.getViewAndModelFromRequest(e,t),s=await u.Source.get(e,a.source_id),r=await u.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await p.default.get(s)});return await r.insert(t.body,null,t.cookie)}async dataRead(e,t){const{model:a,view:i}=await this.getViewAndModelFromRequest(e,t),s=await u.Source.get(e,a.source_id),r=await u.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await p.default.get(s)}),{ast:d}=await(0,c.default)(e,{query:t.query,model:a,view:i});return await(0,l.nocoExecute)(d,await r.readByPk(t.rowId),{},{})}async dataUpdate(e,t){const{model:a,view:i}=await this.getViewAndModelFromRequest(e,t),s=await u.Source.get(e,a.source_id),r=await u.Model.getBaseModelSQL(e,{id:a.id,viewId:i.id,dbDriver:await p.default.get(s)});return await r.updateByPk(t.rowId,t.body,null,t.cookie)}async dataDelete(e,t){const{model:a,view:i}=await this.getViewAndModelFromRequest(e,t),s=await u.Source.get(e,a.source_id),r=await u.Model.getBaseModelSQL(e,{id:a.id,viewId:i.id,dbDriver:await p.default.get(s)});return await r.delByPk(t.rowId,null,t.cookie)}async getViewAndModelFromRequest(e,t){const a=await u.Base.getWithInfo(e,t.params.baseId),i=await u.Model.getByAliasOrId(e,{base_id:a.id,aliasOrId:t.params.tableName}),s=t.params.viewName&&await u.View.getByTitleOrId(e,{titleOrId:t.params.viewName,fk_model_id:i.id});return i||d.NcError.tableNotFound(t.params.tableName),{model:i,view:s}}};t.OldDatasService=m,t.OldDatasService=m=i([(0,r.Injectable)()],m)},37832:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgLcenseController=void 0;const c=a(23324),d=a(71040),u=a(23668),p=a(83816),m=a(47932),_=a(67240);let f=class OrgLcenseController{constructor(e){this.orgLcenseService=e}async licenseGet(){return await this.orgLcenseService.licenseGet()}async licenseSet(e){return await this.orgLcenseService.licenseSet({key:e.key}),{msg:"The license key has been saved"}}};t.OrgLcenseController=f,s([(0,c.Get)("/api/v1/license"),(0,m.Acl)("licenseGet",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],f.prototype,"licenseGet",null),s([(0,c.Post)("/api/v1/license"),(0,c.HttpCode)(200),(0,m.Acl)("licenseSet",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],f.prototype,"licenseSet",null),t.OrgLcenseController=f=s([(0,c.Controller)(),(0,c.UseGuards)(_.MetaApiLimiterGuard,u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==p.OrgLcenseService&&p.OrgLcenseService)?i:Object])],f)},20640:function(e,t,a){"use strict";var i,s,r,l,c,d,u=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgTokensController=void 0;const _=a(23324),f=a(71040),h=a(70816),g=a(43591),y=a(20780),b=a(70935),w=a(47932),v=a(67240),T=a(48967);let k=class OrgTokensController{constructor(e,t){this.orgTokensService=e,this.orgTokensEeService=t}async apiTokenList(e){return await(0,g.getConditionalHandler)(this.orgTokensService.apiTokenList,this.orgTokensEeService.apiTokenListEE)({query:e.query,user:e.user})}async apiTokenCreate(e,t){return await this.orgTokensService.apiTokenCreate({apiToken:t,user:e.user,req:e})}async apiTokenDelete(e,t){await this.orgTokensService.apiTokenDelete({tokenId:t,user:e.user,req:e})}};t.OrgTokensController=k,u([(0,_.Get)("/api/v1/tokens"),(0,w.Acl)("apiTokenList",{scope:"org",blockApiTokenAccess:!0}),m(0,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(r=void 0!==T.NcRequest&&T.NcRequest)?r:Object]),p("design:returntype",Promise)],k.prototype,"apiTokenList",null),u([(0,_.Post)("/api/v1/tokens"),(0,_.HttpCode)(200),(0,w.Acl)("apiTokenCreate",{scope:"org",blockApiTokenAccess:!0}),m(0,(0,_.Req)()),m(1,(0,_.Body)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(l=void 0!==T.NcRequest&&T.NcRequest)?l:Object,"function"==typeof(c=void 0!==f.ApiTokenReqType&&f.ApiTokenReqType)?c:Object]),p("design:returntype",Promise)],k.prototype,"apiTokenCreate",null),u([(0,_.Delete)("/api/v1/tokens/:tokenId"),(0,w.Acl)("apiTokenDelete",{scope:"org",blockApiTokenAccess:!0}),m(0,(0,_.Req)()),m(1,(0,_.Param)("tokenId")),p("design:type",Function),p("design:paramtypes",["function"==typeof(d=void 0!==T.NcRequest&&T.NcRequest)?d:Object,String]),p("design:returntype",Promise)],k.prototype,"apiTokenDelete",null),t.OrgTokensController=k=u([(0,_.UseGuards)(v.MetaApiLimiterGuard,(0,h.AuthGuard)("jwt")),(0,_.Controller)(),p("design:paramtypes",["function"==typeof(i=void 0!==b.OrgTokensService&&b.OrgTokensService)?i:Object,"function"==typeof(s=void 0!==y.OrgTokensEeService&&y.OrgTokensEeService)?s:Object])],k)},64364:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgUsersController=void 0;const f=a(23324),h=a(71040),g=a(23668),y=a(99572),b=a(81328),w=a(19684),v=a(47932),T=a(67240),k=a(48967);let S=class OrgUsersController{constructor(e){this.orgUsersService=e}async userList(e){return new y.PagedResponseImpl(await this.orgUsersService.userList({query:e.query}),Object.assign(Object.assign({},e.query),{count:await w.User.count(e.query)}))}async userUpdate(e,t){return await this.orgUsersService.userUpdate({user:e,userId:t})}async userDelete(e){return await this.orgUsersService.userDelete({userId:e}),{msg:"The user has been deleted successfully"}}async userAdd(e,t){return await this.orgUsersService.userAdd({user:t.body,req:t})}async userSettings(e){return await this.orgUsersService.userSettings(e),{}}async userInviteResend(e,t){return await this.orgUsersService.userInviteResend({userId:t,req:e}),{msg:"The invitation has been sent to the user"}}async generateResetUrl(e,t){return await this.orgUsersService.generateResetUrl({siteUrl:e.ncSiteUrl,userId:t})}async appSettingsGet(){return await this.orgUsersService.appSettingsGet()}async appSettingsSet(e){return await this.orgUsersService.appSettingsSet({settings:e}),{msg:"The app settings have been saved"}}};t.OrgUsersController=S,p([(0,f.Get)("/api/v1/users"),(0,v.Acl)("userList",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(s=void 0!==k.NcRequest&&k.NcRequest)?s:Object]),m("design:returntype",Promise)],S.prototype,"userList",null),p([(0,f.Patch)("/api/v1/users/:userId"),(0,v.Acl)("userUpdate",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Body)()),_(1,(0,f.Param)("userId")),m("design:type",Function),m("design:paramtypes",[Object,String]),m("design:returntype",Promise)],S.prototype,"userUpdate",null),p([(0,f.Delete)("/api/v1/users/:userId"),(0,v.Acl)("userDelete",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Param)("userId")),m("design:type",Function),m("design:paramtypes",[String]),m("design:returntype",Promise)],S.prototype,"userDelete",null),p([(0,f.Post)("/api/v1/users"),(0,f.HttpCode)(200),(0,v.Acl)("userAdd",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Body)()),_(1,(0,f.Req)()),m("design:type",Function),m("design:paramtypes",[Object,"function"==typeof(r=void 0!==k.NcRequest&&k.NcRequest)?r:Object]),m("design:returntype",Promise)],S.prototype,"userAdd",null),p([(0,f.Post)("/api/v1/users/settings"),(0,f.HttpCode)(200),(0,v.Acl)("userSettings",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Body)()),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype","function"==typeof(l="undefined"!=typeof Promise&&Promise)?l:Object)],S.prototype,"userSettings",null),p([(0,f.Post)("/api/v1/users/:userId/resend-invite"),(0,f.HttpCode)(200),(0,v.Acl)("userInviteResend",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Req)()),_(1,(0,f.Param)("userId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(c=void 0!==k.NcRequest&&k.NcRequest)?c:Object,String]),m("design:returntype","function"==typeof(d="undefined"!=typeof Promise&&Promise)?d:Object)],S.prototype,"userInviteResend",null),p([(0,f.Post)("/api/v1/users/:userId/generate-reset-url"),(0,f.HttpCode)(200),(0,v.Acl)("generateResetUrl",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Req)()),_(1,(0,f.Param)("userId")),m("design:type",Function),m("design:paramtypes",["function"==typeof(u=void 0!==k.NcRequest&&k.NcRequest)?u:Object,String]),m("design:returntype",Promise)],S.prototype,"generateResetUrl",null),p([(0,f.Get)("/api/v1/app-settings"),(0,v.Acl)("appSettingsGet",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),m("design:type",Function),m("design:paramtypes",[]),m("design:returntype",Promise)],S.prototype,"appSettingsGet",null),p([(0,f.Post)("/api/v1/app-settings"),(0,f.HttpCode)(200),(0,v.Acl)("appSettingsSet",{scope:"org",allowedRoles:[h.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),_(0,(0,f.Body)()),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Promise)],S.prototype,"appSettingsSet",null),t.OrgUsersController=S=p([(0,f.Controller)(),(0,f.UseGuards)(T.MetaApiLimiterGuard,g.GlobalGuard),m("design:paramtypes",["function"==typeof(i=void 0!==b.OrgUsersService&&b.OrgUsersService)?i:Object])],S)},15420:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginsController=void 0;const u=a(23324),p=a(23668),m=a(99572),_=a(77060),f=a(47932),h=a(67240),g=a(48967);let y=class PluginsController{constructor(e){this.pluginsService=e}async pluginList(){return new m.PagedResponseImpl(await this.pluginsService.pluginList())}async webhookPluginList(){return new m.PagedResponseImpl(await this.pluginsService.webhookPluginList())}async pluginTest(e,t){return await this.pluginsService.pluginTest({body:e,req:t})}async pluginRead(e){return await this.pluginsService.pluginRead({pluginId:e})}async pluginUpdate(e,t,a){return await this.pluginsService.pluginUpdate({pluginId:t,plugin:e,req:a})}async isPluginActive(e){return await this.pluginsService.isPluginActive({pluginTitle:e})}};t.PluginsController=y,l([(0,u.Get)(["/api/v1/db/meta/plugins","/api/v2/meta/plugins"]),(0,f.Acl)("pluginList",{scope:"org"}),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],y.prototype,"pluginList",null),l([(0,u.Get)(["/api/v1/db/meta/plugins/webhook","/api/v2/meta/plugins/webhook"]),(0,f.Acl)("webhookPluginList",{scope:"org"}),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],y.prototype,"webhookPluginList",null),l([(0,u.Post)(["/api/v1/db/meta/plugins/test","/api/v2/meta/plugins/test"]),(0,u.HttpCode)(200),(0,f.Acl)("pluginTest",{scope:"org"}),d(0,(0,u.Body)()),d(1,(0,u.Req)()),c("design:type",Function),c("design:paramtypes",[Object,"function"==typeof(s=void 0!==g.NcRequest&&g.NcRequest)?s:Object]),c("design:returntype",Promise)],y.prototype,"pluginTest",null),l([(0,u.Get)(["/api/v1/db/meta/plugins/:pluginId","/api/v2/meta/plugins/:pluginId"]),(0,f.Acl)("pluginRead",{scope:"org"}),d(0,(0,u.Param)("pluginId")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],y.prototype,"pluginRead",null),l([(0,u.Patch)(["/api/v1/db/meta/plugins/:pluginId","/api/v2/meta/plugins/:pluginId"]),(0,f.Acl)("pluginUpdate",{scope:"org"}),d(0,(0,u.Body)()),d(1,(0,u.Param)("pluginId")),d(2,(0,u.Req)()),c("design:type",Function),c("design:paramtypes",[Object,String,"function"==typeof(r=void 0!==g.NcRequest&&g.NcRequest)?r:Object]),c("design:returntype",Promise)],y.prototype,"pluginUpdate",null),l([(0,u.Get)(["/api/v1/db/meta/plugins/:pluginTitle/status","/api/v2/meta/plugins/:pluginTitle/status"]),(0,f.Acl)("isPluginActive",{scope:"org"}),d(0,(0,u.Param)("pluginTitle")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],y.prototype,"isPluginActive",null),t.PluginsController=y=l([(0,u.Controller)(),(0,u.UseGuards)(h.MetaApiLimiterGuard,p.GlobalGuard),c("design:paramtypes",["function"==typeof(i=void 0!==_.PluginsService&&_.PluginsService)?i:Object])],y)},40404:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&d(t,e,a);return u(t,e),t},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasExportController=void 0;const g=a(23324),y=a(71040),b=m(a(42056)),w=h(a(5520)),v=a(62304),T=a(43820),k=h(a(4456)),S=a(44980),M=a(40581),O=h(a(82096)),I=a(19684),C=a(53432),E=a(26212),x=a(48967);let L=class PublicDatasExportController{constructor(e){this.publicDatasExportService=e}async exportExcel(e,t,a,i){var s,r;const l=await I.View.getByUUID(e,i);l||T.NcError.viewNotFound(i),l.type!==y.ViewTypes.GRID&&l.type!==y.ViewTypes.KANBAN&&l.type!==y.ViewTypes.GALLERY&&l.type!==y.ViewTypes.CALENDAR&&l.type!==y.ViewTypes.MAP&&T.NcError.notFound("Not found"),l.password&&l.password!==(null===(s=t.headers)||void 0===s?void 0:s["xc-password"])&&T.NcError.invalidSharedViewPassword(),(null===(r=l.meta)||void 0===r?void 0:r.allowCSVDownload)||T.NcError.forbidden("Download is not allowed for this view");const c=await l.getModelWithInfo(e);await l.getColumns(e);const{offset:d,dbRows:u,elapsed:p}=await this.getDbRows(e,c,l,t),m=t.query.fields,_=b.utils.json_to_sheet(u.map((e=>Object.fromEntries(m.map((t=>[t,e[t]]))))),{header:m}),f=b.utils.book_new();b.utils.book_append_sheet(f,_,l.title);const h=b.write(f,{type:"base64",bookType:"xlsx"});a.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":d,"nc-export-elapsed-time":p,"Content-Disposition":`attachment; filename="${encodeURI(l.title)}-export.xlsx"`}),a.end(h)}async exportCsv(e,t,a){var i,s;const r=await I.View.getByUUID(e,t.params.publicDataUuid),l=t.query.fields;r||T.NcError.viewNotFound(t.params.publicDataUuid),r.type!==y.ViewTypes.GRID&&r.type!==y.ViewTypes.KANBAN&&r.type!==y.ViewTypes.GALLERY&&r.type!==y.ViewTypes.CALENDAR&&r.type!==y.ViewTypes.MAP&&T.NcError.notFound("Not found"),r.password&&r.password!==(null===(i=t.headers)||void 0===i?void 0:i["xc-password"])&&T.NcError.invalidSharedViewPassword(),(null===(s=r.meta)||void 0===s?void 0:s.allowCSVDownload)||T.NcError.forbidden("Download is not allowed for this view");const c=await r.getModelWithInfo(e);await r.getColumns(e);const{offset:d,dbRows:u,elapsed:p}=await this.getDbRows(e,c,r,t),m=w.default.unparse({fields:c.columns.sort(((e,t)=>Array.isArray(l)?l.indexOf(e.title)-l.indexOf(t.title):0)).filter((e=>!l||!Array.isArray(l)||l.includes(e.title))).map((e=>e.title)),data:u},{escapeFormulae:!0});a.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":d,"nc-export-elapsed-time":p,"Content-Disposition":`attachment; filename="${encodeURI(r.title)}-export.csv"`}),a.send(m)}async getDbRows(e,t,a,i){a.model.columns=a.columns.filter((e=>e.show)).map((e=>new I.Column(Object.assign(Object.assign({},e),a.model.columnsById[e.fk_column_id])))).filter((e=>!(0,y.isSystemColumn)(e)||a.show_system_fields)),t||T.NcError.notFound("Table not found");const s=Object.assign({},i.query);try{s.filterArr=JSON.parse(s.filterArrJson)}catch(e){}try{s.sortArr=JSON.parse(s.sortArrJson)}catch(e){}const r=await I.Source.get(e,t.source_id),l=await I.Model.getBaseModelSQL(e,{id:t.id,viewId:null==a?void 0:a.id,dbDriver:await O.default.get(r)}),{ast:c}=await(0,k.default)(e,{query:i.query,model:t,view:a,includePkByDefault:!1});let d=+i.query.offset||0;const u=+process.env.NC_EXPORT_MAX_TIMEOUT||5e3,p=[],m=process.hrtime();let _,f;for(_=0;_<u;d+=100,f=process.hrtime(m),_=1e3*f[0]+f[1]/1e6){const t=await(0,v.nocoExecute)(c,await l.list(Object.assign(Object.assign({},s),{offset:d,limit:100})),{},s);if(!(null==t?void 0:t.length)){d=-1;break}for(const s of t){const t=Object.assign({},s);for(const r of a.model.columns)t[r.title]=await(0,S.serializeCellValue)(e,{value:s[r.title],column:r,siteUrl:i.ncSiteUrl});p.push(t)}}return{offset:d,dbRows:p,elapsed:_}}};t.PublicDatasExportController=L,p([(0,g.Get)(["/api/v1/db/public/shared-view/:publicDataUuid/rows/export/excel","/api/v2/public/shared-view/:publicDataUuid/rows/export/excel"]),f(0,(0,E.TenantContext)()),f(1,(0,g.Request)()),f(2,(0,g.Response)()),f(3,(0,g.Param)("publicDataUuid")),_("design:type",Function),_("design:paramtypes",["function"==typeof(s=void 0!==x.NcContext&&x.NcContext)?s:Object,Object,Object,String]),_("design:returntype",Promise)],L.prototype,"exportExcel",null),p([(0,g.Get)(["/api/v1/db/public/shared-view/:publicDataUuid/rows/export/csv","/api/v2/public/shared-view/:publicDataUuid/rows/export/csv"]),f(0,(0,E.TenantContext)()),f(1,(0,g.Request)()),f(2,(0,g.Response)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(r=void 0!==x.NcContext&&x.NcContext)?r:Object,Object,Object]),_("design:returntype",Promise)],L.prototype,"exportCsv",null),p([f(0,(0,E.TenantContext)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(l=void 0!==x.NcContext&&x.NcContext)?l:Object,Object,"function"==typeof(c=void 0!==I.View&&I.View)?c:Object,Object]),_("design:returntype",Promise)],L.prototype,"getDbRows",null),t.PublicDatasExportController=L=p([(0,g.UseGuards)(C.PublicApiLimiterGuard),(0,g.Controller)(),_("design:paramtypes",["function"==typeof(i=void 0!==M.PublicDatasExportService&&M.PublicDatasExportService)?i:Object])],L)},67616:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k,S,M,O,I,C,E=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},x=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},L=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasController=void 0;const R=a(23324),N=a(17376),A=a(22892),D=a(53432),j=a(26212),P=a(48967),q=a(19684),U=a(58504),$=a(43820);let Y=class PublicDatasController{constructor(e,t){this.publicDatasService=e,this.attachmentsService=t}async dataList(e,t,a){var i;return await this.publicDatasService.dataList(e,{query:t.query,password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:a})}async dataAggregate(e,t,a){var i;return await this.publicDatasService.dataAggregate(e,{query:t.query,password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:a})}async dataGroupBy(e,t,a){var i;return await this.publicDatasService.dataGroupBy(e,{query:t.query,password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:a})}async groupedDataList(e,t,a,i){var s;return await this.publicDatasService.groupedDataList(e,{query:t.query,password:null===(s=t.headers)||void 0===s?void 0:s["xc-password"],sharedViewUuid:a,groupColumnId:i})}async dataInsert(e,t,a){var i,s;return await this.publicDatasService.dataInsert(e,{sharedViewUuid:a,password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],body:null===(s=t.body)||void 0===s?void 0:s.data,siteUrl:t.ncSiteUrl,files:t.files})}async relDataList(e,t,a,i){var s;let r;if(t.query.rowData)try{r=JSON.parse(t.query.rowData)}catch(e){r={}}return await this.publicDatasService.relDataList(e,{query:t.query,password:null===(s=t.headers)||void 0===s?void 0:s["xc-password"],sharedViewUuid:a,columnId:i,rowData:r})}async publicMmList(e,t,a,i,s){var r;return await this.publicDatasService.publicMmList(e,{query:t.query,password:null===(r=t.headers)||void 0===r?void 0:r["xc-password"],sharedViewUuid:a,columnId:s,rowId:i})}async publicHmList(e,t,a,i,s){var r;return await this.publicDatasService.publicHmList(e,{query:t.query,password:null===(r=t.headers)||void 0===r?void 0:r["xc-password"],sharedViewUuid:a,columnId:s,rowId:i})}async downloadPublicAttachment(e,t,a,i,s,r){var l;const c=await q.Column.get(e,{colId:i});c||$.NcError.fieldNotFound(i);const d=await this.publicDatasService.dataRead(e,{sharedViewUuid:a,query:{fields:c.title},rowId:s,password:null===(l=t.headers)||void 0===l?void 0:l["xc-password"]});return d||$.NcError.recordNotFound(s),this.attachmentsService.getAttachmentFromRecord({record:d,column:c,urlOrPath:r})}async bulkDataList(e,t,a){var i;return await this.publicDatasService.bulkDataList(e,{query:t.query,password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:a,body:t.body})}async bulkGroupBy(e,t,a){var i;return await this.publicDatasService.bulkGroupBy(e,{query:t.query,password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:a,body:t.body})}};t.PublicDatasController=Y,E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/rows","/api/v2/public/shared-view/:sharedViewUuid/rows"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),x("design:type",Function),x("design:paramtypes",["function"==typeof(r=void 0!==P.NcContext&&P.NcContext)?r:Object,"function"==typeof(l=void 0!==P.NcRequest&&P.NcRequest)?l:Object,String]),x("design:returntype",Promise)],Y.prototype,"dataList",null),E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/aggregate","/api/v2/public/shared-view/:sharedViewUuid/aggregate"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),x("design:type",Function),x("design:paramtypes",["function"==typeof(c=void 0!==P.NcContext&&P.NcContext)?c:Object,"function"==typeof(d=void 0!==P.NcRequest&&P.NcRequest)?d:Object,String]),x("design:returntype",Promise)],Y.prototype,"dataAggregate",null),E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/groupby","/api/v2/public/shared-view/:sharedViewUuid/groupby"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),x("design:type",Function),x("design:paramtypes",["function"==typeof(u=void 0!==P.NcContext&&P.NcContext)?u:Object,"function"==typeof(p=void 0!==P.NcRequest&&P.NcRequest)?p:Object,String]),x("design:returntype",Promise)],Y.prototype,"dataGroupBy",null),E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/group/:columnId","/api/v2/public/shared-view/:sharedViewUuid/group/:columnId"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),L(3,(0,R.Param)("columnId")),x("design:type",Function),x("design:paramtypes",["function"==typeof(m=void 0!==P.NcContext&&P.NcContext)?m:Object,"function"==typeof(_=void 0!==P.NcRequest&&P.NcRequest)?_:Object,String,String]),x("design:returntype",Promise)],Y.prototype,"groupedDataList",null),E([(0,R.Post)(["/api/v1/db/public/shared-view/:sharedViewUuid/rows","/api/v2/public/shared-view/:sharedViewUuid/rows"]),(0,R.HttpCode)(200),(0,R.UseInterceptors)((0,N.AnyFilesInterceptor)()),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),x("design:type",Function),x("design:paramtypes",["function"==typeof(f=void 0!==P.NcContext&&P.NcContext)?f:Object,"function"==typeof(h=void 0!==P.NcRequest&&P.NcRequest)?h:Object,String]),x("design:returntype",Promise)],Y.prototype,"dataInsert",null),E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/nested/:columnId","/api/v2/public/shared-view/:sharedViewUuid/nested/:columnId"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),L(3,(0,R.Param)("columnId")),x("design:type",Function),x("design:paramtypes",["function"==typeof(g=void 0!==P.NcContext&&P.NcContext)?g:Object,"function"==typeof(y=void 0!==P.NcRequest&&P.NcRequest)?y:Object,String,String]),x("design:returntype",Promise)],Y.prototype,"relDataList",null),E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/rows/:rowId/mm/:columnId","/api/v2/public/shared-view/:sharedViewUuid/rows/:rowId/mm/:columnId"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),L(3,(0,R.Param)("rowId")),L(4,(0,R.Param)("columnId")),x("design:type",Function),x("design:paramtypes",["function"==typeof(b=void 0!==P.NcContext&&P.NcContext)?b:Object,"function"==typeof(w=void 0!==P.NcRequest&&P.NcRequest)?w:Object,String,String,String]),x("design:returntype",Promise)],Y.prototype,"publicMmList",null),E([(0,R.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/rows/:rowId/hm/:columnId","/api/v2/public/shared-view/:sharedViewUuid/rows/:rowId/hm/:columnId"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),L(3,(0,R.Param)("rowId")),L(4,(0,R.Param)("columnId")),x("design:type",Function),x("design:paramtypes",["function"==typeof(v=void 0!==P.NcContext&&P.NcContext)?v:Object,"function"==typeof(T=void 0!==P.NcRequest&&P.NcRequest)?T:Object,String,String,String]),x("design:returntype",Promise)],Y.prototype,"publicHmList",null),E([(0,R.Get)("/api/v2/public/shared-view/:sharedViewUuid/downloadAttachment/:columnId/:rowId"),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),L(3,(0,R.Param)("columnId")),L(4,(0,R.Param)("rowId")),L(5,(0,R.Query)("urlOrPath")),x("design:type",Function),x("design:paramtypes",["function"==typeof(k=void 0!==P.NcContext&&P.NcContext)?k:Object,"function"==typeof(S=void 0!==P.NcRequest&&P.NcRequest)?S:Object,String,String,String,String]),x("design:returntype",Promise)],Y.prototype,"downloadPublicAttachment",null),E([(0,R.Post)(["/api/v2/public/shared-view/:sharedViewUuid/bulk/dataList"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),x("design:type",Function),x("design:paramtypes",["function"==typeof(M=void 0!==P.NcContext&&P.NcContext)?M:Object,"function"==typeof(O=void 0!==P.NcRequest&&P.NcRequest)?O:Object,String]),x("design:returntype",Promise)],Y.prototype,"bulkDataList",null),E([(0,R.Post)(["/api/v2/public/shared-view/:sharedViewUuid/bulk/group"]),L(0,(0,j.TenantContext)()),L(1,(0,R.Req)()),L(2,(0,R.Param)("sharedViewUuid")),x("design:type",Function),x("design:paramtypes",["function"==typeof(I=void 0!==P.NcContext&&P.NcContext)?I:Object,"function"==typeof(C=void 0!==P.NcRequest&&P.NcRequest)?C:Object,String]),x("design:returntype",Promise)],Y.prototype,"bulkGroupBy",null),t.PublicDatasController=Y=E([(0,R.UseGuards)(D.PublicApiLimiterGuard),(0,R.Controller)(),x("design:paramtypes",["function"==typeof(i=void 0!==A.PublicDatasService&&A.PublicDatasService)?i:Object,"function"==typeof(s=void 0!==U.AttachmentsService&&U.AttachmentsService)?s:Object])],Y)},83968:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicMetasController=void 0;const m=a(23324),_=a(10064),f=a(53432),h=a(26212),g=a(48967);let y=class PublicMetasController{constructor(e){this.publicMetasService=e}async viewMetaGet(e,t,a){var i;return await this.publicMetasService.viewMetaGet(e,{password:null===(i=t.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:a})}async publicSharedBaseGet(e,t){return await this.publicMetasService.publicSharedBaseGet(e,{sharedBaseUuid:t})}};t.PublicMetasController=y,d([(0,m.Get)(["/api/v1/db/public/shared-view/:sharedViewUuid/meta","/api/v2/public/shared-view/:sharedViewUuid/meta"]),p(0,(0,h.TenantContext)()),p(1,(0,m.Req)()),p(2,(0,m.Param)("sharedViewUuid")),u("design:type",Function),u("design:paramtypes",["function"==typeof(s=void 0!==g.NcContext&&g.NcContext)?s:Object,"function"==typeof(r=void 0!==g.NcRequest&&g.NcRequest)?r:Object,String]),u("design:returntype",Promise)],y.prototype,"viewMetaGet",null),d([(0,m.Get)(["/api/v1/db/public/shared-base/:sharedBaseUuid/meta","/api/v2/public/shared-base/:sharedBaseUuid/meta"]),p(0,(0,h.TenantContext)()),p(1,(0,m.Param)("sharedBaseUuid")),u("design:type",Function),u("design:paramtypes",["function"==typeof(l=void 0!==g.NcContext&&g.NcContext)?l:Object,String]),u("design:returntype","function"==typeof(c="undefined"!=typeof Promise&&Promise)?c:Object)],y.prototype,"publicSharedBaseGet",null),t.PublicMetasController=y=d([(0,m.UseGuards)(f.PublicApiLimiterGuard),(0,m.Controller)(),u("design:paramtypes",["function"==typeof(i=void 0!==_.PublicMetasService&&_.PublicMetasService)?i:Object])],y)},62084:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},w=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SharedBasesController=void 0;const v=a(23324),T=a(23668),k=a(96844),S=a(47932),M=a(67240),O=a(26212),I=a(48967);let C=class SharedBasesController{constructor(e){this.sharedBasesService=e}async createSharedBaseLink(e,t,a,i){return await this.sharedBasesService.createSharedBaseLink(e,{baseId:i,roles:null==a?void 0:a.roles,password:null==a?void 0:a.password,siteUrl:t.ncSiteUrl,req:t})}async updateSharedBaseLink(e,t,a,i){return await this.sharedBasesService.updateSharedBaseLink(e,{baseId:i,roles:null==a?void 0:a.roles,password:null==a?void 0:a.password,siteUrl:t.ncSiteUrl,req:t})}async disableSharedBaseLink(e,t,a){return await this.sharedBasesService.disableSharedBaseLink(e,{baseId:t,req:a})}async getSharedBaseLink(e,t,a){return await this.sharedBasesService.getSharedBaseLink(e,{baseId:a,siteUrl:t.ncSiteUrl})}};t.SharedBasesController=C,y([(0,v.Post)(["/api/v1/db/meta/projects/:baseId/shared","/api/v2/meta/bases/:baseId/shared"]),(0,v.HttpCode)(200),(0,S.Acl)("createSharedBaseLink"),w(0,(0,O.TenantContext)()),w(1,(0,v.Req)()),w(2,(0,v.Body)()),w(3,(0,v.Param)("baseId")),b("design:type",Function),b("design:paramtypes",["function"==typeof(s=void 0!==I.NcContext&&I.NcContext)?s:Object,"function"==typeof(r=void 0!==I.NcRequest&&I.NcRequest)?r:Object,Object,String]),b("design:returntype","function"==typeof(l="undefined"!=typeof Promise&&Promise)?l:Object)],C.prototype,"createSharedBaseLink",null),y([(0,v.Patch)(["/api/v1/db/meta/projects/:baseId/shared","/api/v2/meta/bases/:baseId/shared"]),(0,S.Acl)("updateSharedBaseLink"),w(0,(0,O.TenantContext)()),w(1,(0,v.Req)()),w(2,(0,v.Body)()),w(3,(0,v.Param)("baseId")),b("design:type",Function),b("design:paramtypes",["function"==typeof(c=void 0!==I.NcContext&&I.NcContext)?c:Object,"function"==typeof(d=void 0!==I.NcRequest&&I.NcRequest)?d:Object,Object,String]),b("design:returntype","function"==typeof(u="undefined"!=typeof Promise&&Promise)?u:Object)],C.prototype,"updateSharedBaseLink",null),y([(0,v.Delete)(["/api/v1/db/meta/projects/:baseId/shared","/api/v2/meta/bases/:baseId/shared"]),(0,S.Acl)("disableSharedBaseLink"),w(0,(0,O.TenantContext)()),w(1,(0,v.Param)("baseId")),w(2,(0,v.Req)()),b("design:type",Function),b("design:paramtypes",["function"==typeof(p=void 0!==I.NcContext&&I.NcContext)?p:Object,String,"function"==typeof(m=void 0!==I.NcRequest&&I.NcRequest)?m:Object]),b("design:returntype","function"==typeof(_="undefined"!=typeof Promise&&Promise)?_:Object)],C.prototype,"disableSharedBaseLink",null),y([(0,v.Get)(["/api/v1/db/meta/projects/:baseId/shared","/api/v2/meta/bases/:baseId/shared"]),(0,S.Acl)("getSharedBaseLink"),w(0,(0,O.TenantContext)()),w(1,(0,v.Req)()),w(2,(0,v.Param)("baseId")),b("design:type",Function),b("design:paramtypes",["function"==typeof(f=void 0!==I.NcContext&&I.NcContext)?f:Object,"function"==typeof(h=void 0!==I.NcRequest&&I.NcRequest)?h:Object,String]),b("design:returntype","function"==typeof(g="undefined"!=typeof Promise&&Promise)?g:Object)],C.prototype,"getSharedBaseLink",null),t.SharedBasesController=C=y([(0,v.Controller)(),(0,v.UseGuards)(M.MetaApiLimiterGuard,T.GlobalGuard),b("design:paramtypes",["function"==typeof(i=void 0!==k.SharedBasesService&&k.SharedBasesService)?i:Object])],C)},67404:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SortsController=void 0;const b=a(23324),w=a(71040),v=a(23668),T=a(99572),k=a(50976),S=a(47932),M=a(67240),O=a(26212),I=a(48967);let C=class SortsController{constructor(e){this.sortsService=e}async sortList(e,t){return new T.PagedResponseImpl(await this.sortsService.sortList(e,{viewId:t}))}async sortCreate(e,t,a,i){return await this.sortsService.sortCreate(e,{sort:a,viewId:t,req:i})}async sortGet(e,t){return await this.sortsService.sortGet(e,{sortId:t})}async sortUpdate(e,t,a,i){return await this.sortsService.sortUpdate(e,{sortId:t,sort:a,req:i})}async sortDelete(e,t,a){return await this.sortsService.sortDelete(e,{sortId:t,req:a})}};t.SortsController=C,h([(0,b.Get)(["/api/v1/db/meta/views/:viewId/sorts/","/api/v2/meta/views/:viewId/sorts/"]),(0,S.Acl)("sortList"),y(0,(0,O.TenantContext)()),y(1,(0,b.Param)("viewId")),g("design:type",Function),g("design:paramtypes",["function"==typeof(s=void 0!==I.NcContext&&I.NcContext)?s:Object,String]),g("design:returntype",Promise)],C.prototype,"sortList",null),h([(0,b.Post)(["/api/v1/db/meta/views/:viewId/sorts/","/api/v2/meta/views/:viewId/sorts/"]),(0,b.HttpCode)(200),(0,S.Acl)("sortCreate"),y(0,(0,O.TenantContext)()),y(1,(0,b.Param)("viewId")),y(2,(0,b.Body)()),y(3,(0,b.Req)()),g("design:type",Function),g("design:paramtypes",["function"==typeof(r=void 0!==I.NcContext&&I.NcContext)?r:Object,String,"function"==typeof(l=void 0!==w.SortReqType&&w.SortReqType)?l:Object,"function"==typeof(c=void 0!==I.NcRequest&&I.NcRequest)?c:Object]),g("design:returntype",Promise)],C.prototype,"sortCreate",null),h([(0,b.Get)(["/api/v1/db/meta/sorts/:sortId","/api/v2/meta/sorts/:sortId"]),(0,S.Acl)("sortGet"),y(0,(0,O.TenantContext)()),y(1,(0,b.Param)("sortId")),g("design:type",Function),g("design:paramtypes",["function"==typeof(d=void 0!==I.NcContext&&I.NcContext)?d:Object,String]),g("design:returntype",Promise)],C.prototype,"sortGet",null),h([(0,b.Patch)(["/api/v1/db/meta/sorts/:sortId","/api/v2/meta/sorts/:sortId"]),(0,S.Acl)("sortUpdate"),y(0,(0,O.TenantContext)()),y(1,(0,b.Param)("sortId")),y(2,(0,b.Body)()),y(3,(0,b.Req)()),g("design:type",Function),g("design:paramtypes",["function"==typeof(u=void 0!==I.NcContext&&I.NcContext)?u:Object,String,"function"==typeof(p=void 0!==w.SortReqType&&w.SortReqType)?p:Object,"function"==typeof(m=void 0!==I.NcRequest&&I.NcRequest)?m:Object]),g("design:returntype",Promise)],C.prototype,"sortUpdate",null),h([(0,b.Delete)(["/api/v1/db/meta/sorts/:sortId","/api/v2/meta/sorts/:sortId"]),(0,S.Acl)("sortDelete"),y(0,(0,O.TenantContext)()),y(1,(0,b.Param)("sortId")),y(2,(0,b.Req)()),g("design:type",Function),g("design:paramtypes",["function"==typeof(_=void 0!==I.NcContext&&I.NcContext)?_:Object,String,"function"==typeof(f=void 0!==I.NcRequest&&I.NcRequest)?f:Object]),g("design:returntype",Promise)],C.prototype,"sortDelete",null),t.SortsController=C=h([(0,b.Controller)(),(0,b.UseGuards)(M.MetaApiLimiterGuard,v.GlobalGuard),g("design:paramtypes",["function"==typeof(i=void 0!==k.SortsService&&k.SortsService)?i:Object])],C)},78792:function(e,t,a){"use strict";var i,s,r,l,c,d,u=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourcesController=void 0;const _=a(23324),f=a(71040),h=a(23668),g=a(99572),y=a(47932),b=a(92900),w=a(67240),v=a(26212),T=a(48967);let k=class SourcesController{constructor(e){this.sourcesService=e}async baseGet(e,t){const a=await this.sourcesService.baseGetWithConfig(e,{sourceId:t});return a.isMeta()&&(a.config=void 0),a.integration_config=void 0,a}async baseUpdate(e,t,a,i,s){const r=await this.sourcesService.baseUpdate(e,{sourceId:t,source:i,baseId:a,req:s});return r.config=void 0,r.integration_config=void 0,r}async baseList(e,t){const a=await this.sourcesService.baseList(e,{baseId:t});for(const e of a)e.config=void 0,e.integration_config=void 0;return new g.PagedResponseImpl(a,{count:a.length,limit:a.length})}};t.SourcesController=k,u([(0,_.Get)(["/api/v1/db/meta/projects/:baseId/bases/:sourceId","/api/v2/meta/bases/:baseId/sources/:sourceId"]),(0,y.Acl)("baseGet"),m(0,(0,v.TenantContext)()),m(1,(0,_.Param)("sourceId")),p("design:type",Function),p("design:paramtypes",["function"==typeof(s=void 0!==T.NcContext&&T.NcContext)?s:Object,String]),p("design:returntype",Promise)],k.prototype,"baseGet",null),u([(0,_.Patch)(["/api/v1/db/meta/projects/:baseId/bases/:sourceId","/api/v2/meta/bases/:baseId/sources/:sourceId"]),(0,y.Acl)("baseUpdate"),m(0,(0,v.TenantContext)()),m(1,(0,_.Param)("sourceId")),m(2,(0,_.Param)("baseId")),m(3,(0,_.Body)()),m(4,(0,_.Req)()),p("design:type",Function),p("design:paramtypes",["function"==typeof(r=void 0!==T.NcContext&&T.NcContext)?r:Object,String,String,"function"==typeof(l=void 0!==f.BaseReqType&&f.BaseReqType)?l:Object,"function"==typeof(c=void 0!==T.NcRequest&&T.NcRequest)?c:Object]),p("design:returntype",Promise)],k.prototype,"baseUpdate",null),u([(0,_.Get)(["/api/v1/db/meta/projects/:baseId/bases","/api/v2/meta/bases/:baseId/sources"]),(0,y.Acl)("baseList"),m(0,(0,v.TenantContext)()),m(1,(0,_.Param)("baseId")),p("design:type",Function),p("design:paramtypes",["function"==typeof(d=void 0!==T.NcContext&&T.NcContext)?d:Object,String]),p("design:returntype",Promise)],k.prototype,"baseList",null),t.SourcesController=k=u([(0,_.Controller)(),(0,_.UseGuards)(w.MetaApiLimiterGuard,h.GlobalGuard),p("design:paramtypes",["function"==typeof(i=void 0!==b.SourcesService&&b.SourcesService)?i:Object])],k)},19844:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncController=void 0;const h=a(23324),g=a(23668),y=a(73560),b=a(47932),w=a(67240),v=a(26212),T=a(48967);let k=class SyncController{constructor(e){this.syncService=e}async syncSourceList(e,t,a){return await this.syncService.syncSourceList(e,{baseId:t,sourceId:a})}async syncCreate(e,t,a,i,s){return await this.syncService.syncCreate(e,{baseId:t,sourceId:s,userId:i.user.id,syncPayload:a,req:i})}async syncDelete(e,t,a){return await this.syncService.syncDelete(e,{syncId:t,req:a})}async syncUpdate(e,t,a,i){return await this.syncService.syncUpdate(e,{syncId:t,syncPayload:a,req:i})}};t.SyncController=k,m([(0,h.Get)(["/api/v1/db/meta/projects/:baseId/syncs","/api/v1/db/meta/projects/:baseId/syncs/:sourceId","/api/v2/meta/bases/:baseId/syncs","/api/v2/meta/bases/:baseId/syncs/:sourceId"]),(0,b.Acl)("syncSourceList"),f(0,(0,v.TenantContext)()),f(1,(0,h.Param)("baseId")),f(2,(0,h.Param)("sourceId")),_("design:type",Function),_("design:paramtypes",["function"==typeof(s=void 0!==T.NcContext&&T.NcContext)?s:Object,String,String]),_("design:returntype",Promise)],k.prototype,"syncSourceList",null),m([(0,h.Post)(["/api/v1/db/meta/projects/:baseId/syncs","/api/v1/db/meta/projects/:baseId/syncs/:sourceId","/api/v2/meta/bases/:baseId/syncs","/api/v2/meta/bases/:baseId/syncs/:sourceId"]),(0,h.HttpCode)(200),(0,b.Acl)("syncSourceCreate"),f(0,(0,v.TenantContext)()),f(1,(0,h.Param)("baseId")),f(2,(0,h.Body)()),f(3,(0,h.Req)()),f(4,(0,h.Param)("sourceId")),_("design:type",Function),_("design:paramtypes",["function"==typeof(r=void 0!==T.NcContext&&T.NcContext)?r:Object,String,Object,"function"==typeof(l=void 0!==T.NcRequest&&T.NcRequest)?l:Object,String]),_("design:returntype",Promise)],k.prototype,"syncCreate",null),m([(0,h.Delete)(["/api/v1/db/meta/syncs/:syncId","/api/v2/meta/syncs/:syncId"]),(0,b.Acl)("syncSourceDelete"),f(0,(0,v.TenantContext)()),f(1,(0,h.Param)("syncId")),f(2,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(c=void 0!==T.NcContext&&T.NcContext)?c:Object,String,"function"==typeof(d=void 0!==T.NcRequest&&T.NcRequest)?d:Object]),_("design:returntype",Promise)],k.prototype,"syncDelete",null),m([(0,h.Patch)(["/api/v1/db/meta/syncs/:syncId","/api/v2/meta/syncs/:syncId"]),(0,b.Acl)("syncSourceUpdate"),f(0,(0,v.TenantContext)()),f(1,(0,h.Param)("syncId")),f(2,(0,h.Body)()),f(3,(0,h.Req)()),_("design:type",Function),_("design:paramtypes",["function"==typeof(u=void 0!==T.NcContext&&T.NcContext)?u:Object,String,Object,"function"==typeof(p=void 0!==T.NcRequest&&T.NcRequest)?p:Object]),_("design:returntype",Promise)],k.prototype,"syncUpdate",null),t.SyncController=k=m([(0,h.Controller)(),(0,h.UseGuards)(w.MetaApiLimiterGuard,g.GlobalGuard),_("design:paramtypes",["function"==typeof(i=void 0!==y.SyncService&&y.SyncService)?i:Object])],k)},65460:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TablesController=void 0;const g=a(23324),y=a(71040),b=a(23668),w=a(69680),v=a(47932),T=a(99572),k=a(67240),S=a(26212),M=a(48967);let O=class TablesController{constructor(e){this.tablesService=e}async tableList(e,t,a,i,s){return new T.PagedResponseImpl(await this.tablesService.getAccessibleTables(e,{baseId:t,sourceId:a,includeM2M:"true"===i,roles:(0,y.extractRolesObj)(s.user.base_roles)}))}async tableCreate(e,t,a,i,s){return await this.tablesService.tableCreate(e,{baseId:t,sourceId:a,table:i,user:s.user})}async tableGet(e,t,a){return await this.tablesService.getTableWithAccessibleViews(e,{tableId:a.params.tableId,user:a.user})}async tableUpdate(e,t,a,i){return await this.tablesService.tableUpdate(e,{tableId:t,table:a,baseId:i.ncBaseId,user:i.ncBaseId,req:i}),{msg:"The table has been updated successfully"}}async tableDelete(e,t,a){return await this.tablesService.tableDelete(e,{tableId:a.params.tableId,user:a.user,req:a})}async tableReorder(e,t,a){return this.tablesService.reorderTable(e,{tableId:t,order:a.order})}};t.TablesController=O,_([(0,g.Get)(["/api/v1/db/meta/projects/:baseId/tables","/api/v1/db/meta/projects/:baseId/:sourceId/tables","/api/v2/meta/bases/:baseId/tables","/api/v2/meta/bases/:baseId/:sourceId/tables"]),(0,v.Acl)("tableList"),h(0,(0,S.TenantContext)()),h(1,(0,g.Param)("baseId")),h(2,(0,g.Param)("sourceId")),h(3,(0,g.Query)("includeM2M")),h(4,(0,g.Request)()),f("design:type",Function),f("design:paramtypes",["function"==typeof(s=void 0!==M.NcContext&&M.NcContext)?s:Object,String,String,String,Object]),f("design:returntype",Promise)],O.prototype,"tableList",null),_([(0,g.Post)(["/api/v1/db/meta/projects/:baseId/tables","/api/v1/db/meta/projects/:baseId/:sourceId/tables","/api/v2/meta/bases/:baseId/tables","/api/v2/meta/bases/:baseId/:sourceId/tables"]),(0,g.HttpCode)(200),(0,v.Acl)("tableCreate"),h(0,(0,S.TenantContext)()),h(1,(0,g.Param)("baseId")),h(2,(0,g.Param)("sourceId")),h(3,(0,g.Body)()),h(4,(0,g.Request)()),f("design:type",Function),f("design:paramtypes",["function"==typeof(r=void 0!==M.NcContext&&M.NcContext)?r:Object,String,String,"function"==typeof(l=void 0!==y.TableReqType&&y.TableReqType)?l:Object,Object]),f("design:returntype",Promise)],O.prototype,"tableCreate",null),_([(0,g.Get)(["/api/v1/db/meta/tables/:tableId","/api/v2/meta/tables/:tableId"]),(0,v.Acl)("tableGet"),h(0,(0,S.TenantContext)()),h(1,(0,g.Param)("tableId")),h(2,(0,g.Request)()),f("design:type",Function),f("design:paramtypes",["function"==typeof(c=void 0!==M.NcContext&&M.NcContext)?c:Object,String,Object]),f("design:returntype",Promise)],O.prototype,"tableGet",null),_([(0,g.Patch)(["/api/v1/db/meta/tables/:tableId","/api/v2/meta/tables/:tableId"]),(0,v.Acl)("tableUpdate"),h(0,(0,S.TenantContext)()),h(1,(0,g.Param)("tableId")),h(2,(0,g.Body)()),h(3,(0,g.Request)()),f("design:type",Function),f("design:paramtypes",["function"==typeof(d=void 0!==M.NcContext&&M.NcContext)?d:Object,String,"function"==typeof(u=void 0!==y.TableReqType&&y.TableReqType)?u:Object,Object]),f("design:returntype",Promise)],O.prototype,"tableUpdate",null),_([(0,g.Delete)(["/api/v1/db/meta/tables/:tableId","/api/v2/meta/tables/:tableId"]),(0,v.Acl)("tableDelete"),h(0,(0,S.TenantContext)()),h(1,(0,g.Param)("tableId")),h(2,(0,g.Request)()),f("design:type",Function),f("design:paramtypes",["function"==typeof(p=void 0!==M.NcContext&&M.NcContext)?p:Object,String,Object]),f("design:returntype",Promise)],O.prototype,"tableDelete",null),_([(0,g.Post)(["/api/v1/db/meta/tables/:tableId/reorder","/api/v2/meta/tables/:tableId/reorder"]),(0,v.Acl)("tableReorder"),(0,g.HttpCode)(200),h(0,(0,S.TenantContext)()),h(1,(0,g.Param)("tableId")),h(2,(0,g.Body)()),f("design:type",Function),f("design:paramtypes",["function"==typeof(m=void 0!==M.NcContext&&M.NcContext)?m:Object,String,Object]),f("design:returntype",Promise)],O.prototype,"tableReorder",null),t.TablesController=O=_([(0,g.Controller)(),(0,g.UseGuards)(k.MetaApiLimiterGuard,b.GlobalGuard),f("design:paramtypes",["function"==typeof(i=void 0!==w.TablesService&&w.TablesService)?i:Object])],O)},57612:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersController=void 0;const u=a(23324),p=a(16184),m=a(23668),_=a(52144),f=a(50628),h=a(67240);let g=class UsersController{constructor(e,t,a){this.usersService=e,this.appHooksService=t,this.config=a}async update(e,t,a){a.json(await this.usersService.profileUpdate({id:t.user.id,params:e}))}};t.UsersController=g,l([(0,u.Patch)(["/api/v1/user/profile","/api/v2/meta/user/profile"]),(0,u.UseGuards)(h.MetaApiLimiterGuard,m.GlobalGuard),(0,u.HttpCode)(200),d(0,(0,u.Body)()),d(1,(0,u.Request)()),d(2,(0,u.Response)()),c("design:type",Function),c("design:paramtypes",[Object,Object,Object]),c("design:returntype",Promise)],g.prototype,"update",null),t.UsersController=g=l([(0,u.Controller)(),c("design:paramtypes",["function"==typeof(i=void 0!==f.UsersService&&f.UsersService)?i:Object,"function"==typeof(s=void 0!==_.AppHooksService&&_.AppHooksService)?s:Object,"function"==typeof(r=void 0!==p.ConfigService&&p.ConfigService)?r:Object])],g)},5460:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UtilsController=void 0;const h=f(a(2058)),g=a(50970),y=a(23324),b=a(71040),w=a(71040),v=a(23668),T=a(37156),k=a(47932),S=a(67240),M=a(53432),O=a(87424),I=a(48967),C=a(19684),E=a(64612),x=a(43820),L=a(62304),R=f(a(76584));let N=class UtilsController{constructor(e,t){this.utilsService=e,this.telemetryService=t}async getVersion(){if("true"!==process.env.NC_CLOUD)return this.utilsService.versionInfo();if(!this.version)try{this.version=await(0,g.promisify)(h.default.readFile)("./public/nc.txt","utf-8")}catch(e){this.version="Not available"}return this.version}async testConnection(e,t){var a,i;e.pool={min:0,max:1};let s=Object.assign({},e);if(e.fk_integration_id){const i=await C.Integration.get({workspace_id:E.RootScopes.BYPASS},e.fk_integration_id);if(i&&i.type===w.IntegrationsType.Database||x.NcError.integrationNotFound(e.fk_integration_id),i.is_private&&i.created_by!==t.user.id&&x.NcError.forbidden("You do not have access to this integration"),!t.user.roles[w.OrgUserRoles.CREATOR]){await R.default.ncMeta.knex(E.MetaTable.PROJECT_USERS).innerJoin(E.MetaTable.PROJECT,`${E.MetaTable.PROJECT}.id`,`${E.MetaTable.PROJECT_USERS}.base_id`).where(`${E.MetaTable.PROJECT_USERS}.fk_user_id`,t.user.id).where((e=>{e.where(`${E.MetaTable.PROJECT_USERS}.roles`,b.ProjectRoles.OWNER).orWhere(`${E.MetaTable.PROJECT_USERS}.roles`,b.ProjectRoles.CREATOR)})).first()||x.NcError.forbidden("You do not have access to this integration")}s=await i.getConfig(),(0,L.deepMerge)(s,e),(null===(a=null==s?void 0:s.connection)||void 0===a?void 0:a.database)&&(s.connection.database=(0,w.getTestDatabaseName)(s))}return(null===(i=s.connection)||void 0===i?void 0:i.ssl)&&(s.connection.ssl=(0,b.validateAndExtractSSLProp)(s.connection,s.sslUse,s.client)),await this.utilsService.testConnection({body:s})}async appInfo(e){return await this.utilsService.appInfo({req:{ncSiteUrl:e.ncSiteUrl}})}async appHealth(){return await this.utilsService.appHealth()}async axiosRequestMake(e){return await this.utilsService.axiosRequestMake({body:e})}async urlToDbConfig(e){return await this.utilsService.urlToDbConfig({body:e})}async aggregatedMetaInfo(){return await this.utilsService.aggregatedMetaInfo()}async feed(e){return await this.utilsService.feed(e)}async reportErrors(e,t){return"true"==`${process.env.NC_DISABLE_ERR_REPORTS}`||L.isEE||process.env.NC_SENTRY_DSN?{}:await this.utilsService.reportErrors({req:e,body:t})}};t.UtilsController=N,p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Get)("/api/v1/version"),m("design:type",Function),m("design:paramtypes",[]),m("design:returntype",Promise)],N.prototype,"getVersion",null),p([(0,y.UseGuards)(S.MetaApiLimiterGuard,v.GlobalGuard),(0,y.Post)(["/api/v1/db/meta/connection/test","/api/v2/meta/connection/test"]),(0,k.Acl)("testConnection",{scope:"org"}),(0,y.HttpCode)(200),_(0,(0,y.Body)()),_(1,(0,y.Req)()),m("design:type",Function),m("design:paramtypes",[Object,"function"==typeof(r=void 0!==I.NcRequest&&I.NcRequest)?r:Object]),m("design:returntype",Promise)],N.prototype,"testConnection",null),p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Get)(["/api/v1/db/meta/nocodb/info","/api/v2/meta/nocodb/info","/api/v1/meta/nocodb/info"]),_(0,(0,y.Req)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(l=void 0!==I.NcRequest&&I.NcRequest)?l:Object]),m("design:returntype",Promise)],N.prototype,"appInfo",null),p([(0,y.Get)("/api/v1/health"),m("design:type",Function),m("design:paramtypes",[]),m("design:returntype",Promise)],N.prototype,"appHealth",null),p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Post)(["/api/v1/db/meta/axiosRequestMake","/api/v2/meta/axiosRequestMake"]),(0,y.HttpCode)(200),_(0,(0,y.Body)()),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Promise)],N.prototype,"axiosRequestMake",null),p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Post)("/api/v1/url_to_config"),(0,y.HttpCode)(200),_(0,(0,y.Body)()),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Promise)],N.prototype,"urlToDbConfig",null),p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Get)("/api/v1/aggregated-meta-info"),m("design:type",Function),m("design:paramtypes",[]),m("design:returntype",Promise)],N.prototype,"aggregatedMetaInfo",null),p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Get)("/api/v2/feed"),_(0,(0,y.Request)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(c=void 0!==I.NcRequest&&I.NcRequest)?c:Object]),m("design:returntype",Promise)],N.prototype,"feed",null),p([(0,y.UseGuards)(M.PublicApiLimiterGuard),(0,y.Post)("/api/v1/error-reporting"),_(0,(0,y.Req)()),_(1,(0,y.Body)()),m("design:type",Function),m("design:paramtypes",["function"==typeof(d=void 0!==I.NcRequest&&I.NcRequest)?d:Object,"function"==typeof(u=void 0!==w.ErrorReportReqType&&w.ErrorReportReqType)?u:Object]),m("design:returntype",Promise)],N.prototype,"reportErrors",null),t.UtilsController=N=p([(0,y.Controller)(),m("design:paramtypes",["function"==typeof(i=void 0!==T.UtilsService&&T.UtilsService)?i:Object,"function"==typeof(s=void 0!==O.TelemetryService&&O.TelemetryService)?s:Object])],N)},19984:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewColumnsController=void 0;const y=a(23324),b=a(71040),w=a(23668),v=a(99572),T=a(38900),k=a(47932),S=a(67240),M=a(26212),O=a(48967);let I=class ViewColumnsController{constructor(e){this.viewColumnsService=e}async columnList(e,t){return new v.PagedResponseImpl(await this.viewColumnsService.columnList(e,{viewId:t}))}async columnAdd(e,t,a,i){return await this.viewColumnsService.columnAdd(e,{viewId:t,column:a,req:i})}async viewColumnUpdate(e,t,a,i,s){return await this.viewColumnsService.columnUpdate(e,{viewId:t,columnId:a,column:i,req:s})}async viewColumnUpdateV3(e,t,a,i){return new v.PagedResponseImpl(await this.viewColumnsService.columnsUpdate(e,{viewId:a,columns:i,req:t}))}async viewColumnListV3(e,t,a){return{[b.APIContext.VIEW_COLUMNS]:await this.viewColumnsService.viewColumnList(e,{viewId:a,req:t})}}};t.ViewColumnsController=I,f([(0,y.Get)(["/api/v1/db/meta/views/:viewId/columns/","/api/v2/meta/views/:viewId/columns/"]),(0,k.Acl)("columnList"),g(0,(0,M.TenantContext)()),g(1,(0,y.Param)("viewId")),h("design:type",Function),h("design:paramtypes",["function"==typeof(s=void 0!==O.NcContext&&O.NcContext)?s:Object,String]),h("design:returntype",Promise)],I.prototype,"columnList",null),f([(0,y.Post)(["/api/v1/db/meta/views/:viewId/columns/","/api/v2/meta/views/:viewId/columns/"]),(0,y.HttpCode)(200),(0,k.Acl)("columnAdd"),g(0,(0,M.TenantContext)()),g(1,(0,y.Param)("viewId")),g(2,(0,y.Body)()),g(3,(0,y.Req)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(r=void 0!==O.NcContext&&O.NcContext)?r:Object,String,"function"==typeof(l=void 0!==b.ViewColumnReqType&&b.ViewColumnReqType)?l:Object,"function"==typeof(c=void 0!==O.NcRequest&&O.NcRequest)?c:Object]),h("design:returntype",Promise)],I.prototype,"columnAdd",null),f([(0,y.Patch)(["/api/v1/db/meta/views/:viewId/columns/:columnId","/api/v2/meta/views/:viewId/columns/:columnId"]),(0,k.Acl)("viewColumnUpdate"),g(0,(0,M.TenantContext)()),g(1,(0,y.Param)("viewId")),g(2,(0,y.Param)("columnId")),g(3,(0,y.Body)()),g(4,(0,y.Req)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(d=void 0!==O.NcContext&&O.NcContext)?d:Object,String,String,"function"==typeof(u=void 0!==b.ViewColumnReqType&&b.ViewColumnReqType)?u:Object,"function"==typeof(p=void 0!==O.NcRequest&&O.NcRequest)?p:Object]),h("design:returntype",Promise)],I.prototype,"viewColumnUpdate",null),f([(0,y.Patch)("/api/v3/meta/views/:viewId/columns"),(0,k.Acl)("columnUpdate"),g(0,(0,M.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("viewId")),g(3,(0,y.Body)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(m=void 0!==O.NcContext&&O.NcContext)?m:Object,Object,String,Object]),h("design:returntype",Promise)],I.prototype,"viewColumnUpdateV3",null),f([(0,y.Get)("/api/v3/meta/views/:viewId/columns"),(0,k.Acl)("columnList"),g(0,(0,M.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("viewId")),h("design:type",Function),h("design:paramtypes",["function"==typeof(_=void 0!==O.NcContext&&O.NcContext)?_:Object,Object,String]),h("design:returntype",Promise)],I.prototype,"viewColumnListV3",null),t.ViewColumnsController=I=f([(0,y.Controller)(),(0,y.UseGuards)(S.MetaApiLimiterGuard,w.GlobalGuard),h("design:paramtypes",["function"==typeof(i=void 0!==T.ViewColumnsService&&T.ViewColumnsService)?i:Object])],I)},84432:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},S=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},M=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewsController=void 0;const O=a(23324),I=a(71040),C=a(99572),E=a(23668),x=a(38040),L=a(47932),R=a(67240),N=a(26212),A=a(48967);let D=class ViewsController{constructor(e){this.viewsService=e}async viewList(e,t,a){return new C.PagedResponseImpl(await this.viewsService.viewList(e,{tableId:t,user:a.user}))}async viewUpdate(e,t,a,i){return await this.viewsService.viewUpdate(e,{viewId:t,view:a,user:i.user,req:i})}async viewDelete(e,t,a){return await this.viewsService.viewDelete(e,{viewId:t,user:a.user,req:a})}async showAllColumns(e,t,a){return await this.viewsService.showAllColumns(e,{viewId:t,ignoreIds:a})}async hideAllColumns(e,t,a){return await this.viewsService.hideAllColumns(e,{viewId:t,ignoreIds:a})}async shareView(e,t,a){return await this.viewsService.shareView(e,{viewId:t,user:a.user,req:a})}async shareViewList(e,t){return new C.PagedResponseImpl(await this.viewsService.shareViewList(e,{tableId:t}))}async shareViewUpdate(e,t,a,i){return await this.viewsService.shareViewUpdate(e,{viewId:t,sharedView:a,user:i.user,req:i})}async shareViewDelete(e,t,a){return await this.viewsService.shareViewDelete(e,{viewId:t,user:a.user,req:a})}};t.ViewsController=D,k([(0,O.Get)(["/api/v1/db/meta/tables/:tableId/views","/api/v2/meta/tables/:tableId/views"]),(0,L.Acl)("viewList"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("tableId")),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(s=void 0!==A.NcContext&&A.NcContext)?s:Object,String,"function"==typeof(r=void 0!==A.NcRequest&&A.NcRequest)?r:Object]),S("design:returntype",Promise)],D.prototype,"viewList",null),k([(0,O.Patch)(["/api/v1/db/meta/views/:viewId","/api/v2/meta/views/:viewId"]),(0,L.Acl)("viewUpdate"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Body)()),M(3,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(l=void 0!==A.NcContext&&A.NcContext)?l:Object,String,"function"==typeof(c=void 0!==I.ViewUpdateReqType&&I.ViewUpdateReqType)?c:Object,"function"==typeof(d=void 0!==A.NcRequest&&A.NcRequest)?d:Object]),S("design:returntype",Promise)],D.prototype,"viewUpdate",null),k([(0,O.Delete)(["/api/v1/db/meta/views/:viewId","/api/v2/meta/views/:viewId"]),(0,L.Acl)("viewDelete"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(u=void 0!==A.NcContext&&A.NcContext)?u:Object,String,"function"==typeof(p=void 0!==A.NcRequest&&A.NcRequest)?p:Object]),S("design:returntype",Promise)],D.prototype,"viewDelete",null),k([(0,O.Post)(["/api/v1/db/meta/views/:viewId/show-all","/api/v2/meta/views/:viewId/show-all"]),(0,O.HttpCode)(200),(0,L.Acl)("showAllColumns"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Query)("ignoreIds")),S("design:type",Function),S("design:paramtypes",["function"==typeof(m=void 0!==A.NcContext&&A.NcContext)?m:Object,String,Array]),S("design:returntype",Promise)],D.prototype,"showAllColumns",null),k([(0,O.Post)(["/api/v1/db/meta/views/:viewId/hide-all","/api/v2/meta/views/:viewId/hide-all"]),(0,O.HttpCode)(200),(0,L.Acl)("hideAllColumns"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Query)("ignoreIds")),S("design:type",Function),S("design:paramtypes",["function"==typeof(_=void 0!==A.NcContext&&A.NcContext)?_:Object,String,Array]),S("design:returntype",Promise)],D.prototype,"hideAllColumns",null),k([(0,O.Post)(["/api/v1/db/meta/views/:viewId/share","/api/v2/meta/views/:viewId/share"]),(0,O.HttpCode)(200),(0,L.Acl)("shareView"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(f=void 0!==A.NcContext&&A.NcContext)?f:Object,String,"function"==typeof(h=void 0!==A.NcRequest&&A.NcRequest)?h:Object]),S("design:returntype",Promise)],D.prototype,"shareView",null),k([(0,O.Get)(["/api/v1/db/meta/tables/:tableId/share","/api/v2/meta/tables/:tableId/share"]),(0,L.Acl)("shareViewList"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("tableId")),S("design:type",Function),S("design:paramtypes",["function"==typeof(g=void 0!==A.NcContext&&A.NcContext)?g:Object,String]),S("design:returntype",Promise)],D.prototype,"shareViewList",null),k([(0,O.Patch)(["/api/v1/db/meta/views/:viewId/share","/api/v2/meta/views/:viewId/share"]),(0,L.Acl)("shareViewUpdate"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Body)()),M(3,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(y=void 0!==A.NcContext&&A.NcContext)?y:Object,String,"function"==typeof(b=void 0!==I.ViewUpdateReqType&&I.ViewUpdateReqType)?b:Object,"function"==typeof(w=void 0!==A.NcRequest&&A.NcRequest)?w:Object]),S("design:returntype",Promise)],D.prototype,"shareViewUpdate",null),k([(0,O.Delete)(["/api/v1/db/meta/views/:viewId/share","/api/v2/meta/views/:viewId/share"]),(0,L.Acl)("shareViewDelete"),M(0,(0,N.TenantContext)()),M(1,(0,O.Param)("viewId")),M(2,(0,O.Req)()),S("design:type",Function),S("design:paramtypes",["function"==typeof(v=void 0!==A.NcContext&&A.NcContext)?v:Object,String,"function"==typeof(T=void 0!==A.NcRequest&&A.NcRequest)?T:Object]),S("design:returntype",Promise)],D.prototype,"shareViewDelete",null),t.ViewsController=D=k([(0,O.Controller)(),(0,O.UseGuards)(R.MetaApiLimiterGuard,E.GlobalGuard),S("design:paramtypes",["function"==typeof(i=void 0!==x.ViewsService&&x.ViewsService)?i:Object])],D)},70240:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModelSqlv2=void 0,t.populatePk=F,t.getColumnName=H,t.getAs=G,t.replaceDynamicFieldWithValue=function(e,t,a,i,s){return async e=>e},t.extractSortsObject=z,t.extractFilterFromXwhere=J,t.extractCondition=K,t._wherePk=X,t.getCompositePkValue=Z,t.haveFormulaColumn=ee,t.getListArgs=function(e,t,{ignoreAssigningWildcardSelect:a=!1}={}){var i,s;const r={};return r.where=e.where||e.filter||e.w||"",r.having=e.having||e.h||"",r.shuffle=e.shuffle||e.r||"",r.condition=e.condition||e.c||{},r.conditionGraph=e.conditionGraph||{},r.limit=Math.max(Math.min(Math.max(+((null==e?void 0:e.limit)||(null==e?void 0:e.l)),0)||BaseModelSqlv2.config.limitDefault,BaseModelSqlv2.config.limitMax),BaseModelSqlv2.config.limitMin),r.offset=Math.max(+((null==e?void 0:e.offset)||(null==e?void 0:e.o))||0,0),r.fields=(null==e?void 0:e.fields)||(null==e?void 0:e.f)||(a?null:"*"),r.sort=(null==e?void 0:e.sort)||(null==e?void 0:e.s)||(null===(s=null===(i=t.primaryKey)||void 0===i?void 0:i[0])||void 0===s?void 0:s.column_name),r.pks=null==e?void 0:e.pks,r};const r=s(a(14940)),l=s(a(62036)),c=s(a(86682)),d=s(a(44578)),u=s(a(91198)),p=s(a(76070)),m=s(a(77852)),_=a(71040),f=s(a(33848)),h=a(92080),g=s(a(68552)),y=a(81104),b=a(23324),w=a(62304),v=a(19684),T=s(a(28148)),k=s(a(98548)),S=s(a(87188)),M=s(a(7524)),O=a(7228),I=a(43468),C=a(43820),E=s(a(4456)),x=a(44356),L=s(a(76584)),R=a(26972),N=a(64612),A=a(70220),D=a(11620),j=s(a(73172)),P=a(62304),q=s(a(799));d.default.extend(u.default),d.default.extend(p.default);const U=new b.Logger("BaseModelSqlv2"),$="__nc_group_id",Y=(0,h.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14),B=e=>"string"==typeof e||"number"==typeof e;async function F(e,t,a){var i,s;await t.getColumns(e);for(const e of t.primaryKeys)(null===(i=e.meta)||void 0===i?void 0:i.ag)&&!a[e.title]&&(a[e.title]="nc"===(null===(s=e.meta)||void 0===s?void 0:s.ag)?`rc_${Y()}`:(0,y.v4)())}function V(e,t,a){return!(!e.pk&&e.uidt!==_.UITypes.ForeignKey)||(!(!a||!e.pv)||(!t||t.includes(e.title)))}async function H(e,t,a){if(!(0,_.isCreatedOrLastModifiedTimeCol)(t)&&!(0,_.isCreatedOrLastModifiedByCol)(t))return t.column_name;switch(a=a||await v.Column.list(e,{fk_model_id:t.fk_model_id}),t.uidt){case _.UITypes.CreatedTime:{const e=a.find((e=>e.system&&e.uidt===_.UITypes.CreatedTime));return e?e.column_name:t.column_name||"created_at"}case _.UITypes.LastModifiedTime:{const e=a.find((e=>e.system&&e.uidt===_.UITypes.LastModifiedTime));return e?e.column_name:t.column_name||"updated_at"}case _.UITypes.CreatedBy:{const e=a.find((e=>e.system&&e.uidt===_.UITypes.CreatedBy));return e?e.column_name:t.column_name||"created_by"}case _.UITypes.LastModifiedBy:{const e=a.find((e=>e.system&&e.uidt===_.UITypes.LastModifiedBy));return e?e.column_name:t.column_name||"updated_by"}default:return t.column_name}}function G(e){return e.asId||e.id}function W(e,t){const a={};return Object.entries(e).forEach((([e,i])=>{const s=t[e];s&&(a[s]=i)})),a}class BaseModelSqlv2{get dbDriver(){return this._dbDriver}constructor({dbDriver:e,model:t,viewId:a,context:i,schema:s}){this._columns={},this._dbDriver=e,this.model=t,this.viewId=a,this.context=i,this.schema=s,(0,r.default)(this)}async readByPk(e,t=!1,a={},{ignoreView:i=!1,getHiddenColumn:s=!1,throwErrorIfInvalidParams:r=!1,extractOnlyPrimaries:l=!1}={}){const c=this.dbDriver(this.tnPath),{ast:d,dependencyFields:u,parsedQuery:p}=await(0,E.default)(this.context,{query:a,model:this.model,view:i?null:this.viewId&&await v.View.get(this.context,this.viewId),getHiddenColumn:s,throwErrorIfInvalidParams:r,extractOnlyPrimaries:l});let m;await this.selectObject(Object.assign(Object.assign({},null!=u?u:{}),{qb:c,validateFormula:t})),c.where(X(this.model.primaryKeys,e));try{m=await this.execAndParse(c,null,{first:!0})}catch(a){if(t||!ee(await this.model.getColumns(this.context)))throw a;return U.log(a),this.readByPk(e,!0)}if(m){const e=await this.getProto();m.__proto__=e}return m?await(0,w.nocoExecute)(d,m,{},p):null}async readByPkFromModel(e=this.model,t,a,...i){var s;let r;if(this.model.id===e.id)r=await this.readByPk(...i);else{const a=await v.Model.getBaseModelSQL(this.context,{model:e,viewId:t,dbDriver:this.dbDriver});r=await a.readByPk(...i)}return a?r?null!==(s=r[e.displayValue.title])&&void 0!==s?s:null:"":r}async readOnlyPrimariesByPkFromModel(e){return await Promise.all(e.map((({model:e,id:t,extractDisplayValueData:a=!0})=>this.readByPkFromModel(e,void 0,a,t,!1,{},{ignoreView:!0,getHiddenColumn:!0,extractOnlyPrimaries:!0}))))}async exist(e){const t=this.dbDriver(this.tnPath);await this.model.getColumns(this.context);const a=this.model.primaryKeys;return!!a.length&&(t.select(a[0].column_name),(e+"").split("___").length==(null==a?void 0:a.length)&&(t.where(X(a,e)).first(),!!await this.execAndParse(t,null,{raw:!0,first:!0})))}async findOne(e={},t=!1){const a=await this.model.getColumns(this.context),s=this._getListArgs(e),{where:r}=s,l=i(s,["where"]),c=this.dbDriver(this.tnPath);await this.selectObject(Object.assign(Object.assign({},e),{qb:c,validateFormula:t,columns:a}));const d=await this.model.getAliasColObjMap(this.context,a),u=z(null==l?void 0:l.sort,d),p=J(r,d);let m;await(0,S.default)(this,[new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:p,is_group:!0,logical_op:"and"})],c),Array.isArray(u)&&(null==u?void 0:u.length)?await(0,M.default)(this,u,c):this.model.primaryKey&&c.orderBy(this.model.primaryKey.column_name);try{m=await this.execAndParse(c,null,{first:!0})}catch(i){if(t||!ee(a))throw i;return U.log(i),this.findOne(e,!0)}if(m){const e=await this.getProto();m.__proto__=e}return m}async list(e={},t={}){var a;const{ignoreViewFilterAndSort:s=!1,ignorePagination:r=!1,validateFormula:l=!1,throwErrorIfInvalidParams:c=!1,limitOverride:d}=t,u=await this.model.getColumns(this.context),p=this._getListArgs(e),{where:m,fields:f}=p,h=i(p,["where","fields"]),g=this.dbDriver(this.tnPath);await this.selectObject({qb:g,fieldsSet:e.fieldsSet,viewId:this.viewId,validateFormula:l,columns:u}),+(null==h?void 0:h.shuffle)&&await this.shuffle({qb:g});const y=await this.model.getAliasColObjMap(this.context,u);let b=z(null==h?void 0:h.sort,y,c);const w=J(m,y,c);if(!s&&this.viewId?(await(0,S.default)(this,[...e.customConditions?[new v.Filter({children:e.customConditions,is_group:!0})]:[],new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0}),new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:w,is_group:!0,logical_op:"and"})],g,void 0,c),b||(b=(null===(a=e.sortArr)||void 0===a?void 0:a.length)?e.sortArr:await v.Sort.list(this.context,{viewId:this.viewId})),await(0,M.default)(this,b,g,void 0,c)):(await(0,S.default)(this,[...e.customConditions?[new v.Filter({children:e.customConditions,is_group:!0})]:[],new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:w,is_group:!0,logical_op:"and"})],g,void 0,c),b||(b=e.sortArr),await(0,M.default)(this,b,g,void 0,c)),this.model.primaryKey&&this.model.primaryKey.ai)g.orderBy(this.model.primaryKey.column_name);else{const e=this.model.columns.find((e=>e.uidt===_.UITypes.CreatedTime&&e.system));e&&g.orderBy(e.column_name)}if(h.pks){const e=h.pks.split(",");g.where((t=>(e.forEach((e=>{t.orWhere(X(this.model.primaryKeys,e))})),t)))}r||Q(g,d?Object.assign(Object.assign({},h),{limit:d}):h);const T=await this.getProto();let k;try{k=await this.execAndParse(g)}catch(t){if(l||!ee(u))throw t;return U.log(t),this.list(e,{ignoreViewFilterAndSort:s,ignorePagination:r,validateFormula:!0})}return null==k?void 0:k.map((e=>(e.__proto__=T,e)))}async count(e={},t=!1,a=!1){var i,s;const r=await this.model.getColumns(this.context),{where:l}=this._getListArgs(e),c=this.dbDriver(this.tnPath),d=J(l,await this.model.getAliasColObjMap(this.context,r),a);return!t&&this.viewId?await(0,S.default)(this,[...e.customConditions?[new v.Filter({children:e.customConditions,is_group:!0})]:[],new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0}),new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:d,is_group:!0,logical_op:"and"}),...e.filterArr||[]],c,void 0,a):await(0,S.default)(this,[...e.customConditions?[new v.Filter({children:e.customConditions,is_group:!0})]:[],new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:d,is_group:!0,logical_op:"and"}),...e.filterArr||[]],c,void 0,a),c.count((0,x.sanitize)(null===(i=this.model.primaryKey)||void 0===i?void 0:i.column_name)||"*",{as:"count"}).first(),null===(s=await this.execAndParse(c,null,{raw:!0,first:!0}))||void 0===s?void 0:s.count}async groupByAndAggregate(e,t,a){var s;const r=await this.model.getColumns(this.context),l=this._getListArgs(a),{where:c}=l,d=i(l,["where"]),u=this.dbDriver(this.tnPath),p=`${e} as ${t}__${e}`;if("function"!=typeof u[t])throw new Error(`Unsupported aggregate function: ${t}`);u[t](p),u.select(a.groupByColumnName),+(null==d?void 0:d.shuffle)&&await this.shuffle({qb:u});const m=J(c,await this.model.getAliasColObjMap(this.context,r));return await(0,S.default)(this,[new v.Filter({children:a.widgetFilterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:m,is_group:!0,logical_op:"and"})],u),(null==a?void 0:a.groupByColumnName)&&u.groupBy(null==a?void 0:a.groupByColumnName),(null===(s=null==a?void 0:a.sortBy)||void 0===s?void 0:s.column_name)&&u.orderBy(a.sortBy.column_name,a.sortBy.direction),Q(u,d),await this.execAndParse(u)}async bulkGroupByCount(e,t,a){var s;try{const a=await this.model.getColumns(this.context),r=await this.model.getAliasColObjMap(this.context,a),l=[],c=await v.Filter.rootFilterList(this.context,{viewId:this.viewId});if(!(null==t?void 0:t.length))return C.NcError.badRequest("bulkFilterList is required");for(const d of t){const t=this._getListArgs(d),{where:u}=t,p=i(t,["where"]),m=[],f={},h=(0,P.getAliasGenerator)("__nc_gb"),g=J(d.where,r),y=this.dbDriver(this.tnPath),b=[];await Promise.all(p.column_name.split(",").map((async e=>{let t=a.find((t=>t.column_name===e||t.title===e));switch([_.UITypes.QrCode,_.UITypes.Barcode].includes(t.uidt)&&(t=new v.Column(Object.assign(Object.assign({},await t.getColOptions(this.context).then((e=>e.getValueColumn(this.context)))),{asId:t.id}))),f[G(t)]=t,t.uidt){case _.UITypes.Attachment:C.NcError.badRequest("Group by using attachment column is not supported");break;case _.UITypes.Button:C.NcError.badRequest("Group by using Button column is not supported");break;case _.UITypes.Links:case _.UITypes.Rollup:b.push((await(0,k.default)({baseModelSqlv2:this,knex:this.dbDriver,columnOptions:await t.getColOptions(this.context)})).builder.as(G(t))),m.push(G(t));break;case _.UITypes.Formula:{let e;try{const a=await this.getSelectQueryBuilderForFormula(t);e=this.dbDriver.raw("?? as ??",[a.builder,G(t)])}catch(a){console.log(a),e=this.dbDriver.raw("'ERR' as ??",[G(t)])}b.push(e),m.push(G(t));break}case _.UITypes.Lookup:case _.UITypes.LinkToAnotherRecord:{const e=await(0,j.default)({baseModelSqlv2:this,column:t,alias:null,model:this.model,getAlias:h}),a=this.dbDriver.raw("?? as ??",[this.dbDriver.raw(e.builder).wrap("(",")"),G(t)]);b.push(a),m.push(G(t));break}case _.UITypes.DateTime:case _.UITypes.CreatedTime:case _.UITypes.LastModifiedTime:{const e=await H(this.context,t,a);"pg"===this.dbDriver.clientType()?b.push(this.dbDriver.raw("date_trunc('minute', ??) + interval '0 seconds' as ??",[e,G(t)])):"mysql"===this.dbDriver.clientType()||"mysql2"===this.dbDriver.clientType()?b.push(this.dbDriver.raw("DATE_SUB(CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00'), INTERVAL SECOND(??) SECOND) as ??",[e,e,G(t)])):"sqlite3"===this.dbDriver.clientType()?b.push(this.dbDriver.raw("strftime ('%Y-%m-%d %H:%M:00',:column:) ||\n  (\n   CASE WHEN substr(:column:, 20, 1) = '+' THEN\n    printf ('+%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   WHEN substr(:column:, 20, 1) = '-' THEN\n    printf ('-%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   ELSE\n    '+00:00'\n   END) AS :id:",{column:e,id:G(t)})):b.push(this.dbDriver.raw("DATE(??) as ??",[e,G(t)])),m.push(G(t))}break;default:{const e=await H(this.context,t,a);b.push(this.dbDriver.raw("?? as ??",[e,G(t)])),m.push(G(t));break}}}))),y.count(`${(null===(s=this.model.primaryKey)||void 0===s?void 0:s.column_name)||"*"} as count`),y.select(...b),+(null==p?void 0:p.shuffle)&&await this.shuffle({qb:y}),await(0,S.default)(this,[...this.viewId?[new v.Filter({children:c||[],is_group:!0})]:[],new v.Filter({children:p.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:J(u,r),is_group:!0,logical_op:"and"}),new v.Filter({children:g,is_group:!0,logical_op:"and"}),new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"})],y),y.groupBy(...m);const w=this.dbDriver.count("*",{as:"count"}).from(y.as("groupby"));let T;switch(this.dbDriver.client.config.client){case"pg":T=this.dbDriver.select(this.dbDriver.raw("json_build_object('count', \"count\") as ??",[h()])).from(w.as(h())),l.push(this.dbDriver.raw("(??) as ??",[T,`${d.alias}`]));break;case"mysql2":T=this.dbDriver.select(this.dbDriver.raw("JSON_OBJECT('count', `count`)")).from(w.as(h())),l.push(this.dbDriver.raw("(??) as ??",[T,`${d.alias}`]));break;case"sqlite3":T=this.dbDriver.select(this.dbDriver.raw("json_object('count', \"count\") as ??",[d.alias])).from(w.as(h())),l.push(this.dbDriver.raw("(??) as ??",[T,`${d.alias}`]));break;default:C.NcError.notImplemented("This database does not support bulk groupBy count")}}const d=this.dbDriver(this.tnPath);d.select(...l).limit(1);return await this.execAndParse(d,null,{raw:!0,first:!0})}catch(e){console.log(e)}}async bulkGroupBy(e,t,a){var s,r;const l=await this.model.getColumns(this.context),c=await this.model.getAliasColObjMap(this.context,l),d=[],u=await v.Filter.rootFilterList(this.context,{viewId:this.viewId});try{if(!(null==t?void 0:t.length))return C.NcError.badRequest("bulkFilterList is required");for(const a of t){const t=this._getListArgs(a),{where:p}=t,m=i(t,["where"]),f=[],h={},g=(0,P.getAliasGenerator)("__nc_gb"),y=J(null==a?void 0:a.where,c);let b=z(null==m?void 0:m.sort,c);const w=this.dbDriver(this.tnPath),T=[],M=m.column_name.split(",").map((e=>{const t=l.find((t=>t.column_name===e||t.title===e));if(!t)throw C.NcError.fieldNotFound(e);return null==t?void 0:t.id})).join("_");await Promise.all(m.column_name.split(",").map((async e=>{let t=l.find((t=>t.column_name===e||t.title===e));switch([_.UITypes.QrCode,_.UITypes.Barcode].includes(t.uidt)&&(t=new v.Column(Object.assign(Object.assign({},await t.getColOptions(this.context).then((e=>e.getValueColumn(this.context)))),{asId:t.id}))),h[G(t)]=t,t.uidt){case _.UITypes.Attachment:C.NcError.badRequest("Group by using attachment column is not supported");break;case _.UITypes.Button:C.NcError.badRequest("Group by using Button column is not supported");break;case _.UITypes.Links:case _.UITypes.Rollup:T.push((await(0,k.default)({baseModelSqlv2:this,knex:this.dbDriver,columnOptions:await t.getColOptions(this.context)})).builder.as(G(t))),f.push(G(t));break;case _.UITypes.Formula:{let e;try{const a=await this.getSelectQueryBuilderForFormula(t);e=this.dbDriver.raw("?? as ??",[a.builder,G(t)])}catch(a){console.log(a),e=this.dbDriver.raw("'ERR' as ??",[G(t)])}T.push(e),f.push(G(t));break}case _.UITypes.Lookup:case _.UITypes.LinkToAnotherRecord:{const e=await(0,j.default)({baseModelSqlv2:this,column:t,alias:null,model:this.model,getAlias:g}),a=this.dbDriver.raw("?? as ??",[this.dbDriver.raw(e.builder).wrap("(",")"),G(t)]);T.push(a),f.push(G(t));break}case _.UITypes.DateTime:case _.UITypes.CreatedTime:case _.UITypes.LastModifiedTime:{const e=await H(this.context,t,l);"pg"===this.dbDriver.clientType()?T.push(this.dbDriver.raw("date_trunc('minute', ??) + interval '0 seconds' as ??",[e,G(t)])):"mysql"===this.dbDriver.clientType()||"mysql2"===this.dbDriver.clientType()?T.push(this.dbDriver.raw("DATE_SUB(CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00'), INTERVAL SECOND(??) SECOND) as ??",[e,e,G(t)])):"sqlite3"===this.dbDriver.clientType()?T.push(this.dbDriver.raw("strftime ('%Y-%m-%d %H:%M:00',:column:) ||\n  (\n   CASE WHEN substr(:column:, 20, 1) = '+' THEN\n    printf ('+%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   WHEN substr(:column:, 20, 1) = '-' THEN\n    printf ('-%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   ELSE\n    '+00:00'\n   END) AS :id:",{column:e,id:G(t)})):T.push(this.dbDriver.raw("DATE(??) as ??",[e,G(t)])),f.push(G(t))}break;default:{const e=await H(this.context,t,l);T.push(this.dbDriver.raw("?? as ??",[e,G(t)])),f.push(G(t));break}}}))),w.count(`${(null===(s=this.model.primaryKey)||void 0===s?void 0:s.column_name)||"*"} as count`),w.select(...T),+(null==m?void 0:m.shuffle)&&await this.shuffle({qb:w}),await(0,S.default)(this,[...this.viewId?[new v.Filter({children:u||[],is_group:!0})]:[],new v.Filter({children:m.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:J(p,c),is_group:!0,logical_op:"and"}),new v.Filter({children:y,is_group:!0,logical_op:"and"}),new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"})],w),b||((null===(r=m.sortArr)||void 0===r?void 0:r.length)?b=m.sortArr:this.viewId&&(b=await v.Sort.list(this.context,{viewId:this.viewId})));for(const e of b||[]){if(!h[e.fk_column_id])continue;const t=h[e.fk_column_id];if([_.UITypes.User,_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(t.uidt)){const a=await H(this.context,t,l),i=(await v.BaseUser.getUsersList(this.context,{base_id:t.base_id})).reduce(((e,t)=>this.dbDriver.raw(`REPLACE(${e}, ?, ?)`,[t.id,t.display_name||t.email]).toQuery()),this.dbDriver.raw("??",[a]).toQuery());["asc","desc"].includes(e.direction)?w.orderBy((0,x.sanitize)(this.dbDriver.raw(i)),e.direction,"desc"===e.direction?"LAST":"FIRST"):w.orderBy("count","count-desc"===e.direction?"desc":"asc","count-desc"===e.direction?"LAST":"FIRST")}else["asc","desc"].includes(e.direction)?w.orderBy(G(t),e.direction,"desc"===e.direction?"LAST":"FIRST"):w.orderBy("count","count-desc"===e.direction?"desc":"asc","count-desc"===e.direction?"LAST":"FIRST");w.groupBy(...f),Q(w,m)}let O;switch(this.dbDriver.client.config.client){case"pg":O=this.dbDriver.select(this.dbDriver.raw(`json_agg(json_build_object('count', "count", '${m.column_name}', "${M}")) as ??`,[g()])).from(w.as(g())),d.push(this.dbDriver.raw("(??) as ??",[O,`${a.alias}`]));break;case"mysql2":O=this.dbDriver.select(this.dbDriver.raw(`JSON_ARRAYAGG(JSON_OBJECT('count', \`count\`, '${m.column_name}', \`${M}\`))`)).from(this.dbDriver.raw("(??) as ??",[w,g()])),d.push(this.dbDriver.raw("(??) as ??",[O,a.alias]));break;case"sqlite3":O=this.dbDriver.select(this.dbDriver.raw(`json_group_array(json_object('count', "count", '${m.column_name}', "${M}")) as ??`,[a.alias])).from(w.as(g())),d.push(this.dbDriver.raw("(??) as ??",[O,a.alias]));break;default:C.NcError.notImplemented("This database does not support bulk groupBy")}}const a=this.dbDriver(this.tnPath);a.select(...d).limit(1);return await this.execAndParse(a,null,{raw:!0,first:!0})}catch(e){return U.log(e),[]}}async bulkAggregate(e,t,a){try{if(!(null==t?void 0:t.length))return C.NcError.badRequest("bulkFilterList is required");const{where:i,aggregation:s}=this._getListArgs(e),r=await this.model.getColumns(this.context);let l=(await v.GridViewColumn.list(this.context,this.viewId)).filter((e=>{const t=r.find((t=>t.id===e.fk_column_id));return e.show&&(a.show_system_fields||!(0,_.isSystemColumn)(t))}));(null==s?void 0:s.length)&&(l=l.map((e=>{const t=s.find((t=>t.field===e.fk_column_id));return new v.GridViewColumn(Object.assign(Object.assign({},e),{show:!!t,aggregation:t?t.type:e.aggregation}))})).filter((e=>e.show)));const c=await this.model.getAliasColObjMap(this.context,r),d=this.dbDriver(this.tnPath),u={};for(const e of l){const t=r.find((t=>t.id===e.fk_column_id));if(!t||!e.aggregation||(0,_.isLinksOrLTAR)(t)&&t.system)continue;const a=t.id,i=await(0,q.default)({baseModelSqlv2:this,aggregation:e.aggregation,column:t});i&&(u[a]=i)}if(!Object.keys(u).length)return{};const p=await v.Filter.rootFilterList(this.context,{viewId:this.viewId}),m=[];for(const a of t){const t=this.dbDriver(this.tnPath),s=J(a.where,c);let r,l=a.filterArrJson;try{l=JSON.parse(l)}catch(e){}switch(await(0,S.default)(this,[...this.viewId?[new v.Filter({children:p||[],is_group:!0})]:[],new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:J(i,c),is_group:!0,logical_op:"and"}),new v.Filter({children:s,is_group:!0,logical_op:"and"}),...l?[new v.Filter({children:l,is_group:!0})]:[]],t),this.dbDriver.client.config.client){case"pg":r=this.dbDriver.raw(`JSON_BUILD_OBJECT(${Object.keys(u).map((e=>`'${e}', ${u[e]}`)).join(", ")})`);break;case"mysql2":r=this.dbDriver.raw(`JSON_OBJECT(\n              ${Object.keys(u).map((e=>`'${e}', ${u[e]}`)).join(", ")})`);break;case"sqlite3":r=this.dbDriver.raw(`json_object(\n                ${Object.keys(u).map((e=>`'${e}', ${u[e]}`)).join(", ")})`);break;default:C.NcError.notImplemented("This database is not supported for bulk aggregation")}t.select(r),"mysql2"===this.dbDriver.client.config.client?m.push(this.dbDriver.raw("JSON_UNQUOTE(??) as ??",[r,`${a.alias}`])):m.push(this.dbDriver.raw("(??) as ??",[t,`${a.alias}`]))}d.select(...m),d.limit(1);return await this.execAndParse(d,null,{first:!0,bulkAggregate:!0})}catch(e){return U.log(e),[]}}async aggregate(e,t){try{const{where:a,aggregation:i}=this._getListArgs(e),s=await this.model.getColumns(this.context);let r=(await v.GridViewColumn.list(this.context,this.viewId)).filter((e=>{const a=s.find((t=>t.id===e.fk_column_id));return e.show&&(t.show_system_fields||!(0,_.isSystemColumn)(a))}));(null==i?void 0:i.length)&&(r=r.map((e=>{const t=i.find((t=>t.field===e.fk_column_id));return new v.GridViewColumn(Object.assign(Object.assign({},e),{show:!!t,aggregation:t?t.type:e.aggregation}))})).filter((e=>e.show)));const l=await this.model.getAliasColObjMap(this.context,s),c=this.dbDriver(this.tnPath),d=J(a,l);await(0,S.default)(this,[...this.viewId?[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0})]:[],new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:d,is_group:!0,logical_op:"and"})],c);const u=[];if(await Promise.all(r.map((async e=>{const t=s.find((t=>t.id===e.fk_column_id));if(!t)return null;if(!e.aggregation)return;if((0,_.isLinksOrLTAR)(t)&&t.system)return;const a=await(0,q.default)({baseModelSqlv2:this,aggregation:e.aggregation,column:t,alias:t.id});a&&u.push(this.dbDriver.raw(a))}))),!u.length)return{};c.select(...u);return await this.execAndParse(c,null,{first:!0,skipDateConversion:!0,skipAttachmentConversion:!0,skipUserConversion:!0})}catch(e){return U.log(e),{}}}async groupBy(e){var t,a;const s=this._getListArgs(e),{where:r}=s,l=i(s,["where"]);e.column_name=e.column_name||"";const c=await this.model.getColumns(this.context),d={},u=[],p=[],m=(0,P.getAliasGenerator)("__nc_gb");await Promise.all(e.column_name.split(",").map((async e=>{let t=c.find((t=>t.column_name===e||t.title===e));if(!t)throw C.NcError.fieldNotFound(e);switch([_.UITypes.QrCode,_.UITypes.Barcode].includes(t.uidt)&&(t=new v.Column(Object.assign(Object.assign({},await t.getColOptions(this.context).then((e=>e.getValueColumn(this.context)))),{asId:t.id}))),d[G(t)]=t,t.uidt){case _.UITypes.Attachment:C.NcError.badRequest("Group by using attachment column is not supported");break;case _.UITypes.Button:C.NcError.badRequest("Group by using Button column is not supported");break;case _.UITypes.Links:case _.UITypes.Rollup:u.push((await(0,k.default)({baseModelSqlv2:this,knex:this.dbDriver,columnOptions:await t.getColOptions(this.context)})).builder.as(G(t))),p.push(G(t));break;case _.UITypes.Formula:{let e;try{const a=await this.getSelectQueryBuilderForFormula(t);e=this.dbDriver.raw("?? as ??",[a.builder,G(t)])}catch(a){U.log(a),e=this.dbDriver.raw("'ERR' as ??",[G(t)])}u.push(e),p.push(G(t))}break;case _.UITypes.Lookup:case _.UITypes.LinkToAnotherRecord:{const e=await(0,j.default)({baseModelSqlv2:this,column:t,alias:null,model:this.model,getAlias:m}),a=this.dbDriver.raw("?? as ??",[this.dbDriver.raw(e.builder).wrap("(",")"),G(t)]);u.push(a),p.push(G(t))}break;case _.UITypes.CreatedTime:case _.UITypes.LastModifiedTime:case _.UITypes.DateTime:{const e=await H(this.context,t,c);"pg"===this.dbDriver.clientType()?u.push(this.dbDriver.raw("date_trunc('minute', ??) + interval '0 seconds' as ??",[e,G(t)])):"mysql"===this.dbDriver.clientType()||"mysql2"===this.dbDriver.clientType()?u.push(this.dbDriver.raw("DATE_SUB(CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00'), INTERVAL SECOND(??) SECOND) as ??",[e,e,G(t)])):"sqlite3"===this.dbDriver.clientType()?u.push(this.dbDriver.raw("strftime ('%Y-%m-%d %H:%M:00',:column:) ||\n  (\n   CASE WHEN substr(:column:, 20, 1) = '+' THEN\n    printf ('+%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   WHEN substr(:column:, 20, 1) = '-' THEN\n    printf ('-%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   ELSE\n    '+00:00'\n   END) AS :id:",{column:e,id:G(t)})):u.push(this.dbDriver.raw("DATE(??) as ??",[e,G(t)])),p.push(G(t))}break;default:{const e=await H(this.context,t,c);u.push(this.dbDriver.raw("?? as ??",[e,G(t)])),p.push(G(t))}}})));const f=this.dbDriver(this.tnPath);f.count(`${(null===(t=this.model.primaryKey)||void 0===t?void 0:t.column_name)||"*"} as count`),f.select(...u),+(null==l?void 0:l.shuffle)&&await this.shuffle({qb:f});const h=await this.model.getAliasColObjMap(this.context,c);let g=z(null==l?void 0:l.sort,h);const y=J(r,h);await(0,S.default)(this,[...this.viewId?[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0})]:[],new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:y,is_group:!0,logical_op:"and"})],f),g||((null===(a=e.sortArr)||void 0===a?void 0:a.length)?g=e.sortArr:this.viewId&&(g=await v.Sort.list(this.context,{viewId:this.viewId})));for(const e of g||[]){if(!d[e.fk_column_id])continue;const t=d[e.fk_column_id];if([_.UITypes.User,_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(t.uidt)){const a=await H(this.context,t,c),i=(await v.BaseUser.getUsersList(this.context,{base_id:t.base_id})).reduce(((e,t)=>this.dbDriver.raw(`REPLACE(${e}, ?, ?)`,[t.id,t.display_name||t.email]).toQuery()),this.dbDriver.raw("??",[a]).toQuery());["asc","desc"].includes(e.direction)?f.orderBy((0,x.sanitize)(this.dbDriver.raw(i)),e.direction,"desc"===e.direction?"LAST":"FIRST"):f.orderBy("count","count-desc"===e.direction?"desc":"asc","count-desc"===e.direction?"LAST":"FIRST")}else["asc","desc"].includes(e.direction)?f.orderBy(G(t),e.direction,"desc"===e.direction?"LAST":"FIRST"):f.orderBy("count","count-desc"===e.direction?"desc":"asc","count-desc"===e.direction?"LAST":"FIRST")}return f.groupBy(...p),Q(f,l),await this.execAndParse(f)}async groupByCount(e){var t,a;const{where:i}=this._getListArgs(e);e.column_name=e.column_name||"";const s=[],r=[],l=(0,P.getAliasGenerator)("__nc_gb"),c=await this.model.getColumns(this.context);await Promise.all(e.column_name.split(",").map((async e=>{let t=c.find((t=>t.column_name===e||t.title===e));if(!t)throw C.NcError.fieldNotFound(e);switch([_.UITypes.QrCode,_.UITypes.Barcode].includes(t.uidt)&&(t=new v.Column(Object.assign(Object.assign({},await t.getColOptions(this.context).then((e=>e.getValueColumn(this.context)))),{asId:t.id}))),t.uidt){case _.UITypes.Attachment:C.NcError.badRequest("Group by using attachment column is not supported");break;case _.UITypes.Button:C.NcError.badRequest("Group by using Button column is not supported");break;case _.UITypes.Rollup:case _.UITypes.Links:s.push((await(0,k.default)({baseModelSqlv2:this,knex:this.dbDriver,columnOptions:await t.getColOptions(this.context)})).builder.as(G(t))),r.push(G(t));break;case _.UITypes.Formula:{let e;try{const a=await this.getSelectQueryBuilderForFormula(t);e=this.dbDriver.raw("?? as ??",[a.builder,G(t)])}catch(a){U.log(a),e=this.dbDriver.raw("'ERR' as ??",[G(t)])}s.push(e),r.push(G(t));break}case _.UITypes.Lookup:case _.UITypes.LinkToAnotherRecord:{const e=await(0,j.default)({baseModelSqlv2:this,column:t,alias:null,model:this.model,getAlias:l}),a=this.dbDriver.raw("?? as ??",[this.dbDriver.raw(e.builder).wrap("(",")"),G(t)]);s.push(a),r.push(G(t))}break;case _.UITypes.CreatedTime:case _.UITypes.LastModifiedTime:case _.UITypes.DateTime:{const e=await H(this.context,t,c);"pg"===this.dbDriver.clientType()?s.push(this.dbDriver.raw("date_trunc('minute', ??) + interval '0 seconds' as ??",[e,G(t)])):"mysql"===this.dbDriver.clientType()||"mysql2"===this.dbDriver.clientType()?s.push(this.dbDriver.raw("CONVERT_TZ(DATE_SUB(??, INTERVAL SECOND(??) SECOND), @@GLOBAL.time_zone, '+00:00') as ??",[e,e,G(t)])):"sqlite3"===this.dbDriver.clientType()?s.push(this.dbDriver.raw("strftime ('%Y-%m-%d %H:%M:00',:column:) ||\n  (\n   CASE WHEN substr(:column:, 20, 1) = '+' THEN\n    printf ('+%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   WHEN substr(:column:, 20, 1) = '-' THEN\n    printf ('-%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   ELSE\n    '+00:00'\n   END) as :id:",{column:e,id:G(t)})):s.push(this.dbDriver.raw("DATE(??) as ??",[e,G(t)])),r.push(G(t))}break;default:{const e=await H(this.context,t,c);s.push(this.dbDriver.raw("?? as ??",[e,G(t)])),r.push(G(t))}}})));const d=this.dbDriver(this.tnPath);d.count(`${(null===(t=this.model.primaryKey)||void 0===t?void 0:t.column_name)||"*"} as count`),d.select(...s);const u=J(i,await this.model.getAliasColObjMap(this.context,c));await(0,S.default)(this,[...this.viewId?[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0})]:[],new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:u,is_group:!0,logical_op:"and"})],d),d.groupBy(...r);const p=this.dbDriver.count("*",{as:"count"}).from(d.as("groupby"));return null===(a=await this.execAndParse(p,null,{raw:!0,first:!0}))||void 0===a?void 0:a.count}async multipleHmList({colId:e,ids:t},a={}){try{const s=[...new Set(t)],r=this._getListArgs(a),{where:c,sort:d}=r,u=i(r,["where","sort"]),p=(await this.model.getColumns(this.context)).find((t=>t.id===e)),m=await(await p.getColOptions(this.context)).getChildColumn(this.context),_=await m.getModel(this.context),f=await(await p.getColOptions(this.context)).getParentColumn(this.context),h=await f.getModel(this.context),g=await v.Model.getBaseModelSQL(this.context,{model:_,dbDriver:this.dbDriver});await h.getColumns(this.context);const y=this.getTnPath(_),b=this.getTnPath(h),w=this.dbDriver(y);await g.selectObject({qb:w,extractPkAndPv:!0,fieldsSet:a.fieldsSet}),await this.applySortAndFilter({table:_,where:c,qb:w,sort:d});const T=this.dbDriver.queryBuilder().from(this.dbDriver.unionAll(s.map((e=>{const t=w.clone().select(this.dbDriver.raw("? as ??",[e,$])).whereIn(m.column_name,this.dbDriver(b).select(f.column_name).where(X(h.primaryKeys,e)));return t.limit(+(null==u?void 0:u.limit)||25),t.offset(+(null==u?void 0:u.offset)||0),this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite).as("list")),k=await this.execAndParse(T,await _.getColumns(this.context)),S=await(await v.Model.getBaseModelSQL(this.context,{id:_.id,dbDriver:this.dbDriver})).getProto();return(0,l.default)(k.map((e=>(e.__proto__=S,e))),$)}catch(e){U.error(e)}}async mmList({colId:e,parentId:t},a={},s=!1){const r=this._getListArgs(a),{where:l,sort:c}=r,d=i(r,["where","sort"]),u=(await this.model.getColumns(this.context)).find((t=>t.id===e)),p=await u.getColOptions(this.context),m=await p.getMMModel(this.context),_=this.getTnPath(m),f=(await p.getMMChildColumn(this.context)).column_name,h=(await p.getMMParentColumn(this.context)).column_name,g=(await p.getParentColumn(this.context)).column_name,y=(await p.getChildColumn(this.context)).column_name,b=await(await p.getParentColumn(this.context)).getModel(this.context),w=await(await p.getChildColumn(this.context)).getModel(this.context);await w.getColumns(this.context);const T=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:b}),k=this.getTnPath(b),S=this.getTnPath(w),M=k,O=b.id,I=this.dbDriver(M).join(_,`${_}.${h}`,`${M}.${g}`).whereIn(`${_}.${f}`,this.dbDriver(S).select(y).where(X(w.primaryKeys,t)));await T.selectObject({qb:I,fieldsSet:a.fieldsSet}),await this.applySortAndFilter({table:b,where:l,qb:I,sort:c}),s||I.limit(+(null==d?void 0:d.limit)||25),I.offset(s?0:+(null==d?void 0:d.offset)||0);const C=await this.execAndParse(I,await b.getColumns(this.context)),E=await(await v.Model.getBaseModelSQL(this.context,{id:O,dbDriver:this.dbDriver})).getProto();return C.map((e=>(e.__proto__=E,e)))}async multipleHmListCount({colId:e,ids:t}){try{const a=(await this.model.getColumns(this.context)).find((t=>t.id===e)),i=await(await a.getColOptions(this.context)).getChildColumn(this.context),s=await i.getModel(this.context),r=await(await a.getColOptions(this.context)).getParentColumn(this.context),l=await r.getModel(this.context);await l.getColumns(this.context);const c=this.getTnPath(s),d=this.getTnPath(l);return(await this.execAndParse(this.dbDriver.unionAll(t.map((e=>{const t=this.dbDriver(c).count(`${null==i?void 0:i.column_name} as count`).whereIn(i.column_name,this.dbDriver(d).select(r.column_name).where(X(l.primaryKeys,e))).first();return this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite),null,{raw:!0})).map((({count:e})=>e))}catch(e){throw e}}async hmList({colId:e,id:t},a={}){try{const s=this._getListArgs(a),{where:r,sort:l}=s,c=i(s,["where","sort"]),d=(await this.model.getColumns(this.context)).find((t=>t.id===e)),u=await(await d.getColOptions(this.context)).getChildColumn(this.context),p=await u.getModel(this.context),m=await(await d.getColOptions(this.context)).getParentColumn(this.context),_=await m.getModel(this.context),f=await v.Model.getBaseModelSQL(this.context,{model:p,dbDriver:this.dbDriver});await _.getColumns(this.context);const h=f.getTnPath(p),g=this.getTnPath(_),y=this.dbDriver(h);await this.applySortAndFilter({table:p,where:r,qb:y,sort:l}),y.whereIn(u.column_name,this.dbDriver(g).select(m.column_name).where(X(_.primaryKeys,t))),y.limit(+(null==c?void 0:c.limit)||25),y.offset(+(null==c?void 0:c.offset)||0),await f.selectObject({qb:y,fieldsSet:a.fieldSet}),await this.applySortAndFilter({table:p,where:r,qb:y,sort:l});const b=await this.execAndParse(y,await p.getColumns(this.context)),w=await(await v.Model.getBaseModelSQL(this.context,{id:p.id,dbDriver:this.dbDriver})).getProto();return b.map((e=>(e.__proto__=w,e)))}catch(e){throw e}}async hmListCount({colId:e,id:t},a){var i;try{const{where:s}=this._getListArgs(a),r=(await this.model.getColumns(this.context)).find((t=>t.id===e)),l=await(await r.getColOptions(this.context)).getChildColumn(this.context),c=await l.getModel(this.context),d=await(await r.getColOptions(this.context)).getParentColumn(this.context),u=await d.getModel(this.context);await u.getColumns(this.context);const p=(await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:c})).getTnPath(c),m=this.getTnPath(u),_=this.dbDriver(p).count(`${null==l?void 0:l.column_name} as count`).whereIn(l.column_name,this.dbDriver(m).select(d.column_name).where(X(u.primaryKeys,t))),f=J(s,await c.getAliasColObjMap(this.context));return await(0,S.default)(this,[new v.Filter({children:f,is_group:!0,logical_op:"and"})],_),null===(i=await this.execAndParse(_,null,{raw:!0,first:!0}))||void 0===i?void 0:i.count}catch(e){throw e}}async multipleMmList({colId:e,parentIds:t},a={}){const s=[...new Set(t)],r=this._getListArgs(a),{where:c,sort:d}=r,u=i(r,["where","sort"]),p=(await this.model.getColumns(this.context)).find((t=>t.id===e)),m=await p.getColOptions(this.context),_=await m.getMMModel(this.context);if(!_)return;const f=this.getTnPath(_),h=(await m.getMMChildColumn(this.context)).column_name,g=(await m.getMMParentColumn(this.context)).column_name,y=(await m.getParentColumn(this.context)).column_name,b=(await m.getChildColumn(this.context)).column_name,w=await(await m.getParentColumn(this.context)).getModel(this.context),T=await(await m.getChildColumn(this.context)).getModel(this.context);await T.getColumns(this.context);const k=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:w}),S=this.getTnPath(w),M=this.getTnPath(T),O=S,I=w.id,C=this.dbDriver(O).join(f,`${f}.${g}`,`${O}.${y}`);await k.selectObject({qb:C,fieldsSet:a.fieldsSet}),await this.applySortAndFilter({table:w,where:c,qb:C,sort:d});const E=this.dbDriver.unionAll(s.map((e=>{const t=C.clone().whereIn(`${f}.${h}`,this.dbDriver(M).select(b).where(X(T.primaryKeys,e))).select(this.dbDriver.raw("? as ??",[e,$]));return t.limit(+(null==u?void 0:u.limit)||25),t.offset(+(null==u?void 0:u.offset)||0),this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite),x=await this.execAndParse(E,await w.getColumns(this.context)),L=await(await v.Model.getBaseModelSQL(this.context,{id:I,dbDriver:this.dbDriver})).getProto(),R=(0,l.default)(x.map((e=>(e.__proto__=L,e))),$);return t.map((e=>R[e]||[]))}async getMmChildrenExcludedListCount({colId:e,pid:t=null},a){var i;const{where:s}=this._getListArgs(a),r=(await this.model.getColumns(this.context)).find((t=>t.id===e)),l=await r.getColOptions(this.context),c=await l.getMMModel(this.context),d=(await v.Model.getBaseModelSQL(this.context,{id:c.id,dbDriver:this.dbDriver})).getTnPath(c),u=(await l.getMMChildColumn(this.context)).column_name,p=(await l.getMMParentColumn(this.context)).column_name,m=(await l.getParentColumn(this.context)).column_name,_=(await l.getChildColumn(this.context)).column_name,f=await(await l.getParentColumn(this.context)).getModel(this.context),h=await l.getChildView(this.context);let g={};if(h){const{dependencyFields:e}=await(0,E.default)(this.context,{model:f,query:{},view:h,throwErrorIfInvalidParams:!1});g=e;try{g.filterArr=JSON.parse(g.filterArrJson)}catch(e){}try{g.sortArr=JSON.parse(g.sortArrJson)}catch(e){}}const y=await(await l.getChildColumn(this.context)).getModel(this.context);await y.getColumns(this.context);const b=await v.Model.getBaseModelSQL(this.context,{id:y.id,dbDriver:this.dbDriver}),w=(await v.Model.getBaseModelSQL(this.context,{id:f.id,dbDriver:this.dbDriver})).getTnPath(f),T=b.getTnPath(y),k=w,S=this.dbDriver(k).count("*",{as:"count"}).where((e=>{e.whereNotIn(m,this.dbDriver(k).select(`${k}.${m}`).join(d,`${k}.${m}`,`${d}.${p}`).whereIn(`${d}.${u}`,this.dbDriver(T).select(_).where(X(y.primaryKeys,t)))).orWhereNull(m)})),M=J(s,await f.getAliasColObjMap(this.context));return await this.getCustomConditionsAndApply({column:r,view:h,filters:M,args:a,qb:S,rowId:t}),null===(i=await this.execAndParse(S,await f.getColumns(this.context),{raw:!0,first:!0}))||void 0===i?void 0:i.count}async multipleMmListCount({colId:e,parentIds:t}){const a=(await this.model.getColumns(this.context)).find((t=>t.id===e)),i=await a.getColOptions(this.context),s=await i.getMMModel(this.context),r=this.getTnPath(s),c=(await i.getMMChildColumn(this.context)).column_name,d=(await i.getMMParentColumn(this.context)).column_name,u=(await i.getParentColumn(this.context)).column_name,p=(await i.getChildColumn(this.context)).column_name,m=await(await i.getParentColumn(this.context)).getModel(this.context),_=await(await i.getChildColumn(this.context)).getModel(this.context);await _.getColumns(this.context);const f=this.getTnPath(m),h=this.getTnPath(_),g=f,y=this.dbDriver(g).join(r,`${r}.${d}`,`${g}.${u}`).count(`${r}.${c}`,{as:"count"}),b=await this.execAndParse(this.dbDriver.unionAll(t.map((e=>{const t=y.clone().whereIn(`${r}.${c}`,this.dbDriver(h).select(p).where(X(_.primaryKeys,e))).select(this.dbDriver.raw("? as ??",[e,$]));return this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite),null,{raw:!0}),w=(0,l.default)(b,$);return t.map((e=>{var t;return(null===(t=null==w?void 0:w[e])||void 0===t?void 0:t[0])||[]}))}async mmListCount({colId:e,parentId:t},a){var i;const{where:s}=this._getListArgs(a),r=(await this.model.getColumns(this.context)).find((t=>t.id===e)),l=await r.getColOptions(this.context),c=await l.getMMModel(this.context),d=(await v.Model.getBaseModelSQL(this.context,{model:c,dbDriver:this.dbDriver})).getTnPath(c),u=(await l.getMMChildColumn(this.context)).column_name,p=(await l.getMMParentColumn(this.context)).column_name,m=(await l.getParentColumn(this.context)).column_name,_=(await l.getChildColumn(this.context)).column_name,f=await(await l.getParentColumn(this.context)).getModel(this.context),h=await(await l.getChildColumn(this.context)).getModel(this.context);await h.getColumns(this.context);const g=(await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:f})).getTnPath(f),y=this.getTnPath(h),b=g,w=this.dbDriver(b).join(d,`${d}.${p}`,`${b}.${m}`).count(`${d}.${u}`,{as:"count"}).whereIn(`${d}.${u}`,this.dbDriver(y).select(_).where(X(h.primaryKeys,t))),T=J(s,await f.getAliasColObjMap(this.context));return await(0,S.default)(this,[new v.Filter({children:T,is_group:!0,logical_op:"and"})],w),null===(i=await this.execAndParse(w,null,{raw:!0,first:!0}))||void 0===i?void 0:i.count}async getMmChildrenExcludedList({colId:e,pid:t=null},a){const s=this._getListArgs(a),{where:r}=s,l=i(s,["where"]),c=(await this.model.getColumns(this.context)).find((t=>t.id===e)),d=await c.getColOptions(this.context),u=await d.getMMModel(this.context),p=(await v.Model.getBaseModelSQL(this.context,{id:u.id,dbDriver:this.dbDriver})).getTnPath(u),m=(await d.getMMChildColumn(this.context)).column_name,_=(await d.getMMParentColumn(this.context)).column_name,f=(await d.getParentColumn(this.context)).column_name,h=(await d.getChildColumn(this.context)).column_name,g=await(await d.getParentColumn(this.context)).getModel(this.context),y=await(await d.getChildColumn(this.context)).getModel(this.context);await y.getColumns(this.context);const b=await v.Model.getBaseModelSQL(this.context,{id:y.id,dbDriver:this.dbDriver}),w=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,id:g.id}),T=w.getTnPath(g),k=b.getTnPath(y),S=await d.getChildView(this.context);let M={};if(S){const{dependencyFields:e}=await(0,E.default)(this.context,{model:g,query:{},view:S,throwErrorIfInvalidParams:!1});M=e}const O=T,I=this.dbDriver(O).where((e=>e.whereNotIn(f,this.dbDriver(O).select(`${O}.${f}`).join(p,`${O}.${f}`,`${p}.${_}`).whereIn(`${p}.${m}`,this.dbDriver(k).select(h).where(X(y.primaryKeys,t)))).orWhereNull(f)));+(null==l?void 0:l.shuffle)&&await this.shuffle({qb:I}),await w.selectObject({qb:I,fieldsSet:null==M?void 0:M.fieldsSet,viewId:null==S?void 0:S.id});const C=J(r,await g.getAliasColObjMap(this.context));await this.getCustomConditionsAndApply({column:c,view:S,filters:C,args:a,qb:I,rowId:t}),g.primaryKey&&g.primaryKey.ai?I.orderBy(g.primaryKey.column_name):g.columns.find((e=>"created_at"===e.column_name))&&I.orderBy("created_at"),Q(I,l);const x=await w.getProto();return(await this.execAndParse(I,await g.getColumns(this.context))).map((e=>(e.__proto__=x,e)))}async getHmChildrenExcludedList({colId:e,pid:t=null},a){const s=this._getListArgs(a),{where:r}=s,l=i(s,["where"]),c=(await this.model.getColumns(this.context)).find((t=>t.id===e)),d=await c.getColOptions(this.context),u=(await d.getChildColumn(this.context)).column_name,p=(await d.getParentColumn(this.context)).column_name,m=await(await d.getChildColumn(this.context)).getModel(this.context),_=await(await d.getParentColumn(this.context)).getModel(this.context),f=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:m}),h=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:_});await _.getColumns(this.context);const g=await d.getChildView(this.context),y=f.getTnPath(m),b=h.getTnPath(_),w=this.dbDriver(y).where((e=>{e.whereNotIn(u,this.dbDriver(b).select(p).where(X(_.primaryKeys,t))).orWhereNull(u)}));+(null==l?void 0:l.shuffle)&&await this.shuffle({qb:w}),await f.selectObject({qb:w});const T=J(r,await m.getAliasColObjMap(this.context));await this.getCustomConditionsAndApply({column:c,view:g,filters:T,args:a,qb:w,rowId:t}),m.primaryKey&&m.primaryKey.ai?w.orderBy(m.primaryKey.column_name):m.columns.find((e=>"created_at"===e.column_name))&&w.orderBy("created_at"),Q(w,l);const k=await f.getProto();return(await this.execAndParse(w,await m.getColumns(this.context))).map((e=>(e.__proto__=k,e)))}async getHmChildrenExcludedListCount({colId:e,pid:t=null},a){var i;const{where:s}=this._getListArgs(a),r=(await this.model.getColumns(this.context)).find((t=>t.id===e)),l=await r.getColOptions(this.context),c=(await l.getChildColumn(this.context)).column_name,d=(await l.getParentColumn(this.context)).column_name,u=await(await l.getChildColumn(this.context)).getModel(this.context),p=await(await l.getParentColumn(this.context)).getModel(this.context),m=await l.getChildView(this.context),_=(await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:u})).getTnPath(u),f=this.getTnPath(p);await p.getColumns(this.context);const h=this.dbDriver(_).count("*",{as:"count"}).where((e=>{e.whereNotIn(c,this.dbDriver(f).select(d).where(X(p.primaryKeys,t))).orWhereNull(c)})),g=J(s,await u.getAliasColObjMap(this.context));return await this.getCustomConditionsAndApply({column:r,view:m,filters:g,args:a,qb:h,rowId:t}),null===(i=await this.execAndParse(h,null,{raw:!0,first:!0}))||void 0===i?void 0:i.count}async getExcludedOneToOneChildrenList({colId:e,cid:t=null},a){var s;const r=this._getListArgs(a),{where:l}=r,c=i(r,["where"]),d=(await this.model.getColumns(this.context)).find((t=>t.id===e)),u=await d.getColOptions(this.context),p=(await u.getParentColumn(this.context)).column_name,m=await(await u.getParentColumn(this.context)).getModel(this.context),_=(await u.getChildColumn(this.context)).column_name,f=await(await u.getChildColumn(this.context)).getModel(this.context),h=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:m}),g=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:f}),y=await u.getChildView(this.context);let b={};if(y){const{dependencyFields:e}=await(0,E.default)(this.context,{model:f,query:{},view:y,throwErrorIfInvalidParams:!1});b=e}const w=this.getTnPath(m),T=this.getTnPath(f);await f.getColumns(this.context);const k=null===(s=d.meta)||void 0===s?void 0:s.bt,S=this.dbDriver(k?w:T).where((e=>{e.whereNotIn(k?p:_,this.dbDriver(k?T:w).select(k?_:p).where(X((k?f:m).primaryKeys,t)).whereNotNull(k?_:p)).orWhereNull(k?p:_)}));+(null==c?void 0:c.shuffle)&&await this.shuffle({qb:S}),await(k?h:g).selectObject({qb:S,fieldsSet:b.fieldsSet,viewId:null==y?void 0:y.id});const M=J(l,await m.getAliasColObjMap(this.context));await this.getCustomConditionsAndApply({column:d,view:y,filters:M,args:a,qb:S,rowId:t}),m.primaryKey&&m.primaryKey.ai?S.orderBy(m.primaryKey.column_name):m.columns.find((e=>"created_at"===e.column_name))&&S.orderBy("created_at"),Q(S,c);const O=await(k?h:g).getProto();return(await this.execAndParse(S,await(k?m:f).getColumns(this.context))).map((e=>(e.__proto__=O,e)))}async getBtChildrenExcludedListCount({colId:e,cid:t=null},a){var i;const{where:s}=this._getListArgs(a),r=(await this.model.getColumns(this.context)).find((t=>t.id===e)),l=await r.getColOptions(this.context),c=(await l.getParentColumn(this.context)).column_name,d=await(await l.getParentColumn(this.context)).getModel(this.context),u=(await l.getChildColumn(this.context)).column_name,p=await(await l.getChildColumn(this.context)).getModel(this.context),m=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:d}),_=this.getTnPath(p),f=m.getTnPath(d),h=_;await p.getColumns(this.context);const g=this.dbDriver(f).where((e=>{e.whereNotIn(c,this.dbDriver(h).select(u).where(X(p.primaryKeys,t)).whereNotNull(u))})).count("*",{as:"count"}),y=J(s,await d.getAliasColObjMap(this.context)),b=await l.getChildView(this.context);return await this.getCustomConditionsAndApply({column:r,view:b,filters:y,args:a,qb:g,rowId:t}),null===(i=await this.execAndParse(g,null,{raw:!0,first:!0}))||void 0===i?void 0:i.count}async countExcludedOneToOneChildren({colId:e,cid:t=null},a){var i,s;const{where:r}=this._getListArgs(a),l=(await this.model.getColumns(this.context)).find((t=>t.id===e)),c=await l.getColOptions(this.context),d=(await c.getParentColumn(this.context)).column_name,u=await(await c.getParentColumn(this.context)).getModel(this.context),p=(await c.getChildColumn(this.context)).column_name,m=await(await c.getChildColumn(this.context)).getModel(this.context),_=await c.getChildView(this.context),f=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:u}),h=(await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:m})).getTnPath(m),g=f.getTnPath(u),y=h;await m.getColumns(this.context);const b=null===(i=l.meta)||void 0===i?void 0:i.bt,w=this.dbDriver(b?g:y).where((e=>{e.whereNotIn(b?d:p,this.dbDriver(b?y:g).select(b?p:d).where(X((b?m:u).primaryKeys,t)).whereNotNull(b?p:d)).orWhereNull(b?d:p)})).count("*",{as:"count"}),T=J(r,await u.getAliasColObjMap(this.context));return await this.getCustomConditionsAndApply({column:l,view:_,filters:T,args:a,qb:w,rowId:t}),null===(s=await this.execAndParse(w,null,{raw:!0,first:!0}))||void 0===s?void 0:s.count}async getBtChildrenExcludedList({colId:e,cid:t=null},a){const s=this._getListArgs(a),{where:r}=s,l=i(s,["where"]),c=(await this.model.getColumns(this.context)).find((t=>t.id===e)),d=await c.getColOptions(this.context),u=(await d.getParentColumn(this.context)).column_name,p=await(await d.getParentColumn(this.context)).getModel(this.context),m=(await d.getChildColumn(this.context)).column_name,_=await(await d.getChildColumn(this.context)).getModel(this.context),f=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:p}),h=this.getTnPath(_),g=f.getTnPath(p),y=h;await _.getColumns(this.context);const b=this.dbDriver(g).where((e=>{e.whereNotIn(u,this.dbDriver(y).select(m).where(X(_.primaryKeys,t)).whereNotNull(m))}));+(null==l?void 0:l.shuffle)&&await this.shuffle({qb:b}),await f.selectObject({qb:b});const w=J(r,await p.getAliasColObjMap(this.context)),T=await d.getChildView(this.context);await this.getCustomConditionsAndApply({column:c,view:T,filters:w,args:a,qb:b,rowId:t}),p.primaryKey&&p.primaryKey.ai?b.orderBy(p.primaryKey.column_name):p.columns.find((e=>"created_at"===e.column_name))&&b.orderBy("created_at"),Q(b,l);const k=await f.getProto();return(await this.execAndParse(b,await p.getColumns(this.context))).map((e=>(e.__proto__=k,e)))}async applySortAndFilter({table:e,view:t,where:a,qb:i,sort:s}){const r=await e.getAliasColObjMap(this.context),l=J(a,r);if(await(0,S.default)(this,[...t?[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:t.id})||[],is_group:!0})]:[],...l],i),!s)return;const c=z(s,r);c&&await(0,M.default)(this,c,i)}async getSelectQueryBuilderForFormula(e,t,a=!1,i={}){const s=await e.getColOptions(this.context);if(s.error)throw new Error(`Formula error: ${s.error}`);return await(0,T.default)(this,s.formula,null,this.model,e,i,t,a)}async getProto(){if(this._proto)return this._proto;const e={__columnAliases:{}},t=await this.model.getColumns(this.context);return await Promise.all(t.map((async t=>{var a,i;switch(t.uidt){case _.UITypes.Lookup:{const i=await t.getColOptions(this.context),s=await v.Column.get(this.context,{colId:i.fk_relation_column_id}),r=s.uidt===_.UITypes.Links?`_nc_lk_${s.title}`:s.title;e.__columnAliases[t.title]={path:[r,null===(a=await v.Column.get(this.context,{colId:i.fk_lookup_column_id}))||void 0===a?void 0:a.title]}}break;case _.UITypes.Links:case _.UITypes.LinkToAnotherRecord:{this._columns[t.title]=t;const a=await t.getColOptions(this.context);if("hm"===(null==a?void 0:a.type)){const a=new c.default((async e=>{if(e.length>1){const i=await this.multipleHmList({colId:t.id,ids:e},a.args);return e.map((e=>i[e]?i[e]:[]))}return[await this.hmList({colId:t.id,id:e[0]},a.args)]}),{cache:!1}),i=this;e[t.uidt===_.UITypes.Links?`_nc_lk_${t.title}`:t.title]=async function(e){return a.args=e,a.load(Z(i.model.primaryKeys,this))}}else if("mm"===a.type){const a=new c.default((async e=>{if((null==e?void 0:e.length)>1){return await this.multipleMmList({parentIds:e,colId:t.id},a.args)}return[await this.mmList({parentId:e[0],colId:t.id},a.args)]}),{cache:!1}),i=this;e[t.uidt===_.UITypes.Links?`_nc_lk_${t.title}`:t.title]=async function(e){return a.args=e,await a.load(Z(i.model.primaryKeys,this))}}else if("bt"===a.type){const a=await t.getColOptions(this.context),i=await v.Column.get(this.context,{colId:a.fk_parent_column_id}),s=await v.Column.get(this.context,{colId:a.fk_child_column_id}),r=new c.default((async e=>{var t;const a=e.map((e=>{if("binary(16)"!==i.ct)return e;const t=e+"",a=36===t.length||32===t.length?32===t.length?t.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5"):t:null;return a?Buffer.from(a.replace(/-/g,""),"hex"):e})),s=await(await v.Model.getBaseModelSQL(this.context,{id:i.fk_model_id,dbDriver:this.dbDriver})).list({fieldsSet:null===(t=r.args)||void 0===t?void 0:t.fieldsSet,filterArr:[new v.Filter({id:null,fk_column_id:i.id,fk_model_id:i.fk_model_id,value:a,comparison_op:"in"})]},{ignoreViewFilterAndSort:!0,ignorePagination:!0}),c=(0,l.default)(s,i.title);return e.map((async e=>{var t;return null===(t=null==c?void 0:c[e])||void 0===t?void 0:t[0]}))}),{cache:!1});e[t.title]=async function(e){return null===(null==this?void 0:this[null==s?void 0:s.title])||void 0===(null==this?void 0:this[null==s?void 0:s.title])?null:(r.args=e,await r.load(null==this?void 0:this[null==s?void 0:s.title]))}}else if("oo"===a.type){if(null===(i=t.meta)||void 0===i?void 0:i.bt){const a=await t.getColOptions(this.context),i=await v.Column.get(this.context,{colId:a.fk_parent_column_id}),s=await v.Column.get(this.context,{colId:a.fk_child_column_id}),r=new c.default((async e=>{var t;const a=e.map((e=>{if("binary(16)"!==i.ct)return e;const t=e+"",a=36===t.length||32===t.length?32===t.length?t.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5"):t:null;return a?Buffer.from(a.replace(/-/g,""),"hex"):e})),s=await(await v.Model.getBaseModelSQL(this.context,{id:i.fk_model_id,dbDriver:this.dbDriver})).list({fieldsSet:null===(t=r.args)||void 0===t?void 0:t.fieldsSet,filterArr:[new v.Filter({id:null,fk_column_id:i.id,fk_model_id:i.fk_model_id,value:a,comparison_op:"in"})]},{ignoreViewFilterAndSort:!0,ignorePagination:!0}),c=(0,l.default)(s,i.title);return e.map((async e=>{var t;return null===(t=null==c?void 0:c[e])||void 0===t?void 0:t[0]}))}),{cache:!1});e[t.title]=async function(e){return null===(null==this?void 0:this[null==s?void 0:s.title])||void 0===(null==this?void 0:this[null==s?void 0:s.title])?null:(r.args=e,await r.load(null==this?void 0:this[null==s?void 0:s.title]))}}else{const a=new c.default((async e=>{var i,s;if(e.length>1){const i=await this.multipleHmList({colId:t.id,ids:e},a.args);return e.map((e=>{var t;return i[e]?null===(t=i[e])||void 0===t?void 0:t[0]:null}))}return[null!==(s=null===(i=await this.hmList({colId:t.id,id:e[0]},a.args))||void 0===i?void 0:i[0])&&void 0!==s?s:null]}),{cache:!1}),i=this;e[t.uidt===_.UITypes.Links?`_nc_lk_${t.title}`:t.title]=async function(e){return a.args=e,a.load(Z(i.model.primaryKeys,this))}}}}}}))),this._proto=e,e}_getListArgs(e){const t=(0,I.extractLimitAndOffset)(e);return t.where=e.filter||e.where||e.w||"",t.having=e.having||e.h||"",t.shuffle=e.shuffle||e.r||"",t.condition=e.condition||e.c||{},t.conditionGraph=e.conditionGraph||{},t.limit=Math.max(Math.min(Math.max(+(e.limit||e.l),0)||BaseModelSqlv2.config.limitDefault,BaseModelSqlv2.config.limitMax),BaseModelSqlv2.config.limitMin),t.offset=Math.max(+(e.offset||e.o)||0,0),t.fields=e.fields||e.f,t.sort=e.sort||e.s,t.pks=e.pks,t.aggregation=e.aggregation||[],t.column_name=e.column_name,t}async shuffle({qb:e}){this.isMySQL?e.orderByRaw("RAND()"):this.isPg||this.isSqlite?e.orderByRaw("RANDOM()"):this.isMssql&&e.orderByRaw("NEWID()")}async selectObject({qb:e,columns:t,fields:a,extractPkAndPv:i,viewId:s,fieldsSet:r,alias:l,validateFormula:c}){var d;const u={};let p;const m={};let f,h;if(null==r?void 0:r.size)p=t||await this.model.getColumns(this.context);else{f=await v.View.get(this.context,s);const e=s&&await v.View.getColumns(this.context,s);h=Array.isArray(a)?a:null==a?void 0:a.split(","),p=e||t||await this.model.getColumns(this.context)}for(const a of p){const s=a instanceof v.Column?a:await v.Column.get(this.context,{colId:a.fk_column_id});if(!te(r,a,f,s,i)&&V(s,h,i))switch(s.uidt){case _.UITypes.CreatedTime:case _.UITypes.LastModifiedTime:case _.UITypes.DateTime:{const e=await H(this.context,s,t||await this.model.getColumns(this.context));if(this.isMySQL){m[(0,x.sanitize)(G(s)||e)]=this.dbDriver.raw("CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00')",[`${(0,x.sanitize)(l||this.tnPath)}.${e}`]);break}if(this.isPg){if("timestamp with time zone"!==s.dt&&"timestamptz"!==s.dt){m[(0,x.sanitize)(G(s)||e)]=this.dbDriver.raw("?? AT TIME ZONE CURRENT_SETTING('timezone') AT TIME ZONE 'UTC'",[`${(0,x.sanitize)(l||this.tnPath)}.${e}`]).wrap("(",")");break}}else if(this.isMssql&&"datetimeoffset"!==s.dt){m[(0,x.sanitize)(G(s)||e)]=this.dbDriver.raw("CONVERT(DATETIMEOFFSET, ?? AT TIME ZONE 'UTC')",[`${(0,x.sanitize)(l||this.tnPath)}.${e}`]);break}m[(0,x.sanitize)(G(s)||e)]=(0,x.sanitize)(`${l||this.tnPath}.${e}`)}break;case _.UITypes.LinkToAnotherRecord:case _.UITypes.Lookup:break;case _.UITypes.QrCode:{const t=await s.getColOptions(this.context);if(!t.fk_qr_value_column_id){e.select(this.dbDriver.raw("? as ??",["ERR!",G(s)]));break}const a=await v.Column.get(this.context,{colId:t.fk_qr_value_column_id});if(null==a)break;if(a.uidt===_.UITypes.Formula)try{const t=await this.getSelectQueryBuilderForFormula(a,l,c,u);e.select({[s.column_name]:t.builder})}catch(e){continue}else e.select({[s.column_name]:a.column_name});break}case _.UITypes.Barcode:{const t=await s.getColOptions(this.context);if(!t.fk_barcode_value_column_id){e.select(this.dbDriver.raw("? as ??",["ERR!",G(s)]));break}const a=await v.Column.get(this.context,{colId:t.fk_barcode_value_column_id});if(null==a)break;if(a.uidt===_.UITypes.Formula)try{const t=await this.getSelectQueryBuilderForFormula(a,l,c,u);e.select({[G(s)]:t.builder})}catch(e){continue}else e.select({[G(s)]:a.column_name});break}case _.UITypes.Formula:try{const t=await this.getSelectQueryBuilderForFormula(s,l,c,u);e.select(this.dbDriver.raw("?? as ??",[t.builder,G(s)]))}catch(t){U.log(t),e.select(this.dbDriver.raw("'ERR' as ??",[G(s)]))}break;case _.UITypes.Button:try{const t=s.colOptions;if("url"===t.type){const a=await this.getSelectQueryBuilderForFormula(s,l,c,u);switch(this.dbDriver.client.config.client){case"mysql2":e.select(this.dbDriver.raw("JSON_OBJECT('type', ? , 'label', ?, 'url', ??) as ??",[t.type,`${t.label}`,a.builder,G(s)]));break;case"pg":e.select(this.dbDriver.raw("json_build_object('type', ? ,'label', ?, 'url', ??) as ??",[t.type,`${t.label}`,a.builder,G(s)]));break;case"sqlite3":e.select(this.dbDriver.raw("json_object('type', ?, 'label', ?, 'url', ??) as ??",[t.type,`${t.label}`,a.builder,G(s)]));break;default:e.select(this.dbDriver.raw("'ERR' as ??",[G(s)]))}}else if("webhook"===t.type)switch(this.dbDriver.client.config.client){case"mysql2":e.select(this.dbDriver.raw("JSON_OBJECT('type', ?, 'label', ?, 'fk_webhook_id', ?) as ??",[t.type,`${t.label}`,t.fk_webhook_id,G(s)]));break;case"pg":e.select(this.dbDriver.raw("json_build_object('type', ?, 'label', ?, 'fk_webhook_id', ?) as ??",[t.type,`${t.label}`,t.fk_webhook_id,G(s)]));break;case"sqlite3":e.select(this.dbDriver.raw("json_object('type', ?, 'label', ?, 'fk_webhook_id', ?) as ??",[t.type,`${t.label}`,t.fk_webhook_id,G(s)]));break;default:e.select(this.dbDriver.raw("'ERR' as ??",[G(s)]))}}catch(t){U.log(t),e.select(this.dbDriver.raw("'ERR' as ??",[G(s)]))}break;case _.UITypes.Rollup:case _.UITypes.Links:e.select((await(0,k.default)({baseModelSqlv2:this,knex:this.dbDriver,alias:l,columnOptions:await s.getColOptions(this.context)})).builder.as(G(s)));break;case _.UITypes.CreatedBy:case _.UITypes.LastModifiedBy:{const e=await H(this.context,s,t||await this.model.getColumns(this.context));m[(0,x.sanitize)(G(s)||e)]=(0,x.sanitize)(`${l||this.tnPath}.${e}`);break}default:if(this.isPg&&"bytea"===s.dt){m[(0,x.sanitize)(G(s)||s.column_name)]=this.dbDriver.raw(`encode(??.??, '${"hex"===(null===(d=s.meta)||void 0===d?void 0:d.format)?"hex":"escape"}')`,[l||this.model.table_name,s.column_name]);break}m[(0,x.sanitize)(G(s)||s.column_name)]=(0,x.sanitize)(`${l||this.tnPath}.${s.column_name}`)}}e.select(m)}async insert(e,t,a,i=!1){var s,r,l,c,d;try{const i=await this.model.getColumns(this.context);for(const t of i)if(t.ai){const a=void 0!==(null==e?void 0:e[t.column_name])?t.column_name:t.title;e[a]&&delete e[a]}await F(this.context,this.model,e);const u=await this.model.mapAliasToColumn(this.context,e,this.clientMeta,this.dbDriver,i);let p;await this.validate(u,i),"beforeInsert"in this&&await this.beforeInsert(u,t,a),await this.prepareNocoData(u,!0,a);const m=this.dbDriver(this.tnPath).insert(u);(this.isPg||this.isMssql)&&this.model.primaryKey&&(m.returning(`${this.model.primaryKey.column_name} as ${this.model.primaryKey.id}`),p=await this.execAndParse(m,null,{raw:!0}));const _=this.model.columns.find((e=>e.ai));let f;if(_||(f=this.model.columns.find((e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.ag}))),f)p||await this.execAndParse(m),p=await this.readByPk(this.extractCompositePK({rowId:u[f.column_name],insertObj:u,ag:f,ai:_}),!1,{},{ignoreView:!0,getHiddenColumn:!0});else if(!p||"object"!=typeof(null==p?void 0:p[0])&&null!==(null==p?void 0:p[0])){let t;if(null==p?void 0:p.length)t=p[0];else{const e=await this.execAndParse(m,null,{raw:!0});t=null!==(l=null!==(s=null==e?void 0:e.id)&&void 0!==s?s:null===(r=e[0])||void 0===r?void 0:r.insertId)&&void 0!==l?l:e}_?(this.isSqlite?t=null===(c=await this.execAndParse(this.dbDriver(this.tnPath).select(_.column_name).max(_.column_name,{as:"__nc_ai_id"}),null,{raw:!0,first:!0}))||void 0===c?void 0:c.__nc_ai_id:(this.isSnowflake||this.isDatabricks)&&(t=(await this.execAndParse(this.dbDriver(this.tnPath).max(_.column_name,{as:"__nc_ai_id"}),null,{raw:!0,first:!0})).__nc_ai_id),p=await this.readByPk(this.extractCompositePK({rowId:t,insertObj:u,ag:f,ai:_}),!1,{},{ignoreView:!0,getHiddenColumn:!0})):p=e}else if(_){const e=Array.isArray(p)?null===(d=null==p?void 0:p[0])||void 0===d?void 0:d[_.id]:null==p?void 0:p[_.id];p=await this.readByPk(this.extractCompositePK({rowId:e,insertObj:u,ag:f,ai:_}),!1,{},{ignoreView:!0,getHiddenColumn:!0})}return await this.afterInsert(p,t,a),Array.isArray(p)?p[0]:p}catch(i){throw await this.errorInsert(i,e,t,a),i}}async delByPk(e,t,a){let i=t;try{const s=await this.getSource(),r=await this.readRecord({idOrRecord:e,validateFormula:!1,ignoreView:!0,getHiddenColumn:!0,source:s});await this.beforeDelete(e,i,a);const l=[];for(const t of this.model.columns){if(t.uidt!==_.UITypes.LinkToAnotherRecord)continue;const a=await t.getColOptions(this.context);switch(a.type){case"mm":{const t=await v.Model.get(this.context,a.fk_mm_model_id),i=await v.Column.get(this.context,{colId:a.fk_mm_child_column_id});l.push((a=>a(this.getTnPath(t.table_name)).del().where(i.column_name,e)))}break;case"hm":{const t=await a.getRelatedTable(this.context);if(t.mm)break;const i=await v.Column.get(this.context,{colId:a.fk_child_column_id});l.push((a=>a(this.getTnPath(t.table_name)).update({[i.column_name]:null}).where(i.column_name,e)))}}}const c=await this._wherePk(e);i||(i=await this.dbDriver.transaction()),await Promise.all(l.map((e=>e(i))));const d=await i(this.tnPath).del().where(c);return t||await i.commit(),await this.clearFileReferences({oldData:r,columns:this.model.columns}),await this.afterDelete(r,i,a),d}catch(s){throw t||await i.rollback(),await this.errorDelete(s,e,i,a),s}}async hasLTARData(e,t){const a=[],i=(await t.getColumns(this.context)).filter((e=>e.uidt===_.UITypes.LinkToAnotherRecord));let s=0;for(const r of i){const i=await r.getColOptions(this.context),l=await i.getChildColumn(this.context),c=await i.getParentColumn(this.context),d=await l.getModel(this.context);await d.getColumns(this.context);const u=await c.getModel(this.context);await u.getColumns(this.context);let p=0;if(i.type===_.RelationTypes.HAS_MANY)p=+(await this.execAndParse(this.dbDriver(this.getTnPath(d.table_name)).count(l.column_name,{as:"cnt"}).where(l.column_name,e),null,{raw:!0,first:!0})).cnt;else if(i.type===_.RelationTypes.MANY_TO_MANY){const t=await i.getMMModel(this.context),a=await i.getMMChildColumn(this.context);p=+(await this.execAndParse(this.dbDriver(this.getTnPath(t.table_name)).where(`${this.getTnPath(t.table_name)}.${a.column_name}`,e).count(a.column_name,{as:"cnt"}),null,{first:!0})).cnt}p&&a.push(`${1+s++}. ${t.title}.${r.title} is a LinkToAnotherRecord of ${d.title}`)}return a}async updateByPk(e,t,a,i,s=!1){try{const s=await this.model.getColumns(this.context),r=await this.model.mapAliasToColumn(this.context,t,this.clientMeta,this.dbDriver,s);await this.validate(t,s),await this.beforeUpdate(t,a,i);const l=s.find((e=>e.uidt===_.UITypes.ForeignKey&&void 0!==t[e.column_name])),c=l?s.find((e=>{var t;return e.uidt===_.UITypes.LinkToAnotherRecord&&(null===(t=e.colOptions)||void 0===t?void 0:t.fk_child_column_id)===l.id})):null,d=await this.readByPk(e,!1,{},{ignoreView:!0,getHiddenColumn:!0});d||C.NcError.recordNotFound(e),await this.prepareNocoData(r,!1,i,d);const u=this.dbDriver(this.tnPath).update(r).where(await this._wherePk(e,!0));await this.execAndParse(u,null,{raw:!0});const p=this.extractPksValues(Object.assign(Object.assign({},d),r),!0),m=await this.readByPk(p,!1,{},{ignoreView:!0,getHiddenColumn:!0});return c&&1===Object.keys(t||{}).length?await this.addChild({colId:c.id,rowId:p,childId:r[l.title],cookie:i,onlyUpdateAuditLogs:!0,prevData:d}):await this.afterUpdate(d,m,a,i,r),m}catch(e){throw await this.errorUpdate(e,t,a,i),e}}async _wherePk(e,t=!1,a=!1){return t||await this.model.getColumns(this.context),X(this.model.primaryKeys,e,a)}comparePks(e,t){return B(e)||B(t)?`${e}`==`${t}`:(0,m.default)(e,t)}getTnPath(e,t){var a,i;const s="string"==typeof e?e:e.table_name,r=null===(i=(a=this.dbDriver).searchPath)||void 0===i?void 0:i.call(a);return this.isPg&&this.schema?`${this.schema}.${s}${t?` as ${t}`:""}`:this.isMssql&&r?this.dbDriver.raw("??.??"+(t?" as ??":""),[r,s,...t?[t]:[]]):this.isSnowflake?`${[this.dbDriver.client.config.connection.database,this.dbDriver.client.config.connection.schema,s].join(".")}${t?` as ${t}`:""}`:`${s}${t?` as ${t}`:""}`}get tnPath(){return this.getTnPath(this.model)}get clientMeta(){return{isSqlite:this.isSqlite,isMssql:this.isMssql,isPg:this.isPg,isMySQL:this.isMySQL}}get isSqlite(){return"sqlite3"===this.clientType}get isMssql(){return"mssql"===this.clientType}get isPg(){return"pg"===this.clientType}get isMySQL(){return"mysql2"===this.clientType||"mysql"===this.clientType}get isSnowflake(){return"snowflake"===this.clientType}get isDatabricks(){return"databricks"===this.clientType}get clientType(){return this.dbDriver.clientType()}async readRecord(e){return this.readByPk(e.idOrRecord,!1,{},{ignoreView:e.ignoreView,getHiddenColumn:e.getHiddenColumn})}async nestedInsert(e,t=null,a){var i,s,r,l,c,d;try{const t=await this.getSource();await F(this.context,this.model,e);const u=await this.model.getColumns(this.context),p=await this.model.mapAliasToColumn(this.context,e,this.clientMeta,this.dbDriver,u);let m=null;const f=u.filter((e=>(0,_.isLinksOrLTAR)(e))),{postInsertOps:h,preInsertOps:g}=await this.prepareNestedLinkQb({nestedCols:f,data:e,insertObj:p});let y;await this.validate(p,u),await this.beforeInsert(p,this.dbDriver,a),await this.prepareNocoData(p,!0,a),await this.runOps(g.map((e=>e())));const b=this.dbDriver(this.tnPath).insert(p);(this.isPg||this.isMssql)&&(b.returning(`${this.model.primaryKey.column_name} as ${this.model.primaryKey.id}`),y=await this.execAndParse(b,null,{raw:!0}));const w=this.model.columns.find((e=>e.ai));let v;return w||(v=this.model.columns.find((e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.ag}))),v?(m=p[v.column_name],y||await this.execAndParse(b),y=await this.readRecord({idOrRecord:p[v.column_name],ignoreView:!0,getHiddenColumn:!0,validateFormula:!1,source:t})):!y||"object"!=typeof(null==y?void 0:y[0])&&null!==(null==y?void 0:y[0])?((null==y?void 0:y.length)?m=y[0]:(m=await this.execAndParse(b,null,{raw:!0}),m=null!==(r=null!==(i=m.id)&&void 0!==i?i:null===(s=m[0])||void 0===s?void 0:s.insertId)&&void 0!==r?r:m),w?this.isSqlite?m=null===(l=await this.execAndParse(this.dbDriver(this.tnPath).select(w.column_name).max(w.column_name,{as:"__nc_ai_id"}),null,{raw:!0,first:!0}))||void 0===l?void 0:l.__nc_ai_id:(this.isSnowflake||this.isDatabricks)&&(m=null===(c=await this.execAndParse(this.dbDriver(this.tnPath).max(w.column_name,{as:"__nc_ai_id"}),null,{raw:!0,first:!0}))||void 0===c?void 0:c.__nc_ai_id):y=e):w&&(m=Array.isArray(y)?null===(d=null==y?void 0:y[0])||void 0===d?void 0:d[w.id]:null==y?void 0:y[w.id]),m=this.extractCompositePK({ai:w,ag:v,rowId:m,insertObj:p}),await this.runOps(h.map((e=>e(m)))),null!=m&&(y=await this.readRecord({idOrRecord:m,validateFormula:!1,ignoreView:!0,getHiddenColumn:!0,source:t})),await this.afterInsert(y,this.dbDriver,a),y}catch(e){throw e}}extractCompositePK({ai:e,ag:t,rowId:a,insertObj:i,force:s=!1}){var r,l,c,d;if(t)return null!==(r=i[t.column_name])&&void 0!==r?r:a;if(e&&(s||(null===(l=this.model.primaryKeys)||void 0===l?void 0:l.length)>1)){const t={};for(const s of this.model.primaryKeys){const r=s.title;e&&s.id===e.id&&null!=a?t[r]=a:t[r]=null!==(c=i[s.column_name])&&void 0!==c?c:null}a=t}else if(!e&&!t&&i)return 1===this.model.primaryKeys.length?null!==(d=i[this.model.primaryKey.column_name])&&void 0!==d?d:null:this.model.primaryKeys.reduce(((e,t)=>{var a;return e[t.title]=null!==(a=i[t.column_name])&&void 0!==a?a:null,e}),{});return a}async prepareNestedLinkQb({nestedCols:e,data:t,insertObj:a}){var i,s;const r=[],l=[];for(const c of e)if(c.title in t){const e=await c.getColOptions(this.context);let d;try{d="string"==typeof t[c.title]?JSON.parse(t[c.title]):t[c.title]}catch(e){continue}switch(e.type){case _.RelationTypes.BELONGS_TO:{if("object"!=typeof d)continue;const t=await e.getChildColumn(this.context),i=await e.getParentColumn(this.context);a[t.column_name]=null==d?void 0:d[i.title]}break;case _.RelationTypes.ONE_TO_ONE:{const t=null===(i=c.meta)||void 0===i?void 0:i.bt,u=await e.getChildColumn(this.context),p=await u.getModel(this.context);if(await p.getColumns(this.context),t){const t=Array.isArray(d)?null===(s=d[0])||void 0===s?void 0:s[p.primaryKey.title]:d[p.primaryKey.title];if(l.push((async()=>this.dbDriver(this.getTnPath(p.table_name)).update({[i.column_name]:null}).where(i.column_name,t).toQuery())),"object"!=typeof d)continue;const i=await e.getChildColumn(this.context),r=await e.getParentColumn(this.context);a[i.column_name]=null==d?void 0:d[r.title]}else{const t=await e.getParentColumn(this.context),a=await t.getModel(this.context);await a.getColumns(this.context),r.push((async e=>{let i=e;return a.primaryKey.id!==t.id&&(i=this.dbDriver(this.getTnPath(a.table_name)).select(t.column_name).where(a.primaryKey.column_name,e).first()),this.dbDriver(this.getTnPath(p.table_name)).update({[u.column_name]:i}).where(p.primaryKey.column_name,d[p.primaryKey.title]).toQuery()}))}}break;case _.RelationTypes.HAS_MANY:{if(!Array.isArray(d))continue;const t=await e.getChildColumn(this.context),a=await e.getParentColumn(this.context),i=await t.getModel(this.context),s=await a.getModel(this.context);await i.getColumns(this.context),await s.getColumns(this.context),r.push((async e=>{let r=e;return s.primaryKey.id!==a.id&&(r=this.dbDriver(this.getTnPath(s.table_name)).select(a.column_name).where(s.primaryKey.column_name,e).first()),this.dbDriver(this.getTnPath(i.table_name)).update({[t.column_name]:r}).whereIn(i.primaryKey.column_name,null==d?void 0:d.map((e=>e[i.primaryKey.title]))).toQuery()}))}break;case _.RelationTypes.MANY_TO_MANY:if(!Array.isArray(d))continue;r.push((async t=>{const a=await e.getParentColumn(this.context).then((e=>e.getModel(this.context)));await a.getColumns(this.context);const i=await e.getMMParentColumn(this.context),s=await e.getMMChildColumn(this.context),r=await e.getMMModel(this.context),l=d.map((e=>({[i.column_name]:e[a.primaryKey.title],[s.column_name]:t})));return this.dbDriver(this.getTnPath(r.table_name)).insert(l).toQuery()}))}}return{postInsertOps:r,preInsertOps:l}}async bulkInsert(e,{chunkSize:t=100,cookie:a,foreign_key_checks:i=!0,skip_hooks:s=!1,raw:r=!1,insertOneByOneAsFallback:l=!1,isSingleRecordInsertion:c=!1,allowSystemColumn:u=!1}={}){var p,m,h,g,b;let w;try{const v=r?e:[];let T,k,S=[],M=[];if(r)await this.model.getColumns(this.context),await Promise.all(v.map((e=>this.prepareNocoData(e,!0,a))));else{const t=(await this.model.getColumns(this.context)).filter((e=>(0,_.isLinksOrLTAR)(e)));for(const i of e){const e={};for(let t=0;t<this.model.columns.length;++t){const a=this.model.columns[t];if(a.title in i&&(((0,_.isCreatedOrLastModifiedTimeCol)(a)||(0,_.isCreatedOrLastModifiedByCol)(a))&&C.NcError.badRequest(`Column "${a.title}" is auto generated and cannot be updated`),a.system&&!u&&a.uidt!==_.UITypes.ForeignKey&&C.NcError.badRequest(`Column "${a.title}" is system column and cannot be updated`)),a.pk&&(null===(p=a.meta)||void 0===p?void 0:p.ag)&&!i[a.title]&&(i[a.title]="nc"===(null===(m=a.meta)||void 0===m?void 0:m.ag)?`rc_${Y()}`:(0,y.v4)()),!(0,_.isVirtualCol)(a)){let t=void 0!==(null==i?void 0:i[a.column_name])?null==i?void 0:i[a.column_name]:null==i?void 0:i[a.title];if(void 0!==t){if(a.uidt===_.UITypes.Attachment&&"string"!=typeof t&&(t=JSON.stringify(t)),a.uidt===_.UITypes.DateTime&&(0,d.default)(t).isValid()){const{isMySQL:e,isSqlite:a,isMssql:i,isPg:s}=this.clientMeta;t.indexOf("-")<0&&t.indexOf("+")<0&&"Z"!==t.slice(-1)&&(t+="+00:00"),t=e?this.dbDriver.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,d.default)(t).utc().format("YYYY-MM-DD HH:mm:ss")]):a?(0,d.default)(t).utc().format("YYYY-MM-DD HH:mm:ssZ"):s?this.dbDriver.raw("? AT TIME ZONE CURRENT_SETTING('timezone')",[(0,d.default)(t).utc().format("YYYY-MM-DD HH:mm:ssZ")]):i?this.dbDriver.raw("SWITCHOFFSET(CONVERT(datetimeoffset, ?), DATENAME(TzOffset, SYSDATETIMEOFFSET()))",[(0,d.default)(t).utc().format("YYYY-MM-DD HH:mm:ssZ")]):(0,d.default)(t).utc().format("YYYY-MM-DD HH:mm:ssZ")}e[(0,x.sanitize)(a.column_name)]=t}}if(await this.validateOptions(a,e),(null===(h=null==a?void 0:a.meta)||void 0===h?void 0:h.validate)&&(null==a?void 0:a.validate)){const t=a.getValidators(),i=a.column_name,s=a.title;if(t){const{func:a,msg:r}=t;for(let t=0;t<a.length;++t){const l="string"==typeof a[t]?O.customValidators[a[t]]?O.customValidators[a[t]]:f.default[a[t]]:a[t],c=(null==e?void 0:e[i])||(null==e?void 0:e[s]),d="string"==typeof a[t]?c+"":c;[null,void 0,""].includes(c)||("AsyncFunction"===l.constructor.name?await l(d):l(d))||C.NcError.badRequest(r[t].replace(/\{VALUE}/g,c).replace(/\{cn}/g,s))}}}}if(await this.prepareNocoData(e,!0,a),c){const a=await this.prepareNestedLinkQb({nestedCols:t,data:i,insertObj:e});S=a.postInsertOps,M=a.preInsertOps}v.push(e)}T=this.model.primaryKeys.find((e=>e.ai)),k=this.model.primaryKeys.find((e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.ag}))}"beforeBulkInsert"in this&&await this.beforeBulkInsert(v,w,a);const I=this.isSqlite?10:t;let E;if(w=await this.dbDriver.transaction(),i||(this.isPg?await w.raw("set session_replication_role to replica;"):this.isMySQL&&await w.raw("SET foreign_key_checks = 0;")),await this.runOps(M.map((e=>e())),w),l&&(this.isSqlite||this.isMySQL)){E=[];for(const e of v){const t=w(this.tnPath).insert(e);let a=(await t)[0];k&&(a=e[k.column_name]),E.push(this.extractCompositePK({rowId:a,ai:T,ag:k,insertObj:e,force:!0})||e)}}else{const e={};for(const t of this.model.primaryKeys)e[t.title]=t.column_name;E=r||!this.isPg&&!this.isMssql?await w.batchInsert(this.tnPath,v,I):await w.batchInsert(this.tnPath,v,I).returning((null===(g=this.model.primaryKeys)||void 0===g?void 0:g.length)?e:"*")}if(i||(this.isPg?await w.raw("set session_replication_role to origin;"):this.isMySQL&&await w.raw("SET foreign_key_checks = 1;")),c){let e=E[0][null===(b=this.model.primaryKey)||void 0===b?void 0:b.title];(T||k)&&(e=this.extractCompositePK({rowId:e,ai:T,ag:k,insertObj:v[0]})),await this.runOps(S.map((t=>t(e))),w)}if(await w.commit(),!r&&!s)if(c){const e=await this.readByPk(E[0]);await this.afterInsert(e,this.dbDriver,a)}else await this.afterBulkInsert(v,this.dbDriver,a);return E}catch(e){throw await(null==w?void 0:w.rollback()),e}}async bulkUpdate(e,{cookie:t,raw:a=!1,throwExceptionIfNotExist:i=!1,isSingleRecordUpdation:s=!1}={}){let r;try{const l=await this.model.getColumns(this.context);if(!a)for(const t of e)await this.validate(t,l);const c=a?e:await Promise.all(e.map((e=>this.model.mapAliasToColumn(this.context,e,this.clientMeta,this.dbDriver,l)))),d=[],u=[],p=[],m=[],_=[],f=100;for(const[e,s]of c.entries()){const r=Z(this.model.primaryKeys,this.extractPksValues(s));if(r){if(a){await this.prepareNocoData(s,!1,t);const e=await this._wherePk(r,!0);m.push({d:s,wherePk:e}),p.push(Z(this.model.primaryKeys,Object.assign(Object.assign({},r),s)))}else if(_.push({pk:r,data:s}),_.length>=f||e===c.length-1){const e=_.splice(0,_.length),a=await this.list({pks:e.map((e=>e.pk)).join(",")},{limitOverride:e.length,ignoreViewFilterAndSort:!0});for(const s of e){const e=a.find((e=>this.comparePks(this.extractPksValues(e),s.pk)));e?(await this.prepareNocoData(s.data,!1,t,e),d.push(e)):i&&C.NcError.recordNotFound(s)}for(let t=0;t<e.length;t++){const{pk:a,data:i}=e[t],s=await this._wherePk(a,!0);m.push({d:i,wherePk:s}),p.push(Z(this.model.primaryKeys,Object.assign(Object.assign({},d[t]),i)))}}}else i&&C.NcError.recordNotFound(r)}r=await this.dbDriver.transaction();for(const e of m)await r(this.tnPath).update(e.d).where(e.wherePk);if(await r.commit(),!a)for(;p.length;){const e=await this.list({pks:p.splice(0,f).join(",")},{limitOverride:f});u.push(...e)}return a||(s?await this.afterUpdate(d[0],u[0],null,t,e[0]):await this.afterBulkUpdate(d,u,this.dbDriver,t)),u}catch(e){throw r&&await r.rollback(),e}}async bulkUpdateAll(e={},t,{cookie:a}={}){var i;try{let s=0;const r=await this.model.getColumns(this.context),l=await this.model.mapAliasToColumn(this.context,t,this.clientMeta,this.dbDriver,r);e.skipValidationAndHooks||await this.validate(l,r);for(const e of r)e.uidt===_.UITypes.Attachment&&l[e.column_name]&&C.NcError.notImplemented("Attachment bulk update all");await this.prepareNocoData(l,!1,a);const c=this.extractPksValues(l);if(null!=c);else{const{where:t}=this._getListArgs(e),a=this.dbDriver(this.tnPath),c=J(t,await this.model.getAliasColObjMap(this.context,r),!0),d=[new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:c,is_group:!0,logical_op:"and"})];e.viewId&&d.push(new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:e.viewId})||[],is_group:!0})),await(0,S.default)(this,d,a,void 0,!0),s=null===(i=await this.execAndParse(a.clone().count("*",{as:"count"}),null,{raw:!0,first:!0}))||void 0===i?void 0:i.count,a.update(l),await this.execAndParse(a,null,{raw:!0})}return e.skipValidationAndHooks||await this.afterBulkUpdate(null,s,this.dbDriver,a,!0),s}catch(e){throw e}}async bulkDelete(e,{cookie:t,throwExceptionIfNotExist:a=!1,isSingleRecordDeletion:i=!1}={}){const s=await this.model.getColumns(this.context);let r;try{const l=await Promise.all(e.map((e=>this.model.mapAliasToColumn(this.context,e,this.clientMeta,this.dbDriver,s)))),c=[],d=[],u=[],p=100;for(const[e,t]of l.entries()){const i=Z(this.model.primaryKeys,this.extractPksValues(t));if(i){if(u.push({pk:i,data:t}),u.length>=p||e===l.length-1){const e=u.splice(0,u.length),t=await this.list({pks:e.map((e=>e.pk)).join(",")},{limitOverride:e.length,ignoreViewFilterAndSort:!0});if(t.length===e.length)c.push(...t),d.push(...e.map((e=>e.data)));else for(const{pk:i,data:s}of e){const e=t.find((e=>this.comparePks(this.extractPksValues(e),i)));e?(c.push(e),d.push(s)):a&&C.NcError.recordNotFound(i)}}}else a&&C.NcError.recordNotFound(i)}const m=[],f=await this.getSource();for(const e of this.model.columns){if(e.uidt!==_.UITypes.LinkToAnotherRecord)continue;const t=await e.getColOptions(this.context);switch(t.type){case"mm":{const e=await v.Model.get(this.context,t.fk_mm_model_id),a=await v.Column.get(this.context,{colId:t.fk_mm_child_column_id});m.push(((t,i)=>t(this.getTnPath(e.table_name)).del().whereIn(a.column_name,i)))}break;case"hm":{const e=await t.getRelatedTable(this.context);if(e.mm)break;const a=await v.Column.get(this.context,{colId:t.fk_child_column_id});m.push(((t,i)=>t(this.getTnPath(e.table_name)).update({[a.column_name]:null}).whereIn(a.column_name,i)))}}}const h=d.map((e=>e[this.model.primaryKey.column_name]));if(r=await this.dbDriver.transaction(),f.isMeta()&&m.length>0)for(const e of m)await e(r,h);for(const e of d)await r(this.tnPath).del().where(e);return await r.commit(),await this.clearFileReferences({oldData:c,columns:s}),i?await this.afterDelete(c[0],null,t):await this.afterBulkDelete(c,this.dbDriver,t),d}catch(e){throw r&&await r.rollback(),e}}async bulkDeleteAll(e={},{cookie:t}={}){let a;try{const i=await this.model.getColumns(this.context),{where:s}=this._getListArgs(e),r=this.dbDriver(this.tnPath),l=J(s,await this.model.getAliasColObjMap(this.context,i),!0);await(0,S.default)(this,[new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:l,is_group:!0,logical_op:"and"})],r,void 0,!0);const c=[];for(const e of this.model.columns){if(e.uidt!==_.UITypes.LinkToAnotherRecord)continue;const t=await e.getColOptions(this.context);if("bt"===t.type)continue;const a=await t.getChildColumn(this.context),i=await t.getParentColumn(this.context),s=await i.getModel(this.context),r=await a.getModel(this.context);await r.getColumns(this.context),await s.getColumns(this.context);const l=this.getTnPath(r);switch(t.type){case"mm":{const e=await t.getMMChildColumn(this.context),i=await t.getMMModel(this.context),s=this.getTnPath(i);c.push((()=>this.dbDriver(s).where({[e.column_name]:this.dbDriver(l).select(a.column_name).first()}).delete()))}break;case"hm":{if((await t.getRelatedTable(this.context)).mm)break;const e=await v.Column.get(this.context,{colId:t.fk_child_column_id});c.push(((t,a)=>t(l).where({[e.column_name]:this.dbDriver.from(a.select(i.column_name).first().as("___cn_alias"))}).update({[e.column_name]:null})))}}}const d=await this.getSource(),u=i.filter((e=>e.uidt===_.UITypes.Attachment)),p=r.clone().select(u.map((e=>e.column_name)).concat(this.model.primaryKeys.map((e=>e.column_name)))),m=[];let f=0;const h=100,g=[];for(;;){const e=await this.execAndParse(p.clone().offset(f).limit(h+1),null,{raw:!0});if(0===e.length)break;let t=!1;e.length>h?e.pop():t=!0;for(const t of e){for(const e of u)if(t[e.column_name])try{let a;if("string"==typeof t[e.column_name]){a=JSON.parse(t[e.column_name]);for(const e of a)e.id&&g.push(e.id)}if(Array.isArray(a))for(const e of a)e.id&&g.push(e.id)}catch(e){continue}const e={};for(const a of this.model.primaryKeys)e[a.title]=t[a.column_name];m.push(e)}if(t)break;f+=h}if(await v.FileReference.delete(this.context,g),a=await this.dbDriver.transaction(),d.isMeta())for(const e of c)await e(a,r.clone());return await r.clone().transacting(a).del(),await a.commit(),await this.afterBulkDelete(m.length,this.dbDriver,t,!0),m}catch(e){throw e}}async beforeInsert(e,t,a){await this.handleHooks("before.insert",null,e,a)}async beforeBulkInsert(e,t,a){await this.handleHooks("before.bulkInsert",null,e,a)}async afterInsert(e,t,a){var i,s;await this.handleHooks("after.insert",null,e,a);const r=this.extractPksValues(e);let l="";if(e&&"object"==typeof e){const t=await this.model.mapColumnToAlias(this.context,e,null===(i=this.model.columns)||void 0===i?void 0:i.filter((e=>!e.pk&&!(0,_.isSystemColumn)(e))));for(const e of Object.keys(t)){if(null===t[e]||void 0===t[e]||"string"==typeof t[e]&&""===t[e])continue;const a="object"==typeof t[e]?JSON.stringify(t[e]):t[e];l+=g.default.sanitize(`<span class="">${e}</span>\n          : <span class="black--text green lighten-4 px-2">${a}</span>`)}}await v.Audit.insert({fk_workspace_id:this.model.fk_workspace_id,base_id:this.model.base_id,source_id:this.model.source_id,fk_model_id:this.model.id,row_id:r,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.INSERT,description:g.default.sanitize(`Record with ID ${r} has been inserted into Table ${this.model.title}`),details:l||null,ip:null==a?void 0:a.clientIp,user:null===(s=null==a?void 0:a.user)||void 0===s?void 0:s.email})}async afterBulkUpdate(e,t,a,i,s=!1){var r;let l=t;s||(l=t.length,await this.handleHooks("after.bulkUpdate",e,t,i)),await v.Audit.insert({fk_workspace_id:this.model.fk_workspace_id,base_id:this.model.base_id,source_id:this.model.source_id,fk_model_id:this.model.id,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.BULK_UPDATE,description:g.default.sanitize(`${l} ${l>1?"records have":"record has"} been bulk updated in ${this.model.title}`),ip:null==i?void 0:i.clientIp,user:null===(r=null==i?void 0:i.user)||void 0===r?void 0:r.email})}async afterBulkDelete(e,t,a,i=!1){var s;let r=e;i||(r=e.length,await this.handleHooks("after.bulkDelete",null,e,a)),await v.Audit.insert({fk_workspace_id:this.model.fk_workspace_id,base_id:this.model.base_id,source_id:this.model.source_id,fk_model_id:this.model.id,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.BULK_DELETE,description:g.default.sanitize(`${r} ${r>1?"records have":"record has"} been bulk deleted in ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(s=null==a?void 0:a.user)||void 0===s?void 0:s.email})}async afterBulkInsert(e,t,a){var i;await this.handleHooks("after.bulkInsert",null,e,a),await v.Audit.insert({fk_workspace_id:this.model.fk_workspace_id,base_id:this.model.base_id,source_id:this.model.source_id,fk_model_id:this.model.id,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.BULK_INSERT,description:g.default.sanitize(`${e.length} ${e.length>1?"records have":"record has"} been bulk inserted in ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(i=null==a?void 0:a.user)||void 0===i?void 0:i.email})}async beforeUpdate(e,t,a){var i;const s=null===(i=a.query)||void 0===i?void 0:i.ignoreWebhook;if(s&&"true"!=s&&"false"!=s)throw new Error("ignoreWebhook value can be either true or false");void 0!==s&&"false"!==s||await this.handleHooks("before.update",null,e,a)}async afterUpdate(e,t,a,i,s){var r,l;const c=this.extractPksValues(t);let d=`Record with ID ${c} has been updated in Table ${this.model.title}.`,u="";if(s){s=await this.model.mapColumnToAlias(this.context,s);for(const a of Object.keys(s)){const i="object"==typeof e[a]?JSON.stringify(e[a]):e[a],s="object"==typeof t[a]?JSON.stringify(t[a]):t[a];d+="\n",d+=`Column "${a}" got changed from "${i}" to "${s}"`,u+=g.default.sanitize(`<span class="">${a}</span>\n  : <span class="text-decoration-line-through red px-2 lighten-4 black--text">${i}</span>\n  <span class="black--text green lighten-4 px-2">${s}</span>`)}}await v.Audit.insert({fk_workspace_id:this.model.fk_workspace_id,base_id:this.model.base_id,source_id:this.model.source_id,fk_model_id:this.model.id,row_id:c,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.UPDATE,description:g.default.sanitize(d),details:u,ip:null==i?void 0:i.clientIp,user:null===(r=null==i?void 0:i.user)||void 0===r?void 0:r.email});const p=null===(l=i.query)||void 0===l?void 0:l.ignoreWebhook;if(p&&"true"!=p&&"false"!=p)throw new Error("ignoreWebhook value can be either true or false");void 0!==p&&"false"!==p||await this.handleHooks("after.update",e,t,i)}async beforeDelete(e,t,a){await this.handleHooks("before.delete",null,e,a)}async afterDelete(e,t,a){var i;const s=this.extractPksValues(e);await v.Audit.insert({fk_workspace_id:this.model.fk_workspace_id,base_id:this.model.base_id,source_id:this.model.source_id,fk_model_id:this.model.id,row_id:s,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.DELETE,description:g.default.sanitize(`Record with ID ${s} has been deleted in Table ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(i=null==a?void 0:a.user)||void 0===i?void 0:i.email}),await this.handleHooks("after.delete",null,e,a)}async handleHooks(e,t,a,i){L.default.eventEmitter.emit(R.HANDLE_WEBHOOK,{context:this.context,hookName:e,prevData:t,newData:a,user:null==i?void 0:i.user,viewId:this.viewId,modelId:this.model.id,tnPath:this.tnPath})}async errorInsert(e,t,a,i){}async errorUpdate(e,t,a,i){}extractPksValues(e,t=!1){var a,i;if(this.model.primaryKeys.length>1){const i={};for(const t of this.model.primaryKeys)i[t.title]=null!==(a=e[t.title])&&void 0!==a?a:e[t.column_name];return t?Object.values(i).join("___"):i}return this.model.primaryKey?null!==(i=e[this.model.primaryKey.title])&&void 0!==i?i:e[this.model.primaryKey.column_name]:"N/A"}async errorDelete(e,t,a,i){}async validate(e,t){var a;const i=t||await this.model.getColumns(this.context);for(let t=0;t<i.length;++t){const i=this.model.columns[t];if(i.title in e&&(((0,_.isCreatedOrLastModifiedTimeCol)(i)||(0,_.isCreatedOrLastModifiedByCol)(i))&&C.NcError.badRequest(`Column "${i.title}" is auto generated and cannot be updated`),i.system&&i.uidt!==_.UITypes.ForeignKey&&C.NcError.badRequest(`Column "${i.title}" is system column and cannot be updated`)),await this.validateOptions(i,e),this.validateConstraints(i,e),!(null===(a=null==i?void 0:i.meta)||void 0===a?void 0:a.validate)||!(null==i?void 0:i.validate))continue;const s=i.getValidators(),r=i.column_name,l=i.title;if(!s)continue;const{func:c,msg:d}=s;for(let t=0;t<c.length;++t){const a="string"==typeof c[t]?O.customValidators[c[t]]?O.customValidators[c[t]]:f.default[c[t]]:c[t],i=(null==e?void 0:e[r])||(null==e?void 0:e[l]),s="string"==typeof c[t]?i+"":i;[null,void 0,""].includes(i)||("AsyncFunction"===a.constructor.name?await a(s):a(s))||C.NcError.badRequest(d[t].replace(/\{VALUE}/g,i).replace(/\{cn}/g,l))}}return!0}validateConstraints(e,t){var a;"string"==typeof t[e.title]&&"number"==typeof e.dtxp&&e.dtxp<(null===(a=t[e.title])||void 0===a?void 0:a.length)&&C.NcError.badRequest(`Column "${e.title}" value exceeds the maximum length of ${e.dtxp}`)}async validateOptions(e,t){var a;if(e.uidt!==_.UITypes.SingleSelect&&e.uidt!==_.UITypes.MultiSelect)return;const i=e.title,s=e.column_name,r=null!==(a=null==t?void 0:t[i])&&void 0!==a?a:null==t?void 0:t[s];if(!r)return;const l=await e.getColOptions(this.context).then((e=>{var t;return(null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.map((e=>e.title)))||[]})),c=e.uidt===_.UITypes.MultiSelect?r.split(","):[r];for(let e=0;e<c.length;++e){const t=c[e];l.includes(t)||l.includes(`'${t}'`)||C.NcError.badRequest(`Invalid option "${t}" provided for column "${i}". Valid options are "${l.join(", ")}"`)}}async addChild({colId:e,rowId:t,childId:a,cookie:i,onlyUpdateAuditLogs:s,prevData:r}){var l,c,d,u,p,m,f;const h=(await this.model.getColumns(this.context)).find((t=>t.id===e));h&&[_.UITypes.LinkToAnotherRecord,_.UITypes.Links].includes(h.uidt)||C.NcError.fieldNotFound(e);const g=await h.getColOptions(this.context);if(s&&g.type!==_.RelationTypes.BELONGS_TO)return;const y=await g.getChildColumn(this.context),b=await g.getParentColumn(this.context),w=await b.getModel(this.context),T=await y.getModel(this.context);await T.getColumns(this.context),await w.getColumns(this.context);const k=await v.Model.getBaseModelSQL(this.context,{model:w,dbDriver:this.dbDriver}),S=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:T}),M=S.getTnPath(T),O=k.getTnPath(w),I=ie(h,this.model.id===w.id?T:w),E=[],x={childModel:T,parentModel:w,childColTitle:(null==I?void 0:I.title)||"",parentColTitle:h.title},L=async()=>{await Promise.allSettled(E.filter((e=>e.op_sub_type===_.AuditOperationSubTypes.UNLINK_RECORD)).map((e=>{this.afterRemoveChild(e.columnTitle,e.rowId,e.childId,i,e.model,e.childModel,e.pkValue)})))};switch(g.type){case _.RelationTypes.MANY_TO_MANY:{const e=await g.getMMChildColumn(this.context),s=await g.getMMParentColumn(this.context),r=await g.getMMModel(this.context),l=(await v.Model.getBaseModelSQL(this.context,{model:r,dbDriver:this.dbDriver})).getTnPath(r);if(this.isSnowflake||this.isDatabricks){const i=k.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,a)).first(),r=S.dbDriver(M).select(y.column_name).where(X(T.primaryKeys,t)).first();await this.execAndParse(this.dbDriver.raw(`INSERT INTO ?? (??, ??) SELECT (${i.toQuery()}), (${r.toQuery()})`,[l,s.column_name,e.column_name]),null,{raw:!0})}else await this.execAndParse(this.dbDriver(l).insert({[s.column_name]:this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,a)).first(),[e.column_name]:this.dbDriver(M).select(y.column_name).where(X(T.primaryKeys,t)).first()}),null,{raw:!0});await this.updateLastModified({baseModel:k,model:w,rowIds:[a],cookie:i}),await this.updateLastModified({baseModel:S,model:T,rowIds:[t],cookie:i}),x.parentModel=this.model.id===w.id?w:T,x.childModel=this.model.id===w.id?T:w}break;case _.RelationTypes.HAS_MANY:{const e=await this.execAndParse(this.dbDriver(M).select(...new Set([y,...T.primaryKeys].map((e=>`${T.table_name}.${e.column_name}`)))).where(X(T.primaryKeys,a)),null,{raw:!0,first:!0}),s=e?null==e?void 0:e[null===(l=T.primaryKey)||void 0===l?void 0:l.column_name]:null;if(s){const[e,t]=await this.readOnlyPrimariesByPkFromModel([{model:T,id:a},{model:w,id:s}]);E.push({model:x.parentModel,childModel:x.childModel,rowId:s,childId:a,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:e}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:a,childId:s,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:t})}await this.execAndParse(this.dbDriver(M).update({[y.column_name]:this.dbDriver.from(this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,t)).first().as("___cn_alias"))}).where(X(T.primaryKeys,a)),null,{raw:!0}),await L(),await this.updateLastModified({baseModel:k,model:w,rowIds:[t],cookie:i})}break;case _.RelationTypes.BELONGS_TO:if(x.parentModel=T,x.childModel=w,s){const e=r[h.title]?Z(w.primaryKeys,this.extractPksValues(r[h.title])):null;if(e){E.push({model:x.parentModel,childModel:x.childModel,rowId:t,childId:e,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:null!==(d=null===(c=r[h.title])||void 0===c?void 0:c[w.displayValue.title])&&void 0!==d?d:null});const[a]=await this.readOnlyPrimariesByPkFromModel([{model:T,id:t}]);w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:e,childId:t,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:a})}await L()}else{const e=await this.execAndParse(this.dbDriver(M).select(...new Set([y,...T.primaryKeys].map((e=>e.column_name)))).where(X(T.primaryKeys,t)),null,{raw:!0,first:!0}),s=e?e[null===(u=T.primaryKeys[0])||void 0===u?void 0:u.column_name]:null;if(s){const[e,a]=await this.readOnlyPrimariesByPkFromModel([{model:w,id:s},{model:T,id:t}]);E.push({model:x.parentModel,childModel:x.childModel,rowId:t,childId:s,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:e}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:s,childId:t,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:a})}await this.execAndParse(this.dbDriver(M).update({[y.column_name]:this.dbDriver.from(this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,a)).first().as("___cn_alias"))}).where(X(T.primaryKeys,t)),null,{raw:!0}),await L(),await this.updateLastModified({baseModel:k,model:w,rowIds:[a],cookie:i})}break;case _.RelationTypes.ONE_TO_ONE:{const e=null===(p=h.meta)||void 0===p?void 0:p.bt;let s,r;if(x.parentModel=e?T:w,x.childModel=e?w:T,e){r=await this.execAndParse(this.dbDriver(M).select(...new Set([y,...T.primaryKeys].map((e=>e.column_name)))).where(X(T.primaryKeys,t)),null,{raw:!0,first:!0});const i=r?r[null===(m=T.primaryKeys[0])||void 0===m?void 0:m.column_name]:null;if(i){const[e,a]=await this.readOnlyPrimariesByPkFromModel([{model:w,id:i},{model:T,id:t}]);E.push({model:x.parentModel,childModel:x.childModel,rowId:t,childId:i,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:e}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:i,childId:t,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:a})}if(s=await this.execAndParse(this.dbDriver(M).where({[y.column_name]:this.dbDriver.from(this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,e?a:t)).first().as("___cn_alias"))}),null,{raw:!0,first:!0}),s){const e=Z(T.primaryKeys,this.extractPksValues(s));if(e){const[t,i]=await this.readOnlyPrimariesByPkFromModel([{model:w,id:a},{model:T,id:e}]);E.push({model:x.parentModel,childModel:x.childModel,rowId:e,childId:a,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:t}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:a,childId:e,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:i})}}}else{if(r=await this.execAndParse(this.dbDriver(M).where({[y.column_name]:this.dbDriver.from(this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,t)).first().as("___cn_alias"))}),null,{raw:!0,first:!0}),r){const e=Z(T.primaryKeys,this.extractPksValues(r));if(e){const[a,i]=await this.readOnlyPrimariesByPkFromModel([{model:T,id:e},{model:w,id:t}]);E.push({model:x.parentModel,childModel:x.childModel,rowId:t,childId:e,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:a}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:e,childId:t,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:i})}}s=await this.execAndParse(this.dbDriver(M).select(...new Set([y,...T.primaryKeys].map((e=>`${T.table_name}.${e.column_name}`)))).where(X(T.primaryKeys,a)),null,{raw:!0,first:!0});const e=s?s[null===(f=T.primaryKeys[0])||void 0===f?void 0:f.column_name]:null;if(e){const[t,i]=await this.readOnlyPrimariesByPkFromModel([{model:T,id:a},{model:w,id:e}]);E.push({model:x.parentModel,childModel:x.childModel,rowId:e,childId:a,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.parentColTitle,pkValue:t}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:a,childId:e,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,columnTitle:x.childColTitle,pkValue:i})}}await this.execAndParse(this.dbDriver(M).where({[y.column_name]:this.dbDriver.from(this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,e?a:t)).first().as("___cn_alias"))}).update({[y.column_name]:null}),null,{raw:!0}),await L(),await this.execAndParse(this.dbDriver(M).update({[y.column_name]:this.dbDriver.from(this.dbDriver(O).select(b.column_name).where(X(w.primaryKeys,e?a:t)).first().as("___cn_alias"))}).where(X(T.primaryKeys,e?t:a)),null,{raw:!0}),await this.updateLastModified({baseModel:k,model:w,rowIds:[a],cookie:i})}}E.push({model:x.parentModel,childModel:x.childModel,rowId:t,childId:a,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,columnTitle:x.parentColTitle}),w.id!==T.id&&E.push({model:x.childModel,childModel:x.parentModel,rowId:a,childId:t,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,columnTitle:x.childColTitle}),await Promise.allSettled(E.filter((e=>e.op_sub_type===_.AuditOperationSubTypes.LINK_RECORD)).map((e=>{this.afterAddChild(e.columnTitle,e.rowId,e.childId,i,e.model,e.childModel,e.pkValue)})))}async afterAddChild(e,t,a,i,s=this.model,r=this.model,l=void 0){var c;l||(l=await this.readByPkFromModel(r,void 0,!0,a,!1,{},{ignoreView:!0,getHiddenColumn:!0,extractOnlyPrimaries:!0})),await v.Audit.insert({fk_workspace_id:s.fk_workspace_id,base_id:s.base_id,source_id:s.source_id,fk_model_id:s.id,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,row_id:t,description:g.default.sanitize(`Record [id:${a}] has been linked with record [id:${t}] in ${s.title}`),details:g.default.sanitize(`<span class="">${e}</span>\n      : <span class="black--text green lighten-4 px-2">${null!=l?l:null}</span>`),ip:null==i?void 0:i.clientIp,user:null===(c=null==i?void 0:i.user)||void 0===c?void 0:c.email})}async removeChild({colId:e,rowId:t,childId:a,cookie:i}){var s;const r=(await this.model.getColumns(this.context)).find((t=>t.id===e));r&&[_.UITypes.LinkToAnotherRecord,_.UITypes.Links].includes(r.uidt)||C.NcError.fieldNotFound(e);const l=await r.getColOptions(this.context),c=await l.getChildColumn(this.context),d=await l.getParentColumn(this.context),u=await d.getModel(this.context),p=await c.getModel(this.context);await p.getColumns(this.context),await u.getColumns(this.context);const m=await v.Model.getBaseModelSQL(this.context,{model:u,dbDriver:this.dbDriver}),f=await v.Model.getBaseModelSQL(this.context,{dbDriver:this.dbDriver,model:p}),h=f.getTnPath(p),g=m.getTnPath(u),y=ie(r,this.model.id===u.id?p:u),b=[],w={childModel:p,parentModel:u,childColTitle:(null==y?void 0:y.title)||"",parentColTitle:r.title};switch(l.type){case _.RelationTypes.MANY_TO_MANY:{const e=await l.getMMChildColumn(this.context),s=await l.getMMParentColumn(this.context),r=await l.getMMModel(this.context),_=(await v.Model.getBaseModelSQL(this.context,{model:r,dbDriver:this.dbDriver})).getTnPath(r);await this.execAndParse(this.dbDriver(_).where({[s.column_name]:this.dbDriver(g).select(d.column_name).where(X(u.primaryKeys,a)).first(),[e.column_name]:this.dbDriver(h).select(c.column_name).where(X(p.primaryKeys,t)).first()}).delete(),null,{raw:!0}),await this.updateLastModified({baseModel:m,model:u,rowIds:[a],cookie:i}),await this.updateLastModified({baseModel:f,model:p,rowIds:[t],cookie:i}),w.parentModel=this.model.id===u.id?u:p,w.childModel=this.model.id===u.id?p:u}break;case _.RelationTypes.HAS_MANY:await this.execAndParse(this.dbDriver(h).where(X(p.primaryKeys,a)).update({[c.column_name]:null}),null,{raw:!0}),await this.updateLastModified({baseModel:m,model:u,rowIds:[t],cookie:i});break;case _.RelationTypes.BELONGS_TO:w.parentModel=p,w.childModel=u,await this.execAndParse(this.dbDriver(h).where(X(p.primaryKeys,t)).update({[c.column_name]:null}),null,{raw:!0}),await this.updateLastModified({baseModel:m,model:u,rowIds:[a],cookie:i});break;case _.RelationTypes.ONE_TO_ONE:{const e=null===(s=r.meta)||void 0===s?void 0:s.bt;w.parentModel=e?p:u,w.childModel=e?u:p,await this.execAndParse(this.dbDriver(h).where(X(p.primaryKeys,e?t:a)).update({[c.column_name]:null}),null,{raw:!0}),await this.updateLastModified({baseModel:m,model:u,rowIds:[a],cookie:i})}}b.push({model:w.parentModel,childModel:w.childModel,rowId:t,childId:a,columnTitle:w.parentColTitle}),u.id!==p.id&&b.push({model:w.childModel,childModel:w.parentModel,rowId:a,childId:t,columnTitle:w.childColTitle}),await Promise.allSettled(b.map((async e=>{await this.afterRemoveChild(e.columnTitle,e.rowId,e.childId,i,e.model,e.childModel)})))}async afterRemoveChild(e,t,a,i,s=this.model,r=this.model,l=void 0){var c;l||(l=await this.readByPkFromModel(r,void 0,!0,a,!1,{},{ignoreView:!0,getHiddenColumn:!0,extractOnlyPrimaries:!0})),await v.Audit.insert({fk_workspace_id:s.fk_workspace_id,base_id:s.base_id,source_id:s.source_id,fk_model_id:s.id,op_type:_.AuditOperationTypes.DATA,op_sub_type:_.AuditOperationSubTypes.UNLINK_RECORD,row_id:t,description:g.default.sanitize(`Record [id:${a}] has been unlinked with record [id:${t}] in ${s.title}`),details:g.default.sanitize(`<span class="">${e}</span>\n        : <span class="text-decoration-line-through red px-2 lighten-4 black--text">${l&&"object"==typeof l?Object.values(l)[0]:null!=l?l:null}</span>`),ip:null==i?void 0:i.clientIp,user:null===(c=null==i?void 0:i.user)||void 0===c?void 0:c.email})}async groupedList(e){var t,a,s;try{const r=this._getListArgs(e),{where:l}=r,c=i(r,["where"]),d=await this.model.getColumns(this.context),u=null==d?void 0:d.find((t=>t.id===e.groupColumnId));let p;if(u||C.NcError.fieldNotFound(e.groupColumnId),(0,_.isVirtualCol)(u)&&C.NcError.notImplemented("Grouping for virtual columns"),null===(t=e.options)||void 0===t?void 0:t.length)p=new Set(e.options);else if(u.uidt===_.UITypes.SingleSelect){const e=await u.getColOptions(this.context);p=new Set((null!==(a=null==e?void 0:e.options)&&void 0!==a?a:[]).map((e=>e.title))),p.add(null)}else p=new Set((await this.execAndParse(this.dbDriver(this.tnPath).select(u.column_name).distinct(),null,{raw:!0})).map((e=>e[u.column_name]))),p.add(null);const m=this.dbDriver(this.tnPath);m.limit(+(null==c?void 0:c.limit)||25),m.offset(+(null==c?void 0:c.offset)||0),await this.selectObject({qb:m,extractPkAndPv:!0});const f=await this.model.getAliasColObjMap(this.context,d);let h=z(null==e?void 0:e.sort,f);const g=J(l,f);!e.ignoreViewFilterAndSort&&this.viewId?(await(0,S.default)(this,[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0}),new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:g,is_group:!0,logical_op:"and"})],m),h||(h=(null===(s=e.sortArr)||void 0===s?void 0:s.length)?e.sortArr:await v.Sort.list(this.context,{viewId:this.viewId})),(null==h?void 0:h.length)&&await(0,M.default)(this,h,m)):(await(0,S.default)(this,[new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:g,is_group:!0,logical_op:"and"})],m),h||(h=e.sortArr),(null==h?void 0:h.length)&&await(0,M.default)(this,h,m)),this.model.primaryKey&&this.model.primaryKey.ai?m.orderBy(this.model.primaryKey.column_name):this.model.columns.find((e=>"created_at"===e.column_name))&&m.orderBy("created_at");const y=this.dbDriver.from(this.dbDriver.unionAll([...p].map((e=>{const t=m.clone();return null===e?t.whereNull(u.column_name):t.where(u.column_name,e),this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite).as("__nc_grouped_list")),b=await this.getProto(),w=await this.execAndParse(y),T=(null==w?void 0:w.map((e=>(e.__proto__=b,e)))).reduce(((e,t)=>(e.has(t[u.title])||e.set(t[u.title],[]),e.get(t[u.title]).push(t),e)),new Map),k=[...p].map((e=>{var t;return{key:e,value:null!==(t=T.get(e))&&void 0!==t?t:[]}}));return k}catch(e){throw e}}async groupedListCount(e){const t=await this.model.getColumns(this.context),a=null==t?void 0:t.find((t=>t.id===e.groupColumnId));a||C.NcError.fieldNotFound(e.groupColumnId),(0,_.isVirtualCol)(a)&&C.NcError.notImplemented("Grouping for virtual columns");const i=this.dbDriver(this.tnPath).count("*",{as:"count"}).groupBy(a.column_name),s=await this.model.getAliasColObjMap(this.context,t),r=J(e.where,s);return!e.ignoreViewFilterAndSort&&this.viewId?await(0,S.default)(this,[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:this.viewId})||[],is_group:!0}),new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:r,is_group:!0,logical_op:"and"})],i):await(0,S.default)(this,[new v.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new v.Filter({children:r,is_group:!0,logical_op:"and"})],i),await this.selectObject({qb:i,columns:[new v.Column(Object.assign(Object.assign({},a),{title:"key",id:"key"}))]}),await this.execAndParse(i)}async execAndGetRows(e,t){var a;if(t=t||this.dbDriver,e=this.sanitizeQuery(e),this.isPg||this.isSnowflake)return null===(a=await t.raw(e))||void 0===a?void 0:a.rows;if(!this.isMssql&&/^(\(|)select/i.test(e))return await t.from(t.raw(e).wrap("(",") __nc_alias"));if(this.isMySQL&&/^(\(|)insert/i.test(e)){const a=await t.raw(e);return a&&a[0]&&a[0].insertId?a[0].insertId:a}return await t.raw(e)}async execAndParse(e,t,a={skipDateConversion:!1,skipAttachmentConversion:!1,skipSubstitutingColumnIds:!1,skipUserConversion:!1,skipButtonConversion:!1,raw:!1,first:!1,bulkAggregate:!1}){var i;a.raw&&(a.skipDateConversion=!0,a.skipAttachmentConversion=!0,a.skipSubstitutingColumnIds=!0,a.skipUserConversion=!0,a.skipButtonConversion=!0),a.first&&"string"!=typeof e&&(e=e.limit(1));const s="string"==typeof e?e:e.toQuery();let r=await this.execAndGetRows(s);return(null===(i=this.model)||void 0===i?void 0:i.columns)||await this.model.getColumns(this.context),a.skipAttachmentConversion||(r=await this.convertAttachmentType(r,t)),a.skipDateConversion||(r=this.convertDateFormat(r,t)),a.skipUserConversion||(r=await this.convertUserFormat(r,t)),a.skipButtonConversion||(r=await this.convertButtonType(r,t)),a.skipSubstitutingColumnIds||(r=await this.substituteColumnIdsWithColumnTitles(r,t)),a.first?null==r?void 0:r[0]:r}sanitizeQuery(e){const t=e=>this.isPg||this.isMssql||this.isSnowflake?(0,x.sanitize)(e):(0,x.unsanitize)(e);return Array.isArray(e)?e.map(t):t(e)}async runOps(e,t=this.dbDriver){const a=await Promise.all(e);for(const e of a)await t.raw(e)}async substituteColumnIdsWithColumnTitles(e,t,a){var i;const s=null===(i=this.model)||void 0===i?void 0:i.columns.concat(null!=t?t:[]);if(!s||!e.length)return e;const r={},l={},c={};s.forEach((t=>{if(a&&t.id in a&&(a[t.id].id=t.id,a[t.id].title=t.title,t=a[t.id]),r[t.id]=t.title,t.uidt===_.UITypes.LinkToAnotherRecord){c[t.id]=!0;const a=Object.values(e).find((e=>e[t.id]&&Object.keys(e[t.id])));if(a)if("object"==typeof a[t.id])for(const e of Object.keys(Array.isArray(a[t.id])?a[t.id][0]||{}:a[t.id])){r[e]||(l[e]=v.Column.get(this.context,{colId:e}).then((e=>null==e?void 0:e.title)).catch((e=>Promise.resolve(e))))}else{r[t.id]||(l[t.id]=v.Column.get(this.context,{colId:t.id}).then((e=>null==e?void 0:e.title)).catch((e=>Promise.resolve(e))))}}else c[t.id]=!1}));for(const e of Object.keys(l))if(r[e]=await l[e],r[e]instanceof Error)throw r[e];return e.forEach((e=>{Object.entries(e).forEach((([t,a])=>{const i=r[t];if(i){if(c[t])if(a&&"object"==typeof a){const t=Array.isArray(a)?a.map((e=>W(e,r))):W(a,r);e[i]=t,e[i]=t}else e[i]=a;else e[i]=a;delete e[t]}}))})),e}async convertUserFormat(e,t){var a,i;if(e){let s=[];const r=null===(a=this.model)||void 0===a?void 0:a.columns.concat(null!=t?t:[]);for(const e of r)e.uidt===_.UITypes.Lookup?[_.UITypes.User,_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(null===(i=await this.getNestedColumn(e))||void 0===i?void 0:i.uidt)&&s.push(e):[_.UITypes.User,_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(e.uidt)&&s.push(e);if(s.length)if(Array.isArray(e)){const t=e[0];t&&(s=s.filter((e=>e.id in t)))}else s=s.filter((t=>t.id in e));if(s.length){const t=await v.BaseUser.getUsersList(this.context,{base_id:this.model.base_id});e=Array.isArray(e)?await Promise.all(e.map((e=>this._convertUserFormat(s,t,e)))):await this._convertUserFormat(s,t,e)}}return e}_convertUserFormat(e,t,a){try{if(a){const i=e.filter((e=>a[e.id]&&a[e.id].length));for(const e of i)a[e.id]=a[e.id].split(","),a[e.id]=a[e.id].map((e=>{const{id:a,email:i,display_name:s}=t.find((t=>t.id===e));return{id:a,email:i,display_name:(null==s?void 0:s.length)?s:null}})),[_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(e.uidt)&&(a[e.id]=a[e.id][0])}}catch(e){}return a}async _convertAttachmentType(e,t){var a,i,s,r;try{if(t){const l=[];for(const c of e)if(t[c.id]&&"string"==typeof t[c.id]&&(t[c.id]=JSON.parse(t[c.id])),null===(a=t[c.id])||void 0===a?void 0:a.length)for(let e=0;e<t[c.id].length;e++){"string"==typeof t[c.id][e]&&(t[c.id][e]=JSON.parse(t[c.id][e]));const a=t[c.id][e];if(Array.isArray(a)){for(const e of a)if(null==e?void 0:e.path){if(l.push(v.PresignedUrl.signAttachment({attachment:e,filename:e.title})),!(null===(i=e.mimetype)||void 0===i?void 0:i.startsWith("image/")))continue;e.thumbnails={tiny:{},small:{},card_cover:{}};const t=`thumbnails/${e.path.replace(/^download[/\\]/i,"")}`;for(const a of Object.keys(e.thumbnails))l.push(v.PresignedUrl.signAttachment({attachment:Object.assign(Object.assign({},e),{path:`${t}/${a}.jpg`}),filename:e.title,mimetype:"image/jpeg",nestedKeys:["thumbnails",a]}))}else if(null==e?void 0:e.url){if(l.push(v.PresignedUrl.signAttachment({attachment:e,filename:e.title})),!(null===(s=e.mimetype)||void 0===s?void 0:s.startsWith("image/")))continue;const t=e.url.replace("nc/uploads","nc/thumbnails");e.thumbnails={tiny:{},small:{},card_cover:{}};for(const a of Object.keys(e.thumbnails))l.push(v.PresignedUrl.signAttachment({attachment:Object.assign(Object.assign({},e),{url:`${t}/${a}.jpg`}),filename:e.title,mimetype:"image/jpeg",nestedKeys:["thumbnails",a]}))}}else if(null==a?void 0:a.path){if(l.push(v.PresignedUrl.signAttachment({attachment:a,filename:a.title})),!(null===(r=a.mimetype)||void 0===r?void 0:r.startsWith("image/")))continue;const e=`thumbnails/${a.path.replace(/^download[/\\]/i,"")}`;a.thumbnails={tiny:{},small:{},card_cover:{}};for(const t of Object.keys(a.thumbnails))l.push(v.PresignedUrl.signAttachment({attachment:Object.assign(Object.assign({},a),{path:`${e}/${t}.jpg`}),filename:a.title,mimetype:"image/jpeg",nestedKeys:["thumbnails",t]}))}else if(null==a?void 0:a.url){l.push(v.PresignedUrl.signAttachment({attachment:a,filename:a.title}));const e=a.url.replace("nc/uploads","nc/thumbnails");a.thumbnails={tiny:{},small:{},card_cover:{}};for(const t of Object.keys(a.thumbnails))l.push(v.PresignedUrl.signAttachment({attachment:Object.assign(Object.assign({},a),{url:`${e}/${t}.jpg`}),filename:a.title,mimetype:"image/jpeg",nestedKeys:["thumbnails",t]}))}}await Promise.all(l)}}catch(e){}return t}async _convertButtonType(e,t){var a;try{if(t)for(const i of e)if(t[i.id]&&"string"==typeof t[i.id]&&(t[i.id]=JSON.parse(t[i.id])),null===(a=t[i.id])||void 0===a?void 0:a.length)for(let e=0;e<t[i.id].length;e++)"string"==typeof t[i.id][e]&&(t[i.id][e]=JSON.parse(t[i.id][e]))}catch(e){}return t}async getNestedColumn(e){if(e.uidt!==_.UITypes.Lookup)return e;const t=await e.getColOptions(this.context);return this.getNestedColumn(await(null==t?void 0:t.getLookupColumn(this.context)))}async convertButtonType(e,t){var a,i;if(e){const s=[],r=null===(a=this.model)||void 0===a?void 0:a.columns.concat(null!=t?t:[]);for(const e of r)e.uidt===_.UITypes.Lookup?(null===(i=await this.getNestedColumn(e))||void 0===i?void 0:i.uidt)===_.UITypes.Button&&s.push(e):e.uidt===_.UITypes.Button&&s.push(e);s.length&&(e=Array.isArray(e)?await Promise.all(e.map((e=>this._convertButtonType(s,e)))):await this._convertButtonType(s,e))}return e}async convertAttachmentType(e,t){var a,i;if(e){const s=[],r=null===(a=this.model)||void 0===a?void 0:a.columns.concat(null!=t?t:[]);for(const e of r)e.uidt===_.UITypes.Lookup?(null===(i=await this.getNestedColumn(e))||void 0===i?void 0:i.uidt)===_.UITypes.Attachment&&s.push(e):e.uidt===_.UITypes.Attachment&&s.push(e);s.length&&(e=Array.isArray(e)?await Promise.all(e.map((e=>this._convertAttachmentType(s,e)))):await this._convertAttachmentType(s,e))}return e}_convertDateFormat(e,t){var a;if(!t)return t;for(const i of e){if(!t[i.id])continue;if(i.uidt===_.UITypes.Formula){if(!t[i.id]||"string"!=typeof t[i.id])continue;if(this.isMySQL?t[i.id]=t[i.id].replace(/\.000000/g,""):this.isMssql&&(t[i.id]=t[i.id].replace(/\.0000000 \+00:00/g,"")),/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/g.test(t[i.id])){t[i.id]=t[i.id].replace(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/g,(e=>(0,d.default)(e).isValid()?this.isSqlite?(0,d.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ"):(0,d.default)(e).utc(!0).format("YYYY-MM-DD HH:mm:ssZ"):e));continue}t[i.id]=t[i.id].replace(/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:[+-]\d{2}:\d{2})?/g,(e=>{if(!(0,d.default)(e).isValid())return e;if(this.isSqlite)return(0,d.default)(e).tz(Intl.DateTimeFormat().resolvedOptions().timeZone).utc().format("YYYY-MM-DD HH:mm:ssZ");const t=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/g.test(e);return(0,d.default)(e).utc(t).format("YYYY-MM-DD HH:mm:ssZ")}));continue}if(i.uidt===_.UITypes.Date){const e=null===(a=i.meta)||void 0===a?void 0:a.date_format;e&&(t[i.title]=(0,d.default)(t[i.title],e).format(e));continue}let e=!0;if(this.isSqlite&&!i.cdf){if(-1===t[i.id].indexOf("-")&&-1===t[i.id].indexOf("+")&&"Z"!==t[i.id].slice(-1)){t[i.id]=(0,d.default)(t[i.id]).tz(Intl.DateTimeFormat().resolvedOptions().timeZone).utc().format("YYYY-MM-DD HH:mm:ssZ");continue}e=!1}this.isPg&&(e=!1),t[i.id]instanceof Date&&(e=!1),t[i.id]=(0,d.default)(t[i.id]).utc(e).format("YYYY-MM-DD HH:mm:ssZ")}return t}convertDateFormat(e,t){var a;if(e){const i=(null===(a=this.model)||void 0===a?void 0:a.columns.concat(null!=t?t:[])).filter((e=>e.uidt===_.UITypes.DateTime||e.uidt===_.UITypes.Date||e.uidt===_.UITypes.Formula));i.length&&(e=Array.isArray(e)?e.map((e=>this._convertDateFormat(i,e))):this._convertDateFormat(i,e))}return e}async addLinks({cookie:e,childIds:t,colId:a,rowId:i}){var s,r,l,c;const d=(await this.model.getColumns(this.context)).find((e=>e.id===a));d&&(0,_.isLinksOrLTAR)(d)||C.NcError.fieldNotFound(a);const u=await this.readByPk(i,!1,{},{ignoreView:!0,getHiddenColumn:!0});if(u||C.NcError.recordNotFound(i),!t.length)return;const p=await d.getColOptions(this.context),m=await p.getChildColumn(this.context),f=await p.getParentColumn(this.context),h=await f.getModel(this.context),g=await m.getModel(this.context);await g.getColumns(this.context),await h.getColumns(this.context);const y=await v.Model.getBaseModelSQL(this.context,{model:g,dbDriver:this.dbDriver}),b=await v.Model.getBaseModelSQL(this.context,{model:h,dbDriver:this.dbDriver}),w=y.getTnPath(g),T=b.getTnPath(h);let k=p.type,S=t;const M=ie(d,this.model.id===h.id?g:h),O=[],I={childModel:g,parentModel:h,childColTitle:(null==M?void 0:M.title)||"",parentColTitle:d.title};switch(k===_.RelationTypes.ONE_TO_ONE&&(k=(null===(s=d.meta)||void 0===s?void 0:s.bt)?_.RelationTypes.BELONGS_TO:_.RelationTypes.HAS_MANY,S=S.slice(0,1),await this.execAndParse(this.dbDriver(w).where({[m.column_name]:this.dbDriver.from(this.dbDriver(T).select(f.column_name).where(X(h.primaryKeys,(null===(r=d.meta)||void 0===r?void 0:r.bt)?S[0]:i)).first().as("___cn_alias"))}).update({[m.column_name]:null}),null,{raw:!0}),I.parentModel=(null===(l=d.meta)||void 0===l?void 0:l.bt)?g:h,I.childModel=(null===(c=d.meta)||void 0===c?void 0:c.bt)?h:g),k){case _.RelationTypes.MANY_TO_MANY:{const t=await p.getMMChildColumn(this.context),a=await p.getMMParentColumn(this.context),s=await p.getMMModel(this.context),r=(await v.Model.getBaseModelSQL(this.context,{model:s,dbDriver:this.dbDriver})).getTnPath(s);let l;{const e=this.dbDriver(T).select(`${h.table_name}.${f.column_name}`).select(`${s.table_name}.${t.column_name}`).leftJoin(r,(e=>{var i;e.on(`${s.table_name}.${a.column_name}`,`${h.table_name}.${f.column_name}`).andOn(`${s.table_name}.${t.column_name}`,this.dbDriver.raw("?",[null!==(i=u[m.title])&&void 0!==i?i:u[m.column_name]]))}));h.primaryKeys.length>1?e.where((e=>{for(const t of S)e.orWhere(X(h.primaryKeys,t))})):e.whereIn(`${h.table_name}.${h.primaryKey.column_name}`,"object"==typeof S[0]?S.map((e=>{var t;return null!==(t=e[h.primaryKey.title])&&void 0!==t?t:e[h.primaryKey.column_name]})):S),h.primaryKey.column_name!==f.column_name&&e.select(`${h.table_name}.${h.primaryKey.column_name}`);const i=await this.execAndParse(e,null,{raw:!0});if(i.length!==S.length){const e=S.filter((e=>!i.find((t=>t[f.column_name]===e))));C.NcError.recordNotFound(ae(e))}if(l=i.filter((e=>!e[t.column_name])).map((e=>{var i,s;return{[a.column_name]:null!==(i=e[f.title])&&void 0!==i?i:e[f.column_name],[t.column_name]:null!==(s=u[m.title])&&void 0!==s?s:u[m.column_name]}})),!l.length)return!0}await this.execAndParse(this.dbDriver(r).insert(l),null,{raw:!0}),await this.updateLastModified({model:h,rowIds:S,cookie:e}),await this.updateLastModified({model:g,rowIds:[i],cookie:e}),I.parentModel=this.model.id===h.id?h:g,I.childModel=this.model.id===h.id?g:h}break;case _.RelationTypes.HAS_MANY:{{const e=this.dbDriver(w).select(g.primaryKey.column_name);g.primaryKeys.length>1?e.where((e=>{for(const t of S)e.orWhere(X(g.primaryKeys,t))})):e.whereIn(h.primaryKey.column_name,"object"==typeof S[0]?S.map((e=>{var t;return null!==(t=e[h.primaryKey.title])&&void 0!==t?t:e[h.primaryKey.column_name]})):S);const t=await this.execAndParse(e,null,{raw:!0});if(t.length!==S.length){const e=S.filter((e=>!t.find((t=>t[f.column_name]===e))));C.NcError.recordNotFound(ae(e))}}const t=this.dbDriver(w).update({[m.column_name]:this.dbDriver.from(this.dbDriver(T).select(f.column_name).where(X(h.primaryKeys,i)).first().as("___cn_alias"))});g.primaryKeys.length>1?t.where((e=>{for(const t of S)e.orWhere(X(g.primaryKeys,t))})):t.whereIn(g.primaryKey.column_name,"object"==typeof S[0]?S.map((e=>{var t;return null!==(t=e[g.primaryKey.title])&&void 0!==t?t:e[g.primaryKey.column_name]})):S),await this.execAndParse(t,null,{raw:!0}),await this.updateLastModified({model:h,rowIds:[i],cookie:e})}break;case _.RelationTypes.BELONGS_TO:I.parentModel=g,I.childModel=h;{const e=this.dbDriver(T).select(h.primaryKey.column_name).where(X(h.primaryKeys,S[0])).first();await this.execAndParse(e,null,{first:!0,raw:!0})||C.NcError.recordNotFound(ae(S,!0))}await this.execAndParse(this.dbDriver(w).update({[m.column_name]:this.dbDriver.from(this.dbDriver(T).select(f.column_name).where(X(h.primaryKeys,S[0])).first().as("___cn_alias"))}).where(X(g.primaryKeys,i)),null,{raw:!0}),await this.updateLastModified({model:h,rowIds:[i],cookie:e})}for(const e of S){const t="object"==typeof e?Object.values(e).join("_"):e;O.push({model:I.parentModel,childModel:I.childModel,rowId:i,childId:t,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,columnTitle:I.parentColTitle}),h.id!==g.id&&O.push({model:I.childModel,childModel:I.parentModel,rowId:t,childId:i,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,columnTitle:I.childColTitle})}await Promise.allSettled(O.map((async t=>{await this.afterAddChild(t.columnTitle,t.rowId,t.childId,e,t.model,t.childModel)})))}async removeLinks({cookie:e,childIds:t,colId:a,rowId:i}){const s=(await this.model.getColumns(this.context)).find((e=>e.id===a));s&&(0,_.isLinksOrLTAR)(s)||C.NcError.fieldNotFound(a);if(await this.readByPk(i,!1,{},{ignoreView:!0,getHiddenColumn:!0})||C.NcError.recordNotFound(i),!t.length)return;const r=await s.getColOptions(this.context),l=await r.getChildColumn(this.context),c=await r.getParentColumn(this.context),d=await c.getModel(this.context),u=await l.getModel(this.context);await u.getColumns(this.context),await d.getColumns(this.context);const p=await v.Model.getBaseModelSQL(this.context,{model:u,dbDriver:this.dbDriver}),m=await v.Model.getBaseModelSQL(this.context,{model:d,dbDriver:this.dbDriver}),f=p.getTnPath(u),h=m.getTnPath(d),g=ie(s,this.model.id===d.id?u:d),y=[],b={childModel:u,parentModel:d,childColTitle:(null==g?void 0:g.title)||"",parentColTitle:s.title};switch(r.type){case _.RelationTypes.MANY_TO_MANY:{const a=await r.getMMChildColumn(this.context),s=await r.getMMParentColumn(this.context),p=await r.getMMModel(this.context),m=await v.Model.getBaseModelSQL(this.context,{model:p,dbDriver:this.dbDriver});{const e=this.dbDriver(h).select(c.column_name);d.primaryKeys.length>1?e.where((e=>{for(const a of t)e.orWhere(X(d.primaryKeys,a))})):"object"==typeof t[0]?e.whereIn(`${d.table_name}.${d.primaryKey.column_name}`,t.map((e=>e[d.primaryKey.title]||e[d.primaryKey.column_name]))):e.whereIn(`${d.table_name}.${d.primaryKey.column_name}`,t),d.primaryKey.column_name!==c.column_name&&e.select(`${d.table_name}.${d.primaryKey.column_name}`);const a=await this.execAndParse(e,null,{raw:!0});if(a.length!==t.length){const e=t.filter((e=>!a.find((t=>{var a;return t[c.column_name]===("object"==typeof e?null!==(a=e[d.primaryKey.title])&&void 0!==a?a:e[d.primaryKey.column_name]:e)}))));C.NcError.recordNotFound(ae(e))}}const _=m.getTnPath(p),g=this.dbDriver(_).where({[a.column_name]:this.dbDriver(f).select(l.column_name).where(X(u.primaryKeys,i)).first()}).delete();g.whereIn(`${p.table_name}.${s.column_name}`,"object"==typeof t[0]?t.map((e=>{var t;return null!==(t=e[d.primaryKey.title])&&void 0!==t?t:e[d.primaryKey.column_name]})):t),await this.execAndParse(g,null,{raw:!0}),await this.updateLastModified({model:d,rowIds:t,cookie:e}),await this.updateLastModified({model:u,rowIds:[i],cookie:e}),b.parentModel=this.model.id===d.id?d:u,b.childModel=this.model.id===d.id?u:d}break;case _.RelationTypes.HAS_MANY:{{const e=this.dbDriver(f).select(u.primaryKey.column_name);d.primaryKeys.length>1?e.where((e=>{for(const a of t)e.orWhere(X(d.primaryKeys,a))})):"object"==typeof t[0]?e.whereIn(d.primaryKey.column_name,t.map((e=>{var t;return null!==(t=e[d.primaryKey.title])&&void 0!==t?t:e[d.primaryKey.column_name]}))):e.whereIn(d.primaryKey.column_name,t);const a=await this.execAndParse(e,null,{raw:!0});if(a.length!==t.length){const e=t.filter((e=>!a.find((t=>{var a;return t[c.column_name]===("object"==typeof e?null!==(a=e[d.primaryKey.title])&&void 0!==a?a:e[d.primaryKey.column_name]:e)}))));C.NcError.recordNotFound(ae(e))}}const a=this.dbDriver(f);d.primaryKeys.length>1?a.where((e=>{for(const a of t)e.orWhere(X(d.primaryKeys,a))})):a.whereIn(d.primaryKey.column_name,"object"==typeof t[0]?t.map((e=>{var t;return null!==(t=e[d.primaryKey.title])&&void 0!==t?t:e[d.primaryKey.column_name]})):t),await this.execAndParse(a.update({[l.column_name]:null}),null,{raw:!0}),await this.updateLastModified({model:d,rowIds:[i],cookie:e})}break;case _.RelationTypes.BELONGS_TO:b.parentModel=u,b.childModel=d;{t.length>1&&C.NcError.unprocessableEntity("Request must contain only one parent id");const e=this.dbDriver(h).select(d.primaryKey.column_name).where(X(d.primaryKeys,t[0])).first();await this.execAndParse(e,null,{first:!0,raw:!0})||C.NcError.recordNotFound(ae(t,!0))}await this.execAndParse(this.dbDriver(f).where(u.primaryKey.column_name,i).update({[l.column_name]:null}),null,{raw:!0}),await this.updateLastModified({model:d,rowIds:[t[0]],cookie:e})}for(const e of t){const t="object"==typeof e?Object.values(e).join("_"):e;y.push({model:b.parentModel,childModel:b.childModel,rowId:i,childId:t,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,columnTitle:b.parentColTitle}),d.id!==u.id&&y.push({model:b.childModel,childModel:b.parentModel,rowId:t,childId:i,op_sub_type:_.AuditOperationSubTypes.LINK_RECORD,columnTitle:b.childColTitle})}await Promise.allSettled(y.map((async t=>{await this.afterRemoveChild(t.columnTitle,t.rowId,t.childId,e,t.model,t.childModel)})))}async btRead({colId:e,id:t},a={}){try{const i=await this.model.getColumns(this.context),{where:s,sort:r}=this._getListArgs(a),l=i.find((t=>t.id===e));await this.execAndParse(this.dbDriver(this.tnPath).where(await this._wherePk(t)),null,{raw:!0,first:!0})||C.NcError.recordNotFound(t);const c=await(await l.getColOptions(this.context)).getParentColumn(this.context),d=await c.getModel(this.context),u=await(await l.getColOptions(this.context)).getChildColumn(this.context),p=await u.getModel(this.context),m=await v.Model.getBaseModelSQL(this.context,{model:d,dbDriver:this.dbDriver});await p.getColumns(this.context);const _=this.getTnPath(p),f=this.getTnPath(d),h=this.dbDriver(f);await this.applySortAndFilter({table:d,where:s,qb:h,sort:r}),h.where(c.column_name,this.dbDriver(_).select(u.column_name).where(X(p.primaryKeys,t))),await m.selectObject({qb:h,fieldsSet:a.fieldSet});const g=await this.execAndParse(h,await d.getColumns(this.context),{first:!0}),y=await m.getProto();return g&&(g.__proto__=y),g}catch(e){throw e}}async updateLastModified({rowIds:e,cookie:t,model:a=this.model,knex:i=this.dbDriver,baseModel:s=this}){var r;const l=await a.getColumns(this.context),c={},d=l.find((e=>e.uidt===_.UITypes.LastModifiedTime&&e.system)),u=l.find((e=>e.uidt===_.UITypes.LastModifiedBy&&e.system));if(d&&(c[d.column_name]=this.now()),u&&(c[u.column_name]=null===(r=null==t?void 0:t.user)||void 0===r?void 0:r.id),0===Object.keys(c).length)return;const p=i(s.getTnPath(a.table_name)).update(c);for(const t of Array.isArray(e)?e:[e])p.orWhere(X(a.primaryKeys,t));await this.execAndParse(p,null,{raw:!0})}async prepareNocoData(e,t=!1,a,i){var s,r,l,c,d,u;for(const p of this.model.columns)if([_.UITypes.Attachment,_.UITypes.JSON,_.UITypes.User,_.UITypes.CreatedTime,_.UITypes.LastModifiedTime,_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(p.uidt))if(p.system&&(t&&(p.uidt===_.UITypes.CreatedTime?e[p.column_name]=this.now():p.uidt===_.UITypes.CreatedBy&&(e[p.column_name]=null===(s=null==a?void 0:a.user)||void 0===s?void 0:s.id)),p.uidt===_.UITypes.LastModifiedTime?e[p.column_name]=t?null:this.now():p.uidt===_.UITypes.LastModifiedBy&&(e[p.column_name]=t?null:null===(r=null==a?void 0:a.user)||void 0===r?void 0:r.id)),p.uidt===_.UITypes.Attachment){if(p.column_name in e){if(e&&e[p.column_name])try{"string"==typeof e[p.column_name]&&(e[p.column_name]=JSON.parse(e[p.column_name]))}catch(t){C.NcError.invalidAttachmentJson(e[p.column_name])}if(i&&i[p.title])try{"string"==typeof i[p.title]&&(i[p.title]=JSON.parse(i[p.title]))}catch(e){}const s=[];if(!t){const t=new Map(i&&i[p.title]&&Array.isArray(i[p.title])?i[p.title].filter((e=>e.id)).map((e=>[e.id,e])):[]),a=new Map(e[p.column_name]&&Array.isArray(e[p.column_name])?e[p.column_name].filter((e=>e.id)).map((e=>[e.id,e])):[]);for(const[e,i]of t)a.has(e)?(i.url&&i.url!==a.get(e).url||i.path&&i.path!==a.get(e).path)&&(await v.FileReference.delete(this.context,e),s.push(e)):await v.FileReference.delete(this.context,e);for(const[e,i]of a)t.has(e)?(i.url&&i.url!==t.get(e).url||i.path&&i.path!==t.get(e).path)&&s.push(e):s.push(e)}const r=[];if(Array.isArray(e[p.column_name]))for(const i of e[p.column_name]){"url"in i||"path"in i||C.NcError.unprocessableEntity("Attachment object must contain either url or path");const e=(0,A.extractProps)(i,["id","url","path","title","mimetype","size","icon","width","height"]);if(t||!e.id||s.includes(e.id)){const t=await this.getSource();e.id=await v.FileReference.insert(this.context,{file_url:null!==(l=e.url)&&void 0!==l?l:e.path,file_size:e.size,fk_user_id:null!==(d=null===(c=null==a?void 0:a.user)||void 0===c?void 0:c.id)&&void 0!==d?d:"anonymous",source_id:t.id,fk_model_id:this.model.id,fk_column_id:p.id,is_external:!t.isMeta()})}r.push(e)}e[p.column_name]=r.length?JSON.stringify(r):null}}else if([_.UITypes.User,_.UITypes.CreatedBy,_.UITypes.LastModifiedBy].includes(p.uidt)){if(e[p.column_name]){const t=[];if("string"==typeof e[p.column_name]&&/^\s*[{[]/.test(e[p.column_name]))try{e[p.column_name]=JSON.parse(e[p.column_name])}catch(e){}const a=await v.BaseUser.getUsersList(this.context,{base_id:this.model.base_id,include_ws_deleted:!1});if("object"==typeof e[p.column_name]){const i=Array.isArray(e[p.column_name])?e[p.column_name]:[e[p.column_name]];for(const e of i){const i=(0,A.extractProps)(e,["id","email"]);try{if("id"in i){const e=a.find((e=>e.id===i.id));e||C.NcError.unprocessableEntity(`User with id '${i.id}' is not part of this workspace`),t.push(e.id)}else if("email"in i){if(!i.email)continue;if(i.email=i.email.trim(),0===i.email.length)continue;const e=a.find((e=>e.email===i.email));e||C.NcError.unprocessableEntity(`User with email '${i.email}' is not part of this workspace`),t.push(e.id)}else C.NcError.unprocessableEntity("Invalid user object")}catch(e){C.NcError.unprocessableEntity(e.message)}}}else if("string"==typeof e[p.column_name]){const i=e[p.column_name].split(",").map((e=>e.trim()));for(const e of i)try{if(0===e.length)continue;if(e.includes("@")){const i=a.find((t=>t.email===e));i||C.NcError.unprocessableEntity(`User with email '${e}' is not part of this workspace`),t.push(i.id)}else{const i=a.find((t=>t.id===e));i||C.NcError.unprocessableEntity(`User with id '${e}' is not part of this workspace`),t.push(i.id)}}catch(e){C.NcError.unprocessableEntity(e.message)}}else U.error(`${e[p.column_name]} is not a valid user input`),C.NcError.unprocessableEntity("Invalid user object");if(0===t.length)e[p.column_name]=null;else{new Set(t).size!==t.length&&C.NcError.unprocessableEntity("Duplicate users not allowed for user field"),(null===(u=p.meta)||void 0===u?void 0:u.is_multi)?e[p.column_name]=t.join(","):t.length>1?C.NcError.unprocessableEntity(`Multiple users not allowed for '${p.title}'`):e[p.column_name]=t[0]}}}else _.UITypes.JSON===p.uidt&&e[p.column_name]&&"string"!=typeof e[p.column_name]&&(e[p.column_name]=JSON.stringify(e[p.column_name]))}now(){return(0,d.default)().utc().format(this.isMySQL||this.isMssql?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")}async getCustomConditionsAndApply(e){const{filters:t,qb:a,view:i}=e;await(0,S.default)(this,[...i?[new v.Filter({children:await v.Filter.rootFilterList(this.context,{viewId:i.id})||[],is_group:!0})]:[],new v.Filter({children:t,is_group:!0,logical_op:"and"})],a)}async getSource(){return this.source||(this.source=await v.Source.get(this.context,this.model.source_id))}async clearFileReferences(e){const{oldData:t,columns:a}=e,i=Array.isArray(t)?t:[t],s=(a||await this.model.getColumns(this.context)).filter((e=>e.uidt===_.UITypes.Attachment));if(0!==s.length)for(const e of s){const t=[];if(i)for(const a of i){let i=a[e.title];if(i)try{"string"==typeof i&&(i=JSON.parse(a[e.title]));for(const e of i)t.push(e)}catch(e){U.error(e)}}0!==t.length&&await v.FileReference.delete(this.context,t.filter((e=>e.id)).map((e=>e.id)))}}}function z(e,t,a=!1){if(!(null==e?void 0:e.length))return;let i=e;return Array.isArray(i)||(i=i.split(/\s*,\s*/)),i.map((e=>{var i,s,r,l;const c={direction:"asc"};return e.startsWith("-")?(c.direction="desc",c.fk_column_id=null===(i=t[e.slice(1)])||void 0===i?void 0:i.id):e.startsWith("~-")?(c.direction="count-desc",c.fk_column_id=null===(s=t[e.slice(2)])||void 0===s?void 0:s.id):e.startsWith("~+")?(c.direction="count-asc",c.fk_column_id=null===(r=t[e.slice(2)])||void 0===r?void 0:r.id):c.fk_column_id=null===(l=t[e.replace(/^\+/,"")])||void 0===l?void 0:l.id,a&&!c.fk_column_id&&C.NcError.fieldNotFound(e.replace(/^[+-]/,"")),new v.Sort(c)}))}function J(e,t,a=!1){if(!e)return[];if(Array.isArray(e))return e.map((e=>J(e,t,a)));if("string"!=typeof e&&a)throw new Error("Invalid filter format. Expected string or array of strings.");let i=[],s=e.indexOf("((");-1===s&&(s=e.indexOf("(~"));let r=s,l=e.indexOf("))");if(-1===s)return e&&"~not"!=e&&(i=e.split(/(?=~(?:or(?:not)?|and(?:not)?|not)\()/)),K(i||[],t,a);for(;-1!=(r=e.substring(0,l).indexOf("((",r+1));)l=e.indexOf("))",l+1);if(-1===l)throw new Error(`${e.substring(0,s+1).slice(-10)} : Closing bracket not found`);const c=e.lastIndexOf("~",s),d=-1!=c?e.substring(c+1,s):"",u=e.substring(0,s);return i.push(...J(u,t,a),new v.Filter({is_group:!0,logical_op:d,children:J(e.substring(s+1,l+1),t)}),...J(e.substring(l+2),t,a)),i}function K(e,t,a){return null==e?void 0:e.map((e=>{var i,s,r;let[l,c,d,u]=(null===(i=e.match(/(?:~(and|or|not))?\((.*?),(\w+),(.*)\)/))||void 0===i?void 0:i.slice(1))||[];switch(c||d||u||([l,c,d,u]=(null===(s=e.match(/(?:~(and|or|not))?\((.*?),(\w+)\)/))||void 0===s?void 0:s.slice(1))||[]),d){case"is":"blank"===u?(d="blank",u=void 0):"notblank"===u&&(d="notblank",u=void 0);break;case"isblank":case"is_blank":d="blank";break;case"isnotblank":case"is_not_blank":case"is_notblank":d="notblank"}let p=null;return t[c]?([_.UITypes.Date,_.UITypes.DateTime,_.UITypes.LastModifiedTime,_.UITypes.CreatedTime].includes(t[c].uidt)?(u=null==u?void 0:u.split(","),p=null==u?void 0:u[0],null==u||u.shift(),u=null==u?void 0:u[0]):"in"===d&&(u=u.split(",")),function(e,t,a){N.COMPARISON_OPS.includes(t)||N.GROUPBY_COMPARISON_OPS.includes(t)||C.NcError.badRequest(`${t} is not supported.`),a&&([_.UITypes.Date,_.UITypes.DateTime,_.UITypes.CreatedTime,_.UITypes.LastModifiedTime].includes(e)||C.NcError.badRequest(`'${a}' is not supported for UI Type'${e}'.`),N.COMPARISON_SUB_OPS.includes(a)||C.NcError.badRequest(`'${a}' is not supported.`),("isWithin"===t&&!N.IS_WITHIN_COMPARISON_SUB_OPS.includes(a)||"isWithin"!==t&&N.IS_WITHIN_COMPARISON_SUB_OPS.includes(a))&&C.NcError.badRequest(`'${a}' is not supported for '${t}'`))}(t[c].uidt,d,p)):a&&C.NcError.invalidFilter(e),new v.Filter(Object.assign(Object.assign({comparison_op:d},p&&{comparison_sub_op:p}),{fk_column_id:null===(r=t[c])||void 0===r?void 0:r.id,logical_op:l,value:u}))}))}function Q(e,{limit:t=25,offset:a=0,ignoreLimit:i=!1}){return e.offset(a),i||e.limit(t),e}function X(e,t,a=!1){const i={};if(t&&"object"==typeof t&&!Array.isArray(t)){for(const s of e){let e;s.id in t?e=s.id:s.title in t?e=s.title:s.column_name in t?e=s.column_name:C.NcError.badRequest(`Primary key column ${s.title} not found in id object`),i[s.column_name]=t[e],a||!s.ai||/^\d+$/.test(t[e])||C.NcError.invalidPrimaryKey(t[e],s.title)}return i}const s=Array.isArray(t)?t:(t+"").split("___");for(let t=0;t<e.length;++t){if("bytea"===e[t].dt)return a=>{var i;a.whereRaw(`?? = decode(?, '${"hex"===(null===(i=e[t].meta)||void 0===i?void 0:i.format)?"hex":"escape"}')`,[e[t].column_name,s[t]])};const a=s[t]+"",r="binary(16)"===e[t].ct&&(36===a.length||32===a.length)?32===a.length?a.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5"):a:null;i[e[t].column_name]=r?Buffer.from(r.replace(/-/g,""),"hex"):s[t]}return i}function Z(e,t){return null==t&&C.NcError.requiredFieldMissing(e.map((e=>e.title)).join(",")),"object"!=typeof t?t:e.map((e=>{var a;return null!==(a=t[e.title])&&void 0!==a?a:t[e.column_name]})).join("___")}function ee(e){return e.some((e=>e.uidt===_.UITypes.Formula))}function te(e,t,a,i,s){if(e)return!e.has(i.title);if(i.system&&(0,_.isCreatedOrLastModifiedByCol)(i))return!0;if(!(s||t instanceof v.Column)){if(!(null==t?void 0:t.show)&&(!i.rqd||i.cdf||i.ai)&&!i.pk&&i.uidt!==_.UITypes.ForeignKey)return!0;if(!(null==a?void 0:a.show_system_fields)&&i.uidt!==_.UITypes.ForeignKey&&!i.pk&&(0,_.isSystemColumn)(i))return!0}return!1}function ae(e,t=!1){return(t?e.slice(0,1):e).map((e=>"object"==typeof e?JSON.stringify(e):`${e}`))}function ie(e,t){return t.columns.find((t=>{var a,i,s,r,l;return(null===(a=e.colOptions)||void 0===a?void 0:a.type)===_.RelationTypes.MANY_TO_MANY?e.colOptions.fk_mm_child_column_id===(null===(i=t.colOptions)||void 0===i?void 0:i.fk_mm_parent_column_id)&&e.colOptions.fk_mm_parent_column_id===(null===(s=t.colOptions)||void 0===s?void 0:s.fk_mm_child_column_id):e.colOptions.fk_child_column_id===(null===(r=t.colOptions)||void 0===r?void 0:r.fk_child_column_id)&&e.colOptions.fk_parent_column_id===(null===(l=t.colOptions)||void 0===l?void 0:l.fk_parent_column_id)}))}t.BaseModelSqlv2=BaseModelSqlv2,BaseModelSqlv2.config=D.defaultLimitConfig},25244:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Knex=void 0,t.XKnex=k;const s=a(50536);Object.defineProperty(t,"Knex",{enumerable:!0,get:function(){return s.Knex}});const r=a(36560),l=i(a(44578)),c=i(a(22996)),d=a(43820),u=701,p=1082,m=1114,_=1184,f=1700;r.types.setTypeParser(p,(e=>e)),r.types.setTypeParser(m,(e=>l.default.utc(e).format("YYYY-MM-DD HH:mm:ssZ"))),r.types.setTypeParser(_,(e=>(0,l.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ")));const h=e=>parseFloat(e);r.defaults.parseInt8=!0,r.types.setTypeParser(u,h),r.types.setTypeParser(f,h);const g={eq:"=",lt:"<",gt:">",le:"<=",ge:">=",not:"!=",like:"like"};function y(e){if(!e)return[];let t=[],a=e.indexOf("((");-1===a&&(a=e.indexOf("(~"));let i=a,s=e.indexOf("))");if(-1===a)return e&&"~not"!=e&&(t=e.split(/(?=~(?:or(?:not)?|and(?:not)?|not)\()/)),t||[];for(;-1!=(i=e.substring(0,s).indexOf("((",i+1));)s=e.indexOf("))",s+1);if(-1===s)throw new Error(`${e.substring(0,a+1).slice(-10)} : Closing bracket not found`);const r=e.lastIndexOf("~",a),l=-1!=r?e.substring(r+1,a):"",c=e.substring(0,a);return t.push(...y(c),{operator:l,conditions:y(e.substring(a+1,s+1))},...y(e.substring(s+2))),t}const b=function(e,t,a,i=!1){var s,r;const l=null===(r=null===(s=null==a?void 0:a.client)||void 0===s?void 0:s.config)||void 0===r?void 0:r.client,c=Object.assign(Object.assign({},g),"pg"===l?{like:"ilike"}:{}),d=i?"Having":"Where",u=i?"having":"where";return e.forEach((i=>{if(Array.isArray(i))a[u]((function(){b(i,t,this)}));else if("object"==typeof i)switch(i.operator){case"or":a[`or${d}`]((function(){b(i.conditions,t,this)}));break;case"and":a[`and${d}`]((function(){b(i.conditions,t,this)}));break;case"andnot":a[`and${d}Not`]((function(){b(i.conditions,t,this)}));break;case"ornot":a[`or${d}Not`]((function(){b(i.conditions,t,this)}));break;case"not":a[`${u}Not`]((function(){b(i.conditions,t,this)}));break;default:a[`${u}`]((function(){b(i.conditions,t,this)}))}else{if("string"!=typeof i)throw new Error("appendWhereCondition : grammar error "+e);{const e=i.match(/^(?:~(\w+))?\(([\w ]+),(\w+),(.*?)\)(?:~(?:or|and|not))?$/);if(!e)throw new Error(`${i} : not a valid syntax`);switch(e[3]){case"in":switch(e[1]||""){case"or":a[`or${d}`]((a=>a[`${u}In`](t[e[2]]||e[2],e[4].split(","))));break;case"and":case"":a[`${u}In`](t[e[2]]||e[2],e[4].split(","));break;case"andnot":case"not":a[`${u}NotIn`](t[e[2]]||e[2],e[4].split(","));break;case"ornot":a[`or${d}`]((a=>a[`${u}NotIn`](t[e[2]]||e[2],e[4].split(","))));break;default:throw new Error(`${e[1]} : Invalid operation.`)}break;case"is":if("null"!=e[4])throw new Error(`${e[4]} : not a valid value since 'is' & 'isnot' only supports value null`);switch(e[1]||""){case"or":a[`or${d}`]((a=>a[`${u}Null`](t[e[2]]||e[2])));break;case"and":case"":a[`${u}Null`](t[e[2]]||e[2]);break;case"andnot":case"not":a[`${u}NotNull`](t[e[2]]||e[2]);break;case"ornot":a[`or${d}`]((a=>a[`${u}NotNull`](t[e[2]]||e[2])));break;default:throw new Error(`${e[1]} : Invalid operation.`)}break;case"isnot":if("null"!=e[4])throw new Error(`${e[4]} : not a valid value since 'is' & 'isnot' only supports value null`);switch(e[1]||""){case"or":case"ornot":a[`or${d}`]((a=>a[`${u}NotNull`](t[e[2]]||e[2])));break;case"and":case"andnot":case"":a[`${u}NotNull`](t[e[2]]||e[2]);break;case"not":a[`${u}Null`](t[e[2]]||e[2]);break;default:throw new Error(`${e[1]} : Invalid operation.`)}break;case"btw":{const i=e[4].split(",");if(2!==i.length)throw new Error(`${e[4]} : not a valid value.${i.length>2?" Between accepts only 2 values":" Between requires 2 values"}`);switch(e[1]||""){case"or":a[`or${d}`]((a=>a[`${u}Between`](t[e[2]]||e[2],i)));break;case"and":case"":a[`${u}Between`](t[e[2]]||e[2],i);break;case"andnot":case"not":a[`${u}NotBetween`](t[e[2]]||e[2],i);break;case"ornot":a[`or${d}`]((a=>a[`${u}NotBetween`](t[e[2]]||e[2],i)));break;default:throw new Error(`${e[1]} : Invalid operation.`)}}break;case"nbtw":{const i=e[4].split(",");if(2!==i.length)throw new Error(`${e[4]} : not a valid value.${i.length>2?" Between accepts only 2 values":" Between requires 2 values"}`);switch(e[1]||""){case"or":a[`or${d}`]((a=>a[`${u}NotBetween`](t[e[2]]||e[2],i)));break;case"and":case"":a[`${u}NotBetween`](t[e[2]]||e[2],i);break;case"andnot":case"not":a[`${u}Between`](t[e[2]]||e[2],i);break;case"ornot":a[`or${d}`]((a=>a[`${u}Between`](t[e[2]]||e[2],i)));break;default:throw new Error(`${t[e[2]]||e[2]} : Invalid operation.`)}}break;default:if(!(e[3]in c))throw new Error(`${e[3]} : Invalid comparison operator`);switch("="===c[e[3]]&&["true","false"].includes(e[4])&&(e[4]="true"===e[4]),e[1]||""){case"or":a[`or${d}`](t[e[2]]||e[2],c[e[3]],e[4]);break;case"and":a[`and${d}`](t[e[2]]||e[2],c[e[3]],e[4]);break;case"andnot":a[`and${d}Not`](t[e[2]]||e[2],c[e[3]],e[4]);break;case"ornot":a[`or${d}Not`](t[e[2]]||e[2],c[e[3]],e[4]);break;case"not":a[`${u}Not`](t[e[2]]||e[2],c[e[3]],e[4]);break;case"":{const i=t[e[2]]||e[2],s=c[e[3]],r=e[4];"like"==e[3]&&"pg"===l?a[`${u}`](null==a?void 0:a.client.raw(`??::TEXT ${s} '${r}'`,[i])):a[`${u}`](i,s,r)}break;default:throw new Error(`${e[1]||""} Invalid operation.`)}}}}})),a};s.knex.QueryBuilder.extend("xwhere",(function(e,t){const a=y(e);return b(a,t||{},this)})),s.knex.QueryBuilder.extend("concat",(function(e){var t,a;switch(null===(a=null===(t=null==this?void 0:this.client)||void 0===t?void 0:t.config)||void 0===a?void 0:a.client){case"pg":this.select(this.client.raw("STRING_AGG(??::character varying , ',')",[e]));break;case"mysql":case"mysql2":this.select(this.client.raw("GROUP_CONCAT(?? SEPARATOR ',')",[e]));break;case"mssql":this.select(this.client.raw("STRING_AGG(??, ',')",[e]));break;case"sqlite3":this.select(this.client.raw("GROUP_CONCAT(?? , ',')",[e]))}return this})),s.knex.QueryBuilder.extend("xhaving",(function(e,t){const a=y(e);return b(a,t||{},this,!0)})),s.knex.QueryBuilder.extend("condition",(function(e,t){return e&&"object"==typeof e?w(e,t||{},this):this}));const w=(e,t,a,i)=>{const s=Object.entries(e);for(const[e,r]of s)switch(e){case"_or":a=a.where((function(){for(const e of r)this.orWhere((function(){return w(e,t,this)}))}));break;case"_and":a=a.where((function(){for(const e of r)this.andWhere((function(){return w(e,t,this)}))}));break;case"_not":a=a.whereNot((function(){return w(r,t,this)}));break;default:if(!r||"object"!=typeof r||r instanceof Date||Array.isArray(r)){const s=t[i]||i;switch(e){case"eq":a=a.where(s,r);break;case"neq":a=a.whereNot(s,r);break;case"like":a=a.where(s,"like",r);break;case"nlike":a=a.whereNot(s,"like",r);break;case"gt":a=a.where(s,">",r);break;case"ge":a=a.where(s,">=",r);break;case"lt":a=a.where(s,"<",r);break;case"le":a=a.where(s,"<=",r);break;case"in":a=a.whereIn(s,r);break;case"nin":a=a.whereNotIn(s,r);break;default:d.NcError.metaError({message:`Found invalid conditional operator "${e}" in expression`,sql:""})}}else a=w(r,t,a,e)}return a};function v(e,t,a,i,s){var r,l,c,d,u,p;this._tn=this._tn||{};const m=this;let _=Object.entries(e),f=i||t._single.table;if(s=s||f,"object"==typeof e&&"relationType"in e)switch(e.relationType){case"hm":{const d=null===(c=null===(l=null===(r=null==this?void 0:this.models)||void 0===r?void 0:r[i||t._single.table])||void 0===l?void 0:l.hasManyRelations)||void 0===c?void 0:c.find((({tn:e})=>a.toLowerCase()===e.toLowerCase()));d&&(this._tn[d.tn]=(this._tn[d.tn]||0)+1,e.relationType={alias:`${this._tn[d.tn]?this._tn[d.tn]+"___":""}${d.tn}`,type:e.relationType},t=t.join(`${d.tn} as ${e.relationType._tn}`,`${e.relationType._tn}.${d.cn}`,"=",`${s}.${d.rcn}`),f=d.tn,_=_.filter((e=>"relationType"!==e[0])),s=e.relationType._tn)}break;case"bt":{const r=null===(p=null===(u=null===(d=null==this?void 0:this.models)||void 0===d?void 0:d[i||t._single.table])||void 0===u?void 0:u.belongsToRelations)||void 0===p?void 0:p.find((({rtn:e})=>a.toLowerCase()===e.toLowerCase()));r&&(this._tn[r.rtn]=(this._tn[r.rtn]||0)+1,e.relationType={alias:`${this._tn[r.rtn]}___${r.rtn}`,type:e.relationType},t=t.join(`${r.rtn} as ${e.relationType._tn}`,`${s}.${r.cn}`,"=",`${e.relationType._tn}.${r.rcn}`),f=r.rtn,_=_.filter((e=>"relationType"!==e[0])),s=e.relationType._tn)}}for(const[e,a]of _)switch(e){case"_or":case"_and":for(const e of a)t=v.call(m,e,t,null,f,s);break;case"_not":t=v.call(m,a,t,null,f,s);break;default:"object"!=typeof a||Array.isArray(a)||(t=v.call(m,a,t,e,f,s))}return t}function T(e,t,a,i,s){var r,l,c,d,u,p;const m=this;let _=i||t._single.table;if(s=s||_,"relationType"in e)switch(e.relationType.type){case"hm":{const d=null===(c=null===(l=null===(r=null==this?void 0:this.models)||void 0===r?void 0:r[i||t._single.table])||void 0===l?void 0:l.hasManyRelations)||void 0===c?void 0:c.find((({tn:e})=>a.toLowerCase()===e.toLowerCase()));d&&(_=d.tn,s=e.relationType._tn)}break;case"bt":{const r=null===(p=null===(u=null===(d=null==this?void 0:this.models)||void 0===d?void 0:d[i||t._single.table])||void 0===u?void 0:u.belongsToRelations)||void 0===p?void 0:p.find((({rtn:e})=>a.toLowerCase()===e.toLowerCase()));r&&(_=r.rtn,s=e.relationType._tn)}}const f=Object.entries(e).filter((e=>"relationType"!==e[0])),h=`${s}.`;for(const[e,i]of f)switch(e){case"_or":t=t.where((function(){for(const e of i)this.orWhere((function(){return T.call(m,e,this,null,_,s)}))}));break;case"_and":t=t.where((function(){for(const e of i)this.andWhere((function(){T.call(m,e,this,null,_,s)}))}));break;case"_not":t=t.whereNot((function(){return T.call(m,i,this,null,_,s)}));break;default:if("object"!=typeof i||Array.isArray(i))switch(e){case"eq":t=t.where(h+a,i);break;case"neq":t=t.whereNot(h+a,i);break;case"like":t=t.where(h+a,"like",i);break;case"nlike":t=t.whereNot(h+a,"like",i);break;case"gt":t=t.where(h+a,">",i);break;case"ge":t=t.where(a,">=",i);break;case"lt":t=t.where(a,"<",i);break;case"le":t=t.where(a,"<=",i);break;case"in":t=t.whereIn(a,i);break;case"nin":t=t.whereNotIn(a,i)}else t=T.call(m,i,t,e,_,s)}return t}function k(e,t){"sqlite3"===(null==e?void 0:e.client)&&(e.useNullAsDefault=!0);const a=(0,s.knex)(e),i=a.raw;return Object.defineProperties(a,{raw:{enumerable:!0,value:(...e)=>i.apply(a,e)},clientType:{enumerable:!0,value:()=>{var t,a,i,s,r;return"string"==typeof e?null!==(t=e.match(/^(\w+):/))&&void 0!==t?t:[1]:"string"==typeof e.client?e.client:(null===(i=null===(a=e.client)||void 0===a?void 0:a.prototype)||void 0===i?void 0:i.dialect)||(null===(r=null===(s=e.client)||void 0===s?void 0:s.prototype)||void 0===r?void 0:r.driverName)}},searchPath:{enumerable:!0,value:()=>{var t;return null===(t=null==e?void 0:e.searchPath)||void 0===t?void 0:t[0]}},extDb:{enumerable:!0,value:t},isExternal:{enumerable:!1,value:!!t&&"true"!==process.env.NC_DISABLE_MUX}}),a}function S(e,t,a,i,s){var r,l,c,d,u,p;const m=this;let _=i||t._single.table;if(s=s||_,"relationType"in e)switch(e.relationType.type){case"hm":{const d=null===(c=null===(l=null===(r=null==this?void 0:this.models)||void 0===r?void 0:r[i||t._single.table])||void 0===l?void 0:l.hasManyRelations)||void 0===c?void 0:c.find((({tn:e})=>a.toLowerCase()===e.toLowerCase()));d&&(_=d.tn,s=e.relationType._tn)}break;case"bt":{const r=null===(p=null===(u=null===(d=null==this?void 0:this.models)||void 0===d?void 0:d[i||t._single.table])||void 0===u?void 0:u.belongsToRelations)||void 0===p?void 0:p.find((({rtn:e})=>a.toLowerCase()===e.toLowerCase()));r&&(_=r.rtn,s=e.relationType._tn)}}const f=Object.entries(e).filter((e=>"relationType"!==e[0])),h=`${s}.`;for(const[e,i]of f)switch(e){case"_or":t=t.where((function(){for(const e of i)this.orWhere((function(){return T.call(m,e,this,null,_,s)}))}));break;case"_and":t=t.where((function(){for(const e of i)this.andWhere((function(){T.call(m,e,this,null,_,s)}))}));break;case"_not":t=t.whereNot((function(){return T.call(m,i,this,null,_,s)}));break;default:if("object"!=typeof i||Array.isArray(i))switch(e){case"eq":t=t.where(h+a,i);break;case"neq":t=t.whereNot(h+a,i);break;case"like":t=t.where(h+a,"like",i);break;case"nlike":t=t.whereNot(h+a,"like",i);break;case"gt":t=t.where(h+a,">",i);break;case"ge":t=t.where(a,">=",i);break;case"lt":t=t.where(a,"<",i);break;case"le":t=t.where(a,"<=",i);break;case"in":t=t.whereIn(a,i);break;case"nin":t=t.whereNotIn(a,i)}else t=T.call(m,i,t,e,_,s)}return t}s.knex.QueryBuilder.extend("conditionGraph",(function(e){if(!e)return this;const{condition:t,models:a}=e;if(!t||"object"!=typeof t)return this;const i=JSON.parse(JSON.stringify(t)),s=v.call({models:a},i,this);return T.call({models:a},i,s)})),s.knex.QueryBuilder.extend("conditionGraphv2",(function(e){if(!e)return this;const{condition:t,models:a}=e;if(!t||"object"!=typeof t)return this;const i=JSON.parse(JSON.stringify(t));return S.call({models:a},i)})),s.knex.QueryBuilder.extend("hasWhere",(function(){return this._statements.some((e=>"where"===e.grouping))})),s.knex.QueryBuilder.extend("conditionv2",(function(e){return e&&"object"==typeof e?M(e,this):this}));const M=(e,t)=>{let a;if(a=e instanceof c.default?e:new c.default(e),a.is_group)t=t.where((function(){var e;const t=a.children;if("or"===(null===(e=a.logical_op)||void 0===e?void 0:e.toLowerCase()))for(const e of t||[])this.orWhere((function(){return M(e,this)}));else for(const e of t||[])this.andWhere((function(){return M(e,this)}))}));else{const e=a.column.column_name,i=a.value;switch(a.comparison_op){case"eq":t=t.where(e,i);break;case"neq":t=t.whereNot(e,i);break;case"like":t=t.where(e,"like",i);break;case"nlike":t=t.whereNot(e,"like",i);break;case"gt":t=t.where(e,">",i);break;case"ge":t=t.where(e,">=",i);break;case"lt":t=t.where(e,"<",i);break;case"le":t=t.where(e,"<=",i)}}return t};t.default=k},799:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({baseModelSqlv2:e,aggregation:t,column:a,alias:i}){var f,h;if(!t||!a)return;const{context:g,dbDriver:y,model:b}=e,w=_(a,t);"unknown"===w&&l.NcError.notImplemented(`Aggregation ${t} is not implemented yet`);a.uidt!==s.UITypes.Barcode&&a.uidt!==s.UITypes.QrCode||(a=new r.Column(Object.assign(Object.assign({},await a.getColOptions(g).then((e=>e.getValueColumn(g)))),{id:a.id})));let v=a.column_name;a.uidt!==s.UITypes.CreatedTime||a.column_name||(v="created_at");a.uidt!==s.UITypes.LastModifiedTime||a.column_name||(v="updated_at");a.uidt!==s.UITypes.CreatedBy||a.column_name||(v="created_by");a.uidt!==s.UITypes.LastModifiedBy||a.column_name||(v="updated_by");const T=null===(h=null===(f=a.colOptions)||void 0===f?void 0:f.parsed_tree)||void 0===h?void 0:h.dataType;switch(a.uidt){case s.UITypes.Links:case s.UITypes.Rollup:v=(await(0,c.default)({baseModelSqlv2:e,knex:y,columnOptions:await a.getColOptions(g)})).builder;break;case s.UITypes.Formula:(await a.getColOptions(g)).error?t=s.CommonAggregations.None:v=(await e.getSelectQueryBuilderForFormula(a)).builder;break;case s.UITypes.LinkToAnotherRecord:case s.UITypes.Lookup:v=(await(0,d.default)({baseModelSqlv2:e,column:a,alias:null,model:b,isAggregation:!0})).builder}if("pg"===y.client.config.client)return(0,u.genPgAggregateQuery)({column:a,baseModelSqlv2:e,aggregation:t,column_query:v,parsedFormulaType:T,aggType:w,alias:i});if("mysql2"===y.client.config.client)return(0,p.genMysql2AggregatedQuery)({column:a,baseModelSqlv2:e,aggregation:t,column_query:v,parsedFormulaType:T,aggType:w,alias:i});if("sqlite3"===y.client.config.client)return(0,m.genSqlite3AggregateQuery)({column:a,baseModelSqlv2:e,aggregation:t,column_query:v,parsedFormulaType:T,aggType:w,alias:i});l.NcError.notImplemented(`Aggregation is not implemented for ${y.client.config.client} yet.`)};const s=a(71040),r=a(19684),l=a(43820),c=i(a(98548)),d=i(a(73172)),u=a(88020),p=a(72136),m=a(9436),_=(e,t)=>{var a;return(0,s.getAvailableAggregations)(e.uidt,null===(a=e.colOptions)||void 0===a?void 0:a.parsed_tree).includes(t)||l.NcError.badRequest(`Aggregation ${t} is not available for column type ${e.uidt}`),Object.values(s.BooleanAggregations).includes(t)?"boolean":Object.values(s.CommonAggregations).includes(t)?"common":Object.values(s.DateAggregations).includes(t)?"date":Object.values(s.NumericalAggregations).includes(t)?"numerical":Object.values(s.AttachmentAggregations).includes(t)?"attachment":"unknown"}},72136:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genMysql2AggregatedQuery=function({column:e,baseModelSqlv2:t,aggregation:a,column_query:s,parsedFormulaType:r,aggType:l,alias:c}){let d;const{dbDriver:u}=t;let p="''";[i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Time,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)?p="NULL":[i.UITypes.Rating].includes(e.uidt)&&(p=0);if("common"===l)switch(a){case i.CommonAggregations.Count:d=u.raw("COUNT(*)");break;case i.CommonAggregations.CountEmpty:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("SUM(CASE WHEN JSON_LENGTH(??) IS NULL THEN 1 ELSE 0 END)",[s]);break}d=u.raw(`SUM(CASE WHEN (??) IS NULL OR (??) = ${p} THEN 1 ELSE 0 END)`,[s,s]);break;case i.CommonAggregations.CountFilled:if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Time,i.UITypes.JSON,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("SUM(CASE WHEN (??) IS NOT NULL THEN 1 ELSE 0 END)",[s]);break}d=u.raw(`SUM(CASE WHEN (??) IS NOT NULL AND (??) != ${p} THEN 1 ELSE 0 END)`,[s,s]);break;case i.CommonAggregations.CountUnique:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("COUNT(DISTINCT JSON_UNQUOTE(JSON_EXTRACT(??, '$')))",[s]);break}if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Time,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("COUNT(DISTINCT CASE WHEN (??) IS NOT NULL THEN (??) END)",[s,s]);break}d=u.raw(`COUNT(DISTINCT CASE WHEN ?? IS NOT NULL AND ?? != ${p} THEN ?? END)`,[s,s,s]);break;case i.CommonAggregations.PercentEmpty:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("(SUM(CASE WHEN JSON_LENGTH(??) IS NULL THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0))",[s]);break}d=u.raw(`(SUM(CASE WHEN (??) IS NULL OR (??) = ${p} THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0))`,[s,s]);break;case i.CommonAggregations.PercentFilled:if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Time,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.JSON,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("(SUM(CASE WHEN (??) IS NOT NULL THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0))",[s]);break}d=u.raw(`(SUM(CASE WHEN (??) IS NOT NULL AND (??) != ${p} THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0))`,[s,s]);break;case i.CommonAggregations.PercentUnique:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("COUNT(DISTINCT JSON_UNQUOTE(JSON_EXTRACT((??), '$'))) * 100.0 / NULLIF(COUNT(*), 0)",[s]);break}if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Time,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("(COUNT(DISTINCT CASE WHEN ?? IS NOT NULL THEN ?? END) * 100.0 / NULLIF(COUNT(*), 0))",[s,s]);break}d=u.raw(`(COUNT(DISTINCT CASE WHEN ?? IS NOT NULL AND ?? != ${p} THEN ?? END) * 100.0 / NULLIF(COUNT(*), 0))`,[s,s,s]);case i.CommonAggregations.None:}else if("numerical"===l)switch(a){case i.NumericalAggregations.Avg:if(e.uidt===i.UITypes.Rating){d=u.raw(`AVG(CASE WHEN (??) != ${p} THEN (??) ELSE NULL END)`,[s,s]);break}d=u.raw("AVG((??))",[s]);break;case i.NumericalAggregations.Max:d=u.raw("MAX((??))",[s]);break;case i.NumericalAggregations.Min:if(e.uidt===i.UITypes.Rating){d=u.raw(`MIN(CASE WHEN (??) != ${p} THEN (??) ELSE NULL END)`,[s,s]);break}d=u.raw("MIN((??))",[s]);break;case i.NumericalAggregations.Sum:d=u.raw("SUM((??)) ",[s]);break;case i.NumericalAggregations.StandardDeviation:if(e.uidt===i.UITypes.Rating){d=u.raw("STDDEV((??))",[s]);break}d=u.raw("STDDEV((??))",[s]);break;case i.NumericalAggregations.Range:if(e.uidt===i.UITypes.Rating){d=u.raw(`(MAX((??)) - MIN(CASE WHEN (??) != ${p} THEN (??) ELSE NULL END))`,[s,s,s]);break}d=u.raw("(MAX((??)) - MIN((??)))",[s,s]);break;case i.NumericalAggregations.Median:d=u.raw("\n  (\n    SELECT AVG(??)\n    FROM (\n      SELECT ??\n      FROM ??\n      ORDER BY ??\n      LIMIT 2 - (SELECT COUNT(*) FROM ??) % 2    -- Handle even/odd number of rows\n      OFFSET (SELECT (COUNT(*) - 1) / 2 FROM ??) -- Calculate the median offset\n    ) AS median_subquery\n  )",[s,s,t.tnPath,s,t.tnPath,t.tnPath])}else if("boolean"===l)switch(a){case i.BooleanAggregations.Checked:d=u.raw("SUM(CASE WHEN ?? = true THEN 1 ELSE 0 END)",[s]);break;case i.BooleanAggregations.Unchecked:d=u.raw("SUM(CASE WHEN ?? = false OR ?? IS NULL THEN 1 ELSE 0 END)",[s,s]);break;case i.BooleanAggregations.PercentChecked:d=u.raw("(SUM(CASE WHEN ?? = true THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0))",[s]);break;case i.BooleanAggregations.PercentUnchecked:d=u.raw("(SUM(CASE WHEN ?? = false OR ?? IS NULL THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0))",[s,s])}else if("date"===l)switch(a){case i.DateAggregations.EarliestDate:d=u.raw("MIN(??)",[s]);break;case i.DateAggregations.LatestDate:d=u.raw("MAX(??)",[s]);break;case i.DateAggregations.DateRange:d=u.raw("TIMESTAMPDIFF(DAY, MIN(??), MAX(??))",[s,s]);break;case i.DateAggregations.MonthRange:d=u.raw("PERIOD_DIFF(DATE_FORMAT(MAX(??), '%Y%m'), DATE_FORMAT(MIN(??), '%Y%m'))",[s,s])}else if("attachment"===l&&a===i.AttachmentAggregations.AttachmentSize)d=u.raw("(SELECT SUM(JSON_EXTRACT(json_object, '$.size')) FROM ?? CROSS JOIN JSON_TABLE(CAST(?? AS JSON), '$[*]' COLUMNS (json_object JSON PATH '$')) AS json_array)",[t.tnPath,s]);c&&d&&([i.AllAggregations.EarliestDate,i.AllAggregations.LatestDate].includes(a)||(d=u.raw("COALESCE(??, 0)",[d])),d=u.raw("?? AS ??",[d,c]));return null==d?void 0:d.toQuery()};const i=a(71040)},88020:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genPgAggregateQuery=function({column:e,baseModelSqlv2:t,aggregation:a,column_query:s,parsedFormulaType:r,aggType:l,alias:c}){let d;const{dbDriver:u}=t;let p="''";[i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Time,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)?p="NULL":[i.UITypes.Rating].includes(e.uidt)&&(p=0);if("common"===l)switch(a){case i.CommonAggregations.Count:d=u.raw("COUNT(*)");break;case i.CommonAggregations.CountEmpty:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("COUNT(*) FILTER (WHERE (??) IS NULL)",[s]);break}d=u.raw(`COUNT(*) FILTER (WHERE (??) IS NULL OR (??) = ${p})`,[s,s]);break;case i.CommonAggregations.CountFilled:if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Time,i.UITypes.JSON,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("COUNT(*) FILTER (WHERE (??) IS NOT NULL)",[s]);break}d=u.raw(`COUNT(*) FILTER (WHERE (??) IS NOT NULL AND (??) != ${p})`,[s,s]);break;case i.CommonAggregations.CountUnique:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("COUNT(DISTINCT ((??)::text)) FILTER (WHERE (??) IS NOT NULL)",[s,s]);break}if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Time,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("COUNT(DISTINCT (??)) FILTER (WHERE (??) IS NOT NULL)",[s,s]);break}d=u.raw(`COUNT(DISTINCT (??)) FILTER (WHERE (??) IS NOT NULL AND (??) != ${p})`,[s,s,s]);break;case i.CommonAggregations.PercentEmpty:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("(COUNT(*) FILTER (WHERE (??) IS NULL) * 100.0 / NULLIF(COUNT(*), 0))",[s]);break}d=u.raw(`(COUNT(*) FILTER (WHERE (??) IS NULL OR (??) = ${p}) * 100.0 / NULLIF(COUNT(*), 0))`,[s,s]);break;case i.CommonAggregations.PercentFilled:if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Time,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.JSON,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("(COUNT(*) FILTER (WHERE (??) IS NOT NULL) * 100.0 / NULLIF(COUNT(*), 0))",[s]);break}d=u.raw(`(COUNT(*) FILTER (WHERE (??) IS NOT NULL AND (??) != ${p}) * 100.0 / NULLIF(COUNT(*), 0))`,[s,s]);break;case i.CommonAggregations.PercentUnique:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("(COUNT(DISTINCT ((??)::text)) FILTER (WHERE (??) IS NOT NULL) * 100.0 / NULLIF(COUNT(*), 0))",[s,s]);break}if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Time,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("(COUNT(DISTINCT (??)) FILTER (WHERE (??) IS NOT NULL) * 100.0 / NULLIF(COUNT(*), 0))",[s,s]);break}d=u.raw(`(COUNT(DISTINCT (??)) FILTER (WHERE (??) IS NOT NULL AND (??) != ${p}) * 100.0 / NULLIF(COUNT(*), 0))`,[s,s,s]);case i.CommonAggregations.None:}else if("numerical"===l)switch(a){case i.NumericalAggregations.Avg:if(e.uidt===i.UITypes.Rating){d=u.raw("AVG((??)) FILTER (WHERE (??) != ??)",[s,s,p]);break}d=u.raw("AVG((??))",[s]);break;case i.NumericalAggregations.Max:d=u.raw("MAX((??))",[s]);break;case i.NumericalAggregations.Min:if(e.uidt===i.UITypes.Rating){d=u.raw("MIN((??)) FILTER (WHERE (??) != ??)",[s,s,p]);break}d=u.raw("MIN((??))",[s]);break;case i.NumericalAggregations.Sum:d=u.raw("SUM((??))",[s]);break;case i.NumericalAggregations.StandardDeviation:if(e.uidt===i.UITypes.Rating){d=u.raw("stddev_pop((??)) FILTER (WHERE (??) != ??) ",[s,s,p]);break}d=u.raw("stddev_pop((??))",[s]);break;case i.NumericalAggregations.Range:d=u.raw("MAX((??)) - MIN((??))",[s,s]);break;case i.NumericalAggregations.Median:d=u.raw("percentile_cont(0.5) within group (order by (??))",[s])}else if("boolean"===l)switch(a){case i.BooleanAggregations.Checked:d=u.raw("COUNT(*) FILTER (WHERE (??) = true)",[s]);break;case i.BooleanAggregations.Unchecked:d=u.raw("COUNT(*) FILTER (WHERE (??) = false OR (??) = NULL)",[s,s]);break;case i.BooleanAggregations.PercentChecked:d=u.raw("(COUNT(*) FILTER (WHERE (??) = true) * 100.0 / NULLIF(COUNT(*), 0))",[s]);break;case i.BooleanAggregations.PercentUnchecked:d=u.raw("(COUNT(*) FILTER (WHERE (??) = false OR (??) = NULL) * 100.0 / NULLIF(COUNT(*), 0))",[s,s])}else if("date"===l)switch(a){case i.DateAggregations.EarliestDate:d=u.raw("MIN((??))",[s]);break;case i.DateAggregations.LatestDate:d=u.raw("MAX((??))",[s]);break;case i.DateAggregations.DateRange:d=u.raw("MAX((??)::date) - MIN((??)::date)",[s,s]);break;case i.DateAggregations.MonthRange:d=u.raw("DATE_PART('year', AGE(MAX((??)::date), MIN((??)::date))) * 12 + \n         DATE_PART('month', AGE(MAX((??)::date), MIN((??)::date))) ",[s,s,s,s])}else if("attachment"===l&&a===i.AttachmentAggregations.AttachmentSize)d=u.raw("SUM((SELECT COALESCE(SUM((json_object ->> 'size')::int), 0)FROM jsonb_array_elements(??::jsonb) AS json_array(json_object)))",[s]);c&&d&&([i.AllAggregations.EarliestDate,i.AllAggregations.LatestDate].includes(a)||(d=u.raw("COALESCE(??, 0)",[d])),d=u.raw("?? AS ??",[d,c]));return null==d?void 0:d.toQuery()};const i=a(71040)},9436:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genSqlite3AggregateQuery=function({column:e,baseModelSqlv2:t,aggregation:a,column_query:s,parsedFormulaType:r,aggType:l,alias:c}){let d;const{dbDriver:u}=t;let p="''";[i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Time,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)?p="NULL":[i.UITypes.Rating].includes(e.uidt)&&(p=0);if("common"===l)switch(a){case i.CommonAggregations.Count:d=u.raw("COUNT(*)");break;case i.CommonAggregations.CountEmpty:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("SUM(CASE WHEN json_array_length(??) IS NULL THEN 1 ELSE 0 END)",[s]);break}d=u.raw(`SUM(CASE WHEN (??) IS NULL OR (??) = ${p} THEN 1 ELSE 0 END)`,[s,s]);break;case i.CommonAggregations.CountFilled:if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Time,i.UITypes.JSON,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("SUM(CASE WHEN (??) IS NOT NULL THEN 1 ELSE 0 END)",[s]);break}d=u.raw(`SUM(CASE WHEN (??) IS NOT NULL AND (??) != ${p} THEN 1 ELSE 0 END)`,[s,s]);break;case i.CommonAggregations.CountUnique:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("COUNT(DISTINCT json_extract(??, '$'))",[s]);break}if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Time,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("COUNT(DISTINCT CASE WHEN (??) IS NOT NULL THEN (??) END)",[s,s]);break}d=u.raw(`COUNT(DISTINCT CASE WHEN (??) IS NOT NULL AND (??) != ${p} THEN ?? END)`,[s,s,s]);break;case i.CommonAggregations.PercentEmpty:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("(SUM(CASE WHEN json_array_length(??) IS NULL THEN 1 ELSE 0 END) * 100.0 / IFNULL(COUNT(*), 0))",[s]);break}d=u.raw(`(SUM(CASE WHEN (??) IS NULL OR (??) = ${p} THEN 1 ELSE 0 END) * 100.0 / IFNULL(COUNT(*), 0))`,[s,s]);break;case i.CommonAggregations.PercentFilled:if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Time,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.JSON,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("(SUM(CASE WHEN (??) IS NOT NULL THEN 1 ELSE 0 END) * 100.0 / IFNULL(COUNT(*), 0))",[s]);break}d=u.raw(`(SUM(CASE WHEN (??) IS NOT NULL AND (??) != ${p} THEN 1 ELSE 0 END) * 100.0 / IFNULL(COUNT(*), 0))`,[s,s]);break;case i.CommonAggregations.PercentUnique:if([i.UITypes.JSON].includes(e.uidt)){d=u.raw("COUNT(DISTINCT json_extract((??), '$')) * 100.0 / IFNULL(COUNT(*), 0)",[s]);break}if([i.UITypes.CreatedTime,i.UITypes.LastModifiedTime,i.UITypes.Date,i.UITypes.DateTime,i.UITypes.Number,i.UITypes.Decimal,i.UITypes.Year,i.UITypes.Time,i.UITypes.Currency,i.UITypes.Duration,i.UITypes.Percent,i.UITypes.Rollup,i.UITypes.Links,i.UITypes.ID,i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||[i.FormulaDataTypes.DATE,i.FormulaDataTypes.NUMERIC].includes(r)){d=u.raw("(COUNT(DISTINCT CASE WHEN (??) IS NOT NULL THEN (??) END) * 100.0 / IFNULL(COUNT(*), 0))",[s,s]);break}d=u.raw(`(COUNT(DISTINCT CASE WHEN (??) IS NOT NULL AND (??) != ${p} THEN (??) END) * 100.0 / IFNULL(COUNT(*), 0))`,[s,s,s]);case i.CommonAggregations.None:}else if("numerical"===l)switch(a){case i.NumericalAggregations.Avg:if(e.uidt===i.UITypes.Rating){d=u.raw(`AVG(CASE WHEN (??) != ${p} THEN (??) ELSE NULL END)`,[s,s]);break}d=u.raw("AVG((??))",[s]);break;case i.NumericalAggregations.Max:d=u.raw("MAX((??))",[s]);break;case i.NumericalAggregations.Min:if(e.uidt===i.UITypes.Rating){d=u.raw(`MIN(CASE WHEN (??) != ${p} THEN (??) ELSE NULL END)`,[s,s]);break}d=u.raw("MIN((??))",[s]);break;case i.NumericalAggregations.Sum:d=u.raw("SUM((??))",[s]);break;case i.NumericalAggregations.StandardDeviation:d=u.raw("(\n    SELECT \n      CASE \n        WHEN COUNT(*) > 0 THEN \n          SQRT(SUM(((??) - avg_value) * ((??) - avg_value)) / COUNT(*))\n        ELSE \n          NULL \n      END AS ??\n    FROM (\n      SELECT \n        (??), \n        (SELECT AVG((??)) FROM ??) AS avg_value\n      FROM \n        ??\n    )\n  )",[s,s,c,s,s,t.tnPath,t.tnPath]);break;case i.NumericalAggregations.Range:if(e.uidt===i.UITypes.Rating){d=u.raw(`(MAX((??)) - MIN(CASE WHEN (??) != ${p} THEN (??) ELSE NULL END))`,[s,s,s]);break}d=u.raw("(MAX((??)) - MIN((??)))",[s,s]);break;case i.NumericalAggregations.Median:d=u.raw("(SELECT AVG((??)) FROM (SELECT (??) FROM ?? ORDER BY (??) LIMIT 2 - (SELECT COUNT(*) FROM ??) % 2 OFFSET (SELECT (COUNT(*) - 1) / 2 FROM ??)))",[s,s,t.tnPath,s,t.tnPath,t.tnPath])}else if("boolean"===l)switch(a){case i.BooleanAggregations.Checked:d=u.raw("SUM(CASE WHEN ?? = 1 THEN 1 ELSE 0 END)",[s]);break;case i.BooleanAggregations.Unchecked:d=u.raw("SUM(CASE WHEN ?? = 0 OR ?? IS NULL THEN 1 ELSE 0 END)",[s,s]);break;case i.BooleanAggregations.PercentChecked:d=u.raw("(SUM(CASE WHEN ?? = 1 THEN 1 ELSE 0 END) * 100.0 / IFNULL(COUNT(*), 0))",[s]);break;case i.BooleanAggregations.PercentUnchecked:d=u.raw("(SUM(CASE WHEN ?? = 0 OR ?? IS NULL THEN 1 ELSE 0 END) * 100.0 / IFNULL(COUNT(*), 0))",[s,s])}else if("date"===l)switch(a){case i.DateAggregations.EarliestDate:d=u.raw("MIN(??)",[s]);break;case i.DateAggregations.LatestDate:d=u.raw("MAX(??)",[s]);break;case i.DateAggregations.DateRange:d=u.raw("CAST(JULIANDAY(MAX(??)) - JULIANDAY(MIN(??)) AS INTEGER)",[s,s]);break;case i.DateAggregations.MonthRange:d=u.raw("((strftime('%Y', MAX(??)) * 12 + strftime('%m', MAX(??))) - (strftime('%Y', MIN(??)) * 12 + strftime('%m', MIN(??))))",[s,s,s,s])}else if("attachment"===l&&a===i.AttachmentAggregations.AttachmentSize)d=u.raw("(SELECT SUM(CAST(json_extract(value, '$.size') AS INTEGER)) FROM ??, json_each(??))",[t.tnPath,s]);c&&d&&([i.AllAggregations.EarliestDate,i.AllAggregations.LatestDate].includes(a)||(d=u.raw("COALESCE(??, 0)",[d])),d=u.raw("?? AS ??",[d,c]));return null==d?void 0:d.toQuery()};const i=a(71040)},87188:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,a,i,s=!1){if(!t||"object"!=typeof t)return;(await b(e,t,{count:0},i,void 0,s))(a)};const s=a(71040),r=i(a(44578)),l=a(70240),c=a(43820),d=i(a(28148)),u=i(a(98548)),p=a(44356),m=i(a(22996)),_=i(a(73172)),f=a(62304),h=a(43468),g=a(19684);function y(e){var t;switch(null===(t=e.logical_op)||void 0===t?void 0:t.toLowerCase()){case"or":return"orWhere";case"and":return"andWhere";case"not":return"whereNot";default:return"where"}}const b=async(e,t,a={count:0},i,T,k=!1)=>{var S,M,O,I,C,E;const x=e.dbDriver,L=e.context;let R;if(Array.isArray(t)||(R=t instanceof m.default?t:new m.default(t)),Array.isArray(t)){const s=await Promise.all(t.map((t=>b(e,t,a,i,void 0,k))));return e=>{e.where((e=>{for(const[a,i]of Object.entries(s))e[y(t[a])](i)}))}}if(R.is_group){const t=await R.getChildren(L),i=await Promise.all((t||[]).map((t=>b(e,t,a,void 0,void 0,k))));return e=>{e[y(R)]((e=>{for(const[a,s]of Object.entries(i))e[y(t[a])](s)}))}}{if(!R.fk_column_id)return;if("gb_eq"===R.comparison_op||"gb_null"===R.comparison_op){R.groupby=!0;const t=await(0,h.getRefColumnIfAlias)(L,await R.getColumn(L));if(t.uidt===s.UITypes.Lookup||t.uidt===s.UITypes.LinkToAnotherRecord){const a=await t.getModel(L),s=await(0,_.default)({baseModelSqlv2:e,alias:i,model:a,column:t,getAlias:(0,f.getAliasGenerator)("__gb_filter_lk")});return e=>{"gb_eq"===R.comparison_op?e.where(x.raw("?",[R.value]),s.builder):e.whereNull(x.raw(s.builder).wrap("(",")"))}}R.comparison_op="gb_eq"===R.comparison_op?"eq":"blank",[s.UITypes.QrCode,s.UITypes.Barcode].includes(t.uidt)&&(R.fk_column_id=await t.getColOptions(L).then((e=>e.fk_column_id)))}if(!R.fk_column_id)return;const t=await R.getColumn(L);t||k&&c.NcError.fieldNotFound(R.fk_column_id);const y=await(0,h.getRefColumnIfAlias)(L,t);if(y||k&&c.NcError.fieldNotFound(R.fk_column_id),y.uidt===s.UITypes.LinkToAnotherRecord){const t=await y.getColOptions(L),r=await t.getChildColumn(L),l=await t.getParentColumn(L),c=await r.getModel(L);await c.getColumns(L);const d=await l.getModel(L);await d.getColumns(L);let u=t.type;if(u===s.RelationTypes.ONE_TO_ONE&&(u=(null===(S=y.meta)||void 0===S?void 0:S.bt)?s.RelationTypes.BELONGS_TO:s.RelationTypes.HAS_MANY),u===s.RelationTypes.HAS_MANY){if(["blank","notblank","checked","notchecked"].includes(R.comparison_op)){if(d.id===c.id)return"blank"===R.comparison_op?e=>{e.whereNull(r.column_name)}:e=>{e.whereNotNull(r.column_name)};const t=x(e.getTnPath(c.table_name)).count(r.column_name).where(r.column_name,x.raw("??.??",[i||e.getTnPath(d.table_name),l.column_name]));return e=>{"blank"===R.comparison_op?e.where(x.raw("0"),t):e.whereNot(x.raw("0"),t)}}const t=x(e.getTnPath(c.table_name)).select(r.column_name);return(await b(e,new m.default(Object.assign(Object.assign(Object.assign({},R),R.comparison_op in w?w[R.comparison_op]:{}),{fk_model_id:c.id,fk_column_id:null===(M=null==c?void 0:c.displayValue)||void 0===M?void 0:M.id})),a,void 0,void 0,k))(t),e=>{R.comparison_op in w?e.whereNotIn(l.column_name,t):e.whereIn(l.column_name,t)}}if(u===s.RelationTypes.BELONGS_TO){if(["blank","notblank","checked","notchecked"].includes(R.comparison_op)){if(d.id===c.id)return"blank"===R.comparison_op?e=>{e.whereNull(r.column_name)}:e=>{e.whereNotNull(r.column_name)};const t=x(e.getTnPath(d.table_name)).count(l.column_name).where(l.column_name,x.raw("??.??",[i||e.getTnPath(c.table_name),r.column_name]));return e=>{"blank"===R.comparison_op?e.where(x.raw("0"),t):e.whereNot(x.raw("0"),t)}}const t=x(e.getTnPath(d.table_name)).select(l.column_name);return(await b(e,new m.default(Object.assign(Object.assign(Object.assign({},R),R.comparison_op in w?w[R.comparison_op]:{}),{fk_model_id:d.id,fk_column_id:null===(O=null==d?void 0:d.displayValue)||void 0===O?void 0:O.id})),a,void 0,void 0,k))(t),e=>{R.comparison_op in w?e.where((e=>e.whereNotIn(r.column_name,t).orWhereNull(r.column_name))):e.whereIn(r.column_name,t)}}if(u===s.RelationTypes.MANY_TO_MANY){const s=await t.getMMModel(L),u=await t.getMMParentColumn(L),p=await t.getMMChildColumn(L);if(["blank","notblank","checked","notchecked"].includes(R.comparison_op)){if(s.id===c.id)return"blank"===R.comparison_op?e=>{e.whereNull(r.column_name)}:e=>{e.whereNotNull(r.column_name)};const t=x(e.getTnPath(s.table_name)).count(p.column_name).where(p.column_name,x.raw("??.??",[i||e.getTnPath(c.table_name),r.column_name]));return e=>{"blank"===R.comparison_op?e.where(x.raw("0"),t):e.whereNot(x.raw("0"),t)}}const _=x(e.getTnPath(s.table_name)).select(p.column_name).join(e.getTnPath(d.table_name),`${e.getTnPath(s.table_name)}.${u.column_name}`,`${e.getTnPath(d.table_name)}.${l.column_name}`);return(await b(e,new m.default(Object.assign(Object.assign(Object.assign({},R),R.comparison_op in w?w[R.comparison_op]:{}),{fk_model_id:d.id,fk_column_id:null===(I=null==d?void 0:d.displayValue)||void 0===I?void 0:I.id})),a,void 0,void 0,k))(_),e=>{R.comparison_op in w?e.where((e=>e.whereNotIn(r.column_name,_).orWhereNull(r.column_name))):e.whereIn(r.column_name,_)}}return e=>{}}if(y.uidt===s.UITypes.Lookup)return await async function(e,t,a,i,r={count:0},l=!1){var c;const d=e.context,u=await t.getColOptions(d),p=await u.getRelationColumn(d),m=await p.getColOptions(d),_=await u.getLookupColumn(d),f=function(e){return"__nc"+e.count++}(r);let h;{const t=await m.getChildColumn(d),u=await m.getParentColumn(d),g=await t.getModel(d);await g.getColumns(d);const y=await u.getModel(d);await y.getColumns(d);let b=m.type;if(b===s.RelationTypes.ONE_TO_ONE&&(b=(null===(c=p.meta)||void 0===c?void 0:c.bt)?s.RelationTypes.BELONGS_TO:s.RelationTypes.HAS_MANY),b===s.RelationTypes.HAS_MANY)return h=i(i.raw("?? as ??",[e.getTnPath(g.table_name),f])),h.select(`${f}.${t.column_name}`),await v(e,Object.assign(Object.assign({},a),a.comparison_op in w?w[a.comparison_op]:{}),_,h,i,f,r,l),e=>{a.comparison_op in w?e.whereNotIn(u.column_name,h):e.whereIn(u.column_name,h)};if(b===s.RelationTypes.BELONGS_TO)return h=i(i.raw("?? as ??",[e.getTnPath(y.table_name),f])),h.select(`${f}.${u.column_name}`),await v(e,Object.assign(Object.assign({},a),a.comparison_op in w?w[a.comparison_op]:{}),_,h,i,f,r,l),e=>{a.comparison_op in w?e.where((e=>e.whereNotIn(t.column_name,h).orWhereNull(t.column_name))):e.whereIn(t.column_name,h)};if(b===s.RelationTypes.MANY_TO_MANY){const s=await m.getMMModel(d),c=await m.getMMParentColumn(d),p=await m.getMMChildColumn(d),g="__nc"+r.count++;return h=i(i.raw("?? as ??",[e.getTnPath(s.table_name),f])).select(`${f}.${p.column_name}`).join(i.raw("?? as ??",[e.getTnPath(y.table_name),g]),`${f}.${c.column_name}`,`${g}.${u.column_name}`),await v(e,Object.assign(Object.assign({},a),a.comparison_op in w?w[a.comparison_op]:{}),_,h,i,g,r,l),e=>{a.comparison_op in w?e.where((e=>e.whereNotIn(t.column_name,h).orWhereNull(t.column_name))):e.whereIn(t.column_name,h)}}}}(e,y,R,x,a,k);if([s.UITypes.Rollup,s.UITypes.Links].includes(y.uidt)&&!T){const t=(await(0,u.default)({baseModelSqlv2:e,knex:x,alias:i,columnOptions:await y.getColOptions(L)})).builder;return b(e,new m.default(Object.assign(Object.assign({},R),{value:x.raw("?",[isNaN(+R.value)?R.value:+R.value])})),a,i,t)}if(y.uidt!==s.UITypes.Formula||T){if([s.UITypes.User,s.UITypes.CreatedBy,s.UITypes.LastModifiedBy].includes(y.uidt)&&["like","nlike"].includes(R.comparison_op)){y.column_name=await(0,l.getColumnName)(L,y);const e=await g.BaseUser.getUsersList(L,{base_id:y.base_id});return t=>{const a=e.filter((e=>{const t=R.value.toLowerCase();return t.startsWith("%")&&t.endsWith("%")?(e.display_name||e.email).toLowerCase().includes(t.substring(1,t.length-1)):t.startsWith("%")?(e.display_name||e.email).toLowerCase().endsWith(t.substring(1)):t.endsWith("%")?(e.display_name||e.email).toLowerCase().startsWith(t.substring(0,t.length-1)):(e.display_name||e.email).toLowerCase().includes(t.toLowerCase())})).reduce(((e,t)=>x.raw(`REPLACE(${e}, ?, ?)`,[t.id,t.display_name||t.email]).toQuery()),x.raw("??",[y.column_name]).toQuery());let i=R.value;"like"===R.comparison_op?(i=(i+"").startsWith("%")||(i+"").endsWith("%")?i:`%${i}%`,t="pg"===x.clientType()?t.where(x.raw(`(${a}) ilike ?`,[i])):t.where(x.raw(`(${a}) like ?`,[i]))):i?(i=i.startsWith("%")||i.endsWith("%")?i:`%${i}%`,t.where((e=>{"pg"===x.clientType()?e.whereNot(x.raw(`(${a}) ilike ?`,[i])):e.whereNot(x.raw(`(${a}) like ?`,[i])),"%%"!==i?(e.orWhere(y.column_name,""),e.orWhereNull(y.column_name)):e.orWhereNull(y.column_name)}))):(t.whereNot(y.column_name,""),t.orWhereNull(y.column_name))}}{"empty"!==R.comparison_op&&"notempty"!==R.comparison_op||(R.value="");const e=(0,p.sanitize)(T?R.value:i?`${i}.${y.column_name}`:y.column_name),t=T||R.value;return y.column_name=await(0,l.getColumnName)(L,y),a=>{var i,l;let[c,d]=[e,t],u=T?c:d;const p="mysql2"===x.clientType()?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if(y.uidt===s.UITypes.Formula&&(0,s.getEquivalentUIType)({formulaColumn:y})==s.UITypes.DateTime||[s.UITypes.Date,s.UITypes.DateTime,s.UITypes.CreatedTime,s.UITypes.LastModifiedTime].includes(y.uidt)){let e=(0,r.default)(new Date);const t=null===(i=null==y?void 0:y.meta)||void 0===i?void 0:i.date_format;switch(t&&(0,s.isDateMonthFormat)(t)&&(e=(0,r.default)(e).date(1),d&&(u=(0,r.default)(d).date(1))),R.comparison_sub_op){case"today":u=e;break;case"tomorrow":u=e.add(1,"day");break;case"yesterday":u=e.add(-1,"day");break;case"oneWeekAgo":case"pastWeek":u=e.add(-1,"week");break;case"oneWeekFromNow":case"nextWeek":u=e.add(1,"week");break;case"oneMonthAgo":case"pastMonth":u=e.add(-1,"month");break;case"oneMonthFromNow":case"nextMonth":u=e.add(1,"month");break;case"daysAgo":case"pastNumberOfDays":if(!d)return;u=e.add(-u,"day");break;case"daysFromNow":if(!d)return;u=e.add(u,"day");break;case"exactDate":if(!u)return;break;case"pastYear":u=e.add(-1,"year");break;case"nextYear":u=e.add(1,"year");break;case"nextNumberOfDays":if(!u)return;u=e.add(u,"day")}r.default.isDayjs(u)&&(u=u.format(p).toString(),u=y.uidt===s.UITypes.Date?u.substring(0,10):u)}switch((0,s.isNumericCol)(y.uidt)&&"string"==typeof u&&!isNaN(+u)&&(u=+u),T?c=x.raw("?",[u]):d=u,R.comparison_op){case"eq":if("mysql2"===x.clientType()||"mysql"===x.clientType())if([s.UITypes.Duration,s.UITypes.Currency,s.UITypes.Percent,s.UITypes.Number,s.UITypes.Decimal,s.UITypes.Rating,s.UITypes.Rollup,s.UITypes.Links].includes(y.uidt))a=a.where(c,d);else if(y.uidt===s.UITypes.Formula&&(0,s.getEquivalentUIType)({formulaColumn:y})==s.UITypes.DateTime||"timestamp"===y.ct||"date"===y.ct||"datetime"===y.ct)if(R.groupby&&"date"!==y.ct){const e=d.replace(/[+-]\d+:\d+$/,"");a=a.where(x.raw("CONVERT_TZ(DATE_SUB(??, INTERVAL SECOND(??) SECOND), @@GLOBAL.time_zone, '+00:00') = DATE_SUB(?, INTERVAL SECOND(?) SECOND)",[c,c,e,e]))}else a=a.where(x.raw("DATE(??) = DATE(?)",[c,d]));else a=a.where(x.raw("BINARY ?? = ?",[c,d]));else a=y.uidt===s.UITypes.Formula&&(0,s.getEquivalentUIType)({formulaColumn:y})==s.UITypes.DateTime||[s.UITypes.DateTime,s.UITypes.CreatedTime,s.UITypes.LastModifiedTime].includes(y.uidt)?"pg"===a.client.config.client?R.groupby?a.where(x.raw("date_trunc('minute', ??) + interval '0 seconds' = ?",[c,d])):a.where(x.raw("??::date = ?",[c,d])):R.groupby?"sqlite3"===x.clientType()?a.where(x.raw("Datetime(strftime ('%Y-%m-%d %H:%M:00',:column:) ||\n  (\n   CASE WHEN substr(:column:, 20, 1) = '+' THEN\n    printf ('+%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   WHEN substr(:column:, 20, 1) = '-' THEN\n    printf ('-%s:',\n     substr(:column:, 21, 2)) || printf ('%s',\n     substr(:column:, 24, 2))\n   ELSE\n    '+00:00'\n   END)) = Datetime(:val)",{column:c,val:d})):a.where(x.raw("?? = ?",[c,d])):a.where(x.raw("DATE(??) = DATE(?)",[c,d])):a.where(c,d);y.uidt===s.UITypes.Rating&&0===d&&(a=a.orWhereNull(c));break;case"neq":case"not":a="mysql2"===x.clientType()?[s.UITypes.Duration,s.UITypes.Currency,s.UITypes.Percent,s.UITypes.Number,s.UITypes.Decimal,s.UITypes.Rollup,s.UITypes.Links].includes(y.uidt)?a.where((a=>{a.whereNot(c,d),y.uidt!==s.UITypes.Links&&a.orWhereNull(T?t:e)})):y.uidt===s.UITypes.Rating?0===d?a.whereNot(c,d).whereNotNull(c):a.whereNot(c,d).orWhereNull(c):a.where((a=>{a.where(x.raw("BINARY ?? != ?",[c,d])),y.uidt!==s.UITypes.Rating&&a.orWhereNull(T?t:e)})):a.where((a=>{a.whereNot(c,d),y.uidt!==s.UITypes.Links&&a.orWhereNull(T?t:e)}));break;case"like":d?(y.uidt===s.UITypes.Formula?([c,d]=[d,c],d=`%${d}%`.replace(/^%'([\s\S]*)'%$/,"%$1%")):d=(d+"").startsWith("%")||(d+"").endsWith("%")?d:`%${d}%`,a="pg"===x.clientType()?a.where(x.raw("??::text ilike ?",[c,d])):a.where(c,"like",d)):y.uidt===s.UITypes.Attachment?a=a.orWhereNull(c).orWhere(c,"[]").orWhere(c,"null"):(a.where(c,""),a.orWhereNotNull(c));break;case"nlike":d?(y.uidt===s.UITypes.Formula?([c,d]=[d,c],d=`%${d}%`.replace(/^%'([\s\S]*)'%$/,"%$1%")):d=d.startsWith("%")||d.endsWith("%")?d:`%${d}%`,a.where((e=>{"pg"===x.clientType()?e.where(x.raw("??::text not ilike ?",[c,d])):e.whereNot(c,"like",d),"%%"!==d?(e.orWhere(c,""),e.orWhereNull(c)):e.orWhereNull(c)}))):y.uidt===s.UITypes.Attachment?a.whereNot(c,"").whereNot(c,"null").whereNot(c,"[]"):(a.whereNot(c,""),a.orWhereNull(c));break;case"allof":case"anyof":case"nallof":case"nanyof":{const e=e=>{var t;let a=null==d?void 0:d.split(",");["mysql2","mysql"].includes(x.clientType())&&["enum","set"].includes(null===(t=y.dt)||void 0===t?void 0:t.toLowerCase())&&(a=a.map((e=>e.trimEnd())));for(let t=0;t<(null==a?void 0:a.length);t++){let i;const s=[c,`%,${a[t]},%`];i="pg"===x.clientType()?"(',' || ??::text || ',') ilike ?":"sqlite3"===x.clientType()?"(',' || ?? || ',') like ?":"CONCAT(',', ??, ',') like ?",e=0===t?e.where(x.raw(i,s)):"allof"===R.comparison_op||"nallof"===R.comparison_op?e.andWhere(x.raw(i,s)):e.orWhere(x.raw(i,s))}};a="allof"===R.comparison_op||"anyof"===R.comparison_op?a.where(e):a.whereNot(e).orWhereNull(c)}break;case"gt":{const e=T?"<":">";y.uidt!==s.UITypes.DateTime&&y.uidt!==s.UITypes.Date||!d.match(/[+-]\d{2}:\d{2}$/)?(a=a.where(c,e,d),y.uidt===s.UITypes.Rating&&"<"===e&&d>0&&(a=a.orWhereNull(c))):"pg"===a.client.config.client?a.where(c,e,x.raw("?::timestamptz",[d])):"sqlite3"===a.client.config.client?a.where(c,e,x.raw("datetime(?)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):"mysql2"===a.client.config.client?a.where(c,e,x.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):a.where(c,e,d)}break;case"ge":case"gte":{const e=T?"<=":">=";y.uidt!==s.UITypes.DateTime&&y.uidt!==s.UITypes.Date||!d.match(/[+-]\d{2}:\d{2}$/)?(a=a.where(c,e,d),y.uidt===s.UITypes.Rating&&("<="===e||">="===e&&0===d)&&(a=a.orWhereNull(c))):"pg"===a.client.config.client?a.where(c,e,x.raw("?::timestamptz",[d])):"sqlite3"===a.client.config.client?a.where(c,e,x.raw("datetime(?)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):"mysql2"===a.client.config.client?a.where(c,e,x.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):a.where(c,e,d)}break;case"lt":{const e=T?">":"<";y.uidt!==s.UITypes.DateTime&&y.uidt!==s.UITypes.Date||!d.match(/[+-]\d{2}:\d{2}$/)?(a=a.where(c,e,d),y.uidt===s.UITypes.Rating&&"<"===e&&d>0&&(a=a.orWhereNull(c))):"pg"===a.client.config.client?a.where(c,e,x.raw("?::timestamptz",[d])):"sqlite3"===a.client.config.client?a.where(c,e,x.raw("datetime(?)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):"mysql2"===a.client.config.client?a.where(c,e,x.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):a.where(c,e,d)}break;case"le":case"lte":{const e=T?">=":"<=";y.uidt!==s.UITypes.DateTime&&y.uidt!==s.UITypes.Date||!d.match(/[+-]\d{2}:\d{2}$/)?(a=a.where(c,e,d),y.uidt===s.UITypes.Rating&&("<="===e||">="===e&&0===d)&&(a=a.orWhereNull(c))):"pg"===a.client.config.client?a.where(c,e,x.raw("?::timestamptz",[d])):"sqlite3"===a.client.config.client?a.where(c,e,x.raw("datetime(?)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):"mysql2"===a.client.config.client?a.where(c,e,x.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,r.default)(d).utc().format("YYYY-MM-DD HH:mm:ss")])):a.where(c,e,d)}break;case"in":a=a.whereIn(c,Array.isArray(d)?d:null===(l=null==d?void 0:d.split)||void 0===l?void 0:l.call(d,","));break;case"is":"null"===R.value?a=a.whereNull(T||c):"notnull"===R.value?a=a.whereNotNull(T||c):"empty"===R.value?a=a.where(T||c,""):"notempty"===R.value?a=a.whereNot(T||c,"").orWhereNull(c):"true"===R.value?a=a.where(T||c,!0):"false"===R.value&&(a=a.where(T||c,!1));break;case"isnot":"null"===R.value?a=a.whereNotNull(T||c):"notnull"===R.value?a=a.whereNull(T||c):"empty"===R.value?a=a.whereNot(T||c,""):"notempty"===R.value?a=a.where(T||c,""):"true"===R.value?a=a.whereNot(T||c,!0):"false"===R.value&&(a=a.whereNot(T||c,!1));break;case"empty":y.uidt===s.UITypes.Formula&&([c,d]=[d,c]),a=a.where(c,d);break;case"notempty":y.uidt===s.UITypes.Formula&&([c,d]=[d,c]),a=a.whereNot(c,d).orWhereNull(c);break;case"null":a=a.whereNull(T||c);break;case"notnull":a=a.whereNotNull(T||c);break;case"blank":y.uidt===s.UITypes.Attachment?a=a.whereNull(T||c).orWhere(c,"[]").orWhere(c,"null"):(a=a.whereNull(T||c),(0,s.isNumericCol)(y.uidt)||[s.UITypes.Date,s.UITypes.CreatedTime,s.UITypes.LastModifiedTime,s.UITypes.DateTime,s.UITypes.Time].includes(y.uidt)||(a=a.orWhere(c,"")));break;case"notblank":y.uidt===s.UITypes.Attachment?a=a.whereNotNull(T||c).whereNot(c,"[]").whereNot(c,"null"):(a=a.whereNotNull(T||c),(0,s.isNumericCol)(y.uidt)||[s.UITypes.Date,s.UITypes.DateTime,s.UITypes.CreatedTime,s.UITypes.LastModifiedTime,s.UITypes.Time].includes(y.uidt)||(a=a.whereNot(c,"")));break;case"checked":a=a.where(T||c,!0);break;case"notchecked":a=a.where((e=>{e.whereNull(T||c).orWhere(T||c,!1)}));break;case"btw":a=a.whereBetween(c,d.split(","));break;case"nbtw":a=a.whereNotBetween(c,d.split(","));break;case"isWithin":{let e=(0,r.default)(new Date).format(p).toString();e=y.uidt===s.UITypes.Date?e.substring(0,10):e;const[t,i]=[T?d:c,T?c:d];switch(R.comparison_sub_op){case"pastWeek":case"pastMonth":case"pastYear":case"pastNumberOfDays":a=a.whereBetween(t,[i,e]);break;case"nextWeek":case"nextMonth":case"nextYear":case"nextNumberOfDays":a=a.whereBetween(t,[e,i])}}}}}}{const t=await y.getModel(L),r=await y.getColOptions(L),l=(await(0,d.default)(e,r.formula,null,t,y)).builder;return b(e,new m.default(Object.assign(Object.assign({},R),{value:x.raw("?",[(null===(C=r.getParsedTree())||void 0===C?void 0:C.dataType)!==s.FormulaDataTypes.NUMERIC||isNaN(+R.value)?null!==(E=R.value)&&void 0!==E?E:null:+R.value])})),a,i,l)}}},w={nlike:{comparison_op:"like"},neq:{comparison_op:"eq"},blank:{comparison_op:"notblank"},notchecked:{comparison_op:"checked"}};async function v(e,t,a,i,r,l,c,d=!1){var u,p,_;const f=e.context;if(a.uidt===s.UITypes.Lookup||a.uidt===s.UITypes.LinkToAnotherRecord){const h=a.uidt===s.UITypes.Lookup?await(await a.getColOptions(f)).getRelationColumn(f):a,g=await h.getColOptions(f),y="__nc"+c.count++,w=await g.getChildColumn(f),T=await g.getParentColumn(f),k=await w.getModel(f);await k.getColumns(f);const S=await T.getModel(f);switch(await S.getColumns(f),g.type){case s.RelationTypes.HAS_MANY:i.join(r.raw("?? as ??",[e.getTnPath(k.table_name),y]),`${l}.${T.column_name}`,`${y}.${w.column_name}`);break;case s.RelationTypes.BELONGS_TO:i.join(r.raw("?? as ??",[e.getTnPath(S.table_name),y]),`${l}.${w.column_name}`,`${y}.${T.column_name}`);break;case"mm":{const t=await g.getMMModel(f),a=await g.getMMParentColumn(f),s=await g.getMMChildColumn(f),d="__nc"+c.count++;i.join(r.raw("?? as ??",[e.getTnPath(t.table_name),d]),`${d}.${s.column_name}`,`${l}.${w.column_name}`).join(r.raw("?? as ??",[e.getTnPath(S.table_name),y]),`${y}.${T.column_name}`,`${d}.${a.column_name}`)}}if(a.uidt===s.UITypes.Lookup)await v(e,t,await(await a.getColOptions(f)).getLookupColumn(f),i,r,y,c,d);else switch(g.type){case s.RelationTypes.HAS_MANY:(await b(e,new m.default(Object.assign(Object.assign({},t),{fk_model_id:k.id,fk_column_id:null===(u=k.displayValue)||void 0===u?void 0:u.id})),c,y,void 0,d))(i);break;case s.RelationTypes.BELONGS_TO:(await b(e,new m.default(Object.assign(Object.assign({},t),{fk_model_id:S.id,fk_column_id:null===(p=null==S?void 0:S.displayValue)||void 0===p?void 0:p.id})),c,y,void 0,d))(i);break;case"mm":(await b(e,new m.default(Object.assign(Object.assign({},t),{fk_model_id:S.id,fk_column_id:null===(_=S.displayValue)||void 0===_?void 0:_.id})),c,y,void 0,d))(i)}}else(await b(e,new m.default(Object.assign(Object.assign({},t),{fk_model_id:(await a.getModel(f)).id,fk_column_id:null==a?void 0:a.id})),c,l,void 0,d))(i)}},28148:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,a,i,l,c={},d,u=!1,_,g){const b=e.dbDriver,w=e.context;let T;s.default.plugins.register(r.jsepCurlyHook);try{if(T=await v({baseModelSqlv2:e,_tree:t,alias:a,model:i,aliasToColumn:c,tableAlias:d,parsedTree:null!=_?_:await(null==l?void 0:l.getColOptions(w).then((e=>null==e?void 0:e.getParsedTree()))),baseUsers:g}),!u)return T;if(await e.execAndParse(b(e.getTnPath(i,d)).select(b.raw("?? as ??",[T.builder,"__dry_run_alias"])).as("dry-run-only"),null,{raw:!0}),l){const e=await l.getColOptions(w);e.error&&("ButtonColumn"===e.constructor.name?await h.ButtonColumn.update(w,l.id,{error:null}):await f.default.update(w,l.id,{error:null}))}}catch(e){if(!u)throw e;console.error(e),l&&((null==l?void 0:l.uidt)===r.UITypes.Button?(await h.ButtonColumn.update(w,l.id,{error:null}),await p.default.update(`${m.CacheScope.COL_BUTTON}:${l.id}`,{error:e.message})):e instanceof y.ExternalTimeout||(await f.default.update(w,l.id,{error:e.message}),await p.default.update(`${m.CacheScope.COL_FORMULA}:${l.id}`,{error:e.message}))),y.NcError.formulaError(e.message)}return T};const s=i(a(91856)),r=a(71040),l=a(23324),c=i(a(35984)),d=i(a(98548)),u=i(a(84072)),p=i(a(57804)),m=a(64612),_=a(36596),f=i(a(84748)),h=a(19684),g=a(43468),y=a(43820),b=new l.Logger("FormulaQueryBuilderv2"),w=e=>{switch(null==e?void 0:e.toUpperCase()){case"MIN":return({qb:e,cn:t})=>e.clear("select").min(t);case"MAX":return({qb:e,cn:t})=>e.clear("select").max(t);case"ADD":case"SUM":case"FLOAT":case"NUMBER":case"ARITH":case"AVG":return({qb:e,cn:t})=>e.clear("select").sum(t);default:return({qb:e,cn:t})=>e.clear("select").concat(t)}};async function v(e){const{baseModelSqlv2:t,_tree:a,alias:i,model:s,aliasToColumn:l={},tableAlias:p,parsedTree:m,column:y=null}=e;let{baseUsers:T=null}=e;const k=t.dbDriver,S=t.context,M=await s.getColumns(S);let O=m;O||(O=await(0,r.validateFormulaAndExtractTreeWithType)({formula:a.replaceAll("{{","{").replaceAll("}}","}"),columns:M,column:y,clientOrSqlUi:t.clientType,getMeta:async e=>{const t=await u.default.get(S,e);return await t.getColumns(S),t}}),y&&(y.uidt===r.UITypes.Formula?f.default.update(S,y.id,{parsed_tree:O}).then((()=>{}),(e=>{b.error(e)})):h.ButtonColumn.update(S,y.id,{parsed_tree:O}).then((()=>{}),(e=>{b.error(e)}))));const I={};for(const e of M)if(I[e.id]=e.uidt,!(e.id in l))switch(e.uidt){case r.UITypes.Formula:case r.UITypes.Button:l[e.id]=async()=>{const a=await e.getColOptions(S),{builder:r}=await v({baseModelSqlv2:t,_tree:a.formula,alias:i,model:s,aliasToColumn:Object.assign(Object.assign({},l),{[e.id]:null}),tableAlias:p,parsedTree:a.getParsedTree(),baseUsers:T});return r.sql="("+r.sql+")",{builder:r}};break;case r.UITypes.Lookup:l[e.id]=async()=>{var a,i,s,c,u,m;let _,f=0,h=!1;const g="__nc_formula"+f++,y=await e.getColOptions(S);{const e=await y.getRelationColumn(S),b=await e.getColOptions(S),T=await b.getChildColumn(S),M=await b.getParentColumn(S),O=await T.getModel(S);await O.getColumns(S);const I=await M.getModel(S);await I.getColumns(S);let C=b.type;switch(C===r.RelationTypes.ONE_TO_ONE&&(C=(null===(a=e.meta)||void 0===a?void 0:a.bt)?r.RelationTypes.BELONGS_TO:r.RelationTypes.HAS_MANY),C){case r.RelationTypes.BELONGS_TO:_=k(k.raw("?? as ??",[t.getTnPath(I.table_name),g])).where(`${g}.${M.column_name}`,k.raw("??",[`${null!=p?p:t.getTnPath(O.table_name)}.${T.column_name}`]));break;case r.RelationTypes.HAS_MANY:h=b.type!==r.RelationTypes.ONE_TO_ONE,_=k(k.raw("?? as ??",[t.getTnPath(O.table_name),g])).where(`${g}.${T.column_name}`,k.raw("??",[`${null!=p?p:t.getTnPath(I.table_name)}.${M.column_name}`]));break;case r.RelationTypes.MANY_TO_MANY:{h=!0;const e=await b.getMMModel(S),a=await b.getMMParentColumn(S),i=await b.getMMChildColumn(S),s="__nc"+f++;_=k(k.raw("?? as ??",[t.getTnPath(I.table_name),g])).join(k.raw("?? as ??",[t.getTnPath(e.table_name),s]),`${s}.${a.column_name}`,`${g}.${M.column_name}`).where(`${s}.${i.column_name}`,k.raw("??",[`${null!=p?p:t.getTnPath(O.table_name)}.${T.column_name}`]))}}let E=await y.getLookupColumn(S),x=g;for(;E.uidt===r.UITypes.Lookup;){const e="__nc_formula"+f++,a=await E.getColOptions(S),s=await a.getRelationColumn(S),l=await s.getColOptions(S),c=await l.getChildColumn(S),d=await l.getParentColumn(S),u=await c.getModel(S);await u.getColumns(S);const p=await d.getModel(S);await p.getColumns(S);let m=l.type;switch(m===r.RelationTypes.ONE_TO_ONE&&(m=(null===(i=s.meta)||void 0===i?void 0:i.bt)?r.RelationTypes.BELONGS_TO:r.RelationTypes.HAS_MANY),m){case r.RelationTypes.BELONGS_TO:_.join(k.raw("?? as ??",[t.getTnPath(p.table_name),e]),`${x}.${c.column_name}`,`${e}.${d.column_name}`);break;case r.RelationTypes.HAS_MANY:h=l.type!==r.RelationTypes.ONE_TO_ONE,_.join(k.raw("?? as ??",[t.getTnPath(u.table_name),e]),`${x}.${d.column_name}`,`${e}.${c.column_name}`);break;case r.RelationTypes.MANY_TO_MANY:{h=!0;const a=await l.getMMModel(S),i=await l.getMMParentColumn(S),s=await l.getMMChildColumn(S),r="__nc"+f++;_.join(k.raw("?? as ??",[t.getTnPath(a.table_name),r]),`${r}.${s.column_name}`,`${x}.${c.column_name}`).join(k.raw("?? as ??",[t.getTnPath(p.table_name),e]),`${e}.${d.column_name}`,`${r}.${i.column_name}`)}}E=await a.getLookupColumn(S),x=e}switch(E.uidt){case r.UITypes.Links:case r.UITypes.Rollup:{const e=(await(0,d.default)({baseModelSqlv2:t,knex:k,alias:x,columnOptions:await E.getColOptions(S)})).builder;if(h){const t=_;_=a=>k.raw(w(a)({qb:t,knex:k,cn:k.raw(e).wrap("(",")")})).wrap("(",")")}else _.select(k.raw(e).wrap("(",")"))}break;case r.UITypes.LinkToAnotherRecord:{const a="__nc_formula"+f++,i=await E.getColOptions(S),l=await E.getColOptions(S),d=await l.getChildColumn(S),p=await l.getParentColumn(S),y=await d.getModel(S);await y.getColumns(S);const b=await p.getModel(S);let v;await b.getColumns(S);let T=i.type;switch(T===r.RelationTypes.ONE_TO_ONE&&(T=(null===(s=e.meta)||void 0===s?void 0:s.bt)?r.RelationTypes.BELONGS_TO:r.RelationTypes.HAS_MANY),T){case r.RelationTypes.BELONGS_TO:_.join(k.raw("?? as ??",[t.getTnPath(b.table_name),a]),`${g}.${d.column_name}`,`${a}.${p.column_name}`),v=k.raw("??.??",[a,null===(c=null==b?void 0:b.displayValue)||void 0===c?void 0:c.column_name]);break;case r.RelationTypes.HAS_MANY:h=i.type!==r.RelationTypes.ONE_TO_ONE,_.join(k.raw("?? as ??",[t.getTnPath(y.table_name),a]),`${g}.${p.column_name}`,`${a}.${d.column_name}`),v=k.raw("??.??",[a,null===(u=null==y?void 0:y.displayValue)||void 0===u?void 0:u.column_name]);break;case r.RelationTypes.MANY_TO_MANY:{h=!0;const e=await i.getMMModel(S),s=await i.getMMParentColumn(S),r=await i.getMMChildColumn(S),l="__nc"+f++;_.join(k.raw("?? as ??",[t.getTnPath(e.table_name),l]),`${l}.${r.column_name}`,`${g}.${d.column_name}`).join(k.raw("?? as ??",[t.getTnPath(b.table_name),a]),`${a}.${p.column_name}`,`${l}.${s.column_name}`)}v=k.raw("??.??",[a,null===(m=null==b?void 0:b.displayValue)||void 0===m?void 0:m.column_name])}if(_.join(k.raw("?? as ??",[t.getTnPath(b.table_name),a]),`${a}.${p.column_name}`,`${x}.${d.column_name}`),h){const e=_;_=t=>k.raw(w(t)({qb:e,knex:k,cn:E.column_name})).wrap("(",")")}else _.select(`${x}.${v}`)}break;case r.UITypes.Formula:{const e=await E.getColOptions(S),a=await E.getModel(S),{builder:i}=await v({baseModelSqlv2:t,_tree:e.formula,alias:"",model:a,aliasToColumn:l,parsedTree:e.getParsedTree()});if(h){const e=_;_=t=>k.raw(w(t)({qb:e,knex:k,cn:k.raw(i).wrap("(",")")})).wrap("(",")")}else _.select(i)}break;default:if(h){const e=_;_=t=>k.raw(w(t)({qb:e,knex:k,cn:`${x}.${E.column_name}`})).wrap("(",")")}else _.select(`${x}.${E.column_name}`)}if(_)return{builder:"function"==typeof _?_:k.raw(_).wrap("(",")")}}};break;case r.UITypes.Rollup:case r.UITypes.Links:l[e.id]=async()=>{const a=await(0,d.default)({baseModelSqlv2:t,knex:k,columnOptions:await e.getColOptions(S),alias:p});return{builder:k.raw(a.builder).wrap("(",")")}};break;case r.UITypes.LinkToAnotherRecord:l[e.id]=async()=>{var a,i;const s="__nc_formula_ll",l=await e.getColOptions(S),c=await e.getColOptions(S),d=await c.getChildColumn(S),u=await c.getParentColumn(S),m=await d.getModel(S);await m.getColumns(S);const _=await u.getModel(S);await _.getColumns(S);let f,h=l.type;if(h===r.RelationTypes.ONE_TO_ONE&&(h=(null===(a=e.meta)||void 0===a?void 0:a.bt)?r.RelationTypes.BELONGS_TO:r.RelationTypes.HAS_MANY),h===r.RelationTypes.BELONGS_TO)f=k(t.getTnPath(_.table_name)).select(null===(i=null==_?void 0:_.displayValue)||void 0===i?void 0:i.column_name).where(`${t.getTnPath(_.table_name)}.${u.column_name}`,k.raw("??",[`${null!=p?p:t.getTnPath(m.table_name)}.${d.column_name}`]));else if(h==r.RelationTypes.HAS_MANY){const e=k(t.getTnPath(m.table_name)).where(`${t.getTnPath(m.table_name)}.${d.column_name}`,k.raw("??",[`${null!=p?p:t.getTnPath(_.table_name)}.${u.column_name}`]));f=t=>{var a;return k.raw(w(t)({qb:e,knex:k,cn:null===(a=null==m?void 0:m.displayValue)||void 0===a?void 0:a.column_name})).wrap("(",")")}}else if(h==r.RelationTypes.MANY_TO_MANY){const e=await l.getMMModel(S),a=await l.getMMParentColumn(S),i=await l.getMMChildColumn(S),r=k(k.raw("?? as ??",[t.getTnPath(_.table_name),s])).join(`${t.getTnPath(e.table_name)}`,`${t.getTnPath(e.table_name)}.${a.column_name}`,`${s}.${u.column_name}`).where(`${t.getTnPath(e.table_name)}.${i.column_name}`,k.raw("??",[`${null!=p?p:t.getTnPath(m.table_name)}.${d.column_name}`]));f=e=>{var t;return k.raw(w(e)({qb:r,knex:k,cn:null===(t=null==_?void 0:_.displayValue)||void 0===t?void 0:t.column_name})).wrap("(",")")}}if(f)return{builder:"function"==typeof f?f:k.raw(f).wrap("(",")")}};break;case r.UITypes.CreatedTime:case r.UITypes.LastModifiedTime:case r.UITypes.DateTime:{const t=await(0,g.getRefColumnIfAlias)(S,e);if(t.id in l){l[e.id]=l[t.id];break}k.clientType().startsWith("mysql")?l[e.id]=async()=>({builder:k.raw("CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00')",[t.column_name])}):"pg"===k.clientType()&&"timestamp with time zone"!==t.dt&&"timestamptz"!==t.dt?l[e.id]=async()=>({builder:k.raw("?? AT TIME ZONE CURRENT_SETTING('timezone') AT TIME ZONE 'UTC'",[t.column_name]).wrap("(",")")}):"mssql"===k.clientType()&&"datetimeoffset"!==t.dt?l[e.id]=async()=>({builder:k.raw("CONVERT(DATETIMEOFFSET, ?? AT TIME ZONE 'UTC')",[t.column_name])}):l[e.id]=()=>Promise.resolve({builder:t.column_name}),l[t.id]=l[e.id]}break;case r.UITypes.User:case r.UITypes.CreatedBy:case r.UITypes.LastModifiedBy:l[e.id]=async()=>{T=null!=T?T:await h.BaseUser.getUsersList(S,{base_id:s.base_id});const t=T.reduce(((e,t)=>k.raw(`REPLACE(${e}, ?, ?)`,[t.id,t.email]).toQuery()),k.raw("??",[e.column_name]).toQuery());return{builder:k.raw(t).wrap("(",")")}};break;default:l[e.id]=()=>Promise.resolve({builder:e.column_name})}const C=async(e,t,a)=>{var d,u,p,m,f,h,g,y,b;const w=t?` as ${t}`:"";if(null===(u=null===(d=e.arguments)||void 0===d?void 0:d.forEach)||void 0===u||u.call(d,(t=>{var a;t.fnName||(t.fnName=e.callee.name.toUpperCase(),t.argsCount=null===(a=e.arguments)||void 0===a?void 0:a.length)})),e.cast===r.FormulaDataTypes.STRING)return C({type:"CallExpression",arguments:[Object.assign(Object.assign({},e),{cast:null})],callee:{type:"Identifier",name:"STRING"}},t,a);if("CallExpression"===e.type){switch(e.callee.name.toUpperCase()){case"ADD":case"SUM":return e.arguments.length>1?C({type:"BinaryExpression",operator:"+",left:e.arguments[0],right:Object.assign(Object.assign({},e),{arguments:e.arguments.slice(1)})},t,a):C(e.arguments[0],t,a);case"CONCAT":if("sqlite3"===k.clientType())return e.arguments.length>1?C({type:"BinaryExpression",operator:"||",left:e.arguments[0],right:Object.assign(Object.assign({},e),{arguments:e.arguments.slice(1)})},t,a):C(e.arguments[0],t,a);if("databricks"===k.clientType()){const r=await(0,c.default)({pt:e,knex:k,alias:i,a:t,aliasToCol:l,fn:C,colAlias:w,prevBinaryOp:a,model:s});if(r)return r}break;case"URL":return C({type:"CallExpression",arguments:[{type:"Literal",value:"URI::(",raw:'"URI::("'},e.arguments[0],{type:"Literal",value:")",raw:'")"'},...e.arguments[1]?[{type:"Literal",value:" LABEL::(",raw:" LABEL::("},e.arguments[1],{type:"Literal",value:")",raw:")"}]:[]],callee:{type:"Identifier",name:"CONCAT"}},i,a);default:{const r=await(0,c.default)({pt:e,knex:k,alias:i,a:t,aliasToCol:l,fn:C,colAlias:w,prevBinaryOp:a,model:s});if(r)return r}}const r=e.callee.name.toUpperCase();return{builder:k.raw(`${r}(${(await Promise.all(e.arguments.map((async e=>{let t=(await C(e)).builder.toQuery();return"CONCAT"===r&&("sqlite3"!==k.clientType()&&(t=await(0,_.convertDateFormatForConcat)(S,e,I,t,k.clientType())),"mysql2"===k.clientType())?`IFNULL(${t}, '')`:t})))).join()})${w}`.replace(/\?/g,"\\?"))}}if("Literal"===e.type)return{builder:k.raw(`?${w}`,[e.value])};if("Identifier"===e.type){const{builder:t}=await(null===(p=null==l?void 0:l[e.name])||void 0===p?void 0:p.call(l))||{};return"function"==typeof t?{builder:k.raw(`??${w}`,t(e.fnName))}:"databricks"===k.clientType()&&t.toQuery().endsWith(")")?{builder:k.raw(`${t.toQuery().replace(/\)$/,"")} LIMIT 1)${w}`)}:{builder:k.raw(`??${w}`,[t||e.name])}}if("BinaryExpression"===e.type){if("&"===e.operator)return C({type:"CallExpression",arguments:[e.left,e.right],callee:{type:"Identifier",name:"CONCAT"}},i,a);if("+"===e.operator&&e.dataType===r.FormulaDataTypes.STRING)return C({type:"CallExpression",arguments:[e.left,e.right],callee:{type:"Identifier",name:"CONCAT"}},i,a);if("=="===e.operator||"!="===e.operator){for(const t of["left","right"])e[t].dataType===r.FormulaDataTypes.BOOLEAN&&e["left"===t?"right":"left"].dataType===r.FormulaDataTypes.NUMERIC&&(e["left"===t?"right":"left"]={type:"CallExpression",arguments:[e["left"===t?"right":"left"]],callee:{type:"Identifier",name:"BOOLEAN"},dataType:r.FormulaDataTypes.BOOLEAN});if((null===(m=e.left.callee)||void 0===m?void 0:m.name)!==(null===(f=e.right.callee)||void 0===f?void 0:f.name))for(const t of["left","right"])if("CallExpression"===e[t].type&&"BLANK"===e[t].callee.name){const s=e["left"===t?"right":"left"].dataType===r.FormulaDataTypes.STRING;let l;return l="=="===e.operator?s?"ISBLANK":"ISNULL":s?"ISNOTBLANK":"ISNOTNULL",C({type:"CallExpression",arguments:["left"===t?e.right:e.left],callee:{type:"Identifier",name:l}},i,a)}}"=="===e.operator&&(e.operator="=",e.left.dataType!==e.right.dataType&&[e.left.dataType,e.right.dataType].every((e=>e!==r.FormulaDataTypes.NULL))&&(e.left={type:"CallExpression",arguments:[e.left],callee:{type:"Identifier",name:"STRING"}},e.right={type:"CallExpression",arguments:[e.right],callee:{type:"Identifier",name:"STRING"}})),"/"===e.operator&&(e.left={callee:{name:"FLOAT"},type:"CallExpression",arguments:[e.left]},e.right={callee:{name:"FLOAT"},type:"CallExpression",arguments:[e.right]}),e.left.fnName=e.left.fnName||"ARITH",e.right.fnName=e.right.fnName||"ARITH";let t=(await C(e.left,null,e.operator)).builder.toQuery(),s=(await C(e.right,null,e.operator)).builder.toQuery(),l=`${t} ${e.operator} ${s}${w}`;"pg"===k.clientType()&&I[e.left.name]===r.UITypes.Date&&(""===e.right.value?l="="===e.operator?`${t} IS NULL ${w}`:`${t} IS NOT NULL ${w}`:(0,r.validateDateWithUnknownFormat)(e.right.value)||(l=`${t} IS NOT NULL ${w}`)),"pg"===k.clientType()&&I[e.right.name]===r.UITypes.Date&&(""===e.left.value?l="="===e.operator?`${s} IS NULL ${w}`:`${s} IS NOT NULL ${w}`:(0,r.validateDateWithUnknownFormat)(e.left.value)||(l=`${s} IS NOT NULL ${w}`)),"CONCAT"===e.left.fnName&&"sqlite3"===k.clientType()&&(t=await(0,_.convertDateFormatForConcat)(S,null===(g=null===(h=e.left)||void 0===h?void 0:h.arguments)||void 0===g?void 0:g[0],I,t,k.clientType()),s=await(0,_.convertDateFormatForConcat)(S,null===(b=null===(y=e.right)||void 0===y?void 0:y.arguments)||void 0===b?void 0:b[0],I,s,k.clientType()),l=`COALESCE(${t}, '') ${e.operator} COALESCE(${s},'')${w}`),"mysql2"===k.clientType()?l=`IFNULL(${t} ${e.operator} ${s}, ${"="===e.operator?"Literal"===e.left.type?""===e.left.value:""===e.right.value:"!="===e.operator?"Literal"!==e.left.type?""===e.left.value:""===e.right.value:0}) ${w}`:"sqlite3"!==k.clientType()&&"pg"!==k.clientType()&&"mssql"!==k.clientType()||("="===e.operator?"Literal"===e.left.type&&""===e.left.value?l=`${s} IS NULL OR CAST(${s} AS TEXT) = ''`:"Literal"===e.right.type&&""===e.right.value&&(l=`${t} IS NULL OR CAST(${t} AS TEXT) = ''`):"!="===e.operator&&("Literal"===e.left.type&&""===e.left.value?l=`${s} IS NOT NULL AND CAST(${s} AS TEXT) != ''`:"Literal"===e.right.type&&""===e.right.value&&(l=`${t} IS NOT NULL AND CAST(${t} AS TEXT) != ''`)),l="="!==e.operator&&"!="!==e.operator||"AND"===a||"OR"===a?`${l} ${w}`:`(CASE WHEN ${l} THEN true ELSE false END ${w})`);const c=k.raw(l.replace(/\?/g,"\\?"));return a&&e.operator!==a&&c.wrap("(",")"),{builder:c}}if("UnaryExpression"===e.type){let t;return t="-"!==e.operator&&"+"!==e.operator||e.dataType!==r.FormulaDataTypes.NUMERIC?k.raw(`${e.operator}${(await C(e.argument,null,e.operator)).builder.toQuery()}${w}`):k.raw("?",[("-"===e.operator?-1:1)*e.argument.value]),a&&e.operator!==a&&t.wrap("(",")"),{builder:t}}};return{builder:(await C(O,i)).builder}}},19332:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=a(71040),s=a(43820);async function r(e,t){var a,s;void 0===t&&(t=null===(s=null===(a=e.pt)||void 0===a?void 0:a.arguments)||void 0===s?void 0:s[0]);const r=(await e.fn(t)).builder.toQuery();let l=r;switch(t.dataType){case i.FormulaDataTypes.NUMERIC:l=`(${r}) IS NOT NULL AND (${r}) != 0`;break;case i.FormulaDataTypes.STRING:l=`(${r}) IS NOT NULL AND (${r}) != ''`;break;case i.FormulaDataTypes.BOOLEAN:l=`(${r}) IS NOT NULL AND (${r}) != false`;break;case i.FormulaDataTypes.DATE:l=`(${r}) IS NOT NULL`}return{builder:e.knex.raw(l)}}t.default={SWITCH:async e=>{var t;const a=Math.floor((e.pt.arguments.length-1)/2);let s="";const r=new Set(e.pt.arguments.filter(((e,t)=>t>1&&t%2==0&&e!==i.FormulaDataTypes.NULL)).map((e=>e.dataType)));e.pt.arguments.length%2==0&&r.add(e.pt.arguments[e.pt.arguments.length-1].dataType);const l=(await e.fn(e.pt.arguments[0])).builder.toQuery();let c="";for(let d=0;d<a;d++){let a;a=r.size>1?(await e.fn({type:"CallExpression",arguments:[e.pt.arguments[2*d+2]],callee:{type:"Identifier",name:"STRING"}})).builder.toQuery():(await e.fn(e.pt.arguments[2*d+2])).builder.toQuery(),"CallExpression"===e.pt.arguments[2*d+1].type&&"BLANK"===(null===(t=e.pt.arguments[2*d+1].callee)||void 0===t?void 0:t.name)?c+=e.knex.raw(`\n\tWHEN ${l} IS NULL ${e.pt.arguments[2*d+1].dataType===i.FormulaDataTypes.STRING?`OR ${l} = ''`:""} THEN ${a}`).toQuery():e.pt.arguments[2*d+1].dataType===i.FormulaDataTypes.NULL?c+=e.knex.raw(`\n\tWHEN ${l} IS NULL THEN ${a}`).toQuery():s+=e.knex.raw(`\n\tWHEN ${(await e.fn(e.pt.arguments[2*d+1])).builder.toQuery()} THEN ${a}`).toQuery()}if(e.pt.arguments.length%2==0){let t;t=r.size>1?(await e.fn({type:"CallExpression",arguments:[e.pt.arguments[e.pt.arguments.length-1]],callee:{type:"Identifier",name:"STRING"}})).builder.toQuery():(await e.fn(e.pt.arguments[e.pt.arguments.length-1])).builder.toQuery(),s+=c?`\n\tELSE (CASE ${c} ELSE ${t} END)`:`\n\tELSE ${t}`}else c&&(s+=`\n\tELSE (CASE ${c} END)`);return{builder:e.knex.raw(`CASE ${l} ${s}\n END${e.colAlias}`)}},IF:async e=>{const t=(await r(e)).builder;let a,s;new Set([e.pt.arguments[1].dataType,e.pt.arguments[2].dataType].filter((e=>e!==i.FormulaDataTypes.NULL))).size>1?(a=(await e.fn({type:"CallExpression",arguments:[e.pt.arguments[1]],callee:{type:"Identifier",name:"STRING"}})).builder,s=(await e.fn({type:"CallExpression",arguments:[e.pt.arguments[2]],callee:{type:"Identifier",name:"STRING"}})).builder):(a=(await e.fn(e.pt.arguments[1])).builder.toQuery(),s=(await e.fn(e.pt.arguments[2])).builder.toQuery());let l=e.knex.raw(`\n\tWHEN ${t} THEN ${a}`).toQuery();return e.pt.arguments[2]&&(l+=e.knex.raw(`\n\tELSE ${s}`).toQuery()),{builder:e.knex.raw(`CASE ${l}\n END${e.colAlias}`)}},STRING(e){var t,a;return e.fn(null===(a=null===(t=e.pt)||void 0===t?void 0:t.arguments)||void 0===a?void 0:a[0])},BOOLEAN(e){var t,a;return e.fn(null===(a=null===(t=e.pt)||void 0===t?void 0:t.arguments)||void 0===a?void 0:a[0])},AND:async e=>({builder:e.knex.raw(`${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await r(e,t)).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()}${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await r(e,t)).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()}${e.colAlias}`)}),AVG:async e=>e.pt.arguments.length>1?e.fn({type:"BinaryExpression",operator:"/",left:Object.assign(Object.assign({},e.pt),{callee:{name:"SUM"}}),right:{type:"Literal",value:e.pt.arguments.length}},e.a,e.prevBinaryOp):e.fn(e.pt.arguments[0],e.a,e.prevBinaryOp),FLOAT:async e=>{var t,a;return{builder:(await e.fn(null===(a=null===(t=e.pt)||void 0===t?void 0:t.arguments)||void 0===a?void 0:a[0])).builder.wrap("(",")")}},BLANK:async e=>({builder:e.knex.raw("?",[null])}),TRUE:async e=>({builder:e.knex.raw("?",[1])}),FALSE:async e=>({builder:e.knex.raw("?",[0])}),EVEN:async e=>{const t=(await e.fn(e.pt.arguments[0])).builder;return{builder:e.knex.raw(`CASE WHEN ${t} >= 0 THEN CEIL((${t}) / 2.0) * 2 \n ELSE FLOOR((${t} + 2) / 2.0) * 2 - 2\n END${e.colAlias}`)}},ODD:async e=>{const t=(await e.fn(e.pt.arguments[0])).builder;return{builder:e.knex.raw(`CASE WHEN ${t} >= 0 THEN CEIL((${t} - 1) / 2.0) * 2 + 1 \n ELSE FLOOR((${t} + 1) / 2.0) * 2 - 1\n END${e.colAlias}`)}},RECORD_ID:async e=>{var t;const a=null===(t=e.model)||void 0===t?void 0:t.primaryKey;return a||s.NcError.badRequest("Primary key not found"),{builder:e.knex.raw(`${(await e.fn({type:"Identifier",name:a.id},e.a)).builder} ${e.colAlias}`)}},CREATED_TIME:async e=>{var t,a;const i=null===(a=null===(t=e.model)||void 0===t?void 0:t.columns)||void 0===a?void 0:a.find((e=>"created_at"===e.column_name));return i||s.NcError.badRequest("Created at field not found"),{builder:e.knex.raw(`${(await e.fn({type:"Identifier",name:i.id},e.a)).builder} ${e.colAlias}`)}},LAST_MODIFIED_TIME:async e=>{var t,a;const i=null===(a=null===(t=e.model)||void 0===t?void 0:t.columns)||void 0===a?void 0:a.find((e=>"updated_at"===e.column_name));return i||s.NcError.badRequest("Updated at field not found"),{builder:e.knex.raw(`${(await e.fn({type:"Identifier",name:i.id},e.a)).builder} ${e.colAlias}`)}},COUNTALL:async({knex:e,pt:t,colAlias:a})=>({builder:e.raw(`? ${a}`,[t.arguments.length])}),ROUNDDOWN:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);let r=t.raw("0");if(a.arguments[1]){const{builder:t}=await e(a.arguments[1]);r=t}return{builder:t.raw(`(FLOOR((${s}) * POWER(10, ${r})) / POWER(10, ${r}))${i}`)}},ROUNDUP:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);let r=t.raw("0");if(a.arguments[1]){const{builder:t}=await e(a.arguments[1]);r=t}return{builder:t.raw(`(CEIL((${s}) * POWER(10, ${r})) / POWER(10, ${r}))${i}`)}},ISBLANK:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);return{builder:t.raw(`(${s} IS NULL OR ${s} = '')${i}`)}},ISNULL:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);return{builder:t.raw(`(${s} IS NULL)${i}`)}},ISNOTBLANK:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);return{builder:t.raw(`(${s} IS NOT NULL AND ${s} != '')${i}`)}},ISNOTNULL:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);return{builder:t.raw(`(${s} IS NOT NULL)${i}`)}},URLENCODE:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s="% :/?#[]@$&+,;=";let r=(await e(a.arguments[0])).builder;for(const e of s)r=`REPLACE(${r}, ?, '${encodeURIComponent(e)}')`;return{builder:t.raw(`${r} ${i}`,s.split(""))}}}},74456:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(19332)),r=Object.assign(Object.assign({},s.default),{AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN TRUE ELSE FALSE END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN TRUE ELSE FALSE END ${e.colAlias}`)})});t.default=r},59240:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(44578)),r=i(a(19332)),l=a(55900),c=a(36596),d=Object.assign(Object.assign({},r.default),{MIN:async e=>{if(1===e.pt.arguments.length)return e.fn(e.pt.arguments[0]);let t="";for(const[a,i]of Object.entries(e.pt.arguments))+a==e.pt.arguments.length-1?t+=e.knex.raw(`\n\tElse ${(await e.fn(i)).builder.toQuery()}`).toQuery():t+=e.knex.raw(`\n\tWhen  ${(await Promise.all(e.pt.arguments.filter(((e,t)=>+a!==t)).map((async t=>`${(await e.fn(i)).builder.toQuery()} < ${(await e.fn(t)).builder.toQuery()}`)))).join(" And ")} Then ${(await e.fn(i)).builder.toQuery()}`).toQuery();return{builder:e.knex.raw(`Case ${t}\n End${e.colAlias}`)}},MAX:async e=>{if(1===e.pt.arguments.length)return e.fn(e.pt.arguments[0]);let t="";for(const[a,i]of Object.entries(e.pt.arguments))+a==e.pt.arguments.length-1?t+=e.knex.raw(`\nElse ${(await e.fn(i)).builder.toQuery()}`).toQuery():t+=e.knex.raw(`\nWhen  ${e.pt.arguments.filter(((e,t)=>+a!==t)).map((async t=>`${(await e.fn(i)).builder.toQuery()} > ${(await e.fn(t)).builder.toQuery()}`)).join(" And ")} Then ${(await e.fn(i)).builder.toQuery()}`).toQuery();return{builder:e.knex.raw(`Case ${t}\n End${e.colAlias}`)}},LOG:async e=>({builder:e.knex.raw(`LOG(${(await Promise.all(e.pt.arguments.reverse().map((async t=>(await e.fn(t)).builder.toQuery())))).join(",")})${e.colAlias}`)}),MOD:e=>{Object.assign(e,{type:"BinaryExpression",operator:"%",left:e.arguments[0],right:e.arguments[1]})},REPEAT:"REPLICATE",NOW:"getdate",SEARCH:async e=>{e.pt.callee.name="CHARINDEX";const t=e.pt.arguments[0];e.pt.arguments[0]=e.pt.arguments[1],e.pt.arguments[1]=t},INT:async e=>({builder:e.knex.raw(`CASE WHEN ISNUMERIC(${(await e.fn(e.pt.arguments[0])).builder.toQuery()}) = 1 THEN FLOOR(${(await e.fn(e.pt.arguments[0])).builder.toQuery()}) ELSE 0 END${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as FLOAT)${e.colAlias}`).wrap("(",")")}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[1])).builder;return{builder:t.raw(`CASE\n      WHEN ${(await e(a.arguments[0])).builder} LIKE '%:%' THEN\n        FORMAT(DATEADD(${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}, \n        ${s>0?"+":""}${(await e(a.arguments[1])).builder}, ${(await e(a.arguments[0])).builder}), 'yyyy-MM-dd HH:mm:ss')\n      ELSE\n       FORMAT(DATEADD(${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}, \n       ${s>0?"+":""}${(await e(a.arguments[1])).builder}, ${(await e(a.arguments[0])).builder}), 'yyyy-MM-dd')\n      END${i}`)}},DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder,c=a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds",d=(0,l.convertUnits)(c,"mssql");return{builder:t.raw(`DATEDIFF(${d}, ${r}, ${s}) ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var r;return{builder:t.raw(`(DATEPART(WEEKDAY, ${"Literal"===a.arguments[0].type?`'${(0,s.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:e(a.arguments[0])}) - 2 - ${(0,c.getWeekdayByText)(null===(r=null==a?void 0:a.arguments[1])||void 0===r?void 0:r.value)} % 7 + 7) % 7 ${i}`)}},AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)})});t.default=d},40556:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(44578)),r=i(a(19332)),l=a(55900),c=a(36596),d=Object.assign(Object.assign({},r.default),{LEN:"CHAR_LENGTH",MIN:"LEAST",MAX:"GREATEST",SEARCH:async e=>{e.pt.callee.name="LOCATE";const t=e.pt.arguments[0];e.pt.arguments[0]=e.pt.arguments[1],e.pt.arguments[1]=t},INT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as SIGNED)${e.colAlias}`)}),LEFT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder},1,${(await e.fn(e.pt.arguments[1])).builder})${e.colAlias}`)}),RIGHT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder}, -(${(await e.fn(e.pt.arguments[1])).builder}))${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async e=>({builder:e.knex.raw(`CAST(CAST(${(await e.fn(e.pt.arguments[0])).builder} as CHAR) AS DOUBLE)${e.colAlias}`).wrap("(",")")}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`CASE\n      WHEN ${(await e(a.arguments[0])).builder} LIKE '%:%' THEN\n        DATE_FORMAT(DATE_ADD(${(await e(a.arguments[0])).builder}, INTERVAL\n        ${(await e(a.arguments[1])).builder} ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}), '%Y-%m-%d %H:%i:%s')\n      ELSE\n        DATE(DATE_ADD(${(await e(a.arguments[0])).builder}, INTERVAL\n        ${(await e(a.arguments[1])).builder} ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}))\n      END${i}`)}),DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder,c=(0,l.convertUnits)(a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds","mysql");return"MICROSECOND"===c?{builder:t.raw(`TIMESTAMPDIFF(${c}, ${r}, ${s}) div 1000 ${i}`)}:{builder:t.raw(`TIMESTAMPDIFF(${c}, ${r}, ${s}) ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var r;return{builder:t.raw(`(WEEKDAY(${"Literal"===a.arguments[0].type?`'${(0,s.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:(await e(a.arguments[0])).builder}) - ${(0,c.getWeekdayByText)(null===(r=null==a?void 0:a.arguments[1])||void 0===r?void 0:r.value)} % 7 + 7) % 7 ${i}`)}},REGEX_MATCH:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder;return{builder:t.raw(`(${s} REGEXP ${r}) ${i}`)}},REGEX_EXTRACT:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder;return{builder:t.raw(`REGEXP_SUBSTR(${s}, ${r}, 1, 1, 'c') ${i}`)}},REGEX_REPLACE:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder,l=(await e(a.arguments[2])).builder;return{builder:t.raw(`REGEXP_REPLACE(${s}, ${r}, ${l}, 1, 0, 'c') ${i}`)}},XOR:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=await Promise.all(a.arguments.map((async t=>`${(await e(t)).builder}`)));return{builder:t.raw(`${s.join(" XOR ")} ${i}`)}},VALUE:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder.toString();return{builder:t.raw(`ROUND(CASE\n  WHEN ${s} IS NULL OR REGEXP_REPLACE(${s}, '[^0-9.]+', '') IN ('.', '') OR LENGTH(REGEXP_REPLACE(${s}, '[^.]+', '')) > 1 THEN NULL\n  WHEN LENGTH(REGEXP_REPLACE(${s}, '[^%]', '')) > 0 THEN POW(-1, LENGTH(REGEXP_REPLACE(${s}, '[^-]',''))) * (REGEXP_REPLACE(${s}, '[^0-9.]+', '')) / 100\n  ELSE POW(-1, LENGTH(REGEXP_REPLACE(${s}, '[^-]', ''))) * (REGEXP_REPLACE(${s}, '[^0-9.]+', ''))\nEND) ${i}`)}},STRING:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} AS CHAR) ${e.colAlias}`)})});t.default=d},14200:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(44578)),r=a(71040),l=i(a(19332)),c=a(55900),d=a(36596),u=Object.assign(Object.assign({},l.default),{LEN:"length",MIN:"least",MAX:"greatest",CEILING:"ceil",POWER:"pow",SQRT:"sqrt",SEARCH:async e=>({builder:e.knex.raw(`POSITION(${e.knex.raw((await e.fn(e.pt.arguments[1])).builder.toQuery())} in ${e.knex.raw((await e.fn(e.pt.arguments[0])).builder.toQuery())})${e.colAlias}`)}),INT:e=>({builder:e.knex.raw(`REGEXP_REPLACE(COALESCE(${e.fn(e.pt.arguments[0])}::character varying, '0'), '[^0-9]+|\\.[0-9]+' ,'')${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`CAST(${(await e(a.arguments[0])).builder} as DOUBLE PRECISION)${i}`).wrap("(",")")}),ROUND:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`ROUND((${(await e(a.arguments[0])).builder})::numeric, ${(null==a?void 0:a.arguments[1])?(await e(a.arguments[1])).builder:0}) ${i}`)}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`(${(await e(a.arguments[0])).builder})${a.arguments[0].dataType!==r.FormulaDataTypes.DATE?"::DATE":""} + (${(await e(a.arguments[1])).builder} || \n      '${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}')::interval${i}`)}),DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder,l=a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds";let d;switch((0,c.convertUnits)(l,"pg")){case"second":d=`EXTRACT(EPOCH from (${s}::TIMESTAMP - ${r}::TIMESTAMP))::INTEGER`;break;case"minute":d=`EXTRACT(EPOCH from (${s}::TIMESTAMP - ${r}::TIMESTAMP))::INTEGER / 60`;break;case"milliseconds":d=`EXTRACT(EPOCH from (${s}::TIMESTAMP - ${r}::TIMESTAMP))::INTEGER * 1000`;break;case"hour":d=`EXTRACT(EPOCH from (${s}::TIMESTAMP - ${r}::TIMESTAMP))::INTEGER / 3600`;break;case"week":d=`TRUNC(DATE_PART('day', ${s}::TIMESTAMP - ${r}::TIMESTAMP) / 7)`;break;case"month":d=`(\n                DATE_PART('year', ${s}::TIMESTAMP) - \n                DATE_PART('year', ${r}::TIMESTAMP)\n               ) * 12 + (\n                DATE_PART('month', ${s}::TIMESTAMP) - \n                DATE_PART('month', ${r}::TIMESTAMP)\n               )`;break;case"quarter":d=`((EXTRACT(QUARTER FROM ${s}::TIMESTAMP) + \n                    DATE_PART('year', AGE(${s}, '1900/01/01')) * 4) - 1) - \n                ((EXTRACT(QUARTER FROM ${r}::TIMESTAMP) + \n                    DATE_PART('year', AGE(${r}, '1900/01/01')) * 4) - 1)`;break;case"year":d=`DATE_PART('year', AGE(${s}, ${r}))`;break;case"day":d=`DATE_PART('day', ${s}::TIMESTAMP - ${r}::TIMESTAMP)`;break;default:d=""}return{builder:t.raw(`${d} ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var r;return{builder:t.raw(`(EXTRACT(ISODOW FROM ${"Literal"===a.arguments[0].type?`date '${(0,s.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:(await e(a.arguments[0])).builder}) - 1 - ${(0,d.getWeekdayByText)(null===(r=null==a?void 0:a.arguments[1])||void 0===r?void 0:r.value)} % 7 + 7) ::INTEGER % 7 ${i}`)}},DATESTR:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`TO_CHAR((${(await e(null==a?void 0:a.arguments[0])).builder}), 'YYYY-MM-DD')::text ${i}`)}),DAY:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`EXTRACT('Day' FROM ((${(await e(null==a?void 0:a.arguments[0])).builder})::TIMESTAMP)) ${i}`)}),MONTH:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`EXTRACT('Month' FROM ((${(await e(null==a?void 0:a.arguments[0])).builder})::TIMESTAMP)) ${i}`)}),HOUR:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`EXTRACT('Hour' FROM ((${(await e(null==a?void 0:a.arguments[0])).builder})::TIMESTAMP)) ${i}`)}),AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN TRUE ELSE FALSE END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN TRUE ELSE FALSE END ${e.colAlias}`)}),SUBSTR:async({fn:e,knex:t,pt:a,colAlias:i})=>{var s;const r=(await e(a.arguments[0])).builder,l=(await e(null!==(s=a.arguments[1])&&void 0!==s?s:1)).builder,c=a.arguments[2]?(await e(a.arguments[2])).builder:null;return{builder:t.raw(`SUBSTR(${r}::TEXT, ${l}${c?", "+c:""})${i}`)}},MOD:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder;return{builder:t.raw(`MOD((${s})::NUMERIC, (${r})::NUMERIC) ${i}`)}},REGEX_MATCH:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder;return{builder:t.raw(`CASE WHEN REGEXP_MATCH(${s}::TEXT, ${r}::TEXT) IS NULL THEN 0 ELSE 1 END ${i}`)}},REGEX_EXTRACT:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder;return{builder:t.raw(`SUBSTRING(${s}::TEXT from ${r}::TEXT) ${i}`)}},REGEX_REPLACE:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder,r=(await e(a.arguments[1])).builder,l=(await e(a.arguments[2])).builder;return{builder:t.raw(`REGEXP_REPLACE(${s}::TEXT, ${r}::TEXT, ${l}::TEXT, 'g') ${i}`)}},XOR:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=await Promise.all(a.arguments.map((async t=>{const a=(await e(t)).builder.toString();return`CASE WHEN ${a}  IS NOT NULL AND ${a}::boolean = true THEN 1 ELSE 0 END`})));return{builder:t.raw(`${s.join(" # ")} ${i}`)}},COUNT:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`${(await Promise.all(a.arguments.map((async t=>{const{builder:a}=await e(t);return`CASE WHEN pg_typeof(${a}) IN ('smallint', 'integer', 'bigint', 'decimal', 'numeric', 'real', 'double precision') AND ${a} IS NOT NULL THEN 1 ELSE 0 END`})))).join(" + ")} ${i}`)}),COUNTA:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`${(await Promise.all(a.arguments.map((async t=>{const{builder:a}=await e(t);return`CASE WHEN ${a} IS NOT NULL AND ${a}::text != '' THEN 1 ELSE 0 END`})))).join(" + ")} ${i}`)}),VALUE:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[0])).builder.toString();return{builder:t.raw(`CASE \n  WHEN ${s} IS NULL OR REGEXP_REPLACE(${s}::TEXT, '[^\\d.]+', '', 'g') IN ('.', '') OR LENGTH(REGEXP_REPLACE(${s}::TEXT, '[^.]+', '', 'g')) > 1 THEN NULL\n  WHEN LENGTH(REGEXP_REPLACE(${s}::TEXT, '[^%]', '','g')) > 0 THEN POW(-1, LENGTH(REGEXP_REPLACE(${s}::TEXT, '[^-]','', 'g'))) * (REGEXP_REPLACE(${s}::TEXT, '[^\\d.]+', '', 'g'))::NUMERIC / 100\n  ELSE POW(-1, LENGTH(REGEXP_REPLACE(${s}::TEXT, '[^-]', '', 'g'))) * (REGEXP_REPLACE(${s}::TEXT, '[^\\d.]+', '', 'g'))::NUMERIC\nEND ${i}`)}},ROUNDDOWN:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);let r=t.raw("0");if(a.arguments[1]){const{builder:t}=await e(a.arguments[1]);r=t}return{builder:t.raw(`(FLOOR((${s}) * POWER(10, ${r})) / POWER(10, ${r})::numeric(30,${r}))${i}`)}},ROUNDUP:async({fn:e,knex:t,pt:a,colAlias:i})=>{const{builder:s}=await e(a.arguments[0]);let r=t.raw("0");if(a.arguments[1]){const{builder:t}=await e(a.arguments[1]);r=t}return{builder:t.raw(`(CEIL((${s}) * POWER(10, ${r})) / POWER(10, ${r})::numeric(30,${r}))${i}`)}},STRING:async e=>({builder:e.knex.raw(`(${(await e.fn(e.pt.arguments[0])).builder})::text ${e.colAlias}`)}),BOOLEAN:async e=>({builder:e.knex.raw(`(${(await e.fn(e.pt.arguments[0])).builder})::boolean${e.colAlias}`)})});t.default=u},14196:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(44578)),r=a(71040),l=i(a(19332)),c=a(55900),d=a(36596),u=Object.assign(Object.assign({},l.default),{LEN:"LENGTH",CEILING:async e=>({builder:e.knex.raw(`round(${(await e.fn(e.pt.arguments[0])).builder} + 0.5)${e.colAlias}`)}),FLOOR:async e=>({builder:e.knex.raw(`round(${(await e.fn(e.pt.arguments[0])).builder} - 0.5)${e.colAlias}`)}),MOD:async e=>e.fn({type:"BinaryExpression",operator:"%",left:e.pt.arguments[0],right:e.pt.arguments[1]}),REPEAT:async e=>({builder:e.knex.raw(`replace(printf('%.' || ${(await e.fn(e.pt.arguments[1])).builder} || 'c', '/'),'/',${(await e.fn(e.pt.arguments[0])).builder})${e.colAlias}`)}),NOW:e=>({builder:e.knex.raw(`DATETIME('now', 'localtime')${e.colAlias}`)}),SEARCH:"INSTR",INT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as INTEGER)${e.colAlias}`)}),LEFT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder},1,${(await e.fn(e.pt.arguments[1])).builder})${e.colAlias}`)}),RIGHT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder},-(${(await e.fn(e.pt.arguments[1])).builder}))${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as FLOAT)${e.colAlias}`).wrap("(",")")}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>{const s=(await e(a.arguments[1])).builder;return{builder:t.raw(`CASE\n      WHEN ${(await e(a.arguments[0])).builder} LIKE '%:%' THEN\n        STRFTIME('%Y-%m-%dT%H:%M:%fZ', DATETIME(DATETIME(${(await e(a.arguments[0])).builder}, 'utc'),\n        ${s>0?"+":""}${(await e(a.arguments[1])).builder} || ' ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}'))\n      ELSE\n        DATE(DATETIME(${(await e(a.arguments[0])).builder}),\n        ${s>0?"+":""}${(await e(a.arguments[1])).builder} || ' ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}')\n      END${i}`)}},DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{var s,l;let d=(await e(a.arguments[0])).builder,u=(await e(a.arguments[1])).builder;"?"===d.sql&&(null===(s=d.bindings)||void 0===s?void 0:s[0])&&(d=`'${(0,r.convertToTargetFormat)(d.bindings[0],(0,r.getDateFormat)(d.bindings[0]),"YYYY-MM-DD")}'`),"?"===u.sql&&(null===(l=u.bindings)||void 0===l?void 0:l[0])&&(u=`'${(0,r.convertToTargetFormat)(u.bindings[0],(0,r.getDateFormat)(u.bindings[0]),"YYYY-MM-DD")}'`);const p=a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds";let m;switch((0,c.convertUnits)(p,"sqlite")){case"seconds":m=`(strftime('%s', ${d}) - strftime('%s', ${u}))`;break;case"minutes":m=`(strftime('%s', ${d}) - strftime('%s', ${u})) / 60`;break;case"hours":m=`(strftime('%s', ${d}) - strftime('%s', ${u})) / 3600`;break;case"milliseconds":m=`(strftime('%s', ${d}) - strftime('%s', ${u})) * 1000`;break;case"weeks":m=`ROUND((JULIANDAY(${d}) - JULIANDAY(${u})) / 7)`;break;case"months":m=`(strftime('%Y', ${d}) - strftime('%Y', ${u})) * 12 + (strftime('%m', ${d}) - strftime('%m', ${u})) `;break;case"quarters":m=`(strftime('%Y', ${d}) - strftime('%Y', ${u})) * 4 + (strftime('%m', ${d}) - strftime('%m', ${u})) / 3`;break;case"years":m=`CASE\n                WHEN (${u} < ${d}) THEN\n                (\n                  (strftime('%Y', ${d}) - strftime('%Y', ${u}))\n                  - (strftime('%m', ${d}) < strftime('%m', ${u})\n                  OR (strftime('%m', ${d}) = strftime('%m', ${u})\n                  AND strftime('%d', ${d}) < strftime('%d', ${u})))\n                )\n                WHEN (${u} > ${d}) THEN\n                -1 * (\n                  (strftime('%Y', ${u}) - strftime('%Y', ${d}))\n                  - (strftime('%m', ${u}) < strftime('%m', ${d})\n                  OR (strftime('%m', ${u}) = strftime('%m', ${d})\n                  AND strftime('%d', ${u}) < strftime('%d', ${d})))\n                )\n                ELSE 0\n              END`;break;case"days":m=`JULIANDAY(${d}) - JULIANDAY(${u})`;break;default:m=""}return{builder:t.raw(`ROUND(${m}) ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var r;return{builder:t.raw(`(strftime('%w', ${"Literal"===a.arguments[0].type?`'${(0,s.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:(await e(a.arguments[0])).builder}) - 1 - ${(0,d.getWeekdayByText)(null===(r=null==a?void 0:a.arguments[1])||void 0===r?void 0:r.value)} % 7 + 7) % 7 ${i}`)}},AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)})});t.default=u},98548:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({baseModelSqlv2:e,knex:t,alias:a,columnOptions:r}){const l=e.context,c=await r.getRelationColumn(l),d=await c.getColOptions(l),u=await r.getRollupColumn(l),p=await d.getChildColumn(l),m=await(null==p?void 0:p.getModel(l)),_=await d.getParentColumn(l),f=await(null==_?void 0:_.getModel(l)),h="__nc_rollup",g=await s.Model.getBaseModelSQL(l,{model:f,dbDriver:t}),y=await s.Model.getBaseModelSQL(l,{model:m,dbDriver:t}),b=a=>{var i,s,l;e.isPg&&["sum","sumDistinct","avgDistinct","avg"].includes(r.rollup_function)&&["bool","boolean"].includes(u.dt)?null===(i=a[r.rollup_function])||void 0===i||i.call(a,t.raw("??.??::integer",[h,u.column_name])):["sum","sumDistinct","avgDistinct","avg"].includes(r.rollup_function)?a.select(t.raw("COALESCE((??), 0)",[null===(s=t[r.rollup_function])||void 0===s?void 0:s.call(t,t.ref(`${h}.${u.column_name}`))])):null===(l=a[r.rollup_function])||void 0===l||l.call(a,t.ref(`${h}.${u.column_name}`))};switch(d.type){case i.RelationTypes.HAS_MANY:{const e=t(t.raw("?? as ??",[y.getTnPath(m),h])).where(t.ref(`${a||g.getTnPath(f.table_name)}.${_.column_name}`),"=",t.ref(`${h}.${p.column_name}`));return b(e),{builder:e}}case i.RelationTypes.ONE_TO_ONE:{const e=t(t.raw("?? as ??",[y.getTnPath(null==m?void 0:m.table_name),h])).where(t.ref(`${a||g.getTnPath(f.table_name)}.${_.column_name}`),"=",t.ref(`${h}.${p.column_name}`));return b(e),{builder:e}}case i.RelationTypes.MANY_TO_MANY:{const e=await d.getMMModel(l),r=await d.getMMChildColumn(l),c=await d.getMMParentColumn(l),u=await s.Model.getBaseModelSQL(l,{id:e.id,dbDriver:t});if(!e)return this.dbDriver.raw("?",[i.NcDataErrorCodes.NC_ERR_MM_MODEL_NOT_FOUND]);const w=t(t.raw("?? as ??",[g.getTnPath(null==f?void 0:f.table_name),h])).innerJoin(u.getTnPath(e.table_name),t.ref(`${u.getTnPath(e.table_name)}.${c.column_name}`),"=",t.ref(`${h}.${_.column_name}`)).where(t.ref(`${u.getTnPath(e.table_name)}.${r.column_name}`),"=",t.ref(`${a||y.getTnPath(m.table_name)}.${p.column_name}`));return b(w),{builder:w}}default:throw Error(`Unsupported relation type '${d.type}'`)}};const i=a(71040),s=a(19684)},73172:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDisplayValueOfRefTable=m,t.default=async function({column:e,baseModelSqlv2:t,alias:a,model:i,getAlias:_=(0,d.getAliasGenerator)("__lk_slt_"),isAggregation:f=!1}){var h,g;const y=t.dbDriver,b=t.context,w=a;{let a;const i=_();let d,v=!0;e.uidt===s.UITypes.Lookup?d=await e.getColOptions(b):e.uidt!==s.UITypes.LinkToAnotherRecord&&u.NcError.badRequest("Invalid field type"),await e.getColOptions(b);{const l=d?await d.getRelationColumn(b):e,c=await l.getColOptions(b);let u=c.type;if(u===s.RelationTypes.ONE_TO_ONE&&(u=(null===(h=l.meta)||void 0===h?void 0:h.bt)?s.RelationTypes.BELONGS_TO:s.RelationTypes.HAS_MANY),u===s.RelationTypes.BELONGS_TO){const e=await c.getChildColumn(b),s=await c.getParentColumn(b),l=await e.getModel(b);await l.getColumns(b);const d=await s.getModel(b);await d.getColumns(b);const u=await r.Model.getBaseModelSQL(b,{model:d,dbDriver:y});a=y(y.raw("?? as ??",[u.getTnPath(d.table_name),i])).where(`${i}.${s.column_name}`,y.raw("??",[`${w||t.getTnPath(l.table_name)}.${e.column_name}`]))}else if(u===s.RelationTypes.HAS_MANY){v=!1;const e=await c.getChildColumn(b),s=await c.getParentColumn(b),l=await e.getModel(b);await l.getColumns(b);const d=await s.getModel(b);await d.getColumns(b);const u=await r.Model.getBaseModelSQL(b,{model:d,dbDriver:y});a=y(y.raw("?? as ??",[u.getTnPath(l.table_name),i])).where(`${i}.${e.column_name}`,y.raw("??",[`${w||t.getTnPath(d.table_name)}.${s.column_name}`]))}else if(u===s.RelationTypes.MANY_TO_MANY){v=!1;const e=await c.getChildColumn(b),s=await c.getParentColumn(b),l=await e.getModel(b);await l.getColumns(b);const d=await s.getModel(b);await d.getColumns(b);const u=await r.Model.getBaseModelSQL(b,{model:d,dbDriver:y});a=y(y.raw("?? as ??",[u.getTnPath(d.table_name),i]));const p=_(),m=await c.getMMModel(b),f=await c.getMMChildColumn(b),h=await c.getMMParentColumn(b),g=await r.Model.getBaseModelSQL(b,{model:m,dbDriver:y});a.innerJoin(g.getTnPath(m.table_name,p),y.ref(`${p}.${h.column_name}`),"=",y.ref(`${i}.${s.column_name}`)).where(y.ref(`${p}.${f.column_name}`),"=",y.ref(`${w||t.getTnPath(l.table_name)}.${e.column_name}`))}}let T=d?await d.getLookupColumn(b):await m(b,e);[s.UITypes.QrCode,s.UITypes.Barcode].includes(T.uidt)&&(T=await T.getColOptions(b).then((e=>e.getValueColumn(b))));let k=i;for(;T.uidt===s.UITypes.Lookup||T.uidt===s.UITypes.LinkToAnotherRecord;){const e=_();let l,c;T.uidt===s.UITypes.Lookup?(c=await T.getColOptions(b),l=await c.getRelationColumn(b)):l=T;const d=await l.getColOptions(b);let u=d.type;if(u===s.RelationTypes.ONE_TO_ONE&&(u=(null===(g=l.meta)||void 0===g?void 0:g.bt)?s.RelationTypes.BELONGS_TO:s.RelationTypes.HAS_MANY),u===s.RelationTypes.BELONGS_TO){const t=await d.getChildColumn(b),i=await d.getParentColumn(b),s=await t.getModel(b);await s.getColumns(b);const l=await i.getModel(b);await l.getColumns(b);const c=await r.Model.getBaseModelSQL(b,{model:l,dbDriver:y});a.join(y.raw("?? as ??",[c.getTnPath(l.table_name),e]),`${e}.${i.column_name}`,`${k}.${t.column_name}`)}else if(u===s.RelationTypes.HAS_MANY){v=!1;const t=await d.getChildColumn(b),i=await d.getParentColumn(b),s=await t.getModel(b);await s.getColumns(b);const l=await i.getModel(b);await l.getColumns(b);const c=await r.Model.getBaseModelSQL(b,{model:s,dbDriver:y});a.join(y.raw("?? as ??",[c.getTnPath(s.table_name),e]),`${e}.${t.column_name}`,`${k}.${i.column_name}`)}else if(u===s.RelationTypes.MANY_TO_MANY){v=!1;const s=await d.getChildColumn(b),l=await d.getParentColumn(b),c=await s.getModel(b);await c.getColumns(b);const u=await l.getModel(b);await u.getColumns(b);const p=await r.Model.getBaseModelSQL(b,{model:u,dbDriver:y}),m=_(),f=await d.getMMModel(b),h=await d.getMMChildColumn(b),g=await d.getMMParentColumn(b),w=await r.Model.getBaseModelSQL(b,{model:f,dbDriver:y});a.innerJoin(w.getTnPath(f.table_name,m),y.ref(`${m}.${h.column_name}`),"=",y.ref(`${k}.${s.column_name}`)).innerJoin(y.raw("?? as ??",[p.getTnPath(u.table_name),e]),y.ref(`${m}.${g.column_name}`),"=",y.ref(`${e}.${l.column_name}`)).where(y.ref(`${m}.${h.column_name}`),"=",y.ref(`${i||t.getTnPath(c.table_name)}.${s.column_name}`))}T=T.uidt===s.UITypes.Lookup?await c.getLookupColumn(b):await m(b,l),k=e}{const e=await T.getModel(b),t=await r.Model.getBaseModelSQL(b,{model:e,dbDriver:y});switch(T.uidt){case s.UITypes.Links:case s.UITypes.Rollup:{const e=(await(0,c.default)({baseModelSqlv2:t,knex:y,columnOptions:await T.getColOptions(b),alias:k})).builder;a.select({[T.id]:y.raw(e).wrap("(",")")})}break;case s.UITypes.Formula:{const i=(await(0,l.default)(t,(await T.getColOptions(b)).formula,T.id,e,T,await e.getAliasColMapping(b),k)).builder;a.select(i)}break;case s.UITypes.DateTime:case s.UITypes.LastModifiedTime:case s.UITypes.CreatedTime:await t.selectObject({qb:a,columns:[T],alias:k});break;case s.UITypes.Attachment:if(!f){u.NcError.badRequest("Group by using attachment column is not supported");break}default:a.select(`${k}.${T.column_name} as ${T.id}`)}}if(v)return{builder:a};const S=_();if(t.isPg)return{builder:y.select(y.raw("json_agg(??)::text",[T.id])).from(a.as(S))};if(t.isMySQL)return{builder:y.select(y.raw("cast(JSON_ARRAYAGG(??) as NCHAR)",[T.id])).from(a.as(S))};if(t.isSqlite)return{builder:y.select(y.raw("group_concat(??, ?)",[T.id,p])).from(a.as(S))};if(t.isMssql)return{builder:y.select(y.raw("STRING_AGG(??, ?)",[T.id,p])).from(a.as(S))};u.NcError.notImplemented("This operation on Lookup/LTAR for this database")}};const s=a(71040),r=a(19684),l=i(a(28148)),c=i(a(98548)),d=a(62304),u=a(43820),p="___";async function m(e,t){return await t.getColOptions(e).then((t=>t.getRelatedTable(e))).then((t=>t.getColumns(e))).then((e=>e.find((e=>e.pv))||e[0]))}},35984:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(59240)),r=i(a(40556)),l=i(a(14200)),c=i(a(14196)),d=i(a(74456));t.default=async e=>{const t=e.pt.callee.name.toUpperCase();let a;switch(e.knex.clientType()){case"mysql":case"mysql2":case"maridb":a=r.default[t]||t;break;case"pg":case"postgre":a=l.default[t]||t;break;case"mssql":a=s.default[t]||t;break;case"sqlite":case"sqlite3":a=c.default[t]||t;break;case"databricks":a=d.default[t]||t}if("function"==typeof a)return a(e);"string"==typeof a&&(e.pt.callee.name=a)}},7524:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,a,i,_=!1){const f=e.dbDriver,h=e.context;if(!(null==t?void 0:t.length))return;for(const g of t){let t;t=g instanceof r.Sort?g:new r.Sort(g);const y=await(0,m.getRefColumnIfAlias)(h,await t.getColumn(h));if(!y){_&&l.NcError.fieldNotFound(t.fk_column_id);continue}const b=await y.getModel(h),w="desc"===t.direction?"LAST":"FIRST";switch(y.uidt){case s.UITypes.Rollup:case s.UITypes.Links:{const s=(await(0,d.default)({baseModelSqlv2:e,knex:f,columnOptions:await y.getColOptions(h),alias:i})).builder;a.orderBy(s,t.direction||"asc",w)}break;case s.UITypes.Formula:case s.UITypes.Button:{const r=await y.getColOptions(h);if(y.uidt===s.UITypes.Formula||y.uidt===s.UITypes.Button&&"url"===r.type){const s=r.getParsedTree();if("Literal"===(null==s?void 0:s.type)){a.orderBy(f.raw("?",[1]),t.direction||"asc",w);break}const l=(await(0,c.default)(e,r.formula,null,b,y,{},i)).builder;a.orderBy(l,t.direction||"asc",w)}else a.orderBy(f.raw("?",[1]),t.direction||"asc",w)}break;case s.UITypes.Lookup:case s.UITypes.LinkToAnotherRecord:{const s=i;{const i=await(0,p.default)({baseModelSqlv2:e,column:y,alias:s,model:b});a.orderBy(null==i?void 0:i.builder,t.direction||"asc",w)}}break;case s.UITypes.SingleSelect:{const e=f.clientType();"mysql"===e||"mysql2"===e?a.orderBy((0,u.sanitize)(f.raw("CONCAT(??)",[y.column_name])),t.direction||"asc",w):"mssql"===e?a.orderBy((0,u.sanitize)(f.raw("CAST(?? AS VARCHAR(MAX))",[y.column_name])),t.direction||"asc",w):a.orderBy((0,u.sanitize)(y.column_name),t.direction||"asc",w);break}case s.UITypes.MultiSelect:{const e=f.clientType();"mysql"===e||"mysql2"===e?a.orderBy((0,u.sanitize)(f.raw("CONCAT(??)",[y.column_name])),t.direction||"asc",w):"mssql"===e?a.orderBy((0,u.sanitize)(f.raw("CAST(?? AS VARCHAR(MAX))",[y.column_name])),t.direction||"asc",w):a.orderBy((0,u.sanitize)(y.column_name),t.direction||"asc",w);break}case s.UITypes.User:case s.UITypes.CreatedBy:case s.UITypes.LastModifiedBy:{const e=await r.Base.get(h,b.base_id),i=(await r.BaseUser.getUsersList(h,{base_id:e.id})).reduce(((e,t)=>f.raw(`REPLACE(${e}, ?, ?)`,[t.id,t.display_name||t.email]).toQuery()),f.raw("??",[y.column_name]).toQuery());a.orderBy((0,u.sanitize)(f.raw(i)),t.direction||"asc",w);break}default:a.orderBy((0,u.sanitize)(y.column_name),t.direction||"asc",w)}}};const s=a(71040),r=a(19684),l=a(43820),c=i(a(28148)),d=i(a(98548)),u=a(44356),p=i(a(73172)),m=a(43468)},69643:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_1=__importDefault(__webpack_require__(2058)),util_1=__webpack_require__(50970),path_1=__importDefault(__webpack_require__(67072)),knex_1=__webpack_require__(50536),findIndex_1=__importDefault(__webpack_require__(11982)),find_1=__importDefault(__webpack_require__(72208)),jsonfile_1=__importDefault(__webpack_require__(50162)),mkdirp_1=__importDefault(__webpack_require__(75058)),Result_1=__importDefault(__webpack_require__(58108)),emit_1=__importDefault(__webpack_require__(29896)),Debug_1=__importDefault(__webpack_require__(98152)),dataHelp=__importStar(__webpack_require__(62308)),SqlClient_1=__importDefault(__webpack_require__(28309)),utils_1=__webpack_require__(62304),evt=new emit_1.default,log=new Debug_1.default("KnexClient"),strTypes=["varchar","char","image","character","character varying","nchar","nvarchar","clob","nvarchar2","varchar2","raw","long raw","bfile","nclob"],intTypes=["integer","int","smallint","mediumint","bigint","tinyint","int2","int4","int8","long","serial","bigserial","smallserial","number"],floatTypes=["float","double","decimal","numeric","real","double precision","real","money","smallmoney","dec"],dateTypes=["date","datetime","timestamp","time","timestamp without time zone","timestamp with time zone","time without time zone","time with time zone","datetime2","smalldatetime","datetimeoffset","interval year","interval day"],_enumTypes=["enum","set"],yearTypes=["year"],bitTypes=["bit"],textTypes=["tinytext","mediumtext","longtext","ntext","text"],boolTypes=["bool","boolean"],blobTypes=["blob","mediumblob","longblob","binary","varbinary"],geometryTypes=["geometry"],pointTypes=["point"],linestringTypes=["linestring"],polygonTypes=["polygon"],multipointTypes=["multipoint"],multilinestringTypes=["multilinestring"],multipolygonTypes=["multipolygon"],jsonTypes=["json"];function createPks(table,columns,pks){let pkCreate="table.primary([";for(let e=0;e<pks.length;++e)pkCreate+=e?`"${columns[pks[e]].cn}"`:`"${columns[pks[e]].cn}",`;pkCreate+="])",eval(`var inMemoryFunc = function(table) {\n    ${pkCreate}\n  }`),console.log(pkCreate),inMemoryFunc(table)}function columnCreate(e,t,a){let i,s=!1;if("varchar"===a.dt||"char"===a.dt||"text"===a.dt?a.cdf=a.cdf?JSON.stringify(a.cdf):null:a.cdf=""===a.cdf?null:a.cdf,a.ai&&("bigInteger"===a.dtx?(i=t.bigIncrements(a.cn),s=!0):(i=t.increments(a.cn),s=!0)),"specificType"!==a.dtx||s)"integer"!==a.dtx||s?"bigInteger"!==a.dtx||s?"text"!==a.dtx||s?"string"!==a.dtx||s?"float"!==a.dtx||s?"decimal"!==a.dtx||s?"boolean"!==a.dtx||s?"date"!==a.dtx||s?"dateTime"!==a.dtx||s?"time"!==a.dtx||s?"timestamp"!==a.dtx||s?"enu"!==a.dtx||s?"json"!==a.dtx||s?"uuid"!==a.dtx||s||(i=t.uuid(a.cn)):i=t.json(a.cn):i=t.enu(a.cn,JSON.stringify(a.enuValue||[])):i=t.timestamp(a.cn):i=t.time(a.cn):i=t.dateTime(a.cn):i=t.date(a.cn):i=t.boolean(a.cn):i=t.decimal(a.cn):i=t.float(a.cn):i=t.string(a.cn):i=t.text(a.cn):i=t.bigInteger(a.cn):i=t.integer(a.cn);else{const e=a.dtxp&&" "!==a.dtxp?a.dtxp:null,s=a.dtxs&&" "!==a.dtxs?a.dtxs:null;i=e&&s?t.specificType(a.cn,`${a.dt}(${e},${s})`):e?t.specificType(a.cn,`${a.dt}(${e})`):t.specificType(a.cn,a.dt)}a.pk&&i.primary(),a.rqd?i.notNullable():i.nullable(),a.ck&&i.unique(),a.un&&i.unsigned(),a.cdf&&i.defaultTo(e.raw(a.cdf))}function removeColumn(table,_n,_o){const colCreate="table.dropColumn(n.cn)";eval(`var inMemoryFunc = function(table) {\n    ${colCreate}\n  }`),inMemoryFunc(table)}function renameColumn(e,t,a,i,s){let r="",l="";if("mysql"===t.client){const e=s.ct,t=s.rqd?"NOT NULL":"",a=s.ai?"AUTO_INCREMENT":"",c=s.cdf?`DEFAULT '${s.cdf}'`:"";r=`ALTER TABLE \`${s.tn}\` CHANGE COLUMN\n                  \`${i.cn}\` \`${s.cn}\` ${e} ${t} ${a} ${c}`,l=`ALTER TABLE \`${s.tn}\` CHANGE COLUMN\n                  \`${s.cn}\` \`${i.cn}\` ${e} ${t} ${a} ${c}`;return{upStatement:[{sql:r}],downStatement:[{sql:l}]}}}function pkUpdate(table,n,o){let colUpdate="table";log.debug(n,o),colUpdate="";let pkCount=0;for(let e=0;e<o.length;++e)o[e].pk&&(colUpdate+=pkCount?`,"${o[e].cn}"`:`table.dropPrimary(["${o[e].cn}"`,pkCount+=1,log.debug(colUpdate));pkCount&&(colUpdate+="]);\n"),colUpdate+="",pkCount=0;for(let e=0;e<n.length;++e)n[e].pk&&(colUpdate+=pkCount?`,"${n[e].cn}"`:`table.primary(["${n[e].cn}"`,pkCount+=1,log.debug(colUpdate));pkCount&&(colUpdate+="]);\n"),log.debug(colUpdate),eval(`var inMemoryFunc = function(table) {\n    ${colUpdate}\n  }`),inMemoryFunc(table)}function columnUpdate(e,t,a,i){let s,r=!1,l=!1,c=!1,d=!1;if("varchar"===a.dt||"char"===a.dt||"text"===a.dt?a.cdf=a.cdf?JSON.stringify(a.cdf):null:a.cdf=""===a.cdf?null:a.cdf,"ai"in a&&i&&a.ai!==i.ai&&a.ai?(s=t.increments(a.cn),r=!0):!("pk"in a)||i&&a.pk===i.pk||!a.pk?"pk"in a&&i&&a.pk!==i.pk&&!a.pk&&(s=t.dropPrimary(a.cn)):s=t.primary(a.cn),"dtx"in a&&"specificType"===a.dtx&&!r){const e=a.dtxp&&" "!==a.dtxp?a.dtxp:null,i=a.dtxs&&" "!==a.dtxs?a.dtxs:null;s=e&&i?t.specificType(a.cn,`${a.dt}(${e},${i})`):e?t.specificType(a.cn,`${a.dt}(${e})`):t.specificType(a.cn,a.dt)}else"dtx"in a&&"integer"===a.dtx&&!r?s=i?t.integer(a.cn,a.dtxp):t.integer(a.cn):"dtx"in a&&"bigInteger"===a.dtx&&!r?s=t.bigInteger(a.cn):"dtx"in a&&"text"===a.dtx&&!r?s=t.text(a.cn):"dtx"in a&&"string"===a.dtx&&!r?s=i?t.string(a.cn,a.dtxp):t.string(a.cn):"dtx"in a&&"float"===a.dtx&&!r?s=i?t.float(a.cn,a.dtxp,a.dtxs):t.float(a.cn):"dtx"in a&&"decimal"===a.dtx&&!r?s=i?t.decimal(a.cn,a.dtxp,a.dtxs):t.decimal(a.cn):"dtx"in a&&"boolean"===a.dtx&&!r?s=t.boolean(a.cn):"dtx"in a&&"binary"===a.dtx&&!r?s=t.binary(a.cn):"dtx"in a&&"date"===a.dtx&&!r?s=t.date(a.cn):"dtx"in a&&"dateTime"===a.dtx&&!r?s=t.dateTime(a.cn):"dtx"in a&&"time"===a.dtx&&!r?s=t.time(a.cn):"dtx"in a&&"timestamp"===a.dtx&&!r?s=t.timestamp(a.cn):"dtx"in a&&"enu"===a.dtx&&!r?s=t.enu(a.cn,JSON.stringify(a.enuValue||[])):"dtx"in a&&"json"===a.dtx&&!r?s=t.json(a.cn):"dtx"in a&&"uuid"===a.dtx&&!r&&(s=t.uuid(a.cn));i?(a.rqd===i.rqd||a.rqd||(s.nullable(),a.cdf&&(s.defaultTo(e.raw(a.cdf)),l=!0),a.un&&(s.unsigned(),c=!0)),a.rqd!==i.rqd&&a.rqd&&!d&&(s.notNullable(),d=!0,a.cdf&&!l&&(s.defaultTo(e.raw(a.cdf)),l=!0),a.un&&!c&&(s.unsigned(),c=!0)),a.un===i.un||c||(a.un&&s.unsigned(),a.cdf&&!l&&(s.defaultTo(e.raw(a.cdf)),l=!0),a.rqd&&!d&&(s.notNullable(),d=!0)),a.cdf===i.cdf||l||(s.defaultTo(a.cdf?e.raw(a.cdf):null),a.rqd&&!d&&(s.notNullable(),d=!0),a.un&&!c&&(s.unsigned(),c=!0)),i&&a.ck===i.ck||!a.ck||s.unique(),i&&a.ck===i.ck||a.ck||s.dropUnique(a.cn)):(a.rqd?s.notNullable():a.rqd||a.cdf||s.nullable(),a.un&&s.unsigned(),a.cdf&&s.defaultTo(e.raw(a.cdf))),i&&i.cno!==a.cn&&s.renameColumn(a.cno,a.cn),1&a.altered||2&a.altered&&s.alter()}class KnexClient extends SqlClient_1.default{constructor(e){if(super(e),this.validateInput(),e.connection&&e.connection.port&&(e.connection.port=+e.connection.port),this._connectionConfig=e,e.knex)this.sqlClient=e.knex;else{const t="sqlite3"===e.client?e.connection:e;this.sqlClient=(0,knex_1.knex)(t)}this.knex=this.sqlClient,this.metaDb={},this.metaDb.tables={},this.evt=new emit_1.default}async _validateInput(){try{const e=JSON.parse(await(0,util_1.promisify)(fs_1.default.readFile)(path_1.default.join(process.cwd(),"package.json"),"utf8"));return"nocodb"===e.name||"nocodb"in e.dependencies}catch(e){}return!0}async validateInput(){try{"___ext"in KnexClient||(KnexClient.___ext=await this._validateInput()),KnexClient.___ext||utils_1.T.emit("evt",{evt_type:"base:external",payload:null,check:!0})}catch(e){}}emitTele(e){this.evt.evt.emit("tele",Object.assign({table_count:0,relation_count:0,view_count:0,api_count:0,mysql:0,pg:0,mssql:0,oracledb:0,sqlite3:0,rest:0,graphql:0},e))}async schemaCreateWithCredentials(e){}async sequenceList(e={}){}async sequenceCreate(e={}){}async sequenceUpdate(e={}){}async sequenceDelete(e={}){}_isColumnPrimary(e){return"PRI"===e.ck||"PRIMARY KEY"===e.ck||"P"===e.ck}_isColumnForeignKey(e,t){return-1!==(0,findIndex_1.default)(e.foreignKeys,{cn:t})}_isColumnPrimaryForInserting(e,t){return("PRI"===t.ck||"PRIMARY KEY"===t.ck||"P"===t.ck)&&!(e.primaryKeys.length>1&&(0,findIndex_1.default)(e.primaryKeys,{cn:t.cn})>0)}_getMaxPksPossible(e){const t={int:4294967295,tinyint:255,smallint:65535,mediumint:16777215,bigint:61};return e.un?t[e.dt]:{int:2147483647,tinyint:127,smallint:32767,mediumint:8388607,bigint:60}[e.dt]}_getMaxNumPossible(e){const t={int:4294967295,tinyint:255,smallint:65535,mediumint:16777215,bigint:61};return e.un?t[e.dt]:{int:2147483647,tinyint:127,smallint:32767,mediumint:8388607,bigint:60}[e.dt]}_getMaxRowsPossible(e,t){let a=1e4;const i=e.primaryKeys[0];if(e.primaryKeys.length){const t=this.getKnexDataTypeMock(i.ct),s=(0,find_1.default)(e.columns,{cn:i.cn});"integer"===t?a=Math.pow(2,s.np):"string"===t&&s.clen&&s.clen<3&&(a=500)}let s=1e4,r=0,l=(0,findIndex_1.default)(e.columns,{ck:"UNI"},r);for(;-1!==l;){const t=e.columns[l],a=this.getKnexDataTypeMock(t.ct);"integer"===a?s=Math.pow(2,t.np):"string"===a&&t.clen&&t.clen<2&&(s=25),r=l,l=(0,findIndex_1.default)(e.columns,{ck:"UNI"},r+1)}let c=1e4;for(r=0,l=(0,findIndex_1.default)(e.columns,{ck:"MUL"},r);-1!==l;){const t=e.columns[l],a=this.getKnexDataTypeMock(t.ct);"integer"===a&&(c=Math.pow(2,t.np)),r=l,l=(0,findIndex_1.default)(e.columns,{ck:"MUL"},r+1)}return Math.min(a,s,c,t)}getColumnType(e){}getKnexDataTypeMock(e){try{const t=e;let a={};return a=dataHelp.getType(t,strTypes)?"string":dataHelp.getType(t,intTypes)?"integer":dataHelp.getType(t,floatTypes)?"float":dataHelp.getType(t,dateTypes)?"date":dataHelp.getType(t,_enumTypes)?"enum":dataHelp.getType(t,yearTypes)?"year":dataHelp.getType(t,blobTypes)?"blob":dataHelp.getType(t,boolTypes)?"boolean":dataHelp.getType(t,geometryTypes)?"geometry":dataHelp.getType(t,pointTypes)?"point":dataHelp.getType(t,linestringTypes)?"linestring":dataHelp.getType(t,polygonTypes)?"polygon":dataHelp.getType(t,multipointTypes)?"multipoint":dataHelp.getType(t,multilinestringTypes)?"multilinestring":dataHelp.getType(t,multipolygonTypes)?"multipolygon":dataHelp.getType(t,bitTypes)?"bit":dataHelp.getType(t,textTypes)?"text":dataHelp.getType(t,jsonTypes)?"json":"other",a}catch(e){return console.log(e),"string"}}getMinMax(e){}async mockDb(e){}async dbCacheInitAsyncKnex(e=null){try{const e=this;let t=null,a=[];if("mysql"===this.connectionConfig.client){t=dataHelp.getMysqlSchemaQuery();const e=await this.knex.raw(t,[this.connectionConfig.connection.database]);e.length?(a=e[0],await this.knex.raw("FLUSH TABLES",[])):console.log({},e[0])}if(a.length){for(let e=0;e<a.length;++e){const t=Object.keys(a[e]);for(let i=0;i<t.length;++i){const s=a[e][t[i]];a[e][t[i].toLowerCase()]=s}}e.iterateToCacheTables(a),e.iterateToCacheTablePks(a),e.iterateToCacheTableColumns(a),e.iterateToCacheTableFks(a),e.constructUiMeta(),console.log("erm atrix = = = = ="),e.iterateToCacheErMatrix(a),console.log("erm atrix = = = = =");for(let e=0;e<a.length;++e)"PRI"===a[e].ck&&console.log("PK >> ",a[e].tn,a[e].cn,a[e].ext)}}catch(e){console.log(e)}}getUiColumnObject(e){const t={};return t.cn=e.cn,t.dt=e.dt,t.data_type_knex=this.getKnexDataTypeMock(e.dt),t.ct=e.ct,t.nrqd="NO"!==e.nrqd,t.ck="MUL"===e.ck,t.pk="PRI"===e.ck,t.un=-1!==e.ct.indexOf("unsigned"),t.ai=-1!==e.ext.indexOf("auto_increment"),"mysql"===this.connectionConfig.client&&(t.cdf=e.cdf,t.clen=e.clen,t.np=e.np,t.ns=e.ns,t.dp=e.dp),t}constructUiMeta(){for(const e in this.metaDb.tables){const t=this.metaDb.tables[e];for(let e=0;e<t.columns.length;++e){const a=t.columns[e];t.uiModel.columns[e]=this.getUiColumnObject(a)}}}iterateToCacheTables(e){for(let t=0;t<e.length;++t){const a=e[t];{const e=a.tn;if(!(e in this.metaDb.tables)){this.metaDb.tables[e]={},this.metaDb.tables[e].primaryKeys=[],this.metaDb.tables[e].foreignKeys=[],this.metaDb.tables[e].columns=[],this.metaDb.tables[e].indicies=[],this.metaDb.tables[e].is_view=a.is_view;const t={columns:[],primaryKeys:[],foreignKeys:[],indicies:[]};this.metaDb.tables[e].uiModel=t}}}}iterateToCacheTableColumns(e){for(let t=0;t<e.length;++t){const a=e[t],i=a.tn,s={};a.cn.split(" ").length>1||(s.cn=a.cn,s.op=a.op,s.ck=a.ck,s.dt=a.dt,s.ct=a.ct,s.rtn=a.rtn,s.rcn=a.rcn,s.nrqd=a.nrqd,"mysql"===this.connectionConfig.client&&(s.ext=a.ext,s.cc=a.cc,s.cdf=a.cdf,s.clen=a.clen,s.np=a.np,s.ns=a.ns,s.dp=a.dp),dataHelp.findOrInsertObjectArrayByKey(s,"cn",this.metaDb.tables[i].columns))}}iterateToCacheTableFks(e){for(let t=0;t<e.length;++t){const a=e[t],i=a.tn;if(a.rtn){const e={};e.cn=a.cn,e.tn=a.tn,e.rtn=a.rtn,e.rcn=a.rcn,e.dt=a.dt,e.ct=a.ct,dataHelp.findOrInsertObjectArrayByKey(e,"cn",this.metaDb.tables[i].foreignKeys)}}}iterateToCacheErMatrix(e){this.metaDb.erMatrix=[];const t=Object.keys(this.metaDb.tables),a={},i={};console.log("< < < ",t);for(let e=0;e<t.length;++e)a[t[e]]=e,i[e]=t[e];this.metaDb.erTablesAsArr=t,this.metaDb.erTableIndexObj=a,this.metaDb.erIndexTableObj=i;for(let e=0;e<t.length;++e){this.metaDb.erMatrix[e]=[];for(let a=0;a<t.length;++a)this.metaDb.erMatrix[e].push(0)}console.log(this.metaDb.erTableIndexObj,this.metaDb.erIndexTableObj);for(let t=0;t<e.length;++t)if(null!==e[t].rtn){const i=a[e[t].rtn],s=a[e[t].tn];this.metaDb.erMatrix[i][s]=1}}iterateToCacheTablePks(e){for(let t=0;t<e.length;++t){const a=e[t],i=a.tn;if(this._isColumnPrimary(a)){const e={};e.cn=a.cn,e.op=a.op,e.ck=a.ck,e.dt=a.dt,e.ct=a.ct,dataHelp.findOrInsertObjectArrayByKey(e,"cn",this.metaDb.tables[i].primaryKeys)}}}emit(e){log.api(e),evt.evt.emit("UI",{status:0,data:`SQL : ${e}`})}emitW(e){log.warn(e),evt.evt.emit("UI",{status:1,data:`SQL : ${e}`})}emitE(e){log.error(e),evt.evt.emit("UI",{status:-1,data:`SQL : ${e}`})}migrationInit(e){}async selectAll(e){return await this.sqlClient.raw(this.sqlClient(e).select().toQuery())}async list(e){const{size:t=10,page:a=1,orderBy:i}=e,s=new Result_1.default;try{const r=await this.sqlClient.raw(this.sqlClient(e.tn).count().toQuery());s.data.count=Object.values(r[0])[0];const l=this.sqlClient(e.tn).select().limit(t).offset((a-1)*t);i&&i.length?s.data.list=await this.sqlClient.raw(l.orderBy(i).toQuery()):s.data.list=await this.sqlClient.raw(l.toQuery())}catch(e){console.log(e),s.data.list=[]}return s}executeSqlFiles(){}async createDatabaseIfNotExists(e){}async createTableIfNotExists(e){}async raw(e,...t){const a=(new Date).getTime();let i=null,s=null,r=null;try{return i=await this.sqlClient.raw(e,...t),s=(new Date).getTime(),r=s-a,log.api(`Query: (${e}) [Took: ${r} ms]`),this.emit(`${e} [Took: ${r} ms]`),i}catch(e){throw s=(new Date).getTime(),r=s-a,this.emitE(`${e} [Took: ${r} ms]`),console.log(e),e}}async insert(e){const{tn:t,data:a}=e,i=await this.sqlClient.raw(this.sqlClient(t).insert(a).toQuery());return log.debug(i),i}async update(e){const{tn:t,data:a,whereConditions:i}=e;return await this.sqlClient.raw(this.sqlClient(t).where(i).update(a).toQuery())}async delete(e){const{tn:t,whereConditions:a}=e,i=await this.sqlClient.raw(this.sqlClient(t).where(a).del().toQuery());return log.debug(i),i}async remove(e,t){await this.sqlClient.raw(this.sqlClient(e).del().where(t).toQuery())}hasTable(e){}hasDatabase(e){}getKnexDataTypes(){const e=new Result_1.default;return e.data.list=["int","tinyint","smallint","mediumint","bigint","float","decimal","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","char","varchar","nchar","text","tinytext","mediumtext","longtext","binary","varbinary","blob","tinyblob","mediumblob","longblob","enum","set","time","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","json"],e}getKnexDataTypesAdvanced(e={}){const t=new Result_1.default;return t.data.list=[{type:"int",dtxp:"10",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"tinyint",dtxp:"1",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"smallint",dtxp:"5",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"mediumint",dtxp:"8",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"bigint",dtxp:"20",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"bit",dtxp:"",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"boolean",dtxp:"",dtxs:"",aggrDataType:"boolean",cdf:""},{type:"float",dtxp:"10",dtxs:"2",aggrDataType:"float",cdf:""},{type:"decimal",dtxp:"10",dtxs:"2",aggrDataType:"float",cdf:""},{type:"double",dtxp:"10",dtxs:"2",aggrDataType:"float",cdf:""},{type:"serial",dtxp:"",dtxs:"",aggrDataType:"numeric",cdf:""},{type:"date",dtxp:"",dtxs:"",aggrDataType:"datetime",cdf:""},{type:"datetime",dtxp:"",dtxs:"",aggrDataType:"datetime",cdf:""},{type:"timestamp",dtxp:"",dtxs:"",aggrDataType:"datetime",cdf:""},{type:"time",dtxp:"",dtxs:"",aggrDataType:"time",cdf:""},{type:"year",dtxp:"",dtxs:"",aggrDataType:"year",cdf:""},{type:"char",dtxp:"10",dtxs:"",aggrDataType:"char",cdf:""},{type:"varchar",dtxp:"10",dtxs:"",aggrDataType:"char",cdf:""},{type:"nchar",dtxp:"10",dtxs:"",aggrDataType:"char",cdf:""},{type:"text",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"tinytext",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"mediumtext",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"longtext",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"binary",dtxp:"255",dtxs:"",aggrDataType:"binary",cdf:""},{type:"varbinary",dtxp:"255",dtxs:"",aggrDataType:"binary",cdf:""},{type:"blob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"tinyblob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"mediumblob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"longblob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"enum",dtxp:"'a','b'",dtxs:"",aggrDataType:"enum",cdf:""},{type:"set",dtxp:"'a','b'",dtxs:"",aggrDataType:"set",cdf:""},{type:"geometry",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"point",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"linestring",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"polygon",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"multipoint",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"multilinestring",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"multipolygon",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"json",dtxp:"",dtxs:"",aggrDataType:"json",cdf:""}],e&&"aggrDataType"in e&&(t.data.list=t.data.list.filter((t=>t.aggrDataType===e.aggrDataType))),t}async tableCreate(e){const t=this.tableCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.sqlClient.schema.createTable(e.table,(function(t){const a=[],i=JSON.parse(JSON.stringify(e.columns));for(let e=0;e<i.length;++e)i[e].pk&&(a.push(e),i[e].pk=!1,i[e].ai=!1);if(a.length>1){for(let a=0;a<i.length;++a)columnCreate(e.sqlClient,t,i[a]);createPks(t,e.columns,a)}else for(let a=0;a<e.columns.length;++a)columnCreate(e.sqlClient,t,e.columns[a])}));await this.sqlClient.raw(t.toQuery());const i=this.sqlClient.schema.createTable(e.table,(function(t){const a=[],i=JSON.parse(JSON.stringify(e.columns));for(let e=0;e<i.length;++e)i[e].pk&&(a.push(e),i[e].pk=!1,i[e].ai=!1);if(a.length>1){for(let a=0;a<i.length;++a)columnCreate(e.sqlClient,t,i[a]);createPks(t,e.columns,a)}else for(let a=0;a<e.columns.length;++a)columnCreate(e.sqlClient,t,e.columns[a])})).toSQL();this.emit(`Success : ${i}`);const s=this.sqlClient.schema.dropTable(e.table).toSQL();a.data.object={upStatement:i,downStatement:s}}catch(e){throw log.ppe(e,t),e}return a}async tableRename(e){const t=this.tableCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{e.table=e.tn,await this.sqlClient.raw(this.sqlClient.schema.renameTable(e.tn_old,e.tn).toQuery());const t=this.querySeparator()+this.sqlClient.schema.renameTable(e.tn_old,e.tn).toQuery();this.emit(`Success : ${t}`);const i=this.querySeparator()+this.sqlClient.schema.renameTable(e.tn,e.tn_old).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw log.ppe(e,t),e}return a}async tableUpdate(e){const t=this.tableUpdate.name,a=new Result_1.default;log.api(`${t}:args:`,e);let i=!1,s={};try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;const r=[],l=[];let c=0;for(let t=0;t<e.columns.length;++t)e.columns[t].pk&&l.push(t);for(let t=0;t<e.originalColumns.length;++t)e.originalColumns[t].pk&&r.push(t);if(l.length>r.length)c=l.length-r.length;else if(l.length<r.length)c=l.length-r.length;else for(let e=0;e<l.length;++e)l[e]!==r[e]&&(c=1);console.log("pksChanged:",c);const d=this.sqlClient.schema.alterTable(e.table,(function(r){if(c)pkUpdate(r,e.columns,e.originalColumns);else for(let l=0;l<e.columns.length;++l){const c=(0,find_1.default)(t,{cn:e.columns[l].cno});8&e.columns[l].altered?(i=!0,s=renameColumn(e.sqlClient,e.connectionConfig,r,c,e.columns[l]),a.data.object=s):4&e.columns[l].altered?removeColumn(r,e.columns[l],c):2&e.columns[l].altered?columnUpdate(e.sqlClient,r,e.columns[l],c):1&e.columns[l].altered&&columnUpdate(e.sqlClient,r,e.columns[l],null)}}));if(await this.sqlClient.raw(d.toQuery()),i)await this.sqlClient.raw(s.upStatement),a.data.object=s;else{const i=this.sqlClient.schema.alterTable(e.table,(function(a){if(c)pkUpdate(a,e.columns,e.originalColumns);else for(let i=0;i<e.columns.length;++i){const s=(0,find_1.default)(t,{cn:e.columns[i].cno});8&e.columns[i].altered||(4&e.columns[i].altered?removeColumn(a,e.columns[i],s):2&e.columns[i].altered?columnUpdate(e.sqlClient,a,e.columns[i],s):1&e.columns[i].altered&&columnUpdate(e.sqlClient,a,e.columns[i],null))}})).toSQL(),s=this.sqlClient.schema.alterTable(e.table,(function(a){if(c)pkUpdate(a,e.columns,e.originalColumns);else for(let i=0;i<e.columns.length;++i){const s=(0,find_1.default)(t,{cn:e.columns[i].cno});8&e.columns[i].altered||(4&e.columns[i].altered?columnUpdate(e.sqlClient,a,s,null):1&e.columns[i].altered?removeColumn(a,e.columns[i],null):2&e.columns[i].altered&&columnUpdate(e.sqlClient,a,s,e.columns[i]))}})).toSQL();a.data.object={upStatement:i,downStatement:s}}}catch(e){throw log.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const{columns:t}=e;e.sqlClient=this.sqlClient;const i=this.sqlClient.schema.dropTable(e.tn).toSQL(),s=this.sqlClient.schema.createTable(e.tn,(function(a){for(let i=0;i<t.length;++i)columnCreate(e.sqlClient,a,t[i])})).toSQL();this.emit(`Success : ${i}`),await this.sqlClient.raw(this.sqlClient.schema.dropTable(e.tn).toQuery()),a.data.object={upStatement:i,downStatement:s}}catch(e){throw log.ppe(e,t),e}return a}async indexCreate(e){const t=this.indexCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.indexName||null;try{e.table=e.tn;const t=this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.index(e.columns,i):t.unique(e.columns,i)}));await this.sqlClient.raw(t.toQuery());const s=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery();this.emit(`Success : ${s}`);const r=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:r}]}}catch(e){throw log.ppe(e,t),e}return a}async indexDelete(e){const t=this.indexDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.indexName||null;try{e.table=e.tn;const t=this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)}));await this.sqlClient.raw(t.toQuery());const s=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery();this.emit(`Success : ${s}`);const r=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:r}]}}catch(e){throw log.ppe(e,t),e}return a}async relationCreate(e){const t=this.relationCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this.sqlClient.schema.table(e.childTable,(function(t){t=t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTable),e.onUpdate&&(t=t.onUpdate(e.onUpdate)),e.onDelete&&t.onDelete(e.onDelete)}));await this.sqlClient.raw(t.toQuery());const s=this.querySeparator()+t.toQuery();this.emit(`Success : ${s}`);const r=this.querySeparator()+this.sqlClient.schema.table(e.childTable,(function(t){t.dropForeign(e.childColumn,i)})).toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:r}]}}catch(e){throw log.ppe(e,t),e}return a}async relationDelete(e){const t=this.relationDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this.sqlClient.schema.table(e.childTable,(function(t){t.dropForeign(e.childColumn,i)}));await this.sqlClient.raw(t.toQuery());const s=this.querySeparator()+this.sqlClient.schema.table(e.childTable,(function(t){t.dropForeign(e.childColumn,i)})).toQuery(),r=this.sqlClient.schema.table(e.childTable,(function(t){t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTable)}));await this.sqlClient.raw(r.toQuery());const l=this.querySeparator()+r.toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:l}]}}catch(e){throw log.ppe(e,t),e}return a}getKnexDataType(e){try{switch(e){case"int":return"integer";case"bigint":return"bigInteger";case"varchar":return"string";case"text":case"float":case"decimal":case"boolean":case"date":case"datetime":case"time":case"timestamp":case"binary":case"json":return e;case"enum":return"enu";default:return"specificType"}}catch(e){return log.debug(e),"string"}}getType(e,t){for(let a=0;a<t.length;++a)if(-1!==e.indexOf(t[a]))return 1;return 0}async fakerColumnsList(e){const t=this.fakerColumnsList.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,`${e.tn}.json`),i=await(0,util_1.promisify)(jsonfile_1.default.readFile)(t);a.data.list=i}catch(e){log.ppe(e,t),a.data.list=[]}return a}async fakerColumnsCreate(e){const t=this.fakerColumnsCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,`${e.tn}.json`);await(0,util_1.promisify)(jsonfile_1.default.writeFile)(t,e.fakerColumns,{spaces:2}),this.emit(`Created : ${t}`)}catch(e){throw log.ppe(e,t),e}return a}async fakerColumnsUpdate(e){const t=this.fakerColumnsUpdate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success :")}catch(e){throw log.ppe(e,t),e}return a}async fakerColumnsDelete(e){const t=this.fakerColumnsDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success :")}catch(e){throw log.ppe(e,t),e}return a}async _getmetaDb(){}async seedInit(e){const t=this.seedInit.name,a=new Result_1.default;log.api(`${t}:args:`,e),console.log("in knex SeedInit");try{await(0,mkdirp_1.default)(e.seedsFolder)}catch(e){throw log.ppe(e,t),e}return a}async seedTerm(e){const t=this.seedInit.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success : seedTerm")}catch(e){throw log.ppe(e,t),e}return a}async seedStart(e){const t=this.seedStart.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Seeding : Started"),await this.mockDb(e),this.emit("Seeding : Finished")}catch(e){throw log.ppe(e,t),e}return a}async seedStop(e){const t=this.seedStop.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success : seedStop")}catch(e){throw log.ppe(e,t),e}return a}async seedSettingsRead(e){const t=this.seedSettingsRead.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,"__xseeds.json"),i=await(0,util_1.promisify)(jsonfile_1.default.readFile)(t);a.data=i}catch(e){log.ppe(e,t)}return a}async seedSettingsCreate(e){const t=this.seedSettingsCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,"__xseeds.json");await(0,util_1.promisify)(jsonfile_1.default.writeFile)(t,e.settings,{spaces:2}),this.emit("Success : Seed settings updated")}catch(e){throw log.ppe(e,t),e}return a}querySeparator(){return"/* xc */\n"}getTnPath(e){return e}async tableCreateStatement(e){}async tableInsertStatement(e){}async tableUpdateStatement(e){}async tableDeleteStatement(e){}async tableTruncateStatement(e){}async tableSelectStatement(e){}async sequelizeModelCreate(e){}genQuery(e,t=[],a=0){a&&(t=((Array.isArray(t)?t:[t])||[]).map((e=>"string"==typeof e?this.sanitize(e):e)));const i=this.sqlClient.raw(e,t).toQuery();return a?this.sanitize(i):this.unsanitize(i)}sanitize(e){return e.replace(/([^\\]|^)(\?+)/g,((e,t,a)=>`${t}${a.split("?").join("\\?")}`))}unsanitize(e){return e.replace(/\\[?]/g,"?")}genValue(e){return this.genQuery("?",[e],!0)}genIdentifier(e){return this.genQuery("??",[e],!0)}genRaw(e){const t=this.genQuery("?",[e],!0);return"number"==typeof e||"boolean"==typeof e?t:t.substring(1,t.length-1)}sanitiseDataType(e){if(/^[\w -]+(?:\(\d+(?:\s?,\s?\d+)?\))?$/.test(e))return e;throw new Error(`Invalid data type: ${e}`)}sanitiseDefaultValue(e){if(null!=e){if("string"==typeof e){if(["NULL","null","TRUE","true","FALSE","false"].includes(e))return e;if(/^\d+(\.\d+)?$/.test(e))return e;if(/^\w+\(\)$/.test(e))return e;if(/^\s*current_timestamp(?:\(\))?(?:\s+on\s+update\s+current_timestamp(?:\(\))?)?\s*$/i.test(e))return e;const t=e.match(/^(['"])(.*)\1$/);return t?this.genQuery("?",[t[2].replace('"'===t[1]?/\\"/g:/\\'/g,t[1])]):this.genQuery("?",[e])}return this.genQuery("?",[e])}}}exports.default=KnexClient},28309:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class SqlClient{constructor(e){this.connectionConfig=e,this.sqlClient=null}async testConnection(e){}migrationInit(e){}migrationUp(e){}migrationDown(e){}selectAll(e){}executeSqlFiles(){}async createDatabaseIfNotExists(e){}async createTableIfNotExists(e){}startTransaction(){}commit(){}rollback(){}hasTable(e){}hasDatabase(e){}async tableCreate(e){}async tableUpdate(e){}async columnCreate(e){}async columnUpdate(e){}async columnDelete(e){}async indexCreate(e){}async indexUpdate(e){}async indexDelete(e){}async relationCreate(e){}async relationUpdate(e){}async relationDelete(e){}async databaseList(e){}async tableList(e){}async schemaList(e){}async tableDelete(e){}async columnList(e){}async indexList(e){}async relationList(e){}async schemaCreate(e){}async schemaDelete(e){}async triggerList(e){}async triggerCreate(e){}async triggerRead(e){}async functionList(e){}async functionRead(e){}async procedureList(e){}async procedureRead(e){}async viewList(e){}async viewRead(e){}async sequenceList(e={}){}async sequenceCreate(e={}){}async sequenceUpdate(e={}){}async sequenceDelete(e={}){}async tableCreateStatement(e){}async tableInsertStatement(e){}async tableUpdateStatement(e){}async tableDeleteStatement(e){}async tableTruncateStatement(e){}async tableSelectStatement(e){}async totalRecords(e){}async getDefaultByteaOutputFormat(e={}){}}},71068:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SqlClientFactory=void 0;const s=i(a(2058)),r=a(50970),l=i(a(65271)),c=i(a(16724)),d=i(a(18928)),u=i(a(87019)),p=i(a(10416)),m=i(a(6264)),_=i(a(33232)),f=i(a(88696));class SqlClientFactory{static create(e){if(e.meta=e.meta||{},e.pool=e.pool||{min:0,max:5},e.meta.dbtype=e.meta.dbtype||"","mysql"===e.client||"mysql2"===e.client)return"tidb"===e.meta.dbtype?new _.default(e):"vitess"===e.meta.dbtype?new f.default(e):new l.default(e);if("sqlite3"===e.client)return new u.default(e);if("mssql"===e.client)return new c.default(e);if("oracledb"===e.client)return new d.default(e);if("pg"===e.client)return"yugabyte"===e.meta.dbtype?new m.default(e):new p.default(e);throw new Error("Database not supported")}}t.SqlClientFactory=SqlClientFactory;t.default=class default_1{static async create(e){return e.connection.ssl&&"object"==typeof e.connection.ssl&&(e.connection.ssl.caFilePath&&(e.connection.ssl.ca=(await(0,r.promisify)(s.default.readFile)(e.connection.ssl.caFilePath)).toString(),delete e.connection.ssl.caFilePath),e.connection.ssl.keyFilePath&&(e.connection.ssl.key=(await(0,r.promisify)(s.default.readFile)(e.connection.ssl.keyFilePath)).toString(),delete e.connection.ssl.keyFilePath),e.connection.ssl.certFilePath&&(e.connection.ssl.cert=(await(0,r.promisify)(s.default.readFile)(e.connection.ssl.certFilePath)).toString(),delete e.connection.ssl.certFilePath)),SqlClientFactory.create(e)}}},62308:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getType=t.getColumnType=t.getDataType=t.getChartQuery=t.getMysqlSchemaQuery=t.getStepArray=t.getStepArraySimple=t.numberGetFixed=t.numberGetLength=t.numberRound=t.round=t.findObjectInArrayByKey=t.findOrInsertObjectArrayByKey=void 0;t.findOrInsertObjectArrayByKey=(e,t,a)=>{let i=0,s=0;for(s=0;s<a.length;++s)if(t in a[s]&&e[t]===a[s][t]){i=1;break}return i||a.push(e),a[s]};t.findObjectInArrayByKey=(e,t,a)=>{for(let i=0;i<a.length;++i)if(a[i][e]===t)return a[i];return null};t.round=function(e,t){const a=Math.pow(10,t),i=e*a;return Math.round(i)/a};t.numberRound=(e,t)=>{const a=Math.pow(10,t),i=e*a;return Math.round(i)/a};t.numberGetLength=e=>{let t=e;return e<0&&(t*=-1),t.toString().length};t.numberGetFixed=e=>parseInt(e.toFixed());t.getStepArraySimple=function(e,t,a){const i=[];for(let s=e;s<=t;s+=a)i.push(s);return i};t.getStepArray=(e,a,i)=>{e=(0,t.numberGetFixed)(e),a=(0,t.numberGetFixed)(a);let s=e-(i=(0,t.numberGetFixed)(i))/2,r=a+i/2;s=(0,t.numberGetFixed)(s),r=(0,t.numberGetFixed)(r);const l=(0,t.numberGetLength)(s),c=(0,t.numberGetLength)(r),d=(0,t.numberGetLength)(i);l>1&&(s=(0,t.numberRound)(s,-1)),c>2&&(r=(0,t.numberRound)(r,-1)),1!==d&&(i=(0,t.numberRound)(i,-1));const u=[];for(let e=s;e<r;e+=i)u.push(e);return u.push(r),u};t.getMysqlSchemaQuery=function(){return"select c.table_name as tn, c.column_name as cn, c.ordinal_position as cop,c.column_key as ck,c.is_nullable as nrqd, c.data_type, c.column_type as ct,c.extra as ext,c.privileges as priv, c.cc,c.cdf as cdf,c.data_type,c.character_maximum_length as clen,c.numeric_precision as np,c.numeric_scale as ns,c.datetime_precision as dp, k.constraint_name as cstn, k.referenced_table_name as rtn, k.referenced_column_name as rcn, s.index_name,s.seq_in_index, v.table_name as is_view from information_schema.columns as c left join information_schema.key_column_usage as k on c.column_name=k.column_name and c.table_schema = k.referenced_table_schema and c.table_name = k.table_name left join information_schema.statistics as s on c.column_name = s.column_name and c.table_schema = s.index_schema and c.table_name = s.table_name LEFT JOIN information_schema.VIEWS as v ON c.table_schema = v.table_schema and c.table_name = v.table_name where c.table_schema=? order by c.table_name, c.ordinal_position"};t.getChartQuery=function(){return"select ? as ??, count(*) as _count from ?? where ?? between ? and ? "};t.getDataType=function(e,t){for(let a=0;a<t.length;++a)if(-1!==e.indexOf(t[a]))return 1;return 0};t.getColumnType=function(e){return(0,t.getDataType)(e.data_type,["varchar","text","char","tinytext","mediumtext","longtext","ntext","image","blob","mediumblob","longblob","binary","varbinary","character","character varying","nchar","nvarchar","clob","nvarchar2","varchar2","raw","long raw","bfile","nclob"])?"string":(0,t.getDataType)(e.data_type,["bit","integer","int","smallint","mediumint","bigint","tinyint","int2","int4","int8","long","serial","bigserial","smallserial","bool","boolean","number"])?"int":(0,t.getDataType)(e.data_type,["float","double","decimal","numeric","real","double precision","real","money","smallmoney","dec"])?"float":(0,t.getDataType)(e.data_type,["date","datetime","timestamp","time","year","timestamp without time zone","timestamp with time zone","time without time zone","time with time zone","datetime2","smalldatetime","datetimeoffset","interval year","interval day"])?"date":"string"};t.getType=function(e,t){return t.includes(e)}},16724:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(50536)),r=i(a(72208)),l=i(a(69643)),c=i(a(98152)),d=i(a(58108)),u=new c.default("MssqlClient");class MssqlClient extends l.default{constructor(e){super(e)}async sequenceDelete(e){const t=this.sequenceDelete.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=this.querySeparator()+`DROP SEQUENCE ${e.sequence_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`CREATE SEQUENCE ${e.sequence_name}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async sequenceList(e){const t=this.sequenceList.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SELECT * FROM sys.SEQUENCES;");a.data.list=t.map((e=>Object.assign(Object.assign({},e),{sequence_name:e.name,original_sequence_name:e.name})))}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async sequenceCreate(e){const t=this.sequenceCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE SEQUENCE ${e.sequence_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP SEQUENCE ${e.sequence_name}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async sequenceUpdate(e){const t=this.sequenceUpdate.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=this.querySeparator()+`ALTER SEQUENCE ${e.original_sequence_name} RENAME TO ${e.sequence_name};`,i=this.querySeparator()+`ALTER SEQUENCE ${e.sequence_name} RENAME TO ${e.original_sequence_name};`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async testConnection(e={}){const t=this.testConnection.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw("SELECT 1+1 AS data")}catch(e){u.ppe(e),a.code=-1,a.message=e.message}finally{u.api(`${t}:result:`,a)}return a}getKnexDataTypes(){const e=new d.default;return e.data.list=["bigint","binary","bit","char","date","datetime","datetime2","datetimeoffset","decimal","float","geography","geometry","heirarchyid","image","int","money","nchar","ntext","numeric","nvarchar","real","json","smalldatetime","smallint","smallmoney","sql_variant","sysname","text","time","timestamp","tinyint","uniqueidentifier","varbinary","xml","varchar"],e}async version(e={}){const t=this.version.name,a=new d.default;u.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SERVERPROPERTY('productversion') AS version, SERVERPROPERTY ('productlevel') AS level, SERVERPROPERTY ('edition') AS edition, @@version AS versionD");a.data.object={};const t=e[0],i=t.version.split(".");a.data.object.version=t.version,a.data.object.primary=i[0],a.data.object.major=i[1],a.data.object.minor=i[2]}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async createDatabaseIfNotExists(e){const t=this.createDatabaseIfNotExists.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));delete t.connection.database;const a=(0,s.default)(t);0===(await a.raw(`SELECT name from sys.databases WHERE name = '${e.database}'`)).length&&await a.raw(`CREATE DATABASE  ${e.database}`),this.sqlClient=(0,s.default)(this.connectionConfig),await a.destroy(),this.connectionConfig.searchPath&&this.connectionConfig.searchPath[0]&&await this.sqlClient.raw(" IF NOT EXISTS ( SELECT  *\n                            FROM    sys.schemas\n                            WHERE   name = ? )\n                EXEC('CREATE SCHEMA ??')",[this.connectionConfig.searchPath[0],this.connectionConfig.searchPath[0]])}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async dropDatabase(e){const t=this.dropDatabase.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));delete t.connection.database;const a=(0,s.default)(t);await this.sqlClient.destroy(),this.sqlClient=a,u.debug("dropping database:",e),await a.raw(`ALTER DATABASE ${e.database} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\n         DROP DATABASE ${e.database};`)}catch(e){u.ppe(e,t)}return u.api(`${t}: result`,a),a}async createTableIfNotExists(e){const t=this.createTableIfNotExists.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.schema.withSchema(this.schema).hasTable(e.tn)?u.debug(`${this.getTnPath(e.tn)} tables exists`):(await this.sqlClient.schema.withSchema(this.schema).createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})),u.debug("Table created:",`${this.getTnPath(e.tn)}`))}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async hasTable(e){const t=this.hasTable.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data.value=await this.sqlClient.schema.withSchema(this.schema).hasTable(e.tn)}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async hasDatabase(e){const t=this.hasDatabase.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`SELECT name FROM sys.databases WHERE name = '${e.databaseName}'`);a.data.value=t.length>0}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data.list=await this.sqlClient.raw("SELECT name AS database_name, database_id, create_date FROM sys.databases ORDER BY name")}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async tableList(e={}){const t=this.tableList.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data.list=await this.sqlClient.raw("SELECT schema_name(t.schema_id) AS schema_name,\n        t.name AS tn, t.create_date, t.modify_date FROM sys.tables t WHERE schema_name(t.schema_id) = ? ORDER BY schema_name,tn ",[this.schema||"dbo"])}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data.list=await this.sqlClient.raw(`SELECT name AS schema_name FROM master.${this.schema}.sysdatabases WHERE name not in ('master', 'tempdb', 'model', 'msdb');`)}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async columnList(e){const t=this.columnList.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT\n      c.table_name AS tn,\n       CASE WHEN trg1.trigger_name IS NULL THEN CAST(0 AS BIT) ELSE CAST(1 AS BIT) END AS au,\n       c.column_name AS cn,\n       c.ordinal_position AS cop,\n      pk.constraint_type AS ck,\n      CASE WHEN COLUMNPROPERTY(object_id(CONCAT('${this.schema}.', c.TABLE_NAME)), c.COLUMN_NAME, 'IsIdentity') = 1\n      THEN\n        1\n      ELSE\n        0\n      END AS ai,\n      c.is_nullable AS nrqd,\n      c.data_type AS dt,\n      c.column_default AS cdf,c.character_maximum_length AS clen,\n      c.character_octet_length,c.numeric_precision AS np,c.numeric_scale AS ns,c.datetime_precision AS dp,c.character_set_name AS csn,\n      c.collation_name AS clnn,\n      pk.constraint_type AS cst, pk.ordinal_position AS op, pk.constraint_name AS pk_constraint_name,\n      fk.parent_table AS rtn, fk.parent_column AS rcn,\n      v.table_name AS is_view,\n      df.default_constraint_name\n  FROM INFORMATION_SCHEMA.COLUMNS c\n    left join\n      ( SELECT kc.constraint_name, kc.table_name,kc.column_name, kc.ordinal_position,tc.constraint_type\n        FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE kc\n          INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS tc\n            ON kc.constraint_name = tc.constraint_name AND tc.constraint_type in ('primary key')\n        WHERE kc.table_catalog='${e.databaseName}' AND kc.table_schema='${this.schema}'\n        ) pk\n      ON \n      pk.table_name = c.table_name AND pk.column_name=c.column_name\n    left join\n          ( SELECT\n                ccu.table_name AS child_table\n                ,ccu.column_name AS child_column\n                ,kcu.table_name AS parent_table\n                ,kcu.column_name AS parent_column\n                ,ccu.constraint_name\n            FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ccu\n                INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc\n                    ON ccu.constraint_name = rc.constraint_name\n                INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE kcu\n                    ON kcu.constraint_name = rc.unique_constraint_name  ) fk\n      ON\n      fk.child_table = c.table_name AND fk.child_column=c.column_name\n    left join INFORMATION_SCHEMA.VIEWS v\n      ON v.table_name=c.table_name\n    left join (\n              SELECT\n                  default_constraints.name default_constraint_name, all_columns.name name\n              FROM\n                  sys.all_columns\n                      INNER JOIN\n                  sys.tables\n                      ON all_columns.object_id = tables.object_id\n                      INNER JOIN\n                  sys.schemas\n                      ON tables.schema_id = schemas.schema_id\n                      INNER JOIN\n                  sys.default_constraints\n                      ON all_columns.default_object_id = default_constraints.object_id\n              WHERE\n        schemas.name = '${this.schema}'\n    AND tables.name =  '${e.tn}') df ON df.name = c.column_name\n\n     left join (  SELECT trg.name AS trigger_name,\n               tab.name AS [table1]\n          FROM sys.triggers trg\n              left join sys.objects tab\n                  ON trg.parent_id = tab.object_id\n          WHERE tab.name =  '${e.tn}') trg1 ON trg1.trigger_name = CONCAT('xc_trigger_${e.tn}_' , c.column_name)\n\n    WHERE c.table_catalog='${e.databaseName}' AND c.table_schema='${this.schema}' AND c.table_name = '${e.tn}'\n    ORDER BY c.table_name, c.ordinal_position`);for(let e=0;e<t.length;e++){const a=t[e];a.pk="PRIMARY KEY"===a.ck,a.not_nullable="NO"===a.nrqd,a.rqd="NO"===a.nrqd,a.ai=1===a.ai,a.nrqd="YES"===a.nrqd,a.cno=a.cn,a.dtxp=a.clen||a.np||a.dp,a.dtxs=a.ns,a.au=!!a.au}a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`SELECT  t.[name] AS table_view,\n        CASE WHEN t.[type] = 'U' THEN 'Table'\n            WHEN t.[type] = 'V' THEN 'View'\n            END AS [object_type],\n        i.index_id,\n        CASE WHEN i.is_primary_key = 1 THEN 'Primary key'\n            WHEN i.is_unique = 1 THEN 'Unique'\n            else 'Not Unique' END AS [type],\n        i.[name] AS index_name,\n        substring(column_names, 1, len(column_names)-1) AS [columns],\n        CASE WHEN i.[type] = 1 THEN 'Clustered index'\n            WHEN i.[type] = 2 THEN 'Nonclustered unique index'\n            WHEN i.[type] = 3 THEN 'XML index'\n            WHEN i.[type] = 4 THEN 'Spatial index'\n            WHEN i.[type] = 5 THEN 'Clustered columnstore index'\n            WHEN i.[type] = 6 THEN 'Nonclustered columnstore index'\n            WHEN i.[type] = 7 THEN 'Nonclustered hash index'\n            END AS index_type\n    FROM sys.objects t\n        INNER JOIN sys.indexes i\n            ON t.object_id = i.object_id\n        cross apply (SELECT col.[name] + ',' + CAST(ic.key_ordinal AS varchar)  + ','\n                        FROM sys.index_columns ic\n                            INNER JOIN sys.columns col\n                                ON ic.object_id = col.object_id\n                                AND ic.column_id = col.column_id\n                        WHERE ic.object_id = t.object_id\n                            AND ic.index_id = i.index_id\n                                ORDER BY col.column_id\n                                for xml path ('') ) D (column_names)\n    WHERE t.is_ms_shipped <> 1\n    AND index_id > 0 AND t.name = '${this.getTnPath(e.tn)}'\n    ORDER BY schema_name(t.schema_id) + '.' + t.[name], i.index_id`),i=[];for(let e=0,a=0;e<t.length;++e,++a)if(t[e].key_name=t[e].index_name,t[e].non_unique="Not Unique"===t[e].type?1:0,t[e].non_unique_original="Not Unique"===t[e].type?1:0,t[e].pk="Primary key"===t[e].type,t[e].columns=t[e].columns.split(","),2===t[e].columns.length)i[a]=t[e],i[a].cn=t[e].columns[0],i[a].seq_in_index=1;else{const s=t[e].columns.slice();for(let r=0;r<s.length;r+=2,++a)i[a]=JSON.parse(JSON.stringify(t[e])),i[a].cn=s[r].trim(),i[a].seq_in_index=parseInt(s[r+1]);a--}a.data.list=i}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async constraintList(e={}){const t=this.constraintList.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT  t.[name] AS table_view,\n        CASE WHEN t.[type] = 'U' THEN 'Table'\n            WHEN t.[type] = 'V' THEN 'View'\n            END AS [object_type],\n        i.index_id,\n        CASE WHEN i.is_primary_key = 1 THEN 'Primary key'\n            WHEN i.is_unique = 1 THEN 'Unique'\n            else 'Not Unique' END AS [type],\n        i.[name] AS index_name,\n        substring(column_names, 1, len(column_names)-1) AS [columns],\n        CASE WHEN i.[type] = 1 THEN 'Clustered index'\n            WHEN i.[type] = 2 THEN 'Nonclustered unique index'\n            WHEN i.[type] = 3 THEN 'XML index'\n            WHEN i.[type] = 4 THEN 'Spatial index'\n            WHEN i.[type] = 5 THEN 'Clustered columnstore index'\n            WHEN i.[type] = 6 THEN 'Nonclustered columnstore index'\n            WHEN i.[type] = 7 THEN 'Nonclustered hash index'\n            END AS index_type\n    FROM sys.objects t\n        INNER JOIN sys.indexes i\n            ON t.object_id = i.object_id\n        cross apply (SELECT col.[name] + ', ' + CAST(ic.key_ordinal AS varchar)  + ', '\n                        FROM sys.index_columns ic\n                            INNER JOIN sys.columns col\n                                ON ic.object_id = col.object_id\n                                AND ic.column_id = col.column_id\n                        WHERE ic.object_id = t.object_id\n                            AND ic.index_id = i.index_id\n                                ORDER BY col.column_id\n                                for xml path ('') ) D (column_names)\n    WHERE t.is_ms_shipped <> 1\n    AND index_id > 0 AND t.name = '${this.getTnPath(e.tn)}'\n    ORDER BY schema_name(t.schema_id) + '.' + t.[name], i.index_id`),i=[];for(let e=0,a=0;e<t.length;++e,++a)if(t[e].cstn=t[e].index_name,t[e].cst=t[e].type,t[e].columns=t[e].columns.split(","),2===t[e].columns.length)i[a]=t[e],i[a].cn=t[e].columns[0],i[a].op=1;else{const s=t[e].columns.slice();for(let r=0;r<s.length;r+=2,++a)i[a]=JSON.parse(JSON.stringify(t[e])),i[a].cn=s[r],i[a].op=parseInt(s[r+1]);a--}a.data.list=i}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`SELECT  fk_tab.name AS tn, '>-' AS rel, pk_tab.name AS rtn,\n        fk_cols.constraint_column_id AS no, fk_col.name AS cn, ' = ' AS [join],\n        pk_col.name AS rcn, fk.name AS cstn,\n        fk.update_referential_action_desc AS ur, fk.delete_referential_action_desc AS dr\n        FROM sys.foreign_keys fk\n        INNER JOIN sys.tables fk_tab\n            ON fk_tab.object_id = fk.parent_object_id\n        INNER JOIN sys.tables pk_tab\n            ON pk_tab.object_id = fk.referenced_object_id\n        INNER JOIN sys.foreign_key_columns fk_cols\n            ON fk_cols.constraint_object_id = fk.object_id\n        INNER JOIN sys.columns fk_col\n            ON fk_col.column_id = fk_cols.parent_column_id\n            AND fk_col.object_id = fk_tab.object_id\n        INNER JOIN sys.columns pk_col\n            ON pk_col.column_id = fk_cols.referenced_column_id\n            AND pk_col.object_id = pk_tab.object_id\n        WHERE fk_tab.name = '${this.getTnPath(e.tn)}'\n        ORDER BY  fk_tab.name, pk_tab.name, fk_cols.constraint_column_id`),i={NO_ACTION:"NO ACTION",CASCADE:"CASCADE",RESTRICT:"RESTRICT",SET_NULL:"SET NULL",SET_DEFAULT:"SET DEFAULT"};for(const e of t)e.ur=i[e.ur],e.dr=i[e.dr];a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new d.default;u.api(`${t}:args:`,e);try{const e=await this.raw("SELECT  fk_tab.name AS tn, '>-' AS rel, pk_tab.name AS rtn,\n        fk_cols.constraint_column_id AS no, fk_col.name AS cn, ' = ' AS [join],\n        pk_col.name AS rcn, fk.name AS cstn,\n        fk.update_referential_action_desc AS ur, fk.delete_referential_action_desc AS dr\n        FROM sys.foreign_keys fk\n        INNER JOIN sys.tables fk_tab\n            ON fk_tab.object_id = fk.parent_object_id\n        INNER JOIN sys.tables pk_tab\n            ON pk_tab.object_id = fk.referenced_object_id\n        INNER JOIN sys.foreign_key_columns fk_cols\n            ON fk_cols.constraint_object_id = fk.object_id\n        INNER JOIN sys.columns fk_col\n            ON fk_col.column_id = fk_cols.parent_column_id\n            AND fk_col.object_id = fk_tab.object_id\n        INNER JOIN sys.columns pk_col\n            ON pk_col.column_id = fk_cols.referenced_column_id\n            AND pk_col.object_id = pk_tab.object_id\n        ORDER BY  fk_tab.name, pk_tab.name, fk_cols.constraint_column_id"),t={NO_ACTION:"NO ACTION",CASCADE:"CASCADE",RESTRICT:"RESTRICT",SET_NULL:"SET NULL",SET_DEFAULT:"SET DEFAULT"};for(const a of e)a.ur=t[a.ur],a.dr=t[a.dr];a.data.list=e}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=`SELECT trg.name AS trigger_name,\n               tab.name AS [table],\n              CASE WHEN is_instead_of_trigger = 1 THEN 'Instead of'\n                  else 'After' END AS [activation],\n              (CASE WHEN objectproperty(trg.object_id, 'ExecIsUpdateTrigger') = 1\n                          THEN 'Update' else '' end\n              + CASE WHEN objectproperty(trg.object_id, 'ExecIsDeleteTrigger') = 1\n                          THEN 'Delete' else '' end\n              + CASE WHEN objectproperty(trg.object_id, 'ExecIsInsertTrigger') = 1\n                          THEN 'Insert' else '' end\n              ) AS [event],\n              CASE WHEN trg.parent_class = 1 THEN 'Table trigger'\n                  WHEN trg.parent_class = 0 THEN 'Database trigger'\n              END [class],\n              CASE WHEN trg.[type] = 'TA' THEN 'Assembly (CLR) trigger'\n                  WHEN trg.[type] = 'TR' THEN 'SQL trigger'\n                  else '' END AS [type],\n              CASE WHEN is_disabled = 1 THEN 'Disabled'\n                  else 'Active' END AS [status],\n              object_definition(trg.object_id) AS [definition]\n          FROM sys.triggers trg\n              left join sys.objects tab\n                  ON trg.parent_id = tab.object_id\n          WHERE tab.name =  '${this.getTnPath(e.tn)}'\n          ORDER BY trg.name;`,i=await this.sqlClient.raw(t);for(let e=0;e<i.length;e++){const t=i[e];t.statement=t.definition,t.trigger=t.trigger_name,t.event=t.event.toUpperCase(),t.timing=t.activation.toUpperCase()}a.data.list=i}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new d.default;u.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT o.name AS function_name,definition, o.create_date AS created, o.modify_date AS modified,o.*\n        FROM sys.sql_modules AS m\n        JOIN sys.objects AS o ON m.object_id = o.object_id\n        AND type IN ('FN', 'IF', 'TF')");for(let t=0;t<e.length;t++){const a=e[t];"FN"===a.type&&(a.type="FUNCTION")}a.data.list=e}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT SPECIFIC_NAME AS procedure_name, ROUTINE_TYPE AS [type],LAST_ALTERED AS modified, CREATED AS created,ROUTINE_DEFINITION AS definition ,pc.*\n        FROM ${e.databaseName}.INFORMATION_SCHEMA.ROUTINES AS pc WHERE routine_type = 'PROCEDURE'`);a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SELECT v.name AS view_name,v.*,m.* FROM sys.views v INNER JOIN sys.schemas s ON s.schema_id = v.schema_id AND schema_name(v.schema_id) = ?\n        INNER JOIN sys.sql_modules AS m ON m.object_id = v.object_id",[this.schema||"dbo"]);a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT o.name AS function_name,definition AS create_function, o.create_date AS created, o.modify_date AS modified,o.*\n        FROM sys.sql_modules AS m\n        JOIN sys.objects AS o ON m.object_id = o.object_id\n        AND type IN ('FN', 'IF', 'TF') AND o.name = '${e.function_name}'`);for(let e=0;e<t.length;e++){const a=t[e];"FN"===a.type&&(a.type="FUNCTION")}a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT SPECIFIC_NAME AS procedure_name, ROUTINE_TYPE AS [type],LAST_ALTERED AS modified, CREATED AS created,ROUTINE_DEFINITION AS create_procedure ,pc.*\n        FROM ${e.databaseName}.INFORMATION_SCHEMA.ROUTINES AS pc WHERE routine_type = 'PROCEDURE' AND SPECIFIC_NAME='${e.procedure_name}'`);a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT v.name AS view_name,v.*,m.*, m.definition AS view_definition FROM sys.views v INNER JOIN sys.schemas s ON s.schema_id = v.schema_id\n        INNER JOIN sys.sql_modules AS m ON m.object_id = v.object_id WHERE v.name = '${e.view_name}'`);a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new d.default;u.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT [so].[name] AS [trigger_name], [so].[crdate] AS [created],\n        USER_NAME([so].[uid]) AS [trigger_owner], USER_NAME([so2].[uid]) AS [ts],\n        OBJECT_NAME([so].[parent_obj]) AS [tn],\n        OBJECTPROPERTY( [so].[id], 'ExecIsUpdateTrigger') AS [isupdate],\n        OBJECTPROPERTY( [so].[id], 'ExecIsDeleteTrigger') AS [isdelete],\n        OBJECTPROPERTY( [so].[id], 'ExecIsInsertTrigger') AS [isinsert],\n        OBJECTPROPERTY( [so].[id], 'ExecIsAfterTrigger') AS [isafter],\n        OBJECTPROPERTY( [so].[id], 'ExecIsInsteadOfTrigger') AS [isinsteadof],\n        OBJECTPROPERTY([so].[id], 'ExecIsTriggerDisabled') AS [disabled],df.definition\n        FROM sysobjects AS [so]\n        INNER JOIN sys.sql_modules AS df ON object_id = so.id\n        INNER JOIN sysobjects AS so2 ON so.parent_obj = so2.Id\n        WHERE [so].[type] = 'TR' AND so2.name = '${this.getTnPath(e.tn)}' AND [so].[name] = '${e.trigger_name}'`);for(let e=0;e<t.length;e++){const a=t[e];a.table=a.tn,a.statement=a.definition,a.trigger=a.trigger_name,a.event=[],a.timing=[]}a.data.list=t}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{0===(await this.sqlClient.raw(`SELECT name FROM sys.databases WHERE name = '${e.database_name}'`)).length&&await this.sqlClient.raw(`CREATE DATABASE  ${e.database_name}`)}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async schemaDelete(e={}){const t=this.schemaDelete.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));if(t.connection.database===e.database_name){delete t.connection.database;const e=(0,s.default)(t);await this.sqlClient.destroy(),this.sqlClient=e}await this.sqlClient.raw(`ALTER DATABASE ${e.database_name} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\n         DROP DATABASE ${e.database_name};`)}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=`${this.querySeparator()}DROP TRIGGER IF EXISTS ${e.trigger_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:`${this.querySeparator()}${e.oldStatement}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new d.default;u.api(`${t}:args:`,e);const i=this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name}`,s=this.querySeparator()+e.create_function;try{await this.sqlClient.raw(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:s}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP PROCEDURE IF EXISTS ${e.procedure_name}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}`}],downStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async functionCreate(e={}){const t=this.functionCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`),await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()}\n${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()} ${e.oldCreateFunction}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE ${e.procedure_name}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP PROCEDURE IF EXISTS ${e.procedure_name}`),await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name};${this.querySeparator()}\n${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name};${this.querySeparator()}${e.oldCreateProcedure}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=this.genQuery(`CREATE TRIGGER ?? ON ?? \n${e.timing} ${e.event}\n as\n${e.statement}`,[e.trigger_name,this.getTnPath(e.tn)]);await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP TRIGGER ${e.trigger_name}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new d.default;u.api(`${t}:args:`,e);try{await this.sqlClient.raw(`ALTER TRIGGER ${e.trigger_name} ON ${this.getTnPath(e.tn)} \n${e.timing} ${e.event}\n AS\n${e.statement}`),a.data.object={upStatement:[{sql:this.querySeparator()+`ALTER TRIGGER ${e.trigger_name} ON ${this.getTnPath(e.tn)} \n${e.timing} ${e.event}\n AS\n${e.statement}`}],downStatement:[{sql:this.querySeparator()+`ALTER TRIGGER ${e.trigger_name} ON ${this.getTnPath(e.tn)} \n${e.timing} ${e.event}\n AS\n${e.statement}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name}`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name} ; ${this.querySeparator()}${e.oldViewDefination};`}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new d.default;u.api(`${t}:args:`,e);try{const t=`DROP VIEW ${e.view_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+e.oldViewDefination}]}}catch(e){throw u.ppe(e,t),e}return u.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new d.default;u.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e.tn,e);await this.sqlClient.raw(t);const i=this.querySeparator()+this.sqlClient.schema.withSchema(this.schema).dropTable(e.table).toString();this.emit(`Success : ${t}`);const s=await this.afterTableCreate(e);a.data.object={upStatement:[{sql:t},...s.upStatement],downStatement:[...s.downStatement,{sql:i}]}}catch(e){throw u.ppe(e,t),e}return a}async afterTableCreate(e){const t={upStatement:[],downStatement:[]};let a="",i="";const s=e.columns.find((e=>e.pk));if(!s)return t;for(let t=0;t<e.columns.length;t++){const r=e.columns[t];if(r.au){const t=`[${this.schema}].[xc_trigger_${e.table_name}_${r.column_name}]`,l=this.querySeparator()+this.genQuery("CREATE TRIGGER ?? ON ?? AFTER UPDATE\n                  AS\n                  BEGIN\n                      SET NOCOUNT ON;\n                      UPDATE ?? Set ?? = GetDate() WHERE ?? in (SELECT ?? FROM Inserted)\n                  END;",[t,this.getTnPath(e.table_name),this.getTnPath(e.table_name),r.column_name,s.column_name,s.column_name]);a+=l,await this.sqlClient.raw(l),i+=this.querySeparator()+`DROP TRIGGER IF EXISTS ${this.schema}.${t};`}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async afterTableUpdate(e){const t={upStatement:[],downStatement:[]};let a="",i="";const s=e.columns.find((e=>e.pk));if(!s)return t;for(let t=0;t<e.columns.length;t++){const r=e.columns[t];if(r.au&&1===r.altered){const t=`xc_trigger_${e.table_name}_${r.column_name}`,l=this.querySeparator()+`CREATE TRIGGER [${this.schema}].[${t}] ON  [${this.schema}].[${e.table_name}] AFTER UPDATE\n                  AS\n                  BEGIN\n                      SET NOCOUNT ON;\n                      UPDATE [${this.schema}].[${e.table_name}] Set [${r.column_name}] = GetDate() WHERE [${s.column_name}] in (SELECT [${s.column_name}] FROM Inserted)\n                  END;`;a+=l,await this.sqlClient.raw(l),i+=this.querySeparator()+`DROP TRIGGER IF EXISTS [${this.schema}].[${t}];`}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async tableUpdate(e){const t=this.tableUpdate.name,a=new d.default;u.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",s="";for(let a=0;a<e.columns.length;++a){const l=(0,r.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=this.alterTableRemoveColumn(e.table,e.columns[a],l,i),s+=this.alterTableAddColumn(e.table,l,e.columns[a],s)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=this.alterTableChangeColumn(e.table,e.columns[a],l,i),s+=this.alterTableChangeColumn(e.table,l,e.columns[a],s)):1&e.columns[a].altered&&(i+=this.alterTableAddColumn(e.table,e.columns[a],l,i),s+=this.alterTableRemoveColumn(e.table,e.columns[a],l,s))}i+=this.alterTablePK(e.table,e.columns,e.originalColumns,i),s+=this.alterTablePK(e.table,e.originalColumns,e.columns,s),await this.sqlClient.raw(i),console.log(i);const l=await this.afterTableUpdate(e);a.data.object={upStatement:[{sql:this.querySeparator()+i},...l.upStatement],downStatement:[...l.downStatement,{sql:this.querySeparator()+s}]}}catch(e){throw u.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new d.default;u.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.withSchema(this.schema).dropTable(e.tn).toString();let i=this.querySeparator()+this.createTable(e.tn,e);this.emit(`Success : ${t}`);let s=await this.relationList({tn:e.tn});s=s.data.list;for(const e of s)i+=this.querySeparator()+await this.sqlClient.withSchema(this.schema).schema.table(e.tn,(t=>{t=t.foreign(e.cn,null).references(e.rcn).on(this.getTnPath(e.rtn)),e.ur&&(t=t.onUpdate(e.ur)),e.dr&&t.onDelete(e.dr)})).toQuery();let r=await this.indexList(e);r=r.data.list.filter((({type:e,key_name:t})=>"Primary key"!==e&&-1===t.indexOf("fk_")));const l={};for(const{key_name:t,non_unique:a,cn:i}of r)t in l||(l[t]={tn:this.getTnPath(e.tn),indexName:t,non_unique:a,columns:[]}),l[t].columns.push(i);for(const{non_unique:e,tn:t,columns:a,key_name:s}of Object.values(l))i+=this.querySeparator()+this.sqlClient.schema.withSchema(this.schema).table(t,(function(t){e?t.index(a,s):t.unique(a,s)})).toQuery();await this.sqlClient.schema.withSchema(this.schema).dropTable(e.tn),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw u.ppe(e,t),e}return a}async relationCreate(e){const t=this.relationCreate.name,a=new d.default;u.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this;await this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(a){a=a.foreign(e.childColumn,i).references(e.parentColumn).on(t.getTnPath(e.parentTable)),e.onUpdate&&(a=a.onUpdate(e.onUpdate)),e.onDelete&&a.onDelete(e.onDelete)}));const s=this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(a){a=a.foreign(e.childColumn,i).references(e.parentColumn).on(t.getTnPath(e.parentTable)),e.onUpdate&&(a=a.onUpdate(e.onUpdate)),e.onDelete&&a.onDelete(e.onDelete)}));await s;const r=this.querySeparator()+s.toQuery();this.emit(`Success : ${r}`);const l=this.querySeparator()+this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(t){t.dropForeign(e.childColumn,i)})).toQuery();a.data.object={upStatement:[{sql:r}],downStatement:[{sql:l}]}}catch(e){throw u.ppe(e,t),e}return a}async relationDelete(e){const t=this.relationDelete.name,a=new d.default;u.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this;await this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(t){t.dropForeign(e.childColumn,i)}));const s=this.querySeparator()+this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(t){t.dropForeign(e.childColumn,i)})).toQuery(),r=this.querySeparator()+await this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(a){a.foreign(e.childColumn,i).references(e.parentColumn).on(t.getTnPath(e.parentTable))})).toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:r}]}}catch(e){throw u.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name;let a=new d.default;u.api(`${t}:args:`,e);try{a=await this.columnList(e);const t=this.createTable(e.tn,{tn:e.tn,columns:a.data.list});a.data=t}catch(e){throw u.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data=`INSERT INTO \`${this.getTnPath(e.tn)}\` (`;let t=" VALUES (";const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n${i.data.list[e].cn}\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw u.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data=`UPDATE ${this.getTnPath(e.tn)} \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`:`${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw u.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data=`DELETE FROM ${this.getTnPath(e.tn)} WHERE ;`}catch(e){throw u.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE ${this.getTnPath(e.tn)};`}catch(e){throw u.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new d.default;u.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM ${e.tn};`}catch(e){throw u.ppe(e,t),e}return a}alterTablePK(e,t,a,i,s=!1){const r=[],l=[];let c=0;for(let e=0;e<t.length;++e)t[e].pk&&4!==t[e].altered&&l.push(t[e].cn);for(let e=0;e<a.length;++e)a[e].pk&&r.push(a[e].cn);if(l.length===r.length){for(let e=0;e<l.length;++e)if(r[e]!==l[e]){c=1;break}}else c=l.length-r.length;let d="";return(l.length||r.length)&&c&&(d+=r.length?",DROP PRIMARY KEY":"",l.length&&(d+=s?this.genQuery(", PRIMARY KEY(??)",[l],true):this.genQuery("ALTER TABLE ?? ADD PRIMARY KEY(??)",[this.getTnPath(e),l],true))),d}getTnPath(e){return this.schema?`${this.schema}.${e}`:e}alterTableRemoveColumn(e,t,a,i){let s=i?";":"";return t.cdf&&(s+=this.genQuery("\nALTER TABLE ?? DROP CONSTRAINT ??;",[this.getTnPath(e),t.default_constraint_name||`DF_${e}_${t.cn}`],true)),s+=this.genQuery("\nALTER TABLE ?? DROP COLUMN ??",[this.getTnPath(e),t.cn],true),s}createTableColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,0)}alterTableAddColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,1)}alterTableChangeColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,2)}createTable(e,t){let a="";for(let i=0;i<t.columns.length;++i)a+=this.createTableColumn(e,t.columns[i],null,a);return a+=this.alterTablePK(e,t.columns,[],a,!0),a=this.genQuery(`CREATE TABLE ?? (${a});`,[this.getTnPath(t.tn)],!0),a}alterTableColumn(e,t,a,i,s=2){let r="";const l=this.sanitiseDefaultValue(t.cdf),c=!0,d=!function(e){switch(e){case"datetimeoffset":case"geography":case"geometry":case"heirarchyid":case"image":case"money":case"real":case"json":case"smalldatetime":case"smallmoney":case"text":case"time":case"timestamp":case"int":case"tinyint":case"bigint":case"bit":case"smallint":case"float":case"uniqueidentifier":case"xml":return!0;default:return!1}}(t.dt)&&t.dtxp?`(${t.dtxp}${t.dtxs?`,${t.dtxs}`:""})`:"";return 0===s?(r=i?",":"",r+=this.genQuery(`?? ${this.sanitiseDataType(t.dt)}`,[t.cn],c),r+=d,r+=t.rqd?" NOT NULL":" NULL",r+=t.ai?" IDENTITY(1,1)":" ",r+=l?this.genQuery(` CONSTRAINT  ?? DEFAULT ${l}`,[`DF_${e}_${t.cn}`],c):"",l&&(t.default_constraint_name=`DF_${e}_${t.cn}`)):1===s?(r+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],c),r+=d,r+=t.rqd?" NOT NULL":" NULL",r+=t.ai?" IDENTITY(1,1)":" ",r+=l?this.genQuery(` CONSTRAINT ?? DEFAULT ${l}`,[`DF_${e}_${t.cn}`],c):" ",r=this.genQuery(`ALTER TABLE ?? ${r};`,[this.getTnPath(e)],c),l&&(t.default_constraint_name=`DF_${e}_${t.cn}`)):(t.cn!==a.cn&&(r+=this.genQuery("\nEXEC sp_rename ?, ?, 'COLUMN';\n",[`${this.getTnPath(e)}.${t.cno}`,`${t.cn}`],c)),t.dtxp===a.dtxp&&t.dtxs===a.dtxs&&t.dt===a.dt&&t.rqd===a.rqd||(r+=this.genQuery(`\nALTER TABLE ?? ALTER COLUMN ?? ${this.sanitiseDataType(t.dt)}${d}`,[this.getTnPath(e),t.cn],c),r+=t.rqd?" NOT NULL;\n":" NULL;\n"),t.cdf===a.cdf&&t.cn===a.cn||(a.default_constraint_name&&(r+=this.genQuery("\nALTER TABLE ?? DROP CONSTRAINT ??;",[this.getTnPath(e),a.default_constraint_name],c)),t.cdf&&(r+=this.genQuery(`\nALTER TABLE ??  ADD CONSTRAINT ?? DEFAULT ${this.sanitiseDefaultValue(t.cdf)} FOR ??;`,[this.getTnPath(e),`DF_${t.tn}_${t.cn}`,t.cn],c),t.default_constraint_name=`DF_${t.tn}_${t.cn}`))),r}get schema(){return this.connectionConfig&&this.connectionConfig.searchPath&&this.connectionConfig.searchPath[0]||"dbo"}async totalRecords(e={}){const t=this.totalRecords.name,a=new d.default;u.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SUM(RecordCount) AS TotalRecords FROM\n      (SELECT (SCHEMA_NAME(A.schema_id) + '.' + A.Name) AS TableName, AVG(B.rows) AS RecordCount\n        FROM sys.objects A\n        INNER JOIN sys.partitions B ON A.object_id = B.object_id\n        WHERE A.type = 'U'\n        GROUP BY A.schema_id,A.Name) src");a.data=e[0]}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{u.api(`${t} :result: ${a}`)}return a}}t.default=MssqlClient},65271:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=l(a(67072)),d=a(50970),u=l(a(50536)),p=l(a(90922)),m=l(a(96964)),_=l(a(72208)),f=l(a(50162)),h=l(a(75058)),g=a(92080),y=l(a(68920)),b=l(a(98152)),w=l(a(29896)),v=l(a(58108)),T=l(a(69643)),k=l(a(25268)),S=l(a(70932)),M=r(a(50812)),O=new b.default("MysqlClient"),I=new w.default;class MysqlClient extends T.default{constructor(e){super(e),this.queries=k.default,this._version={}}emit(e){O.api(e),I.evt.emit("UI",{status:0,data:`SQL : ${e}`})}emitW(e){O.warn(e),I.evt.emit("UI",{status:1,data:`SQL : ${e}`})}emitE(e){O.error(e),I.evt.emit("UI",{status:-1,data:`SQL : ${e}`})}async schemaCreateWithCredentials(e){const t=this.schemaCreateWithCredentials.name,a=new v.default;O.api(`${t}:args:`,e);try{e.schema||(e.schema=`nc${(0,g.nanoid)(8)}`),e.user||(e.user=`nc${(0,g.nanoid)(8)}`),e.password||(e.password=(0,g.nanoid)(16));const t=await this.sqlClient.raw("create database if not exists ??",[e.schema]);await this.sqlClient.raw("CREATE USER ?@'localhost' IDENTIFIED WITH mysql_native_password BY ?",[e.user,e.password]),await this.sqlClient.raw("GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, INDEX, DROP, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES PRIVILEGES ON ??.* TO ?@'localhost'",[e.schema,e.user]),await this.sqlClient.raw("FLUSH PRIVILEGES"),O.debug("Create database if not exists",t),a.object=e}catch(e){a.code=-1,a.message=e.message,a.object=e}return a}async testConnection(e={}){const t=this.testConnection.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw("SELECT 1+1 as data")}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{a.code?this.emitE(`TestConnection result: ${a.message}`):this.emit(`TestConnection result: ${a.code}`)}return a}getKnexDataTypes(){const e=new v.default;return e.data.list=["int","tinyint","smallint","mediumint","bigint","float","decimal","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","char","varchar","nchar","text","tinytext","mediumtext","longtext","binary","varbinary","blob","tinyblob","mediumblob","longblob","enum","set","time","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","json"],e}async version(e){const t=this.version.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data.object={};const e=await this.sqlClient.raw("select version() as version");O.debug(e[0][0]),a.data.object.version=e[0][0].version;const t=e[0][0].version.split(".");t.length&&3===t.length?(a.data.object.primary=t[0],a.data.object.major=t[1],a.data.object.minor=t[2],a.data.object.key=t[0]+t[1]):(a.code=-1,a.message=`Invalid version : ${e[0][0].version}`)}catch(e){O.ppe(e),a.code=-1,a.message=e.message}finally{O.api(`${t} :result: %o`,a)}return a}async getDataTypes(e={}){const t=this.getDataTypes.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.version(),this._version.key in this.types?a.data.list=this.types[this._version.key]:a.data.list=this.types.default}catch(e){O.ppe(e),a.code=-1,a.message=e.message}finally{O.api(`${t} :result: ${a}`)}return a}async createDatabaseIfNotExists(e={}){const t=this.createDatabaseIfNotExists.name,a=new v.default;O.api(`${t}:args:`,e,this.connectionConfig);try{const a=JSON.parse(JSON.stringify(this.connectionConfig));delete a.connection.database;const i=(0,u.default)(a),s=await i.raw(this.queries[t].default.sql,[e.database]);O.debug("Create database if not exists",s),await i.destroy()}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async dropDatabase(e={}){const t=this.dropDatabase.name,a=new v.default;O.api(`${t}:args:`,e);try{O.api("dropping database:",e),await this.sqlClient.raw(this.queries[t].default.sql,[e.database])}catch(e){e&&O.ppe(e.message,t)}return O.api(`${t}: result`,a),a}async createTableIfNotExists(e={}){const t=this.createTableIfNotExists.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw(this.sqlClient.schema.hasTable(e.tn).toQuery())?O.debug(`${e.tn} tables exists`):(await this.sqlClient.raw(this.sqlClient.schema.createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})).toQuery()),O.debug("Table created:",`${e.tn}`))}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async hasTable(e){const t=this.hasTable.name,a=new v.default;O.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(this.sqlClient.schema.hasTable(e.tn).toQuery());a.data.value=t}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async hasDatabase(e){const t=this.hasDatabase.name,a=new v.default;O.api(`${t}:args:`,e);try{const i=await this.sqlClient.raw(this.queries[t].default.sql,[`${e.databaseName}`]);a.data.value=i.length>0}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new v.default;O.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW databases");if(O.debug(e.length),2===e.length){for(let t=0;t<e[0].length;++t)e[0][t].database_name=e[0][t].Database;a.data.list=e[0]}else O.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a.data.list.length),a}async tableList(e){const t=this.tableList.name,a=new v.default;O.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW FULL TABLES WHERE TABLE_TYPE NOT LIKE 'VIEW'");let t;if(2===e.length){for(let a=0;a<e[0].length;++a)t||(t=Object.keys(e[0][a]).find((e=>/^Tables_in_/i.test(e)))),e[0][a].tn=e[0][a][t];a.data.list=e[0]}else O.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[];this.emitTele({mysql:1,table_count:a.data.list.length,api_count:10*a.data.list.length})}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a.data.list),a}async schemaList(e){const t=this.schemaList.name,a=new v.default;O.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("select schema_name \n                    from \n                        information_schema.schemata \n                            where \n                                schema_name not in ('information_schema','performance_schema','sys','mysql') \n                                order by schema_name;");2===e.length?a.data.list=e[0].map((e=>(0,m.default)(e,((e,t)=>t.toLowerCase())))):(O.debug("Unknown response for schemaList:",a.data.list.length),a.data.list=[])}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a.data.list),a}async columnList(e={}){var t;const a=this.columnList.name,i=new v.default;O.api(`${a}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const s=await this.sqlClient.raw(await this._getQuery({func:a}),[e.databaseName,e.tn,e.databaseName,e.tn]);if(2===s.length){const e=[];s[0].length||(i.code=-1,i.message="Table not found or Invalid table name");for(let a=0;a<s[0].length;++a){const i={};if(s[0][a]=(0,m.default)(s[0][a],((e,t)=>t.toLowerCase())),"57"!==this._version.key&&"80"!==this._version.key||(i.dp=s[0][a].dp,i.generated_expression=s[0][a].generated_expression),i.tn=s[0][a].tn,i.cn=s[0][a].cn,i.cno=s[0][a].cn,i.dt=s[0][a].dt,i.np=s[0][a].np,i.ns=s[0][a].ns,i.clen=s[0][a].clen,i.cop=s[0][a].cop,i.pk="PRI"===s[0][a].ck,i.nrqd="NO"!==s[0][a].nrqd,i.rqd=!i.nrqd,s[0][a].ct=s[0][a].ct||"",i.un=-1!==s[0][a].ct.indexOf("unsigned"),i.ct=s[0][a].ct||"",s[0][a].ext=s[0][a].ext||"",i.ai=-1!==s[0][a].ext.indexOf("auto_increment"),s[0][a].cst=s[0][a].cst||" ",i.unique=-1!==s[0][a].cst.indexOf("UNIQUE"),"timestamp"===i.dt||"datetime"===i.dt)if(s[0][a].cdf&&s[0][a].ext){const e=s[0][a].ext;e.includes("DEFAULT_GENERATED")?i.cdf=s[0][a].cdf+e.substring(e.lastIndexOf("DEFAULT_GENERATED")+17):i.cdf=`${s[0][a].cdf} ${e}`}else i.cdf=s[0][a].cdf;else i.cdf=s[0][a].cdf;(null===(t=this._version)||void 0===t?void 0:t.version)&&this._version.version.includes("Maria")&&"NULL"===i.cdf&&(i.cdf=null),i.cc=s[0][a].cc,i.csn=s[0][a].csn,i.dtx="specificType","int"===i.dt||"tinyint"===i.dt||"mediumint"===i.dt||"bigint"===i.dt||"enum"===i.dt||"set"===i.dt?(i.dtxp=i.ct.substring(i.ct.lastIndexOf("(")+1,i.ct.lastIndexOf(")")),i.dtxs=s[0][a].ns):(i.dtxp=s[0][a].clen||s[0][a].np||s[0][a].dp,i.dtxs=s[0][a].ns),i.au=!1,e.push(i)}i.data.list=e}else O.debug("Unknown response for databaseList:",s),i.data.list=[]}catch(e){throw O.ppe(e,a),e}return O.api(`${a}: result list length = `,i.data.list.length),i}async indexList(e={}){const t=this.indexList.name,a=new v.default;O.api(`${t}:args:`,e);try{const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.tn]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),a.cn=a.column_name,delete a.column_name,a.tn=a.table,delete a.table,a.non_unique_original=a.non_unique,e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[];O.api(`${t}: result %O`,a.data.list)}catch(e){throw O.ppe(e,t),e}return a}async constraintList(e={}){const t=this.constraintList.name,a=new v.default;O.api(`${t}:args:`,e);try{const i=await this.sqlClient.raw(await this._getQuery({func:t}),[this.connectionConfig.connection.database,e.tn]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName,e.tn]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationListAll.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,{databaseName:e.databaseName});if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e,this.emitTele({mysql:1,relation_count:a.data.list.length,api_count:10*a.data.list.length})}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[`%${e.tn}%`]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),a.trigger_name=a.trigger,e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),a.function_name=a.name,e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),a.procedure_name=a.name,e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[]);let s;if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){s||(s=Object.keys(i[0][t]).find((e=>/^Tables_in_/i.test(e))));const a=i[0][t];a.view_name=a[s],e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a.data.list.length),a}async functionRead(e={}){const t=this.functionRead.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.function_name]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),a.create_function=a["create function"],e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.procedure_name]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),a.create_procedure=a["create procedure"],e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName,e.view_name]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,m.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new v.default;O.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName]);if(2===i.length){const t=[];for(let a=0;a<i[0].length;++a){const s=i[0][a];s.view_name=s[`Tables_in_${e.databaseName}`],t.push(s)}a.data.list=t}else O.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.triggerList.name;O.api(`${t}:args:`,e);return await this.sqlClient.raw(this.queries[t].default.sql,[e.database_name])}async schemaDelete(e={}){const t=this.schemaDelete.name;O.api(`${t}:args:`,e);return await this.sqlClient.raw(this.queries[t].default.sql,[e.database_name])}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new v.default;O.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP TRIGGER ${e.trigger_name}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP TRIGGER ??",[e.trigger_name]),await this.sqlClient.raw(`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`),a.data.object={upStatement:[{sql:`${this.querySeparator()}DROP TRIGGER ${e.trigger_name};\n${this.querySeparator()}CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`}],downStatement:[{sql:`${this.querySeparator()}CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.oldStatement}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new v.default;O.api(`${t}:args:`,e);try{const t=`${this.querySeparator()}DROP TRIGGER ${e.trigger_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:`${this.querySeparator()}CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.oldStatement}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new v.default;O.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new v.default;O.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE OR REPLACE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new v.default;O.api(`${t}:args:`,e);try{const t=this.querySeparator()+`DROP VIEW ${e.view_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async functionCreate(e={}){const t=this.functionCreate.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION ${e.function_name}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`),await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()}\n${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()}${e.oldCreateFunction}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name}`}],downStatement:[{sql:this.querySeparator()+`${e.create_function}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE ${e.procedure_name}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP PROCEDURE IF EXISTS ??",[e.procedure_name]),await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}; ${this.querySeparator()} \n${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}; ${this.querySeparator()} ${e.oldCreateProcedure}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new v.default;O.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP PROCEDURE IF EXISTS ??",[e.procedure_name]),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}`}],downStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}]}}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}async _getQuery(e){try{if((0,p.default)(this._version)){const t=await this.version();this._version=t.data.object,O.debug(`Version was empty for ${e.func}: population version for database as`,this._version)}return this._version.key in this.queries[e.func]?this.queries[e.func][this._version.key].sql:this.queries[e.func].default.sql}catch(e){throw O.ppe(e,this._getQuery.name),e}}mapFieldWithSuggestedFakerFn(e){return e.map((e=>{let t=null,a=1/0;const i=M.mapDataType(e.dt);return S.default.forEach(((s,r)=>{if("string"===i||i===s.type)if(r){const i=y.default.get(e.cn.toLowerCase(),s.name.toLowerCase());a>i&&(a=i,t=s)}else t=s,a=y.default.get(e.cn.toLowerCase(),s.name.toLowerCase())})),a<3?Object.assign(Object.assign({},e),{fakerFunction:t.value}):e}))}async seedInit(e){const t=this.seedInit.name,a=new v.default;O.api(`${t}:args:`,e),console.log("in mysql SeedInit");try{await(0,h.default)(e.seedsFolder);const t=c.default.join(e.seedsFolder,"__xseeds.json");await(0,d.promisify)(f.default.writeFile)(t,{rows:{value:8,description:"Maximum number of records"},foreign_key_rows:{value:2,description:"1:n - Total number foreign key per relation"}},{spaces:2});let i=await this.tableList();i=i.data.list;for(const t of i){let a=await this.columnList({tn:t.tn});a=a.data.list;for(let e=0;e<a.length;++e)a[e].fakerFunction=null;a=this.mapFieldWithSuggestedFakerFn(a);let i=await this.relationList({tn:t.tn});i=i.data.list;for(let e=0;e<i.length;e++){const t=i[e];for(let e=0;e<a.length;e++){const i=a[e];i.cn===t.cn&&(a[e]=Object.assign(Object.assign({},i),t))}}await this.fakerColumnsCreate({seedsFolder:e.seedsFolder,tn:t.tn,fakerColumns:a})}a.data=await(0,d.promisify)(f.default.readFile)(t)}catch(e){throw O.ppe(e,t),e}return a}async tableCreate(e){const t=this.tableCreate.name,a=new v.default;O.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e);await this.sqlClient.raw(t);const i=this.querySeparator()+this.sqlClient.schema.dropTable(e.table).toString();this.emit(`Success : ${t}`),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw O.ppe(e,t),e}return a}async tableUpdate(e){const t=this.tableUpdate.name,a=new v.default;O.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",s="";for(let a=0;a<e.columns.length;++a){const r=(0,_.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=this.alterTableRemoveColumn(e.columns[a],r,i),s+=this.alterTableAddColumn(r,e.columns[a],s)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=this.alterTableChangeColumn(e.columns[a],r,i),s+=this.alterTableChangeColumn(r,e.columns[a],s)):1&e.columns[a].altered&&(i+=this.alterTableAddColumn(e.columns[a],r,i),s+=this.alterTableRemoveColumn(e.columns[a],r,s))}i+=this.alterTablePK(e.columns,e.originalColumns,i),s+=this.alterTablePK(e.originalColumns,e.columns,s),i&&(i=this.genQuery(`ALTER TABLE ?? ${this.sanitize(i)};`,[e.tn]),s=this.genQuery(`ALTER TABLE ?? ${this.sanitize(s)};`,[e.tn])),await this.sqlClient.raw(i),console.log(i),a.data.object={upStatement:[{sql:this.querySeparator()+i}],downStatement:[{sql:this.querySeparator()+s}]}}catch(e){throw O.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new v.default;O.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.dropTable(e.table_name).toString();let i=await this.sqlClient.raw("show create table ??",[e.table_name]);i=Object.entries(i[0][0]).find((([e])=>"create table"===e.toLowerCase()))[1];const s=this.querySeparator()+i;this.emit(`Success : ${t}`),await this.sqlClient.raw(this.sqlClient.schema.dropTable(e.table_name).toQuery()),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:s}]}}catch(e){throw O.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data=";";const t=await this.sqlClient.raw("show create table ??;",[e.tn]);2===t.length&&(a.data=t[0][0]["Create Table"])}catch(e){throw O.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new v.default;O.api(`${t}:args:`,e);try{let t=" VALUES (";a.data=`INSERT INTO \`${e.tn}\` (`;const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n\`${i.data.list[e].cn}\`\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw O.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data=`UPDATE \`${e.tn}\` \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`:`\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw O.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data=`DELETE FROM ${e.tn};`}catch(e){throw O.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE ${e.tn};`}catch(e){throw O.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM ${e.tn};`}catch(e){throw O.ppe(e,t),e}return a}async sequenceList(e={}){const t=this.sequenceList.name,a=new v.default;O.api(`${t}:args:`,e);try{a.data.list=[]}catch(e){throw O.ppe(e,t),e}return O.api(`${t}: result`,a),a}alterTableRemoveColumn(e,t,a){let i=a?",":"";return i+=this.genQuery(" DROP COLUMN ??",[e.cn]),i}createTableColumn(e,t,a){return this.alterTableColumn(e,t,a,0)}alterTableAddColumn(e,t,a){return this.alterTableColumn(e,t,a,1)}alterTableChangeColumn(e,t,a){return this.alterTableColumn(e,t,a,2)}createTable(e){let t="";for(let a=0;a<e.columns.length;++a)t+=this.createTableColumn(e.columns[a],null,t);return t+=this.alterTablePK(e.columns,[],t,!0),t=this.genQuery(`CREATE TABLE ?? (${this.sanitize(t)});`,[e.tn]),t}alterTableColumn(e,t,a,i=2){let s=a?",":"";const r=parseInt(e.dtxs)?parseInt(e.dtxs):null;s+=2===i?this.genQuery(`\n    CHANGE\n    COLUMN ?? ?? ${this.sanitiseDataType(e.dt)}`,[t.cn,e.cn]):1===i?this.genQuery(`\n    ADD\n    COLUMN ?? ${this.sanitiseDataType(e.dt)}`,[e.cn]):this.genQuery(` ?? ${this.sanitiseDataType(e.dt)}`,[e.cn]),e.dt.endsWith("text")||(s+=e.dtxp&&" "!==e.dtxp?`(${e.dtxp}`:"",s+=r?`,${r}`:"",s+=e.dtxp&&" "!==e.dtxp?")":""),s+=e.un?" UNSIGNED":"",s+=e.rqd?" NOT NULL":" NULL",s+=e.ai?" auto_increment":"",s+=e.unique?" UNIQUE":"";const l=this.sanitiseDefaultValue(e.cdf);return s+=l?`\n    DEFAULT ${l}`:"",s}alterTablePK(e,t,a,i=!1){const s=[],r=[];let l=0;for(let t=0;t<e.length;++t)e[t].pk&&4!==e[t].altered&&r.push(e[t].cn);for(let e=0;e<t.length;++e)t[e].pk&&s.push(t[e].cn);if(r.length===s.length){for(let e=0;e<r.length;++e)if(s[e]!==r[e]){l=1;break}}else l=r.length-s.length;let c="";return(r.length||s.length)&&l&&(c+=s.length?",DROP PRIMARY KEY":"",r.length&&(c+=i?this.genQuery(", PRIMARY\n    KEY(??)",[r]):this.genQuery(", ADD\n    PRIMARY\n    KEY(??)",[r]))),c}async totalRecords(e={}){const t=this.totalRecords.name,a=new v.default;O.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SUM(table_rows) as TotalRecords FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = ?;",[this.connectionConfig.connection.database]);a.data=e[0][0]}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{O.api(`${t} :result: ${a}`)}return a}}t.default=MysqlClient},33232:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(96964)),r=i(a(98152)),l=i(a(58108)),c=i(a(65271)),d=new r.default("TidbClient");class Tidb extends c.default{async constraintList(e={}){const t=this.constraintList.name,a=new l.default;d.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("select *, TABLE_NAME as tn from INFORMATION_SCHEMA.KEY_COLUMN_USAGE where CONSTRAINT_SCHEMA=? and TABLE_NAME=?",[this.connectionConfig.connection.database,e.tn]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,s.default)(i,(function(e,t){return t.toLowerCase()})),e.push(i)}a.data.list=e}else d.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}}t.default=Tidb},88696:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(96964)),r=i(a(98152)),l=i(a(58108)),c=i(a(65271)),d=new r.default("VitessClient");class Vitess extends c.default{constructor(e){super(e)}async relationList(e={}){const t=new l.default;return t.data.list=[],t}async relationListAll(e={}){const t=new l.default;return t.data.list=[],t}async databaseList(e={}){const t=this.databaseList.name,a=new l.default;d.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW databases");if(d.debug(e.length),2===e.length){for(let t=0;t<e[0].length;++t)e[0][t].database_name=e[0][t].Databases;a.data.list=e[0]}else d.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a.data.list.length),a}async tableList(e={}){const t=this.tableList.name,a=new l.default;d.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW TABLES"),t=`Tables_in_vt_${this.connectionConfig.connection.database}`;if(2===e.length){for(let a=0;a<e[0].length;++a)e[0][a].tn=e[0][a][t];a.data.list=e[0]}else d.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a.data.list.length),a}async columnList(e={}){const t=this.columnList.name,a=new l.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("select *, table_name as tn from information_schema.columns where table_name = ? ORDER by ordinal_position",[e.tn]);if(2===t.length){const i=[];for(let a=0;a<t[0].length;++a){const r={};t[0][a]=(0,s.default)(t[0][a],((e,t)=>t.toLowerCase())),r.tn=e.tn,r.cn=t[0][a].cn,r.dt=t[0][a].dt,r.np=t[0][a].np,r.ns=t[0][a].ns,r.clen=t[0][a].clen,r.cop=t[0][a].op,r.dtx=this.getKnexDataType(r.dt),r.pk="PRI"===t[0][a].ck,r.nrqd="NO"!==t[0][a].nrqd,r.not_nullable=!r.nrqd,t[0][a].ct=t[0][a].ct||"",r.un=-1!==t[0][a].ct.indexOf("unsigned"),r.ct=t[0][a].ct||"",t[0][a].ext=t[0][a].ext||"",r.ai=-1!==t[0][a].ext.indexOf("auto_increment"),t[0][a].cst=t[0][a].cst||" ",r.unique=-1!==t[0][a].cst.indexOf("UNIQUE"),r.cdf=t[0][a].cdf,r.cc=t[0][a].cc,r.csn=t[0][a].csn,i.push(r)}a.data.list=i}else d.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result list length = `,a.data.list.length),a}async constraintList(e={}){const t=this.constraintList.name,a=new l.default;d.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("select *, TABLE_NAME as tn from INFORMATION_SCHEMA.KEY_COLUMN_USAGE where TABLE_NAME = ? ORDER by ordinal_position;",[e.tn]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,s.default)(i,(function(e,t){return t.toLowerCase()})),e.push(i)}a.data.list=e}else d.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}}t.default=Vitess},70932:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"zipCode",group:"address",value:"address.zipCode",type:"string"},{name:"city",group:"address",value:"address.city",type:"string"},{name:"cityPrefix",group:"address",value:"address.cityPrefix",type:"string"},{name:"citySuffix",group:"address",value:"address.citySuffix",type:"string"},{name:"streetName",group:"address",value:"address.streetName",type:"string"},{name:"streetAddress",group:"address",value:"address.streetAddress",type:"string"},{name:"streetSuffix",group:"address",value:"address.streetSuffix",type:"string"},{name:"streetPrefix",group:"address",value:"address.streetPrefix",type:"string"},{name:"secondaryAddress",group:"address",value:"address.secondaryAddress",type:"string"},{name:"county",group:"address",value:"address.county",type:"string"},{name:"country",group:"address",value:"address.country",type:"string"},{name:"countryCode",group:"address",value:"address.countryCode",type:"string"},{name:"state",group:"address",value:"address.state",type:"string"},{name:"stateAbbr",group:"address",value:"address.stateAbbr",type:"string"},{name:"latitude",group:"address",value:"address.latitude",type:"number"},{name:"longitude",group:"address",value:"address.longitude",type:"number"},{name:"color",group:"commerce",value:"commerce.color",type:"string"},{name:"department",group:"commerce",value:"commerce.department",type:"string"},{name:"productName",group:"commerce",value:"commerce.productName",type:"string"},{name:"price",group:"commerce",value:"commerce.price",type:"number"},{name:"productAdjective",group:"commerce",value:"commerce.productAdjective",type:"string"},{name:"productMaterial",group:"commerce",value:"commerce.productMaterial",type:"string"},{name:"product",group:"commerce",value:"commerce.product",type:"string"},{name:"suffixes",group:"company",value:"company.suffixes",type:"string"},{name:"companyName",group:"company",value:"company.companyName",type:"string"},{name:"companySuffix",group:"company",value:"company.companySuffix",type:"string"},{name:"catchPhrase",group:"company",value:"company.catchPhrase",type:"string"},{name:"bs",group:"company",value:"company.bs",type:"string"},{name:"catchPhraseAdjective",group:"company",value:"company.catchPhraseAdjective",type:"string"},{name:"catchPhraseDescriptor",group:"company",value:"company.catchPhraseDescriptor",type:"string"},{name:"catchPhraseNoun",group:"company",value:"company.catchPhraseNoun",type:"string"},{name:"bsAdjective",group:"company",value:"company.bsAdjective",type:"string"},{name:"bsBuzz",group:"company",value:"company.bsBuzz",type:"string"},{name:"bsNoun",group:"company",value:"company.bsNoun",type:"string"},{name:"column",group:"database",value:"database.column",type:"string"},{name:"type",group:"database",value:"database.type",type:"string"},{name:"collation",group:"database",value:"database.collation",type:"string"},{name:"engine",group:"database",value:"database.engine",type:"string"},{name:"past",group:"date",value:"date.past",type:"date"},{name:"future",group:"date",value:"date.future",type:"date"},{name:"recent",group:"date",value:"date.recent",type:"date"},{name:"soon",group:"date",value:"date.soon",type:"date"},{name:"month",group:"date",value:"date.month",type:"string"},{name:"weekday",group:"date",value:"date.weekday",type:"string"},{name:"account",group:"finance",value:"finance.account",type:"string"},{name:"accountName",group:"finance",value:"finance.accountName",type:"string"},{name:"mask",group:"finance",value:"finance.mask",type:"string"},{name:"amount",group:"finance",value:"finance.amount",type:"number"},{name:"transactionType",group:"finance",value:"finance.transactionType",type:"string"},{name:"currencyCode",group:"finance",value:"finance.currencyCode",type:"string"},{name:"currencyName",group:"finance",value:"finance.currencyName",type:"string"},{name:"currencySymbol",group:"finance",value:"finance.currencySymbol",type:"string"},{name:"bitcoinAddress",group:"finance",value:"finance.bitcoinAddress",type:"string"},{name:"ethereumAddress",group:"finance",value:"finance.ethereumAddress",type:"string"},{name:"iban",group:"finance",value:"finance.iban",type:"string"},{name:"bic",group:"finance",value:"finance.bic",type:"string"},{name:"abbreviation",group:"hacker",value:"hacker.abbreviation",type:"string"},{name:"adjective",group:"hacker",value:"hacker.adjective",type:"string"},{name:"noun",group:"hacker",value:"hacker.noun",type:"string"},{name:"verb",group:"hacker",value:"hacker.verb",type:"string"},{name:"ingverb",group:"hacker",value:"hacker.ingverb",type:"string"},{name:"phrase",group:"hacker",value:"hacker.phrase",type:"string"},{name:"createCard",group:"helpers",value:"helpers.createCard",type:"string"},{name:"contextualCard",group:"helpers",value:"helpers.contextualCard",type:"string"},{name:"userCard",group:"helpers",value:"helpers.userCard",type:"string"},{name:"createTransaction",group:"helpers",value:"helpers.createTransaction",type:"string"},{name:"image",group:"image",value:"image.image",type:"string"},{name:"avatar",group:"image",value:"image.avatar",type:"string"},{name:"imageUrl",group:"image",value:"image.imageUrl",type:"string"},{name:"abstract",group:"image",value:"image.abstract",type:"string"},{name:"animals",group:"image",value:"image.animals",type:"string"},{name:"business",group:"image",value:"image.business",type:"string"},{name:"cats",group:"image",value:"image.cats",type:"string"},{name:"city",group:"image",value:"image.city",type:"string"},{name:"food",group:"image",value:"image.food",type:"string"},{name:"nightlife",group:"image",value:"image.nightlife",type:"string"},{name:"fashion",group:"image",value:"image.fashion",type:"string"},{name:"people",group:"image",value:"image.people",type:"string"},{name:"nature",group:"image",value:"image.nature",type:"string"},{name:"sports",group:"image",value:"image.sports",type:"string"},{name:"technics",group:"image",value:"image.technics",type:"string"},{name:"transport",group:"image",value:"image.transport",type:"string"},{name:"dataUri",group:"image",value:"image.dataUri",type:"string"},{name:"avatar",group:"internet",value:"internet.avatar",type:"string"},{name:"email",group:"internet",value:"internet.email",type:"string"},{name:"exampleEmail",group:"internet",value:"internet.exampleEmail",type:"string"},{name:"userName",group:"internet",value:"internet.userName",type:"string"},{name:"protocol",group:"internet",value:"internet.protocol",type:"string"},{name:"url",group:"internet",value:"internet.url",type:"string"},{name:"domainName",group:"internet",value:"internet.domainName",type:"string"},{name:"domainSuffix",group:"internet",value:"internet.domainSuffix",type:"string"},{name:"domainWord",group:"internet",value:"internet.domainWord",type:"string"},{name:"ip",group:"internet",value:"internet.ip",type:"string"},{name:"ipv6",group:"internet",value:"internet.ipv6",type:"string"},{name:"userAgent",group:"internet",value:"internet.userAgent",type:"string"},{name:"color",group:"internet",value:"internet.color",type:"string"},{name:"mac",group:"internet",value:"internet.mac",type:"string"},{name:"password",group:"internet",value:"internet.password",type:"string"},{name:"word",group:"lorem",value:"lorem.word",type:"string"},{name:"words",group:"lorem",value:"lorem.words",type:"string"},{name:"sentence",group:"lorem",value:"lorem.sentence",type:"string"},{name:"slug",group:"lorem",value:"lorem.slug",type:"string"},{name:"sentences",group:"lorem",value:"lorem.sentences",type:"string"},{name:"paragraph",group:"lorem",value:"lorem.paragraph",type:"string"},{name:"paragraphs",group:"lorem",value:"lorem.paragraphs",type:"string"},{name:"text",group:"lorem",value:"lorem.text",type:"string"},{name:"lines",group:"lorem",value:"lorem.lines",type:"string"},{name:"firstName",group:"name",value:"name.firstName",type:"string"},{name:"lastName",group:"name",value:"name.lastName",type:"string"},{name:"findName",group:"name",value:"name.findName",type:"string"},{name:"jobTitle",group:"name",value:"name.jobTitle",type:"string"},{name:"prefix",group:"name",value:"name.prefix",type:"string"},{name:"suffix",group:"name",value:"name.suffix",type:"string"},{name:"title",group:"name",value:"name.title",type:"string"},{name:"jobDescriptor",group:"name",value:"name.jobDescriptor",type:"string"},{name:"jobArea",group:"name",value:"name.jobArea",type:"string"},{name:"jobType",group:"name",value:"name.jobType",type:"string"},{name:"phoneNumber",group:"phone",value:"phone.phoneNumber",type:"string"},{name:"phoneNumberFormat",group:"phone",value:"phone.phoneNumberFormat",type:"string"},{name:"phoneFormats",group:"phone",value:"phone.phoneFormats",type:"string"},{name:"number",group:"random",value:"random.number",type:"number"},{name:"float",group:"random",value:"random.float",type:"number"},{name:"uuid",group:"random",value:"random.uuid",type:"string"},{name:"boolean",group:"random",value:"random.boolean",type:"boolean"},{name:"word",group:"random",value:"random.word",type:"string"},{name:"words",group:"random",value:"random.words",type:"string"},{name:"image",group:"random",value:"random.image",type:"string"},{name:"locale",group:"random",value:"random.locale",type:"string"},{name:"alphaNumeric",group:"random",value:"random.alphaNumeric",type:"string"},{name:"hexaDecimal",group:"random",value:"random.hexaDecimal",type:"string"},{name:"fileName",group:"system",value:"system.fileName",type:"string"},{name:"commonFileName",group:"system",value:"system.commonFileName",type:"string"},{name:"mimeType",group:"system",value:"system.mimeType",type:"string"},{name:"commonFileType",group:"system",value:"system.commonFileType",type:"string"},{name:"commonFileExt",group:"system",value:"system.commonFileExt",type:"string"},{name:"fileType",group:"system",value:"system.fileType",type:"string"},{name:"fileExt",group:"system",value:"system.fileExt",type:"string"},{name:"directoryPath",group:"system",value:"system.directoryPath",type:"string"},{name:"filePath",group:"system",value:"system.filePath",type:"string"},{name:"semver",group:"system",value:"system.semver",type:"string"}]},50812:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapDataType=void 0;t.mapDataType=function(e){switch(e){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":case"boolean":case"float":case"decimal":case"double":case"serial":return"number";case"date":case"datetime":case"timestamp":case"time":case"year":return"date";case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"enum":case"set":case"json":return"string"}return"string"}},25268:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a="SELECT\nc.table_name as tn,\nc.column_name as cn,\nc.data_type as dt,\nc.column_type as ct,\nc.character_maximum_length as clen,\nc.numeric_precision as np,\nc.numeric_scale as ns,\n-- c.datetime_precision as dp,\nc.ordinal_position as cop,\nc.column_key as ck,\nc.extra as ext, -- gives ai\nc.column_default as cdf,\nc.is_nullable as nrqd,\nc.privileges as priv,\nc.column_comment as cc,\n-- c.generation_expression,\nc.character_set_name as csn,\nc.collation_name as clnn,\nct.CONSTRAINT_TYPE as cst\nFROM\ninformation_schema.COLUMNS as c\nLeft join(\n        select\n                tc.CONSTRAINT_NAME,\n                tc.TABLE_NAME,\n                tc.CONSTRAINT_SCHEMA,\n                tc.CONSTRAINT_TYPE,\n                s.COLUMN_NAME\n        from\n                information_schema.TABLE_CONSTRAINTS as tc\n        LEFT JOIN information_schema.STATISTICS as s ON\n                s.table_schema = tc.CONSTRAINT_SCHEMA\n                and s.TABLE_NAME = tc.TABLE_NAME\n                and s.INDEX_NAME = tc.CONSTRAINT_NAME\n        where\n                tc.CONSTRAINT_SCHEMA = ?\n                and s.TABLE_NAME = ?\n) ct on\nc.TABLE_SCHEMA = ct.CONSTRAINT_SCHEMA\nAND c.TABLE_NAME = ct.TABLE_NAME\nAND c.COLUMN_NAME = ct.COLUMN_NAME\nWHERE\nc.table_schema = ?\nand c.TABLE_NAME = ?\nORDER BY\nc.table_name,\nc.ordinal_position";t.default={columnList:{55:{sql:a,paramsHints:["databaseName","tn","databaseName","tn"]},56:{sql:a,paramsHints:["databaseName","tn","databaseName","tn"]},default:{sql:"SELECT\n      c.table_name as tn,\n      c.column_name as cn,\n      c.data_type as dt,\n      c.column_type as ct,\n      c.character_maximum_length as clen,\n      c.numeric_precision as np,\n      c.numeric_scale as ns,\n      c.datetime_precision as dp,\n      c.ordinal_position as cop,\n      c.column_key as ck,\n      c.extra as ext, -- gives ai\n      c.column_default as cdf,\n      c.is_nullable as nrqd,\n      c.privileges as priv,\n      c.column_comment as cc,\n--       c.generation_expression,\n      c.character_set_name as csn,\n      c.collation_name as clnn,\n      ct.CONSTRAINT_TYPE as cst\n     FROM\n      information_schema.COLUMNS as c\n    Left join(\n              select\n                      tc.CONSTRAINT_NAME,\n                      tc.TABLE_NAME,\n                      tc.CONSTRAINT_SCHEMA,\n                      tc.CONSTRAINT_TYPE,\n                      s.COLUMN_NAME\n              from\n                      information_schema.TABLE_CONSTRAINTS as tc\n              LEFT JOIN information_schema.STATISTICS as s ON\n                      s.table_schema = tc.CONSTRAINT_SCHEMA\n                      and s.TABLE_NAME = tc.TABLE_NAME\n                      and s.INDEX_NAME = tc.CONSTRAINT_NAME\n                      and tc.CONSTRAINT_TYPE != 'UNIQUE'\n                      and tc.CONSTRAINT_TYPE != 'FOREIGN KEY'\n              where\n                      tc.CONSTRAINT_SCHEMA = ?\n                      and s.TABLE_NAME = ?\n      ) ct on\n      c.TABLE_SCHEMA = ct.CONSTRAINT_SCHEMA\n      AND c.TABLE_NAME = ct.TABLE_NAME\n      AND c.COLUMN_NAME = ct.COLUMN_NAME\n    WHERE\n      c.table_schema = ?\n      and c.TABLE_NAME = ?\n    ORDER BY\n      c.table_name,\n      c.ordinal_position",paramsHints:["databaseName","tn","databaseName","tn"]}},constraintList:{default:{sql:"SELECT\n      k.constraint_name as cstn,\n      k.column_name as cn,\n      k.ordinal_position as op,\n      k.position_in_unique_constraint as puc,\n      t.constraint_type as cst\nFROM information_schema.table_constraints t\nLEFT JOIN information_schema.key_column_usage k\nUSING(constraint_name,table_schema,table_name)\nWHERE\nt.table_schema=?\nAND t.table_name=?;",paramsHints:["database","tn"]}},createDatabaseIfNotExists:{default:{sql:"create database if not exists ??  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci",paramsHints:["database"]}},createTableIfNotExists:{default:{sql:"",paramsHints:[]}},dropDatabase:{default:{sql:"drop database ??",paramsHints:["database"]}},databaseList:{default:{sql:"SHOW databases",paramsHints:[]}},hasDatabase:{default:{sql:"SHOW DATABASES LIKE ?",paramsHints:["databaseName"]}},indexList:{default:{sql:"show index from ??",paramsHints:["tn"]}},functionList:{default:{sql:"show function status where db=?",paramsHints:["databaseName"]}},functionRead:{default:{sql:"SHOW CREATE FUNCTION ??",paramsHints:["function_name"]}},functionDelete:{default:{sql:"DROP FUNCTION IF EXISTS ??",paramsHints:["function_name"]}},procedureList:{default:{sql:"show procedure status where db=?",paramsHints:["databaseName"]}},procedureRead:{default:{sql:"show create procedure ??",paramsHints:["procedure_name"]}},procedureDelete:{default:{sql:"DROP PROCEDURE IF EXISTS ??",paramsHints:["procedure_name"]}},relationList:{default:{sql:"SELECT\n      kcu.CONSTRAINT_NAME as cstn,\n      kcu.TABLE_NAME as tn,\n      kcu.COLUMN_NAME as cn,\n      kcu.POSITION_IN_UNIQUE_CONSTRAINT as puc,\n      kcu.REFERENCED_TABLE_NAME as rtn,\n      kcu.REFERENCED_COLUMN_NAME as rcn,\n      rc.MATCH_OPTION as mo,\n      rc.UPDATE_RULE as ur,\n      rc.DELETE_RULE as dr,\n      kcu.table_schema as ts\n    FROM\n      information_schema.KEY_COLUMN_USAGE AS kcu\n    INNER JOIN information_schema.REFERENTIAL_CONSTRAINTS AS rc ON\n      kcu.CONSTRAINT_NAME = rc.CONSTRAINT_NAME\n    Group by\n      kcu.CONSTRAINT_NAME,\n      kcu.TABLE_NAME,\n      kcu.COLUMN_NAME,\n      kcu.POSITION_IN_UNIQUE_CONSTRAINT,\n      kcu.REFERENCED_TABLE_NAME,\n      kcu.REFERENCED_COLUMN_NAME,\n      rc.MATCH_OPTION,\n      rc.UPDATE_RULE,\n      rc.DELETE_RULE ,\n      kcu.table_schema\n    Having\n      kcu.table_schema = ?\n      AND kcu.referenced_column_name IS NOT NULL\n      AND kcu.table_name =?",paramsHints:["database","tn"]}},relationListAll:{default:{sql:"SELECT\n      kcu.constraint_name AS cstn,\n      kcu.table_name AS tn,\n      kcu.column_name AS cn,\n      kcu.position_in_unique_constraint AS puc,\n      kcu.referenced_table_name AS rtn,\n      kcu.referenced_column_name AS rcn,\n      rc.match_option AS mo,\n      rc.update_rule AS ur,\n      rc.delete_rule AS dr,\n      kcu.table_schema AS ts\n    FROM\n      (\n      SELECT\n        table_schema,\n        constraint_name,\n        table_name,\n        column_name,\n        position_in_unique_constraint,\n        referenced_table_name,\n        referenced_column_name\n      FROM\n        information_schema.KEY_COLUMN_USAGE\n      WHERE\n        table_schema = :databaseName) AS kcu\n    INNER JOIN\n              (\n      SELECT\n        constraint_schema,\n        match_option,\n        update_rule,\n        delete_rule,\n        constraint_name\n      FROM\n        information_schema.REFERENTIAL_CONSTRAINTS\n      WHERE\n        constraint_schema = :databaseName) AS rc ON\n      kcu.constraint_name = rc.constraint_name\n      AND kcu.table_schema = rc.constraint_schema\n    INNER JOIN\n              (\n      SELECT\n        table_schema,\n        table_name,\n        column_name\n      FROM\n        information_schema.COLUMNS\n      WHERE\n        table_schema = :databaseName\n        AND table_name IN (\n        SELECT\n          table_name\n        FROM\n          information_schema.TABLES\n        WHERE\n          table_schema = :databaseName\n          AND Lower(table_type) = 'base table')) AS col ON\n      col.table_schema = kcu.table_schema\n      AND col.table_name = kcu.table_name\n      AND kcu.referenced_column_name IS NOT NULL\n    GROUP BY\n      cstn ,\n      tn ,\n      rcn ,\n      cn ,\n      puc ,\n      rtn ,\n      cn,\n      mo ,\n      ur ,\n      dr ,\n      ts",paramsHints:["database"]}},schemaCreate:{default:{sql:"create database ??",paramsHints:["database_name"]}},schemaDelete:{default:{sql:"drop database ??",paramsHints:["database_name"]}},triggerList:{default:{sql:"SHOW TRIGGERS like ?",paramsHints:["tn"]}},tableList:{default:{sql:"",paramsHints:[]}},testConnection:{default:{sql:"",paramsHints:[]}},triggerRead:{default:{sql:"SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",paramsHints:["databaseName"]}},triggerDelete:{default:{sql:"DROP TRIGGER ??",paramsHints:["trigger_name"]}},version:{default:{sql:"",paramsHints:[]}},viewRead:{default:{sql:"select * FROM INFORMATION_SCHEMA.VIEWS WHERE\n       TABLE_SCHEMA = ? AND TABLE_NAME = ?",paramsHints:["databaseName","view_name"]}},viewList:{default:{sql:"SHOW FULL TABLES WHERE TABLE_TYPE LIKE 'VIEW'",paramsHints:[]}}}},18928:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(50536)),r=i(a(96964)),l=i(a(72208)),c=i(a(69643)),d=i(a(98152)),u=i(a(58108)),p=new d.default("OracleClient");class OracleClient extends c.default{constructor(e){super(e)}getKnexDataTypes(){const e=new u.default;return e.data.list=["bfile","binary rowid","binary double","binary_float","blob","canoical","cfile","char","clob","content pointer","contigous array","date","decimal","double precision","float","integer","interval day to second","interval year to month","lob pointer","long","long raw","named collection","named object","nchar","nclob","number","nvarchar2","octet","oid","pointer","raw","real","ref","ref cursor","rowid","signed binary integer","smallint","table","time","time with tz","timestamp","timestamp with local time zone","timestamp with local tz","timestamp with timezone","timestamp with tz","unsigned binary integer","urowid","varchar","varchar2","varray","varying array"],e}async testConnection(e={}){const t=this.testConnection.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.raw('SELECT 1+1 AS "data" FROM DUAL')}catch(e){p.ppe(e),a.code=-1,a.message=e.message}finally{p.api(`${t}:result:`,a)}return a}async version(e={}){const t=this.version.name,a=new u.default;p.api(`${t}:args:`,e);try{const e=await this.raw("SELECT * FROM PRODUCT_COMPONENT_VERSION WHERE product LIKE 'Oracle%'");a.data.object={};let t=e[0];t=(0,r.default)(t,((e,t)=>t.toLowerCase()));const i=t.version.split(".");a.data.object.version=t.version,a.data.object.primary=i[0],a.data.object.major=i[1],a.data.object.minor=i[2]}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async createDatabaseIfNotExists(e={}){const t=this.createDatabaseIfNotExists.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));t.connection.database="xe",t.connection.user="system",t.connection.password="oracle";const a=(0,s.default)(t);p.debug("checking if db exists");0===(await a.raw(`select USERNAME from SYS.ALL_USERS WHERE USERNAME = '${this.connectionConfig.connection.user}'`)).length&&(p.debug("creating database:",e),await a.raw(`CREATE USER ${this.connectionConfig.connection.user} IDENTIFIED BY ${this.connectionConfig.connection.user}`),await a.raw(`GRANT ALL PRIVILEGES TO ${this.connectionConfig.connection.user}`),await a.raw(`GRANT EXECUTE ON DBMS_AQ TO ${this.connectionConfig.connection.user}`),await a.raw(`GRANT EXECUTE ON DBMS_AQADM TO ${this.connectionConfig.connection.user}`)),await a.destroy(),this.sqlClient=(0,s.default)(this.connectionConfig)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async dropDatabase(e){const t=this.dropDatabase.name,a=new u.default;p.api(`${t}:args:`,e);try{const e=JSON.parse(JSON.stringify(this.connectionConfig));e.connection.database="xe",e.connection.user="system",e.connection.password="oracle";const t=(0,s.default)(e);await this.sqlClient.destroy(),p.debug("dropping database:",this.connectionConfig.connection.user);const a=await t.raw(`select SID,SERIAL# from v$session where username =  '${this.connectionConfig.connection.user}'\n      `);p.debug(`Active Sessions for ${this.connectionConfig.connection.user}: `,a);for(let e=0;e<a.length;e++){const i=a[e];await t.raw(`alter system kill session '${i.SID},${i["SERIAL#"]}' immediate`)}await t.raw(`drop user ${this.connectionConfig.connection.user} cascade`),p.debug("dropped database:",this.connectionConfig.connection.user)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async createTableIfNotExists(e){const t=this.createTableIfNotExists.name,a=new u.default;p.api(`${t}:args:`,e);try{(await this.hasTable({tn:e.tn})).data.value?p.debug(`${e.tn} tables exists`):(await this.sqlClient.schema.createTable(e.tn,(function(e){e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})),p.debug("Table created:",`${e.tn}`))}catch(e){if(p.ppe(e,t),!(JSON.stringify(e.message).indexOf("exact fetch returns more than requested number of rows")>-1))throw e;p.warn("safely ignored Exception:exact fetch returns more than requested number of rows knex create table issue")}return p.api(`${t}: result`,a),a}async hasTable(e={}){const t=this.hasTable.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=await this.raw(`select TABLE_NAME as tn FROM all_tables WHERE OWNER = '${this.connectionConfig.connection.user}' AND tn = '${e.tn}'`);a.data.value=t.length>0}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async hasDatabase(e={}){const t=this.hasDatabase.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=await this.raw(`select USERNAME from SYS.ALL_USERS WHERE USERNAME = '${e.databaseName}'`);a.data.value=t.length>0}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new u.default;p.api(`${t}:args:`,e);try{const e=await this.raw('select USERNAME as "database_name" from SYS.ALL_USERS order by USERNAME');a.data.list=e}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async tableList(e={}){const t=this.tableList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`select table_name FROM all_tables WHERE owner='${e.databaseName}'`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name,a=new u.default;p.api(`${t}:args:`,e);try{const e=await this.raw("SELECT username AS schema_name\n                          FROM dba_users u\n                         WHERE ACCOUNT_STATUS = 'OPEN' AND EXISTS (\n                            SELECT 1\n                              FROM dba_objects o\n                             WHERE o.owner = u.username )\n                           AND default_tablespace not in ('SYSTEM','SYSAUX') ");for(let t=0;t<e.length;t++){let a=e[t];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),e[t]=a}a.data.list=e}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async columnList(e={}){const t=this.columnList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT\n      seq.sequence_name,\n      CASE\n        WHEN seq.sequence_name IS NOT NULL\n        AND p.constraint_type = 'P' THEN 1\n        ELSE 0\n      END as ai,\n      c.table_name as tn,\n      c.column_name AS cn,\n      c.column_id AS cop,\n      p.constraint_type AS ck,\n      c.NULLABLE AS nrqd,\n      c.DATA_TYPE AS dt,\n      c.DATA_LENGTH,\n      c.DATA_PRECISION,\n      c.DEFAULT_LENGTH,\n      c.DATA_DEFAULT AS cdf,\n      c.character_set_name as csn,\n      c.CHAR_LENGTH AS clen,\n      -- c.DEFAULT_ON_NULL,\n      c.LOW_VALUE,\n      c.HIGH_VALUE,\n      c.DATA_SCALE AS ns,\n      p.constraint_name AS pk_constraint_name,\n      p.POSITION AS p_con_ordinal_position\n    FROM\n      SYS.ALL_TAB_COLS c\n    LEFT JOIN(\n        SELECT\n          a.table_name,\n          a.column_name,\n          a.constraint_name,\n          c.constraint_type,\n          a.position,\n          c_pk.table_name r_table_name,\n          c_pk.constraint_name r_pk,\n          cc_pk.column_name r_column_name\n        FROM\n          all_cons_columns a\n        JOIN all_constraints c ON\n          (\n            a.owner = c.owner\n            AND a.constraint_name = c.constraint_name\n          )\n        LEFT JOIN all_constraints c_pk ON\n          (\n            c.r_owner = c_pk.owner\n            AND c.r_constraint_name = c_pk.constraint_name\n          )\n        LEFT JOIN all_cons_columns cc_pk ON\n          (\n            cc_pk.owner = c_pk.owner\n            AND cc_pk.constraint_name = c_pk.constraint_name\n          )\n        WHERE\n          a.owner = '${e.databaseName}'\n          AND c.constraint_type = 'P'\n      ) p ON\n      c.table_name = p.table_name\n      AND c.column_name = p.column_name\n    LEFT OUTER JOIN(\n        SELECT\n          t.table_name,\n          d.referenced_name AS sequence_name,\n          d.REFERENCED_OWNER AS OWNER,\n          c.COLUMN_NAME\n        FROM\n          user_trigger_cols t,\n          user_dependencies d,\n          user_tab_cols c\n        WHERE\n          d.name = t.trigger_name\n          AND t.TABLE_NAME = c.TABLE_NAME\n          AND t.COLUMN_NAME = c.COLUMN_NAME\n          AND d.referenced_type = 'SEQUENCE'\n          AND d.type = 'TRIGGER'\n      ) seq ON\n      c.table_name = seq.table_name\n      AND c.column_name = seq.column_name\n    WHERE\n      c.owner = '${e.databaseName}' AND  c.table_name = '${e.tn}'\n    ORDER BY\n      c.table_name,\n      c.column_id,\n      c.column_name`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.np=a.data_precision,a.pk="P"===a.ck,a.nrqd="Y"===a.nrqd,a.not_nullable="N"===a.nrqd,a.ai=1===a.ai,a.cno=a.cn,a.dtxp=a.clen||a.np,a.dtxs=a.ns,a.au=!1,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`select ind_col.COLUMN_POSITION AS postion, ind.index_name as key_name,\n        ind_col.column_name as cn,\n        ind.index_type,\n        ind.uniqueness,\n        ind.table_owner as schema_name,\n        ind.table_name as tn,\n        ind.table_type as table_type\n        from sys.all_indexes ind\n        inner join sys.all_ind_columns ind_col on ind.owner = ind_col.index_owner\n        and ind.index_name = ind_col.index_name\n        where ind.owner = '${e.databaseName}'  AND ind.table_name  = '${e.tn}'\n        order by ind.table_owner, ind.table_name, ind.index_name, ind_col.column_position`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.table=a.tn,a.non_unique="NONUNIQUE"===a.uniqueness?1:0,a.non_unique_original="NONUNIQUE"===a.uniqueness?1:0,a.seq_in_index=a.postion,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async constraintList(e={}){const t=this.constraintList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT cols.table_name as tn, cols.column_name as cn, cols.position, cons.*\n        FROM all_constraints cons, all_cons_columns cols\n        WHERE cols.table_name = '${e.tn}' AND cols.owner = '${e.databaseName}'\n        AND cons.constraint_type in ('P','R','U') AND cons.constraint_name = cols.constraint_name\n        AND cons.owner = cols.owner ORDER BY cons.constraint_name, cols.position`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.table=a.tn,"P"===a.cst&&(a.cst="Primary Key"),"U"===a.cst&&(a.cst="Unique"),"R"===a.cst&&(a.cst="Foreign Key"),a.op=a.position,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT\n        a.table_name as tn,\n        a.column_name as cn,\n        a.constraint_name cstn,\n        c.constraint_type cst,\n        a.position,\n        c_pk.table_name r_table_name,\n        c_pk.constraint_name r_pk,\n        cc_pk.column_name r_column_name,\n        c.delete_rule dr\n      FROM\n        all_cons_columns a\n      JOIN all_constraints c ON\n        (\ta.owner = c.owner\n          AND a.constraint_name = c.constraint_name )\n      LEFT JOIN all_constraints c_pk ON\n        (\tc.r_owner = c_pk.owner\n          AND c.r_constraint_name = c_pk.constraint_name )\n      LEFT JOIN all_cons_columns cc_pk ON\n        (\tcc_pk.owner = c_pk.owner\n          AND cc_pk.constraint_name = c_pk.constraint_name )\n      WHERE  a.owner = '${e.databaseName}'\n        AND c.constraint_type = 'R'\n\n      `);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.rtn=a.r_table_name,a.rcn=a.r_column_name,a.non_unique="NONUNIQUE"===a.uniqueness,a.puc=a.position,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT\n        a.table_name as tn,\n        a.column_name as cn,\n        a.constraint_name cstn,\n        c.constraint_type cst,\n        a.position puc,\n        c_pk.table_name r_table_name,\n        c_pk.constraint_name r_pk,\n        cc_pk.column_name r_column_name,\n        c.delete_rule dr\n      FROM\n        all_cons_columns a\n      JOIN all_constraints c ON\n        (\ta.owner = c.owner\n          AND a.constraint_name = c.constraint_name )\n      LEFT JOIN all_constraints c_pk ON\n        (\tc.r_owner = c_pk.owner\n          AND c.r_constraint_name = c_pk.constraint_name )\n      LEFT JOIN all_cons_columns cc_pk ON\n        (\tcc_pk.owner = c_pk.owner\n          AND cc_pk.constraint_name = c_pk.constraint_name )\n      WHERE  a.owner = '${e.databaseName}'\n        AND c.constraint_type = 'R'\n\n      `);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.rtn=a.r_table_name,a.rcn=a.r_column_name,a.non_unique="NONUNIQUE"===a.uniqueness,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.sqlClient.raw(`select owner as trigger_schema_name, trigger_name, trigger_type,\n      triggering_event, table_owner as schema_name, table_name as object_name, base_object_type as object_type,\n      status, trigger_body as script     from sys.all_triggers\n      -- excluding some Oracle maintained schemas\n      where owner = '${e.databaseName}' order by trigger_name, table_owner, table_name, base_object_type`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.trigger=a.trigger_name,a.table=a.object_name,a.event=a.triggering_event,a.timing=a.trigger_type,a.statement=a.script,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT *  FROM ALL_OBJECTS WHERE owner = '${e.databaseName}' and OBJECT_TYPE IN ('FUNCTION','PROCEDURE','PACKAGE')`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.function_name=a.object_name,a.type=a.object_type,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT *  FROM ALL_OBJECTS WHERE owner = '${e.databaseName}' and OBJECT_TYPE IN ('FUNCTION','PROCEDURE','PACKAGE')`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.procedure_name=a.object_name,a.type=a.object_type,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_views WHERE owner='${e.databaseName}'`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.view_name=a.object_name,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_source  WHERE TYPE = 'FUNCTION' AND OWNER = '${e.databaseName}' AND NAME = '${e.function_name}' ORDER BY line`),i=[];if(t.length>0){let e="";for(let a=0;a<t.length;a++){let i=t[a];i=(0,r.default)(i,((e,t)=>t.toLowerCase())),i.function_name=i.name,t[a]=i,e+=i.text}t[0].create_function=e,i.push(t[0])}a.data.list=i}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_source  WHERE TYPE = 'PROCEDURE' AND OWNER = '${e.databaseName}' AND NAME = '${e.procedure_name}' ORDER BY line`),i=[];if(t.length>0){let e="";for(let a=0;a<t.length;a++){let i=t[a];i=(0,r.default)(i,((e,t)=>t.toLowerCase())),i.procedure_name=i.name,t[a]=i,e+=i.text}t[0].create_procedure=e,i.push(t[0])}a.data.list=i}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_views WHERE owner='${e.databaseName}' and view_name='${e.view_name}'`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.view_name=a.object_name,a.view_definition=a.text,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new u.default;p.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.sqlClient.raw(`select owner as trigger_schema_name, trigger_name, trigger_type,\n      triggering_event, table_owner as schema_name, table_name as object_name,\n      base_object_type as object_type, status, trigger_body as script from sys.all_triggers\n      -- excluding some Oracle maintained schemas\n      where owner = '${e.databaseName}' and trigger_name = '${e.trigger_name}' order by trigger_name, table_owner, table_name, base_object_type`);if(!t[0])return[];for(let e=0;e<t.length;e++){let a=t[e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.trigger=a.trigger_name,a.table=a.object_name,a.event=a.triggering_event,a.timing=a.trigger_type,a.trigger_definition=a.script,t[e]=a}a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.raw(`create database ${e.database_name}`)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async schemaDelete(e={}){const t=this.schemaDelete.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.raw(`drop database ${e.database_name}`)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.raw(`DROP TRIGGER IF EXISTS ${e.trigger_name}`)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.raw(`DROP PROCEDURE IF EXISTS ${e.procedure_name}`)}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async functionCreate(e={}){const t=this.functionCreate.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.function_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.function_name}`);const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.function_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.procedure_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.procedure_name}`);const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.procedure_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`DROP TRIGGER ${e.trigger_name}`}}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new u.default;p.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.trigger_name}`),await this.sqlClient.raw(`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`),a.data.object={upStatement:`DROP TRIGGER ${e.trigger_name};\nCREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`,downStatement:`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.oldStatement}`}}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=`CREATE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`DROP VIEW ${e.view_name}`}}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=`CREATE OR REPLACE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new u.default;p.api(`${t}:args:`,e);try{const t=`DROP VIEW ${e.view_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}}catch(e){throw p.ppe(e,t),e}return p.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new u.default;p.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=h(e.tn,e);await this.sqlClient.raw(t);const i=this.sqlClient.schema.dropTable(e.table).toSQL();this.emit(`Success : ${t}`),a.data.object={upStatement:[{sql:t}],downStatement:i}}catch(e){throw p.ppe(e,t),e}return a}async tableUpdate(e){const t=this.tableUpdate.name,a=new u.default;p.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",s="";for(let a=0;a<e.columns.length;++a){const r=(0,l.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=m(e.table,e.columns[a],r),s+=_(e.table,r,e.columns[a],s)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=f(e.table,e.columns[a],r,i),s+=f(e.table,r,e.columns[a],s)):1&e.columns[a].altered&&(i+=_(e.table,e.columns[a],r,i),s+=m(e.table,e.columns[a],r))}await this.sqlClient.raw(i),console.log(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:s}]}}catch(e){throw p.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new u.default;p.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.sqlClient.schema.dropTable(e.tn).toSQL(),i=h(e.tn,e);this.emit(`Success : ${t}`),await this.sqlClient.schema.dropTable(e.tn),a.data.object={upStatement:t,downStatement:[{sql:i}]}}catch(e){throw p.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name,a=new u.default;p.api(`${t}:args:`,e);try{a.data=";";const t=await this.sqlClient.raw(`show create table ${e.tn};`);2===t.length&&(a.data=t[0][0]["Create Table"])}catch(e){throw p.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new u.default;p.api(`${t}:args:`,e);try{let t=" VALUES (";a.data=`INSERT INTO \`${e.tn}\` (`;const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n\`${i.data.list[e].cn}\`\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw p.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new u.default;p.api(`${t}:args:`,e);try{a.data=`UPDATE \`${e.tn}\` \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`:`\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw p.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new u.default;p.api(`${t}:args:`,e);try{a.data=`DELETE FROM ${e.tn};`}catch(e){throw p.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new u.default;p.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE ${e.tn};`}catch(e){throw p.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new u.default;p.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM ${e.tn};`}catch(e){throw p.ppe(e,t),e}return a}async totalRecords(e={}){this.totalRecords.name;throw new Error("Function not supported for oracle yet")}}function m(e,t,a){let i=a?",":"";return i+=` DROP COLUMN \`${e.cn}\``,i}function _(e,t,a,i){return g(e,t,a,i,1)}function f(e,t,a,i){return g(e,t,a,i,2)}function h(e,t){let a="";for(let r=0;r<t.columns.length;++r)a+=(i=e,s=t.columns[r],g(i,s,null,a,0));var i,s;return a+=function(e,t,a,i=!1){const s=[],r=[];let l=0;for(let t=0;t<e.length;++t)e[t].pk&&4!==e[t].altered&&r.push(e[t].cn);for(let e=0;e<t.length;++e)t[e].pk&&s.push(t[e].cn);if(r.length===s.length){for(let e=0;e<r.length;++e)if(s[e]!==r[e]){l=1;break}}else l=r.length-s.length;let c="";return(r.length||s.length)&&l&&(c+=s.length?",DROP PRIMARY KEY":"",r.length&&(c+=i?`, PRIMARY KEY(${r.join(",")})`:`, ADD PRIMARY KEY(${r.join(",")})`)),c}(t.columns,[],0,!0),a=`CREATE TABLE ${t.tn} (`+a+")",a}function g(e,t,a,i,s=2){const r=parseInt(t.dtxs)?parseInt(t.dtxs):null;let l=i?",":"";const c=function(e){if(void 0===e.cdf||null===e.cdf)return e.cdf;switch(e.dt){case"bfile":case"binary rowid":case"binary double":case"binary_float":case"blob":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"date":case"decimal":case"double precision":case"float":case"integer":case"interval day to second":case"interval year to month":case"lob pointer":case"long":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"number":case"nvarchar2":case"octet":case"oid":case"pointer":case"raw":case"real":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"smallint":case"table":case"time":case"time with tz":case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return e.cdf}}(t);return 0===s?(t.ai?(t.dt,l+=` ${t.cn} serial`):l+=` ${t.cn} ${t.dt}`,l+=t.dtxp&&" "!==t.dtxp?`(${t.dtxp}`:"",l+=r?`,${r}`:"",l+=t.dtxp&&" "!==t.dtxp?")":"",l+=t.rqd?" NOT NULL":" NULL",l+=c?` DEFAULT ${c}`:""):1===s?(l+=` ADD  ${t.cn} ${t.dt}`,l+=t.rqd?" NOT NULL":" NULL",l+=c?` DEFAULT ${c}`:" ",l=`ALTER TABLE ${e} ${l};`):(t.cn!==a.cno&&(l+=`\nALTER TABLE ${e} RENAME COLUMN ${t.cno} TO ${t.cn};\n`),t.dt!==a.dt&&(l+=`\nALTER TABLE ${e} ALTER COLUMN ${t.cn} TYPE ${t.dt};\n`),t.rqd!==a.rqd&&(l+=`\nALTER TABLE ${e} ALTER COLUMN ${t.cn} `,l+=t.rqd?" SET NOT NULL;\n":" DROP NOT NULL;\n"),t.cdf!==a.cdf&&(l+=`\nALTER TABLE ${e} ALTER COLUMN ${t.cn} `,l+=t.cdf?` SET DEFAULT ${t.cdf};\n`:" DROP DEFAULT;\n")),l}t.default=OracleClient},10416:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(92080),r=i(a(50536)),l=i(a(90922)),c=i(a(96964)),d=i(a(72208)),u=a(71040),p=i(a(69643)),m=i(a(98152)),_=i(a(58108)),f=i(a(4744)),h=a(90868),g=i(a(4744)),y=new m.default("PGClient");class PGClient extends p.default{constructor(e){super(e),this.queries=f.default,this._version={}}async schemaCreateWithCredentials(e){const t=this.schemaCreateWithCredentials.name,a=new _.default;y.api(`${t}:args:`,e);try{e.schema||(e.schema=`nc${(0,s.nanoid)(8)}`),e.user||(e.user=`nc${(0,s.nanoid)(8)}`),e.password||(e.password=(0,s.nanoid)(16));const t=await this.sqlClient.raw("create database ?",[e.schema]);await this.sqlClient.raw("create user ? with encrypted password ?",[e.user,e.password]),await this.sqlClient.raw("grant all privileges on database ?? to ?",[e.schema,e.user]),y.debug("Create database if not exists",t),a.object=e}catch(e){a.code=-1,a.message=e.message,a.object=e}return a}async sequenceDelete(e={}){const t=this.sequenceDelete.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=`${this.querySeparator()}DROP SEQUENCE ${this.genIdentifier(e.sequence_name)}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:`${this.querySeparator()}CREATE SEQUENCE ${this.genIdentifier(e.sequence_name)}`}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async sequenceList(e={}){const t=this.sequenceList.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.raw("select *\n              from INFORMATION_SCHEMA.sequences;");a.data.list=t.map((e=>Object.assign(Object.assign({},e),{original_sequence_name:e.sequence_name})))}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async sequenceCreate(e={}){const t=this.sequenceCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE SEQUENCE ${this.genIdentifier(e.sequence_name)}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP SEQUENCE ${this.genIdentifier(e.sequence_name)}`}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async sequenceUpdate(e={}){const t=this.sequenceUpdate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+`ALTER SEQUENCE ${this.genIdentifier(e.original_sequence_name)} RENAME TO ${this.genIdentifier(e.sequence_name)};`,i=this.querySeparator()+`ALTER SEQUENCE ${this.genIdentifier(e.sequence_name)} RENAME TO ${this.genIdentifier(e.original_sequence_name)};`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async testConnection(e={}){const t=this.testConnection.name,a=new _.default;y.api(`${t}:args:`,e);try{await this.raw("SELECT 1+1 as data")}catch(e){const t=JSON.parse(JSON.stringify(this.connectionConfig));t.connection.database="postgres";const i=(0,r.default)(Object.assign(Object.assign({},t),{pool:{min:0,max:1}}));try{await i.raw("SELECT 1+1 as data"),await i.destroy()}catch(t){/^database "[\w\d_]+" does not exist$/.test(t.message)||(y.ppe(t),a.code=-1,a.message=e.message)}}finally{y.api(`${t}:result:`,a)}return a}getKnexDataTypes(){const e=new _.default;return e.data.list=["int","integer","bigint","bigserial","char","int2","int4","int8","int4range","int8range","serial","serial2","serial8","character","bit","bool","boolean","date","double precision","event_trigger","fdw_handler","float4","float8","uuid","smallint","smallserial","character varying","text","real","time","time without time zone","timestamp","timestamp without time zone","timestamptz","timestamp with time zone","timetz","time with time zone","daterange","json","jsonb","gtsvector","index_am_handler","anyenum","anynonarray","anyrange","box","bpchar","bytea","cid","cidr","circle","cstring","inet","internal","interval","language_handler","line","lsec","macaddr","money","name","numeric","numrange","oid","opaque","path","pg_ddl_command","pg_lsn","pg_node_tree","point","polygon","record","refcursor","regclass","regconfig","regdictionary","regnamespace","regoper","regoperator","regproc","regpreocedure","regrole","regtype","reltime","smgr","tid","tinterval","trigger","tsm_handler","tsquery","tsrange","tstzrange","tsvector","txid_snapshot","unknown","void","xid","xml"],e}async version(e={}){const t=this.version.name,a=new _.default;y.api(`${t}:args:`,e);try{a.data.object={};const e=await this.sqlClient.raw("SHOW server_version");y.debug(e.rows[0]),a.data.object.version=e.rows[0].server_version;const t=e.rows[0].server_version.split(".");!t.length||3!==t.length&&2!==t.length?(a.code=-1,a.message=`Invalid version : ${e.rows[0].server_version}`):(a.data.object.primary=t[0],a.data.object.major=t[1],a.data.object.minor=t.length>2?t[2]:t[1],a.data.object.key=t[0]+t[1])}catch(e){y.ppe(e),a.code=-1,a.message=e.message}finally{y.api(`${t} :result: %o`,a)}return a}async createDatabaseIfNotExists(e={}){var t;const a=this.createDatabaseIfNotExists.name,i=new _.default;let s;y.api(`${a}:args:`,e);try{const a=JSON.parse(JSON.stringify(this.connectionConfig));let i=[];try{a.connection.database="postgres",s=(0,r.default)(Object.assign(Object.assign({},a),{pool:{min:0,max:1}})),y.debug("checking if db exists"),i=(await s.raw("SELECT datname as database FROM pg_database WHERE datistemplate = false and datname = ?",[e.database])).rows}catch(t){y.debug("checking if db exists"),i=(await this.sqlClient.raw("SELECT datname as database FROM pg_database WHERE datistemplate = false and datname = ?",[e.database])).rows}0===i.length&&(y.debug("creating database:",e),await s.raw("CREATE DATABASE ?? ENCODING 'UTF8'",[e.database]));const l=this.getEffectiveSchema(e);!!(null===(t=(await this.sqlClient.raw("SELECT schema_name FROM information_schema.schemata WHERE schema_name = ?",[l])).rows)||void 0===t?void 0:t[0])||await this.sqlClient.raw("CREATE SCHEMA IF NOT EXISTS ??  AUTHORIZATION ?? ",[l,this.connectionConfig.connection.user])}catch(e){throw y.ppe(e,a),e}finally{s&&await s.destroy()}return y.api(`${a}: result`,i),i}getEffectiveSchema(e={}){return(null==e?void 0:e.schema)||this.schema}async dropDatabase(e){const t=this.dropDatabase.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));t.connection.database="postgres";const a=(0,r.default)(Object.assign(Object.assign({},t),{pool:{min:0,max:1}}));await this.sqlClient.destroy(),this.sqlClient=a,await a.raw("ALTER DATABASE ?? WITH CONNECTION LIMIT 0;\n      SELECT pg_terminate_backend(sa.pid) FROM pg_stat_activity sa WHERE\n      sa.pid <> pg_backend_pid() AND sa.datname = ?;",[e.database,e.database]),y.debug("dropping database:",e),await a.raw("DROP DATABASE ??;",[e.database]),await a.destroy()}catch(e){y.ppe(e,t)}return y.api(`${t}: result`,a),a}async createTableIfNotExists(e){const t=this.createTableIfNotExists.name,a=new _.default;y.api(`${t}:args:`,e);try{if(0===(await this.sqlClient.raw("SELECT table_schema,table_name as tn, table_catalog FROM information_schema.tables where table_schema=? and\n         table_name = ? and table_catalog = ?",[this.getEffectiveSchema(e),e.tn,this.connectionConfig.connection.database])).rows.length){const t=await this.sqlClient.raw(this.sqlClient.schema.createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})).toQuery());y.debug("Table created:",`${e.tn}`,t)}else y.debug(`${e.tn} tables exists`)}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async hasTable(e={}){const t=this.hasTable.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT table_schema,table_name as tn, table_catalog FROM information_schema.tables where table_schema=? and table_name = ? and table_catalog = ?'",[this.getEffectiveSchema(e),e.tn,this.connectionConfig.connection.database]);a.data.value=t.length>0}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async hasDatabase(e={}){const t=this.hasDatabase.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT datname as database FROM pg_database WHERE datistemplate = false and datname = ?",[e.database]);a.data.value=t.length>0}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:e}=await this.sqlClient.raw("SELECT datname as database_name\n           FROM pg_database\n           WHERE datistemplate = false;");a.data.list=e}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async tableList(e={}){const t=this.tableList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.raw("SELECT table_schema as ts, table_name as tn,table_type\n              FROM information_schema.tables\n              where table_schema = ?\n              ORDER BY table_schema, table_name",[this.getEffectiveSchema(e)]);a.data.list=t.filter((({table_type:e})=>"base table"===e.toLowerCase()))}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:e}=await this.raw("SELECT datname as schema_name FROM pg_database\n                              WHERE \n                                  datistemplate = false \n                                      order by schema_name;");a.data.list=e}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async columnList(e={}){var t,a,i,s,r;const l=this.columnList.name,c=new _.default;y.api(`${l}:args:`,e);try{const l=null===(r=null===(s=null===(i=null===(a=null===(t=(await this.sqlClient.raw("SELECT version()")).rows[0])||void 0===t?void 0:t.version)||void 0===a?void 0:a.split(" "))||void 0===i?void 0:i[1])||void 0===s?void 0:s.split("."))||void 0===r?void 0:r[0],d=+l>=10?"c.is_identity as ii,":"";e.databaseName=this.connectionConfig.connection.database;const u=await this.sqlClient.raw(`select\n                    c.table_name as tn, c.column_name as cn, c.data_type as dt,\n                    (CASE WHEN  trg.trigger_name is NULL THEN false  else  true end) as au,\n                    pk.constraint_type as ck,\n                    c.character_maximum_length as clen,\n                    c.numeric_precision as np,\n                    c.numeric_scale as ns,\n                    c.datetime_precision as dp,\n                    c.ordinal_position as cop,\n                    c.is_nullable as nrqd,\n                    c.column_default as cdf,\n                    c.generation_expression,\n                    c.character_octet_length,\n                    c.character_set_name as csn,\n                    -- c.collation_name as clnn,\n                    pk.ordinal_position as pk_ordinal_position, pk.constraint_name as pk_constraint_name,\n                    c.udt_name,\n                    ${d}\n\n       (SELECT count(*)\n            FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc1\n                inner join INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE cu\n                    on cu.CONSTRAINT_NAME = tc1.CONSTRAINT_NAME\n            where\n                tc1.CONSTRAINT_TYPE = 'UNIQUE'\n                and tc1.TABLE_NAME = c.TABLE_NAME\n                and cu.COLUMN_NAME = c.COLUMN_NAME\n                and tc1.TABLE_SCHEMA=c.TABLE_SCHEMA) IsUnique,\n                (SELECT\n        string_agg(enumlabel, ',')\n        FROM "pg_enum" "e"\n        INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid"\n        INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace"\n        WHERE "n"."nspname" = table_schema AND "t"."typname"=udt_name\n                ) enum_values\n\n\n            from information_schema.columns c\n              left join\n                ( select kc.constraint_name, kc.table_name,kc.column_name, kc.ordinal_position,tc.constraint_type\n                  from information_schema.key_column_usage kc\n                    inner join information_schema.table_constraints as tc\n                      on kc.constraint_name = tc.constraint_name \n                      and kc.constraint_schema = tc.constraint_schema and tc.constraint_type in ('PRIMARY KEY')\n                  where kc.table_catalog = :database and kc.table_schema= :schema\n                  order by table_name,ordinal_position ) pk\n                on\n                pk.table_name = c.table_name and pk.column_name=c.column_name\n                left join information_schema.triggers trg on trg.event_object_table = c.table_name and trg.trigger_name = CONCAT('xc_trigger_' , :table::text , '_' , c.column_name)\n              where c.table_catalog=:database and c.table_schema=:schema and c.table_name=:table\n              order by c.table_name, c.ordinal_position`,{schema:this.getEffectiveSchema(e),database:e.databaseName,table:e.tn}),p=[];for(let e=0;e<u.rows.length;++e){const t={};t.tn=u.rows[e].tn,t.cn=u.rows[e].cn,t.cno=u.rows[e].cn,t.dt=u.rows[e].dt,t.np=u.rows[e].np,t.ns=u.rows[e].ns,t.clen=u.rows[e].clen,t.dp=u.rows[e].dp,t.cop=u.rows[e].cop,t.dtx=u.rows[e].dt,t.pk=null!==u.rows[e].pk_constraint_name,t.nrqd="NO"!==u.rows[e].nrqd,t.not_nullable=!t.nrqd,t.rqd=!t.nrqd,u.rows[e].ct=u.rows[e].dt||"",t.un=-1!==u.rows[e].ct.indexOf("unsigned"),t.ai=!1,u.rows[e].cdf&&(t.ai=-1!==u.rows[e].cdf.indexOf("nextval")),t.cdf=u.rows[e].cdf?u.rows[e].cdf.replace(/::[\w (),]+$/,"").replace(/^'|'$/g,""):u.rows[e].cdf,t.cc=u.rows[e].cc,t.csn=u.rows[e].csn,t.dtxp=u.rows[e].clen||u.rows[e].np||u.rows[e].dp,t.dtxs=u.rows[e].ns,t.au=u.rows[e].au,t.data_type_custom=u.rows[e].udt_name,"USER-DEFINED"===t.dt&&(t.dtxp=u.rows[e].enum_values),+l>=10&&"YES"===u.rows[e].ii&&(t.ai=!0),p.push(t)}c.data.list=p}catch(e){throw y.ppe(e,l),e}return y.api(`${l}: result`,c),c}async indexList(e={}){const t=this.indexList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT\n      f.attname AS cn,\n      i.relname as key_name,\n      ix.indnatts, ix.indkey, f.attnum as seq_in_index,\n      pg_catalog.format_type(f.atttypid,f.atttypmod) AS type,\n      f.attnotnull as rqd,\n      p.contype as cst,\n      p.conname as cstn,\n      ix.indisprimary as primarykey,\n      not ix.indisunique as non_unique_original,\n      not ix.indisunique as non_unique,\n      CASE\n          WHEN i.oid<>0 THEN true\n          ELSE false\n      END AS is_index,\n      CASE\n          WHEN f.atthasdef = 't' THEN pg_get_expr(d.adbin, d.adrelid)\n      END AS default  FROM pg_attribute f\n      JOIN pg_class c ON c.oid = f.attrelid\n      JOIN pg_type t ON t.oid = f.atttypid\n      LEFT JOIN pg_attrdef d ON d.adrelid = c.oid AND d.adnum = f.attnum\n      LEFT JOIN pg_namespace n ON n.oid = c.relnamespace\n      LEFT JOIN pg_constraint p ON p.conrelid = c.oid AND f.attnum = ANY (p.conkey)\n      LEFT JOIN pg_class AS g ON p.confrelid = g.oid\n      LEFT JOIN pg_index AS ix ON f.attnum = ANY(ix.indkey) and c.oid = f.attrelid and c.oid = ix.indrelid\n      LEFT JOIN pg_class AS i ON ix.indexrelid = i.oid\n      WHERE\n        c.relkind = 'r'::char\n      AND n.nspname = ?\n      AND c.relname = ?\n      and i.oid<>0\n      AND f.attnum > 0\n      ORDER BY i.relname, f.attnum;",[this.getEffectiveSchema(e),e.tn]);a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async relationDelete(e){const t=this.relationDelete.name,a=new _.default;y.api(`${t}:args:`,e);const i=e.foreignKeyName||null;e.childTableWithSchema=e.schema?`${e.schema}.${e.childTable}`:e.childTable,e.parentTableWithSchema=e.schema?`${e.schema}.${e.parentTable}`:e.parentTable;try{await this.sqlClient.raw(this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.dropForeign(e.childColumn,i)})).toQuery());const t=this.querySeparator()+this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.dropForeign(e.childColumn,i)})).toQuery(),s=this.querySeparator()+this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTableWithSchema)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:s}]}}catch(e){throw y.ppe(e,t),e}return a}async constraintList(e={}){const t=this.constraintList.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw('\n      SELECT c.conname AS cstn,\n          CASE\n              WHEN c.contype = \'u\' THEN \'UNIQUE\'\n          WHEN c.contype = \'p\' THEN \'PRIMARY KEY\'\n              ELSE \'FOREIGN KEY\'\n          END AS cst,\n           col.attnum,\n           sch.nspname                                   AS "schema",\n           tbl.relname                                   AS "table",\n           ARRAY_AGG(col.attname ORDER BY u.attposition) AS columns,\n           pg_get_constraintdef(c.oid)                   AS definition\n        FROM pg_constraint c\n           JOIN LATERAL UNNEST(c.conkey) WITH ORDINALITY AS u(attnum, attposition) ON TRUE\n           JOIN pg_class tbl ON tbl.oid = c.conrelid\n           JOIN pg_namespace sch ON sch.oid = tbl.relnamespace\n           JOIN pg_attribute col ON (col.attrelid = tbl.oid AND col.attnum = u.attnum)\n        where tbl.relname=?\n        GROUP BY constraint_name, col.attnum, constraint_type, "schema", "table", definition\n        ORDER BY "schema", "table"; ',[e.tn]),i=[];for(let e=0,a=0;e<t.rows.length;++e,++a)if(t.rows[e].columns=t.rows[e].columns.replace("{",""),t.rows[e].columns=t.rows[e].columns.replace("}",""),t.rows[e].columns=t.rows[e].columns.split(","),1===t.rows[e].columns.length)i[a]=t.rows[e],i[a].columns=t.rows[e].columns[0],i[a].seq_in_index=1;else{const s=t.rows[e].columns.slice();for(let r=0;r<s.length;++r,++a)i[a]=JSON.parse(JSON.stringify(t.rows[e])),i[a].columns=s[r],i[a].seq_in_index=r;a--}a.data.list=i}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT distinct\n                tc.table_schema as ts,\n                tc.constraint_name as cstn,\n                tc.table_name as tn,\n                kcu.column_name as cn,\n                ccu.table_schema AS foreign_table_schema,\n                ccu.table_name AS rtn,\n                ccu.column_name AS rcn,\n                pc.confupdtype as ur, pc.confdeltype as dr\n        FROM\n            information_schema.table_constraints AS tc\n            JOIN information_schema.key_column_usage AS kcu\n              ON tc.constraint_name = kcu.constraint_name\n              AND tc.table_schema = kcu.table_schema\n            JOIN information_schema.constraint_column_usage AS ccu\n              ON ccu.constraint_name = tc.constraint_name\n              AND ccu.table_schema = tc.table_schema\n            join (select conname,confupdtype,confdeltype from pg_catalog.pg_constraint) pc\n            on pc.conname = tc.constraint_name\n        WHERE tc.constraint_type = 'FOREIGN KEY' AND tc.table_schema=:schema and tc.table_name=:table\n        order by tc.table_name;",{schema:this.getEffectiveSchema(e),table:e.tn}),i={a:"NO ACTION",c:"CASCADE",r:"RESTRICT",n:"SET NULL",d:"SET DEFAULT"};for(const e of t)e.ur=i[e.ur],e.dr=i[e.dr];a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async relationCreate(e){const t=this.relationCreate.name,a=new _.default;y.api(`${t}:args:`,e);const i=e.foreignKeyName||null;e.childTableWithSchema=e.schema?`${e.schema}.${e.childTable}`:e.childTable,e.parentTableWithSchema=e.schema?`${e.schema}.${e.parentTable}`:e.parentTable;try{const t=this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t=t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTableWithSchema),e.onUpdate&&(t=t.onUpdate(e.onUpdate)),e.onDelete&&t.onDelete(e.onDelete)}));await this.sqlClient.raw(t.toQuery());const s=this.querySeparator()+t.toQuery();this.emit(`Success : ${s}`);const r=this.querySeparator()+this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.dropForeign(e.childColumn,i)})).toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:r}]}}catch(e){throw y.ppe(e,t),e}return a}async relationListAll(e={}){const t=this.relationList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT DISTINCT tc.table_schema as ts,\n                tc.constraint_name as cstn,\n                tc.table_name as tn,\n                kcu.column_name as cn,\n                ccu.table_schema AS foreign_table_schema,\n                ccu.table_name   AS rtn,\n                ccu.column_name  AS rcn,\n                pc.confupdtype   as ur,\n                pc.confdeltype   as dr\n         FROM information_schema.table_constraints AS tc\n                JOIN information_schema.key_column_usage AS kcu\n                     ON tc.constraint_name = kcu.constraint_name\n                       AND tc.table_schema = kcu.table_schema\n                JOIN information_schema.constraint_column_usage AS ccu\n                     ON ccu.constraint_name = tc.constraint_name\n                       AND ccu.table_schema = tc.table_schema\n                join (select conname, confupdtype, confdeltype\n                      from pg_catalog.pg_constraint) pc\n                     on pc.conname = tc.constraint_name\n         WHERE tc.constraint_type = 'FOREIGN KEY'\n           AND tc.table_schema = ?\n         order by tc.table_name;",[this.getEffectiveSchema(e)]),i={a:"NO ACTION",c:"CASCADE",r:"RESTRICT",n:"SET NULL",d:"SET DEFAULT"};for(const e of t)e.ur=i[e.ur],e.dr=i[e.dr];a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("select * from information_schema.triggers where trigger_schema=? and event_object_table=?",[this.getEffectiveSchema(e),e.tn]);for(let e=0;e<t.length;++e)t[e].statement=t[e].action_statement,t[e].table=t[e].event_object_table,t[e].trigger=t[e].trigger_name,t[e].event=t[e].event_manipulation,t[e].timing=t[e].action_timing;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("SELECT *\n              FROM pg_catalog.pg_namespace n\n                     JOIN pg_catalog.pg_proc p\n                          ON pronamespace = n.oid\n              WHERE nspname = ?;",[this.getEffectiveSchema(e)]),i=[];for(let e=0;e<t.length;++e)"prokind"in t[e]&&"p"===t[e].prokind||i.push({create_function:t[e].prosrc,function_name:t[e].proname});a.data.list=i}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new _.default;a.data.list=[],y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("SELECT *\n              FROM pg_catalog.pg_namespace n\n                     JOIN pg_catalog.pg_proc p\n                          ON pronamespace = n.oid\n              WHERE nspname = ?;",[this.getEffectiveSchema(e)]),i=[];for(let e=0;e<t.length;++e)"prokind"in t[e]&&"p"===t[e].prokind&&i.push({create_procedure:t[e].prosrc,procedure_name:t[e].proname});a.data.list=i}catch(e){}return y.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new _.default;y.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("select *\n           from INFORMATION_SCHEMA.views\n           WHERE table_schema = ?;",[this.getEffectiveSchema(e)]);for(let e=0;e<t.length;++e)t[e].view_name=t[e].tn||t[e].table_name;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("SELECT format('%I.%I(%s)', ns.nspname, p.proname, oidvectortypes(p.proargtypes)) as function_declaration, pg_get_functiondef(p.oid) as create_function\n                FROM pg_proc p INNER JOIN pg_namespace ns ON (p.pronamespace = ns.oid)\n            WHERE ns.nspname = ? and p.proname = ?;",[this.getEffectiveSchema(e),e.function_name]);for(let a=0;a<t.length;++a)t[a].function_name=e.function_name;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show create procedure ?;",[e.procedure_name]),i=[];if(2===t.length)for(let e=0;e<t[0].length;++e){let a=t[0][e];a=(0,c.default)(a,((e,t)=>t.toLowerCase())),a.create_procedure=a["create procedure"],i.push(a)}else y.debug("Unknown response for tableList:",t);a.data.list=i}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("select * from INFORMATION_SCHEMA.views WHERE table_name=? and table_schema = ANY (current_schemas(false));",[e.view_name]);for(let e=0;e<t.length;++e)t[e].view_name=t[e].tn;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new _.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",[e.databaseName]);let i=[];if(2===t.length){const a=[];for(let i=0;i<t[0].length;++i){const s=t[0][i];s.view_name=s[`Tables_in_${e.databaseName}`],a.push(s)}i=a}else y.debug("Unknown response for tableList:",t);a.data.list=i}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw("create database ??",[e.database_name])}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async schemaDelete(e={}){const t=this.schemaDelete.name,a=new _.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw("drop database ??",[e.database_name])}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.genQuery("DROP TRIGGER IF EXISTS ?? ON ??",[e.trigger_name,e.tn]);await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+this.genQuery(`CREATE TRIGGER ?? \n${e.timing} ${e.event}\nON ?? FOR EACH ROW\n${e.statement}`,[e.trigger_name,e.tn])}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new _.default;y.api(`${t}:args:`,e);const i=this.querySeparator()+`DROP FUNCTION IF EXISTS ${this.genIdentifier(e.function_declaration)}`,s=this.querySeparator()+e.create_function;try{await this.sqlClient.raw(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:s}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new _.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP PROCEDURE IF EXISTS ${this.genIdentifier(e.procedure_name)}`)}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async _getQuery(e){try{if((0,l.default)(this._version)){const t=await this.version();this._version=t.data.object,y.debug(`Version was empty for ${e.func}: population version for database as`,this._version)}return this._version.key in this.queries[e.func]?this.queries[e.func][this._version.key].sql:this.queries[e.func].default.sql}catch(e){throw y.ppe(e,this._getQuery.name),e}}async functionCreate(e={}){const t=this.functionCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+e.create_function;await this.sqlClient.raw(t);const i=await this.functionRead({function_name:e.function_name}),s=this.querySeparator()+`DROP FUNCTION IF EXISTS ${this.genIdentifier(i.data.list[0].function_declaration)}`;a.data.object={upStatement:[{sql:t}],downStatement:[{sql:s}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+e.create_function;let i=this.querySeparator()+e.oldCreateFunction;await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${this.genIdentifier(e.function_declaration)};`),await this.sqlClient.raw(t);const s=await this.functionRead({function_name:e.function_name});i=`DROP FUNCTION IF EXISTS ${this.genIdentifier(s.data.list[0].function_declaration)};`+i,a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t);const i=this.querySeparator()+`DROP PROCEDURE IF EXISTS ${this.genIdentifier(e.procedure_name)}`;a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+`DROP TRIGGER ${e.procedure_name}`,i=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),await this.sqlClient.raw(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP TRIGGER ${this.genIdentifier(e.trigger_name)}`}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new _.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${this.genIdentifier(e.trigger_name)} ON ${this.genIdentifier(e.tn)}`),await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`),a.data.object={upStatement:this.querySeparator()+`DROP TRIGGER ${this.genIdentifier(e.trigger_name)} ON ${this.genIdentifier(e.tn)};${this.querySeparator()}CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`,downStatement:this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.oldStatement}`}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${this.genIdentifier(e.view_name)}`}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=`CREATE OR REPLACE VIEW ${this.genIdentifier(e.view_name)} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:this.querySeparator()+t,downStatement:this.querySeparator()+`CREATE VIEW ${this.genIdentifier(e.view_name)} AS \n${e.oldViewDefination}`}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new _.default;y.api(`${t}:args:`,e);try{const t=`DROP VIEW ${this.genIdentifier(e.view_name)}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`CREATE VIEW ${this.genIdentifier(e.view_name)} AS \n${e.oldViewDefination}`}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e.tn,e);await this.sqlClient.raw(t);const i=this.querySeparator()+this.sqlClient.schema.dropTable(e.table).toString();this.emit(`Success : ${t}`);const s=await this.afterTableCreate(e);a.data.object={upStatement:[{sql:t},...s.upStatement],downStatement:[...s.downStatement,{sql:i}]}}catch(e){throw y.ppe(e,t),e}return a}async afterTableCreate(e){const t={upStatement:[],downStatement:[]};let a="",i="";for(let t=0;t<e.columns.length;t++){const s=e.columns[t];if(s.au){const t=e.schema?`xc_au_${e.schema}_${e.tn}_${s.cn}`:`xc_au_${e.tn}_${s.cn}`,r=e.schema?`xc_trigger_${e.schema}_${e.tn}_${s.cn}`:`xc_trigger_${e.tn}_${s.cn}`,l=this.genQuery("CREATE OR REPLACE FUNCTION ??()\n                          RETURNS TRIGGER AS $$\n                          BEGIN\n                            NEW.?? = NOW();\n                            RETURN NEW;\n                          END;\n                          $$ LANGUAGE plpgsql;",[t,s.cn]);a+=this.querySeparator()+l+this.querySeparator()+this.genQuery("CREATE TRIGGER ??\n            BEFORE UPDATE ON ??\n            FOR EACH ROW\n            EXECUTE PROCEDURE ??();",[r,e.schema?`${e.schema}.${e.tn}`:e.tn,t]),i+=this.querySeparator()+this.genQuery("DROP TRIGGER IF EXISTS ?? ON ??;",[r,e.schema?`${e.schema}.${e.tn}`:e.tn])+this.querySeparator()+this.genQuery("DROP FUNCTION IF EXISTS ??()",[t])}}return""!==a&&await this.sqlClient.raw(a),t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async afterTableUpdate(e){const t={upStatement:[],downStatement:[]};let a="",i="";for(let t=0;t<e.columns.length;t++){const s=e.columns[t];if(s.au&&1===s.altered){const t=e.schema?`xc_au_${e.schema}_${e.tn}_${s.cn}`:`xc_au_${e.tn}_${s.cn}`,r=e.schema?`xc_trigger_${e.schema}_${e.tn}_${s.cn}`:`xc_trigger_${e.tn}_${s.cn}`,l=this.genQuery("CREATE OR REPLACE FUNCTION ??()\n                          RETURNS TRIGGER AS $$\n                          BEGIN\n                            NEW.?? = NOW();\n                            RETURN NEW;\n                          END;\n                          $$ LANGUAGE plpgsql;",[t,s.cn]);a+=this.querySeparator()+l+this.querySeparator()+this.genQuery("CREATE TRIGGER ??\n            BEFORE UPDATE ON ??\n            FOR EACH ROW\n            EXECUTE PROCEDURE ??();",[r,e.schema?`${e.schema}.${e.tn}`:e.tn,t]),i+=this.querySeparator()+this.genQuery("DROP TRIGGER IF EXISTS ?? ON ??;",[r,e.tn])+this.querySeparator()+this.genQuery("DROP FUNCTION IF EXISTS ??()",[t])}}return""!==a&&await this.sqlClient.raw(a),t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async tableUpdate(e){const t=this.tableUpdate.name,a=new _.default;y.api(`${t}:args:`,e);try{e.table=e.schema?`${e.schema}.${e.tn}`:e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",s="";for(let a=0;a<e.columns.length;++a){const r=(0,d.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=this.alterTableRemoveColumn(e.table,e.columns[a],r,i),s+=this.alterTableAddColumn(e.table,r,e.columns[a],s)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=this.alterTableChangeColumn(e.table,e.columns[a],r,i),s+=this.alterTableChangeColumn(e.table,r,e.columns[a],s)):1&e.columns[a].altered&&(i+=this.alterTableAddColumn(e.table,e.columns[a],r,i),s+=this.alterTableRemoveColumn(e.table,e.columns[a],r,s))}i+=(i?";":"")+this.alterTablePK(e.table,e.columns,e.originalColumns,i),s+=(s?";":"")+this.alterTablePK(e.table,e.originalColumns,e.columns,s),""!==i&&await this.sqlClient.raw(i);const r=await this.afterTableUpdate(e);a.data.object={upStatement:[{sql:this.querySeparator()+i},...r.upStatement],downStatement:[...r.downStatement,{sql:this.querySeparator()+s}]}}catch(e){throw y.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new _.default;y.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.dropTable(e.schema?`${e.schema}.${e.tn}`:e.tn).toString();let i=this.createTable(e.tn,e),s=await this.relationList(e);s=s.data.list;for(const e of s){const t=this.sqlClient.raw(this.sqlClient.schema.table(e.tn,(function(t){t=t.foreign(e.cn,null).references(e.rcn).on(e.rtn),e.ur&&(t=t.onUpdate(e.ur)),e.dr&&t.onDelete(e.dr)})).toQuery());i+=this.querySeparator()+t,await t}let r=await this.indexList(e);r=r.data.list.filter((({cst:e})=>"p"!==e&&"f"!==e));const l={};for(const{key_name:t,non_unique:a,cn:i}of r)t in l||(l[t]={tn:e.tn,indexName:t,non_unique:a,columns:[]}),l[t].columns.push(i);for(const{non_unique:e,tn:t,columns:a,indexName:s}of Object.values(l))i+=this.querySeparator()+this.sqlClient.schema.table(t,(function(t){e?t.index(a,s):t.unique(a,s)})).toQuery();this.emit(`Success : ${t}`),await this.sqlClient.raw(this.sqlClient.schema.dropTable(e.schema?`${e.schema}.${e.tn}`:e.tn).toQuery()),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+i}]}}catch(e){throw y.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name;let a=new _.default;y.api(`${t}:args:`,e);try{a=await this.columnList(e);const t=this.createTable(e.tn,{tn:e.tn,columns:a.data.list});a.data=t}catch(e){throw y.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new _.default;y.api(`${t}:args:`,e);try{a.data=`INSERT INTO \`${e.tn}\` (`;let t=" VALUES (";const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`"${i.data.list[e].cn}"\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n"${i.data.list[e].cn}"\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw y.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new _.default;y.api(`${t}:args:`,e);try{a.data=`UPDATE "${e.tn}" \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,"${t.data.list[e].cn}" = <\`${t.data.list[e].cn}\`>\n\t`:`"${t.data.list[e].cn}" = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw y.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new _.default;y.api(`${t}:args:`,e);try{a.data=`DELETE FROM "${e.tn}" where ;`}catch(e){throw y.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new _.default;y.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE "${e.tn}";`}catch(e){throw y.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new _.default;y.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, "${t.data.list[e].cn}"\n\t`:`"${t.data.list[e].cn}"\n\t`;a.data+=` FROM "${e.tn}";`}catch(e){throw y.ppe(e,t),e}return a}alterTablePK(e,t,a,i,s=!1){const r=[],l=[];let c=0;for(let e=0;e<t.length;++e)t[e].pk&&4!==t[e].altered&&l.push(t[e].cn);for(let e=0;e<a.length;++e)a[e].pk&&r.push(a[e].cn);if(l.length===r.length){for(let e=0;e<l.length;++e)if(r[e]!==l[e]){c=1;break}}else c=l.length-r.length;let d="";return(l.length||r.length)&&c&&(d+=r.length?this.genQuery("alter TABLE ?? drop constraint IF EXISTS ??;",[e,`${e}_pkey`]):"",l.length&&(d+=s?this.genQuery(", PRIMARY KEY(??)",[l]):this.genQuery("alter TABLE ?? add constraint ?? PRIMARY KEY(??);",[e,`${e}_pkey`,l]))),d}alterTableRemoveColumn(e,t,a,i){let s=i?",":"";return s+=this.genQuery("ALTER TABLE ?? DROP COLUMN ??",[e,t.cn],!0),s}createTableColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,0)}alterTableAddColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,1)}alterTableChangeColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,2)}createTable(e,t){let a="";for(let i=0;i<t.columns.length;++i)a+=this.createTableColumn(e,t.columns[i],null,a);return a+=this.alterTablePK(e,t.columns,[],a,!0),a=this.genQuery(`CREATE TABLE ?? (${a});`,[t.schema?`${t.schema}.${t.tn}`:t.tn]),a}alterTableColumn(e,t,a,i,s=2){let r="";const l=this.sanitiseDefaultValue(t.cdf),c=!0;if(0===s)r=i?",":"",t.ai?"int8"===t.dt||t.dt.indexOf("bigint")>-1?r+=this.genQuery(" ?? bigserial",[t.cn],c):"int2"===t.dt||t.dt.indexOf("smallint")>-1?r+=this.genQuery(" ?? smallserial",[t.cn],c):r+=this.genQuery(" ?? serial",[t.cn],c):(r+=this.genQuery(` ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],c),r+=t.rqd?" NOT NULL":" NULL",r+=l?` DEFAULT ${l}`:"",r+=t.unique?" UNIQUE":"");else if(1===s)r+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],c),r+=t.rqd?" NOT NULL":" NULL",r+=l?` DEFAULT ${l}`:"",r+=t.unique?" UNIQUE":"",r=this.genQuery(`ALTER TABLE ?? ${r};`,[e],c);else{if(t.cn!==a.cn&&(r+=this.genQuery("\nALTER TABLE ?? RENAME COLUMN ?? TO ?? ;\n",[e,a.cn,t.cn],c)),t.dt!==a.dt){r+=this.genQuery("\nALTER TABLE ?? ALTER COLUMN ?? DROP DEFAULT;\n",[e,t.cn],c),[u.UITypes.Date,u.UITypes.DateTime,u.UITypes.Time,u.UITypes.Duration].includes(t.uidt)&&(r+=g.default.dateConversionFunction.default.sql),r+=this.genQuery(`\nALTER TABLE ?? ALTER COLUMN ?? TYPE ${this.sanitiseDataType(t.dt)} USING `,[e,t.cn],c);const i=(0,h.formatColumn)(this.genQuery("??",[t.cn],c),a.uidt),s="number"==typeof t.dtxp?t.dtxp:null,l=(0,h.generateCastQuery)(t.uidt,t.dt,i,s,t.meta.date_format||"YYYY-MM-DD");r+=this.genQuery(l,[],c)}t.rqd!==a.rqd&&(r+=this.genQuery("\nALTER TABLE ?? ALTER COLUMN ?? ",[e,t.cn],c),r+=t.rqd?" SET NOT NULL;\n":" DROP NOT NULL;\n"),t.cdf!==a.cdf&&(r+=this.genQuery("\nALTER TABLE ?? ALTER COLUMN ?? ",[e,t.cn],c),r+=t.cdf?` SET DEFAULT ${this.sanitiseDefaultValue(t.cdf)};\n`:" DROP DEFAULT;\n")}return r}get schema(){var e,t;return(null===(t=null===(e=this.connectionConfig)||void 0===e?void 0:e.searchPath)||void 0===t?void 0:t[0])||"public"}async totalRecords(e={}){const t=this.totalRecords.name,a=new _.default;y.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SUM(n_live_tup) as TotalRecords FROM pg_stat_user_tables;");a.data=e.rows[0]}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{y.api(`${t} :result: ${a}`)}return a}async getDefaultByteaOutputFormat(){var e,t;const a=this.getDefaultByteaOutputFormat.name,i=new _.default;y.api(`${a}:args:`,{});try{const a=await this.sqlClient.raw("SHOW bytea_output;");i.data=null===(t=null===(e=a.rows)||void 0===e?void 0:e[0])||void 0===t?void 0:t.bytea_output}catch(e){i.data="escape"}finally{y.api(`${a} :result: ${i}`)}return i}async tableRename(e){const t=this.tableCreate.name,a=new _.default;y.api(`${t}:args:`,e);try{e.table=e.tn,await this.sqlClient.raw(this.sqlClient.schema.renameTable(this.sqlClient.raw("??.??",[this.getEffectiveSchema(e),e.tn_old]),e.tn).toQuery());const t=this.querySeparator()+this.sqlClient.schema.renameTable(this.sqlClient.raw("??.??",[this.getEffectiveSchema(e),e.tn]),e.tn_old).toQuery();this.emit(`Success : ${t}`);const i=this.querySeparator()+this.sqlClient.schema.renameTable(this.sqlClient.raw("??.??",[this.getEffectiveSchema(e),e.tn_old]),e.tn).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw y.ppe(e,t),e}return a}async indexCreate(e){const t=this.indexCreate.name,a=new _.default;y.api(`${t}:args:`,e);const i=e.indexName||null;try{e.table=e.schema?`${e.schema}.${e.tn}`:e.tn,await this.sqlClient.raw(this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery());const t=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery();this.emit(`Success : ${t}`);const s=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:s}]}}catch(e){throw y.ppe(e,t),e}return a}async indexDelete(e){const t=this.indexDelete.name,a=new _.default;y.api(`${t}:args:`,e);const i=e.indexName||null;try{e.table=e.schema?`${e.schema}.${e.tn}`:e.tn,await this.sqlClient.raw(this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery());const t=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery();this.emit(`Success : ${t}`);const s=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:s}]}}catch(e){throw y.ppe(e,t),e}return a}}t.default=PGClient},6264:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(10416)),r=i(a(58108)),l=new(i(a(98152)).default)("YBClient");class YBClient extends s.default{constructor(e){super(e)}async tableList(e={}){const t=this.tableList.name,a=new r.default;l.api(`${t}:args:`,e);try{const{rows:e}=await this.raw("select tablename as tn, * from pg_catalog.pg_tables where schemaname != 'information_schema' and schemaname != 'pg_catalog'");a.data.list=e}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result`,a),a}async columnList(e={}){const t=this.columnList.name,a=new r.default;l.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.raw('\n      select c.relname as tn, a.attname as cn, pg_catalog.format_type(a.atttypid, a.atttypmod) as "dt",a.attnotnull as "not_nullable",\n      pg_catalog.pg_get_expr(ad.adbin, ad.adrelid, true) as cdf, dsc.description as comment,a.attnum as cop,\n      coalesce(i.indisprimary,false) as pk,\n      a.*,ad.oid as attr_id\n      FROM pg_catalog.pg_attribute a\n      INNER JOIN pg_catalog.pg_class c ON (a.attrelid=c.oid)\n      LEFT OUTER JOIN pg_catalog.pg_attrdef ad ON (a.attrelid=ad.adrelid AND a.attnum = ad.adnum)\n      LEFT OUTER JOIN pg_catalog.pg_description dsc ON (c.oid=dsc.objoid AND a.attnum = dsc.objsubid)\n      LEFT JOIN pg_index i ON (a.attnum = any(i.indkey) and a.attrelid = i.indrelid and i.indrelid = :table::regclass AND i.indisprimary)\n      WHERE NOT a.attisdropped AND c.relname = :table and a.attnum > 0 ORDER BY a.attnum',{table:e.tn}),i=[];for(let a=0;a<t.rows.length;++a){const s={};s.tn=e.tn,s.cn=t.rows[a].cn,s.dt=t.rows[a].dt,s.np=t.rows[a].np,s.ns=t.rows[a].ns,s.clen=t.rows[a].clen,s.dp=t.rows[a].dp,s.cop=t.rows[a].cop,s.dtx=this.getKnexDataType(s.dt),s.pk=null!==t.rows[a].pk_constraint_name,s.not_nullable=t.rows[a].not_nullable,s.nrqd=!s.not_nullable,t.rows[a].ct=t.rows[a].dt||"",s.un=-1!==t.rows[a].ct.indexOf("unsigned"),s.ai=!1,t.rows[a].cdf&&(s.ai=-1!==t.rows[a].cdf.indexOf("nextval")),s.cdf=t.rows[a].cdf?t.rows[a].cdf.replace(/::[\w (),]+$/,"").replace(/^'|'$/g,""):t.rows[a].cdf,s.cc=t.rows[a].comment,s.csn=t.rows[a].csn,i.push(s)}a.data.list=i}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result`,a),a}}t.default=YBClient},45560:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TIME_FORMATS=t.DATE_FORMATS=void 0;const a={MM:"[0-9]{1,2}"};t.DATE_FORMATS={ymd:Object.keys(a).map((e=>[`Y-${e}-DD`,`^\\d{1,4}[:\\- /]+${a[e]}[:\\- /]+\\d{1,2}$`])),dmy:Object.keys(a).map((e=>[`DD-${e}-Y`,`^\\d{1,2}[:\\- /]+${a[e]}[:\\- /]+\\d{1,4}$`])),mdy:Object.keys(a).map((e=>[`${e}-DD-Y`,`^${a[e]}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,4}$`])),empty:[["","^.*$"]]},t.TIME_FORMATS=[["HH24:MI:SS:MS:US","^\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,3}[:\\- /]+\\d*$"],["HH24:MI:SS:MS","^\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,3}$"],["HH24:MI:SS","^\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,2}$"],["HH24:MI","^\\d{1,2}[:\\- /]+\\d{1,2}$"],["HH24","^\\d{1,2}$"],["HH12:MI:SS:MS:US (AM|PM)","^\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,3}[:\\- /]+\\d* (AM|PM)$"],["HH12:MI:SS:MS (AM|PM)","^\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,3} (AM|PM)$"],["HH12:MI:SS (AM|PM)","^\\d{1,2}[:\\- /]+\\d{1,2}[:\\- /]+\\d{1,2} (AM|PM)$"],["HH12:MI (AM|PM)","^\\d{1,2}[:\\- /]+\\d{1,2} (AM|PM)$"],["HH12 (AM|PM)","^\\d{1,2} (AM|PM)$"]]},4744:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a={columnList:{default:{sql:"SELECT\n      c.table_name as tn,\n      c.column_name as cn,\n      c.data_type as dt,\n      c.column_type as ct,\n      c.character_maximum_length as clen,\n      c.numeric_precision as np,\n      c.numeric_scale as ns,\n      c.datetime_precision as dp,\n      c.ordinal_position as cop,\n      c.column_key as ck,\n      c.extra as ext, -- gives ai\n      c.column_default as cdf,\n      c.is_nullable as nrqd,\n      c.privileges as priv,\n      c.column_comment as cc,\n      c.generation_expression,\n      c.character_set_name as csn,\n      c.collation_name as clnn,\n      ct.CONSTRAINT_TYPE as cst\n    FROM\n      information_schema.COLUMNS as c\n    Left join(\n              select\n                      tc.CONSTRAINT_NAME,\n                      tc.TABLE_NAME,\n                      tc.CONSTRAINT_SCHEMA,\n                      tc.CONSTRAINT_TYPE,\n                      s.COLUMN_NAME\n              from\n                      information_schema.TABLE_CONSTRAINTS as tc\n              LEFT JOIN information_schema.STATISTICS as s ON\n                      s.table_schema = tc.CONSTRAINT_SCHEMA\n                      and s.TABLE_NAME = tc.TABLE_NAME\n                      and s.INDEX_NAME = tc.CONSTRAINT_NAME\n              where\n                      tc.CONSTRAINT_SCHEMA = ?\n                      and s.TABLE_NAME = ? \n      ) ct on\n      c.TABLE_SCHEMA = ct.CONSTRAINT_SCHEMA\n      AND c.TABLE_NAME = ct.TABLE_NAME\n      AND c.COLUMN_NAME = ct.COLUMN_NAME\n    WHERE\n      c.table_schema = ?\n      and c.TABLE_NAME = ?\n    ORDER BY\n      c.table_name,\n      c.ordinal_position",paramsHints:["databaseName","tn","databaseName","tn"]}},constraintList:{default:{sql:"SELECT \n      k.constraint_name as cstn, \n      k.column_name as cn, \n      k.ordinal_position as op, \n      k.position_in_unique_constraint as puc, \n      t.constraint_type as cst\nFROM information_schema.table_constraints t\nLEFT JOIN information_schema.key_column_usage k\nUSING(constraint_name,table_schema,table_name)\nWHERE\nt.table_schema=?\nAND t.table_name=?;",paramsHints:["database","tn"]}},createDatabaseIfNotExists:{default:{sql:"create database if not exists ??",paramsHints:["database"]}},createTableIfNotExists:{default:{sql:"",paramsHints:[]}},dropDatabase:{default:{sql:"drop database ??",paramsHints:["database"]}},databaseList:{default:{sql:"SHOW databases",paramsHints:[]}},hasDatabase:{default:{sql:"SHOW DATABASES LIKE ??",paramsHints:["databaseName"]}},indexList:{default:{sql:"show index from ??",paramsHints:["tn"]}},functionList:{default:{sql:"show function status where db=?",paramsHints:["databaseName"]}},functionRead:{default:{sql:"SHOW CREATE FUNCTION ??",paramsHints:["function_name"]}},functionDelete:{default:{sql:"DROP FUNCTION IF EXISTS ??",paramsHints:["function_name"]}},procedureList:{default:{sql:"show procedure status where db=?",paramsHints:["databaseName"]}},procedureRead:{default:{sql:"show create procedure ??",paramsHints:["procedure_name"]}},procedureDelete:{default:{sql:"DROP PROCEDURE IF EXISTS ??",paramsHints:["procedure_name"]}},relationList:{default:{sql:"SELECT\n      kcu.CONSTRAINT_NAME as cstn,\n      kcu.TABLE_NAME as tn,\n      kcu.COLUMN_NAME as cn,\n      kcu.POSITION_IN_UNIQUE_CONSTRAINT as puc,\n      kcu.REFERENCED_TABLE_NAME as rtn,\n      kcu.REFERENCED_COLUMN_NAME as rcn,\n      rc.MATCH_OPTION as mo,\n      rc.UPDATE_RULE as ur,\n      rc.DELETE_RULE as dr\n    FROM\n      information_schema.`KEY_COLUMN_USAGE` AS kcu\n    INNER JOIN information_schema.REFERENTIAL_CONSTRAINTS AS rc ON\n      kcu.CONSTRAINT_NAME = rc.CONSTRAINT_NAME\n    WHERE\n      kcu.table_schema = ?\n      AND kcu.referenced_column_name IS NOT NULL\n      AND kcu.table_name=?",paramsHints:["database","tn"]}},schemaCreate:{default:{sql:"create database ??",paramsHints:["database_name"]}},schemaDelete:{default:{sql:"drop database ??",paramsHints:["database_name"]}},triggerList:{default:{sql:"SHOW TRIGGERS like ?",paramsHints:["tn"]}},tableList:{default:{sql:"",paramsHints:[]}},testConnection:{default:{sql:"",paramsHints:[]}},triggerRead:{default:{sql:"SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",paramsHints:["databaseName"]}},triggerDelete:{default:{sql:"DROP TRIGGER ??",paramsHints:["trigger_name"]}},version:{default:{sql:"",paramsHints:[]}},viewRead:{default:{sql:"select * FROM INFORMATION_SCHEMA.VIEWS WHERE\n       TABLE_SCHEMA = ? AND TABLE_NAME = ?",paramsHints:["databaseName","view_name"]}},viewList:{default:{sql:"SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW'",paramsHints:["databaseName"]}},dateConversionFunction:{default:{sql:"CREATE OR REPLACE FUNCTION to_date_time_safe(value text, format text) RETURNS TIMESTAMP AS $$\n  BEGIN\n    RETURN to_timestamp(value, format);\n    EXCEPTION\n      WHEN others THEN RETURN NULL;  \n  END;\n  $$ LANGUAGE plpgsql;",paramsHints:[]}}};t.default=a},90868:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCastQuery=function(e,t,a,s,d){switch(e){case i.UITypes.SingleLineText:case i.UITypes.MultiSelect:case i.UITypes.SingleSelect:case i.UITypes.Email:case i.UITypes.PhoneNumber:case i.UITypes.URL:return`${a}::VARCHAR(${s||255});`;case i.UITypes.LongText:return`${a}::TEXT;`;case i.UITypes.Number:return`CAST(${r(a)} AS BIGINT);`;case i.UITypes.Year:return function(e,t,a){return`\n  NULLIF(\n    NULLIF(\n      LEAST(\n        ${a+1}, GREATEST(${t-1}, ${e})\n      ), ${t-1}\n    ), ${a+1}\n  );\n`}(r(a),1e3,9999);case i.UITypes.Decimal:case i.UITypes.Currency:return`${r(a)};`;case i.UITypes.Percent:return`LEAST(100, GREATEST(0, ${r(a)}));`;case i.UITypes.Rating:return`LEAST(${s||5}, GREATEST(0, ${r(a)}));`;case i.UITypes.Checkbox:return`\n    CASE\n      WHEN LOWER(${u=a}) IN ('checked', 'x', 'yes', 'y', '1', '[x]', '☑', '✅', '✓', '✔', 'enabled', 'on', 'done', 'true') THEN true\n      WHEN LOWER(${u}) IN ('unchecked', '', 'no', 'n', '0', '[]', '[ ]', 'disabled', 'off', 'false') THEN false\n      ELSE null\n    END;\n  `;case i.UITypes.Date:return`CAST(${l(a,c(d)).slice(0,-1)} AS DATE);`;case i.UITypes.DateTime:return l(a,c(d));case i.UITypes.Time:return l(a,"empty");case i.UITypes.Duration:return function(e){return`\n    CASE\n      WHEN ${e} ~ '^\\d+:\\d{1,2}$' THEN 60 * CAST(SPLIT_PART(${e}, ':', 1) AS INT) + CAST(SPLIT_PART(${e}, ':', 2) AS INT)\n      ELSE ${r(e)}\n    END;\n  `}(a);default:return`null::${t};`}var u},t.formatColumn=function(e,t){switch(t){case i.UITypes.LongText:case i.UITypes.SingleLineText:case i.UITypes.MultiSelect:case i.UITypes.Email:case i.UITypes.URL:case i.UITypes.SingleSelect:case i.UITypes.PhoneNumber:return e;case i.UITypes.Number:case i.UITypes.Decimal:case i.UITypes.Currency:case i.UITypes.Percent:case i.UITypes.Rating:case i.UITypes.Duration:case i.UITypes.Year:return`CAST(${e} AS VARCHAR(255))`;case i.UITypes.Checkbox:return`CAST(CASE WHEN ${e} THEN '1' ELSE '0' END AS TEXT)`;default:return`CAST(${e} AS TEXT)`}};const i=a(71040),s=a(45560);function r(e){return`\n    CAST(\n      NULLIF(\n        REPLACE(\n          REPLACE(\n            REGEXP_REPLACE(\n              REGEXP_REPLACE(${e}, '[^0-9.]', '', 'g'), \n              '(\\d)\\.', '\\1-'\n            ), \n            '.', ''\n          ), \n          '-', '.'\n        ), ''\n      ) AS DECIMAL\n    )\n  `}function l(e,t){if(!(t in s.DATE_FORMATS))throw new Error(`Invalid date format: ${t}`);const a="empty"===t?s.TIME_FORMATS:[...s.TIME_FORMATS,["","^$"]];return`CASE \n    ${s.DATE_FORMATS[t].map((([t,i])=>a.map((([a,s])=>`WHEN ${e} ~ '${i.slice(0,-1)}\\s*${s.slice(1)}' THEN to_date_time_safe(${e}, '${t} ${a}')`)).join("\n"))).join("\n")}\n    ELSE NULL\n   END;`}function c(e){const t=e.indexOf("Y"),a=e.indexOf("M"),i=e.indexOf("D");return t<a?a<i?"ymd":t<i?"ydm":"dym":t<i?"myd":a<i?"mdy":"dmy"}},87019:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(50970),r=i(a(2058)),l=i(a(50536)),c=i(a(90922)),d=i(a(96964)),u=i(a(72208)),p=a(92080),m=i(a(69643)),_=i(a(98152)),f=i(a(58108)),h=i(a(5832)),g=(0,p.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",6),y=new _.default("SqliteClient");class SqliteClient extends m.default{constructor(e){e.connection.useNullAsDefault=!0,super(e),this.sqlClient=(null==e?void 0:e.knex)||(0,l.default)(e.connection),this.queries=h.default,this._version={}}getKnexDataTypes(){const e=new f.default;return e.data.list=["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","character","blob sub_type text","numeric","blob","real","double","double precision","float","numeric","boolean","date","datetime","text","varchar","timestamp"],e}async testConnection(e={}){const t=this.testConnection.name,a=new f.default;y.api(`${t}:args:`,e);try{await this.raw("SELECT 1+1 as data")}catch(e){y.ppe(e),a.code=-1,a.message=e.message}finally{y.api(`${t} :result: ${a}`)}return a}async version(e){const t=this.version.name,a=new f.default;y.api(`${t}:args:`,e);try{a.data.object={};const e=await this.raw("select sqlite_version() as version");y.debug(e[0]),a.data.object.version=e[0].version;const t=e[0].version.split(".");t.length&&3===t.length?(a.data.object.primary=t[0],a.data.object.major=t[1],a.data.object.minor=t[2],a.data.object.key=t[0]+t[1]):(a.code=-1,a.message=`Invalid version : ${e[0].version}`)}catch(e){y.ppe(e),a.code=-1,a.message=e.message}finally{y.api(`${t} :result: %o`,a)}return a}async createDatabaseIfNotExists(e){const t=this.createDatabaseIfNotExists.name,a=new f.default;y.api(`${t}:args:`,e);try{if(await(0,s.promisify)(r.default.exists)(e.database))this.sqlClient=(0,l.default)(this.connectionConfig.connection);else{y.debug("sqlite file do no exists - create one");const t=await(0,s.promisify)(r.default.open)(e.database,"w"),a=await(0,s.promisify)(r.default.close)(t);y.debug("sqlite file is created",t,a),this.sqlClient=(0,l.default)(this.connectionConfig.connection),await this.sqlClient.raw('PRAGMA encoding = "UTF-8"')}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async dropDatabase(e){const t=this.dropDatabase.name,a=new f.default;y.api(`${t}:args:`,e);try{y.debug("dropping database:",e),await(0,s.promisify)(r.default.unlink)(e.database),y.debug("dropped database:")}catch(e){y.ppe(e,t)}return y.api(`${t}: result`,a),a}async createTableIfNotExists(e={}){const t=this.createTableIfNotExists.name,a=new f.default;y.api(`${t}:args:`,e);try{if((await this.hasTable({tn:e.tn})).data.value)y.debug(`${e.tn} tables exists`);else{const t=await this.sqlClient.schema.createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()}));y.debug("Table created:",`${e.tn}`,t)}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async hasTable(e){const t=this.hasTable.name,a=new f.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw("select * from ??",[e.tn]),a.data.value=!0}catch(e){a.data.value=!1}return y.api(`${t}: result`,a),a}async hasDatabase(e={}){const t=this.hasDatabase.name,a=new f.default;y.api(`${t}:args:`,e);let i=!1;return y.debug("sqlite databaseName:",e.databaseName),i=await(0,s.promisify)(r.default.exists)(e.databaseName),a.data.value=i,a}async databaseList(e){return[]}async tableList(e={}){const t=this.tableList.name,a=new f.default;y.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT name as tn FROM sqlite_master where type = 'table'");a.data.list=[];for(let t=0;t<e.length;++t)"sqlite_sequence"!==e[t].tn.toLocaleLowerCase()&&a.data.list.push(e[t])}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name;new f.default;throw y.api(`${t}:args:`,e),new Error("SchemaList : Not supported for sqlite")}async columnList(e={}){const t=this.columnList.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("PRAGMA table_info(??)",[e.tn]),i=(await this.triggerList(e)).data.list;for(let a=0;a<t.length;++a){switch(t[a].cn=t[a].name,t[a].cno=t[a].cn,t[a].dt=t[a].type.toLocaleLowerCase(),t[a].dt){case"integer":case"int":case"text":case"varchar":case"numeric":case"blob":case"blob sub_type text":case"real":case"timestamp":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":case"character":case"double":case"double precision":case"float":case"boolean":case"date":case"datetime":case"time":break;default:if("t"===t[a].dt[0]||"i"===t[a].dt[0]){const e=/(\w+)\(([^)]+)\)/.exec(t[a].dt);e&&e.length&&e.length>1&&(t[a].dtxp=e[2],t[a].dt=e[1])}}t[a].nrqd=1!==t[a].notnull,t[a].not_nullable=1===t[a].notnull,t[a].rqd=1===t[a].notnull,t[a].cdf=t[a].dflt_value,t[a].pk=t[a].pk>0,t[a].cop=t[a].cid,t[a].ai=t[a].pk&&"integer"===t[a].dt,t[a].dtx=this.getKnexDataType(t[a].dt),t[a].dtxp="",t[a].dtxs="",t[a].au=!!i.find((({trigger:i})=>i===`xc_trigger_${e.tn}_${t[a].cn}`))}a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("PRAGMA index_list(??)",[e.tn]),i=[];for(let e=0,a=0;e<t.length;++e,++a){t[e].key_name=t[e].name,t[e].non_unique=0===t[e].unique?1:0,t[e].non_unique_original=0===t[e].unique?1:0,t[e].unique=1===t[e].unique?1:0;const s=await this.sqlClient.raw("PRAGMA index_info(??)",[t[e].key_name]);if(1===s.length)i[a]=t[e],i[a].cn=s[0].name,i[a].seq_in_index=1;else{for(let r=0;r<s.length;++r,++a)i[a]=JSON.parse(JSON.stringify(t[e])),i[a].cn=s[r].name,i[a].seq_in_index=r;a--}}a.data.list=i}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("PRAGMA foreign_key_list(??)",[e.tn]);for(let a=0;a<t.length;++a)t[a].tn=e.tn,t[a].cn=t[a].from,t[a].rtn=t[a].table,t[a].rcn=t[a].to,t[a].ur=t[a].on_update,t[a].dr=t[a].on_delete,t[a].mo=t[a].match;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new f.default;y.api(`${t}:args:`,e);try{let e=await this.tableList();e=e.data.list;const t=[];for(let a=0;a<e.length;++a){const i=await this.sqlClient.raw("PRAGMA foreign_key_list(??)",[e[a].tn]);for(let s=0;s<i.length;++s)i[s].tn=e[a].tn,i[s].cn=i[s].from,i[s].rtn=i[s].table,i[s].rcn=i[s].to,i[s].ur=i[s].on_update,i[s].dr=i[s].on_delete,i[s].mo=i[s].match,t.push(i[s])}a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("select *, name as trigger_name from sqlite_master where type = 'trigger' and tbl_name=?;",[e.tn]);for(let e=0;e<t.length;++e)t[e].trigger=t[e].name,t[e].table=t[e].tbl_name,t[e].statement=t[e].sql;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show function status where db=?",[e.databaseName]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,d.default)(i,(function(e,t){return t.toLowerCase()})),i.function_name=i.name,e.push(i)}a.data.list=e}else y.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show procedure status where db=?",[e.databaseName]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,d.default)(i,(function(e,t){return t.toLowerCase()})),i.procedure_name=i.name,e.push(i)}a.data.list=e}else y.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SELECT * FROM sqlite_master WHERE type = 'view'");for(let e=0;e<t.length;++e)t[e].view_name=t[e].name,t[e].view_definition=t[e].sql;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SHOW CREATE FUNCTION ??;",[e.function_name]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,d.default)(i,(function(e,t){return t.toLowerCase()})),i.create_function=i["create function"],e.push(i)}a.data.list=e}else y.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show create procedure ??;",[e.procedure_name]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,d.default)(i,(function(e,t){return t.toLowerCase()})),i.create_procedure=i["create procedure"],e.push(i)}a.data.list=e}else y.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("SELECT * FROM sqlite_master WHERE type = 'view' AND name = ?",[e.view_name]);for(let e=0;e<t.length;++e)t[e].view_name=t[e].name,t[e].view_definition=t[e].sql;a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new f.default;y.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",[e.databaseName]);if(2===t.length){const i=[];for(let a=0;a<t[0].length;++a){const s=t[0][a];s.view_name=s[`Tables_in_${e.databaseName}`],i.push(s)}a.data.list=i}else y.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name;y.api(`${t}:args:`,e);return await this.sqlClient.raw("create database ??",[e.database_name])}async schemaDelete(e={}){const t=this.schemaDelete.name;y.api(`${t}:args:`,e);return await this.sqlClient.raw("drop database ??",[e.database_name])}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+"DROP TRIGGER ??";await this.sqlClient.raw(t,[e.trigger_name]),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return a}async functionDelete(e={}){const t=this.functionDelete.name;y.api(`${t}:args:`,e);return await this.sqlClient.raw("DROP FUNCTION IF EXISTS ??",[e.function_name])}async procedureDelete(e={}){const t=this.procedureDelete.name;y.api(`${t}:args:`,e);return await this.sqlClient.raw("DROP PROCEDURE IF EXISTS ??",[e.procedure_name])}async _getQuery(e){try{if((0,c.default)(this._version)){const t=await this.version();this._version=t.data.object,y.debug(`Version was empty for ${e.func}: population version for database as`,this._version)}return this._version.key in this.queries[e.func]?this.queries[e.func][this._version.key].sql:this.queries[e.func].default.sql}catch(e){throw y.ppe(e,this._getQuery.name),e}}async functionCreate(e={}){const t=this.functionCreate.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.function_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new f.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${this.genIdentifier(e.function_name)}`);const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.function_name)}\` \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new f.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.procedure_name}`);const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new f.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP TRIGGER ??",[e.trigger_name]),await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);const t=`DROP TRIGGER ${this.genIdentifier(e.trigger_name)};\nCREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;a.data.object={upStatement:[{sql:t}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=e.view_definition+";";await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new f.default;y.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new f.default;y.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP VIEW ??;",[e.view_name]),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name};`}],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,t),e}return y.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new f.default;y.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e.tn,e);await this.sqlClient.raw(t);const i=[{sql:";"}];this.emit(`Success : ${t}`);const s=await this.afterTableCreate(e);a.data.object={upStatement:[{sql:t},...s.upStatement],downStatement:i}}catch(e){throw y.ppe(e,t),e}return a}async afterTableCreate(e){const t={upStatement:[],downStatement:[]};let a="";const i=e.columns.find((e=>e.pk));if(!i)return t;const s=this.genIdentifier(e.tn);for(let t=0;t<e.columns.length;t++){const r=e.columns[t];if(r.au){const e=this.genIdentifier(`xc_trigger_${s}_${r.cn}`),t=`${this.querySeparator()}CREATE TRIGGER ${e}\n            AFTER UPDATE\n            ON "${s}" FOR EACH ROW\n            BEGIN\n              UPDATE "${s}" SET ${this.genIdentifier(r.cn)} = current_timestamp\n                WHERE ${this.genIdentifier(i.cn)} = old.${this.genIdentifier(i.cn)};\n            END;`;a+=t,await this.sqlClient.raw(t)}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:""},t}async afterTableUpdate(e){const t={upStatement:[],downStatement:[]};let a="";const i=e.columns.find((e=>e.pk));if(!i)return t;const s=this.genIdentifier(e.tn);for(let t=0;t<e.columns.length;t++){const r=e.columns[t];if(r.au&&1===r.altered){const t=this.genIdentifier(`xc_trigger_${e.tn}_${r.cn}`),l=`${this.querySeparator()}CREATE TRIGGER ${t}\n            AFTER UPDATE\n            ON "${s}" FOR EACH ROW\n            BEGIN\n              UPDATE "${s}" SET ${this.genIdentifier(r.cn)} = current_timestamp\n                WHERE ${this.genIdentifier(i.cn)} = old.${this.genIdentifier(i.cn)};\n            END;`;a+=l,await this.sqlClient.raw(l)}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:""},t}async tableUpdate(e){var t,a;const i=this.tableUpdate.name,s=new f.default;y.api(`${i}:args:`,e);try{e.table=e.tn;const i=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let r="",l="";for(let t=0;t<e.columns.length;++t){const a=(0,u.default)(i,{cn:e.columns[t].cno});!e.columns[t].pk&&4&e.columns[t].altered?(r+=this.alterTableRemoveColumn(e.table,e.columns[t],a,r),l+=this.alterTableAddColumn(e.table,a,e.columns[t],l)):2&e.columns[t].altered||8&e.columns[t].altered?(r+=this.alterTableChangeColumn(e.table,e.columns[t],a,r),l+=";"):1&e.columns[t].altered&&(r+=this.alterTableAddColumn(e.table,e.columns[t],a,r),l+=";")}const c=this.alterTablePK(e.columns,e.originalColumns,r),d=null===(a=null===(t=await this.sqlClient.raw("PRAGMA foreign_keys;"))||void 0===t?void 0:t[0])||void 0===a?void 0:a.foreign_keys;d&&await this.sqlClient.raw("PRAGMA foreign_keys = OFF;"),await this.sqlClient.raw("PRAGMA legacy_alter_table = ON;"),await this.sqlClient.raw("SELECT * FROM ?? LIMIT 1",[e.table]);const p=await this.sqlClient.transaction(),m=e=>{const t=[];let a,i=0,s="";for(let r=0;r<e.length;r++)a||'"'!==e[r]&&"'"!==e[r]||(a='"'===e[r]?"double":"single"),("double"===a&&'"'===e[r]||"single"===a&&"'"===e[r])&&r>0&&"\\"!==e[r-1]&&i++,";"===e[r]&&i%2==0?(t.push(s),s="",a=void 0):s+=e[r];return""!==s.trim()&&t.push(s),t};try{const t=m(r);for(let e=0;e<t.length;e++)""!==t[e].trim()&&await p.raw(t[e]);c&&await p.schema.alterTable(e.table,(e=>{for(const t of c.oldPks.filter((e=>!c.newPks.includes(e))))e.dropPrimary(t);for(const t of c.dropPks)e.dropColumn(t);c.newPks.length&&e.primary(c.newPks)})),await p.commit()}catch(e){throw await p.rollback(),e}finally{d&&await this.sqlClient.raw("PRAGMA foreign_keys = ON;"),await this.sqlClient.raw("PRAGMA legacy_alter_table = OFF;")}console.log(r);const _=await this.afterTableUpdate(e);s.data.object={upStatement:[{sql:this.querySeparator()+r},..._.upStatement],downStatement:[{sql:";"}]}}catch(e){throw y.ppe(e,i),e}return s}async tableDelete(e){const t=this.tableDelete.name,a=new f.default;y.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.dropTable(e.tn).toString(),i=[{sql:";"}];this.emit(`Success : ${t}`),await this.sqlClient.schema.dropTable(e.tn),a.data.object={upStatement:[{sql:t}],downStatement:i}}catch(e){throw y.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name;let a=new f.default;y.api(`${t}:args:`,e);try{a=await this.columnList(e);const t=this.createTable(e.tn,{tn:e.tn,columns:a.data.list});a.data=t}catch(e){throw y.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new f.default;y.api(`${t}:args:`,e);try{a.data=`INSERT INTO "${e.tn}" (`;let t=" VALUES (";const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n${i.data.list[e].cn}\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw y.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new f.default;y.api(`${t}:args:`,e);try{a.data=`UPDATE "${e.tn}" \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`:`${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw y.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new f.default;y.api(`${t}:args:`,e);try{a.data=`DELETE FROM "${e.tn}" where ;`}catch(e){throw y.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new f.default;y.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE "${e.tn}";`}catch(e){throw y.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new f.default;y.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM "${e.tn}";`}catch(e){throw y.ppe(e,t),e}return a}async sequelizeModelCreate(e){const t=this.sequelizeModelCreate.name,a=new f.default;y.api(`${t}:args:`,e);try{console.time(t);let a=[];e.tn?a.push({tn:e.tn}):(a=await this.tableList(e),a=a.data.list);let i=await this.relationList(e);i=i.data.list,e.tn&&(i=i.filter((t=>t.tn===e.tn||t.rtn===e.tn)));for(let e=0;e<a.length;++e){let t=await this.columnList({tn:a[e].tn});t=t.data.list,console.log(`Sequelize model created: ${a[e].tn}(${t.length})\n`),console.log("\n\n- - - - - - - - - - - - - ")}console.timeEnd(t)}catch(e){throw y.ppe(e,t),e}return a}createTablePK(e,t){const a=[];for(let t=0;t<e.length;++t)e[t].pk&&4!==e[t].altered&&a.push(e[t].cn);let i="";return a.length&&(i+=this.genQuery(", PRIMARY KEY(??)",[a])),i}alterTablePK(e,t,a){const i=[],s=[],r=[];let l=!1;for(let t=0;t<e.length;++t)e[t].pk&&(4!==e[t].altered?i.push(e[t].cn):r.push(e[t].cn),l=!0);for(let e=0;e<t.length;++e)t[e].pk&&s.push(t[e].cn);return i.length===s.length&&i.every((e=>s.includes(e)))&&0===r.length&&(l=!1),!!l&&{newPks:i,oldPks:s,dropPks:r}}alterTableRemoveColumn(e,t,a,i){let s=i?";":"";return s+=this.genQuery("ALTER TABLE ?? DROP COLUMN ??",[e,t.cn],!0),s}createTableColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,0)}alterTableAddColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,1)}alterTableChangeColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,2)}createTable(e,t){let a="";for(let i=0;i<t.columns.length;++i)a+=this.createTableColumn(e,t.columns[i],null,a);return a+=this.createTablePK(t.columns,a),a=this.genQuery(`CREATE TABLE ?? (${a});`,[t.tn]),a}alterTableColumn(e,t,a,i,s=2){let r="",l=!0;if(2===s){const i=g(),s=this.genQuery("ALTER TABLE ?? RENAME COLUMN ?? TO ??;",[e,a.cn,`${a.cno}_nc_${i}`],l);let c="";c+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],l),c+=t.dtxp&&"text"!==t.dt?`(${this.genRaw(t.dtxp)})`:"",c+=t.cdf?` DEFAULT ${this.genValue(t.cdf)}`:t.rqd?" DEFAULT ''":" ",c+=t.rqd?" NOT NULL":" ",r+=t.unique?" UNIQUE":"",c=this.genQuery(`ALTER TABLE ?? ${c};`,[e],l);r=`${s}${c}${this.genQuery("UPDATE ?? SET ?? = ??;",[e,t.cn,`${a.cno}_nc_${i}`],l)}${this.genQuery("ALTER TABLE ?? DROP COLUMN ??;",[e,`${a.cno}_nc_${i}`],l)}`}else 0===s?(r=i?",":"",r+=this.genQuery(`?? ${this.sanitiseDataType(t.dt)}`,[t.cn],l),r+=t.dtxp&&"text"!==t.dt?`(${this.genRaw(t.dtxp)})`:"",r+=t.cdf?` DEFAULT ${this.genValue(t.cdf)}`:" ",r+=t.rqd?" NOT NULL":" "):1===s&&(l=!0,r+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],l),r+=t.dtxp&&"text"!==t.dt?`(${this.genRaw(t.dtxp)})`:"",r+=t.cdf?` DEFAULT ${this.genValue(t.cdf)}`:t.rqd?" DEFAULT ''":" ",r+=t.rqd?" NOT NULL":" ",r=this.genQuery(`ALTER TABLE ?? ${r};`,[e],l));return r}async totalRecords(e={}){const t=this.totalRecords.name,a=new f.default;y.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT name FROM sqlite_master WHERE type='table';");let t=0;for(const a of e){const e=await this.sqlClient.raw("SELECT COUNT(*) as ct FROM ??;",[a.name]);e&&e.length&&(t+=e[0].ct)}a.data.TotalRecords=t}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{y.api(`${t} :result: ${a}`)}return a}genValue(e){return"CURRENT_TIMESTAMP"===e?e:super.genValue(e)}}t.default=SqliteClient},5832:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={int:{},integer:{},tinyint:{},smallint:{},mediumint:{},bigint:{},"unsigned big int":{},int2:{},int4:{},character:{},varchar:{},nchar:{},text:{},clob:{},"varying character":{},"native character":{},blob:{},real:{},double:{},"double precision":{},float:{},numeric:{},decimal:{},boolean:{},date:{},datetime:{}}},10256:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(98152)),r=i(a(29896));t.default=class BaseRender{constructor({dir:e="",filename:t="",ctx:a}){this.dir=e,this.filename=t,this.ctx=a,this.evt=new r.default,this.log=new s.default("BaseRender")}emit(e){this.log.api(e),this.evt.evt.emit("UI",{status:0,data:`File : ${e}`})}emitW(e){this.log.warn(e),this.evt.evt.emit("UI",{status:1,data:`File : ${e}`})}emitE(e){this.log.error(e),this.evt.evt.emit("UI",{status:-1,data:`File : ${e}`})}async prepare(){console.log("BaseRender::prepare -> Should be overriden")}}},85544:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(10256)),l=i(a(22200));class BaseModelXcMeta extends r.default{getXcColumnsObject(e){var t,a,i,r,l;const c=[];for(const d of e.columns){(null===(a=null===(t=this.ctx)||void 0===t?void 0:t.belongsTo)||void 0===a?void 0:a.find((e=>e.cn===d.cn)))&&(d.uidt=s.UITypes.ForeignKey);const e=Object.assign({validate:{func:[],args:[],msg:[]},column_name:d.cn||d.column_name,title:d._cn||d.cn||d.column_name||d.title,type:this._getAbstractType(d),dt:d.dt,uidt:d.uidt||this.getUIDataType(d),uip:d.uip,uicn:d.uicn},d);d.rqd&&(e.rqd=d.rqd),d.cdf&&(e.default=d.cdf,e.columnDefault=d.cdf),d.un&&(e.un=d.un),d.pk&&(e.pk=d.pk),d.ai&&(e.ai=d.ai),d.dtxp&&(e.dtxp=d.dtxp),d.dtxs&&(e.dtxs=d.dtxs);const u=null===(l=null===(r=null===(i=this.ctx)||void 0===i?void 0:i.oldMeta)||void 0===r?void 0:r.columns)||void 0===l?void 0:l.find((t=>e.cn==t.cn&&e.type==t.type));u&&(e._cn=u._cn||e._cn,e.uidt=u.uidt,e.uidt!==s.UITypes.MultiSelect&&e.uidt!==s.UITypes.SingleSelect||"set"===e.dt||"enum"===e.dt||(e.dtxp=e.dtxp||u.dtxp)),c.push(e)}return this.mapDefaultDisplayValue(c),c}renderXcHasMany(e){return JSON.stringify(e.hasMany)}renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}getObject(){return{tn:this.ctx.tn,_tn:this.ctx._tn,columns:this.getXcColumnsObject(this.ctx),pks:[],hasMany:this.ctx.hasMany,belongsTo:this.ctx.belongsTo,db_type:this.ctx.db_type,type:this.ctx.type,v:this.getVirtualColumns()}}getVirtualColumns(){var e,t;const a=[...(this.ctx.hasMany||[]).map((e=>({uidt:s.UITypes.LinkToAnotherRecord,type:"hm",hm:e,_cn:`${e._tn}List`}))),...(this.ctx.belongsTo||[]).map((e=>({uidt:s.UITypes.LinkToAnotherRecord,type:"bt",bt:e,_cn:`${e._rtn}Read`})))],i=(null===(t=null===(e=this.ctx)||void 0===e?void 0:e.oldMeta)||void 0===t?void 0:t.v)||[];for(const e of i)(e.lk||e.rl||e.formula)&&a.push(e);return a}mapDefaultDisplayValue(e){(0,l.default)(e)}renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}}t.default=BaseModelXcMeta},87180:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaDatabricks extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){return this.getAbstractType(e)}getUIDataType(e){switch(e.dt.toLowerCase()){case"bigint":case"tinyint":case"int":case"smallint":return"Number";case"decimal":case"double":case"float":return"Decimal";case"boolean":return"Checkbox";case"timestamp":case"timestamp_ntz":return"DateTime";case"date":return"Date";case"string":return"LongText";default:return"SpecificDBType"}}getAbstractType(e){const t=e.dt.toLowerCase();switch(t){case"bigint":case"tinyint":case"decimal":case"double":case"float":case"int":case"smallint":return"integer";case"binary":case"interval":case"void":return t;case"boolean":return"boolean";case"timestamp":case"timestamp_ntz":return"datetime";case"date":return"date";case"string":return"string"}}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=ModelXcMetaDatabricks},25923:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(29416)),r=i(a(33751)),l=i(a(64404)),c=i(a(63660)),d=i(a(13728)),u=i(a(60312)),p=i(a(87180));t.default=class ModelXcMetaFactory{static create(e,t){if("mysql2"===e.client||"mysql"===e.client)return new r.default(t);if("sqlite3"===e.client)return new d.default(t);if("mssql"===e.client)return new s.default(t);if("pg"===e.client)return new c.default(t);if("oracledb"===e.client)return new l.default(t);if("snowflake"===e.client)return new u.default(t);if("databricks"===e.client)return new p.default(t);throw new Error("Database not supported")}}},29416:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaMssql extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this.renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_getAbstractType(e){let t="";switch(e.dt){case"bigint":t="bigInteger";break;case"binary":case"varbinary":t="binary";break;case"bit":t="bit";break;case"char":case"nchar":case"nvarchar":case"varchar":t="string";break;case"date":t="date";break;case"datetime":case"datetime2":case"smalldatetime":t="datetime";break;case"datetimeoffset":t="datetimeoffset";break;case"decimal":t="decimal";break;case"float":case"real":t="float";break;case"geography":t="geography";break;case"geometry":t="geometry";break;case"heirarchyid":t="heirarchyid";break;case"image":t="image";break;case"int":case"smallint":case"tinyint":t="integer";break;case"money":t="money";break;case"ntext":case"text":t="text";break;case"numeric":t="numeric";break;case"json":t="json";break;case"smallmoney":t="smallmoney";break;case"sql_variant":t="sql_variant";break;case"sysname":t="sysname";break;case"time":t="time";break;case"timestamp":t="timestamp";break;case"uniqueidentifier":t="uniqueidentifier";break;case"xml":t="xml";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){const t=(e.dt||e.dt).toLowerCase();switch(t){case"bigint":case"smallint":case"bit":case"tinyint":case"int":return"integer";case"binary":case"char":case"geography":case"heirarchyid":case"image":case"money":case"nchar":case"nvarchar":case"varchar":return"string";case"date":return"date";case"datetime":case"datetime2":case"smalldatetime":case"datetimeoffset":return"datetime";case"decimal":case"float":case"numeric":case"real":return"float";case"geometry":return"geometry";case"ntext":case"text":return"text";case"json":return"json";case"smallmoney":case"sql_variant":case"sysname":case"uniqueidentifier":case"varbinary":case"xml":return t;case"time":return"time";case"timestamp":return"timestamp"}}}t.default=ModelXcMetaMssql},33751:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaMysql extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this.renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{dbType:this.ctx.dbType,tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_getAbstractType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t="integer";break;case"bigint":t="bigInteger";break;case"float":t="float";break;case"decimal":t="decimal";break;case"double":t="double";break;case"real":t="real";break;case"bit":case"boolean":t="boolean";break;case"serial":t="serial";break;case"date":t="date";break;case"datetime":t="datetime";break;case"timestamp":t="timestamp";break;case"time":t="time";break;case"year":t="year";break;case"char":case"varchar":case"nchar":t="string";break;case"text":case"tinytext":case"mediumtext":case"longtext":t="text";break;case"binary":case"varbinary":t="binary";break;case"blob":t="blob";break;case"tinyblob":t="tinyblob";break;case"mediumblob":t="mediumblob";break;case"longblob":t="longblob";break;case"enum":t="enum";break;case"set":t="set";break;case"geometry":t="geometry";break;case"point":t="point";break;case"linestring":t="linestring";break;case"polygon":t="polygon";break;case"multipoint":t="multipoint";break;case"multilinestring":t="multilinestring";break;case"multipolygon":t="multipolygon";break;case"json":t="json";break;default:t+=`"${e.dt}"`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){switch((e.dt||e.dt).toLowerCase()){case"int":case"smallint":case"mediumint":case"bigint":case"bit":return"integer";case"boolean":return"boolean";case"float":case"decimal":case"double":case"serial":return"float";case"tinyint":return"1"==e.dtxp?"boolean":"integer";case"date":return"date";case"datetime":case"timestamp":return"datetime";case"time":return"time";case"year":return"year";case"char":case"varchar":case"nchar":case"binary":return"string";case"text":case"tinytext":case"mediumtext":case"longtext":case"varbinary":return"text";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"enum":return"enum";case"set":return"set";case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":return"geometry";case"json":return"json"}}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=ModelXcMetaMysql},64404:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaOracle extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this.renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{dbType:this.ctx.dbType,tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_getAbstractType(e){let t="";switch(e.dt){case"char":case"nchar":case"nvarchar2":case"varchar2":case"long":case"raw":case"long raw":case"interval year to month":case"interval day to second":case"clob":case"nclob":t="string";break;case"number":case"numeric":case"float":case"dec":case"decimal":case"real":case"double precision":t="float";break;case"integer":case"int":case"smallint":t="integer";break;case"date":t="date";break;case"timestamp":case"timestamp with time zone":case"timestamp with local time zone":t="timestamp";break;case"bfile":case"blob":t="blob";break;case"rowid":case"urowid":t="bigInteger";break;default:t+=`"${e.dt}"`}return t}getAbstractType(e){switch((e.dt||e.dt).toLowerCase()){case"integer":case"long":case"smallint":return"integer";case"bfile":case"binary rowid":case"binary double":case"binary_float":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"interval day to second":case"interval year to month":case"lob pointer":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"nvarchar2":case"oid":case"pointer":case"raw":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"table":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return"string";case"blob":return"blob";case"date":return"date";case"decimal":case"double precision":case"float":case"real":case"number":return"float";case"time":case"time with tz":return"time";case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":return"datetime"}}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON"}}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=ModelXcMetaOracle},63660:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaPg extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this.renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_getAbstractType(e){let t="";switch(e.dt){case"int":case"integer":case"int2":case"int4":case"int8":case"smallint":t="integer";break;case"bigint":t="bigInteger";break;case"bigserial":t="bigserial";break;case"char":case"character":case"character varying":t="string";break;case"int4range":t="int4range";break;case"int8range":t="int8range";break;case"serial":t="serial";break;case"serial2":t="serial2";break;case"serial8":t="serial8";break;case"bit":t="bit";break;case"bool":case"boolean":t="boolean";break;case"date":t="date";break;case"double precision":t="double";break;case"event_trigger":t="event_trigger";break;case"fdw_handler":t="fdw_handler";break;case"float4":case"float8":case"real":case"money":t="float";break;case"uuid":t="uuid";break;case"smallserial":t="smallserial";break;case"text":t="text";break;case"time":case"time without time zone":case"timetz":case"time with time zone":t="time";break;case"timestamp":case"timestamp without time zone":case"timestamp with time zone":t="timestamp";break;case"timestamptz":t="timestampt";break;case"daterange":t="daterange";break;case"json":t="json";break;case"jsonb":t="jsonb";break;case"gtsvector":t="gtsvector";break;case"index_am_handler":t="index_am_handler";break;case"anyenum":t="enum";break;case"anynonarray":t="anynonarray";break;case"anyrange":t="anyrange";break;case"box":t="box";break;case"bpchar":t="bpchar";break;case"bytea":t="bytea";break;case"cid":t="cid";break;case"cidr":t="cidr";break;case"circle":t="circle";break;case"cstring":t="cstring";break;case"inet":t="inet";break;case"internal":t="internal";break;case"interval":t="interval";break;case"language_handler":t="language_handler";break;case"line":t="line";break;case"lsec":t="lsec";break;case"macaddr":t="macaddr";break;case"name":t="name";break;case"numeric":t="numeric";break;case"numrange":t="numrange";break;case"oid":t="oid";break;case"opaque":t="opaque";break;case"path":t="path";break;case"pg_ddl_command":t="pg_ddl_command";break;case"pg_lsn":t="pg_lsn";break;case"pg_node_tree":t="pg_node_tree";break;case"point":t="point";break;case"polygon":t="polygon";break;case"record":t="record";break;case"refcursor":t="refcursor";break;case"regclass":t="regclass";break;case"regconfig":t="regconfig";break;case"regdictionary":t="regdictionary";break;case"regnamespace":t="regnamespace";break;case"regoper":t="regoper";break;case"regoperator":t="regoperator";break;case"regproc":t="regproc";break;case"regpreocedure":t="regpreocedure";break;case"regrole":t="regrole";break;case"regtype":t="regtype";break;case"reltime":t="reltime";break;case"smgr":t="smgr";break;case"tid":t="tid";break;case"tinterval":t="tinterval";break;case"trigger":t="trigger";break;case"tsm_handler":t="tsm_handler";break;case"tsquery":t="tsquery";break;case"tsrange":t="tsrange";break;case"tstzrange":t="tstzrange";break;case"tsvector":t="tsvector";break;case"txid_snapshot":t="txid_snapshot";break;case"unknown":t="unknown";break;case"void":t="void";break;case"xid":t="xid";break;case"xml":t="xml";break;default:t+=`"${e.dt}"`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){const t=e.dt.toLowerCase();switch(t){case"anyenum":case"enum":return"enum";case"anynonarray":case"anyrange":case"bpchar":case"bytea":case"cid":case"cidr":case"cstring":case"event_trigger":case"fdw_handler":case"gtsvector":case"index_am_handler":case"inet":case"language_handler":case"lsec":case"macaddr":case"money":case"name":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":return t;case"bit":case"bigint":case"bigserial":case"int":case"int2":case"int4":case"int8":case"integer":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"tinyint":case"mediumint":return"integer";case"bool":case"boolean":return"boolean";case"char":case"character":case"character varying":case"daterange":case"int4range":case"int8range":case"internal":case"interval":case"uuid":case"year":case"varchar":case"nchar":return"string";case"date":return"date";case"double precision":case"float4":case"float8":case"numeric":case"real":case"float":case"decimal":case"double":return"float";case"json":case"jsonb":return"json";case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":return"text";case"time":case"time without time zone":case"timetz":case"time with time zone":return"time";case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"datetime":return"datetime";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"set":return"set";case"line":case"point":case"polygon":case"circle":case"box":case"geometry":case"linestring":case"multipoint":case"multilinestring":case"multipolygon":return"geometry"}}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=ModelXcMetaPg},60312:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaSnowflake extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this.renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_getAbstractType(e){let t="";switch(e.dt){case"int":case"integer":case"int2":case"int4":case"int8":case"smallint":t="integer";break;case"bigint":t="bigInteger";break;case"bigserial":t="bigserial";break;case"char":case"character":case"character varying":t="string";break;case"int4range":t="int4range";break;case"int8range":t="int8range";break;case"serial":t="serial";break;case"serial2":t="serial2";break;case"serial8":t="serial8";break;case"bit":t="bit";break;case"bool":case"boolean":t="boolean";break;case"date":t="date";break;case"double precision":t="double";break;case"event_trigger":t="event_trigger";break;case"fdw_handler":t="fdw_handler";break;case"float4":case"float8":case"real":case"money":t="float";break;case"uuid":t="uuid";break;case"smallserial":t="smallserial";break;case"text":t="text";break;case"time":case"time without time zone":case"timetz":case"time with time zone":t="time";break;case"timestamp":case"timestamp without time zone":case"timestamp with time zone":t="timestamp";break;case"timestamptz":t="timestampt";break;case"daterange":t="daterange";break;case"json":t="json";break;case"jsonb":t="jsonb";break;case"gtsvector":t="gtsvector";break;case"index_am_handler":t="index_am_handler";break;case"anyenum":t="enum";break;case"anynonarray":t="anynonarray";break;case"anyrange":t="anyrange";break;case"box":t="box";break;case"bpchar":t="bpchar";break;case"bytea":t="bytea";break;case"cid":t="cid";break;case"cidr":t="cidr";break;case"circle":t="circle";break;case"cstring":t="cstring";break;case"inet":t="inet";break;case"internal":t="internal";break;case"interval":t="interval";break;case"language_handler":t="language_handler";break;case"line":t="line";break;case"lsec":t="lsec";break;case"macaddr":t="macaddr";break;case"name":t="name";break;case"numeric":t="numeric";break;case"numrange":t="numrange";break;case"oid":t="oid";break;case"opaque":t="opaque";break;case"path":t="path";break;case"pg_ddl_command":t="pg_ddl_command";break;case"pg_lsn":t="pg_lsn";break;case"pg_node_tree":t="pg_node_tree";break;case"point":t="point";break;case"polygon":t="polygon";break;case"record":t="record";break;case"refcursor":t="refcursor";break;case"regclass":t="regclass";break;case"regconfig":t="regconfig";break;case"regdictionary":t="regdictionary";break;case"regnamespace":t="regnamespace";break;case"regoper":t="regoper";break;case"regoperator":t="regoperator";break;case"regproc":t="regproc";break;case"regpreocedure":t="regpreocedure";break;case"regrole":t="regrole";break;case"regtype":t="regtype";break;case"reltime":t="reltime";break;case"smgr":t="smgr";break;case"tid":t="tid";break;case"tinterval":t="tinterval";break;case"trigger":t="trigger";break;case"tsm_handler":t="tsm_handler";break;case"tsquery":t="tsquery";break;case"tsrange":t="tsrange";break;case"tstzrange":t="tstzrange";break;case"tsvector":t="tsvector";break;case"txid_snapshot":t="txid_snapshot";break;case"unknown":t="unknown";break;case"void":t="void";break;case"xid":t="xid";break;case"xml":t="xml";break;default:t+=`"${e.dt}"`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){const t=e.dt.toLowerCase();switch(t){case"anyenum":case"enum":return"enum";case"anynonarray":case"anyrange":case"bpchar":case"bytea":case"cid":case"cidr":case"cstring":case"event_trigger":case"fdw_handler":case"gtsvector":case"index_am_handler":case"inet":case"language_handler":case"lsec":case"macaddr":case"money":case"name":case"numeric":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":return t;case"bit":case"bigint":case"bigserial":case"int":case"int2":case"int4":case"int8":case"integer":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"tinyint":case"mediumint":return"integer";case"bool":case"boolean":return"boolean";case"char":case"character":case"character varying":case"daterange":case"double precision":case"int4range":case"int8range":case"internal":case"interval":case"uuid":case"year":case"varchar":case"nchar":return"string";case"date":return"date";case"float4":case"float8":case"real":case"float":case"decimal":case"double":return"float";case"json":case"jsonb":return"json";case"text":return e.dtxp<1024?"string":"text";case"time":case"time without time zone":case"timetz":case"time with time zone":return"time";case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"datetime":return"datetime";case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":return"text";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"set":return"set";case"line":case"point":case"polygon":case"circle":case"box":case"geometry":case"linestring":case"multipoint":case"multilinestring":case"multipolygon":return"geometry"}}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=ModelXcMetaSnowflake},13728:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(85544));class ModelXcMetaSqlite extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this.renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this.renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this.renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_getAbstractType(e){let t="";switch(e.dt){case"int":case"integer":case"tinyint":case"smallint":case"mediumint":case"int2":case"int8":t="integer";break;case"bigint":t="bigInteger";break;case"character":case"varchar":t="string";break;case"blob sub_type text":case"text":t="text";break;case"numeric":case"real":case"float":t="float";break;case"blob":t="blob";break;case"double":case"double precision":t="decimal";break;case"boolean":t="boolean";break;case"date":t="date";break;case"datetime":t="datetime";break;case"timestamp":t="timestamp";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.replace(/\(\d+\)$/,"").toLowerCase()){case"date":return"date";case"datetime":case"timestamp":return"datetime";case"integer":case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":return"integer";case"text":return"text";case"boolean":return"boolean";case"real":case"double":case"double precision":case"float":case"numeric":return"float";case"blob sub_type text":case"blob":return"blob";case"character":case"varchar":return"string"}}}t.default=ModelXcMetaSqlite},10024:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class SwaggerTypes{static setSwaggerType(e,t,a="mysql"){switch(a){case"mysql":case"mysql2":case"mariadb":SwaggerTypes.setSwaggerTypeForMysql(e,t);break;case"pg":SwaggerTypes.setSwaggerTypeForPg(e,t);break;case"mssql":SwaggerTypes.setSwaggerTypeForMssql(e,t);break;case"sqlite3":SwaggerTypes.setSwaggerTypeForSqlite(e,t)}}static setSwaggerTypeForMysql(e,t){switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":t.type="integer";break;case"float":case"decimal":case"real":t.type="number";break;case"double":t.type="number",t.format="double";break;case"boolean":t.type="boolean";break;case"serial":case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":default:t.type="string";break;case"binary":t.type="string",t.format="binary";break;case"json":t.type="object"}}static setSwaggerTypeForPg(e,t){switch(e.dt){case"int":case"integer":case"bigint":case"bigserial":case"int2":case"int4":case"int8":case"int4range":case"int8range":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":t.type="integer";break;case"char":case"character":case"bit":case"date":case"character varying":case"text":case"time":case"time without time zone":case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"timetz":case"time with time zone":case"daterange":case"gtsvector":case"index_am_handler":case"anyenum":case"anynonarray":case"anyrange":case"box":case"bpchar":case"bytea":case"cid":case"cidr":case"circle":case"cstring":case"inet":case"internal":case"interval":case"language_handler":case"line":case"lsec":case"macaddr":case"money":case"name":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"point":case"polygon":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":default:t.type="string";break;case"bool":case"boolean":t.type="boolean";break;case"double precision":t.type="number",t.format="double";break;case"event_trigger":case"fdw_handler":case"float4":case"float8":case"real":case"numeric":t.type="number",t.format="float";break;case"uuid":t.type="string",t.format="uuid";break;case"json":case"jsonb":t.type="object"}}static setSwaggerTypeForMssql(e,t){switch(e.dt){case"bigint":case"int":case"tinyint":case"smallint":case"bit":t.type="integer";break;case"binary":t.type="string",t.format="binary";break;case"char":case"date":case"datetime":case"datetime2":case"datetimeoffset":case"geography":case"geometry":case"heirarchyid":case"image":case"money":case"nchar":case"ntext":case"nvarchar":case"smalldatetime":case"smallmoney":case"sql_variant":case"sysname":case"text":case"time":case"timestamp":case"uniqueidentifier":case"varbinary":case"xml":case"varchar":default:t.type="string";break;case"decimal":case"float":case"numeric":case"real":t.type="number",t.format="float";break;case"json":t.type="object"}}static setSwaggerTypeForSqlite(e,t){switch(e.dt){case"int":case"integer":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":t.type="integer";break;case"character":case"numeric":case"real":case"float":t.type="number";break;case"double":case"double precision":t.type="number",t.format="double";break;case"boolean":t.type="boolean";break;default:t.type="string"}}}t.default=SwaggerTypes},93260:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(62520)),r=i(a(61660));class ProjectMgrv2{static getSqlMgr(e,t,a=null){return a?new s.default(e,t,a):(this.sqlMgrMap[t.id]||(this.sqlMgrMap[t.id]=new s.default(e,t)),this.sqlMgrMap[t.id])}static async getSqlMgrTrans(e,t,a,i){const s=new r.default(e,t,a,i);return await s.startTransaction(i),s}}ProjectMgrv2.sqlMgrMap={},t.default=ProjectMgrv2},62520:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71068)),r=i(a(27464)),l=i(a(98152)),c=i(a(82096)),d=new l.default("SqlMgr");t.default=class SqlMgrv2{constructor(e,t,a=null){d.api("constructor:args:",t),this._migrator=new r.default(e,t),this.ncMeta=a,this.context=e}async migrator(e){return this._migrator}static async testConnection(e={}){const t=await s.default.create(e),a=await t.testConnection();return await t.knex.destroy(),a}async sqlOp(e,t,a){const i=this.sqlOp.name;d.api(`${i}:args:`,e,t,a);const s=await this.getSqlClient(e);return await s[t](a)}async sqlOpPlus(e,t,a){var i;const s=this.sqlOpPlus.name;d.api(`${s}:args:`,e,t,a),(null===(i=e.getConfig())||void 0===i?void 0:i.schema)&&(a=Object.assign(Object.assign({},a),{schema:e.getConfig().schema}));const r=await this.getSqlClient(e);return await r[t](a)}async getSqlClient(e){return e.is_meta&&this.ncMeta?c.default.getSqlClient(e,this.ncMeta.knex):c.default.getSqlClient(e)}}},61660:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(49588)),r=i(a(62520)),l=i(a(82096));class SqlMgrv2Trans extends r.default{constructor(e,t,a,i){super(e,t),this.baseId=t.id,this.ncMeta=a,this.source=i}async migrator(){return new s.default(this.context,{id:this.baseId},await this.getSqlClient(this.source),this.ncMeta)}async startTransaction(e){const t=await l.default.get(e);this.trx=await t.transaction()}async commit(){this.trx&&(await this.trx.commit(),this.trx=null)}async rollback(e){this.trx&&(await this.trx.rollback(e),this.trx=null)}async getSqlClient(e){return l.default.getSqlClient(e,this.trx)}async sqlOp(e,t,a){return super.sqlOp(e,t,a)}async sqlOpPlus(e,t,a){return super.sqlOpPlus(e,t,a)}}t.default=SqlMgrv2Trans},27464:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=c(a(2058)),u=c(a(67072)),p=a(50970),m=a(5114),_=c(a(98152)),f=c(a(29896)),h=r(a(188)),g=c(a(58108)),y=c(a(71068)),b=c(a(82096)),w=c(a(76584)),v=c(a(30136)),T=new f.default,k=new _.default("KnexMigrator"),S="nc_migrations";t.default=class KnexMigratorv2{constructor(e,t){this.toolDir=process.cwd(),this.baseId=t.id,this.context=e}get metaDb(){return w.default.ncMeta.knex}async getProject(){return v.default.getWithInfo(this.context,this.baseId)}emit(e,t){k.api(e),T.evt.emit("UI",{status:0,data:`Migrator : ${e}`})}emitW(e,t){k.warn(e),T.evt.emit("UI",{status:1,data:e})}emitE(e,t){k.error(e),T.evt.emit("UI",{status:-1,data:e})}_getWorkingEnvDir(e){return u.default.join(this.toolDir,"nc",this.baseId,e.dbAlias,"migrations")}async _initAllEnvOnFilesystem(){for(const e of(await this.getProject()).sources)await this._initDbOnFs(e)}async _initDbOnFs(e){}async _initDbWithSql(e){var t;const a=await this.getSqlClient(e),i=await e.getConnectionConfig();"oracledb"===i.client?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.user}`),await a.createDatabaseIfNotExists({database:i.connection.user})):e.isMeta(!0,1)&&"pg"===e.type?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.database}`),await a.createDatabaseIfNotExists({database:i.connection.database,schema:null===(t=e.getConfig())||void 0===t?void 0:t.schema})):"databricks"===e.type?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.database}`),await a.createDatabaseIfNotExists({database:i.connection.database,schema:i.connection.schema})):"sqlite3"!==i.client?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.database}`),await a.createDatabaseIfNotExists({database:i.connection.database})):(this.emit(`${i.client}: Creating DB if not exists ${i.connection.connection.filename}`),await a.createDatabaseIfNotExists({database:i.connection.connection.filename}))}async getSqlClient(e){return b.default.getSqlClient(e)}async _cleanDbWithSql(e){const t=await y.default.create(e);"oracledb"===e.client?(this.emit(`Dropping DB : ${e.connection.user}`),await t.dropDatabase({database:e.connection.user})):"sqlite3"===e.client?(this.emit(`Dropping DB : ${e.connection.connection.filename}`),await t.dropDatabase({database:e.connection.connection.filename})):(this.emit(`Dropping DB : ${e.connection.database}`),await t.dropDatabase({database:e.connection.database}))}async _initEnvDbsWithSql(e){this.emit(`Initialising source: ${e.alias}`),await this._initDbWithSql(e)}async _migrationsUp(e){var{source:t}=e,a=l(e,["source"]);const i=new g.default;if(i.data.object={},i.data.object.list=[],process.env.NC_MIGRATIONS_DISABLED)return i;try{const{onlyList:e}=a;let s,r,{migrationSteps:l}=a;if(!l&&!a.file)return i.code=-1,i.message="Neither num of steps nor file is specified for migration",k.debug("Neither num of steps nor file is specified for migration"),k.debug("See help"),i;this.metaDb?r=s=await this.metaDb(S).where({base_id:this.baseId,db_alias:t.id}).orderBy("id","asc"):(s=await(0,m.glob)(a.upFilesPattern),r=await(0,m.glob)(a.downFilesPattern));const c=await this.getSqlClient(t);let u=await c.selectAll(c.getTnPath("nc_evolutions"));if(this.suffix&&(u=u.filter((e=>e.title.includes(this.suffix)))),s.length===u.length){this.emit(`Evolutions are upto date for ' env : ${t.alias} '`);for(let e=0;e<u.length;++e)i.data.object.list.push({title:u[e].title,titleDown:u[e].titleDown,status:!1});i.data.object.pending=s.length-u.length}else if(s.length>u.length||e){this.emit(`Number of evolutions pending for 'env:${t.alias}': '${s.length-u.length}'`),i.data.object.pending=s.length-u.length;let m=0;if(0!==u.length){const e=u[u.length-1];let t=0;for(;t<s.length;++t)if(this.metaDb){if(-1!==s[t].title.indexOf(e.title)){t++;break}}else if(-1!==s[t].indexOf(e.title)){t++;break}m=t}try{if(!l){let e=0;for(let t=m;t<s.length;++t)if(l++,this.metaDb){if(s[t].title.includes(a.file)){e=1;break}}else if(s[t].includes(a.file)){e=1;break}if(!e)return void k.debug(`Error : There is no file ${a.file} in migration directory`)}if(e)if(this.metaDb)for(let e=0;e<m;++e)i.data.object.list.push({title:s[e].title,titleDown:r[e].title_down,status:!1});else for(let e=0;e<m;++e){const t=s[e].split("/"),a=r[e].split("/");i.data.object.list.push({title:t[t.length-1],titleDown:a[t.length-1],status:!1})}const t=[],u=[];for(let c=m;c<s.length&&c<m+l;++c){let l,m;if(this.metaDb)l=s[c].title,m=s[c].title_down;else{const e=s[c].split("/");l=e[e.length-1];const t=r[c].split("/");m=t[t.length-1]}if(e)k.debug(l),i.data.object.list.push({title:l,titleDown:m,status:!0});else{let e;e=this.metaDb?s[c].up:await(0,p.promisify)(d.default.readFile)(s[c],"utf8"),a.sqlContentMigrate&&t.push(...e.split(/\/\*\s*xc[\s\S]*?\s*\*\//).filter((e=>e.trim()))),u.push({title:l,titleDown:m,status:0})}}if(e);else{const e=this,a=c.knex.isTransaction?c.knex:await c.knex.transaction();try{for(const i of t)await a.raw(i),e.emit(`'${i}' : Executed SQL query`);for(const t of u)await a(c.getTnPath("nc_evolutions")).insert(t),e.emit(`'${t.title}' : Updating bookkeeping of SQL UP migration - done`);c.knex.isTransaction||await a.commit()}catch(t){throw c.knex.isTransaction||await a.rollback(),e.emitW("Migration operation failed, Database restored to previous state"),k.ppe(t,""),t}}}catch(e){throw this.emitE(`Error while migrating up : ${e.code} and ${e.message}`),k.debug(e),e}}else i.data.object.pending=-1,this.emitE("Evolutions are dirty - reset the whole thing please")}catch(e){throw k.debug("Error in evolutionUp",e),i.code=-1,i.message=e.message,e}return i}async _migrationsDown(e){var{source:t}=e,a=l(e,["source"]);if(process.env.NC_MIGRATIONS_DISABLED)return;let{migrationSteps:i}=a;const{onlyList:s}=a;if(!i&&!a.file)return k.debug("Neither num of steps nor file is specified for migartion"),void k.debug("See help");a.onlyList?k.debug("Pending migration list:"):k.debug("Migrating Down:");try{let e;e=this.metaDb?await this.metaDb(S).where({base_id:this.baseId,db_alias:t.id}).orderBy("title","asc"):await(0,m.glob)(a.downFilesPattern);const r=await this.getSqlClient(t),l=await r.selectAll(r.getTnPath("nc_evolutions"));if(l.length)try{if(!i){let t=0;for(let s=l.length-1;s>=0;--s)if(i++,this.metaDb){if(e[s].title_down.includes(a.file)){t=1;break}}else if(e[s].includes(a.file)){t=1;break}if(!t)return void k.debug(`Error : There is no file ${a.file} in migration directory`)}const t=[],c=[];for(let r=l.length-1,u=0;r>=0&&u<i;--r,++u){let i;if(this.metaDb)i=e[r].title_down;else{const t=e[r].split("/");i=t[t.length-1]}if(s)k.debug(i);else{let s;this.emit(`Migrating Down: '${i}'`),s=this.metaDb?e[r].down:await(0,p.promisify)(d.default.readFile)(e[r],"utf8"),a.sqlContentMigrate&&t.push(...s.split(/\/\*\s*xc[\s\S]*?\s*\*\//).filter((e=>e.trim()))),c.push({titleDown:i})}}const u=this,m=r.knex.isTransaction?r.knex:await r.knex.transaction();try{for(const e of t)await m.raw(e).transacting(m),u.emit(`'${e}' : Executed SQL query`);for(const e of c)u.emit(`'${e.titleDown}' : Updating bookkeeping of SQL DOWN migration - done`),await m(r.getTnPath("nc_evolutions")).where(e).del();r.knex.isTransaction||await m.commit()}catch(e){throw r.knex.isTransaction||await m.rollback(),u.emitW("Migration operation failed, Database restored to previous state"),k.ppe(e,""),e}}catch(e){throw e}}catch(e){k.debug("Error in evolutionUp",e)}}async init(e){const t=this.init.name;k.api(`${t}:args:`,e),k.debug(e);try{await this._initAllEnvOnFilesystem()}catch(e){throw k.debug("Error in creating migration base:",e),e}}async sync(e){const t=this.sync.name;k.api(`${t}:args:`,e);try{if(e)await this._initEnvDbsWithSql(e);else for(const e of(await this.getProject()).sources)await this._initEnvDbsWithSql(e)}catch(e){throw k.debug("Error in creating migration base:",e),e}}async migrationsCreate(e){const t=this.migrationsCreate.name;k.api(`${t}:args:`,e);try{const t=`${h.getUniqFilenamePrefix()}${this.suffix}`,a=h.getFilenameForUp(t),i=h.getFilenameForDown(t);return await this.metaDb(S).insert({base_id:e.base_id,db_alias:e.id,up:"",down:"",title:a,title_down:i}),this.emit(`Migration files created successfully : '${a}' and '${i}'`),{up:a,down:i}}catch(e){throw k.debug(e),e}}async migrationsDelete(e={}){const t=this.migrationsDelete.name,a=new g.default;return k.api(`${t}:args:`,e),a}async migrationsUp(e){var{source:t}=e,a=l(e,["source"]);const i=this.migrationsUp.name;return k.api(`${i}:args:`,a),await this._migrationsUp({source:t,migrationSteps:a.migrationSteps,file:a.file,onlyList:a.onlyList,title:`${this.toolDir}`,sqlContentMigrate:a.sqlContentMigrate,sqlClient:a.sqlClient})}async migrationsDown(e){var{source:t}=e,a=l(e,["source"]);const i=this.migrationsDown.name;k.api(`${i}:args:`,a),await this._migrationsDown({source:t,migrationSteps:a.migrationSteps,onlyList:a.onlyList,file:a.file,title:"nc_evolutions",sqlContentMigrate:a.sqlContentMigrate})}async migrationsWrite(e){var{source:t}=e,a=l(e,["source"]);const i=this.migrationsWrite.name;k.api(`${i}:args:`,a);try{let e="",i="";for(let t=0;t<a.upStatement.length;t++)e=`${e+a.upStatement[t].sql};`;k.debug("migrationsWrite: created up statement",e);for(let e=0;e<a.downStatement.length;e++)i=`${i+a.downStatement[e].sql};`;k.debug("migrationsWrite: created downStatement",i),this.metaDb?await this.metaDb(S).where({base_id:t.base_id,db_alias:t.id,title:a.up}).first()?await this.metaDb(S).update({up:e,down:i}).where({base_id:this.baseId,db_alias:t.id,title:a.up}):await this.metaDb(S).insert({base_id:this.baseId,db_alias:t.id,up:e,down:i,title:a.up,title_down:a.down}):(await(0,p.promisify)(d.default.writeFile)(u.default.join(this._getWorkingEnvDir(a),a.up),e,"utf-8"),k.debug("migrationsWrite: wrote to file",a.up),await(0,p.promisify)(d.default.writeFile)(u.default.join(this._getWorkingEnvDir(a),a.down),i,"utf-8")),k.debug("migrationsWrite: wrote to file",a.down)}catch(e){k.debug("migrationsWrite error: ",e)}}async migrationsList(e){return await this.migrationsUp(e)}async migrationsToSql(e){const t=new g.default;try{if(t.data.object={up:"",down:""},this.metaDb){const a=await this.metaDb(S).where({db_alias:e.dbAlias,base_id:this.baseId,title:e.title}).first();t.data.object.up=a.up,t.data.object.down=a.down}else{const a=u.default.join(this.toolDir,"nc",this.baseId,e.dbAlias,"migrations",e.title),i=u.default.join(this.toolDir,"nc",this.baseId,e.dbAlias,"migrations",e.titleDown);t.data.object.up=await(0,p.promisify)(d.default.readFile)(a,"utf8"),t.data.object.down=await(0,p.promisify)(d.default.readFile)(i,"utf8")}console.log("migrationsToSql",t.data.object)}catch(e){console.log("migrationsToSql",e)}return t}async migrationsSquash(){}async migrationsCreateManually(){}async _writeProjectJson(e,t){const a=u.default.join(e,"config.xc.json");await(0,p.promisify)(d.default.writeFile)(a,JSON.stringify("",null,2),"utf-8")}async migrationsRenameEnv(e){}async migrationsUpdateEnvDb(e){throw new Error("Not implemented")}async migrationsDeleteEnvDb(e){throw new Error("Not implemented")}async migrationsUpWithExternalClient(e){throw new Error("Not implemented")}async migrationsDownWithExternalClient(e){throw new Error("Not implemented")}get suffix(){return""}}},49588:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(27464)),r=i(a(76584)),l=i(a(82096));class KnexMigratorv2Tans extends s.default{constructor(e,t,a=null,i=r.default.ncMeta){super(e,t),this.sqlClient=a,this.ncMeta=i}get metaDb(){return this.ncMeta.knex||r.default.ncMeta.knex}async getSqlClient(e){return this.sqlClient||l.default.getSqlClient(e)}}t.default=KnexMigratorv2Tans},98152:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=l(a(16512)),d=l(a(89576));Promise.resolve().then((()=>r(a(98904))));const u=l(a(31964));t.default=class Debug{constructor(e){this.namespace=e,this.api=(0,d.default)(`${e}_A`),this.warn=(0,d.default)(`${e}_W`),this.info=(0,d.default)(`${e}_I`),this.error=(0,d.default)(`${e}_E`),this.debug=(0,d.default)(`${e}_D`),u.default.createNamespace(e)}ppException(e,t=null){let a="";return a+=`                                              EXCEPTION OCCURED!! in ${this.namespace.red.bold} @ ${t}`,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,a+="MESSAGE:\n".yellow.bold,a+=`${e.message}\n`.yellow.bold,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,a+="CODE:\n".yellow.bold,a+=`${e.code}\n`.yellow.bold,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,a+="STACK:\n".yellow.bold,a+=`${e.stack}\n`.yellow.bold,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,console.log((0,c.default)(a,{padding:1,borderStyle:"double"})),console.log(e),a}ppe(e,t){return this.ppException(e,t)}}},31964:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(89576)),r={},l={api:"A",info:"I",error:"E",warn:"W",debug:"D"};t.default=class DebugMgr{static _create(e){r[e]?(r[e][`${e}_A`].enabled=s.default.enabled(`${e}_A`),r[e][`${e}_D`].enabled=s.default.enabled(`${e}_D`),r[e][`${e}_I`].enabled=s.default.enabled(`${e}_I`),r[e][`${e}_W`].enabled=s.default.enabled(`${e}_W`),r[e][`${e}_E`].enabled=s.default.enabled(`${e}_E`)):(r[e]={},r[e][`${e}_A`]={level:"api",enabled:s.default.enabled(`${e}_A`)},r[e][`${e}_W`]={level:"warn",enabled:s.default.enabled(`${e}_W`)},r[e][`${e}_I`]={level:"info",enabled:s.default.enabled(`${e}_I`)},r[e][`${e}_E`]={level:"error",enabled:s.default.enabled(`${e}_E`)},r[e][`${e}_D`]={level:"debug",enabled:s.default.enabled(`${e}_D`)})}static createNamespace(e){e in r||this._create(e)}static getNamespaces(){return r}static refreshNamespace(e){this._create(e)}static enable(e,t){const a=`${e}_${l[t]},${s.default.disable()}`;s.default.enable(`${a}`),this.refreshNamespace(e)}static disable(e,t){const a=`${e}_${l[t]}`;let i=`${s.default.disable()}`;i=i.replace(a,""),s.default.enable(i),this.refreshNamespace(e)}static enableAll(e){for(const t in l)s.default.enable(`${e}_${l[t]}`),this.refreshNamespace(e)}static disableAll(){s.default.disable()}}},58108:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class Result{constructor(e=0,t="",a={}){this.code=e,this.message=t,this.data=a}}},7228:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.customValidators=void 0;const s=i(a(33848));t.customValidators={isCurrency:s.default.isFloat}},29896:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(28010));let r=null;t.default=class Emit{constructor(){if(r)return r;this.evt=new s.default,r=this}}},188:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameForDown=t.getFilenameForUp=t.getUniqFilenamePrefix=void 0;const s=i(a(44578));t.getUniqFilenamePrefix=function(){return(0,s.default)().format("YYYYMMDD_HHmmssSSS")};t.getFilenameForUp=function(e){return e+".up.sql"};t.getFilenameForDown=function(e){return e+".down.sql"}},26212:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TenantContext=void 0;const i=a(23324);t.TenantContext=(0,i.createParamDecorator)(((e,t)=>t.switchToHttp().getRequest().context))},68544:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalExceptionFilter=void 0;const u=a(23324),p=a(62192),m=a(74272),_=d(a(54784)),f=a(71040),h=d(a(57804)),g=a(64612),y=a(43820);let b=i=class GlobalExceptionFilter{constructor(e){this.sentryClient=e,this.logger=new u.Logger(i.name)}catch(e,t){var a,i,s,r,l,c;const d=t.switchToHttp(),p=d.getResponse(),b=d.getRequest();"BadRequestException"===e.name&&400===e.status&&/^Unexpected token .*? in JSON/.test(e.message)&&(e=new y.NcBaseErrorv2(f.NcErrorType.BAD_JSON));const w=e instanceof y.NcBaseError?null:(0,y.extractDBError)(e);if("true"!==process.env.NC_ENABLE_ALL_API_ERROR_LOGGING&&(w||e instanceof y.BadRequest||e instanceof y.AjvError||e instanceof y.Unauthorized||e instanceof y.Forbidden||e instanceof y.NotFound||e instanceof y.UnprocessableEntity||e instanceof y.SsoError||e instanceof u.NotFoundException||e instanceof m.ThrottlerException||e instanceof y.ExternalError||e instanceof y.NcBaseErrorv2&&![f.NcErrorType.INTERNAL_SERVER_ERROR,f.NcErrorType.DATABASE_ERROR,f.NcErrorType.UNKNOWN_ERROR].includes(e.error))||this.logError(e,b),e instanceof m.ThrottlerException){const t=`throttler:${(0,_.default)({ip:b.ip,baseId:b.ncBaseId,workspaceId:b.ncWorkspaceId,path:b.path})}`;h.default.get(t,g.CacheGetType.TYPE_OBJECT).then((a=>{if(a){a.count+=1;const i=Math.floor((a.timestamp+3e5-Date.now())/1e3);i>0&&h.default.setExpiring(t,a,i).catch((e=>{this.logger.error(e)})),a.count%50==0&&this.logger.warn(`ThrottlerException: ${e.message}, Path: ${b.path}, Workspace ID: ${b.ncWorkspaceId}, Base ID: ${b.ncBaseId}, Requests in last 5 minutes: ${a.count}`)}else this.logger.warn(`ThrottlerException: ${e.message}, Path: ${b.path}, Workspace ID: ${b.ncWorkspaceId}, Base ID: ${b.ncBaseId}`),h.default.setExpiring(t,{value:!0,count:1,timestamp:Date.now()},300).catch((e=>{this.logger.error(e)}))})).catch((e=>{this.logger.error(e)}))}if(e instanceof y.SsoError||"/sso/:clientId/redirect"===(null===(a=b.route)||void 0===a?void 0:a.path)){e instanceof y.SsoError||this.logger.warn(e.message,e.stack);const t=`${b.dashboardUrl}?ui-redirect=${encodeURIComponent(`/sso?error=${encodeURIComponent(e.message)}`)}`;return p.redirect(t)}return e instanceof u.NotFoundException?(this.logger.debug(e.message,e.stack),p.status(404).json({msg:e.message})):w?p.status(400).json(w):e instanceof y.BadRequest||400===(null===(i=e.getStatus)||void 0===i?void 0:i.call(e))?p.status(400).json({msg:e.message}):e instanceof y.Unauthorized||401===(null===(s=e.getStatus)||void 0===s?void 0:s.call(e))?p.status(401).json({msg:e.message}):e instanceof y.Forbidden||403===(null===(r=e.getStatus)||void 0===r?void 0:r.call(e))?p.status(403).json({msg:e.message}):e instanceof y.NotFound||404===(null===(l=e.getStatus)||void 0===l?void 0:l.call(e))?p.status(404).json({msg:e.message}):e instanceof y.AjvError?p.status(400).json({msg:e.message,errors:e.errors}):e instanceof y.UnprocessableEntity?p.status(422).json({msg:e.message}):e instanceof y.NcBaseErrorv2?p.status(e.code).json({error:e.error,message:e.message,details:e.details}):void((null===(c=e.getStatus)||void 0===c?void 0:c.call(e))?p.status(e.getStatus()).json(e.getResponse()):(this.captureException(e,b),p.status(400).json({msg:e.message})))}captureException(e,t){var a;null===(a=this.sentryClient)||void 0===a||a.instance().captureException(e)}logError(e,t){this.logger.error(e.message,e.stack)}};t.GlobalExceptionFilter=b,t.GlobalExceptionFilter=b=i=r([(0,u.Catch)(),c(0,(0,u.Optional)()),c(0,(0,p.InjectSentry)()),l("design:paramtypes",["function"==typeof(s=void 0!==p.SentryService&&p.SentryService)?s:Object])],b)},93076:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},m=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},_=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SocketGateway=void 0;const f=_(a(87968)),h=a(23324),g=a(98496),y=a(82160),b=a(70816),w=a(87412),v=a(58208),T=a(62304),k=a(99236),S=a(87424);let M=new URL(process.env.NC_PUBLIC_URL||`http://localhost:${process.env.PORT||"8080"}/`).pathname;M+=M.endsWith("/")?"":"/";let O=class SocketGateway{constructor(e,t,a){this.jwtStrategy=e,this.telemetryService=t,this.httpAdapterHost=a,this.clients={},this._jobs={}}async onModuleInit(){this.server.use((async(e,t)=>{try{const t=new w.ExecutionContextHost([e.handshake]),a=new((0,b.AuthGuard)("jwt"))(t);await a.canActivate(t)}catch(e){}t()})).on("connection",(e=>{var t,a;this.clients[e.id]=e;const i=(s=(process.env.NC_SERVER_UUID||T.T.id)+(null===(a=null===(t=null==e?void 0:e.handshake)||void 0===t?void 0:t.user)||void 0===a?void 0:a.id),f.default.createHash("md5").update(s).digest("hex"));var s;e.on("page",(e=>{this.telemetryService.sendEvent(Object.assign(Object.assign({evt_type:"$pageview"},e),{id:i}))})),e.on("event",(e=>{var{event:t}=e,a=m(e,["event"]);this.telemetryService.sendEvent(Object.assign(Object.assign({evt_type:t},a),{id:i}))}))}))}get io(){return this.server}};t.SocketGateway=O,d([(0,v.WebSocketServer)(),u("design:type","function"==typeof(l=void 0!==y.Server&&y.Server)?l:Object)],O.prototype,"_io",void 0),d([(0,v.WebSocketServer)(),u("design:type","function"==typeof(c=void 0!==y.Server&&y.Server)?c:Object)],O.prototype,"server",void 0),t.SocketGateway=O=d([(0,v.WebSocketGateway)({cors:{origin:"*",allowedHeaders:["xc-auth"],credentials:!0},namespace:M}),(0,h.Injectable)(),p(2,(0,h.Inject)(g.HttpAdapterHost)),u("design:paramtypes",["function"==typeof(i=void 0!==k.JwtStrategy&&k.JwtStrategy)?i:Object,"function"==typeof(s=void 0!==S.TelemetryService&&S.TelemetryService)?s:Object,"function"==typeof(r=void 0!==g.HttpAdapterHost&&g.HttpAdapterHost)?r:Object])],O)},34608:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.DataApiLimiterGuard=void 0;const s=a(23324);let r=class DataApiLimiterGuard{async canActivate(e){return!0}};t.DataApiLimiterGuard=r,t.DataApiLimiterGuard=r=i([(0,s.Injectable)()],r)},23668:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalGuard=void 0;const l=a(23324),c=a(70816),d=a(40224),u=a(71040),p=a(99236);let m=class GlobalGuard extends((0,c.AuthGuard)(["jwt"])){constructor(e){super(),this.jwtStrategy=e}async canActivate(e){var t;let a;const i=e.switchToHttp().getRequest();if(null===(t=i.headers)||void 0===t?void 0:t["xc-auth"])try{a=await this.extractBoolVal(super.canActivate(e))}catch(e){console.log(e)}if(a&&!i.headers["xc-shared-base-id"]&&-1===i.path.indexOf("/user/me")&&i.header("xc-preview")&&["owner","creator"].some((e=>{var t;return null===(t=i.user.roles)||void 0===t?void 0:t[e]})))return i.user=Object.assign(Object.assign({},i.user),{isAuthorized:!0,roles:(0,u.extractRolesObj)(i.header("xc-preview"))});if(a)return!0;if(i.headers["xc-token"]){let t=!1;try{const a=new((0,c.AuthGuard)("authtoken"))(e);t=await this.extractBoolVal(a.canActivate(e))}catch(e){}if(t)return this.authenticate(i,Object.assign(Object.assign({},i.user),{isAuthorized:!0,roles:i.user.roles}))}else if(i.headers["xc-shared-base-id"]){let t=!1;try{const a=new((0,c.AuthGuard)("base-view"))(e);t=await this.extractBoolVal(a.canActivate(e))}catch(e){}if(t)return this.authenticate(i,Object.assign(Object.assign({},i.user),{isAuthorized:!0,isPublicBase:!0}))}return await this.authenticate(i)}async authenticate(e,t={roles:{guest:!0}}){const a=await this.jwtStrategy.validate(e,t);return e.user=a,!0}async extractBoolVal(e){return e instanceof d.Observable?(0,d.lastValueFrom)(e):"boolean"==typeof e||e instanceof Promise?e:void 0}};t.GlobalGuard=m,t.GlobalGuard=m=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==p.JwtStrategy&&p.JwtStrategy)?i:Object])],m)},67240:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaApiLimiterGuard=void 0;const s=a(23324);let r=class MetaApiLimiterGuard{async canActivate(e){return!0}};t.MetaApiLimiterGuard=r,t.MetaApiLimiterGuard=r=i([(0,s.Injectable)()],r)},53432:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicApiLimiterGuard=void 0;const s=a(23324);let r=class PublicApiLimiterGuard{async canActivate(e){return!0}};t.PublicApiLimiterGuard=r,t.PublicApiLimiterGuard=r=i([(0,s.Injectable)()],r)},23080:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=a(43820),l=i(a(24263)),c=i(a(87624)),d=i(a(11168)),u=i(a(85471)),p=i(a(23532)),m=i(a(37144)),_=i(a(23180)),f=i(a(63252)),h=i(a(87732)),g=i(a(54332)),y=i(a(20752)),b=i(a(55916)),w=i(a(79956)),v=i(a(97096)),T=i(a(30544)),k=i(a(92660)),S=i(a(74076)),M=i(a(49128)),O=i(a(8024)),I=i(a(76220)),C=i(a(76584)),E=i(a(57608)),x=a(64612),L=i(a(60160)),R=[g.default,v.default,c.default,k.default,T.default,f.default,m.default,d.default,p.default,w.default,l.default,M.default,_.default,u.default,S.default,y.default,b.default,h.default,O.default,I.default];t.default=class NcPluginMgrv2{static async init(e=C.default.ncMeta){for(const t of R){const a=await e.metaGet(x.RootScopes.ROOT,x.RootScopes.ROOT,x.MetaTable.PLUGIN,{title:t.title});a?a.version!==t.version&&await e.metaUpdate(x.RootScopes.ROOT,x.RootScopes.ROOT,x.MetaTable.PLUGIN,{title:t.title,version:t.version,logo:t.logo,description:t.description,tags:t.tags,category:t.category,input_schema:JSON.stringify(t.inputs)},a.id):await e.metaInsert2(x.RootScopes.ROOT,x.RootScopes.ROOT,x.MetaTable.PLUGIN,{title:t.title,version:t.version,logo:t.logo,description:t.description,tags:t.tags,category:t.category,input_schema:JSON.stringify(t.inputs)})}await this.initPluginsFromEnv()}static async initPluginsFromEnv(){if(process.env.NC_S3_BUCKET_NAME&&process.env.NC_S3_REGION){const e=await L.default.getPluginByTitle(f.default.title),t={bucket:process.env.NC_S3_BUCKET_NAME,region:process.env.NC_S3_REGION,endpoint:process.env.NC_S3_ENDPOINT,force_path_style:"true"===process.env.NC_S3_FORCE_PATH_STYLE,acl:process.env.NC_S3_ACL};process.env.NC_S3_ACCESS_KEY&&process.env.NC_S3_ACCESS_SECRET&&(t.access_key=process.env.NC_S3_ACCESS_KEY,t.access_secret=process.env.NC_S3_ACCESS_SECRET),await L.default.update(e.id,{active:!0,input:JSON.stringify(t)})}if(process.env.NC_SMTP_FROM&&process.env.NC_SMTP_HOST&&process.env.NC_SMTP_PORT){const e=await L.default.getPluginByTitle(y.default.title);await L.default.update(e.id,{active:!0,input:JSON.stringify({from:process.env.NC_SMTP_FROM,host:process.env.NC_SMTP_HOST,port:process.env.NC_SMTP_PORT,username:process.env.NC_SMTP_USERNAME,password:process.env.NC_SMTP_PASSWORD,secure:process.env.NC_SMTP_SECURE,ignoreTLS:process.env.NC_SMTP_IGNORE_TLS})})}}static async storageAdapter(e=C.default.ncMeta){const t=await e.metaGet2(x.RootScopes.ROOT,x.RootScopes.ROOT,x.MetaTable.PLUGIN,{category:s.PluginCategory.STORAGE,active:!0});if(!t)return new E.default;const a=new(R.find((e=>e.title===t.title&&e.category===s.PluginCategory.STORAGE)).builder)(e,t);return(null==t?void 0:t.input)&&(t.input=JSON.parse(t.input)),await a.init(null==t?void 0:t.input),a.getAdapter()}static async emailAdapter(e=!0,t=C.default.ncMeta){const a=await t.metaGet2(x.RootScopes.ROOT,x.RootScopes.ROOT,x.MetaTable.PLUGIN,{category:s.PluginCategory.EMAIL,active:!0});if(!a){if(e)return null;throw new Error("Plugin not configured / active")}const i=new(R.find((e=>e.title===a.title&&e.category===s.PluginCategory.EMAIL)).builder)(t,a);return(null==a?void 0:a.input)&&(a.input=JSON.parse(a.input)),await i.init(null==a?void 0:a.input),i.getAdapter()}static async webhookNotificationAdapters(e,t=C.default.ncMeta){const a=await t.metaGet2(x.RootScopes.ROOT,x.RootScopes.ROOT,x.MetaTable.PLUGIN,{title:e,active:!0});if(!a)throw new Error("Plugin not configured / active");const i=new(R.find((e=>e.title===a.title)).builder)(t,a);return(null==a?void 0:a.input)&&(a.input=JSON.parse(a.input)),await i.init(null==a?void 0:a.input),i.getAdapter()}static async test(e){var t,a,i,s,l,c,d,u,p;switch(e.input="string"==typeof(null==e?void 0:e.input)?JSON.parse(null==e?void 0:e.input):null==e?void 0:e.input,e.category){case"Storage":{const s=R.find((t=>(null==t?void 0:t.title)===e.title)),l=new s.builder(C.default.ncMeta,s);return await l.init(null==e?void 0:e.input),(null===(t=null==l?void 0:l.getAdapter())||void 0===t?void 0:t.test)||r.NcError.notImplemented("Plugin Test"),null===(i=null===(a=null==l?void 0:l.getAdapter())||void 0===a?void 0:a.test)||void 0===i?void 0:i.call(a)}case"Email":{const t=R.find((t=>(null==t?void 0:t.title)===e.title)),a=new t.builder(C.default.ncMeta,t);return await a.init(null==e?void 0:e.input),(null===(s=null==a?void 0:a.getAdapter())||void 0===s?void 0:s.test)||r.NcError.notImplemented("Plugin Test"),null===(c=null===(l=null==a?void 0:a.getAdapter())||void 0===l?void 0:l.test)||void 0===c?void 0:c.call(l)}default:{const t=R.find((t=>(null==t?void 0:t.title)===e.title)),a=new t.builder(C.default.ncMeta,t);return await a.init(null==e?void 0:e.input),(null===(d=null==a?void 0:a.getAdapter())||void 0===d?void 0:d.test)||r.NcError.notImplemented("Plugin Test"),null===(p=null===(u=null==a?void 0:a.getAdapter())||void 0===u?void 0:u.test)||void 0===p?void 0:p.call(u)}}}}},99572:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PagedResponseImpl=void 0;const i=a(43468),s=a(43820);t.PagedResponseImpl=class PagedResponseImpl{constructor(e,t={},a){var r,l;const{offset:c,limit:d}=(0,i.extractLimitAndOffset)(t);let u=null!==(r=t.count)&&void 0!==r?r:null;null!==u&&(u=+u),this.list=e,null!=u&&(this.pageInfo={totalRows:+u},this.pageInfo.page=c?c/d+1:1,this.pageInfo.pageSize=d,this.pageInfo.isFirstPage=null!==(l=this.pageInfo.isFirstPage)&&void 0!==l?l:1===this.pageInfo.page,this.pageInfo.isLastPage=this.pageInfo.page>=(Math.ceil(this.pageInfo.totalRows/this.pageInfo.pageSize)||1),this.pageInfo.page%1!=0&&(this.pageInfo.offset=c,delete this.pageInfo.page),c&&c>=+u&&s.NcError.invalidOffsetValue(c)),a&&Object.assign(this,a)}}},33755:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({formula:e,columnId:t,title:a}){let i=!1;const r=(e,s)=>{"CallExpression"===e.type?e.arguments.map((e=>r(e,s))):"Literal"===e.type||("Identifier"===e.type?e.name===t&&(s.error=s.formula.error||"",s.error+=`Column '${a||t}' was deleted`,i=!0):"BinaryExpression"===e.type&&(r(e.left,s),r(e.right,s)))};return r((0,s.default)(e.formula),e),i};const s=i(a(91856))},42940:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validatePayload=t.getAjvValidatorMw=void 0,t.parseHrtimeToMilliSeconds=function(e){return(1e3*e[0]+e[1]/1e6).toFixed(3)};const s=i(a(57072)),r=i(a(32904)),l=i(a(19084)),c=a(43820);const d=new s.default({strictSchema:!1,strict:!1});d.addSchema(l.default,"swagger.json"),(0,r.default)(d);t.getAjvValidatorMw=e=>(t,a,i)=>{if(d.getSchema(e)(t.body))i();else{const e=d.errors;a.status(400).json({message:"Invalid request body",errors:e})}};t.validatePayload=(e,t)=>{const a=d.getSchema(e);if(!a(t)){const e=d.errors||a.errors;c.NcError.ajvValidationError({message:"Invalid request body",errors:e})}}},19176:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.localFileExists=void 0,t.isPreviewAllowed=function(e){const{mimetype:t,path:a}=e;if(t)return p.some((e=>t.includes(e)));if(a){const e=a.split(".").pop(),t=null==e?void 0:e.split("?")[0];if(t){const e=l.default.getType(t);return p.some((t=>null==e?void 0:e.includes(t)))}}return!1},t.validateAndNormaliseLocalPath=function(e,t=!1){e=(0,c.default)(e);const a=(0,d.getToolDir)(),i=s.default.resolve(a,"nc"),r=s.default.resolve(s.default.join(a,...e.replace(a,"").split("/")));r.startsWith(i)||(t?u.NcError.notFound():u.NcError.badRequest("Invalid path"));return r},t.getPathFromUrl=function(e,t=!1){const a=new URL(encodeURI(e)),i=t?a.pathname.replace(/.*?nc\/uploads\//,""):a.pathname;return decodeURI(`${i}${a.search}${a.hash}`)};const s=i(a(67072)),r=i(a(2058)),l=i(a(13294)),c=i(a(92696)),d=a(39143),u=a(43820),p=["image","pdf","video","audio"];t.localFileExists=e=>r.default.promises.access(e).then((()=>!0)).catch((()=>!1))},3984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheMiddleware=void 0;t.getCacheMiddleware=(e=2592e3)=>async(t,a,i)=>{const{method:s}=t;"GET"===s&&a.set("Cache-Control",`public, max-age=${e}`),i()}},43820:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NcError=t.NcBaseErrorv2=t.AjvError=t.UnprocessableEntity=t.ExternalTimeout=t.ExternalError=t.MetaError=t.SsoError=t.NotFound=t.Forbidden=t.Unauthorized=t.NotAllowed=t.BadRequest=t.NcBaseError=t.DBError=void 0,t.extractDBError=function(e){var t;if(!e.code)return;let a,s,r;switch(e.code){case"SQLITE_BUSY":a="The database is locked by another process or transaction.";break;case"SQLITE_CONSTRAINT":{const i=/FOREIGN KEY|UNIQUE/.test(e.message)?null===(t=e.message.match(/FOREIGN KEY|UNIQUE/gi))||void 0===t?void 0:t.join(" "):"constraint";a=`A ${i} constraint was violated: ${e.message}`,s={constraint:i}}break;case"SQLITE_CORRUPT":a="The database file is corrupt.";break;case"SQLITE_MISMATCH":e.message&&(a="Data type mismatch in SQLite operation.",r=d.DATA_TYPE_MISMATCH);break;case"SQLITE_ERROR":if(a="A SQL error occurred.",e.message){const t=e.message.match(/no such table: (\w+)/),i=e.message.match(/SQLITE_ERROR: table `?(\w+)`? already exists/),l=e.message.match(/SQLITE_ERROR: duplicate column name: (\w+)/),c=e.message.match(/SQLITE_ERROR: unrecognized token: "(\w+)"/),u=e.message.match(/SQLITE_ERROR: no such column: (\w+)/),p=e.message.match(/SQLITE_ERROR: constraint failed: (\w+)/);if(t&&t[1])a=`The table '${t[1]}' does not exist.`,r=d.TABLE_NOT_EXIST,s={table:t[1]};else if(i&&i[1])a=`The table '${i[1]}' already exists.`,r=d.TABLE_EXIST,s={table:i[1]};else if(c&&c[1])a=`Unrecognized token: ${c[1]}`,s={token:c[1]};else if(u&&u[1])a=`The column ${u[1]} does not exist.`,r=d.COLUMN_NOT_EXIST,s={column:u[1]};else if(p&&p[1])a=`A constraint failed: ${p[1]}`;else if(l&&l[1])a=`The column '${l[1]}' already exists.`,r=d.COLUMN_EXIST,s={column:l[1]};else{const t=e.message.match(/SQLITE_ERROR:\s*(\w+)/);t&&t[1]&&(a=t[1])}}break;case"SQLITE_RANGE":a="A column index is out of range.";break;case"SQLITE_SCHEMA":a="The database schema has changed.";break;case"ER_TRUNCATED_WRONG_VALUE":case"ER_WRONG_VALUE":if(e.message){const t=e.message.match(/Incorrect (\w+) value: (.+) for column '(\w+)'/i);if(t){const e=t[1],i=t[2],l=t[3];a=`Invalid ${e} value '${i}' for column '${l}'`,r=d.DATA_TYPE_MISMATCH,s={dataType:e,column:l,value:i}}else a="Invalid data format for a column.",r=d.DATA_TYPE_MISMATCH}break;case"ER_TABLE_EXISTS_ERROR":if(a="The table already exists.",e.message){const t=e.message.match(/ Table '?(\w+)'? already exists/i);t&&t[1]&&(a=`The table '${t[1]}' already exists.`,r=d.TABLE_EXIST,s={table:t[1]})}break;case"ER_DUP_FIELDNAME":if(a="The column already exists.",e.message){const t=e.message.match(/ Duplicate column name '(\w+)'/i);t&&t[1]&&(a=`The column '${t[1]}' already exists.`,r=d.COLUMN_EXIST,s={column:t[1]})}break;case"ER_NO_SUCH_TABLE":if(a="The table does not exist.",e.message){const t=e.message.match(/ Table '(?:\w+\.)?(\w+)' doesn't exist/i);t&&t[1]&&(a=`The table '${t[1]}' does not exist`,r=d.TABLE_NOT_EXIST,s={table:t[1]})}break;case"ER_DUP_ENTRY":case"23505":a="This record already exists.";break;case"ER_PARSE_ERROR":case"42601":a="There was a syntax error in your SQL query.";break;case"ER_NO_DEFAULT_FOR_FIELD":case"23502":a="A value is required for this field.";break;case"ER_BAD_NULL_ERROR":a="A null value is not allowed for this field.";{const t=e.message.match(/Column '(\w+)' cannot be null/i);t&&t[1]&&(a=`The column '${t[1]}' cannot be null.`,r=d.COLUMN_NOT_NULL,s={column:t[1]})}break;case"ER_DATA_TOO_LONG":case"22001":a="The data entered is too long for this field.";break;case"ER_BAD_FIELD_ERROR":{a="The field you are trying to access does not exist.";const t=e.message.match(/ Unknown column '(\w+)' in 'field list'/i);t&&t[1]&&(a=`The column '${t[1]}' does not exist.`,r=d.COLUMN_NOT_EXIST,s={column:t[1]})}break;case"ER_ACCESS_DENIED_ERROR":case"28000":case"ELOGIN":a="You do not have permission to perform this action.";break;case"ER_LOCK_WAIT_TIMEOUT":case"40P01":case"ETIMEOUT":a="A timeout occurred while waiting for a table lock.";break;case"ER_NO_REFERENCED_ROW":case"23503":a="The referenced record does not exist.";break;case"ER_ROW_IS_REFERENCED":case"23506":a="This record is being referenced by other records.";break;case"23514":a="A null value is not allowed for this field.";break;case"3D000":a="The database does not exist.";break;case"42P07":if(a="The table already exists.",e.message){const t=e.message.match(/ relation "?(\w+)"? already exists/i);t&&t[1]&&(a=`The table '${t[1]}' already exists.`,r=d.TABLE_EXIST,s={table:t[1]})}break;case"22P02":case"22003":if(e.message){const t=e.message.match(/invalid input syntax for (\w+): "(.+)"(?: in column "(\w+)")?/i);if(t){const e=t[1],i=t[2],l=t[3]||"unknown";a=`Invalid ${e} value '${i}' for column '${l}'`,r=d.DATA_TYPE_MISMATCH,s={dataType:e,column:l,value:i}}else{const t=e.detail?e.detail.match(/Column (\w+)/):null,i=t?t[1]:"unknown";a=`Invalid data type or value for column '${i}'.`,r=d.DATA_TYPE_MISMATCH,s={column:i}}}break;case"42701":if(a="The column already exists.",e.message){const t=e.message.match(/ column "(\w+)" of relation "(\w+)" already exists/i);t&&t[1]&&(a=`The column '${t[1]}' already exists.`,r=d.COLUMN_EXIST,s={column:t[1]})}break;case"42P01":if(a="The table does not exist.",e.message){const t=e.message.match(/ relation "(\w+)" does not exist/i);t&&t[1]&&(a=`The table '${t[1]}' does not exist.`,r=d.TABLE_NOT_EXIST,s={table:t[1]})}break;case"42703":if(a="The column does not exist.",e.message){const t=e.message.match(/ column "(\w+)" does not exist/i);t&&t[1]&&(a=`The column '${t[1]}' does not exist.`,r=d.COLUMN_NOT_EXIST,s={column:t[1]})}break;case"EREQUEST":if(a="There was a syntax error in your SQL query.",e.message){const t=e.message.match(/ There is already an object named '(\w+)' in the database/i),i=e.message.match(/ Column name '(\w+)' in table '(\w+)' is specified more than once/i),l=e.message.match(/ Invalid object name '(\w+)'./i),c=e.message.match(/ Invalid field: (\w+)./i);t&&t[1]?(a=`The table '${t[1]}' already exists.`,r=d.TABLE_EXIST,s={table:t[1]}):i&&i[1]?(a=`The column '${i[1]}' already exists.`,r=d.COLUMN_EXIST,s={column:i[1]}):l&&l[1]?(a=`The table '${l[1]}' does not exist`,r=d.TABLE_NOT_EXIST,s={table:l[1]}):c&&c[1]&&(a=`The column '${c[1]}' does not exist`,r=d.COLUMN_NOT_EXIST,s={column:c[1]})}break;case"ECONNRESET":a="The connection was reset.";break;case"ECONNREFUSED":a="The connection was refused.";break;case"EHOSTUNREACH":a="The host is unreachable.";break;case"EHOSTDOWN":a="The host is down.";break;default:c.error(e),e.message&&e.message.includes("--")&&(a=e.message.split("--")[1])}if(a)return{error:i.NcErrorType.DATABASE_ERROR,message:a}};const i=a(71040),s=a(23324),r=a(16736),l=a(11620),c=new s.Logger("MissingDBError");var d;!function(e){e.TABLE_EXIST="TABLE_EXIST",e.TABLE_NOT_EXIST="TABLE_NOT_EXIST",e.COLUMN_EXIST="COLUMN_EXIST",e.COLUMN_NOT_EXIST="COLUMN_NOT_EXIST",e.CONSTRAINT_EXIST="CONSTRAINT_EXIST",e.CONSTRAINT_NOT_EXIST="CONSTRAINT_NOT_EXIST",e.COLUMN_NOT_NULL="COLUMN_NOT_NULL",e.DATA_TYPE_MISMATCH="DATA_TYPE_MISMATCH"}(d||(t.DBError=d={}));class NcBaseError extends Error{constructor(e){super(e)}}t.NcBaseError=NcBaseError;class BadRequest extends NcBaseError{}t.BadRequest=BadRequest;class NotAllowed extends NcBaseError{}t.NotAllowed=NotAllowed;class Unauthorized extends NcBaseError{}t.Unauthorized=Unauthorized;class Forbidden extends NcBaseError{}t.Forbidden=Forbidden;class NotFound extends NcBaseError{}t.NotFound=NotFound;class SsoError extends NcBaseError{}t.SsoError=SsoError;class MetaError extends NcBaseError{constructor(e){super(e.message),Object.assign(this,e)}}t.MetaError=MetaError;class ExternalError extends NcBaseError{constructor(e){super(e.message),Object.assign(this,e)}}t.ExternalError=ExternalError;t.ExternalTimeout=class ExternalTimeout extends ExternalError{};class UnprocessableEntity extends NcBaseError{}t.UnprocessableEntity=UnprocessableEntity;class AjvError extends NcBaseError{constructor(e){super(e.message),this.errors=e.errors}}t.AjvError=AjvError;const u={[i.NcErrorType.UNKNOWN_ERROR]:{message:"Something went wrong",code:500},[i.NcErrorType.INTERNAL_SERVER_ERROR]:{message:e=>e||"Internal server error",code:500},[i.NcErrorType.DATABASE_ERROR]:{message:e=>e||"There was an error while running the query",code:500},[i.NcErrorType.AUTHENTICATION_REQUIRED]:{message:"Authentication required to access this resource",code:401},[i.NcErrorType.API_TOKEN_NOT_ALLOWED]:{message:"This request is not allowed with API token",code:401},[i.NcErrorType.WORKSPACE_NOT_FOUND]:{message:e=>`Workspace '${e}' not found`,code:404},[i.NcErrorType.BASE_NOT_FOUND]:{message:e=>`Base '${e}' not found`,code:404},[i.NcErrorType.SOURCE_NOT_FOUND]:{message:e=>`Source '${e}' not found`,code:404},[i.NcErrorType.INTEGRATION_NOT_FOUND]:{message:e=>`Connection '${e}' not found`,code:404},[i.NcErrorType.INTEGRATION_LINKED_WITH_BASES]:{message:e=>`Connection linked with following bases '${e}'`,code:404},[i.NcErrorType.TABLE_NOT_FOUND]:{message:e=>`Table '${e}' not found`,code:404},[i.NcErrorType.VIEW_NOT_FOUND]:{message:e=>`View '${e}' not found`,code:404},[i.NcErrorType.FIELD_NOT_FOUND]:{message:e=>`Field '${e}' not found`,code:404},[i.NcErrorType.HOOK_NOT_FOUND]:{message:e=>`Hook '${e}' not found`,code:404},[i.NcErrorType.RECORD_NOT_FOUND]:{message:(...e)=>`Record${Array.isArray(e)&&e.length>1?"s":""} '${e.join(", ")}' not found`,code:404},[i.NcErrorType.GENERIC_NOT_FOUND]:{message:(e,t)=>`${e} '${t}' not found`,code:404},[i.NcErrorType.REQUIRED_FIELD_MISSING]:{message:e=>`Field '${e}' is required`,code:422},[i.NcErrorType.ERROR_DUPLICATE_RECORD]:{message:(...e)=>`Record${Array.isArray(e)&&e.length>1?"s":""} '${e.join(", ")}' already exists`,code:422},[i.NcErrorType.USER_NOT_FOUND]:{message:e=>`User ${e.includes("@")?"with email":"with id"} '${e}' not found`,code:404},[i.NcErrorType.INVALID_OFFSET_VALUE]:{message:e=>`Offset value '${e}' is invalid`,code:422},[i.NcErrorType.INVALID_PK_VALUE]:{message:(e,t)=>`Primary key value '${e}' is invalid for column '${t}'`,code:422},[i.NcErrorType.INVALID_LIMIT_VALUE]:{message:`Limit value should be between ${l.defaultLimitConfig.limitMin} and ${l.defaultLimitConfig.limitMax}`,code:422},[i.NcErrorType.INVALID_FILTER]:{message:e=>`Filter '${e}' is invalid`,code:422},[i.NcErrorType.INVALID_SHARED_VIEW_PASSWORD]:{message:"Invalid shared view password",code:403},[i.NcErrorType.INVALID_ATTACHMENT_JSON]:{message:e=>`Invalid JSON for attachment field: ${e}`,code:400},[i.NcErrorType.NOT_IMPLEMENTED]:{message:e=>`${e} is not implemented`,code:501},[i.NcErrorType.BAD_JSON]:{message:"Invalid JSON in request body",code:400},[i.NcErrorType.COLUMN_ASSOCIATED_WITH_LINK]:{message:"Column is associated with a link, please remove the link first",code:400},[i.NcErrorType.TABLE_ASSOCIATED_WITH_LINK]:{message:"Table is associated with a link, please remove the link first",code:400},[i.NcErrorType.FORMULA_ERROR]:{message:e=>`Formula error: ${e}`,code:400},[i.NcErrorType.PERMISSION_DENIED]:{message:"Permission denied",code:403}};class NcBaseErrorv2 extends NcBaseError{constructor(e,t){const a=function(e,t){const a=u[e],{params:i,customMessage:s,details:r}=t||{};if(!a)return{message:"An error occurred",code:500,details:r};let l;const c=s||a.message;return l="function"==typeof c?c(...Array.isArray(i)?i:[i]):c,{message:l,code:a.code,details:r}}(e,t);super(a.message),this.error=e,this.code=a.code,this.details=null==t?void 0:t.details}}t.NcBaseErrorv2=NcBaseErrorv2;class NcError{static permissionDenied(e,t,a){throw new NcBaseErrorv2(i.NcErrorType.PERMISSION_DENIED,{customMessage:(0,r.generateReadablePermissionErr)(e,t,a),details:{permissionName:e,roles:t,extendedScopeRoles:a}})}static authenticationRequired(e){throw new NcBaseErrorv2(i.NcErrorType.AUTHENTICATION_REQUIRED,e)}static apiTokenNotAllowed(e){throw new NcBaseErrorv2(i.NcErrorType.API_TOKEN_NOT_ALLOWED,e)}static workspaceNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.WORKSPACE_NOT_FOUND,Object.assign({params:e},t))}static columnAssociatedWithLink(e,t){throw new NcBaseErrorv2(i.NcErrorType.COLUMN_ASSOCIATED_WITH_LINK,t)}static tableAssociatedWithLink(e,t){throw new NcBaseErrorv2(i.NcErrorType.TABLE_ASSOCIATED_WITH_LINK,t)}static baseNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.BASE_NOT_FOUND,Object.assign({params:e},t))}static sourceNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.SOURCE_NOT_FOUND,Object.assign({params:e},t))}static tableNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.TABLE_NOT_FOUND,Object.assign({params:e},t))}static userNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.USER_NOT_FOUND,Object.assign({params:e},t))}static viewNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.VIEW_NOT_FOUND,Object.assign({params:e},t))}static hookNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.HOOK_NOT_FOUND,Object.assign({params:e},t))}static recordNotFound(e,t){throw e?"string"==typeof e?e=[e]:Array.isArray(e)?e.every((e=>"string"==typeof e))||(e=e.map((e=>Object.values(e).join("___")))):e=Object.values(e).join("___"):e="unknown",new NcBaseErrorv2(i.NcErrorType.RECORD_NOT_FOUND,Object.assign({params:e},t))}static genericNotFound(e,t,a){throw new NcBaseErrorv2(i.NcErrorType.GENERIC_NOT_FOUND,Object.assign({params:[e,t]},a))}static requiredFieldMissing(e,t){throw new NcBaseErrorv2(i.NcErrorType.REQUIRED_FIELD_MISSING,Object.assign({params:e},t))}static duplicateRecord(e,t){throw new NcBaseErrorv2(i.NcErrorType.ERROR_DUPLICATE_RECORD,Object.assign({params:e},t))}static fieldNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.FIELD_NOT_FOUND,Object.assign({params:e},t))}static invalidOffsetValue(e,t){throw new NcBaseErrorv2(i.NcErrorType.INVALID_OFFSET_VALUE,Object.assign({params:`${e}`},t))}static invalidPrimaryKey(e,t,a){throw new NcBaseErrorv2(i.NcErrorType.INVALID_PK_VALUE,Object.assign({params:[e,t]},a))}static invalidLimitValue(e){throw new NcBaseErrorv2(i.NcErrorType.INVALID_LIMIT_VALUE,Object.assign({},e))}static invalidFilter(e,t){throw new NcBaseErrorv2(i.NcErrorType.INVALID_FILTER,Object.assign({params:e},t))}static invalidSharedViewPassword(e){throw new NcBaseErrorv2(i.NcErrorType.INVALID_SHARED_VIEW_PASSWORD,Object.assign({},e))}static invalidAttachmentJson(e,t){throw new NcBaseErrorv2(i.NcErrorType.INVALID_ATTACHMENT_JSON,Object.assign({params:e},t))}static notImplemented(e="Feature",t){throw new NcBaseErrorv2(i.NcErrorType.NOT_IMPLEMENTED,Object.assign({params:e},t))}static internalServerError(e,t){throw new NcBaseErrorv2(i.NcErrorType.INTERNAL_SERVER_ERROR,Object.assign({params:e},t))}static formulaError(e,t){throw new NcBaseErrorv2(i.NcErrorType.FORMULA_ERROR,Object.assign({params:e},t))}static notFound(e="Not found"){throw new NotFound(e)}static badRequest(e){throw new BadRequest(e)}static unauthorized(e){throw new Unauthorized(e)}static forbidden(e){throw new Forbidden(e)}static ajvValidationError(e){throw new AjvError(e)}static unprocessableEntity(e="Unprocessable entity"){throw new UnprocessableEntity(e)}static notAllowed(e="Not allowed"){throw new NotAllowed(e)}static emailDomainNotAllowed(e){throw new SsoError(`Email domain ${e} is not allowed for this organization`)}static metaError(e){throw new MetaError(e)}static sourceDataReadOnly(e){NcError.forbidden(`Source '${e}' is read-only`)}static sourceMetaReadOnly(e){NcError.forbidden(`Source '${e}' schema is read-only`)}static integrationNotFound(e,t){throw new NcBaseErrorv2(i.NcErrorType.INTEGRATION_NOT_FOUND,Object.assign({params:e},t||{}))}static integrationLinkedWithMultiple(e,t,a){throw new NcBaseErrorv2(i.NcErrorType.INTEGRATION_LINKED_WITH_BASES,Object.assign({params:e.map((e=>e.title)).join(", "),details:{bases:e.map((e=>({id:e.id,title:e.title}))),sources:t.map((e=>({id:e.id,base_id:e.base_id,title:e.alias})))}},a||{}))}}t.NcError=NcError},73980:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRefColumnIfAlias=t.sanitizeColumnName=t.generateFkName=t.validateRequiredField=t.randomID=void 0,t.createHmAndBtColumn=async function(e,t,a,i,s,c,d,m,_=!1,f=!1,h=null,g=!1,y,b,w=!1){{const s=(0,u.getUniqueColumnAliasName)(await t.getColumns(e),"bt"===c&&d||`${a.title}`);await p.default.insert(e,Object.assign(Object.assign({title:s,fk_model_id:t.id,uidt:r.UITypes.LinkToAnotherRecord,type:"bt",fk_child_column_id:i.id,fk_parent_column_id:(null==b?void 0:b.id)||a.primaryKey.id,fk_related_model_id:a.id,virtual:_,system:f||a.id===t.id,fk_col_name:m,fk_index_name:m},"bt"===c?y:{}),{meta:Object.assign(Object.assign({},(null==y?void 0:y.meta)||{}),{custom:w})}))}{const v=(0,u.getUniqueColumnAliasName)(await a.getColumns(e),"hm"===c&&d||(0,l.pluralize)(t.title)),T=Object.assign(Object.assign({},h||{}),{plural:(null==h?void 0:h.plural)||(0,l.pluralize)(t.title),singular:(null==h?void 0:h.singular)||(0,l.singularize)(t.title),custom:w});await p.default.insert(e,Object.assign({title:v,fk_model_id:a.id,uidt:g?r.UITypes.Links:r.UITypes.LinkToAnotherRecord,type:"hm",fk_target_view_id:null==s?void 0:s.id,fk_child_column_id:i.id,fk_parent_column_id:(null==b?void 0:b.id)||a.primaryKey.id,fk_related_model_id:t.id,virtual:_,system:f,fk_col_name:m,fk_index_name:m,meta:T},"hm"===c?y:{}))}},t.createOOColumn=async function(e,t,a,i,s,c,d,m,_=!1,f=!1,h=null,g,y,b=!1){{const s=(0,u.getUniqueColumnAliasName)(await t.getColumns(e),`${a.title}`);await p.default.insert(e,{title:s,fk_model_id:t.id,uidt:r.UITypes.LinkToAnotherRecord,type:r.RelationTypes.ONE_TO_ONE,fk_target_view_id:null,fk_child_column_id:i.id,fk_parent_column_id:(null==y?void 0:y.id)||a.primaryKey.id,fk_related_model_id:a.id,virtual:_,system:f||a.id===t.id,fk_col_name:m,fk_index_name:m,meta:Object.assign(Object.assign({},(null==g?void 0:g.meta)||{}),{bt:!0,custom:b})})}{const c=(0,u.getUniqueColumnAliasName)(await a.getColumns(e),d||t.title);(null==h?void 0:h.bt)&&delete h.bt;const w=Object.assign(Object.assign({},h||{}),{plural:(null==h?void 0:h.plural)||(0,l.pluralize)(t.title),singular:(null==h?void 0:h.singular)||(0,l.singularize)(t.title),custom:b});await p.default.insert(e,Object.assign({title:c,fk_model_id:a.id,uidt:r.UITypes.LinkToAnotherRecord,type:"oo",fk_target_view_id:null==s?void 0:s.id,fk_child_column_id:i.id,fk_parent_column_id:(null==y?void 0:y.id)||a.primaryKey.id,fk_related_model_id:t.id,virtual:_,system:f,fk_col_name:m,fk_index_name:m,meta:w},g||{}))}},t.validateRollupPayload=async function(e,t){(0,d.default)(["title","fk_relation_column_id","fk_rollup_column_id","rollup_function"],t);const a=await(await p.default.get(e,{colId:t.fk_relation_column_id})).getColOptions(e);if(!a)throw new Error("Relation column not found");let i;switch(a.type){case"hm":i=await p.default.get(e,{colId:a.fk_child_column_id});break;case"mm":case"bt":i=await p.default.get(e,{colId:a.fk_parent_column_id})}const s=await i.getModel(e);if(!(await s.getColumns(e)).find((e=>e.id===t.fk_rollup_column_id)))throw new Error("Rollup column not found in related table");if(!(0,r.getAvailableRollupForUiType)(i.uidt).includes(t.rollup_function))throw new Error(`Rollup function (${t.rollup_function}) not available for type (${i.uidt})`)},t.validateLookupPayload=async function(e,t,a){var i;if((0,d.default)(["title","fk_relation_column_id","fk_lookup_column_id"],t),a){let i=t;for(;i;){if(a===i.fk_lookup_column_id)throw new Error("Circular lookup reference not allowed");i=await p.default.get(e,{colId:i.fk_lookup_column_id}).then((t=>"Lookup"===t.uidt?t.getColOptions(e):null))}}const s=await p.default.get(e,{colId:t.fk_relation_column_id}),r=await s.getColOptions(e);if(!r)throw new Error("Relation column not found");let l;switch(r.type){case"hm":l=await p.default.get(e,{colId:r.fk_child_column_id});break;case"mm":case"bt":l=await p.default.get(e,{colId:r.fk_parent_column_id});break;case"oo":l=await p.default.get(e,{colId:(null===(i=s.meta)||void 0===i?void 0:i.bt)?r.fk_parent_column_id:r.fk_child_column_id})}const c=await l.getModel(e);if(!(await c.getColumns(e)).find((e=>e.id===t.fk_lookup_column_id)))throw new Error("Lookup column not found in related table")},t.populateRollupForLTAR=async function({context:e,column:t,columnMeta:a,alias:i}){var s,d;const m=await t.getModel(e),_=await m.getViews(e),f=await t.getColOptions(e).then((t=>t.getRelatedTable(e)));await f.getColumns(e);const h=(null===(s=f.primaryKey)||void 0===s?void 0:s.id)||(null===(d=(await f.getColumns(e))[0])||void 0===d?void 0:d.id),g={plural:(null==a?void 0:a.plural)||(0,l.pluralize)(f.title),singular:(null==a?void 0:a.singular)||(0,l.singularize)(f.title)};await p.default.insert(e,{uidt:r.UITypes.Links,title:(0,u.getUniqueColumnAliasName)(await m.getColumns(e),i||`${f.title} Count`),fk_rollup_column_id:h,fk_model_id:m.id,rollup_function:"count",fk_relation_column_id:t.id,meta:g});const y=await c.GridViewColumn.list(e,_[0].id).then((e=>e.find((e=>e.fk_column_id===t.id))));await c.GridViewColumn.update(e,y.id,{show:!1})};const s=a(92080),r=a(71040),l=a(42496),c=a(19684),d=i(a(51987)),u=a(98644),p=i(a(57596)),m=a(39143);t.randomID=(0,s.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",10);t.validateRequiredField=(e,t)=>t.every((t=>t in e&&void 0!==e[t]&&null!==e[t]));t.generateFkName=(e,a)=>`fk_${e.table_name.replace(/\W+/g,"_").slice(0,10)}_${a.table_name.replace(/\W+/g,"_").slice(0,10)}_${(0,t.randomID)()}`;t.sanitizeColumnName=(e,t)=>{if("false"===process.env.NC_SANITIZE_COLUMN_NAME)return e;let a=e.replace(/\W/g,"_");return/^_+$/.test(a)&&(a="field"),t&&t===m.DriverClient.DATABRICKS&&(a=a.toLowerCase()),a};t.getRefColumnIfAlias=async(e,t,a)=>t?[r.UITypes.CreatedTime,r.UITypes.LastModifiedTime,r.UITypes.CreatedBy,r.UITypes.LastModifiedBy].includes(t.uidt)&&(a||await p.default.list(e,{fk_model_id:t.fk_model_id})).find((e=>e.system&&e.uidt===t.uidt))||t:null},24408:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCommandPaletteForUserWorkspace=async function(e,t="nc",a=l.default.ncMeta){var i;const d=`${r.CacheScope.CMD_PALETTE}:${e}:${t}`;let u=await c.default.get(d,r.CacheGetType.TYPE_OBJECT);u||(u={data:await a.knexConnection(`${r.MetaTable.PROJECT} as b`).select("b.id as base_id","b.title as base_title","b.meta as base_meta","b.order as base_order","bu.roles as base_role","t.id as table_id","t.title as table_title","t.type as table_type","t.meta as table_meta","t.order as table_order","v.id as view_id","v.title as view_title","v.is_default as view_is_default","v.type as view_type","v.meta as view_meta","v.order as view_order","dm.disabled").innerJoin(`${r.MetaTable.PROJECT_USERS} as bu`,"b.id","bu.base_id").innerJoin(`${r.MetaTable.MODELS} as t`,"t.base_id","b.id").innerJoin(`${r.MetaTable.VIEWS} as v`,"v.fk_model_id","t.id").leftJoin(`${r.MetaTable.MODEL_ROLE_VISIBILITY} as dm`,(function(){this.on("dm.fk_view_id","=","v.id").andOn("dm.role","=","bu.roles")})).where("bu.fk_user_id",e).andWhereNot("bu.roles",s.ProjectRoles.NO_ACCESS).andWhere("t.mm",!1).andWhere((function(){this.where("dm.disabled",!1).orWhereNull("dm.disabled")})).andWhere((function(){this.where("b.deleted",!1).orWhereNull("b.deleted")})).andWhere((function(){this.where("t.deleted",!1).orWhereNull("t.deleted")}))},await c.default.set(d,u),await c.default.set(`${r.CacheScope.CMD_PALETTE}:ws`,[d]),await c.default.set(`${r.CacheScope.CMD_PALETTE}:user:${e}`,[d]));return null===(i=null==u?void 0:u.data)||void 0===i?void 0:i.sort(((e,t)=>{var a,i,s,r,l,c;return e.base_order!==t.base_order?(null!==(a=e.base_order)&&void 0!==a?a:1/0)-(null!==(i=t.base_order)&&void 0!==i?i:1/0):e.table_order!==t.table_order?(null!==(s=e.table_order)&&void 0!==s?s:1/0)-(null!==(r=t.table_order)&&void 0!==r?r:1/0):e.view_order!==t.view_order?(null!==(l=e.view_order)&&void 0!==l?l:1/0)-(null!==(c=t.view_order)&&void 0!==c?c:1/0):0}))},t.cleanCommandPaletteCache=async function(e){const t=await c.default.get(`${r.CacheScope.CMD_PALETTE}:ws`,r.CacheGetType.TYPE_ARRAY);t&&await c.default.del([...t,`${r.CacheScope.CMD_PALETTE}`])},t.cleanCommandPaletteCacheForUser=async function(e){const t=await c.default.get(`${r.CacheScope.CMD_PALETTE}:user:${e}`,r.CacheGetType.TYPE_ARRAY);t&&await c.default.del([...t,`${r.CacheScope.CMD_PALETTE}:${e}`])};const s=a(71040),r=a(64612),l=i(a(76584)),c=i(a(57804))},65664:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertDateFormat=function(e,t){if("YYYY-MM-DD"===e){if("mysql2"===t||"sqlite3"===t)return"%Y-%m-%d"}else if("YYYY/MM/DD"===e){if("mysql2"===t||"sqlite3"===t)return"%Y/%m/%d"}else if("DD-MM-YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d/%m/%Y"}else if("MM-DD-YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d-%m-%Y"}else if("DD/MM/YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d/%m/%Y"}else if("MM/DD/YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%m-%d-%Y"}else if("DD MM YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d %m %Y"}else if("MM DD YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%m %d %Y"}else if("YYYY MM DD"===e&&("mysql2"===t||"sqlite3"===t))return"%Y %m %d";return e}},55900:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertUnits=function(e,t){switch(e){case"milliseconds":case"ms":switch(t){case"mssql":return"millisecond";case"mysql":return"MICROSECOND";case"pg":case"sqlite":return"milliseconds";default:return e}case"seconds":case"s":switch(t){case"mssql":case"pg":return"second";case"mysql":return"SECOND";case"sqlite":return"seconds";default:return e}case"minutes":case"m":switch(t){case"mssql":case"pg":return"minute";case"mysql":return"MINUTE";case"sqlite":return"minutes";default:return e}case"hours":case"h":switch(t){case"mssql":case"pg":return"hour";case"mysql":return"HOUR";case"sqlite":return"hours";default:return e}case"days":case"d":switch(t){case"mssql":case"pg":return"day";case"mysql":return"DAY";case"sqlite":return"days";default:return e}case"weeks":case"w":switch(t){case"mssql":case"pg":return"week";case"mysql":return"WEEK";case"sqlite":return"weeks";default:return e}case"months":case"M":switch(t){case"mssql":case"pg":return"month";case"mysql":return"MONTH";case"sqlite":return"months";default:return e}case"quarters":case"Q":switch(t){case"mssql":case"pg":return"quarter";case"mysql":return"QUARTER";case"sqlite":return"quarters";default:return e}case"years":case"y":switch(t){case"mssql":case"pg":return"year";case"mysql":return"YEAR";case"sqlite":return"years";default:return e}default:return e}}},44980:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getViewAndModelByAliasOrId=async function(e,t){const a=await y.default.getWithInfoByTitleOrId(e,t.baseName),i=await f.Model.getByAliasOrId(e,{base_id:a.id,aliasOrId:t.tableName});i||m.NcError.tableNotFound(t.tableName);const s=t.viewName&&await f.View.getByTitleOrId(e,{titleOrId:t.viewName,fk_model_id:i.id});t.viewName&&!s&&m.NcError.viewNotFound(t.viewName);return{model:i,view:s}},t.extractXlsxData=async function(e,t,a){const i=await h.default.get(e,t.source_id);await t.getModelWithInfo(e),await t.getColumns(e),t.model.columns=t.columns.filter((e=>e.show)).map((e=>new g.default(Object.assign(Object.assign({},e),t.model.columnsById[e.fk_column_id])))).filter((e=>!(0,c.isSystemColumn)(e)||t.show_system_fields));const s=await f.Model.getBaseModelSQL(e,{id:t.model.id,viewId:null==t?void 0:t.id,dbDriver:await b.default.get(i)}),{offset:r,dbRows:l,elapsed:u}=await v(e,{baseModel:s,view:t,siteUrl:a.ncSiteUrl,query:a.query}),p=a.query.fields,m=d.utils.json_to_sheet(l,{header:p});return{offset:r,dbRows:l,elapsed:u,data:m}},t.extractCsvData=async function(e,t,a){const i=await h.default.get(e,t.source_id),s=a.query.fields;await t.getModelWithInfo(e),await t.getColumns(e),t.model.columns=t.columns.filter((e=>e.show)).map((e=>new g.default(Object.assign(Object.assign({},e),t.model.columnsById[e.fk_column_id])))).filter((e=>!(0,c.isSystemColumn)(e)||t.show_system_fields));const r=await f.Model.getBaseModelSQL(e,{id:t.model.id,viewId:null==t?void 0:t.id,dbDriver:await b.default.get(i)}),{offset:l,dbRows:d,elapsed:p}=await v(e,{baseModel:r,view:t,query:a.query,siteUrl:a.ncSiteUrl}),m=u.default.unparse({fields:t.model.columns.sort(((e,t)=>Array.isArray(s)?s.indexOf(e.title)-s.indexOf(t.title):0)).filter((e=>!s||!Array.isArray(s)||s.includes(e.title))).map((e=>e.title)),data:d},{escapeFormulae:!0});return{offset:l,dbRows:d,elapsed:p,data:m}},t.serializeCellValue=w,t.getColumnByIdOrName=async function(e,t,a){const i=(await a.getColumns(e)).find((e=>e.title===t||e.id===t||e.column_name===t));i||m.NcError.fieldNotFound(t);return i},t.getDbRows=v;const c=a(71040),d=r(a(42056)),u=l(a(5520)),p=a(62304),m=a(43820),_=l(a(4456)),f=a(19684),h=l(a(16708)),g=l(a(57596)),y=l(a(30136)),b=l(a(82096));async function w(e,{value:t,column:a,siteUrl:i}){var s,r;if(!a)return t;if(!t)return t;switch(null==a?void 0:a.uidt){case c.UITypes.Attachment:{let e=t;try{"string"==typeof t&&(e=JSON.parse(t)),Array.isArray(e)||(e=[e])}catch(t){e=void 0}return(e||[]).filter((e=>e)).map((e=>`${e.title||"Attachment"}(${encodeURI(e.signedPath?`${i}/${e.signedPath}`:e.signedUrl)})`)).join(", ")}case c.UITypes.User:case c.UITypes.CreatedBy:case c.UITypes.LastModifiedBy:{let e=t;try{"string"==typeof t&&(e=JSON.parse(t))}catch(e){}return(e?Array.isArray(e)?e:[e]:[]).map((e=>`${e.email}`)).join(", ")}case c.UITypes.Lookup:{const s=await a.getColOptions(e),r=await s.getLookupColumn(e);return(await Promise.all([...Array.isArray(t)?t:[t]].map((async t=>w(e,{value:t,column:r,siteUrl:i}))))).join(", ")}case c.UITypes.LinkToAnotherRecord:{const i=await a.getColOptions(e),s=await i.getRelatedTable(e);return await s.getColumns(e),[...Array.isArray(t)?t:[t]].map((e=>{var t;return e[null===(t=s.displayValue)||void 0===t?void 0:t.title]})).join(", ")}case c.UITypes.Decimal:return isNaN(Number(t))?null:Number(t).toFixed(null!==(r=null===(s=a.meta)||void 0===s?void 0:s.precision)&&void 0!==r?r:1);default:return t&&"object"==typeof t?JSON.stringify(t):t}}async function v(e,t){const{baseModel:a,view:i,query:s={},siteUrl:r}=t;let l=+s.offset||0;const d=+process.env.NC_EXPORT_MAX_TIMEOUT||5e3,u=[],m=process.hrtime();let f,h;const g=Object.assign({},s);try{g.filterArr=JSON.parse(g.filterArrJson)}catch(e){}try{g.sortArr=JSON.parse(g.sortArrJson)}catch(e){}for(f=0;f<d;l+=100,h=process.hrtime(m),f=1e3*h[0]+h[1]/1e6){const{ast:t,dependencyFields:d}=await(0,_.default)(e,{query:s,includePkByDefault:!1,model:i.model,view:i}),m=await(0,p.nocoExecute)(t,await a.list(Object.assign(Object.assign(Object.assign({},g),d),{offset:l,limit:100})),{},d);if(!(null==m?void 0:m.length)){l=-1;break}for(const t of m){const a=Object.assign({},t);for(const s of i.model.columns)(0,c.isSystemColumn)(s)&&!i.show_system_fields||(a[s.title]=await w(e,{value:t[s.title],column:s,siteUrl:r}));u.push(a)}}return{offset:l,dbRows:u,elapsed:f}}},82048:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.generateBaseIdMap=async function(e,t,a){a.set(t.base_id,t.base_id),a.set(t.id,`${t.base_id}::${t.id}`);const i=await t.getModels(e);for(const r of i){a.set(r.id,`${t.base_id}::${t.id}::${r.id}`),await r.getColumns(e);for(const e of r.columns)a.set(e.id,`${a.get(r.id)}::${e.id}`);const i=await s.Hook.list(e,{fk_model_id:r.id});for(const e of i)a.set(e.id,`${a.get(r.id)}::${e.id}`)}return i},t.clearPrefix=function(e,t){return t&&0!==t.length?e.replace(new RegExp(`^${t}_?`),""):e},t.withoutNull=function(e){const t={};let a=!1;for(const[i,s]of Object.entries(e))null!==s&&(t[i]=s,a=!0);return a?t:null},t.reverseGet=function(e,t){for(const[a,i]of e.entries())if(t===i)return a;return},t.withoutId=function(e){const{id:t}=e;return i(e,["id"])},t.getParentIdentifier=function(e){const t=e.split("::");return t.pop(),t.join("::")},t.getEntityIdentifier=r,t.findWithIdentifier=function(e,t){for(const a of e.keys())if(r(a)===t)return e.get(a);return},t.generateUniqueName=function(e,t){if(!t.includes(e))return e;let a=e,i=1;for(;t.includes(a);)a=`${e}_${i}`,i++;return a};const s=a(19684);function r(e){return e.split("::").pop()}},11620:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultGroupByLimitConfig=t.defaultLimitConfig=void 0,t.extractLimitAndOffset=function(e={}){const a={},i=+(e.limit||e.l);a.limit=Math.max(Math.min(i&&i>0&&Number.isInteger(i)?i:t.defaultLimitConfig.limitDefault,t.defaultLimitConfig.limitMax),t.defaultLimitConfig.limitMin);const s=+(e.offset||e.o)||0;a.offset=Math.max(Number.isInteger(s)?s:0,0),e.limitOverride&&(a.limit=+e.limitOverride);return a},t.defaultLimitConfig={limitDefault:Math.max(+process.env.DB_QUERY_LIMIT_DEFAULT||25,1),limitMin:Math.max(+process.env.DB_QUERY_LIMIT_MIN||10,1),limitMax:Math.max(+process.env.DB_QUERY_LIMIT_MAX||1e3,1)},t.defaultGroupByLimitConfig={limitGroup:Math.max(+process.env.DB_QUERY_LIMIT_GROUP_BY_GROUP||25,1),limitRecord:Math.max(+process.env.DB_QUERY_LIMIT_GROUP_BY_RECORD||10,1)}},70220:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.extractProps=function(e,t){return t.reduce(((t,a)=>(a in e&&void 0!==e[a]&&(t[a]=e[a]),t)),{})},t.extractPropsAndSanitize=function(e,t){return t.reduce(((t,a)=>(a in e&&(t[a]=""===e[a]?null:s.default.sanitize(e[a])),t)),{})};const s=i(a(68552))},36596:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getWeekdayByText=function(e){return{monday:0,tuesday:1,wednesday:2,thursday:3,friday:4,saturday:5,sunday:6}[(null==e?void 0:e.toLowerCase())||"monday"]},t.getWeekdayByIndex=function(e){return{0:"monday",1:"tuesday",2:"wednesday",3:"thursday",4:"friday",5:"saturday",6:"sunday"}[e||0]},t.convertDateFormatForConcat=async function(e,t,a,i,c){if("Identifier"===(null==t?void 0:t.type)&&(null==t?void 0:t.name)in a&&a[t.name]===s.UITypes.Date){const a=(await l.default.get(e,{colId:t.name})).meta;"mysql2"===c?i=`DATE_FORMAT(${i}, '${(0,r.convertDateFormat)(a.date_format,c)}')`:"pg"===c?i=`TO_CHAR(${i}, '${(0,r.convertDateFormat)(a.date_format,c)}')`:"sqlite3"===c?i=`strftime('${(0,r.convertDateFormat)(a.date_format,c)}', ${i})`:"mssql"===c&&(i=`FORMAT(${i}, '${(0,r.convertDateFormat)(a.date_format,c)}')`)}return i};const s=a(71040),r=a(65664),l=i(a(57596))},22e3:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFormulasReferredTheColumn=async function(e,{column:t,columns:a},i=l.default.ncMeta){const c=e=>{if("CallExpression"===e.type)return e.arguments.some((e=>c(e)));if("Literal"===e.type);else{if("Identifier"===e.type)return[t.id,t.title].includes(e.name);if("BinaryExpression"===e.type)return c(e.left)||c(e.right)}};return a.reduce((async(t,a)=>{const l=await t;if(a.uidt!==r.UITypes.Formula&&a.uidt!==r.UITypes.Button)return l;const d=await a.getColOptions(e,i);return r.UITypes.Button===a.uidt&&"url"!==(null==d?void 0:d.type)||c((0,s.default)(d.formula))&&l.push(a),l}),Promise.resolve([]))};const s=i(a(91856)),r=a(71040),l=i(a(76584))},4456:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=a(71040),s=a(43820),r=a(19684),l=async(e,{query:t,extractOnlyPrimaries:a=!1,includePkByDefault:d=!0,model:u,view:p,dependencyFields:m=Object.assign(Object.assign({},t||{}),{nested:Object.assign({},(null==t?void 0:t.nested)||{}),fieldsSet:new Set}),getHiddenColumn:_=(null==t?void 0:t.getHiddenColumn),throwErrorIfInvalidParams:f=!1,extractOnlyRangeFields:h=!1})=>{var g;let y,b,w;if(m.nested=m.nested||{},m.fieldsSet=m.fieldsSet||new Set,p&&p.type===i.ViewTypes.GALLERY){y=(await r.GalleryView.get(e,p.id)).fk_cover_image_col_id}else if(p&&p.type===i.ViewTypes.KANBAN){const t=await r.KanbanView.get(e,p.id);y=t.fk_cover_image_col_id,w=t.fk_grp_col_id}else if(p&&p.type===i.ViewTypes.CALENDAR){const t=await r.CalendarRange.read(e,p.id);t&&(b=t.ranges.flatMap((e=>[e.fk_from_column_id,e.fk_to_column_id].filter(Boolean))).map(String))}if((null===(g=u.columns)||void 0===g?void 0:g.length)||await u.getColumns(e),a){const t=Object.assign(Object.assign({},u.primaryKeys?u.primaryKeys.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.title]:1})),{}):{}),u.displayValue?{[u.displayValue.title]:1}:{});return await Promise.all(u.primaryKeys.map((t=>c(e,t,m)))),await c(e,u.displayValue,m),{ast:t,dependencyFields:m,parsedQuery:m}}if(h){const t=Object.assign({},(b||[]).reduce(((e,t)=>{const a=u.columns.find((e=>e.id===t));return Object.assign(Object.assign({},e),{[a.title]:1})}),{}));return await Promise.all((b||[]).map((t=>c(e,u.columns.find((e=>e.id===t)),m)))),{ast:t,dependencyFields:m,parsedQuery:m}}let v=(null==t?void 0:t.fields)||(null==t?void 0:t.f);if(v&&"*"!==v){if(v=Array.isArray(v)?v:v.split(","),f){const t=await u.getColAliasMapping(e),a=await u.getAliasColObjMap(e),i=v.filter((e=>!t[e]&&!a[e]));i.length&&s.NcError.fieldNotFound(i.join(", "))}}else v=null;let T=null;p&&(T=(await r.View.getColumns(e,p.id)).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.fk_column_id]:t.show||t instanceof r.GridViewColumn&&t.group_by||t instanceof r.KanbanViewColumn&&t.fk_column_id===w})),{}),y&&(T[y]=1),b&&b.forEach((e=>{T[e]=1})));const k=await u.columns.reduce((async(a,s)=>{var r,u,h,g,y,w;let k=1;const S=(null===(u=null===(r=null==t?void 0:t.nested)||void 0===r?void 0:r[s.title])||void 0===u?void 0:u.fields)||(null===(g=null===(h=null==t?void 0:t.nested)||void 0===h?void 0:h[s.title])||void 0===g?void 0:g.f);if(S&&"*"!==S)if(s.uidt===i.UITypes.LinkToAnotherRecord){const a=await s.getColOptions(e).then((t=>t.getRelatedTable(e))),{ast:i}=await l(e,{model:a,query:null===(y=null==t?void 0:t.nested)||void 0===y?void 0:y[s.title],dependencyFields:m.nested[s.title]=m.nested[s.title]||{nested:{},fieldsSet:new Set},throwErrorIfInvalidParams:f});k=i}else k=s.uidt===i.UITypes.Links?1:(Array.isArray(S)?S:S.split(",")).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:1})),{});else if(s.uidt===i.UITypes.LinkToAnotherRecord){const a=await s.getColOptions(e).then((t=>t.getRelatedTable(e)));k=(await l(e,{model:a,query:null===(w=null==t?void 0:t.nested)||void 0===w?void 0:w[s.title],extractOnlyPrimaries:"*"!==S,dependencyFields:m.nested[s.title]=m.nested[s.title]||{nested:{},fieldsSet:new Set},throwErrorIfInvalidParams:f})).ast}let M;return M=(!(0,i.isCreatedOrLastModifiedByCol)(s)||!s.system)&&(_?!(0,i.isSystemColumn)(s)||(0,i.isCreatedOrLastModifiedTimeCol)(s)&&s.system||s.pk:!T||d&&s.pk?(null==v?void 0:v.length)?v.includes(s.title)&&k:k:T[s.id]&&(!(0,i.isSystemColumn)(s)||!p&&(0,i.isCreatedOrLastModifiedTimeCol)(s)||p.show_system_fields||(null!=b?b:[]).includes(s.id)||s.pv)&&(!(null==v?void 0:v.length)||v.includes(s.title))&&k),(M||s.pk)&&await c(e,s,m),Object.assign(Object.assign({},await a),{[s.title]:M})}),Promise.resolve({}));return{ast:k,dependencyFields:m,parsedQuery:m}},c=async(e,t,a={nested:{},fieldsSet:new Set})=>{switch(t.uidt){case i.UITypes.Lookup:await d(e,t,a);break;case i.UITypes.LinkToAnotherRecord:await u(e,t,a);break;default:a.fieldsSet.add(t.title)}},d=async(e,t,a={nested:{},fieldsSet:new Set})=>{const i=await t.getColOptions(e),s=await i.getRelationColumn(e);await u(e,s,a),await c(e,await i.getLookupColumn(e),a.nested[s.title]=a.nested[s.title]||{nested:{},fieldsSet:new Set})},u=async(e,t,a={nested:{},fieldsSet:new Set})=>{var s;const r=await t.getColOptions(e);switch(r.type){case i.RelationTypes.HAS_MANY:a.fieldsSet.add(await r.getParentColumn(e).then((e=>e.title)));break;case i.RelationTypes.BELONGS_TO:case i.RelationTypes.MANY_TO_MANY:a.fieldsSet.add(await r.getChildColumn(e).then((e=>e.title)));break;case i.RelationTypes.ONE_TO_ONE:(null===(s=t.meta)||void 0===s?void 0:s.bt)?a.fieldsSet.add(await r.getChildColumn(e).then((e=>e.title))):a.fieldsSet.add(await r.getParentColumn(e).then((e=>e.title)))}};t.default=l},66368:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t){var a;const s=i.SqlUiFactory.create(await t.getConnectionConfig()),r=s.getDataTypeForUiType(e,(null===(a=null==e?void 0:e.meta)||void 0===a?void 0:a.ag)?"AG":"AI"),l=Object.assign({rqd:!1,pk:!1,ai:!1,cdf:null,un:!1,dtx:"specificType"},r);l.dtxp=s.getDefaultLengthForDatatype(l.dt),l.dtxs=s.getDefaultScaleForDatatype(l.dt);const c=[i.UITypes.MultiSelect,i.UITypes.SingleSelect];e&&c.includes(e.uidt)&&(e.dtxp="string"==typeof e.dtxp?e.dtxp.trim().replace(/'\s*,\s*'/g,"','"):e.dtxp);l.altered=e.altered||2;const d=Object.assign(Object.assign({},l),e);d.uidt!==i.UITypes.CreatedTime||"column_name"in d?d.uidt!==i.UITypes.LastModifiedTime||"column_name"in d||(d.column_name="updated_at"):d.column_name="created_at";return d};const i=a(71040)},47724:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return s.default.create({client:e.type},{}).getUIDataType(t)};const s=i(a(25923))},43591:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return async(...a)=>s.default.isEE()?e(...a):t(...a)},t.getConditionalHandler=function(e,t){return async(...a)=>s.default.isEE()?e(...a):t(...a)};const s=i(a(76584))},57972:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a){var i;let r=e;a.isMeta(!0)&&!a.isMeta(!0,1)&&t&&(r=r.replace(t,""));return(null==a?void 0:a.inflection_table)&&(null===(i=s.default[null==a?void 0:a.inflection_table])||void 0===i?void 0:i.call(s.default,r))||r},t.getColumnNameAlias=function(e,t){var a;return(null==t?void 0:t.inflection_column)&&(null===(a=s.default[null==t?void 0:t.inflection_column])||void 0===a?void 0:a.call(s.default,e))||e};const s=i(a(42496))},98644:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUniqueColumnName=function(e,t="field"){let a=0;for(;e.some((e=>e.column_name===`${t}${a||""}`));)a++;return`${t}${a||""}`},t.getUniqueColumnAliasName=function(e,t="field"){let a=0;for(;e.some((e=>e.title===`${t}${a||""}`));)a++;return`${t}${a||""}`}},43468:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.populateMeta=void 0;const r=a(79383);Object.defineProperty(t,"populateMeta",{enumerable:!0,get:function(){return r.populateMeta}}),s(a(73980),t),s(a(42940),t),s(a(3984),t),s(a(11620),t),s(a(50352),t)},77320:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e=_.default.ncMeta){var t,a;if(process.env.NC_ADMIN_EMAIL&&process.env.NC_ADMIN_PASSWORD){(0,u.default)(null===(t=process.env.NC_ADMIN_EMAIL)||void 0===t?void 0:t.trim())||(console.log("\n",(0,d.default)(`Provided admin email '${process.env.NC_ADMIN_EMAIL}'  is not valid`,{title:"Invalid admin email",padding:1,borderStyle:"double",titleAlignment:"center",borderColor:"red"}),"\n"),process.exit(1));const{valid:i,error:_,hint:b}=(0,c.validatePassword)(process.env.NC_ADMIN_PASSWORD);let w;i||(console.log("\n",(0,d.default)(`${_}${b?`\n\n${b}`:""}`,{title:"Invalid admin password",padding:1,borderStyle:"double",titleAlignment:"center",borderColor:"red"}),"\n"),process.exit(1));try{w=await e.startTransaction();const t=process.env.NC_ADMIN_EMAIL.toLowerCase().trim(),i=await(0,s.promisify)(l.default.genSalt)(10),c=await(0,s.promisify)(l.default.hash)(process.env.NC_ADMIN_PASSWORD,i),d=(0,r.v4)(),u="org-level-creator,super";if(await f.User.isFirst(w))p.T.emit("evt",{evt_type:"base:invite",count:1}),await f.User.insert({email:t,salt:i,password:c,email_verification_token:d,token_version:(0,g.randomTokenString)(),roles:u},w);else{const e=await(0,s.promisify)(l.default.genSalt)(10),i=await(0,s.promisify)(l.default.hash)(process.env.NC_ADMIN_PASSWORD,e),c=(0,r.v4)(),d=await w.metaList2(h.RootScopes.ROOT,h.RootScopes.ROOT,h.MetaTable.USERS);let _=!1;for(const r of d)if(null===(a=r.roles)||void 0===a?void 0:a.includes("super"))if(_=!0,t!==r.email){const a=await f.User.getByEmail(t,w);if(null==a?void 0:a.id){const s=await w.knexConnection(h.MetaTable.PROJECT_USERS).where({fk_user_id:a.id});for(const e of s){const t=await f.BaseUser.get(e.base_id,r.id,w);t?y[t.roles]>y[e.roles]&&await f.BaseUser.update({workspace_id:e.workspace_id,base_id:e.base_id},t.base_id,r.id,e.roles,w):await f.BaseUser.insert(Object.assign(Object.assign({},e),{fk_user_id:r.id}),w),await f.BaseUser.delete(e.base_id,e.fk_user_id,w)}await w.metaDelete(h.RootScopes.ROOT,h.RootScopes.ROOT,h.MetaTable.USERS,a.id),await m.default.del(`${h.CacheScope.USER}:${a.id}`),await m.default.del(`${h.CacheScope.USER}:${a.email}`),await f.User.update(r.id,{salt:e,email:t,password:i,email_verification_token:c,token_version:(0,g.randomTokenString)()},w)}else await f.User.update(r.id,{salt:e,email:t,password:i,email_verification_token:c,token_version:(0,g.randomTokenString)()},w)}else{await(0,s.promisify)(l.default.hash)(process.env.NC_ADMIN_PASSWORD,r.salt)!==r.password&&await f.User.update(r.id,{salt:e,password:i,email_verification_token:c,token_version:(0,g.randomTokenString)()},w)}if(!_){const a=await f.User.getByEmail(t,w);(null==a?void 0:a.id)?(await m.default.del(`${h.CacheScope.USER}:${a.id}`),await m.default.del(`${h.CacheScope.USER}:${a.email}`),await f.User.update(a.id,{salt:e,email:t,password:i,email_verification_token:c,token_version:(0,g.randomTokenString)(),roles:u},w)):(p.T.emit("evt",{evt_type:"base:invite",count:1}),await f.User.insert({email:t,salt:e,password:i,email_verification_token:c,token_version:(0,g.randomTokenString)(),roles:u},w))}}await w.commit()}catch(e){throw console.log("Error occurred while updating/creating admin user"),await w.rollback(e),e}}};const s=a(50970),r=a(81104),l=i(a(31920)),c=a(71040),d=i(a(16512)),u=i(a(26360)),p=a(62304),m=i(a(57804)),_=i(a(76584)),f=a(19684),h=a(64612),g=a(57512),y={owner:0,creator:1,editor:2,commenter:3,viewer:4}},55160:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initBaseBehavior=async function(){var e,t,a;const i=await r.default.getDataConfig();if("pg"!==i.client)return;if("true"===process.env.NC_DISABLE_PG_DATA_REFLECTION)return;let s;try{s=(0,l.default)(i);const r=await u(s,i);if(!(null===(t=null===(e=null==r?void 0:r.rows)||void 0===e?void 0:e[0])||void 0===t?void 0:t.has_database_privilege))return process.env.NC_DISABLE_PG_DATA_REFLECTION="true",void d.warn(`User ${null===(a=i.connection)||void 0===a?void 0:a.user} does not have permission to create schema, minimal databases feature will be disabled`);process.env.NC_DISABLE_PG_DATA_REFLECTION="false"}catch(e){d.warn(`Error while checking schema creation permission: ${e.message}`),process.env.NC_DISABLE_PG_DATA_REFLECTION="true"}finally{await(null==s?void 0:s.destroy())}};const s=a(23324),r=i(a(82096)),l=i(a(25244)),c=a(71068),d=new s.Logger("initBaseBehavior");async function u(e,t,a=!1){var i;try{return await e.raw("SELECT has_database_privilege(:user, :database, 'CREATE') as has_database_privilege",{database:t.connection.database,user:t.connection.user})}catch(s){if(s.message.includes("does not exist")&&!a){const a=c.SqlClientFactory.create(Object.assign(Object.assign({},t),{knex:e}));return await a.createDatabaseIfNotExists({database:t.connection.database,schema:(null===(i=t.searchPath)||void 0===i?void 0:i[0])||"public"}),u(e,t,!0)}throw s}}},448:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e=r.default.ncMeta){if(!process.env.NC_CONNECTION_ENCRYPT_KEY)return;const t=process.env.NC_CONNECTION_ENCRYPT_KEY,a=await e.startTransaction(),i=[];try{const e=await a.knex(l.MetaTable.SOURCES).where((e=>{e.where("is_encrypted",!1).orWhereNull("is_encrypted")})).whereNotNull("config");for(const s of e)if(s.config){try{JSON.parse(s.config)}catch(e){console.error("Invalid JSON in integration config",s.alias),i.push(!1);continue}await a.metaUpdate(s.fk_workspace_id,s.base_id,l.MetaTable.SOURCES,{config:(0,c.encryptPropIfRequired)({data:s,secret:t}),is_encrypted:!0},s.id),i.push(!0),d.log(`Encrypted source ${s.alias}`)}const s=await a.knex(l.MetaTable.INTEGRATIONS).where((e=>{e.where("is_encrypted",!1).orWhereNull("is_encrypted")})).whereNotNull("config");for(const e of s)if(e.config){try{JSON.parse(e.config)}catch(t){d.warn("Invalid JSON in integration config",e.title),i.push(!1);continue}await a.metaUpdate(l.RootScopes.WORKSPACE,l.RootScopes.WORKSPACE,l.MetaTable.INTEGRATIONS,{config:(0,c.encryptPropIfRequired)({data:e,secret:t}),is_encrypted:!0},e.id),i.push(!0),d.log(`Encrypted integration config ${e.title}`)}if(i.length&&i.every((e=>!e)))throw new Error("Failed to encrypt all data sources, please remove invalid data sources and try again.");await a.commit()}catch(e){throw await a.rollback(),console.error("Failed to encrypt data sources"),e}};const s=a(23324),r=i(a(76584)),l=a(64612),c=a(62304),d=new s.Logger("initDataSourceEncryption")},50352:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDisposableEmail=function(e){const t=e.split("@")[1];if(a.includes(t))return!0;if(i.some((e=>t.endsWith("."+e))))return!0};const a=["0-mail.com","027168.com","0815.ru","0815.ry","0815.su","0845.ru","0box.eu","0clickemail.com","0n0ff.net","0nelce.com","0v.ro","0w.ro","0wnd.net","0wnd.org","0x207.info","1-8.biz","1-tm.com","10-minute-mail.com","1000rebates.stream","100likers.com","105kg.ru","10dk.email","10mail.com","10mail.org","10mail.tk","10minmail.de","10minut.com.pl","10minut.xyz","10minutemail.be","10minutemail.cf","10minutemail.co.uk","10minutemail.co.za","10minutemail.com","10minutemail.de","10minutemail.ga","10minutemail.gq","10minutemail.ml","10minutemail.net","10minutemail.nl","10minutemail.pro","10minutemail.us","10minutemailbox.com","10minutemails.in","10minutenemail.de","10minutenmail.xyz","10minutesmail.com","10minutesmail.fr","10minutmail.pl","10x9.com","11163.com","123-m.com","12hosting.net","12houremail.com","12minutemail.com","12minutemail.net","12storage.com","140unichars.com","147.cl","14n.co.uk","15qm.com","1blackmoon.com","1ce.us","1chuan.com","1clck2.com","1fsdfdsfsdf.tk","1mail.ml","1pad.de","1s.fr","1secmail.com","1secmail.net","1secmail.org","1st-forms.com","1to1mail.org","1usemail.com","1webmail.info","1zhuan.com","2012-2016.ru","20email.eu","20email.it","20mail.eu","20mail.in","20mail.it","20minutemail.com","20minutemail.it","20mm.eu","2120001.net","21cn.com","247web.net","24hinbox.com","24hourmail.com","24hourmail.net","2anom.com","2chmail.net","2ether.net","2fdgdfgdfgdf.tk","2odem.com","2prong.com","2wc.info","300book.info","30mail.ir","30minutemail.com","30wave.com","3202.com","36ru.com","3d-painting.com","3l6.com","3mail.ga","3trtretgfrfe.tk","4-n.us","4057.com","418.dk","42o.org","4gfdsgfdgfd.tk","4k5.net","4mail.cf","4mail.ga","4nextmail.com","4nmv.ru","4tb.host","4warding.com","4warding.net","4warding.org","50set.ru","55hosting.net","5ghgfhfghfgh.tk","5gramos.com","5july.org","5mail.cf","5mail.ga","5minutemail.net","5oz.ru","5tb.in","5x25.com","5ymail.com","60minutemail.com","672643.net","675hosting.com","675hosting.net","675hosting.org","6hjgjhgkilkj.tk","6ip.us","6mail.cf","6mail.ga","6mail.ml","6paq.com","6somok.ru","6url.com","75hosting.com","75hosting.net","75hosting.org","7days-printing.com","7mail.ga","7mail.ml","7tags.com","80665.com","8127ep.com","8mail.cf","8mail.ga","8mail.ml","99.com","99cows.com","99experts.com","9mail.cf","9me.site","9mot.ru","9ox.net","9q.ro","a-bc.net","a45.in","a7996.com","aa5zy64.com","abacuswe.us","abakiss.com","abcmail.email","abilitywe.us","abovewe.us","absolutewe.us","abundantwe.us","abusemail.de","abuser.eu","abyssmail.com","ac20mail.in","academiccommunity.com","academywe.us","acceleratewe.us","accentwe.us","acceptwe.us","acclaimwe.us","accordwe.us","accreditedwe.us","acentri.com","achievementwe.us","achievewe.us","acornwe.us","acrossgracealley.com","acrylicwe.us","activatewe.us","activitywe.us","acucre.com","acuitywe.us","acumenwe.us","adaptivewe.us","adaptwe.us","add3000.pp.ua","addictingtrailers.com","adeptwe.us","adfskj.com","adios.email","adiq.eu","aditus.info","admiralwe.us","ado888.biz","adobeccepdm.com","adoniswe.us","adpugh.org","adroh.com","adsd.org","adubiz.info","advantagewe.us","advantimo.com","adventurewe.us","adventwe.us","advisorwe.us","advocatewe.us","adwaterandstir.com","aegde.com","aegia.net","aegiscorp.net","aegiswe.us","aelo.es","aeonpsi.com","afarek.com","affiliate-nebenjob.info","affiliatedwe.us","affilikingz.de","affinitywe.us","affluentwe.us","affordablewe.us","afia.pro","afrobacon.com","afterhourswe.us","agedmail.com","agendawe.us","agger.ro","agilewe.us","agorawe.us","agtx.net","aheadwe.us","ahem.email","ahk.jp","ahmedkhlef.com","air2token.com","airmailbox.website","airsi.de","ajaxapp.net","akapost.com","akerd.com","akgq701.com","akmail.in","akugu.com","al-qaeda.us","albionwe.us","alchemywe.us","alfaceti.com","aliaswe.us","alienware13.com","aligamel.com","alina-schiesser.ch","alisongamel.com","alivance.com","alivewe.us","all-cats.ru","allaccesswe.us","allamericanwe.us","allaroundwe.us","alldirectbuy.com","allegiancewe.us","allegrowe.us","allemojikeyboard.com","allgoodwe.us","alliancewe.us","allinonewe.us","allofthem.net","alloutwe.us","allowed.org","alloywe.us","allprowe.us","allseasonswe.us","allstarwe.us","allthegoodnamesaretaken.org","allurewe.us","almondwe.us","alph.wtf","alpha-web.net","alphaomegawe.us","alpinewe.us","altairwe.us","altitudewe.us","altuswe.us","ama-trade.de","ama-trans.de","amadeuswe.us","amail.club","amail.com","amail1.com","amail4.me","amazon-aws.org","amberwe.us","ambiancewe.us","ambitiouswe.us","amelabs.com","americanawe.us","americasbestwe.us","americaswe.us","amicuswe.us","amilegit.com","amiri.net","amiriindustries.com","amplewe.us","amplifiedwe.us","amplifywe.us","ampsylike.com","analogwe.us","analysiswe.us","analyticalwe.us","analyticswe.us","analyticwe.us","anappfor.com","anappthat.com","andreihusanu.ro","andthen.us","animesos.com","anit.ro","ano-mail.net","anon-mail.de","anonbox.net","anonmail.top","anonmails.de","anonymail.dk","anonymbox.com","anonymized.org","anonymousness.com","anotherdomaincyka.tk","ansibleemail.com","anthony-junkmail.com","antireg.com","antireg.ru","antispam.de","antispam24.de","antispammail.de","any.pink","anyalias.com","aoeuhtns.com","apfelkorps.de","aphlog.com","apkmd.com","appc.se","appinventor.nl","appixie.com","apps.dj","appzily.com","arduino.hk","ariaz.jetzt","armyspy.com","aron.us","arroisijewellery.com","art-en-ligne.pro","artman-conception.com","arur01.tk","arurgitu.gq","arvato-community.de","aschenbrandt.net","asdasd.nl","asdasd.ru","ashleyandrew.com","ask-mail.com","asorent.com","ass.pp.ua","astonut.tk","astroempires.info","asu.mx","asu.su","at.hm","at0mik.org","atnextmail.com","attnetwork.com","augmentationtechnology.com","ausgefallen.info","auti.st","autorobotica.com","autosouvenir39.ru","autotwollow.com","autowb.com","aver.com","averdov.com","avia-tonic.fr","avls.pt","awatum.de","awdrt.org","awiki.org","awsoo.com","axiz.org","axon7zte.com","axsup.net","ayakamail.cf","azazazatashkent.tk","azcomputerworks.com","azmeil.tk","b1of96u.com","b2bx.net","b2cmail.de","badgerland.eu","badoop.com","badpotato.tk","balaket.com","bangban.uk","banit.club","banit.me","bank-opros1.ru","bareed.ws","barooko.com","barryogorman.com","bartdevos.be","basscode.org","bauwerke-online.com","bazaaboom.com","bbbbyyzz.info","bbhost.us","bbitf.com","bbitj.com","bbitq.com","bcaoo.com","bcast.ws","bcb.ro","bccto.me","bdmuzic.pw","beaconmessenger.com","bearsarefuzzy.com","beddly.com","beefmilk.com","belamail.org","belljonestax.com","beluckygame.com","benipaula.org","bepureme.com","beribase.ru","beribaza.ru","berirabotay.ru","best-john-boats.com","bestchoiceusedcar.com","bestlistbase.com","bestoption25.club","bestparadize.com","bestsoundeffects.com","besttempmail.com","betr.co","bgtmail.com","bgx.ro","bheps.com","bidourlnks.com","big1.us","bigprofessor.so","bigstring.com","bigwhoop.co.za","bij.pl","binka.me","binkmail.com","binnary.com","bio-muesli.info","bio-muesli.net","bione.co","bitwhites.top","bitymails.us","blackgoldagency.ru","blackmarket.to","bladesmail.net","blip.ch","blnkt.net","block521.com","blogmyway.org","blogos.net","blogspam.ro","blondemorkin.com","bluedumpling.info","bluewerks.com","bnote.com","boatmail.us","bobmail.info","bobmurchison.com","bofthew.com","bonobo.email","boofx.com","bookthemmore.com","bootybay.de","borged.com","borged.net","borged.org","bot.nu","boun.cr","bouncr.com","boxformail.in","boximail.com","boxmail.lol","boxomail.live","boxtemp.com.br","bptfp.net","brand-app.biz","brandallday.net","brasx.org","breakthru.com","brefmail.com","brennendesreich.de","briggsmarcus.com","broadbandninja.com","bsnow.net","bspamfree.org","bspooky.com","bst-72.com","btb-notes.com","btc.email","btcmail.pw","btcmod.com","btizet.pl","buccalmassage.ru","budaya-tionghoa.com","budayationghoa.com","buffemail.com","bugfoo.com","bugmenever.com","bugmenot.com","bukhariansiddur.com","bulrushpress.com","bum.net","bumpymail.com","bunchofidiots.com","bund.us","bundes-li.ga","bunsenhoneydew.com","burnthespam.info","burstmail.info","businessbackend.com","businesssuccessislifesuccess.com","buspad.org","bussitussi.com","buymoreplays.com","buyordie.info","buyusdomain.com","buyusedlibrarybooks.org","buzzcluby.com","byebyemail.com","byespm.com","byom.de","c51vsgq.com","cachedot.net","californiafitnessdeals.com","cam4you.cc","camping-grill.info","candymail.de","cane.pw","capitalistdilemma.com","car101.pro","carbtc.net","cars2.club","carsencyclopedia.com","cartelera.org","caseedu.tk","cashflow35.com","casualdx.com","catgroup.uk","cavi.mx","cbair.com","cbes.net","cc.liamria","ccmail.uk","cdfaq.com","cdpa.cc","ceed.se","cek.pm","cellurl.com","centermail.com","centermail.net","cetpass.com","cfo2go.ro","chacuo.net","chaichuang.com","chalupaurybnicku.cz","chammy.info","chasefreedomactivate.com","chatich.com","cheaphub.net","cheatmail.de","chenbot.email","chewydonut.com","chibakenma.ml","chickenkiller.com","chielo.com","childsavetrust.org","chilkat.com","chinamkm.com","chithinh.com","chitthi.in","choco.la","chogmail.com","choicemail1.com","chong-mail.com","chong-mail.net","chong-mail.org","chumpstakingdumps.com","cigar-auctions.com","civikli.com","civx.org","ckaazaza.tk","ckiso.com","cl-cl.org","cl0ne.net","claimab.com","clandest.in","classesmail.com","clearwatermail.info","click-email.com","clickdeal.co","clipmail.eu","clixser.com","clonemoi.tk","cloud-mail.top","cloudns.cx","clout.wiki","clrmail.com","cmail.club","cmail.com","cmail.net","cmail.org","cnamed.com","cndps.com","cnew.ir","cnmsg.net","cnsds.de","co.cc","cobarekyo1.ml","cocoro.uk","cocovpn.com","codeandscotch.com","codivide.com","coffeetimer24.com","coieo.com","coin-host.net","coinlink.club","coldemail.info","compareshippingrates.org","completegolfswing.com","comwest.de","conf.work","consumerriot.com","contbay.com","cooh-2.site","coolandwacky.us","coolimpool.org","coreclip.com","cosmorph.com","courrieltemporaire.com","coza.ro","crankhole.com","crapmail.org","crastination.de","crazespaces.pw","crazymailing.com","cream.pink","crepeau12.com","cringemonster.com","cross-law.ga","cross-law.gq","crossmailjet.com","crossroadsmail.com","crunchcompass.com","crusthost.com","cs.email","csh.ro","cszbl.com","ctmailing.us","ctos.ch","cu.cc","cubiclink.com","cuendita.com","cuirushi.org","cuoly.com","cupbest.com","curlhph.tk","curryworld.de","cust.in","cutout.club","cutradition.com","cuvox.de","cyber-innovation.club","cyber-phone.eu","cylab.org","d1yun.com","d3p.dk","daabox.com","dab.ro","dacoolest.com","daemsteam.com","daibond.info","daily-email.com","daintly.com","damai.webcam","dammexe.net","damnthespam.com","dandikmail.com","darkharvestfilms.com","daryxfox.net","dasdasdascyka.tk","dash-pads.com","dataarca.com","datarca.com","datazo.ca","datenschutz.ru","datum2.com","davidkoh.net","davidlcreative.com","dawin.com","daymail.life","daymailonline.com","dayrep.com","dbunker.com","dcctb.com","dcemail.com","ddcrew.com","de-a.org","dea-21olympic.com","deadaddress.com","deadchildren.org","deadfake.cf","deadfake.ga","deadfake.ml","deadfake.tk","deadspam.com","deagot.com","dealja.com","dealrek.com","deekayen.us","defomail.com","degradedfun.net","deinbox.com","delayload.com","delayload.net","delikkt.de","delivrmail.com","demen.ml","dengekibunko.ga","dengekibunko.gq","dengekibunko.ml","der-kombi.de","derkombi.de","derluxuswagen.de","desoz.com","despam.it","despammed.com","dev-null.cf","dev-null.ga","dev-null.gq","dev-null.ml","developermail.com","devnullmail.com","deyom.com","dharmatel.net","dhm.ro","dhy.cc","dialogus.com","diapaulpainting.com","dicopto.com","digdig.org","digital-message.com","digitalesbusiness.info","digitalmail.info","digitalmariachis.com","digitalsanctuary.com","dildosfromspace.com","dim-coin.com","dingbone.com","diolang.com","directmail24.net","disaq.com","disbox.net","disbox.org","discard.cf","discard.email","discard.ga","discard.gq","discard.ml","discard.tk","discardmail.com","discardmail.de","discos4.com","dishcatfish.com","disign-concept.eu","disign-revelation.com","dispo.in","dispomail.eu","disposable-e.ml","disposable-email.ml","disposable.cf","disposable.ga","disposable.ml","disposable.site","disposableaddress.com","disposableemailaddresses.com","disposableinbox.com","disposablemails.com","dispose.it","disposeamail.com","disposemail.com","disposemymail.com","dispostable.com","divad.ga","divermail.com","divismail.ru","diwaq.com","dlemail.ru","dmarc.ro","dndent.com","dnses.ro","doanart.com","dob.jp","dodgeit.com","dodgemail.de","dodgit.com","dodgit.org","dodsi.com","doiea.com","dolphinnet.net","domforfb1.tk","domforfb18.tk","domforfb19.tk","domforfb2.tk","domforfb23.tk","domforfb27.tk","domforfb29.tk","domforfb3.tk","domforfb4.tk","domforfb5.tk","domforfb6.tk","domforfb7.tk","domforfb8.tk","domforfb9.tk","domozmail.com","donebyngle.com","donemail.ru","dongqing365.com","dontreg.com","dontsendmespam.de","doojazz.com","doquier.tk","dotman.de","dotmsg.com","dotslashrage.com","doublemail.de","douchelounge.com","dozvon-spb.ru","dp76.com","dr69.site","drdrb.com","drdrb.net","dred.ru","drevo.si","drivetagdev.com","drmail.in","droolingfanboy.de","dropcake.de","dropjar.com","droplar.com","dropmail.me","dropsin.net","drowblock.com","dsgvo.party","dsgvo.ru","dshfjdafd.cloud","dsiay.com","dspwebservices.com","duam.net","duck2.club","dudmail.com","duk33.com","dukedish.com","dump-email.info","dumpandjunk.com","dumpmail.de","dumpyemail.com","durandinterstellar.com","duskmail.com","dwse.edu.pl","dyceroprojects.com","dz17.net","e-mail.com","e-mail.org","e-marketstore.ru","e-tomarigi.com","e3z.de","e4ward.com","eanok.com","easy-trash-mail.com","easynetwork.info","easytrashmail.com","eatmea2z.club","eay.jp","ebbob.com","ebeschlussbuch.de","ecallheandi.com","ecolo-online.fr","edgex.ru","edinburgh-airporthotels.com","edv.to","ee1.pl","ee2.pl","eeedv.de","eelmail.com","efxs.ca","egzones.com","einmalmail.de","einrot.com","einrot.de","eintagsmail.de","elearningjournal.org","electro.mn","elitevipatlantamodels.com","elki-mkzn.ru","email-fake.cf","email-fake.com","email-fake.ga","email-fake.gq","email-fake.ml","email-fake.tk","email-jetable.fr","email-lab.com","email-temp.com","email.edu.pl","email.net","email1.pro","email60.com","emailage.cf","emailage.ga","emailage.gq","emailage.ml","emailage.tk","emailate.com","emailbin.net","emailcu.icu","emaildienst.de","emaildrop.io","emailfake.com","emailfake.ml","emailfreedom.ml","emailgenerator.de","emailgo.de","emailias.com","emailigo.de","emailinfive.com","emailisvalid.com","emaillime.com","emailmiser.com","emailna.co","emailnax.com","emailo.pro","emailondeck.com","emailportal.info","emailproxsy.com","emailresort.com","emails.ga","emailsecurer.com","emailsensei.com","emailsingularity.net","emailspam.cf","emailspam.ga","emailspam.gq","emailspam.ml","emailspam.tk","emailsy.info","emailtech.info","emailtemporanea.com","emailtemporanea.net","emailtemporar.ro","emailtemporario.com.br","emailthe.net","emailtmp.com","emailto.de","emailure.net","emailwarden.com","emailxfer.com","emailz.cf","emailz.ga","emailz.gq","emailz.ml","emeil.in","emeil.ir","emeraldwebmail.com","emil.com","emkei.cf","emkei.ga","emkei.gq","emkei.ml","emkei.tk","eml.pp.ua","emlhub.com","emlpro.com","emltmp.com","empireanime.ga","emstjzh.com","emz.net","enayu.com","enterto.com","envy17.com","eoffice.top","eoopy.com","epb.ro","ephemail.net","ephemeral.email","eposta.buzz","eposta.work","eqiluxspam.ga","ereplyzy.com","ericjohnson.ml","eripo.net","ero-tube.org","esadverse.com","esbano-ru.ru","esc.la","escapehatchapp.com","esemay.com","esgeneri.com","esiix.com","esprity.com","estate-invest.fr","eth2btc.info","ether123.net","ethereum1.top","ethersports.org","ethersportz.info","etotvibor.ru","etranquil.com","etranquil.net","etranquil.org","euaqa.com","evanfox.info","eveav.com","evilcomputer.com","evopo.com","evyush.com","exdonuts.com","exelica.com","existiert.net","exitstageleft.net","explodemail.com","express.net.ua","extracurricularsociety.com","extremail.ru","eyepaste.com","ez.lv","ezehe.com","ezfill.com","ezstest.com","ezztt.com","f4k.es","f5.si","facebook-email.cf","facebook-email.ga","facebook-email.ml","facebookmail.gq","facebookmail.ml","fackme.gq","fadingemail.com","faecesmail.me","fag.wf","failbone.com","faithkills.com","fake-box.com","fake-email.pp.ua","fake-mail.cf","fake-mail.ga","fake-mail.ml","fakedemail.com","fakeinbox.cf","fakeinbox.com","fakeinbox.ga","fakeinbox.info","fakeinbox.ml","fakeinbox.tk","fakeinformation.com","fakemail.fr","fakemail.io","fakemailgenerator.com","fakemailz.com","fallinhay.com","fammix.com","fanclub.pm","fangoh.com","fansworldwide.de","fantasymail.de","farrse.co.uk","fast-email.info","fast-mail.fr","fastacura.com","fastchevy.com","fastchrysler.com","fasternet.biz","fastkawasaki.com","fastmazda.com","fastmitsubishi.com","fastnissan.com","fastsubaru.com","fastsuzuki.com","fasttoyota.com","fastyamaha.com","fatflap.com","fbma.tk","fddns.ml","fdfdsfds.com","femailtor.com","fer-gabon.org","fermaxxi.ru","fettometern.com","fexbox.org","fexbox.ru","fexpost.com","fextemp.com","ficken.de","fictionsite.com","fightallspam.com","figjs.com","figshot.com","figurescoin.com","fiifke.de","filbert4u.com","filberts4u.com","film-blog.biz","filzmail.com","findemail.info","findu.pl","finews.biz","fir.hk","firemailbox.club","fitnesrezink.ru","fivemail.de","fixmail.tk","fizmail.com","fleckens.hu","flemail.ru","fliegender.fish","flowu.com","flu.cc","fluidsoft.us","flurred.com","fly-ts.de","flyinggeek.net","flymail.tk","flyspam.com","foobarbot.net","footard.com","foreastate.com","forecastertests.com","foreskin.cf","foreskin.ga","foreskin.gq","foreskin.ml","foreskin.tk","forgetmail.com","fornow.eu","forspam.net","forward.cat","fosil.pro","foxja.com","foxtrotter.info","fr.cr","fr.nf","fr33mail.info","fragolina2.tk","frapmail.com","frappina.tk","free-email.cf","free-email.ga","free-temp.net","freebabysittercam.com","freeblackbootytube.com","freecat.net","freedom4you.info","freedompop.us","freefattymovies.com","freehotmail.net","freeinbox.email","freelance-france.eu","freeletter.me","freemail.ms","freemails.cf","freemails.ga","freemails.ml","freemeil.ga","freemeil.gq","freemeil.ml","freeml.net","freeplumpervideos.com","freerubli.ru","freeschoolgirlvids.com","freesistercam.com","freeteenbums.com","freundin.ru","friendlymail.co.uk","front14.org","frwdmail.com","ftp.sh","ftpinc.ca","fuckedupload.com","fuckingduh.com","fuckme69.club","fucknloveme.top","fuckxxme.top","fudgerub.com","fuirio.com","fukaru.com","fukurou.ch","fullangle.org","fulvie.com","fun64.com","funnycodesnippets.com","funnymail.de","furzauflunge.de","futuramind.com","fuwa.be","fuwa.li","fuwamofu.com","fuwari.be","fux0ringduh.com","fxnxs.com","fyii.de","g14l71lb.com","g1xmail.top","g2xmail.top","g3xmail.top","g4hdrop.us","gafy.net","gage.ga","galaxy.tv","gally.jp","gamail.top","gamegregious.com","gamgling.com","garasikita.pw","garbagecollector.org","garbagemail.org","gardenscape.ca","garizo.com","garliclife.com","garrymccooey.com","gav0.com","gawab.com","gbcmail.win","gbmail.top","gcmail.top","gdmail.top","gedmail.win","geekforex.com","geew.ru","gehensiemirnichtaufdensack.de","geldwaschmaschine.de","gelitik.in","genderfuck.net","geronra.com","geschent.biz","get-mail.cf","get-mail.ga","get-mail.ml","get-mail.tk","get.pp.ua","get1mail.com","get2mail.fr","getairmail.cf","getairmail.com","getairmail.ga","getairmail.gq","getairmail.ml","getairmail.tk","geteit.com","getfun.men","getmails.eu","getnada.com","getnowtoday.cf","getonemail.com","getonemail.net","getover.de","getsimpleemail.com","gett.icu","gexik.com","ggmal.ml","ghosttexter.de","giacmosuaviet.info","giaiphapmuasam.com","giantmail.de","gifto12.com","ginzi.be","ginzi.co.uk","ginzi.es","ginzi.net","ginzy.co.uk","ginzy.eu","girlmail.win","girlsindetention.com","girlsundertheinfluence.com","gishpuppy.com","giveh2o.info","givememail.club","givmail.com","gixenmixen.com","glitch.sx","globaltouron.com","glubex.com","glucosegrin.com","gmal.com","gmatch.org","gmial.com","gmx1mail.top","gmxmail.top","gmxmail.win","gnctr-calgary.com","go2usa.info","go2vpn.net","goatmail.uk","goemailgo.com","golemico.com","gomail.in","goonby.com","goplaygame.ru","gorillaswithdirtyarmpits.com","goround.info","gosuslugi-spravka.ru","gothere.biz","gotmail.com","gotmail.net","gotmail.org","gowikibooks.com","gowikicampus.com","gowikicars.com","gowikifilms.com","gowikigames.com","gowikimusic.com","gowikinetwork.com","gowikitravel.com","gowikitv.com","grandmamail.com","grandmasmail.com","great-host.in","greencafe24.com","greendike.com","greenhousemail.com","greensloth.com","greggamel.com","greggamel.net","gregorsky.zone","gregorygamel.com","gregorygamel.net","grish.de","griuc.schule","grn.cc","groupbuff.com","grr.la","grugrug.ru","gruz-m.ru","gs-arc.org","gsredcross.org","gsrv.co.uk","gsxstring.ga","gudanglowongan.com","guerillamail.biz","guerillamail.com","guerillamail.de","guerillamail.info","guerillamail.net","guerillamail.org","guerillamailblock.com","guerrillamail.biz","guerrillamail.com","guerrillamail.de","guerrillamail.info","guerrillamail.net","guerrillamail.org","guerrillamailblock.com","gufum.com","gustr.com","gxemail.men","gynzi.co.uk","gynzi.es","gynzy.at","gynzy.es","gynzy.eu","gynzy.gr","gynzy.info","gynzy.lt","gynzy.mobi","gynzy.pl","gynzy.ro","gynzy.sk","gzb.ro","h8s.org","habitue.net","hacccc.com","hackersquad.tk","hackthatbit.ch","hahawrong.com","haida-edu.cn","hairs24.ru","haltospam.com","hamham.uk","hangxomcuatoilatotoro.ml","happy2023year.com","happydomik.ru","harakirimail.com","haribu.com","hartbot.de","hasanmail.ml","hat-geld.de","hatespam.org","hawrong.com","haydoo.com","hazelnut4u.com","hazelnuts4u.com","hazmatshipping.org","hccmail.win","headstrong.de","heathenhammer.com","heathenhero.com","hecat.es","heisei.be","hellodream.mobi","helloricky.com","helpinghandtaxcenter.org","helpjobs.ru","heros3.com","herp.in","herpderp.nl","hezll.com","hi5.si","hiddentragedy.com","hidebox.org","hidebusiness.xyz","hidemail.de","hidemail.pro","hidemail.us","hidzz.com","highbros.org","hiltonvr.com","himail.online","hmail.us","hmamail.com","hmh.ro","hoanggiaanh.com","hoanglong.tech","hochsitze.com","hola.org","holl.ga","honeys.be","honor-8.com","hopemail.biz","hornyalwary.top","host1s.com","hostcalls.com","hostguru.top","hostingmail.me","hostlaba.com","hot-mail.cf","hot-mail.ga","hot-mail.gq","hot-mail.ml","hot-mail.tk","hotmai.com","hotmailproduct.com","hotmial.com","hotpop.com","hotprice.co","hotsoup.be","housat.com","hpc.tw","hs.vc","ht.cx","huangniu8.com","hukkmu.tk","hulapla.de","humaility.com","hungpackage.com","hushmail.cf","huskion.net","hvastudiesucces.nl","hwsye.net","hypenated-domain.com","i2pmail.org","i6.cloudns.cc","iaoss.com","ibnuh.bz","icantbelieveineedtoexplainthisshit.com","icemail.club","ichigo.me","icx.in","icx.ro","icznn.com","idx4.com","idxue.com","ieatspam.eu","ieatspam.info","ieh-mail.de","iencm.com","iffymedia.com","ige.es","igg.biz","ignoremail.com","ihateyoualot.info","ihazspam.ca","iheartspam.org","ikbenspamvrij.nl","illistnoise.com","ilovespam.com","imail1.net","imails.info","imailt.com","imgof.com","imgv.de","immo-gerance.info","imperialcnk.com","imstations.com","imul.info","in-ulm.de","in2reach.com","inactivemachine.com","inbax.tk","inbound.plus","inbox.si","inbox2.info","inboxalias.com","inboxbear.com","inboxclean.com","inboxclean.org","inboxdesign.me","inboxed.im","inboxed.pw","inboxkitten.com","inboxproxy.com","inboxstore.me","inclusiveprogress.com","incognitomail.com","incognitomail.net","incognitomail.org","incq.com","ind.st","indieclad.com","indirect.ws","indomaed.pw","indomina.cf","indoserver.stream","indosukses.press","ineec.net","infocom.zp.ua","inggo.org","inkiny.com","inkomail.com","inmynetwork.tk","inoutmail.de","inoutmail.eu","inoutmail.info","inoutmail.net","inpwa.com","insanumingeniumhomebrew.com","insorg-mail.info","instaddr.ch","instaddr.uk","instaddr.win","instance-email.com","instant-mail.de","instantblingmail.info","instantemailaddress.com","instantmail.fr","instmail.uk","internet-v-stavropole.ru","internetkeno.com","internetoftags.com","interstats.org","intersteller.com","intopwa.com","intopwa.net","intopwa.org","investore.co","iozak.com","ip4.pp.ua","ip6.li","ip6.pp.ua","ipoo.org","ippandansei.tk","ipsur.org","irabops.com","irc.so","irish2me.com","irishspringrealty.com","iroid.com","ironiebehindert.de","irssi.tv","is.af","isdaq.com","ishop2k.com","isosq.com","istii.ro","isukrainestillacountry.com","it7.ovh","italy-mail.com","itcompu.com","itfast.net","itsjiff.com","itunesgiftcodegenerator.com","iubridge.com","iuemail.men","iwi.net","ixaks.com","ixx.io","j-p.us","jafps.com","jaga.email","jajxz.com","janproz.com","jaqis.com","jdmadventures.com","jdz.ro","je-recycle.info","jellow.ml","jellyrolls.com","jeoce.com","jet-renovation.fr","jetable.com","jetable.net","jetable.org","jetable.pp.ua","ji5.de","ji6.de","ji7.de","jiooq.com","jmail.ovh","jmail.ro","jnxjn.com","jobbikszimpatizans.hu","jobbrett.com","jobposts.net","jobs-to-be-done.net","joelpet.com","joetestalot.com","jopho.com","joseihorumon.info","josse.ltd","jourrapide.com","jpco.org","jsrsolutions.com","jumonji.tk","jungkamushukum.com","junk.to","junk1e.com","junkmail.ga","junkmail.gq","just-email.com","justemail.ml","juyouxi.com","jwork.ru","kademen.com","kadokawa.cf","kadokawa.ga","kadokawa.gq","kadokawa.ml","kadokawa.tk","kaengu.ru","kagi.be","kakadua.net","kalapi.org","kamen-market.ru","kamsg.com","kaovo.com","kappala.info","kara-turk.net","karatraman.ml","kariplan.com","karta-kykyruza.ru","kartvelo.com","kasmail.com","kaspop.com","katztube.com","kazelink.ml","kbox.li","kcrw.de","keepmymail.com","keinhirn.de","keipino.de","kekita.com","kellychibale-researchgroup-uct.com","kemptvillebaseball.com","kennedy808.com","kiani.com","killmail.com","killmail.net","kimsdisk.com","kinda.email","kindamail.com","kingsq.ga","kino-100.ru","kiois.com","kismail.ru","kisstwink.com","kitnastar.com","kjkszpjcompany.com","kkmail.be","kkoup.com","kksm.be","klassmaster.com","klassmaster.net","klick-tipp.us","klipschx12.com","kloap.com","klovenode.com","kludgemush.com","klzlk.com","kmail.li","kmail.live","kmhow.com","knickerbockerban.de","knol-power.nl","kobrandly.com","kommunity.biz","kon42.com","konultant-jurist.ru","kook.ml","kopagas.com","kopaka.net","korona-nedvizhimosti.ru","koshu.ru","kosmetik-obatkuat.com","kostenlosemailadresse.de","koszmail.pl","kpay.be","kpooa.com","kpost.be","krd.ag","krsw.tk","kruay.com","krypton.tk","ksmtrck.tk","kuhrap.com","kulmeo.com","kulturbetrieb.info","kurzepost.de","kutakbisajauhjauh.gq","kvhrr.com","kvhrs.com","kvhrw.com","kwift.net","kwilco.net","kyal.pl","kyois.com","kzccv.com","l-c-a.us","l33r.eu","l6factors.com","labetteraverouge.at","labworld.org","lacedmail.com","lackmail.net","lackmail.ru","lacto.info","lags.us","lain.ch","lak.pp.ua","lakelivingstonrealestate.com","lakqs.com","lamasticots.com","lambsauce.de","landmail.co","laoeq.com","larisia.com","larland.com","last-chance.pro","lastmail.co","lastmail.com","lawlita.com","lazyinbox.com","lazyinbox.us","ldaho.biz","ldop.com","ldtp.com","le-tim.ru","lee.mx","leeching.net","leetmail.co","legalrc.loan","lellno.gq","lenovog4.com","lerbhe.com","letmeinonthis.com","letthemeatspam.com","lez.se","lgxscreen.com","lhsdv.com","liamcyrus.com","lifebyfood.com","lifetimefriends.info","lifetotech.com","ligsb.com","lillemap.net","lilo.me","lilspam.com","lindenbaumjapan.com","link2mail.net","linkedintuts2016.pw","linshiyouxiang.net","linuxmail.so","litedrop.com","liveradio.tk","lkgn.se","llogin.ru","loadby.us","loan101.pro","loaoa.com","loapq.com","locanto1.club","locantofuck.top","locantowsite.club","locomodev.net","login-email.cf","login-email.ga","login-email.ml","login-email.tk","logular.com","loh.pp.ua","loin.in","lolfreak.net","lolmail.biz","lookugly.com","lordsofts.com","lortemail.dk","losemymail.com","lovemeet.faith","lovemeleaveme.com","lpfmgmtltd.com","lr7.us","lr78.com","lroid.com","lru.me","ls-server.ru","lsyx24.com","luckymail.org","lukecarriere.com","lukemail.info","lukop.dk","luv2.us","lyfestylecreditsolutions.com","lyft.live","lyricspad.net","lzoaq.com","m21.cc","m4ilweb.info","maboard.com","mac-24.com","macr2.com","macromaid.com","macromice.info","magamail.com","maggotymeat.ga","magicbox.ro","magim.be","magspam.net","maidlow.info","mail-card.net","mail-easy.fr","mail-filter.com","mail-help.net","mail-hosting.co","mail-hub.info","mail-now.top","mail-owl.com","mail-share.com","mail-temporaire.com","mail-temporaire.fr","mail-tester.com","mail.by","mail.wtf","mail0.ga","mail1.top","mail114.net","mail1a.de","mail1web.org","mail21.cc","mail22.club","mail2rss.org","mail333.com","mail4trash.com","mail666.ru","mail7.io","mail707.com","mail72.com","mailapp.top","mailback.com","mailbidon.com","mailbiscuit.com","mailbiz.biz","mailblocks.com","mailbox.in.ua","mailbox52.ga","mailbox80.biz","mailbox82.biz","mailbox87.de","mailbox92.biz","mailboxy.fun","mailbucket.org","mailcat.biz","mailcatch.com","mailchop.com","mailcker.com","maildax.me","mailde.de","mailde.info","maildrop.cc","maildrop.cf","maildrop.ga","maildrop.gq","maildrop.ml","maildu.de","maildx.com","maileater.com","mailed.in","mailed.ro","maileimer.de","maileme101.com","mailers.edu.pl","mailexpire.com","mailf5.com","mailfa.tk","mailfall.com","mailfirst.icu","mailforspam.com","mailfree.ga","mailfree.gq","mailfree.ml","mailfreeonline.com","mailfs.com","mailguard.me","mailgutter.com","mailhazard.com","mailhazard.us","mailhex.com","mailhub.pro","mailhz.me","mailimate.com","mailin8r.com","mailinatar.com","mailinater.com","mailinator.co.uk","mailinator.com","mailinator.gq","mailinator.info","mailinator.net","mailinator.org","mailinator.us","mailinator0.com","mailinator1.com","mailinator2.com","mailinator2.net","mailinator3.com","mailinator4.com","mailinator5.com","mailinator6.com","mailinator7.com","mailinator8.com","mailinator9.com","mailincubator.com","mailismagic.com","mailita.tk","mailjunk.cf","mailjunk.ga","mailjunk.gq","mailjunk.ml","mailjunk.tk","mailmate.com","mailme.gq","mailme.ir","mailme.lv","mailme24.com","mailmetrash.com","mailmoat.com","mailmoth.com","mailms.com","mailna.biz","mailna.co","mailna.in","mailna.me","mailnator.com","mailnesia.com","mailnull.com","mailonaut.com","mailorc.com","mailorg.org","mailosaur.net","mailox.fun","mailpick.biz","mailpluss.com","mailpooch.com","mailpoof.com","mailpress.gq","mailproxsy.com","mailquack.com","mailrock.biz","mailsac.com","mailscrap.com","mailseal.de","mailshell.com","mailshiv.com","mailsiphon.com","mailslapping.com","mailslite.com","mailsucker.net","mailt.net","mailt.top","mailtechx.com","mailtemp.info","mailtemporaire.com","mailtemporaire.fr","mailto.plus","mailtome.de","mailtothis.com","mailtraps.com","mailtrash.net","mailtrix.net","mailtv.net","mailtv.tv","mailuniverse.co.uk","mailzi.ru","mailzilla.com","mailzilla.org","mainerfolg.info","makemenaughty.club","makemetheking.com","malahov.de","malayalamdtp.com","mama3.org","mamulenok.ru","mandraghen.cf","manifestgenerator.com","mannawo.com","mansiondev.com","manybrain.com","mark-compressoren.ru","marketlink.info","markmurfin.com","mask03.ru","masonline.info","maswae.world","matamuasu.ga","matchpol.net","matra.site","max-mail.org","mbox.re","mbx.cc","mcache.net","mciek.com","mdhc.tk","mdz.email","meantinc.com","mebelnu.info","mechanicalresumes.com","medkabinet-uzi.ru","meepsheep.eu","meidecn.com","meinspamschutz.de","meltedbrownies.com","meltmail.com","memsg.site","mentonit.net","mepost.pw","merepost.com","merry.pink","meruado.uk","messagebeamer.de","messwiththebestdielikethe.rest","metadownload.org","metaintern.net","metalunits.com","mezimages.net","mfsa.info","mfsa.ru","mhzayt.online","miaferrari.com","miauj.com","midcoastcustoms.com","midcoastcustoms.net","midcoastsolutions.com","midcoastsolutions.net","midiharmonica.com","midlertidig.com","midlertidig.net","midlertidig.org","mierdamail.com","migmail.net","migmail.pl","migumail.com","mihep.com","mijnhva.nl","minimail.gq","ministry-of-silly-walks.de","minsmail.com","mintemail.com","mirai.re","misterpinball.de","miucce.com","mji.ro","mjj.edu.ge","mjukglass.nu","mkpfilm.com","ml8.ca","mliok.com","mm.my","mm5.se","mnode.me","moakt.cc","moakt.co","moakt.com","moakt.ws","mobileninja.co.uk","mobilevpn.top","moburl.com","mockmyid.com","moeri.org","mofu.be","mohmal.com","mohmal.im","mohmal.in","mohmal.tech","moimoi.re","molms.com","momentics.ru","monachat.tk","monadi.ml","moneypipe.net","monumentmail.com","moonwake.com","moot.es","moreawesomethanyou.com","moreorcs.com","morriesworld.ml","morsin.com","moruzza.com","motique.de","mountainregionallibrary.net","mox.pp.ua","moy-elektrik.ru","moza.pl","mozej.com","mp-j.ga","mr24.co","mrvpm.net","mrvpt.com","msgos.com","mspeciosa.com","msrc.ml","mswork.ru","msxd.com","mt2009.com","mt2014.com","mt2015.com","mtmdev.com","muathegame.com","muchomail.com","mucincanon.com","muehlacker.tk","muell.icu","muell.io","muell.monster","muell.xyz","muellemail.com","muellmail.com","munoubengoshi.gq","musiccode.me","mutant.me","mvrht.com","mvrht.net","mwarner.org","mxclip.com","mxfuel.com","my-pomsies.ru","my-teddyy.ru","my10minutemail.com","mybitti.de","mycleaninbox.net","mycorneroftheinter.net","myde.ml","mydefipet.live","mydemo.equipment","myecho.es","myemailboxy.com","mygeoweb.info","myindohome.services","myinfoinc.com","myinterserver.ml","mykickassideas.com","mymail-in.net","mymail90.com","mymailoasis.com","mymaily.lol","mynetstore.de","myopang.com","mypacks.net","mypartyclip.de","myphantomemail.com","mysamp.de","myspaceinc.com","myspaceinc.net","myspaceinc.org","myspacepimpedup.com","myspamless.com","mystvpn.com","mysugartime.ru","mytemp.email","mytempemail.com","mytempmail.com","mytrashmail.com","mywarnernet.net","mywrld.site","mywrld.top","myzx.com","mzico.com","n1nja.org","na-cat.com","nabuma.com","nada.email","nada.ltd","nagi.be","nakedtruth.biz","nanonym.ch","naslazhdai.ru","nationalgardeningclub.com","nawmin.info","naymedia.com","nbzmr.com","negated.com","neko2.net","nekochan.fr","nekosan.uk","neomailbox.com","neotlozhniy-zaim.ru","nepwk.com","nervmich.net","nervtmich.net","net1mail.com","netcom.ws","netmails.com","netmails.net","netricity.nl","netris.net","netviewer-france.com","netzidiot.de","nevermail.de","newbpotato.tk","newfilm24.ru","newideasfornewpeople.info","newmail.top","next.ovh","nextmail.info","nextstopvalhalla.com","nezdiro.org","nezid.com","nezumi.be","nezzart.com","nfast.net","nguyenusedcars.com","nh3.ro","nice-4u.com","nicknassar.com","nincsmail.com","nincsmail.hu","niseko.be","niwl.net","nm7.cc","nmail.cf","nnh.com","nnot.net","nnoway.ru","no-spam.ws","no-ux.com","noblepioneer.com","nobugmail.com","nobulk.com","nobuma.com","noclickemail.com","nodezine.com","nogmailspam.info","noicd.com","nokiamail.com","nolemail.ga","nomail.cf","nomail.ga","nomail.pw","nomail2me.com","nomorespamemails.com","nonspam.eu","nonspammer.de","nonze.ro","noref.in","norseforce.com","norwegischlernen.info","nospam4.us","nospamfor.us","nospamthanks.info","nothingtoseehere.ca","notif.me","notmailinator.com","notrnailinator.com","notsharingmy.info","now.im","nowhere.org","nowmymail.com","nowmymail.net","nproxi.com","nthrl.com","ntlhelp.net","nubescontrol.com","nullbox.info","nurfuerspam.de","nut.cc","nutpa.net","nuts2trade.com","nvhrw.com","nwldx.com","nwytg.com","nwytg.net","ny7.me","nyasan.com","nypato.com","nyrmusic.com","o2stk.org","o7i.net","oalsp.com","obfusko.com","objectmail.com","obobbo.com","oborudovanieizturcii.ru","obxpestcontrol.com","octovie.com","odaymail.com","odem.com","odnorazovoe.ru","oepia.com","oerpub.org","offshore-proxies.net","ofisher.net","ohaaa.de","ohi.tw","oida.icu","oing.cf","okclprojects.com","okinawa.li","okrent.us","okzk.com","olimp-case.ru","olypmall.ru","omail.pro","omnievents.org","omtecha.com","one-mail.top","one-time.email","one2mail.info","onekisspresave.com","onemail.host","oneoffemail.com","oneoffmail.com","onetm.jp","onewaymail.com","onlatedotcom.info","online.ms","onlineidea.info","onlyapp.net","onqin.com","ontyne.biz","oohioo.com","oolus.com","oonies-shoprus.ru","oopi.org","oosln.com","opayq.com","openavz.com","opendns.ro","opentrash.com","opmmedia.ga","opp24.com","optimaweb.me","opwebw.com","oranek.com","ordinaryamerican.net","oreidresume.com","orgmbx.cc","oroki.de","oshietechan.link","otherinbox.com","ourklips.com","ourpreviewdomain.com","outlawspam.com","outlook.edu.pl","outmail.win","ovomail.co","ovpn.to","owleyes.ch","owlpic.com","ownsyou.de","oxopoha.com","ozatvn.com","ozyl.de","p-banlis.ru","p33.org","p71ce1m.com","pa9e.com","pachilly.com","packiu.com","pagamenti.tk","paharpurmim.ga","pakadebu.ga","pamaweb.com","pancakemail.com","papierkorb.me","paplease.com","para2019.ru","parlimentpetitioner.tk","pastebitch.com","patonce.com","pavilionx2.com","payperex2.com","payspun.com","pe.hu","pecinan.com","pecinan.net","pecinan.org","penisgoes.in","penoto.tk","pepbot.com","peterdethier.com","petloca.com","petrzilka.net","pewpewpewpew.pw","pfui.ru","phone-elkey.ru","photo-impact.eu","photomark.net","pi.vu","piaa.me","pig.pp.ua","pii.at","piki.si","pimpedupmyspace.com","pinehill-seattle.org","pingir.com","pipemail.space","pisls.com","pitaniezdorovie.ru","pivo-bar.ru","pixiil.com","pizzajunk.com","pjjkp.com","placebomail10.com","pleasenoham.org","plexfirm.com","plexolan.de","plhk.ru","ploae.com","plw.me","poehali-otdihat.ru","pojok.ml","pokemail.net","pokiemobile.com","polarkingxx.ml","politikerclub.de","polyfaust.net","pooae.com","poofy.org","pookmail.com","poopiebutt.club","popcornfarm7.com","popcornfly.com","popesodomy.com","popgx.com","porjoton.com","porsh.net","posdz.com","posta.store","postacin.com","postonline.me","poutineyourface.com","powered.name","powerencry.com","powlearn.com","pp7rvv.com","ppetw.com","pptrvv.com","pqoia.com","pratikmail.com","pratikmail.net","pratikmail.org","prazdnik-37.ru","predatorrat.cf","predatorrat.ga","predatorrat.gq","predatorrat.ml","predatorrat.tk","premium-mail.fr","primabananen.net","prin.be","privacy.net","privatdemail.net","privmail.edu.pl","privy-mail.com","privy-mail.de","privymail.de","pro-tag.org","pro5g.com","procrackers.com","profast.top","projectcl.com","promailt.com","proprietativalcea.ro","propscore.com","protempmail.com","proxymail.eu","proxyparking.com","prtnx.com","prtshr.com","prtz.eu","psh.me","psles.com","psnator.com","psoxs.com","puglieisi.com","puji.pro","punkass.com","puppetmail.de","purcell.email","purelogistics.org","put2.net","puttanamaiala.tk","putthisinyourspamdatabase.com","pwpwa.com","pwrby.com","qasti.com","qbfree.us","qc.to","qibl.at","qiott.com","qipmail.net","qiq.us","qisdo.com","qisoa.com","qmrbe.com","qoika.com","qopow.com","qq.my","qsl.ro","qtum-ico.com","quadrafit.com","quick-mail.cc","quickemail.info","quickinbox.com","quickmail.nl","quicksend.ch","quipas.com","ququb.com","qvy.me","qwickmail.com","r4nd0m.de","ra3.us","rabin.ca","rabiot.reisen","rackabzar.com","raetp9.com","rainbowly.ml","raketenmann.de","ramenmail.de","rancidhome.net","randomail.io","randomail.net","rapt.be","raqid.com","rax.la","raxtest.com","razemail.com","razuz.com","rbb.org","rcasd.com","rcpt.at","rdklcrv.xyz","re-gister.com","reality-concept.club","reallymymail.com","realquickemail.com","realtyalerts.ca","rebates.stream","receiveee.com","recipeforfailure.com","recode.me","reconmail.com","recyclemail.dk","redfeathercrow.com","reftoken.net","regbypass.com","regspaces.tk","reimondo.com","rejectmail.com","rejo.technology","reliable-mail.com","remail.cf","remail.ga","remarkable.rocks","remote.li","reptilegenetics.com","resgedvgfed.tk","revolvingdoorhoax.org","rfc822.org","rhyta.com","richfinances.pw","riddermark.de","rifkian.ga","rippb.com","risingsuntouch.com","riski.cf","risu.be","rklips.com","rkomo.com","rm2rf.com","rma.ec","rmqkr.net","rnailinator.com","ro.lt","robertspcrepair.com","robot-mail.com","rollindo.agency","ronnierage.net","rootfest.net","rosebearmylove.ru","rotaniliam.com","rover.info","rowe-solutions.com","royal.net","royaldoodles.org","royalmarket.life","royandk.com","rppkn.com","rsvhr.com","rtrtr.com","rtskiya.xyz","rudymail.ml","rumgel.com","runi.ca","rupayamail.com","ruru.be","rustydoor.com","rvb.ro","ryteto.me","s0ny.net","s33db0x.com","sabrestlouis.com","sackboii.com","saeoil.com","safaat.cf","safermail.info","safersignup.de","safetymail.info","safetypost.de","saharanightstempe.com","salmeow.tk","samsclass.info","sandcars.net","sandelf.de","sandwhichvideo.com","sanfinder.com","sanim.net","sanstr.com","sast.ro","satisfyme.club","satukosong.com","sausen.com","saynotospams.com","scatmail.com","scay.net","schachrol.com","schafmail.de","schmeissweg.tk","schrott-email.de","scrsot.com","sd3.in","sdvft.com","sdvgeft.com","sdvrecft.com","secmail.pw","secretemail.de","secure-mail.biz","secure-mail.cc","secured-link.net","securehost.com.es","seekapps.com","seekjobs4u.com","sejaa.lv","selfdestructingmail.com","selfdestructingmail.org","send22u.info","sendfree.org","sendingspecialflyers.com","sendnow.win","sendspamhere.com","senseless-entertainment.com","server.ms","services391.com","sexforswingers.com","sexical.com","sexyalwasmi.top","sfolkar.com","shadap.org","shalar.net","sharedmailbox.org","sharkfaces.com","sharklasers.com","shchiba.uk","sheryli.com","shhmail.com","shhuut.org","shieldedmail.com","shieldemail.com","shiftmail.com","shipfromto.com","shiphazmat.org","shipping-regulations.com","shippingterms.org","shitaway.tk","shitmail.de","shitmail.me","shitmail.org","shmeriously.com","shopxda.com","shortmail.net","shotmail.ru","showslow.de","shrib.com","shut.name","shut.ws","siberpay.com","sidelka-mytischi.ru","siftportal.ru","sify.com","sika3.com","sikux.com","silenceofthespam.com","siliwangi.ga","silvercoin.life","sim-simka.ru","simaenaga.com","simpleitsecurity.info","sin.cl","sinaite.net","sinema.ml","sinfiltro.cl","singlespride.com","sinnlos-mail.de","sino.tw","siteposter.net","sizzlemctwizzle.com","sjuaq.com","skeefmail.com","skrx.tk","sky-inbox.com","sky-ts.de","skygazerhub.com","skyrt.de","slapsfromlastnight.com","slaskpost.se","slave-auctions.net","slippery.email","slipry.net","slopsbox.com","slothmail.net","slushmail.com","sluteen.com","sly.io","smallker.tk","smapfree24.com","smapfree24.de","smapfree24.eu","smapfree24.info","smapfree24.org","smartnator.com","smarttalent.pw","smashmail.de","smellfear.com","smellrear.com","smellypotato.tk","smtp99.com","smwg.info","snakebutt.com","snakemail.com","snapwet.com","sneakmail.de","snece.com","social-mailer.tk","socialfurry.org","sociallymediocre.com","sofia.re","sofimail.com","sofort-mail.de","sofortmail.de","sofrge.com","softkey-office.ru","softpls.asia","sogetthis.com","sohai.ml","sohus.cn","soioa.com","soisz.com","solar-impact.pro","solvemail.info","solventtrap.wiki","songsign.com","sonshi.cf","soodmail.com","soodomail.com","soodonims.com","soombo.com","soon.it","spacebazzar.ru","spam-be-gone.com","spam.care","spam.la","spam.org.es","spam.su","spam4.me","spamail.de","spamarrest.com","spamavert.com","spambob.com","spambob.net","spambob.org","spambog.com","spambog.de","spambog.net","spambog.ru","spambooger.com","spambox.info","spambox.me","spambox.org","spambox.us","spamcero.com","spamcon.org","spamcorptastic.com","spamcowboy.com","spamcowboy.net","spamcowboy.org","spamday.com","spamdecoy.net","spamex.com","spamfellas.com","spamfighter.cf","spamfighter.ga","spamfighter.gq","spamfighter.ml","spamfighter.tk","spamfree.eu","spamfree24.com","spamfree24.de","spamfree24.eu","spamfree24.info","spamfree24.net","spamfree24.org","spamgoes.in","spamherelots.com","spamhereplease.com","spamhole.com","spamify.com","spaminator.de","spamkill.info","spaml.com","spaml.de","spamlot.net","spammer.fail","spammotel.com","spammy.host","spamobox.com","spamoff.de","spamsalad.in","spamsandwich.com","spamslicer.com","spamsphere.com","spamspot.com","spamstack.net","spamthis.co.uk","spamthis.network","spamthisplease.com","spamtrail.com","spamtrap.ro","spamtroll.net","spamwc.cf","spamwc.ga","spamwc.gq","spamwc.ml","speedgaus.net","sperma.cf","spikio.com","spindl-e.com","spoofmail.de","sportrid.com","spr.io","spritzzone.de","spruzme.com","spybox.de","spymail.com","spymail.one","squizzy.de","squizzy.net","sroff.com","sry.li","ssoia.com","stanfordujjain.com","starlight-breaker.net","starpower.space","startfu.com","startkeys.com","statdvr.com","stathost.net","statiix.com","stayhome.li","steam-area.ru","steambot.net","stexsy.com","stinkefinger.net","stop-my-spam.cf","stop-my-spam.com","stop-my-spam.ga","stop-my-spam.ml","stop-my-spam.pp.ua","stop-my-spam.tk","stopspam.app","storiqax.top","storj99.com","storj99.top","streetwisemail.com","stromox.com","stuckmail.com","stuffmail.de","stumpfwerk.com","stylist-volos.ru","submic.com","suburbanthug.com","suckmyd.com","sudern.de","sueshaw.com","suexamplesb.com","suioe.com","super-auswahl.de","superblohey.com","supergreatmail.com","supermailer.jp","superplatyna.com","superrito.com","supersave.net","superstachel.de","superyp.com","suremail.info","sute.jp","svip520.cn","svk.jp","svxr.org","sweetpotato.ml","sweetxxx.de","swift-mail.net","swift10minutemail.com","syinxun.com","sylvannet.com","symphonyresume.com","syosetu.gq","syujob.accountants","szerz.com","tafmail.com","tafoi.gr","taglead.com","tagmymedia.com","tagyourself.com","talkinator.com","tanukis.org","tapchicuoihoi.com","taphear.com","tapi.re","tarzanmail.cf","tastrg.com","taukah.com","tb-on-line.net","tcwlm.com","tcwlx.com","tdtda.com","tech69.com","techblast.ch","techemail.com","techgroup.me","technoproxy.ru","teerest.com","teewars.org","tefl.ro","telecomix.pl","teleg.eu","teleworm.com","teleworm.us","tellos.xyz","teml.net","temp-link.net","temp-mail.com","temp-mail.de","temp-mail.org","temp-mail.pp.ua","temp-mail.ru","temp-mails.com","tempail.com","tempalias.com","tempe-mail.com","tempemail.biz","tempemail.co.za","tempemail.com","tempemail.net","tempinbox.co.uk","tempinbox.com","tempmail.cn","tempmail.co","tempmail.de","tempmail.eu","tempmail.it","tempmail.pp.ua","tempmail.us","tempmail.ws","tempmail2.com","tempmaildemo.com","tempmailer.com","tempmailer.de","tempmailer.net","tempmailo.com","tempomail.fr","tempomail.org","temporarily.de","temporarioemail.com.br","temporary-mail.net","temporaryemail.net","temporaryemail.us","temporaryforwarding.com","temporaryinbox.com","temporarymailaddress.com","tempr.email","tempsky.com","tempthe.net","tempymail.com","tensi.org","ternaklele.ga","testore.co","testudine.com","thanksnospam.info","thankyou2010.com","thatim.info","thc.st","theaviors.com","thebearshark.com","thecarinformation.com","thechildrensfocus.com","thecity.biz","thecloudindex.com","thediamants.org","thedirhq.info","theeyeoftruth.com","thejoker5.com","thelightningmail.net","thelimestones.com","thembones.com.au","themegreview.com","themostemail.com","thereddoors.online","theroyalweb.club","thescrappermovie.com","thespamfather.com","theteastory.info","thex.ro","thichanthit.com","thietbivanphong.asia","thisisnotmyrealemail.com","thismail.net","thisurl.website","thnikka.com","thoas.ru","thraml.com","thrma.com","throam.com","thrott.com","throwam.com","throwawayemailaddress.com","throwawaymail.com","throwawaymail.pp.ua","throya.com","thrubay.com","thunderbolt.science","thunkinator.org","thxmate.com","tiapz.com","tic.ec","tilien.com","timgiarevn.com","timkassouf.com","tinoza.org","tinyurl24.com","tipsb.com","tittbit.in","tiv.cc","tizi.com","tkitc.de","tlpn.org","tmail.com","tmail.io","tmail.ws","tmail3.com","tmail9.com","tmailinator.com","tmails.net","tmmbt.net","tmpbox.net","tmpemails.com","tmpeml.com","tmpeml.info","tmpjr.me","tmpmail.net","tmpmail.org","tmpx.sa.com","toddsbighug.com","tofeat.com","toiea.com","tokem.co","tokenmail.de","tonaeto.com","tonne.to","tonymanso.com","toomail.biz","toon.ml","top-shop-tovar.ru","top101.de","top1mail.ru","top1post.ru","topinrock.cf","topmail2.com","topmail2.net","topofertasdehoy.com","topranklist.de","toprumours.com","tormail.org","toss.pw","tosunkaya.com","totallynotfake.net","totalvista.com","totesmail.com","totoan.info","tourcc.com","tp-qa-mail.com","tpwlb.com","tqoai.com","tqosi.com","tradermail.info","tranceversal.com","trash-amil.com","trash-mail.at","trash-mail.cf","trash-mail.com","trash-mail.de","trash-mail.ga","trash-mail.gq","trash-mail.ml","trash-mail.tk","trash-me.com","trash2009.com","trash2010.com","trash2011.com","trashcanmail.com","trashdevil.com","trashdevil.de","trashemail.de","trashemails.de","trashinbox.com","trashmail.at","trashmail.com","trashmail.de","trashmail.gq","trashmail.io","trashmail.me","trashmail.net","trashmail.org","trashmail.ws","trashmailer.com","trashmailgenerator.de","trashmails.com","trashymail.com","trashymail.net","trasz.com","trayna.com","trbvm.com","trbvn.com,","trbvo.com","trend-maker.ru","trgfu.com","trgovinanaveliko.info","trialmail.de","trickmail.net","trillianpro.com","triots.com","trixtrux1.ru","trollproject.com","tropicalbass.info","trungtamtoeic.com","truthfinderlogin.com","tryalert.com","tryninja.io","tryzoe.com","ttirv.org","ttszuo.xyz","tualias.com","tuofs.com","turoid.com","turual.com","turuma.com","tutuapp.bid","tvchd.com","tverya.com","twinmail.de","twkly.ml","twocowmail.net","twoweirdtricks.com","twzhhq.online","txen.de","txtadvertise.com","tyhe.ro","tyldd.com","tympe.net","uacro.com","uber-mail.com","ubismail.net","ubm.md","ucche.us","ucupdong.ml","uemail99.com","ufacturing.com","uggsrock.com","uguuchantele.com","uhe2.com","uhhu.ru","uiu.us","ujijima1129.gq","uk.to","ultra.fyi","ultrada.ru","uma3.be","umail.net","undo.it","unicodeworld.com","unids.com","unimark.org","unit7lahaina.com","unmail.ru","uooos.com","uorak.com","upliftnow.com","uplipht.com","uploadnolimit.com","upozowac.info","urfunktion.se","urhen.com","uroid.com","us.af","us.to","usa.cc","usako.net","usbc.be","used-product.fr","ushijima1129.cf","ushijima1129.ga","ushijima1129.gq","ushijima1129.ml","ushijima1129.tk","utiket.us","uu.gl","uu2.ovh","uuf.me","uwork4.us","uyhip.com","vaasfc4.tk","vaati.org","valemail.net","valhalladev.com","vankin.de","vctel.com","vda.ro","vddaz.com","vdig.com","veanlo.com","vemomail.win","venompen.com","veo.kr","ver0.cf","ver0.ga","ver0.gq","ver0.ml","ver0.tk","vercelli.cf","vercelli.ga","vercelli.gq","vercelli.ml","verdejo.com","vermutlich.net","veryday.ch","veryday.eu","veryday.info","veryrealemail.com","vesa.pw","vevs.de","vfemail.net","via.tokyo.jp","vickaentb.tk","victime.ninja","victoriantwins.com","vidchart.com","viditag.com","viewcastmedia.com","viewcastmedia.net","viewcastmedia.org","vikingsonly.com","vinernet.com","vintomaper.com","vipepe.com","vipmail.name","vipmail.pw","vipxm.net","viralplays.com","virtualemail.info","visal007.tk","visal168.cf","visal168.ga","visal168.gq","visal168.ml","visal168.tk","vixletdev.com","vixtricks.com","vkcode.ru","vmailing.info","vmani.com","vmpanda.com","vnedu.me","voidbay.com","volaj.com","voltaer.com","vomoto.com","vorga.org","votiputox.org","voxelcore.com","vpn.st","vps30.com","vps911.net","vradportal.com","vremonte24-store.ru","vrmtr.com","vsimcard.com","vssms.com","vtxmail.us","vubby.com","vuiy.pw","vusra.com","vztc.com","w-asertun.ru","w3internet.co.uk","wakingupesther.com","walala.org","walkmail.net","walkmail.ru","wallm.com","wanko.be","watch-harry-potter.com","watchever.biz","watchfull.net","watchironman3onlinefreefullmovie.com","waterisgone.com","wazabi.club","wbdev.tech","wbml.net","web-contact.info","web-ideal.fr","web-inc.net","web-mail.pp.ua","web2mailco.com","webcontact-france.eu","webemail.me","webhook.site","webm4il.info","webmail24.top","webtrip.ch","webuser.in","wee.my","wef.gr","weg-werf-email.de","wegwerf-email-addressen.de","wegwerf-email-adressen.de","wegwerf-email.at","wegwerf-email.de","wegwerf-email.net","wegwerf-emails.de","wegwerfadresse.de","wegwerfemail.com","wegwerfemail.de","wegwerfemail.info","wegwerfemail.net","wegwerfemail.org","wegwerfemailadresse.com","wegwerfmail.de","wegwerfmail.info","wegwerfmail.net","wegwerfmail.org","wegwerpmailadres.nl","wegwrfmail.de","wegwrfmail.net","wegwrfmail.org","weizixu.com","wekawa.com","welikecookies.com","wellsfargocomcardholders.com","wemel.top","wetrainbayarea.com","wetrainbayarea.org","wfgdfhj.tk","wg0.com","wh4f.org","whaaaaaaaaaat.com","whatiaas.com","whatifanalytics.com","whatpaas.com","whatsaas.com","whiffles.org","whopy.com","whyspam.me","wibblesmith.com","wickmail.net","widaryanto.info","widget.gg","wiemei.com","wierie.tk","wifimaple.com","wifioak.com","wikidocuslava.ru","wilemail.com","willhackforfood.biz","willselfdestruct.com","wimsg.com","winemaven.info","wins.com.br","wlist.ro","wmail.cf","wmail.club","wokcy.com","wolfmail.ml","wolfsmail.tk","wollan.info","worldspace.link","wpdork.com","wpg.im","wralawfirm.com","writeme.us","wronghead.com","ws.gy","wsym.de","wudet.men","wuespdj.xyz","wupics.com","wuuvo.com","wuzup.net","wuzupmail.net","wwjmp.com","wwwnew.eu","wxnw.net","x24.com","xagloo.co","xagloo.com","xbaby69.top","xcode.ro","xcodes.net","xcompress.com","xcoxc.com","xcpy.com","xemaps.com","xemne.com","xents.com","xjoi.com","xkx.me","xl.cx","xmail.com","xmailer.be","xmaily.com","xn--9kq967o.com","xn--d-bga.net","xojxe.com","xost.us","xoxox.cc","xperiae5.com","xrap.de","xrho.com","xvx.us","xww.ro","xxhamsterxx.ga","xxi2.com","xxlocanto.us","xxolocanto.us","xxqx3802.com","xy9ce.tk","xyzfree.net","xzsok.com","yabai-oppai.tk","yahmail.top","yahooproduct.net","yamail.win","yanet.me","yannmail.win","yapped.net","yaqp.com","yarnpedia.ga","ycare.de","ycn.ro","ye.vc","yedi.org","yeezus.ru","yep.it","yermail.net","yhg.biz","ynmrealty.com","yodx.ro","yogamaven.com","yoggm.com","yomail.info","yoo.ro","yopmail.com","yopmail.fr","yopmail.gq","yopmail.net","yopmail.pp.ua","yordanmail.cf","you-spam.com","yougotgoated.com","youmail.ga","youmailr.com","youneedmore.info","youpymail.com","yourdomain.com","youremail.cf","yourewronghereswhy.com","yourlms.biz","yourspamgoesto.space","yourtube.ml","yroid.com","yspend.com","ytpayy.com","yugasandrika.com","yui.it","yuoia.com","yuurok.com","yxzx.net","yyolf.net","z-o-e-v-a.ru","z0d.eu","z1p.biz","z86.ru","zain.site","zainmax.net","zaktouni.fr","zarabotokdoma11.ru","zasod.com","zaym-zaym.ru","zcrcd.com","zdenka.net","ze.tc","zebins.com","zebins.eu","zehnminuten.de","zehnminutenmail.de","zemzar.net","zepp.dk","zetmail.com","zfymail.com","zhaoqian.ninja","zhaoyuanedu.cn","zhcne.com","zhewei88.com","zhorachu.com","zik.dj","zipcad.com","zipcatfish.com","zipo1.gq","zippymail.info","zipsendtest.com","zoaxe.com","zoemail.com","zoemail.net","zoemail.org","zoetropes.org","zombie-hive.com","zomg.info","zsero.com","zumpul.com","zv68.com","zxcv.com","zxcvbnm.com","zymuying.com","zzi.us","zzrgg.com","zzz.com"],i=["0x01.gq","0x01.tk","10mail.org","10mail.tk","33m.co","33mail.com","3dxtras.com","3utilities.com","567map.xyz","8191.at","aa.am","accountsite.me","acmetoy.com","acusupply.com","adultvidlite.com","aji.kr","anonaddy.com","anonaddy.me","anonbox.net","anyalias.com","asanatest1.us","azzawajalla.store","bajetesik.store","band-freier.de","bandband1.com","bangmadid.store","batikbantul.com","bccto.me","bebekpenyet.buzz","bei.kr","bel.kr","beo.kr","bfo.kr","bgsaddrmwn.me","bho.kr","biasaelho.space","biz.st","biz.tm","bko.kr","blacksong.pw","blueauramassage.com","bounceme.net","bum.net","buwosok.tech","buzzndaraiangop2wae.buzz","byui.me","caboodle.buzz","cad.edu.gr","cempue.online","chickenkiller.com","choirul.host","cid.kr","ciran.xyz","cko.kr","cloudns.asia","cloudns.cc","cloudns.cx","cloudns.nz","com.com","coms.hk","comx.cf","craigslist.org","creo.site","creo.tips","creou.dev","crowdpress.it","cu.cc","cua77.xyz","d3vs.net","dadosa.xyz","danuarte.online","darrels.site","daseus.online","dayatan.host","dbo.kr","ddns.net","ddnsfree.com","deail.com","dedyn.io","defaultdomain.ml","discard-email.cf","dko.kr","dlink.cf","dlink.gq","dlyemail.com","dmtc.dev","dmtc.edu.pl","dmtc.press","dns-cloud.net","dns.navy","dnsabr.com","dnses.ro","doy.kr","drope.ml","dropmail.me","dynu.net","dzalaev-advokat.ru","e4ward.com","ediantenan.site","edu.auction","efo.kr","eho.kr","ely.kr","email-temp.com","emailfake.com","emailfake.ml","emailfreedom.ml","emlhub.com","emlpro.com","emltmp.com","emy.kr","enu.kr","eny.kr","epizy.com","escritossad.net","ese.kr","esy.es","ewa.kr","exi.kr","ezyro.com","fackme.gq","fassagforpresident.ga","firste.ml","flu.cc","foy.kr","fr.nf","freeml.net","gadzooks.buzz","gettrials.com","giize.com","gmail.gr.com","gmeil.me","gok.kr","gotdns.ch","gpa.lu","grigio.cf","guardmail.cf","haddo.eu","heliohost.org","higogoya.com","historial.store","hitechinfo.com","hix.kr","hiz.kr","hmail.us","hopto.org","hostingarif.me","idn.vn","iesco.info","igg.biz","ignorelist.com","iki.kr","ilovemyniggers.club","imouto.pro","info.tm","infos.st","irr.kr","isgre.at","it2-mail.tk","jil.kr","jindmail.club","jto.kr","junnuok.com","justemail.ml","kadokawa.top","kantal.buzz","keitin.site","kentel.buzz","kerl.cf","kerl.gq","kikwet.com","kondomeus.site","kozow.com","kranjingan.store","kranjingan.tech","kranjingans.tech","kro.kr","lal.kr","laste.ml","lbe.kr","legundi.site","lei.kr","likevip.net","liopers.link","lko.co.kr","lko.kr","ll47.net","lofteone.ru","lom.kr","longdz.site","longmusic.com","lostandalone.com","loudcannabisapp.com","loy.kr","loyalherceghalom.ml","luk2.com","luksarcenter.ru","luo.kr","lyrics-lagu.me","mail-temp.com","mail0.ga","mailinator.com","mailr.eu","marrone.cf","mbe.kr","mblimbingan.space","mebelnovation.ru","mefound.com","mintemail.com","mishmash.buzz","mko.kr","mlo.kr","mooo.com","motifasidiri.website","mp-j.cf","mp-j.ga","mp-j.gq","mp-j.ml","mp-j.tk","mr-meshkat.com","mrossi.cf","mrossi.gq","mrossi.ml","ms1.email","msdc.co","muabanwin.net","museumplanet.com","my.id","my3mail.cf","my3mail.ga","my3mail.gq","my3mail.ml","my3mail.tk","myddns.me","myeslbookclub.com","mymy.cf","mysafe.ml","mzon.store","n-e.kr","nafko.cf","nctu.me","netmail.tk","netricity.nl","new-mgmt.ga","ngalasmoen.xyz","ngguwokulon.online","njambon.space","nko.kr","now.im","npv.kr","nuo.co.kr","nuo.kr","nut.cc","o-r.kr","oazis.site","obo.kr","ocry.com","office.gy","okezone.bid","one.pl","onlysext.com","oovy.org","oppoesrt.online","orangotango.ml","otherinbox.com","ourhobby.com","owa.kr","owh.ooo","oyu.kr","p-e.kr","pafnuty.com","pandies.space","paqeh.online","pe.hu","petinggiean.tech","peyekkolipi.buzz","poderosamulher.com","poistaa.com","porco.cf","poy.kr","prapto.host","probatelawarizona.com","ptcu.dev","pubgm.website","qbi.kr","qc.to","r-e.kr","ragel.me","rao.kr","reilis.site","rf.gd","ringen.host","rko.kr","rosso.ml","row.kr","rr.nu","rshagor.xyz","s-ly.me","safe-mail.gq","sagun.info","samsueng.site","saucent.online","sborra.tk","schwarzmail.ga","seluang.com","sempak.link","sendaljepit.site","sendangagung.online","servegame.com","shp7.cn","siambretta.com","skodaauto.cf","soju.buzz","solidplai.us","somee.com","spamtrap.ro","spymail.one","ssanphone.me","standeight.com","statuspage.ga","steakbeef.site","stonedogdigital.com","stop-my-spam.pp.ua","storeyee.com","sumanan.site","supere.ml","svblog.com","sytes.net","tandy.co","tangtingtung.tech","teml.net","tempembus.buzz","tempremail.cf","tempremail.tk","tgwrzqr.top","thepieter.com","theworkpc.com","thinktimessolve.info","thumoi.com","tko.co.kr","tko.kr","tmo.kr","tmpeml.com","toh.info","toi.kr","tomcrusenono.host","topikurrohman.xyz","tourbalitravel.com","traveldesk.com","tricakesi.store","trillianpro.com","twilightparadox.com","tyrex.cf","uha.kr","uk.to","uko.kr","umy.kr","unaux.com","undo.it","uny.kr","uola.org","upy.kr","urbanban.com","us.to","usa.cc","uu.gl","uvy.kr","uyu.kr","vay.kr","vba.kr","veo.kr","viola.gq","vivoheroes.xyz","vkbags.in","vo.uk","volvo-xc.tk","vuforia.us","wakultimbo.buzz","web.id","weprof.it","werkuldino.buzz","wil.kr","wingkobabat.buzz","x24hr.com","xiaomie.store","xo.uk","xxi2.com","yarien.eu","yawahid.host","ye.vc","yertxenor.tk","yomail.info","yopmail.com","yoqoyyum.space","youdontcare.com","zalvisual.us","zapto.org","ze.cx","zeroe.ml"]},22200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e.some((e=>e.pv))){const t=e.findIndex((e=>e.pk));if(t===e.length-1){if(t>0)return e[t-1].pv=!0,e[t-1];if(e.length>0)return e[0].pv=!0,e[0]}else{if(t>-1)return e[t+1].pv=!0,e[t+1];if(e.length>0)return e[0].pv=!0,e[0]}}}},1512:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.setMigrationJobsStallInterval=t.updateMigrationJobsState=t.getMigrationJobsState=t.instanceUuid=t.MIGRATION_JOBS_STORE_KEY=void 0;const s=a(81104),r=i(a(76584)),l=a(64612);t.MIGRATION_JOBS_STORE_KEY="NC_MIGRATION_JOBS",t.instanceUuid=(0,s.v4)();const c={version:"0",stall_check:Date.now(),locked:!1,instance:t.instanceUuid};t.getMigrationJobsState=async()=>{const e=r.default.ncMeta,a=await e.metaGet(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.STORE,{key:t.MIGRATION_JOBS_STORE_KEY});if(!a)return await e.metaInsert2(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.STORE,{key:t.MIGRATION_JOBS_STORE_KEY,value:JSON.stringify(c)},!0),c;try{const e=JSON.parse((null==a?void 0:a.value)||"{}");return"version"in e?e:c}catch(e){return console.error("Error parsing migration jobs state",e),c}};t.updateMigrationJobsState=async(e,a)=>{const i=r.default.ncMeta,s=a||await(0,t.getMigrationJobsState)();if(s){const a=Object.assign(Object.assign(Object.assign({},s),e),{instance:t.instanceUuid});await i.metaUpdate(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.STORE,{value:JSON.stringify(a)},{key:t.MIGRATION_JOBS_STORE_KEY})}else{const a=Object.assign(Object.assign(Object.assign({},c),e),{instance:t.instanceUuid});await i.metaInsert2(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.STORE,{key:t.MIGRATION_JOBS_STORE_KEY,value:JSON.stringify(a)},!0)}};t.setMigrationJobsStallInterval=()=>setInterval((async()=>{try{const e=await(0,t.getMigrationJobsState)();e.stall_check=Date.now(),await(0,t.updateMigrationJobsState)(e)}catch(e){console.error("Error updating stall check for migration job",e)}}),3e5)},79383:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IGNORE_TABLES=void 0,t.extractAndGenerateManyToManyRelations=S,t.populateMeta=async function(e,a,i,s){var r,l,d,p,T,k,M,O,I,C,E,x,L;const R={type:"rest",apiCount:0,tablesCount:0,relationsCount:0,viewsCount:0,client:null===(r=await(null==a?void 0:a.getConnectionConfig()))||void 0===r?void 0:r.client,timeTaken:0},N=process.hrtime(),A=await b.default.getSqlClient(a);let D=1;const j={},P=[],q=null===(p=null===(d=await A.relationListAll({schema:null===(l=a.getConfig())||void 0===l?void 0:l.schema}))||void 0===d?void 0:d.data)||void 0===p?void 0:p.list;R.relationsCount=q.length;let U=null===(I=null===(O=null===(M=null===(k=await A.tableList({schema:null===(T=a.getConfig())||void 0===T?void 0:T.schema}))||void 0===k?void 0:k.data)||void 0===M?void 0:M.list)||void 0===O?void 0:O.filter((({tn:e})=>!t.IGNORE_TABLES.includes(e))))||void 0===I?void 0:I.map((e=>(e.order=++D,e.title=(0,h.default)(e.tn,i.prefix,a),e.table_name=e.tn,e)));a.is_meta&&(null==i?void 0:i.prefix)&&(U=U.filter((e=>{var t;return null===(t=null==e?void 0:e.tn)||void 0===t?void 0:t.startsWith(null==i?void 0:i.prefix)})));R.tablesCount=U.length,U.forEach((e=>{e.title=(0,h.default)(e.tn,i.prefix,a)})),q.forEach((e=>{e.title=(0,h.default)(e.tn,i.prefix,a),e.rtitle=(0,h.default)(e.rtn,i.prefix,a)}));let $=null;"pg"===a.type&&($={format:(await A.getDefaultByteaOutputFormat()).data});const Y=U.map((t=>async()=>{var r,l,d;null==s||s(`Populating meta for table '${t.title}'`);const p=q.filter((e=>e.tn===t.tn||e.rtn===t.tn)),g=null===(d=null===(l=await A.columnList({tn:t.tn,schema:null===(r=a.getConfig())||void 0===r?void 0:r.schema}))||void 0===l?void 0:l.data)||void 0===d?void 0:d.list,y="view"===t.type?[]:p.filter((e=>e.rtn===t.tn)),b="view"===t.type?[]:p.filter((e=>e.tn===t.tn));(0,_.default)(g);const T=[...y.map((e=>({uidt:c.UITypes.Links,type:"hm",hm:e,title:(0,u.pluralize)(e.title),meta:{plural:(0,u.pluralize)(e.title),singular:(0,u.singularize)(e.title)}}))),...b.map((e=>{const t=g.find((t=>t.cn===e.cn));return t&&(t.uidt=c.UITypes.ForeignKey,t.system=!0),{uidt:c.UITypes.LinkToAnotherRecord,type:"bt",bt:e,title:`${e.rtitle}`}}))];j[t.table_name]=await w.default.insert(e,i.id,a.id,{table_name:t.tn||t.table_name,title:t.title,type:t.type||"table",order:t.order}),R.apiCount+=5;let k=1;for(const i of g)"databricks"===a.type&&i.pk&&!i.cdf&&(i.meta={ag:"nc"}),await v.default.insert(e,Object.assign(Object.assign(Object.assign({uidt:i.uidt||(0,f.default)(a,i),fk_model_id:j[t.tn].id},i),{title:(0,h.getColumnNameAlias)(i.cn,a),column_name:i.cn,order:k++}),$&&"bytea"===i.dt?{meta:$}:{}));P.push((async()=>{var r,l,c,d,u,p,_,f;const h={};for(const g of T){let y=0;for(;`${g.title}${y||""}`in h;)y++;g.title=`${g.title}${y||""}`,h[g.title]=!0,null==s||s(`Populating meta for column '${g.title}'`);const b=g.hm||g.bt,w=null===(c=null===(l=await(null===(r=null==j?void 0:j[b.tn])||void 0===r?void 0:r.getColumns(e)))||void 0===l?void 0:l.find((e=>e.column_name===b.cn)))||void 0===c?void 0:c.id,T=null===(d=null==j?void 0:j[b.tn])||void 0===d?void 0:d.id,S=null===(_=null===(p=await(null===(u=null==j?void 0:j[b.rtn])||void 0===u?void 0:u.getColumns(e)))||void 0===p?void 0:p.find((e=>e.column_name===b.rcn)))||void 0===_?void 0:_.id,M=null===(f=null==j?void 0:j[b.rtn])||void 0===f?void 0:f.id;try{await v.default.insert(e,{base_id:i.id,db_alias:a.id,fk_model_id:j[t.tn].id,cn:(0,m.getUniqueColumnName)(j[t.tn].columns,g.cn),title:(0,m.getUniqueColumnAliasName)(j[t.tn].columns,g.title),uidt:g.uidt,type:g.hm?"hm":g.mm?"mm":"bt",fk_child_column_id:w,fk_parent_column_id:S,fk_index_name:b.cstn,ur:b.ur,dr:b.dr,order:k++,fk_related_model_id:g.hm?T:M,system:g.system,meta:g.meta}),R.apiCount+=5}catch(e){console.log(e)}null==s||s(`Populated meta for column '${g.title}'`)}})),null==s||s(`Populated meta for table '${t.title}'`)}));await y.default.executeOperations(Y,a.type),await y.default.executeOperations(P,a.type),await S(e,Object.values(j));let B=null===(L=null===(x=null===(E=await A.viewList({schema:null===(C=a.getConfig())||void 0===C?void 0:C.schema}))||void 0===E?void 0:E.data)||void 0===x?void 0:x.list)||void 0===L?void 0:L.map((e=>(e.order=++D,e.table_name=e.view_name,e.title=(0,h.default)(e.view_name,i.prefix,a),e)));a.is_meta&&(null==i?void 0:i.prefix)&&(B=U.filter((e=>{var t;return null===(t=null==e?void 0:e.tn)||void 0===t?void 0:t.startsWith(null==i?void 0:i.prefix)})));R.viewsCount=B.length;const F=B.map((t=>async()=>{var r,l,d;const u=null===(d=null===(l=await A.columnList({tn:t.table_name,schema:null===(r=a.getConfig())||void 0===r?void 0:r.schema}))||void 0===l?void 0:l.data)||void 0===d?void 0:d.list;(0,_.default)(u),j[t.table_name]=await w.default.insert(e,i.id,a.id,{table_name:t.table_name,title:(0,h.default)(t.table_name,i.prefix,a),type:c.ModelTypes.VIEW,order:t.order});let p=1;R.apiCount+=2;for(const i of u)await v.default.insert(e,Object.assign(Object.assign({fk_model_id:j[t.table_name].id},i),{title:(0,h.getColumnNameAlias)(i.cn,a),order:p++,uidt:(0,f.default)(a,i)}));null==s||s(`Populated meta for view '${t.title}'`)}));await y.default.executeOperations(F,a.type);const V=await w.default.list(e,{base_id:i.id,source_id:a.id});for(const t of V){const a=await t.getViews(e);for(const t of a)t.type===c.ViewTypes.GRID&&await g.default.fixPVColumnForView(e,t.id)}const H=process.hrtime(N),G=H[0]+H[1]/1e9;return R.timeTaken=G.toFixed(1),null==s||s(`Populating meta completed in ${G.toFixed(1)}s`),R},t.populateRollupColumnAndHideLTAR=async function(e,t,a){var i,s;for(const r of await w.default.list(e,{base_id:a.id,source_id:t.id})){const t=(await r.getColumns(e)).filter((e=>e.uidt===c.UITypes.LinkToAnotherRecord&&e.colOptions.type!==d.RelationTypes.BELONGS_TO&&!e.system)),a=await r.getViews(e);for(const l of t){const t=await l.getColOptions(e).then((t=>t.getRelatedTable(e)));await t.getColumns(e);const d=(null===(i=t.primaryKey)||void 0===i?void 0:i.id)||(null===(s=(await t.getColumns(e))[0])||void 0===s?void 0:s.id);await v.default.insert(e,{uidt:c.UITypes.Links,title:(0,m.getUniqueColumnAliasName)(await r.getColumns(e),`${t.title}`),fk_rollup_column_id:d,fk_model_id:r.id,rollup_function:"count",fk_relation_column_id:l.id,meta:{singular:(0,u.singularize)(t.title),plural:(0,u.pluralize)(t.title)}});const p=await T.GridViewColumn.list(e,a[0].id).then((e=>e.find((e=>e.fk_column_id===l.id))));await T.GridViewColumn.update(e,p.id,{show:!1})}}};const c=a(71040),d=a(71040),u=a(42496),p=a(71040),m=a(98644),_=l(a(22200)),f=l(a(47724)),h=r(a(57972)),g=l(a(70176)),y=l(a(50984)),b=l(a(82096)),w=l(a(84072)),v=l(a(57596)),T=a(19684);async function k(e,t,a,i){let s=!1;const r=await i.getColOptions(e);for(const i of await t.getColumns(e))if(i.uidt===c.UITypes.LinkToAnotherRecord){const t=await i.getColOptions(e);if(t&&t.type===d.RelationTypes.MANY_TO_MANY&&t.fk_mm_model_id===a.id&&t.fk_child_column_id===r.fk_parent_column_id&&t.fk_mm_child_column_id===r.fk_child_column_id){s=!0;break}}return s}async function S(e,t){for(const a of t){await a.getColumns(e);const t=a.columns.filter((e=>!(0,d.isVirtualCol)(e))),i=[];for(const t of a.columns)if(t.uidt==c.UITypes.LinkToAnotherRecord){const a=await t.getColOptions(e);(null==a?void 0:a.type)===d.RelationTypes.BELONGS_TO&&i.push(t)}if(2===(null==i?void 0:i.length)&&t.length<5&&2===a.primaryKeys.length&&a.primaryKeys.every((e=>i.some((t=>{var a;return(null===(a=t.colOptions)||void 0===a?void 0:a.fk_child_column_id)===e.id}))))){const t=await i[0].colOptions.getRelatedTable(e),s=await i[1].colOptions.getRelatedTable(e);await t.getColumns(e),await s.getColumns(e);const r=await k(e,t,a,i[0]),l=await k(e,s,a,i[1]);r||await v.default.insert(e,{title:(0,m.getUniqueColumnAliasName)(t.columns,(0,u.pluralize)(s.title)),fk_model_id:t.id,fk_related_model_id:s.id,fk_mm_model_id:a.id,fk_child_column_id:i[0].colOptions.fk_parent_column_id,fk_parent_column_id:i[1].colOptions.fk_parent_column_id,fk_mm_child_column_id:i[0].colOptions.fk_child_column_id,fk_mm_parent_column_id:i[1].colOptions.fk_child_column_id,type:d.RelationTypes.MANY_TO_MANY,uidt:c.UITypes.Links,meta:{plural:(0,u.pluralize)(s.title),singular:(0,u.singularize)(s.title)}}),l||await v.default.insert(e,{title:(0,m.getUniqueColumnAliasName)(s.columns,(0,u.pluralize)(t.title)),fk_model_id:s.id,fk_related_model_id:t.id,fk_mm_model_id:a.id,fk_child_column_id:i[1].colOptions.fk_parent_column_id,fk_parent_column_id:i[0].colOptions.fk_parent_column_id,fk_mm_child_column_id:i[1].colOptions.fk_child_column_id,fk_mm_parent_column_id:i[0].colOptions.fk_child_column_id,type:d.RelationTypes.MANY_TO_MANY,uidt:c.UITypes.Links,meta:{plural:(0,u.pluralize)(t.title),singular:(0,u.singularize)(t.title)}}),await w.default.markAsMmTable(e,a.id,!0);for(const t of[i[0],i[1]]){const a=await t.colOptions,i=await a.getRelatedTable(e);for(const t of await i.getColumns(e)){if(!(0,p.isLinksOrLTAR)(t.uidt))continue;const i=await t.getColOptions(e);if(i&&i.type===d.RelationTypes.HAS_MANY&&(i.fk_child_column_id===a.fk_child_column_id&&i.fk_parent_column_id===a.fk_parent_column_id)){await v.default.markAsSystemField(e,t.id);break}}}}else a.mm&&await w.default.markAsMmTable(e,a.id,!1)}}t.IGNORE_TABLES=["nc_models","nc_roles","nc_routes","nc_loaders","nc_resolvers","nc_hooks","nc_store","_evolutions","nc_evolutions","xc_users","nc_rpc","nc_acl","nc_cron","nc_disabled_models_for_role","nc_audit","xc_knex_migrations","xc_knex_migrations_lock","nc_plugins","nc_migrations","nc_api_tokens","nc_projects","nc_projects_users","nc_relations","nc_shared_views"]},43248:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.populateSamplePayload=l,t.populateSamplePayloadV2=async function(e,t,a=!1,l="insert",d="records"){const u={};let p,m=[];if(t instanceof r.View){const a=await t.getColumns(e);for(const t of a)t.show&&m.push(await r.Column.get(e,{colId:t.fk_column_id}));p=await t.getModel(e),await p.getColumns(e)}else t instanceof r.Model&&(m=await t.getColumns(e),p=t);await p.getViews(e);const _={type:`${d}.after.${l}`,id:(0,s.v4)(),data:{table_id:p.id,table_name:p.title,view_id:p.views[0].id,view_name:p.views[0].title}};for(const t of m)!a&&[i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(t.uidt)||(u[t.title]=await c(e,t));let f;["update","bulkUpdate"].includes(l)&&(f=u);return _.data=Object.assign(Object.assign(Object.assign(Object.assign({},_.data),f&&{previous_rows:[f]}),"bulkInsert"!==l&&u&&{rows:[u]}),"bulkInsert"===l&&u&&{row_inserted:10}),_};const i=a(71040),s=a(81104),r=a(19684);async function l(e,t,a=!1,s="insert"){var l;const d={};let u,p=[];if(t instanceof r.View){const a=await t.getColumns(e);for(const t of a)t.show&&p.push(await r.Column.get(e,{colId:t.fk_column_id}));u=await t.getModel(e),await u.getColumns(e)}else t instanceof r.Model&&(p=await t.getColumns(e),u=t);for(const t of p)!a&&[i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(t.uidt)||"delete"===s&&(null===(l=u.primaryKey)||void 0===l?void 0:l.title)!==t.title||(d[t.title]=await c(e,t));return d}async function c(e,t){var a,s,r,d,u,p,m,_;switch(t.uidt){case i.UITypes.ID:return 1;case i.UITypes.LinkToAnotherRecord:{const a=await t.getColOptions(e),s=await l(e,await a.getRelatedTable(e));if(a.type!==i.RelationTypes.BELONGS_TO)return;return a.type===i.RelationTypes.BELONGS_TO?s:[s]}case i.UITypes.ForeignKey:return 1;case i.UITypes.Lookup:{const a=await t.getColOptions(e),s=await a.getRelationColumn(e).then((t=>t.getColOptions(e))),r=await c(e,await a.getLookupColumn(e));return s.type===i.RelationTypes.BELONGS_TO?r:[r].flat()}case i.UITypes.SingleLineText:return"Sample Text";case i.UITypes.LongText:return"Sample Long text";case i.UITypes.Attachment:return[{url:"https://nocodb.com/dummy.png",title:"image.png",mimetype:"image/png",size:0}];case i.UITypes.Checkbox:return!0;case i.UITypes.MultiSelect:{const i=await t.getColOptions(e);return(null===(a=null==i?void 0:i[0])||void 0===a?void 0:a.title)||(null===(d=null===(r=null===(s=null==t?void 0:t.dtxp)||void 0===s?void 0:s.split(","))||void 0===r?void 0:r[0])||void 0===d?void 0:d.replace(/^['"]|['"]$/g,""))}case i.UITypes.SingleSelect:{const a=await t.getColOptions(e);return(null===(u=null==a?void 0:a[0])||void 0===u?void 0:u.title)||(null===(_=null===(m=null===(p=null==t?void 0:t.dtxp)||void 0===p?void 0:p.split(","))||void 0===m?void 0:m[0])||void 0===_?void 0:_.replace(/^['"]|['"]$/g,""))}case i.UITypes.Date:return new Date;case i.UITypes.Year:return 2e3;case i.UITypes.Time:return"11:00";case i.UITypes.PhoneNumber:return"0000000000";case i.UITypes.Email:return"test@nocodb.com";case i.UITypes.URL:return"https://nocodb.com";case i.UITypes.Number:return 123;case i.UITypes.Decimal:return 123.1;case i.UITypes.Currency:return"$123";case i.UITypes.Percent:return"10";case i.UITypes.Duration:return 123;case i.UITypes.Rating:return 1;case i.UITypes.Formula:return"Sample Output";case i.UITypes.Rollup:case i.UITypes.Count:return 1;case i.UITypes.DateTime:case i.UITypes.CreatedTime:case i.UITypes.LastModifiedTime:return new Date;case i.UITypes.AutoNumber:return 1;case i.UITypes.Geometry:return{};case i.UITypes.JSON:return"{}";case i.UITypes.SpecificDBType:return null}}},44356:(e,t)=>{"use strict";function a(e){return"string"!=typeof e?e:null==e?void 0:e.replace(/([^\\]|^)(\?+)/g,((e,t,a)=>`${t}${a.split("?").join("\\?")}`))}Object.defineProperty(t,"__esModule",{value:!0}),t.sanitize=a,t.unsanitize=function(e){return"string"!=typeof e?e:null==e?void 0:e.replace(/\\[?]/g,"?")},t.sanitizeAndEscapeDots=function(e,t){var i;const s=a(e);if(!t||!s.includes("."))return s;switch(null===(i=null==t?void 0:t.clientType)||void 0===i?void 0:i.call(t)){case"mysql":case"mysql2":return t.raw(t.raw("??",s).toQuery().replace(/`\.`/g,"."));case"pg":return t.raw(t.raw("??",s).toQuery().replace(/"\."/g,"."));default:return s}}},36616:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.randomTokenString=function(){return s.default.randomBytes(40).toString("hex")},t.utf8ify=function(e){return Buffer.from(e,"latin1").toString("utf8")};const s=i(a(87968))},47660:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){for(const t of await e.getSources())try{const a=new s.default({workspace_id:e.fk_workspace_id,base_id:e.id},e);await a.init(t),await a.sync(t),await a.migrationsUp({source:t})}catch(e){console.log(e)}},t.syncBaseMigration=async function(e,t){try{const a=new s.default({workspace_id:e.fk_workspace_id,base_id:e.id},e);await a.init(t),await a.sync(t),await a.migrationsUp({source:t})}catch(e){throw e}};const s=i(a(27464))},51987:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(const a of e)if(!(a in t))throw new Error(`Missing '${a}' property in request body`)}},14836:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseBody=b,t.validateCondition=w,t.constructWebHookData=v,t.handleHttpWebHook=T,t.axiosRequestMake=k,t.invokeWebhook=async function(e,t){var a,i,s,r,l,c;const{hook:d,model:u,view:p,prevData:m,user:_,testFilters:f=null,throwErrorOnFailure:v=!1,testHook:k=!1}=t;let S,{newData:M}=t;const O=process.hrtime(),I=await g.Source.get(e,u.source_id);let C;try{C="string"==typeof d.notification?JSON.parse(d.notification):d.notification;const t=Array.isArray(M);if(t&&"URL"!==(null==C?void 0:C.type))return;if(d.condition&&!k){const a=f||await d.getFilters(e);if(t){const t=[];for(let a=0;a<M.length;a++){const i=M[a];await w(e,f||await d.getFilters(e),i,{client:null==I?void 0:I.type})&&t.push(i)}if(!t.length)return;M=t}else{if(m&&a.length&&await w(e,a,m,{client:null==I?void 0:I.type}))return;if(!await w(e,f||await d.getFilters(e),M,{client:null==I?void 0:I.type}))return}}switch(null==C?void 0:C.type){case"Email":{const e=await(null===(a=await h.default.emailAdapter(!1))||void 0===a?void 0:a.mailSend({to:b(null===(i=null==C?void 0:C.payload)||void 0===i?void 0:i.to,M),subject:b(null===(s=null==C?void 0:C.payload)||void 0===s?void 0:s.subject,M),html:b(null===(r=null==C?void 0:C.payload)||void 0===r?void 0:r.body,M)}));"ALL"===process.env.NC_AUTOMATION_LOG_LEVEL&&(S=Object.assign(Object.assign({},d),{fk_hook_id:d.id,type:C.type,payload:JSON.stringify(null==C?void 0:C.payload),response:JSON.stringify(e),triggered_by:null==_?void 0:_.email}))}break;case"URL":{const e=await T(d,u,p,null==C?void 0:C.payload,_,m,M);"ALL"===process.env.NC_AUTOMATION_LOG_LEVEL&&(S=Object.assign(Object.assign({},d),{fk_hook_id:d.id,type:C.type,payload:JSON.stringify(null==C?void 0:C.payload),response:JSON.stringify({status:e.status,statusText:e.statusText,headers:e.headers,config:{url:e.config.url,method:e.config.method,data:e.config.data,headers:e.config.headers,params:e.config.params}}),triggered_by:null==_?void 0:_.email}))}break;default:{const e=await(await h.default.webhookNotificationAdapters(C.type)).sendMessage(b(null===(l=null==C?void 0:C.payload)||void 0===l?void 0:l.body,M),JSON.parse(JSON.stringify(null==C?void 0:C.payload),((e,t)=>"string"==typeof t?b(t,M):t)));"ALL"===process.env.NC_AUTOMATION_LOG_LEVEL&&(S=Object.assign(Object.assign({},d),{fk_hook_id:d.id,type:C.type,payload:JSON.stringify(null==C?void 0:C.payload),response:JSON.stringify({status:e.status,statusText:e.statusText,headers:e.headers,config:{url:e.config.url,method:e.config.method,data:e.config.data,headers:e.config.headers,params:e.config.params}}),triggered_by:null==_?void 0:_.email}))}}}catch(e){if(e.response?y.error({data:e.response.data,status:e.response.status,url:null===(c=e.response.config)||void 0===c?void 0:c.url,message:e.message}):y.error(e.message,e.stack),["ERROR","ALL"].includes(process.env.NC_AUTOMATION_LOG_LEVEL)&&(S=Object.assign(Object.assign({},d),{type:C.type,payload:JSON.stringify(null==C?void 0:C.payload),fk_hook_id:d.id,error_code:e.error_code,error_message:e.message,error:JSON.stringify(e),triggered_by:null==_?void 0:_.email})),v)throw e}finally{S&&(S.execution_time=((E=process.hrtime(O))[0]+E[1]/1e6).toFixed(3),g.HookLog.insert(e,Object.assign(Object.assign({},S),{test_call:k})))}var E},t._transformSubmittedFormDataForEmail=function(e,t,a){const i=Object.assign({},e);for(const e of a)"Attachment"===e.uidt?("string"==typeof i[e.title]&&(i[e.title]=JSON.parse(i[e.title])),i[e.title]=(i[e.title]||[]).map((e=>e.title)).join("<br/>")):i[e.title]&&"object"==typeof i[e.title]&&(i[e.title]=JSON.stringify(i[e.title]));return i};const s=i(a(59146)),r=a(81104),l=i(a(71178)),c=a(1384),d=a(23324),u=i(a(44578)),p=a(71040),m=i(a(69696)),_=i(a(41624)),f=i(a(33976)),h=i(a(23080)),g=a(19684);u.default.extend(m.default),u.default.extend(_.default),u.default.extend(f.default),s.default.registerHelper("json",(function(e,t=!1){return!0===t||"true"===t?JSON.stringify(e,null,2):JSON.stringify(e)}));const y=new d.Logger("webhookHelpers");function b(e,t){if(!e)return e;try{return s.default.compile(e,{noEscape:!0})({data:t,event:t})}catch(t){return e}}async function w(e,t,a,{client:i}){var s,r,l,c,d,m,_,f,h,y,b,v,T,k,S,M,O,I,C,E;if(!t.length)return!0;let x=null;for(const L of t){const t=L instanceof g.Filter?L:new g.Filter(L);let R;if(t.is_group)R=await w(e,t.children||await t.getChildren(e),a,{client:i});else{const g=await t.getColumn(e),w=g.title;let x=a[w];if([p.UITypes.Date,p.UITypes.DateTime,p.UITypes.CreatedTime,p.UITypes.LastModifiedTime].includes(g.uidt)&&!["empty","blank","notempty","notblank"].includes(t.comparison_op)){const e="mysql2"===i?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";let a=(0,u.default)(new Date);const r=null===(s=null==g?void 0:g.meta)||void 0===s?void 0:s.date_format,l=x;let c=t.value;switch(r&&(0,p.isDateMonthFormat)(r)&&(a=(0,u.default)(a).date(1),x&&(x=(0,u.default)(x).date(1))),c&&(R=(0,u.default)(c).isSame(l,"day")),t.comparison_sub_op){case"today":c=a;break;case"tomorrow":c=a.add(1,"day");break;case"yesterday":c=a.add(-1,"day");break;case"oneWeekAgo":case"pastWeek":c=a.add(-1,"week");break;case"oneWeekFromNow":case"nextWeek":c=a.add(1,"week");break;case"oneMonthAgo":case"pastMonth":c=a.add(-1,"month");break;case"oneMonthFromNow":case"nextMonth":c=a.add(1,"month");break;case"daysAgo":case"pastNumberOfDays":if(!c)return;c=a.add(-c,"day");break;case"daysFromNow":case"nextNumberOfDays":if(!c)return;c=a.add(c,"day");break;case"exactDate":if(!c)return;break;case"pastYear":c=a.add(-1,"year");break;case"nextYear":c=a.add(1,"year")}if(l)switch(t.comparison_op){case"eq":R=(0,u.default)(l).isSame(c,"day");break;case"neq":R=!(0,u.default)(l).isSame(c,"day");break;case"gt":R=(0,u.default)(l).isAfter(c,"day");break;case"lt":R=(0,u.default)(l).isBefore(c,"day");break;case"lte":case"le":R=(0,u.default)(l).isSameOrBefore(c,"day");break;case"gte":case"ge":R=(0,u.default)(l).isSameOrAfter(c,"day");break;case"empty":case"blank":R=""===l||null==l;break;case"notempty":case"notblank":R=!(""===l||null==l);break;case"isWithin":{let a=(0,u.default)(new Date).format(e).toString();switch(a=g.uidt===p.UITypes.Date?a.substring(0,10):a,t.comparison_sub_op){case"pastWeek":case"pastMonth":case"pastYear":case"pastNumberOfDays":R=(0,u.default)(l).isBetween(c,a,"day");break;case"nextWeek":case"nextMonth":case"nextYear":case"nextNumberOfDays":R=(0,u.default)(l).isBetween(a,c,"day")}}}}else{switch(typeof t.value){case"boolean":x=!!a[w];break;case"number":x=+a[w]}if([p.UITypes.User,p.UITypes.CreatedBy,p.UITypes.LastModifiedBy].includes(g.uidt)){const e=Array.isArray(a[w])?a[w].map((e=>e.id)):(null===(r=a[w])||void 0===r?void 0:r.id)?[a[w].id]:[],i=t.value.split(",").map((e=>e.trim()));switch(t.comparison_op){case"anyof":R=e.some((e=>i.includes(e)));break;case"nanyof":R=!e.some((e=>i.includes(e)));break;case"allof":R=i.every((t=>e.includes(t)));break;case"nallof":R=!i.every((t=>e.includes(t)));break;case"empty":case"blank":R=0===e.length;break;case"notempty":case"notblank":R=e.length>0;break;default:R=!1}}else switch(t.comparison_op){case"eq":R=x==t.value;break;case"neq":R=x!=t.value;break;case"like":R=(null===(m=null===(d=null===(c=null===(l=a[w])||void 0===l?void 0:l.toString)||void 0===c?void 0:c.call(l))||void 0===d?void 0:d.toLowerCase())||void 0===m?void 0:m.indexOf(null===(_=t.value)||void 0===_?void 0:_.toLowerCase()))>-1;break;case"nlike":R=-1===(null===(b=null===(y=null===(h=null===(f=a[w])||void 0===f?void 0:f.toString)||void 0===h?void 0:h.call(f))||void 0===y?void 0:y.toLowerCase())||void 0===b?void 0:b.indexOf(null===(v=t.value)||void 0===v?void 0:v.toLowerCase()));break;case"empty":case"blank":R=""===a[w]||null===a[w]||void 0===a[w];break;case"notempty":case"notblank":R=!(""===a[w]||null===a[w]||void 0===a[w]);break;case"checked":R=!!a[w];break;case"notchecked":R=!a[w];break;case"null":R=R=null===a[w];break;case"notnull":R=null!==a[w];break;case"allof":R=(null!==(k=null===(T=t.value)||void 0===T?void 0:T.split(",").map((e=>e.trim())))&&void 0!==k?k:[]).every((e=>{var t,i;return(null!==(i=null===(t=a[w])||void 0===t?void 0:t.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"anyof":R=(null!==(M=null===(S=t.value)||void 0===S?void 0:S.split(",").map((e=>e.trim())))&&void 0!==M?M:[]).some((e=>{var t,i;return(null!==(i=null===(t=a[w])||void 0===t?void 0:t.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"nallof":R=!(null!==(I=null===(O=t.value)||void 0===O?void 0:O.split(",").map((e=>e.trim())))&&void 0!==I?I:[]).every((e=>{var t,i;return(null!==(i=null===(t=a[w])||void 0===t?void 0:t.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"nanyof":R=!(null!==(E=null===(C=t.value)||void 0===C?void 0:C.split(",").map((e=>e.trim())))&&void 0!==E?E:[]).some((e=>{var t,i;return(null!==(i=null===(t=a[w])||void 0===t?void 0:t.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"lt":R=+a[w]<+t.value;break;case"lte":case"le":R=+a[w]<=+t.value;break;case"gt":R=+a[w]>+t.value;break;case"gte":case"ge":R=+a[w]>=+t.value}}}switch(t.logical_op){case"or":x=x||!!R;break;case"not":x=x&&!R;break;default:x=(null==x||x)&&R}}return x}function v(e,t,a,i,s){if("v2"===e.version){return{type:`${"records"}.${e.event}.${e.operation}`,id:(0,r.v4)(),data:Object.assign(Object.assign(Object.assign({table_id:t.id,table_name:t.title},i&&{previous_rows:Array.isArray(i)?i:[i]}),"bulkInsert"!==e.operation&&s&&{rows:Array.isArray(s)?s:[s]}),"bulkInsert"===e.operation&&{rows_inserted:Array.isArray(s)?s.length:s?1:0})}}return s}async function T(e,t,a,i,s,r,c){var d;(null===(d=i.headers)||void 0===d?void 0:d.find((e=>{var t;return"content-type"===(null===(t=e.name)||void 0===t?void 0:t.toLowerCase())&&e.enabled})))||i.headers.push({name:"Content-Type",enabled:!0,value:"application/json"});const u=k(i,s,v(e,t,0,r,c));return(0,l.default)(u)}function k(e,t,a){const i=Object.assign({},e);if(i.body)try{i.body=JSON.parse("string"==typeof i.body?i.body:JSON.stringify(i.body),((e,t)=>"string"==typeof t?b(t,a):t))}catch(e){i.body=b(i.body,a)}if(i.auth)try{i.auth=JSON.parse("string"==typeof i.auth?i.auth:JSON.stringify(i.auth),((e,t)=>"string"==typeof t?b(t,a):t))}catch(e){i.auth=b(i.auth,a)}i.response={};const s=b(i.path,a);return Object.assign(Object.assign({params:i.parameters?i.parameters.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=b(t.value,a)),e)),{}):{},url:s,method:i.method,data:i.body,headers:i.headers?i.headers.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=b(t.value,a)),e)),{}):{},withCredentials:!0},"true"!==process.env.NC_ALLOW_LOCAL_HOOKS?{httpAgent:(0,c.useAgent)(s,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,c.useAgent)(s,{stopPortScanningByUrlRedirection:!0})}:{}),{timeout:3e4})}},42125:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Noco=void 0;const s=i(a(76584));t.Noco=s.default,t.default=s.default},60395:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UploadAllowedInterceptor=void 0;const r=a(23324),l=a(71040),c=s(a(76584)),d=a(43820),u=a(64612);let p=class UploadAllowedInterceptor{async intercept(e,t){var a,i;const s=e.switchToHttp().getRequest();(null===(a=s.user)||void 0===a?void 0:a.id)||(null===(i=s.user)||void 0===i?void 0:i.isPublicBase)||d.NcError.unauthorized("Unauthorized");try{if((0,l.extractRolesObj)(s.user.roles)[l.OrgUserRoles.SUPER_ADMIN]||(0,l.extractRolesObj)(s.user.roles)[l.OrgUserRoles.CREATOR]||(0,l.extractRolesObj)(s.user.roles)[l.ProjectRoles.EDITOR]||await c.default.ncMeta.knex(u.MetaTable.PROJECT_USERS).where((function(){this.where("roles",l.ProjectRoles.OWNER),this.orWhere("roles",l.ProjectRoles.CREATOR),this.orWhere("roles",l.ProjectRoles.EDITOR)})).andWhere("fk_user_id",s.user.id).first())return t.handle()}catch(e){}d.NcError.badRequest("Upload not allowed")}};t.UploadAllowedInterceptor=p,t.UploadAllowedInterceptor=p=i([(0,r.Injectable)()],p)},81472:(e,t)=>{"use strict";var a,i,s,r,l,c,d;Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceCommands=t.InstanceTypes=t.JOB_REQUEUE_LIMIT=t.JOB_REQUEUED=t.JobVersions=t.JobEvents=t.JobStatus=t.JobTypes=t.MigrationJobTypes=t.JOBS_QUEUE=void 0,t.JOBS_QUEUE="jobs",function(e){e.Attachment="attachment",e.Thumbnail="thumbnail"}(s||(t.MigrationJobTypes=s={})),function(e){e.DuplicateBase="duplicate-base",e.DuplicateModel="duplicate-model",e.DuplicateColumn="duplicate-column",e.AtImport="at-import",e.MetaSync="meta-sync",e.SourceCreate="source-create",e.SourceDelete="source-delete",e.UpdateModelStat="update-model-stat",e.UpdateWsStat="update-ws-stats",e.UpdateSrcStat="update-source-stat",e.HealthCheck="health-check",e.HandleWebhook="handle-webhook",e.CleanUp="clean-up",e.DataExport="data-export",e.ThumbnailGenerator="thumbnail-generator",e.AttachmentCleanUp="attachment-clean-up",e.InitMigrationJobs="init-migration-jobs"}(r||(t.JobTypes=r={})),function(e){e.COMPLETED="completed",e.WAITING="waiting",e.ACTIVE="active",e.DELAYED="delayed",e.FAILED="failed",e.PAUSED="paused",e.REFRESH="refresh",e.REQUEUED="requeued"}(l||(t.JobStatus=l={})),function(e){e.STATUS="job.status",e.LOG="job.log"}(c||(t.JobEvents=c={})),t.JobVersions={},t.JOB_REQUEUED="job.requeued",t.JOB_REQUEUE_LIMIT=10,t.InstanceTypes={PRIMARY:`${null!==(a=process.env.NC_ENV)&&void 0!==a?a:"default"}-primary`,WORKER:`${null!==(i=process.env.NC_ENV)&&void 0!==i?i:"default"}-worker`},function(e){e.RESUME_LOCAL="resumeLocal",e.PAUSE_LOCAL="pauseLocal",e.RESET="reset",e.RELEASE="release"}(d||(t.InstanceCommands=d={}))},48967:(e,t)=>{"use strict";var a,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Result=t.ServerlessType=t.RouteType=void 0,function(e){e.GET="get",e.POST="post",e.PUT="put",e.PATCH="patch",e.DELETE="delete",e.HEAD="head",e.OPTIONS="options"}(a||(t.RouteType=a={})),function(e){e.AWS_LAMBDA="AWS_LAMBDA",e.GCP_FUNCTION="GCP_FUNCTION",e.AZURE_FUNCTION_APP="AZURE_FUNCTION_APP",e.ALIYUN="ALIYUN",e.ZEIT="ZEIT",e.LYRID="LYRID",e.SERVERLESS="SERVERLESS"}(i||(t.ServerlessType=i={}));t.Result=class Result{constructor(e=0,t="",a={}){this.code=e,this.message=t,this.data=a}},function(e){e.GET="get",e.POST="post",e.PUT="put",e.DELETE="delete",e.PATCH="patch",e.HEAD="head",e.OPTIONS="options"}(s||(s={}))},49804:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaService=void 0;const u=a(23324),p=a(92080),m=d(a(8608)),_=d(a(44578)),f=d(a(51718)),h=d(a(76070)),g=d(a(21012)),y=d(a(36572)),b=a(25244),w=a(39143),v=a(64612),T=a(43820);_.default.extend(f.default),_.default.extend(h.default);const k=(0,p.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",4),S=(0,p.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);let M=i=class MetaService{constructor(e,t=null){this._config=e,this._knex=(0,b.XKnex)(Object.assign(Object.assign({},this._config.meta.db),{useNullAsDefault:!0})),this.trx=t}get knexInstance(){return this._knex}get config(){return this._config}get connection(){var e;return null!==(e=this.trx)&&void 0!==e?e:this.knexInstance}get knexConnection(){return this.connection}get knex(){return this.knexConnection}contextCondition(e,t,a,i){t!==a&&a!==v.RootScopes.WORKSPACE&&(i!==v.MetaTable.PROJECT?e.where("base_id",a):e.where("id",a))}async metaGet(e,t,a,i,s){return this.metaGet2(e,t,a,i,s)}async metaInsert2(e,t,a,i,s){const r=Object.assign(Object.assign({},i),s?{}:{id:(null==i?void 0:i.id)||await this.genNanoid(a)});return e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):(t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),t!==v.RootScopes.WORKSPACE&&(r.base_id=t)),await this.knexConnection(a).insert(Object.assign(Object.assign({},r),{created_at:this.now(),updated_at:this.now()})),r}async bulkMetaInsert(e,t,a,i,s){if(Array.isArray(i)?!i.length:!i)return[];const r=[],l=this.now(),c={created_at:l,updated_at:l};e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):(t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),c.base_id=t);for(const e of Array.isArray(i)?i:[i]){const t=(null==e?void 0:e.id)||await this.genNanoid(a),i=Object.assign(Object.assign(Object.assign({},e),s?{}:{id:t}),c);r.push(i)}return await this.knexConnection.batchInsert(a,r),r}async bulkMetaUpdate(e,t,a,i,s,r){if(Array.isArray(i)?!i.length:!i)return[];const l=this.knexConnection(a),c=this.now();e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):t||T.NcError.metaError({message:"Base ID is required",sql:""});const d=Object.assign(Object.assign({},i),{updated_at:c});return r?([v.MetaTable.FILE_REFERENCES].includes(a)||T.NcError.metaError({message:"This table does not support conditional bulk update",sql:""}),l.where(r),this.checkConditionPresent(l,"update"),l.update(d)):l.whereIn("id",s).update(d),this.contextCondition(l,e,t,a),l}async genNanoid(e){return`${{[v.MetaTable.PROJECT]:"p",[v.MetaTable.SOURCES]:"b",[v.MetaTable.MODELS]:"m",[v.MetaTable.COLUMNS]:"c",[v.MetaTable.COL_RELATIONS]:"l",[v.MetaTable.COL_SELECT_OPTIONS]:"s",[v.MetaTable.COL_LOOKUP]:"lk",[v.MetaTable.COL_ROLLUP]:"rl",[v.MetaTable.COL_FORMULA]:"f",[v.MetaTable.FILTER_EXP]:"fi",[v.MetaTable.SORT]:"so",[v.MetaTable.SHARED_VIEWS]:"sv",[v.MetaTable.ACL]:"ac",[v.MetaTable.FORM_VIEW]:"fv",[v.MetaTable.FORM_VIEW_COLUMNS]:"fvc",[v.MetaTable.GALLERY_VIEW]:"gv",[v.MetaTable.GALLERY_VIEW_COLUMNS]:"gvc",[v.MetaTable.KANBAN_VIEW]:"kv",[v.MetaTable.KANBAN_VIEW_COLUMNS]:"kvc",[v.MetaTable.CALENDAR_VIEW]:"cv",[v.MetaTable.CALENDAR_VIEW_COLUMNS]:"cvc",[v.MetaTable.CALENDAR_VIEW_RANGE]:"cvr",[v.MetaTable.USERS]:"us",[v.MetaTable.ORGS_OLD]:"org",[v.MetaTable.TEAMS]:"tm",[v.MetaTable.VIEWS]:"vw",[v.MetaTable.HOOKS]:"hk",[v.MetaTable.HOOK_LOGS]:"hkl",[v.MetaTable.AUDIT]:"adt",[v.MetaTable.API_TOKENS]:"tkn",[v.MetaTable.EXTENSIONS]:"ext",[v.MetaTable.COMMENTS]:"com",[v.MetaTable.COMMENTS_REACTIONS]:"cre",[v.MetaTable.USER_COMMENTS_NOTIFICATIONS_PREFERENCE]:"cnp",[v.MetaTable.JOBS]:"job",[v.MetaTable.INTEGRATIONS]:"int",[v.MetaTable.FILE_REFERENCES]:"at",[v.MetaTable.COL_BUTTON]:"btn"}[e]||"nc"}${S()}`}async metaDelete(e,t,a,i,s,r=!1){const l=this.knexConnection(a);return e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),"object"!=typeof i?l.where("id",i):i&&l.where(i),s&&l.condition(s,{}),r||this.checkConditionPresent(l,"delete"),this.contextCondition(l,e,t,a),l.del()}async metaGet2(e,t,a,i,s,r){const l=this.knexConnection(a);return r&&l.condition(r),(null==s?void 0:s.length)&&l.select(...s),e===v.RootScopes.BYPASS&&t===v.RootScopes.BYPASS||(e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):(t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),this.contextCondition(l,e,t,a))),i?("object"!=typeof i?l.where("id",i):l.where(i),l.first()):l.first()}async metaGetNextOrder(e,t){var a;const i=this.knexConnection(e);return i.where(t),i.max("order",{as:"order"}),(+(null===(a=await i.first())||void 0===a?void 0:a.order)||0)+1}async metaList2(e,t,a,i){var s;const r=this.knexConnection(a);if(e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):(t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),this.contextCondition(r,e,t,a)),(null==i?void 0:i.condition)&&r.where(i.condition),(null==i?void 0:i.limit)&&r.limit(i.limit),(null==i?void 0:i.offset)&&r.offset(i.offset),(null==i?void 0:i.xcCondition)&&r.condition(i.xcCondition),null==i?void 0:i.orderBy)for(const[e,t]of Object.entries(i.orderBy))r.orderBy(e,t);return(null===(s=null==i?void 0:i.fields)||void 0===s?void 0:s.length)&&r.select(...i.fields),r}async metaCount(e,t,a,i){var s;const r=this.knexConnection(a);return e===v.RootScopes.BYPASS&&t===v.RootScopes.BYPASS||(e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):(t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),this.contextCondition(r,e,t,a))),(null==i?void 0:i.condition)&&r.where(i.condition),(null==i?void 0:i.xcCondition)&&r.condition(i.xcCondition),r.count((null==i?void 0:i.aggField)||"id",{as:"count"}).first(),+(null===(s=await r)||void 0===s?void 0:s.count)||0}async metaUpdate(e,t,a,i,s,r,l=!1,c=!1){const d=this.knexConnection(a);return e===t?(Object.values(v.RootScopes).includes(e)||T.NcError.metaError({message:"Invalid scope",sql:""}),v.RootScopeTables[e].includes(a)||T.NcError.metaError({message:"Table not accessible from this scope",sql:""})):t||t===v.RootScopes.WORKSPACE||T.NcError.metaError({message:"Base ID is required",sql:""}),delete i.created_at,l||(i.updated_at=this.now()),d.update(Object.assign({},i)),"object"!=typeof s?d.where("id",s):s&&d.where(s),r&&d.condition(r),c||this.checkConditionPresent(d,"update"),this.contextCondition(d,e,t,a),await d}async commit(){this.trx&&await this.trx.commit(),this.trx=null}async rollback(e){this.trx&&await this.trx.rollback(e),this.trx=null}async startTransaction(){const e=await this.connection.transaction();return Object.assign(e,{clientType:this.connection.clientType,searchPath:this.connection.searchPath}),new i(this.config,e)}async baseUpdate(e,t){e||T.NcError.metaError({message:"Base Id is required to update base config",sql:""});try{const a={config:m.default.AES.encrypt(JSON.stringify(t,null,2),"secret").toString()};await this.knexConnection("nc_projects").update(a).where({id:e})}catch(e){console.log(e)}}async baseList(){return await this.knexConnection.schema.hasTable("nc_projects")?(await this.knexConnection("nc_projects").select()).map((e=>(e.config=m.default.AES.decrypt(e.config,"secret").toString(m.default.enc.Utf8),e))):[]}getNanoId(){return k()}isMySQL(){return"mysql"===this.connection.clientType()||"mysql2"===this.connection.clientType()}isMssql(){return"mssql"===this.connection.clientType()}now(){return(0,_.default)().utc().format(this.isMySQL()||this.isMssql()?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")}formatDateTime(e){return(0,_.default)(e).utc().format(this.isMySQL()||this.isMssql()?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")}async init(){return await this.connection.migrate.latest({migrationSource:new g.default,tableName:"xc_knex_migrations"}),await this.connection.migrate.latest({migrationSource:new y.default,tableName:"xc_knex_migrationsv2"}),!0}checkConditionPresent(e,t){const a=e.toString();e.hasWhere()&&/\bWHERE\b/i.test(a)||T.NcError.metaError({message:"A condition is required to "+t+" records.",sql:a})}};t.MetaService=M,t.MetaService=M=i=r([(0,u.Injectable)(),c(1,(0,u.Optional)()),l("design:paramtypes",["function"==typeof(s=void 0!==w.NcConfig&&w.NcConfig)?s:Object,Object])],M)},21012:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const l=r(a(53736)),c=r(a(59900)),d=r(a(46916)),u=r(a(56e3)),p=r(a(42436)),m=r(a(37488)),_=r(a(76775)),f=r(a(92552)),h=r(a(54796)),g=r(a(94120)),y=r(a(89308)),b=r(a(11852));t.default=class XcMigrationSource{getMigrations(){return Promise.resolve(["project","m2m","fkn","viewType","viewName","nc_006_alter_nc_shared_views","nc_007_alter_nc_shared_views_1","nc_008_add_nc_shared_bases","nc_009_add_model_order","nc_010_add_parent_title_column","nc_011_remove_old_ses_plugin","nc_012_cloud_cleanup"])}getMigrationName(e){return e}getMigration(e){switch(e){case"project":return l;case"m2m":return c;case"fkn":return d;case"viewType":return u;case"viewName":return p;case"nc_006_alter_nc_shared_views":return m;case"nc_007_alter_nc_shared_views_1":return _;case"nc_008_add_nc_shared_bases":return f;case"nc_009_add_model_order":return h;case"nc_010_add_parent_title_column":return g;case"nc_011_remove_old_ses_plugin":return y;case"nc_012_cloud_cleanup":return b}}}},36572:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const l=r(a(65316)),c=r(a(12216)),d=r(a(95884)),u=r(a(83536)),p=r(a(92504)),m=r(a(86952)),_=r(a(63956)),f=r(a(74100)),h=r(a(84076)),g=r(a(64264)),y=r(a(27980)),b=r(a(57552)),w=r(a(15448)),v=r(a(74388)),T=r(a(49092)),k=r(a(16431)),S=r(a(5748)),M=r(a(55600)),O=r(a(77384)),I=r(a(82196)),C=r(a(26964)),E=r(a(54448)),x=r(a(32012)),L=r(a(41564)),R=r(a(21853)),N=r(a(99864)),A=r(a(28800)),D=r(a(44172)),j=r(a(5628)),P=r(a(93428)),q=r(a(29428)),U=r(a(51368)),$=r(a(28732)),Y=r(a(65296)),B=r(a(86896)),F=r(a(49504)),V=r(a(71348)),H=r(a(39444)),G=r(a(12028)),W=r(a(56164)),z=r(a(35564)),J=r(a(93600)),K=r(a(7728)),Q=r(a(59048)),X=r(a(62936)),Z=r(a(63332)),ee=r(a(49560)),te=r(a(41140)),ae=r(a(97280)),ie=r(a(89340)),ne=r(a(27735)),se=r(a(98736)),oe=r(a(96276)),re=r(a(71012));t.default=class XcMigrationSourcev2{getMigrations(){return Promise.resolve(["nc_011","nc_012_alter_column_data_types","nc_013_sync_source","nc_014_alter_column_data_types","nc_015_add_meta_col_in_column_table","nc_016_alter_hooklog_payload_types","nc_017_add_user_token_version_column","nc_018_add_meta_in_view","nc_019_add_meta_in_meta_tables","nc_020_kanban_view","nc_021_add_fields_in_token","nc_022_qr_code_column_type","nc_023_multiple_source","nc_024_barcode_column_type","nc_025_add_row_height","nc_026_map_view","nc_027_add_comparison_sub_op","nc_028_add_enable_scanner_in_form_columns_meta_table","nc_029_webhook","nc_030_add_description_field","nc_031_remove_fk_and_add_idx","nc_033_add_group_by","nc_034_erd_filter_and_notification","nc_035_add_username_to_users","nc_036_base_deleted","nc_037_rename_project_and_base","nc_038_formula_parsed_tree_column","nc_039_sqlite_alter_column_types","nc_040_form_view_alter_column_types","nc_041_calendar_view","nc_042_user_block","nc_043_user_refresh_token","nc_044_view_column_index","nc_045_extensions","nc_046_comment_mentions","nc_047_comment_migration","nc_048_view_links","nc_049_clear_notifications","nc_050_tenant_isolation","nc_051_source_readonly_columns","nc_052_field_aggregation","nc_053_jobs","nc_054_id_length","nc_055_junction_pk","nc_056_integration","nc_057_file_references","nc_058_button_colum","nc_059_invited_by","nc_060_descriptions","nc_061_integration_is_default","nc_062_integration_store","nc_063_form_field_filter","nc_064_pg_minimal_dbs","nc_065_encrypt_flag"])}getMigrationName(e){return e}getMigration(e){switch(e){case"nc_011":return l;case"nc_012_alter_column_data_types":return c;case"nc_013_sync_source":return d;case"nc_014_alter_column_data_types":return u;case"nc_015_add_meta_col_in_column_table":return p;case"nc_016_alter_hooklog_payload_types":return m;case"nc_017_add_user_token_version_column":return _;case"nc_018_add_meta_in_view":return f;case"nc_019_add_meta_in_meta_tables":return h;case"nc_020_kanban_view":return g;case"nc_021_add_fields_in_token":return y;case"nc_022_qr_code_column_type":return b;case"nc_023_multiple_source":return w;case"nc_024_barcode_column_type":return v;case"nc_025_add_row_height":return T;case"nc_026_map_view":return k;case"nc_027_add_comparison_sub_op":return S;case"nc_028_add_enable_scanner_in_form_columns_meta_table":return M;case"nc_029_webhook":return O;case"nc_030_add_description_field":return I;case"nc_031_remove_fk_and_add_idx":return C;case"nc_033_add_group_by":return E;case"nc_034_erd_filter_and_notification":return x;case"nc_035_add_username_to_users":return L;case"nc_036_base_deleted":return R;case"nc_037_rename_project_and_base":return N;case"nc_038_formula_parsed_tree_column":return A;case"nc_039_sqlite_alter_column_types":return D;case"nc_040_form_view_alter_column_types":return j;case"nc_041_calendar_view":return P;case"nc_042_user_block":return q;case"nc_043_user_refresh_token":return U;case"nc_044_view_column_index":return $;case"nc_045_extensions":return Y;case"nc_046_comment_mentions":return B;case"nc_047_comment_migration":return F;case"nc_048_view_links":return V;case"nc_049_clear_notifications":return H;case"nc_050_tenant_isolation":return G;case"nc_051_source_readonly_columns":return W;case"nc_052_field_aggregation":return z;case"nc_053_jobs":return J;case"nc_054_id_length":return K;case"nc_055_junction_pk":return Q;case"nc_056_integration":return X;case"nc_057_file_references":return Z;case"nc_058_button_colum":return ee;case"nc_059_invited_by":return te;case"nc_060_descriptions":return ae;case"nc_061_integration_is_default":return ie;case"nc_062_integration_store":return ne;case"nc_063_form_field_filter":return se;case"nc_064_pg_minimal_dbs":return oe;case"nc_065_encrypt_flag":return re}}}},53736:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.createTable("nc_projects",(e=>{e.string("id",128).primary(),e.string("title"),e.string("status"),e.text("description"),e.text("config"),e.text("meta"),e.timestamps()})),await e.schema.createTable("nc_roles",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("type").defaultTo("CUSTOM"),e.string("description"),e.timestamps()})),await e("nc_roles").insert([{db_alias:"",project_id:"",title:"owner",description:"Can add/remove creators. And full edit database structures & fields.",type:"SYSTEM"},{db_alias:"",project_id:"",title:"creator",description:"Can fully edit database structure & values",type:"SYSTEM"},{db_alias:"",project_id:"",title:"editor",description:"Can edit records but cannot change structure of database/fields",type:"SYSTEM"},{db_alias:"",project_id:"",title:"commenter",description:"Can view and comment the records but cannot edit anything",type:"SYSTEM"},{db_alias:"",project_id:"",title:"viewer",description:"Can view the records but cannot edit anything",type:"SYSTEM"}]),await e.schema.createTable("nc_hooks",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("description",255),e.string("env").defaultTo("all"),e.string("tn"),e.string("type"),e.string("event"),e.string("operation"),e.boolean("async").defaultTo(!1),e.boolean("payload").defaultTo(!0),e.text("url","text"),e.text("headers","text"),e.text("condition","text"),e.text("notification","text"),e.integer("retries").defaultTo(0),e.integer("retry_interval").defaultTo(6e4),e.integer("timeout").defaultTo(6e4),e.boolean("active").defaultTo(!0),e.timestamps()})),await e("nc_hooks").insert({type:"AUTH_MIDDLEWARE"}),await e.schema.createTable("nc_store",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("key").index(),e.text("value","text"),e.string("type"),e.string("env"),e.string("tag"),e.timestamps()})),await e("nc_store").insert({key:"NC_DEBUG",value:JSON.stringify({"nc:app":!1,"nc:api:rest":!1,"nc:api:source":!1,"nc:api:gql":!1,"nc:api:grpc":!1,"nc:migrator":!1,"nc:datamapper":!1}),db_alias:""}),await e("nc_store").insert({key:"NC_PROJECT_COUNT",value:"0",db_alias:""}),await e.schema.createTable("nc_cron",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("description",255),e.string("env"),e.string("pattern"),e.string("webhook"),e.string("timezone").defaultTo("America/Los_Angeles"),e.boolean("active").defaultTo(!0),e.text("cron_handler"),e.text("payload"),e.text("headers"),e.integer("retries").defaultTo(0),e.integer("retry_interval").defaultTo(6e4),e.integer("timeout").defaultTo(6e4),e.timestamps()})),await e.schema.createTable("nc_acl",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("tn"),e.text("acl"),e.string("type").defaultTo("table"),e.timestamps()})),await e.schema.createTable("nc_models",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("alias"),e.string("type").defaultTo("table"),e.text("meta","mediumtext"),e.text("schema","text"),e.text("schema_previous","text"),e.text("services","mediumtext"),e.text("messages","text"),e.boolean("enabled").defaultTo(!0),e.string("parent_model_title"),e.string("show_as").defaultTo("table"),e.text("query_params","mediumtext"),e.integer("list_idx"),e.string("tags"),e.boolean("pinned"),e.timestamps(),e.index(["db_alias","title"])})),await e.schema.createTable("nc_relations",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("tn"),e.string("rtn"),e.string("_tn"),e.string("_rtn"),e.string("cn"),e.string("rcn"),e.string("_cn"),e.string("_rcn"),e.string("referenced_db_alias"),e.string("type"),e.string("db_type"),e.string("ur"),e.string("dr"),e.timestamps(),e.index(["db_alias","tn"])})),await e.schema.createTable("nc_routes",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("tn"),e.string("tnp"),e.string("tnc"),e.string("relation_type"),e.text("path","text"),e.string("type"),e.text("handler","text"),e.text("acl","text"),e.integer("order"),e.text("functions"),e.integer("handler_type").defaultTo(1),e.boolean("is_custom"),e.timestamps(),e.index(["db_alias","title","tn"])})),await e.schema.createTable("nc_resolvers",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.text("resolver","text"),e.string("type"),e.text("acl","text"),e.text("functions"),e.integer("handler_type").defaultTo(1),e.timestamps()})),await e.schema.createTable("nc_loaders",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("parent"),e.string("child"),e.string("relation"),e.string("resolver"),e.text("functions"),e.timestamps()})),await e.schema.createTable("nc_rpc",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("tn"),e.text("service","text"),e.string("tnp"),e.string("tnc"),e.string("relation_type"),e.integer("order"),e.string("type"),e.text("acl","text"),e.text("functions","text"),e.integer("handler_type").defaultTo(1),e.timestamps()})),await e.schema.createTable("nc_projects_users",(e=>{e.string("project_id").index(),e.integer("user_id").unsigned().index(),e.text("roles"),e.timestamps()})),await e.schema.createTable("nc_shared_views",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("model_name"),e.text("meta","mediumtext"),e.text("query_params","mediumtext"),e.string("view_id"),e.boolean("show_all_fields"),e.boolean("allow_copy"),e.string("password"),e.timestamps()})),await e.schema.createTable("nc_disabled_models_for_role",(e=>{e.increments(),e.string("project_id"),e.string("db_alias",45),e.string("title",45),e.string("type",45),e.string("role",45),e.boolean("disabled").defaultTo(!0),e.string("tn"),e.string("rtn"),e.string("cn"),e.string("rcn"),e.string("relation_type"),e.timestamps(),e.index(["project_id","db_alias","title","type","role"],"xc_disabled124_idx")})),await e.schema.createTable("nc_plugins",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("title",45),e.text("description"),e.boolean("active").defaultTo(!1),e.float("rating"),e.string("version"),e.string("docs"),e.string("status").defaultTo("install"),e.string("status_details"),e.string("logo"),e.string("icon"),e.string("tags"),e.string("category"),e.text("input_schema"),e.text("input"),e.string("creator"),e.string("creator_website"),e.string("price"),e.timestamps()})),await e.schema.createTable("nc_audit",(e=>{e.increments(),e.string("user"),e.string("ip"),e.string("project_id"),e.string("db_alias"),e.string("model_name",100),e.string("model_id",100),e.string("op_type"),e.string("op_sub_type"),e.string("status"),e.text("description"),e.text("details"),e.index(["db_alias","project_id","model_name","model_id"],"`nc_audit_index`"),e.timestamps()})),await e.schema.createTable("nc_migrations",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.text("up"),e.text("down"),e.string("title").notNullable(),e.string("title_down").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.timestamps()})),await e.schema.createTable("nc_api_tokens",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("description"),e.text("permissions"),e.text("token"),e.string("expiry"),e.boolean("enabled").defaultTo(!0),e.timestamps()}))};t.down=async e=>{await e.schema.dropTable("nc_plugins"),await e.schema.dropTable("nc_disabled_models_for_role"),await e.schema.dropTable("nc_shared_views"),await e.schema.dropTable("nc_projects_users"),await e.schema.dropTable("nc_projects"),await e.schema.dropTable("nc_roles"),await e.schema.dropTable("nc_hooks"),await e.schema.dropTable("nc_store"),await e.schema.dropTable("nc_cron"),await e.schema.dropTable("nc_acl"),await e.schema.dropTable("nc_models"),await e.schema.dropTable("nc_relations"),await e.schema.dropTable("nc_routes"),await e.schema.dropTable("nc_resolvers"),await e.schema.dropTable("nc_loaders"),await e.schema.dropTable("nc_rpc"),await e.schema.dropTable("nc_audit"),await e.schema.dropTable("nc_migrations"),await e.schema.dropTable("nc_api_tokens")}},59900:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_models",(e=>{e.integer("mm"),e.text("m_to_m_meta")}))};t.down=async e=>{await e.schema.alterTable("nc_models",(e=>{e.dropColumns("mm","m_to_m_meta")}))}},46916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_relations",(e=>{e.string("fkn")}))};t.down=async e=>{await e.schema.alterTable("nc_relations",(e=>{e.dropColumns("fkn")}))}},56e3:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.string("view_type")}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_type")}))}},42436:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.integer("view_name")}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_name")}))}},37488:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_name")}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.integer("view_name")}))}},76775:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.string("view_name",255)}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_name")}))}},92552:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.createTable("nc_shared_bases",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("roles").defaultTo("viewer"),e.string("shared_base_id"),e.boolean("enabled").defaultTo(!0),e.string("password"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable("nc_shared_bases")}},54796:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_models",(e=>{e.float("order").unsigned().index(),e.float("view_order").unsigned().index()}))};t.down=async e=>{await e.schema.alterTable("nc_models",(e=>{e.dropColumn("order"),e.dropColumn("view_order")}))}},94120:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_disabled_models_for_role",(e=>{e.string("parent_model_title")}))};t.down=async e=>{await e.schema.alterTable("nc_disabled_models_for_role",(e=>{e.dropColumn("parent_model_title")}))}},89308:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e("nc_plugins").del().where({title:"SES"})};t.down=async e=>{}},11852:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{const t=["nc_plugins","nc_disabled_models_for_role","nc_shared_views","nc_projects_users","nc_roles","nc_hooks","nc_cron","nc_acl","nc_models","nc_relations","nc_routes","nc_resolvers","nc_loaders","nc_rpc","nc_audit","nc_migrations","nc_projects"];for(const a of t){await e.schema.hasTable(a)&&await e.schema.dropTable(a)}};t.down=async e=>{}},65316:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTableOldV2.PROJECT,(e=>{e.string("id",128).primary(),e.string("title"),e.string("prefix"),e.string("status"),e.text("description"),e.text("meta"),e.string("color"),e.string("uuid"),e.string("password"),e.string("roles"),e.boolean("deleted").defaultTo(!1),e.boolean("is_meta"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTableOldV2.BASES,(e=>{e.string("id",20).primary().notNullable(),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.string("alias"),e.text("config"),e.text("meta"),e.boolean("is_meta"),e.string("type"),e.string("inflection_column"),e.string("inflection_table"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.MODELS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.string("table_name"),e.string("title"),e.string("type").defaultTo("table"),e.text("meta","mediumtext"),e.text("schema","text"),e.boolean("enabled").defaultTo(!0),e.boolean("mm").defaultTo(!1),e.string("tags"),e.boolean("pinned"),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("title"),e.string("column_name"),e.string("uidt"),e.string("dt"),e.string("np"),e.string("ns"),e.string("clen"),e.string("cop"),e.boolean("pk"),e.boolean("pv"),e.boolean("rqd"),e.boolean("un"),e.string("ct"),e.boolean("ai"),e.boolean("unique"),e.string("cdf"),e.string("cc"),e.string("csn"),e.string("dtx"),e.string("dtxp"),e.string("dtxs"),e.boolean("au"),e.text("validate"),e.boolean("virtual"),e.boolean("deleted"),e.boolean("system").defaultTo(!1),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_RELATIONS,(e=>{e.string("id",20).primary().notNullable(),e.string("ref_db_alias"),e.string("type"),e.boolean("virtual"),e.string("db_type"),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_related_model_id",20),e.foreign("fk_related_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("fk_child_column_id",20),e.foreign("fk_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_parent_column_id",20),e.foreign("fk_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_mm_model_id",20),e.foreign("fk_mm_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("fk_mm_child_column_id",20),e.foreign("fk_mm_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_mm_parent_column_id",20),e.foreign("fk_mm_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("ur"),e.string("dr"),e.string("fk_index_name"),e.boolean("deleted"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("title"),e.string("color"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_LOOKUP,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_relation_column_id",20),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_lookup_column_id",20),e.foreign("fk_lookup_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.boolean("deleted"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_ROLLUP,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_relation_column_id",20),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_rollup_column_id",20),e.foreign("fk_rollup_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("rollup_function"),e.boolean("deleted"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_FORMULA,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.text("formula").notNullable(),e.text("formula_raw"),e.text("error"),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.VIEWS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("title"),e.integer("type"),e.boolean("is_default"),e.boolean("show_system_fields"),e.string("lock_type").defaultTo("collaborative"),e.string("uuid"),e.string("password"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.HOOKS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("title"),e.string("description",255),e.string("env").defaultTo("all"),e.string("type"),e.string("event"),e.string("operation"),e.boolean("async").defaultTo(!1),e.boolean("payload").defaultTo(!0),e.text("url","text"),e.text("headers","text"),e.boolean("condition").defaultTo(!1),e.text("notification","text"),e.integer("retries").defaultTo(0),e.integer("retry_interval").defaultTo(6e4),e.integer("timeout").defaultTo(6e4),e.boolean("active").defaultTo(!0),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.HOOK_LOGS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_hook_id",20),e.string("type"),e.string("event"),e.string("operation"),e.boolean("test_call").defaultTo(!0),e.boolean("payload").defaultTo(!0),e.text("conditions"),e.text("notification","text"),e.string("error_code"),e.string("error_message"),e.text("error","text"),e.integer("execution_time"),e.string("response"),e.string("triggered_by"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.FILTER_EXP,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("fk_hook_id",20),e.foreign("fk_hook_id").references(`${i.MetaTable.HOOKS}.id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_parent_id",20),e.foreign("fk_parent_id").references(`${i.MetaTable.FILTER_EXP}.id`),e.string("logical_op"),e.string("comparison_op"),e.string("value"),e.boolean("is_group"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.SORT,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("direction").defaultTo(!1),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.SHARED_VIEWS,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.text("meta","mediumtext"),e.text("query_params","mediumtext"),e.string("view_id"),e.boolean("show_all_fields"),e.boolean("allow_copy"),e.string("password"),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.FORM_VIEW,(e=>{e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("heading"),e.string("subheading"),e.string("success_msg"),e.string("redirect_url"),e.string("redirect_after_secs"),e.string("email"),e.boolean("submit_another_form"),e.boolean("show_blank_form"),e.string("uuid"),e.string("banner_image_url"),e.string("logo_url"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.FORM_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.string("description"),e.boolean("required"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GALLERY_VIEW,(e=>{e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.boolean("next_enabled"),e.boolean("prev_enabled"),e.integer("cover_image_idx"),e.string("fk_cover_image_col_id",20),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("cover_image"),e.string("restrict_types"),e.string("restrict_size"),e.string("restrict_number"),e.boolean("public"),e.string("dimensions"),e.string("responsive_columns"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.GALLERY_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GRID_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("base_id",20),e.string("project_id",128),e.string("uuid"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.GRID_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("base_id",20),e.string("project_id",128),e.string("uuid"),e.string("label"),e.string("help"),e.string("width").defaultTo("200px"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.KANBAN_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("base_id",20),e.string("project_id",128),e.boolean("show"),e.float("order"),e.string("uuid"),e.string("title"),e.boolean("public"),e.string("password"),e.boolean("show_all_fields"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.KANBAN_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.USERS,(e=>{e.string("id",20).primary().notNullable(),e.string("email"),e.string("password",255),e.string("salt",255),e.string("firstname"),e.string("lastname"),e.string("username"),e.string("refresh_token",255),e.string("invite_token",255),e.string("invite_token_expires",255),e.timestamp("reset_password_expires"),e.string("reset_password_token",255),e.string("email_verification_token",255),e.boolean("email_verified"),e.string("roles",255).defaultTo("editor"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTableOldV2.PROJECT_USERS,(e=>{e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.string("fk_user_id",20),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`),e.text("roles"),e.boolean("starred"),e.boolean("pinned"),e.string("group"),e.string("color"),e.float("order"),e.float("hidden"),e.timestamp("opened_date"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.ORGS_OLD,(e=>{e.string("id",20).primary().notNullable(),e.string("title"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.TEAMS,(e=>{e.string("id",20).primary().notNullable(),e.string("title"),e.string("org_id",20),e.foreign("org_id").references(`${i.MetaTable.ORGS_OLD}.id`),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.TEAM_USERS,(e=>{e.string("org_id",20),e.foreign("org_id").references(`${i.MetaTable.ORGS_OLD}.id`),e.string("user_id",20),e.foreign("user_id").references(`${i.MetaTable.USERS}.id`),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.AUDIT,(e=>{e.string("id",20).primary().notNullable(),e.string("user"),e.string("ip"),e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("row_id").index(),e.string("op_type"),e.string("op_sub_type"),e.string("status"),e.text("description"),e.text("details"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.PLUGIN,(e=>{e.string("id",20).primary().notNullable(),e.string("title",45),e.text("description"),e.boolean("active").defaultTo(!1),e.float("rating"),e.string("version"),e.string("docs"),e.string("status").defaultTo("install"),e.string("status_details"),e.string("logo"),e.string("icon"),e.string("tags"),e.string("category"),e.text("input_schema"),e.text("input"),e.string("creator"),e.string("creator_website"),e.string("price"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("role",45),e.boolean("disabled").defaultTo(!0),e.timestamps(!0,!0)}))};t.down=async e=>{for(const t of i.orderedMetaTables)await e.schema.dropTable(t)}},12216:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("cdf").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("dtxp").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("cc").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("ct").alter()})))};t.down=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("cdf").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("dtxp").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("cc").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("ct").alter()})))}},95884:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.SYNC_SOURCE,(e=>{e.string("id",20).primary().notNullable(),e.string("title"),e.string("type"),e.text("details"),e.boolean("deleted"),e.boolean("enabled").defaultTo(!0),e.float("order"),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.string("fk_user_id",20),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.SYNC_LOGS,(e=>{e.string("id",20).primary().notNullable(),e.string("project_id",128),e.string("fk_sync_base_id",20),e.integer("time_taken"),e.string("status"),e.text("status_details"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.SYNC_LOGS),await e.schema.dropTable(i.MetaTable.SYNC_SOURCE)}},83536:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("success_msg").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("redirect_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("banner_image_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("logo_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("description").alter()})))};t.down=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("success_msg").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("redirect_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("banner_image_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("logo_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("description").alter()})))}},92504:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.dropColumn("meta")}))}},86952:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{"mssql"===e.client.config.client?(await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.dropColumn("payload")})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("payload")}))):"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("payload").alter()}))};t.down=async e=>{"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.boolean("payload").alter()}))}},63956:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_users_v2",(e=>{e.string("token_version")}))};t.down=async e=>{await e.schema.alterTable("nc_users_v2",(e=>{e.dropColumns("token_version")}))}},74100:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.dropColumns("meta")}))}},84076:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("meta")})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("meta")})),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.text("meta")})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.dropColumns("meta")})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropColumns("meta")})),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.dropColumns("meta")})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.dropColumns("meta")}))}},64264:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.string("fk_grp_col_id",20),e.foreign("fk_grp_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_cover_image_col_id",20),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.dropColumns("meta"),e.dropColumns("fk_grp_col_id"),e.dropColumns("fk_cover_image_col_id")}))}},27980:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.string("fk_user_id",20),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`)})),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.dropForeign(["fk_user_id"])}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.dropForeign(["fk_user_id"]),e.dropColumn("fk_user_id")})),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`)}))}},57552:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.COL_QRCODE,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_qr_value_column_id",20),e.foreign("fk_qr_value_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.COL_QRCODE)}},15448:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`)})),await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.boolean("enabled").defaultTo(!0),e.float("order")})),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.dropForeign("base_id")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.dropColumn("enabled"),e.dropColumn("order")})),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`)}))}},74388:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.COL_BARCODE,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_barcode_value_column_id",20),e.foreign("fk_barcode_value_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("barcode_format",15),e.boolean("deleted"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.COL_BARCODE)}},49092:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.integer("row_height")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.dropColumns("row_height")}))}},16431:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.MAP_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.string("uuid"),e.string("title"),e.string("fk_geo_data_col_id",20),e.foreign("fk_geo_data_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.text("meta"),e.dateTime("created_at"),e.dateTime("updated_at")})),await e.schema.createTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.MAP_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.MAP_VIEW),await e.schema.dropTable(i.MetaTable.MAP_VIEW_COLUMNS)}},5748:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.string("comparison_sub_op")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.dropColumns("comparison_sub_op")}))}},55600:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.boolean("enable_scanner")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropColumns("enable_scanner")}))}},77384:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{"mssql"===e.client.config.client?(await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.dropColumn("response")})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("response")}))):"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("response").alter()})),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.string("version")}))};t.down=async e=>{"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.boolean("response").alter()})),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.dropColumn("version")}))}},82196:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.string("description",255)})),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.string("description",255)})),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.string("description",255)})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("description",255)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.dropColumn("description")})),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.dropColumn("description")})),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.dropColumn("description")})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.dropColumn("description")}))}},26964:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{console.time(`Removed foreign keys and created index for columns in '${i.MetaTableOldV2.BASES}'`),await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.dropForeign("project_id"),e.index("project_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTableOldV2.BASES}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MODELS}'`),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.dropForeign("base_id"),e.index("base_id"),e.dropForeign("project_id"),e.index("project_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MODELS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COLUMNS}'`),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_RELATIONS}'`),await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_related_model_id"),e.index("fk_related_model_id"),e.dropForeign("fk_child_column_id"),e.index("fk_child_column_id"),e.dropForeign("fk_parent_column_id"),e.index("fk_parent_column_id"),e.dropForeign("fk_mm_model_id"),e.index("fk_mm_model_id"),e.dropForeign("fk_mm_child_column_id"),e.index("fk_mm_child_column_id"),e.dropForeign("fk_mm_parent_column_id"),e.index("fk_mm_parent_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_RELATIONS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_SELECT_OPTIONS}'`),await e.schema.alterTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_SELECT_OPTIONS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_LOOKUP}'`),await e.schema.alterTable(i.MetaTable.COL_LOOKUP,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_relation_column_id"),e.index("fk_relation_column_id"),e.dropForeign("fk_lookup_column_id"),e.index("fk_lookup_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_LOOKUP}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_QRCODE}'`),await e.schema.alterTable(i.MetaTable.COL_QRCODE,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_qr_value_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_QRCODE}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_BARCODE}'`),await e.schema.alterTable(i.MetaTable.COL_BARCODE,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_barcode_value_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_BARCODE}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_FORMULA}'`),await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_FORMULA}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_ROLLUP}'`),await e.schema.alterTable(i.MetaTable.COL_ROLLUP,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_relation_column_id"),e.index("fk_relation_column_id"),e.dropForeign("fk_rollup_column_id"),e.index("fk_rollup_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_ROLLUP}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.VIEWS}'`),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.VIEWS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.HOOKS}'`),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.HOOKS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.FILTER_EXP}'`),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_hook_id"),e.index("fk_hook_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_parent_id"),e.index("fk_parent_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.FILTER_EXP}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.SORT}'`),await e.schema.alterTable(i.MetaTable.SORT,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.SORT}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.SHARED_VIEWS}'`),await e.schema.alterTable(i.MetaTable.SHARED_VIEWS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.SHARED_VIEWS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW}'`),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW}'`),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_cover_image_col_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW}'`),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW}'`),await e.schema.alterTable(i.MetaTable.MAP_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_geo_data_col_id"),e.index("fk_geo_data_col_id"),e.dropForeign("base_id"),e.dropForeign("project_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW}'`),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_grp_col_id"),e.index("fk_grp_col_id"),e.dropForeign("fk_cover_image_col_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTableOldV2.PROJECT_USERS}'`),await e.schema.alterTable(i.MetaTableOldV2.PROJECT_USERS,(e=>{e.dropForeign("project_id"),e.index("project_id"),e.dropForeign("fk_user_id"),e.index("fk_user_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTableOldV2.PROJECT_USERS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.AUDIT}'`),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.dropForeign("project_id"),e.index("project_id"),e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.AUDIT}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MODEL_ROLE_VISIBILITY}'`),await e.schema.alterTable(i.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MODEL_ROLE_VISIBILITY}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.SYNC_SOURCE}'`),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.dropForeign("project_id"),e.index("project_id"),e.dropForeign("base_id"),e.index("base_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.SYNC_SOURCE}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.API_TOKENS}'`),await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.dropForeign("fk_user_id"),e.index("fk_user_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.API_TOKENS}'`)};t.down=async e=>{await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`)})),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`)})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_related_model_id").references(`${i.MetaTable.MODELS}.id`),e.foreign("fk_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_mm_model_id").references(`${i.MetaTable.MODELS}.id`),e.foreign("fk_mm_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_mm_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_LOOKUP,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_lookup_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_ROLLUP,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_rollup_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_QRCODE,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_qr_value_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_BARCODE,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_barcode_value_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_hook_id").references(`${i.MetaTable.HOOKS}.id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_parent_id").references(`${i.MetaTable.FILTER_EXP}.id`)})),await e.schema.alterTable(i.MetaTable.SORT,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.SHARED_VIEWS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.FORM_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.GALLERY_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.GRID_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.MAP_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`),e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.foreign("fk_geo_data_col_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.MAP_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_grp_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.KANBAN_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTableOldV2.PROJECT_USERS,(e=>{e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`)})),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.foreign("project_id").references(`${i.MetaTableOldV2.PROJECT}.id`)})),await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`),e.foreign("base_id").references(`${i.MetaTableOldV2.BASES}.id`)}))}},54448:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.boolean("group_by"),e.float("group_by_order"),e.string("group_by_sort")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.dropColumn("group_by"),e.dropColumn("group_by_order"),e.dropColumn("group_by_sort")}))}},32012:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.hasColumn(i.MetaTableOldV2.BASES,"erd_uuid")||await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.string("erd_uuid")})),await e.schema.hasTable(i.MetaTable.NOTIFICATION)||await e.schema.createTable(i.MetaTable.NOTIFICATION,(e=>{e.string("id",20).primary().notNullable(),e.string("type",40),e.text("body"),e.boolean("is_read").defaultTo(!1),e.boolean("is_deleted").defaultTo(!1),e.string("fk_user_id",20).index(),e.timestamps(!0,!0),e.index("created_at")})),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.text("value").alter()}))};t.down=async e=>{await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.dropColumn("erd_uuid")})),e.schema.dropTable(i.MetaTable.NOTIFICATION),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.string("value",255).alter()}))}},41564:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.USERS,(e=>{e.string("display_name"),e.string("user_name"),e.dropColumn("firstname"),e.dropColumn("lastname"),e.dropColumn("username")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.USERS,(e=>{e.dropColumn("display_name"),e.dropColumn("user_name"),e.string("firstname"),e.string("lastname"),e.string("username")}))}},21853:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.boolean("deleted").defaultTo(!1)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTableOldV2.BASES,(e=>{e.dropColumn("deleted")}))}},99864:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(23324),s=a(64612),r=new i.Logger("nc_036_rename_project_and_base");t.up=async e=>{r.log("Renaming base table"),await e.schema.hasTable(s.MetaTableOldV2.BASES)&&await e.schema.renameTable(s.MetaTableOldV2.BASES,s.MetaTable.SOURCES),r.log("Renaming `base_id` column to `source_id`"),await e.schema.hasColumn(s.MetaTable.MODELS,"base_id")&&await e.schema.alterTable(s.MetaTable.MODELS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.COLUMNS,"base_id")&&await e.schema.alterTable(s.MetaTable.COLUMNS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.VIEWS}' table`),await e.schema.hasColumn(s.MetaTable.VIEWS,"base_id")&&await e.schema.alterTable(s.MetaTable.VIEWS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.GALLERY_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.GALLERY_VIEW,"base_id")&&await e.schema.alterTable(s.MetaTable.GALLERY_VIEW,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.GRID_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.GRID_VIEW,"base_id")&&await e.schema.alterTable(s.MetaTable.GRID_VIEW,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.KANBAN_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.KANBAN_VIEW,"base_id")&&await e.schema.alterTable(s.MetaTable.KANBAN_VIEW,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.FORM_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.FORM_VIEW,"base_id")&&await e.schema.alterTable(s.MetaTable.FORM_VIEW,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.MAP_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.MAP_VIEW,"base_id")&&await e.schema.alterTable(s.MetaTable.MAP_VIEW,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.GALLERY_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.GALLERY_VIEW_COLUMNS,"base_id")&&await e.schema.alterTable(s.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.GRID_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.GRID_VIEW_COLUMNS,"base_id")&&await e.schema.alterTable(s.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.KANBAN_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.KANBAN_VIEW_COLUMNS,"base_id")&&await e.schema.alterTable(s.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.FORM_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.FORM_VIEW_COLUMNS,"base_id")&&await e.schema.alterTable(s.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.SORT}' table`),await e.schema.hasColumn(s.MetaTable.SORT,"base_id")&&await e.schema.alterTable(s.MetaTable.SORT,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.FILTER_EXP}' table`),await e.schema.hasColumn(s.MetaTable.FILTER_EXP,"base_id")&&await e.schema.alterTable(s.MetaTable.FILTER_EXP,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.HOOKS}' table`),await e.schema.hasColumn(s.MetaTable.HOOKS,"base_id")&&await e.schema.alterTable(s.MetaTable.HOOKS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.HOOK_LOGS}' table`),await e.schema.hasColumn(s.MetaTable.HOOK_LOGS,"base_id")&&await e.schema.alterTable(s.MetaTable.HOOK_LOGS,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.MODEL_ROLE_VISIBILITY}' table`),await e.schema.hasColumn(s.MetaTable.MODEL_ROLE_VISIBILITY,"base_id")&&await e.schema.alterTable(s.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.AUDIT}' table`),await e.schema.hasColumn(s.MetaTable.AUDIT,"base_id")&&await e.schema.alterTable(s.MetaTable.AUDIT,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'base_id' column to 'source_id' in '${s.MetaTable.SYNC_LOGS}' table`),await e.schema.hasColumn(s.MetaTable.SYNC_SOURCE,"base_id")&&await e.schema.alterTable(s.MetaTable.SYNC_SOURCE,(e=>{e.renameColumn("base_id","source_id")})),r.log(`Renaming 'fk_sync_base_id' column to 'fk_sync_source_id' in '${s.MetaTable.SYNC_LOGS}' table`),await e.schema.hasColumn(s.MetaTable.SYNC_LOGS,"fk_sync_base_id")&&await e.schema.alterTable(s.MetaTable.SYNC_LOGS,(e=>{e.renameColumn("fk_sync_base_id","fk_sync_source_id")})),r.log("Renaming project table"),await e.schema.hasTable(s.MetaTableOldV2.PROJECT)&&await e.schema.renameTable(s.MetaTableOldV2.PROJECT,s.MetaTable.PROJECT),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.MODELS}' table`),await e.schema.hasColumn(s.MetaTable.MODELS,"project_id")&&await e.schema.alterTable(s.MetaTable.MODELS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.COLUMNS,"project_id")&&await e.schema.alterTable(s.MetaTable.COLUMNS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.VIEWS}' table`),await e.schema.hasColumn(s.MetaTable.VIEWS,"project_id")&&await e.schema.alterTable(s.MetaTable.VIEWS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.GALLERY_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.GALLERY_VIEW,"project_id")&&await e.schema.alterTable(s.MetaTable.GALLERY_VIEW,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.GRID_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.GRID_VIEW,"project_id")&&await e.schema.alterTable(s.MetaTable.GRID_VIEW,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.KANBAN_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.KANBAN_VIEW,"project_id")&&await e.schema.alterTable(s.MetaTable.KANBAN_VIEW,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.FORM_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.FORM_VIEW,"project_id")&&await e.schema.alterTable(s.MetaTable.FORM_VIEW,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.MAP_VIEW}' table`),await e.schema.hasColumn(s.MetaTable.MAP_VIEW,"project_id")&&await e.schema.alterTable(s.MetaTable.MAP_VIEW,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.GALLERY_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.GALLERY_VIEW_COLUMNS,"project_id")&&await e.schema.alterTable(s.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.GRID_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.GRID_VIEW_COLUMNS,"project_id")&&await e.schema.alterTable(s.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.KANBAN_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.KANBAN_VIEW_COLUMNS,"project_id")&&await e.schema.alterTable(s.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.FORM_VIEW_COLUMNS}' table`),await e.schema.hasColumn(s.MetaTable.FORM_VIEW_COLUMNS,"project_id")&&await e.schema.alterTable(s.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.SORT}' table`),await e.schema.hasColumn(s.MetaTable.SORT,"project_id")&&await e.schema.alterTable(s.MetaTable.SORT,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.FILTER_EXP}' table`),await e.schema.hasColumn(s.MetaTable.FILTER_EXP,"project_id")&&await e.schema.alterTable(s.MetaTable.FILTER_EXP,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.HOOKS}' table`),await e.schema.hasColumn(s.MetaTable.HOOKS,"project_id")&&await e.schema.alterTable(s.MetaTable.HOOKS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.HOOK_LOGS}' table`),await e.schema.hasColumn(s.MetaTable.HOOK_LOGS,"project_id")&&await e.schema.alterTable(s.MetaTable.HOOK_LOGS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.MODEL_ROLE_VISIBILITY}' table`),await e.schema.hasColumn(s.MetaTable.MODEL_ROLE_VISIBILITY,"project_id")&&await e.schema.alterTable(s.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.AUDIT}' table`),await e.schema.hasColumn(s.MetaTable.AUDIT,"project_id")&&await e.schema.alterTable(s.MetaTable.AUDIT,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.SYNC_LOGS}' table`),await e.schema.hasColumn(s.MetaTable.SYNC_LOGS,"project_id")&&await e.schema.alterTable(s.MetaTable.SYNC_SOURCE,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.SYNC_LOGS}' table`),await e.schema.hasColumn(s.MetaTable.SYNC_LOGS,"project_id")&&await e.schema.alterTable(s.MetaTable.SYNC_LOGS,(e=>{e.renameColumn("project_id","base_id")})),r.log("Renaming Project Users table"),await e.schema.hasTable(s.MetaTableOldV2.PROJECT_USERS)&&await e.schema.renameTable(s.MetaTableOldV2.PROJECT_USERS,s.MetaTable.PROJECT_USERS),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.PROJECT_USERS}' table`),await e.schema.hasColumn(s.MetaTable.PROJECT_USERS,"project_id")&&await e.schema.alterTable(s.MetaTable.PROJECT_USERS,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.SOURCES}' table`),await e.schema.hasColumn(s.MetaTable.SOURCES,"project_id")&&await e.schema.alterTable(s.MetaTable.SOURCES,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.STORE}' table`),await e.schema.hasColumn(s.MetaTable.STORE,"project_id")&&await e.schema.alterTable(s.MetaTable.STORE,(e=>{e.renameColumn("project_id","base_id")})),r.log(`Renaming 'project_id' column to 'base_id' in '${s.MetaTable.API_TOKENS}' table`),await e.schema.hasColumn(s.MetaTable.API_TOKENS,"project_id")&&await e.schema.alterTable(s.MetaTable.API_TOKENS,(e=>{e.renameColumn("project_id","base_id")}))};t.down=async e=>{}},28800:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.text("parsed_tree")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.dropColumn("parsed_tree")}))}},44172:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{"sqlite3"===e.client.config.client&&(await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("cdf").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("dtxp").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("cc").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("ct").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("success_msg").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("redirect_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("banner_image_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("logo_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("description").alter()})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("payload").alter()})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("response").alter()})))};t.down=async e=>{"sqlite3"===e.client.config.client&&(await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("cdf").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("dtxp").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("cc").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("ct").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("success_msg").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("redirect_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("banner_image_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("logo_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("description").alter()})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.boolean("payload").alter()})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.boolean("response").alter()})))}},5628:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("subheading").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("label").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("help").alter()}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("subheading").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("label").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("help").alter()}))}},93428:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.CALENDAR_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.string("base_id",20),e.string("source_id",128),e.string("title"),e.string("fk_cover_image_col_id",20),e.text("meta"),e.dateTime("created_at"),e.dateTime("updated_at")})),await e.schema.createTable(i.MetaTable.CALENDAR_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("source_id",128),e.string("fk_view_id",20),e.string("fk_column_id",20),e.boolean("show"),e.boolean("bold"),e.boolean("underline"),e.boolean("italic"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.CALENDAR_VIEW_RANGE,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_view_id",20),e.string("fk_to_column_id",20),e.string("label",40),e.string("fk_from_column_id",20),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.CALENDAR_VIEW),await e.schema.dropTable(i.MetaTable.CALENDAR_VIEW_COLUMNS),await e.schema.dropTable(i.MetaTable.CALENDAR_VIEW_RANGE)}},29428:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.USERS,(e=>{e.boolean("blocked").defaultTo(!1),e.string("blocked_reason")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.USERS,(e=>{e.dropColumn("blocked"),e.dropColumn("blocked_reason")}))}},51368:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.USERS,(e=>{e.dropColumn("refresh_token")})),await e.schema.createTable(i.MetaTable.USER_REFRESH_TOKENS,(e=>{e.string("fk_user_id",20).index(),e.string("token",255).index(),e.text("meta"),e.timestamp("expires_at").index(),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.USER_REFRESH_TOKENS),await e.schema.alterTable(i.MetaTable.USERS,(e=>{e.string("refresh_token",255)}))}},28732:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{console.log("Adding index to view column tables..."),console.time("Added index to Grid view columns"),await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.index(["fk_view_id","fk_column_id"])})),console.timeEnd("Added index to Grid view columns"),console.time("Added index to Gallery view columns"),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.index(["fk_view_id","fk_column_id"])})),console.timeEnd("Added index to Gallery view columns"),console.time("Added index to Kanban view columns"),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.index(["fk_view_id","fk_column_id"])})),console.timeEnd("Added index to Kanban view columns"),console.time("Added index to Form view columns"),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.index(["fk_view_id","fk_column_id"])})),console.timeEnd("Added index to Form view columns"),console.time("Added index to Calendar view columns"),await e.schema.alterTable(i.MetaTable.CALENDAR_VIEW_COLUMNS,(e=>{e.index(["fk_view_id","fk_column_id"])})),console.timeEnd("Added index to Calendar view columns"),console.time("Added index to Map view columns"),await e.schema.alterTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.index(["fk_view_id","fk_column_id"])})),console.timeEnd("Added index to Map view columns")};t.down=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.dropIndex(["fk_view_id","fk_column_id"])})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.dropIndex(["fk_view_id","fk_column_id"])})),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.dropIndex(["fk_view_id","fk_column_id"])})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropIndex(["fk_view_id","fk_column_id"])})),await e.schema.alterTable(i.MetaTable.CALENDAR_VIEW_COLUMNS,(e=>{e.dropIndex(["fk_view_id","fk_column_id"])})),await e.schema.alterTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.dropIndex(["fk_view_id","fk_column_id"])}))}},65296:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.EXTENSIONS,(e=>{e.string("id",20).primary(),e.string("base_id",20).index(),e.string("fk_user_id",20),e.string("extension_id"),e.string("title"),e.text("kv_store"),e.text("meta"),e.float("order"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.EXTENSIONS)}},86896:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.COMMENTS,(e=>{e.string("id",20).primary(),e.string("row_id",255),e.text("comment"),e.string("created_by",20),e.string("created_by_email",255),e.string("resolved_by",20),e.string("resolved_by_email",255),e.string("parent_comment_id",20),e.string("source_id",20),e.string("base_id",128),e.string("fk_model_id",20),e.boolean("is_deleted"),e.index(["row_id","fk_model_id"]),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.USER_COMMENTS_NOTIFICATIONS_PREFERENCE,(e=>{e.string("id",20).primary(),e.string("row_id",255),e.string("user_id",20),e.string("fk_model_id",20),e.string("source_id",20),e.string("base_id",128),e.string("preferences",255),e.index(["user_id","row_id","fk_model_id"],"user_comments_preference_index"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COMMENTS_REACTIONS,(e=>{e.string("id",20).primary(),e.string("row_id",255).index(),e.string("comment_id",20).index(),e.string("source_id",20),e.string("fk_model_id",20),e.string("base_id",128),e.string("reaction",255),e.string("created_by",255),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.COMMENTS),await e.schema.dropTable(i.MetaTable.USER_COMMENTS_NOTIFICATIONS_PREFERENCE),await e.schema.dropTable(i.MetaTable.COMMENTS_REACTIONS)}},49504:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(23324),s=a(64612),r=new i.Logger("nc_046_comment_mentions"),l=1e3;t.up=async e=>{r.log("Migration Started");let t=!0;const a=new Set;for(let i=0;t;i+=l){const c=await e.select(`${s.MetaTable.AUDIT}.id`,`${s.MetaTable.AUDIT}.row_id`,`${s.MetaTable.AUDIT}.description`,`${s.MetaTable.AUDIT}.user as user_email`,`${s.MetaTable.AUDIT}.source_id`,`${s.MetaTable.AUDIT}.base_id`,`${s.MetaTable.AUDIT}.fk_model_id`,`${s.MetaTable.AUDIT}.created_at`,`${s.MetaTable.AUDIT}.updated_at`,`${s.MetaTable.USERS}.id as user_id`).from(s.MetaTable.AUDIT).where(`${s.MetaTable.AUDIT}.op_type`,"COMMENT").leftJoin(s.MetaTable.USERS,`${s.MetaTable.AUDIT}.user`,`${s.MetaTable.USERS}.email`).orderBy(`${s.MetaTable.AUDIT}.id`).offset(i).limit(1001);r.log(`Data from Audit Table fetched, batch: ${i} - ${i+l}`);const d=c.slice(0,l).filter((e=>!a.has(e.id)&&(a.add(e.id),!0))).map((e=>{var t,a;return{id:e.id,row_id:e.row_id,comment:(null!==(t=e.description)&&void 0!==t?t:"").substring((null!==(a=e.description)&&void 0!==a?a:"").indexOf(":")+1).trim(),created_by:e.user_id,created_by_email:e.user_email,source_id:e.source_id,base_id:e.base_id,fk_model_id:e.fk_model_id,created_at:e.created_at,updated_at:e.updated_at}}));r.log("Data from Audit Table formatted"),await e.batchInsert(s.MetaTable.COMMENTS,d,200),t=c.length>l}r.log("Data migrated from Audit Table to Comments Table")};t.down=async e=>{await e.schema.dropTable(s.MetaTable.COMMENTS)}},71348:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.string("fk_target_view_id",20).index()})),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.string("fk_link_col_id",20).index(),e.string("fk_value_col_id",20).index()}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.dropColumn("fk_target_view_id")})),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.dropColumn("fk_link_col_id"),e.dropColumn("fk_value_col_id")}))}},39444:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e(i.MetaTable.NOTIFICATION).update({is_deleted:!0})};t.down=async e=>{}},12028:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612),s=a(7728),r=e=>{console.log(`nc_050_tenant_isolation: ${e}`)};let l=process.hrtime();const c=e=>{const[t,a]=process.hrtime(l);r(`${e} in ${t+a/1e9}s`)},d=async(e,t,a,i,s,r,l)=>{const c=e.client.driverName;switch(c){case"pg":await e.raw(`\n        UPDATE ${t}\n        SET ${r} = ${i}.${l}\n        FROM ${i}\n        WHERE ${t}.${a} = ${i}.${s}\n      `);break;case"mysql":case"mysql2":await e.raw(`\n        UPDATE ${t}\n        JOIN ${i}\n        ON ${t}.${a} = ${i}.${s}\n        SET ${t}.${r} = ${i}.${l}\n      `);break;case"sqlite3":await e.raw(`\n        UPDATE ${t}\n        SET ${r} = (\n          SELECT ${i}.${l}\n          FROM ${i}\n          WHERE ${t}.${a} = ${i}.${s}\n        )\n      `);break;case"mssql":await e.raw(`\n        UPDATE ${t}\n        SET ${r} = ${i}.${l}\n        FROM ${t}\n        JOIN ${i}\n        ON ${t}.${a} = ${i}.${s}\n      `);break;default:throw new Error(`Unsupported database: ${c}`)}},u=async(e,t,a)=>{const i=e.client.driverName;switch(i){case"pg":return(await e.raw("\n        SELECT\n          t.relname AS table_name,\n          i.relname AS index_name,\n          a.attname AS column_name\n        FROM\n          pg_class t,\n          pg_class i,\n          pg_index ix,\n          pg_attribute a\n        WHERE\n          t.oid = ix.indrelid\n          AND i.oid = ix.indexrelid\n          AND a.attrelid = t.oid\n          AND a.attnum = ANY(ix.indkey)\n          AND t.relkind = 'r'\n          AND t.relname = ?\n          AND a.attname = ?;\n        ",[t,a])).rows.map((e=>e.index_name));case"mysql":case"mysql2":return(await e.raw("\n        SELECT\n          INDEX_NAME\n        FROM\n          INFORMATION_SCHEMA.STATISTICS\n        WHERE\n          TABLE_SCHEMA = ?\n          AND TABLE_NAME = ?\n          AND COLUMN_NAME = ?\n        ",[e.client.database(),t,a]))[0].map((e=>e.INDEX_NAME));case"sqlite3":return(await e.raw("\n        PRAGMA index_list(??)\n        ",[t])).map((e=>e.name)).filter((e=>e.includes(a)||"base_id"===a&&e.includes("project_id")));case"mssql":return(await e.raw("\n        SELECT\n          i.name AS index_name\n        FROM\n          sys.indexes i\n        JOIN\n          sys.index_columns ic\n        ON\n          i.object_id = ic.object_id\n          AND i.index_id = ic.index_id\n        JOIN\n          sys.columns c\n        ON\n          ic.object_id = c.object_id\n          AND ic.column_id = c.column_id\n        WHERE\n          i.object_id = OBJECT_ID(?)\n          AND c.name = ?\n        ",[t,a])).map((e=>e.index_name));default:throw new Error(`Unsupported database: ${i}`)}};t.up=async e=>{r("Migration started"),await(0,s.replaceLongBaseIds)(e),r("Adding missing base_id columns");const t=[i.MetaTable.CALENDAR_VIEW_RANGE,i.MetaTable.COL_BARCODE,i.MetaTable.COL_FORMULA,i.MetaTable.COL_LOOKUP,i.MetaTable.COL_QRCODE,i.MetaTable.COL_RELATIONS,i.MetaTable.COL_ROLLUP,i.MetaTable.COL_SELECT_OPTIONS];l=process.hrtime();for(const a of t)await e.schema.hasColumn(a,"base_id")||await e.schema.alterTable(a,(e=>{e.string("base_id",20)}));c("Added missing base_id columns"),r("Migrating data");const a=[i.MetaTable.CALENDAR_VIEW_RANGE,i.MetaTable.COL_BARCODE,i.MetaTable.COL_FORMULA,i.MetaTable.COL_LOOKUP,i.MetaTable.COL_QRCODE,i.MetaTable.COL_RELATIONS,i.MetaTable.COL_ROLLUP,i.MetaTable.COL_SELECT_OPTIONS];for(const t of a)l=process.hrtime(),t===i.MetaTable.CALENDAR_VIEW_RANGE?await d(e,i.MetaTable.CALENDAR_VIEW_RANGE,"fk_view_id",i.MetaTable.VIEWS,"id","base_id","base_id"):await d(e,t,"fk_column_id",i.MetaTable.COLUMNS,"id","base_id","base_id"),c(`Migrated base_id for ${t}`);const p=[i.MetaTable.AUDIT,i.MetaTable.SOURCES,i.MetaTable.MODELS,i.MetaTable.PROJECT_USERS,i.MetaTable.SYNC_SOURCE,i.MetaTable.EXTENSIONS];r("Dropping existing base_id indexes"),l=process.hrtime();for(const t of p){const a=await u(e,t,"base_id");for(const i of a)r(`Dropping index ${i} on ${t}.base_id`),await e.schema.alterTable(t,(e=>{e.dropIndex("base_id",i)}))}c("Dropped existing base_id indexes");const m=[i.MetaTable.MODELS,i.MetaTable.SYNC_SOURCE];r("Recreating existing source_id indexes"),l=process.hrtime();for(const t of m){const a=await u(e,t,"source_id"),i=Array.from(new Set(a));for(const a of i)a===`${t}_base_id_index`&&(r(`Recreating index ${a} on ${t}.source_id`),await e.schema.alterTable(t,(e=>{e.dropIndex("source_id",`${t}_base_id_index`),e.index("source_id")})))}c("Recreated existing source_id indexes");const _=[i.MetaTable.AUDIT,i.MetaTable.PROJECT_USERS,i.MetaTable.CALENDAR_VIEW_COLUMNS,i.MetaTable.CALENDAR_VIEW,i.MetaTable.COLUMNS,i.MetaTable.EXTENSIONS,i.MetaTable.FILTER_EXP,i.MetaTable.FORM_VIEW_COLUMNS,i.MetaTable.FORM_VIEW,i.MetaTable.GALLERY_VIEW_COLUMNS,i.MetaTable.GALLERY_VIEW,i.MetaTable.GRID_VIEW_COLUMNS,i.MetaTable.GRID_VIEW,i.MetaTable.HOOK_LOGS,i.MetaTable.HOOKS,i.MetaTable.KANBAN_VIEW_COLUMNS,i.MetaTable.KANBAN_VIEW,i.MetaTable.MAP_VIEW_COLUMNS,i.MetaTable.MAP_VIEW,i.MetaTable.MODELS,i.MetaTable.SORT,i.MetaTable.SOURCES,i.MetaTable.SYNC_LOGS,i.MetaTable.SYNC_SOURCE,i.MetaTable.VIEWS,i.MetaTable.MODEL_ROLE_VISIBILITY,i.MetaTable.COMMENTS,i.MetaTable.COMMENTS_REACTIONS,i.MetaTable.USER_COMMENTS_NOTIFICATIONS_PREFERENCE,i.MetaTable.CALENDAR_VIEW_RANGE,i.MetaTable.COL_BARCODE,i.MetaTable.COL_FORMULA,i.MetaTable.COL_LOOKUP,i.MetaTable.COL_QRCODE,i.MetaTable.COL_RELATIONS,i.MetaTable.COL_ROLLUP,i.MetaTable.COL_SELECT_OPTIONS];r("Adding indexes");for(const t of _)l=process.hrtime(),await e.schema.alterTable(t,(e=>{e.index("base_id")})),c(`Added indexes for ${t}`);r("Migration completed")};t.down=async e=>{await e.schema.alterTable(i.MetaTable.CALENDAR_VIEW_RANGE,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_BARCODE,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_LOOKUP,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_QRCODE,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_ROLLUP,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.dropColumn("base_id")}))}},56164:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.SOURCES,(e=>{e.boolean("is_schema_readonly").defaultTo(!1),e.boolean("is_data_readonly").defaultTo(!1)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.SOURCES,(e=>{e.dropColumn("is_schema_readonly"),e.dropColumn("is_data_readonly")}))}},35564:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.string("aggregation",30).nullable().defaultTo(null)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.dropColumn("aggregation")}))}},93600:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.JOBS,(e=>{e.string("id",20).primary(),e.string("job",255),e.string("status",20),e.text("result"),e.string("fk_user_id",20),e.string("fk_workspace_id",20),e.string("base_id",20),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.JOBS)}},7728:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=t.replaceLongBaseIds=void 0;const i=a(92080),s=a(64612),r=e=>{console.log(`nc_054_id_length: ${e}`)};let l=process.hrtime();const c=e=>{const[t,a]=process.hrtime(l);r(`${e} in ${t+a/1e9}s`)},d=(0,i.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14),u=async e=>{const t=`p${d()}`;return await e(s.MetaTable.PROJECT).where("id",t).first()?u(e):t};t.replaceLongBaseIds=async e=>{const t=await(async e=>{const t=e.client.driverName;switch(t){case"pg":return(await e.raw("SELECT id FROM ?? WHERE LENGTH(id) > 20",s.MetaTable.PROJECT)).rows.map((e=>e.id));case"mysql":case"mysql2":return(await e.raw("SELECT id FROM ?? WHERE CHAR_LENGTH(id) > 20",s.MetaTable.PROJECT))[0].map((e=>e.id));case"sqlite3":return(await e.raw("SELECT id FROM ?? WHERE LENGTH(id) > 20",s.MetaTable.PROJECT)).map((e=>e.id));case"mssql":return(await e.raw("SELECT id FROM ?? WHERE LEN(id) > 20",s.MetaTable.PROJECT)).map((e=>e.id));default:throw new Error(`Unsupported database: ${t}`)}})(e);for(const a of t){const t=await u(e);if(!a||!t)throw new Error(`Failed to replace ${a} with ${t}`);const i=[s.MetaTable.API_TOKENS,s.MetaTable.AUDIT,s.MetaTable.PROJECT_USERS,s.MetaTable.CALENDAR_VIEW_COLUMNS,s.MetaTable.CALENDAR_VIEW,s.MetaTable.COLUMNS,s.MetaTable.COMMENTS_REACTIONS,s.MetaTable.COMMENTS,s.MetaTable.MODEL_ROLE_VISIBILITY,s.MetaTable.EXTENSIONS,s.MetaTable.FILTER_EXP,s.MetaTable.FORM_VIEW_COLUMNS,s.MetaTable.FORM_VIEW,s.MetaTable.GALLERY_VIEW_COLUMNS,s.MetaTable.GALLERY_VIEW,s.MetaTable.GRID_VIEW_COLUMNS,s.MetaTable.GRID_VIEW,s.MetaTable.HOOK_LOGS,s.MetaTable.HOOKS,s.MetaTable.KANBAN_VIEW_COLUMNS,s.MetaTable.KANBAN_VIEW,s.MetaTable.MAP_VIEW_COLUMNS,s.MetaTable.MAP_VIEW,s.MetaTable.MODELS,s.MetaTable.SORT,s.MetaTable.SOURCES,s.MetaTable.SYNC_LOGS,s.MetaTable.SYNC_SOURCE,s.MetaTable.USER_COMMENTS_NOTIFICATIONS_PREFERENCE,s.MetaTable.VIEWS];for(const s of i)await e(s).where("base_id",a).update({base_id:t});await e(s.MetaTable.PROJECT).where("id",a).update({id:t}),r(`Replaced ${a} with ${t} (because it was too long)`)}};const p=[s.MetaTable.API_TOKENS,s.MetaTable.AUDIT,s.MetaTable.PROJECT_USERS,s.MetaTable.COLUMNS,s.MetaTable.COMMENTS_REACTIONS,s.MetaTable.COMMENTS,s.MetaTable.MODEL_ROLE_VISIBILITY,s.MetaTable.FILTER_EXP,s.MetaTable.FORM_VIEW_COLUMNS,s.MetaTable.FORM_VIEW,s.MetaTable.GALLERY_VIEW_COLUMNS,s.MetaTable.GALLERY_VIEW,s.MetaTable.GRID_VIEW_COLUMNS,s.MetaTable.GRID_VIEW,s.MetaTable.HOOK_LOGS,s.MetaTable.HOOKS,s.MetaTable.KANBAN_VIEW_COLUMNS,s.MetaTable.KANBAN_VIEW,s.MetaTable.MAP_VIEW,s.MetaTable.MAP_VIEW_COLUMNS,s.MetaTable.MODELS,s.MetaTable.SORT,s.MetaTable.SOURCES,s.MetaTable.SYNC_LOGS,s.MetaTable.SYNC_SOURCE,s.MetaTable.USER_COMMENTS_NOTIFICATIONS_PREFERENCE,s.MetaTable.VIEWS],m=[s.MetaTable.CALENDAR_VIEW,s.MetaTable.CALENDAR_VIEW_COLUMNS];t.up=async e=>{l=process.hrtime(),await(0,t.replaceLongBaseIds)(e),c("Replaced long base IDs");for(const t of p)l=process.hrtime(),await e.schema.alterTable(t,(e=>{e.string("base_id",20).alter()})),c(`Altered ${t}.base_id to 20 characters`);for(const t of m)l=process.hrtime(),await e.schema.alterTable(t,(e=>{e.string("source_id",20).alter()})),c(`Altered ${t}.source_id to 20 characters`)};t.down=async e=>{for(const t of p)await e.schema.alterTable(t,(e=>{e.string("base_id",128).alter()}));for(const t of m)await e.schema.alterTable(t,(e=>{e.string("source_id",128).alter()}))}},59048:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.PROJECT_USERS,(e=>{e.primary(["base_id","fk_user_id"])}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.PROJECT_USERS,(e=>{e.dropPrimary()}))}},62936:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(71040),s=a(92080),r=a(64612);let l=process.hrtime();const c=e=>{const[t,a]=process.hrtime(l);(e=>{console.log(`nc_055_integration: ${e}`)})(`${e} in ${t+a/1e9}s`)};t.up=async e=>{const t=(0,s.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);await e.schema.hasTable(r.MetaTable.INTEGRATIONS)||await e.schema.createTable(r.MetaTable.INTEGRATIONS,(e=>{e.string("id",20).primary(),e.string("title",128),e.text("config"),e.text("meta"),e.string("type",20).index(),e.string("sub_type",20),e.boolean("is_private").defaultTo(!1),e.boolean("deleted").defaultTo(!1),e.string("created_by",20).index(),e.float("order"),e.timestamps(!0,!0)})),await e.schema.hasColumn(r.MetaTable.SOURCES,"fk_integration_id")||await e.schema.alterTable(r.MetaTable.SOURCES,(e=>{e.string("fk_integration_id",20).index()})),l=process.hrtime();const a=await e(r.MetaTable.SOURCES).select(`${r.MetaTable.SOURCES}.*`).select(`${r.MetaTable.PROJECT_USERS}.fk_user_id as created_by`).innerJoin(r.MetaTable.PROJECT,`${r.MetaTable.SOURCES}.base_id`,`${r.MetaTable.PROJECT}.id`).where((e=>e.where(`${r.MetaTable.SOURCES}.is_meta`,!1).orWhereNull(`${r.MetaTable.SOURCES}.is_meta`))).leftJoin(r.MetaTable.PROJECT_USERS,(t=>{t.on(`${r.MetaTable.PROJECT}.id`,`${r.MetaTable.PROJECT_USERS}.base_id`).andOn(`${r.MetaTable.PROJECT_USERS}.roles`,e.raw("?",[i.ProjectRoles.OWNER]))}));c("Fetched external sources"),l=process.hrtime();for(const s of a){const a=`int${t()}`,l={title:s.alias,id:a,config:s.config,type:i.IntegrationsType.Database,sub_type:s.type,created_by:s.created_by,created_at:s.created_at,updated_at:s.updated_at};await e(r.MetaTable.INTEGRATIONS).insert(l),await e(r.MetaTable.SOURCES).where("id",s.id).update({fk_integration_id:a})}c("Migrated external sources")};t.down=async e=>{await e.schema.dropTable(r.MetaTable.INTEGRATIONS),await e.schema.alterTable(r.MetaTable.SOURCES,(e=>{e.dropColumn("fk_integration_id")}))}},63332:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.FILE_REFERENCES,(t=>{t.string("id",20).primary().notNullable(),t.string("storage"),t.text("file_url"),t.integer("file_size"),t.string("fk_user_id",20),t.string("fk_workspace_id",20),t.string("base_id",20),t.string("source_id",20),t.string("fk_model_id",20),t.string("fk_column_id",20),t.boolean("is_external").defaultTo(!1),t.boolean("deleted").defaultTo(!1),t.timestamps(!0,!0),e.client.config.client.includes("mysql")||t.index(["file_url","storage"],"nc_file_references_temp")}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.FILE_REFERENCES)}},49560:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.COL_BUTTON,(e=>{e.string("id",20),e.string("base_id",20),e.string("type"),e.text("label"),e.string("theme"),e.string("color"),e.string("icon"),e.text("formula"),e.text("formula_raw"),e.string("error"),e.text("parsed_tree"),e.string("fk_webhook_id",20),e.string("fk_column_id",20),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.COL_BUTTON)}},41140:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.PROJECT_USERS,(e=>{e.string("invited_by",20).index()}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.PROJECT_USERS,(e=>{e.dropColumn("invited_by")}))}},97280:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612),s=async(e,t)=>{await e.schema.alterTable(t,(e=>{e.text("description").alter()}))},r=async(e,t)=>{await e.schema.alterTable(t,(e=>{e.string("description",255).alter()}))};t.up=async e=>{await s(e,i.MetaTable.COLUMNS),await s(e,i.MetaTable.MODELS),await s(e,i.MetaTable.VIEWS)};t.down=async e=>{await r(e,i.MetaTable.COLUMNS),await r(e,i.MetaTable.MODELS),await r(e,i.MetaTable.VIEWS)}},89340:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.INTEGRATIONS,(e=>{e.boolean("is_default").defaultTo(!1)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.INTEGRATIONS,(e=>{e.dropColumn("is_default")}))}},27735:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.createTable(i.MetaTable.INTEGRATIONS_STORE,(e=>{e.string("id",20).primary(),e.string("fk_integration_id",20).index(),e.string("type",20),e.string("sub_type",20),e.string("fk_workspace_id",20),e.string("fk_user_id",20),e.timestamps(!0,!0),e.text("slot_0"),e.text("slot_1"),e.text("slot_2"),e.text("slot_3"),e.text("slot_4"),e.integer("slot_5"),e.integer("slot_6"),e.integer("slot_7"),e.integer("slot_8"),e.integer("slot_9")}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.INTEGRATIONS_STORE)}},98736:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.string("fk_parent_column_id",20).index()}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.dropColumn("fk_parent_column_id")}))}},96276:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.SOURCES,(e=>{e.boolean("is_local").defaultTo(!1)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.SOURCES,(e=>{e.dropColumn("is_local")}))}},71012:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(64612);t.up=async e=>{await e.schema.alterTable(i.MetaTable.SOURCES,(e=>{e.boolean("is_encrypted").defaultTo(!1)})),await e.schema.alterTable(i.MetaTable.INTEGRATIONS,(e=>{e.boolean("is_encrypted").defaultTo(!1)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.SOURCES,(e=>{e.dropColumn("is_encrypted")})),await e.schema.alterTable(i.MetaTable.INTEGRATIONS,(e=>{e.dropColumn("is_encrypted")}))}},47932:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Acl=t.AclMiddleware=t.ExtractIdsMiddleware=t.rolesLabel=void 0,t.getRolesLabels=function(e){return e.filter((e=>![u.OrgUserRoles.CREATOR,u.OrgUserRoles.VIEWER].includes(e))).map((e=>t.rolesLabel[e]))};const c=a(23324),d=a(98496),u=a(71040),p=a(40224),m=a(19684),_=l(a(16736)),f=a(43820),h=a(64612),g=a(16736),y=a(19684);t.rolesLabel={[u.OrgUserRoles.SUPER_ADMIN]:"Super Admin",[u.OrgUserRoles.CREATOR]:"Org Creator",[u.OrgUserRoles.VIEWER]:"Org Viewer",[u.ProjectRoles.OWNER]:"Base Owner",[u.ProjectRoles.CREATOR]:"Base Creator",[u.ProjectRoles.VIEWER]:"Base Viewer",[u.ProjectRoles.EDITOR]:"Base Editor",[u.ProjectRoles.COMMENTER]:"Base Commenter",[u.ProjectRoles.NO_ACCESS]:"No Access"};let b=class ExtractIdsMiddleware{async use(e,t,a){var i,s,r;const{params:l}=e,c={workspace_id:h.RootScopes.BYPASS,base_id:h.RootScopes.BYPASS};if(l.baseName){const t=await m.Base.getByTitleOrId(c,l.baseName);if(t||f.NcError.baseNotFound(l.baseName),t&&(e.ncBaseId=t.id,l.tableName)){const a=await m.Model.getByAliasOrId(c,{base_id:t.id,aliasOrId:l.tableName});a||f.NcError.tableNotFound(e.params.tableName),e.ncSourceId=null==a?void 0:a.source_id}}if(l.baseId)e.ncBaseId=l.baseId;else if(l.dashboardId)e.ncBaseId=l.dashboardId;else if(l.tableId||l.modelId){const t=await m.Model.getByIdOrName(c,{id:l.tableId||l.modelId});t||f.NcError.tableNotFound(l.tableId||l.modelId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.viewId){const t=await m.View.get(c,l.viewId)||await m.Model.get(c,l.viewId);t||f.NcError.viewNotFound(l.viewId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.formViewId||l.gridViewId||l.kanbanViewId||l.galleryViewId||l.calendarViewId){const t=await m.View.get(c,l.formViewId||l.gridViewId||l.kanbanViewId||l.galleryViewId||l.calendarViewId);t||f.NcError.viewNotFound(l.formViewId||l.gridViewId||l.kanbanViewId||l.galleryViewId||l.calendarViewId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.publicDataUuid){const t=await m.View.getByUUID(c,e.params.publicDataUuid);t||f.NcError.viewNotFound(l.publicDataUuid),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.sharedViewUuid){const t=await m.View.getByUUID(c,e.params.sharedViewUuid);t||f.NcError.viewNotFound(e.params.sharedViewUuid),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.sharedBaseUuid){const t=await m.Base.getByUuid(c,e.params.sharedBaseUuid);t||f.NcError.baseNotFound(e.params.sharedBaseUuid),e.ncBaseId=null==t?void 0:t.id}else if(l.hookId){const t=await m.Hook.get(c,l.hookId);t||f.NcError.hookNotFound(l.hookId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.gridViewColumnId){const t=await m.GridViewColumn.get(c,l.gridViewColumnId);t||f.NcError.fieldNotFound(l.gridViewColumnId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.formViewColumnId){const t=await m.FormViewColumn.get(c,l.formViewColumnId);t||f.NcError.fieldNotFound(l.formViewColumnId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.galleryViewColumnId){const t=await m.GalleryViewColumn.get(c,l.galleryViewColumnId);t||f.NcError.fieldNotFound(l.galleryViewColumnId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.columnId){const t=await m.Column.get(c,{colId:l.columnId});t||f.NcError.fieldNotFound(l.columnId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.filterId){const t=await m.Filter.get(c,l.filterId);t||f.NcError.genericNotFound("Filter",l.filterId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.filterParentId){const t=await m.Filter.get(c,l.filterParentId);t||f.NcError.genericNotFound("Filter",l.filterParentId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.sortId){const t=await m.Sort.get(c,l.sortId);t||f.NcError.genericNotFound("Sort",l.sortId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.syncId){const t=await m.SyncSource.get(c,e.params.syncId);t||f.NcError.genericNotFound("Sync Source",l.syncId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(l.extensionId){const t=await m.Extension.get(c,e.params.extensionId);t||f.NcError.genericNotFound("Extension",l.extensionId),e.ncBaseId=t.base_id}else if(["/api/v1/db/meta/audits/rows/:rowId/update","/api/v2/meta/audits/rows/:rowId/update","/api/v1/db/meta/comments","/api/v2/meta/comments"].some((t=>e.route.path===t))&&"POST"===e.method&&(null===(i=e.body)||void 0===i?void 0:i.fk_model_id)){const t=await m.Model.getByIdOrName(c,{id:e.body.fk_model_id});t||f.NcError.tableNotFound(e.body.fk_model_id),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(["/api/v2/meta/comments/count","/api/v1/db/meta/comments/count","/api/v2/meta/comments","/api/v1/db/meta/comments","/api/v1/db/meta/audits","/api/v2/meta/audits"].some((t=>e.route.path===t))&&"GET"===e.method&&e.query.fk_model_id){const t=await m.Model.getByIdOrName(c,{id:null===(s=e.query)||void 0===s?void 0:s.fk_model_id});t||f.NcError.tableNotFound(null===(r=e.query)||void 0===r?void 0:r.fk_model_id),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else if(["/api/v1/db/meta/comment/:commentId","/api/v2/meta/comment/:commentId"].some((t=>e.route.path===t))&&("PATCH"===e.method||"DELETE"===e.method)&&e.params.commentId){const t=await m.Comment.get(c,l.commentId);t||f.NcError.genericNotFound("Comment",l.commentId),e.ncBaseId=t.base_id,e.ncSourceId=t.source_id}else["/auth/user/me","/api/v1/db/auth/user/me","/api/v1/auth/user/me","/api/v1/db/meta/plugins/webhook","/api/v2/meta/plugins/webhook"].some((t=>e.route.path===t))&&e.query.base_id&&(e.ncBaseId=e.query.base_id);if("/api/v2/meta/integrations"===e.route.path&&"GET"===e.method&&e.query.baseId){const t=await m.Base.get(c,e.query.baseId);t||f.NcError.baseNotFound(e.query.baseId),e.ncBaseId=t.id}e.context={workspace_id:null,base_id:e.ncBaseId},a()}async canActivate(e){return await this.use(e.switchToHttp().getRequest(),e.switchToHttp().getResponse(),(()=>{})),!0}};function w(e,t){return"base"===t?null==e?void 0:e.base_roles:"org"===t?null==e?void 0:e.roles:void 0}t.ExtractIdsMiddleware=b,t.ExtractIdsMiddleware=b=s([(0,c.Injectable)()],b);let v=class AclMiddleware{constructor(e){this.reflector=e}async intercept(e,t){var a,i,s;const r=this.reflector.get("permission",e.getHandler()),l=this.reflector.get("allowedRoles",e.getHandler()),c=this.reflector.get("blockApiTokenAccess",e.getHandler()),d=this.reflector.get("scope",e.getHandler()),m=this.reflector.get("extendedScope",e.getHandler()),h=e.switchToHttp().getRequest();(null===(a=h.user)||void 0===a?void 0:a.isAuthorized)||f.NcError.unauthorized("Invalid token");const b=!0===(null===(i=h.user.roles)||void 0===i?void 0:i[u.OrgUserRoles.SUPER_ADMIN])?u.OrgUserRoles.SUPER_ADMIN:w(h.user,d);b||f.NcError.forbidden("You don't have permission to access this resource"),b===u.OrgUserRoles.SUPER_ADMIN&&(h.user.base_roles={[u.ProjectRoles.OWNER]:!0});const v=(0,u.extractRolesObj)(b),T=m&&w(h.user,m);(null===(s=null==h?void 0:h.user)||void 0===s?void 0:s.is_api_token)&&c&&f.NcError.apiTokenNotAllowed(),l&&!l.some((e=>null==v?void 0:v[e]))||(null==v?void 0:v.creator)||(null==v?void 0:v.owner)||(null==v?void 0:v.editor)||(null==v?void 0:v.viewer)||(null==v?void 0:v.commenter)||(null==v?void 0:v[u.OrgUserRoles.SUPER_ADMIN])||(null==v?void 0:v[u.OrgUserRoles.CREATOR])||(null==v?void 0:v[u.OrgUserRoles.VIEWER])||f.NcError.unauthorized("Unauthorized access");if(v&&(Object.entries(v).some((([e,t])=>t&&_.default[e]&&("*"===_.default[e]||_.default[e].exclude&&!_.default[e].exclude[r]||_.default[e].include&&_.default[e].include[r])))||T&&Object.entries(T).some((([e,t])=>t&&_.default[e]&&("*"===_.default[e]||_.default[e].exclude&&!_.default[e].exclude[d+"_"+r]||_.default[e].include&&_.default[e].include[d+"_"+r]))))||f.NcError.permissionDenied(r,v,T),g.sourceRestrictions[u.SourceRestriction.SCHEMA_READONLY][r]||g.sourceRestrictions[u.SourceRestriction.DATA_READONLY][r]){let e;if(!h.ncSourceId&&h.ncBaseId&&"tableCreate"===r){const t=await y.Source.list(h.context,{baseId:h.ncBaseId});e=h.params.sourceId?t.find((e=>e.id===h.params.sourceId)):t.find((e=>e.isMeta()))||t[0]}else h.ncSourceId&&(e=await y.Source.get(h.context,h.ncSourceId));e||f.NcError.notFound("Source not found or source id not extracted"),e.is_schema_readonly&&g.sourceRestrictions[u.SourceRestriction.SCHEMA_READONLY][r]&&f.NcError.sourceMetaReadOnly(e.alias),e.is_data_readonly&&g.sourceRestrictions[u.SourceRestriction.DATA_READONLY][r]&&f.NcError.sourceDataReadOnly(e.alias)}return t.handle().pipe((0,p.map)((e=>e)))}};t.AclMiddleware=v,t.AclMiddleware=v=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.Reflector&&d.Reflector)?i:Object])],v);t.Acl=(e,{scope:t="base",allowedRoles:a,blockApiTokenAccess:i,extendedScope:s}={})=>(r,l,d)=>{(0,c.SetMetadata)("permission",e)(r,l,d),(0,c.SetMetadata)("scope",t)(r,l,d),(0,c.SetMetadata)("extendedScope",s)(r,l,d),(0,c.SetMetadata)("allowedRoles",a)(r,l,d),(0,c.SetMetadata)("blockApiTokenAccess",i)(r,l,d),(0,c.UseInterceptors)(v)(r,l,d)}},32759:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalMiddleware=void 0;const c=a(23324),d=a(16184),u=l(a(76584));let p=class GlobalMiddleware{constructor(e){this.config=e}use(e,t,a){var i,s,r,l;e.ncSiteUrl=(null===(r=null===(s=null===(i=u.default.config)||void 0===i?void 0:i.envs)||void 0===s?void 0:s[u.default.env])||void 0===r?void 0:r.publicUrl)||(null===(l=u.default.config)||void 0===l?void 0:l.publicUrl)||e.protocol+"://"+e.get("host"),e.ncFullUrl=e.protocol+"://"+e.get("host")+e.originalUrl;const c=this.config.get("dashboardPath",{infer:!0});e.dashboardUrl=process.env.NC_DASHBOARD_URL||e.ncSiteUrl+c,a()}};t.GlobalMiddleware=p,t.GlobalMiddleware=p=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.ConfigService&&d.ConfigService)?i:Object])],p)},27756:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GuiMiddleware=void 0;const c=a(23324),d=l(a(30130)),u=a(16184);let p=class GuiMiddleware{constructor(e){this.configService=e}use(e,t,a){const i=this.configService.get("dashboardPath",{infer:!0});d.default.expressMiddleware(i)(e,t,a)}};t.GuiMiddleware=p,t.GuiMiddleware=p=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.ConfigService&&u.ConfigService)?i:Object])],p)},15316:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(92080),r=a(64612),l=i(a(76584)),c=i(a(57804));class ApiToken{constructor(e){Object.assign(this,e)}static async insert(e,t=l.default.ncMeta){const a=(0,s.nanoid)(40);return await t.metaInsert2(r.RootScopes.ROOT,r.RootScopes.ROOT,r.MetaTable.API_TOKENS,{description:e.description,token:a,fk_user_id:e.fk_user_id},!0),this.getByToken(a).then((async e=>(await c.default.appendToList(r.CacheScope.API_TOKEN,[],`${r.CacheScope.API_TOKEN}:${a}`),e)))}static async list(e,t=l.default.ncMeta){const a=await t.metaList2(r.RootScopes.ROOT,r.RootScopes.ROOT,r.MetaTable.API_TOKENS,{condition:{fk_user_id:e}});return null==a?void 0:a.map((e=>new ApiToken(e)))}static async delete(e,t=l.default.ncMeta){const a=await this.get(e,t);return await c.default.deepDel(`${r.CacheScope.API_TOKEN}:${a.id}`,r.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(r.RootScopes.ROOT,r.RootScopes.ROOT,r.MetaTable.API_TOKENS,e)}static async getByToken(e,t=l.default.ncMeta){let a=e&&await c.default.get(`${r.CacheScope.API_TOKEN}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet(r.RootScopes.ROOT,r.RootScopes.ROOT,r.MetaTable.API_TOKENS,{token:e}),await c.default.set(`${r.CacheScope.API_TOKEN}:${e}`,a)),a&&new ApiToken(a)}static async count({fk_user_id:e,includeUnmappedToken:t=!1}={},a=l.default.ncMeta){var i,s;const c=a.knex(r.MetaTable.API_TOKENS);return e&&c.where(`${r.MetaTable.API_TOKENS}.fk_user_id`,e),t&&c.orWhereNull(`${r.MetaTable.API_TOKENS}.fk_user_id`),null!==(s=null===(i=await c.count("id",{as:"count"}).first())||void 0===i?void 0:i.count)&&void 0!==s?s:0}static async listWithCreatedBy({limit:e=10,offset:t=0,fk_user_id:a,includeUnmappedToken:i=!1},s=l.default.ncMeta){const c=s.knex(r.MetaTable.API_TOKENS).offset(t).limit(e).select(`${r.MetaTable.API_TOKENS}.id`,`${r.MetaTable.API_TOKENS}.token`,`${r.MetaTable.API_TOKENS}.description`,`${r.MetaTable.API_TOKENS}.fk_user_id`,`${r.MetaTable.API_TOKENS}.base_id`,`${r.MetaTable.API_TOKENS}.created_at`,`${r.MetaTable.API_TOKENS}.updated_at`).select(s.knex(r.MetaTable.USERS).select("email").whereRaw(`${r.MetaTable.USERS}.id = ${r.MetaTable.API_TOKENS}.fk_user_id`).as("created_by"));return a&&c.where(`${r.MetaTable.API_TOKENS}.fk_user_id`,a),i&&c.orWhereNull(`${r.MetaTable.API_TOKENS}.fk_user_id`),c}static async get(e,t=l.default.ncMeta){return await t.metaGet(r.RootScopes.ROOT,r.RootScopes.ROOT,r.MetaTable.API_TOKENS,e)}}t.default=ApiToken},45988:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(76584)),l=a(70220),c=a(64612);class Audit{constructor(e){Object.assign(this,e)}static async get(e){const t=await r.default.ncMeta.metaGet2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,e);return t&&new Audit(t)}static async insert(e,t=r.default.ncMeta,{forceAwait:a}={forceAwait:"true"===process.env.TEST}){if("true"===process.env.NC_DISABLE_AUDIT)return;const i=async()=>{const a=(0,l.extractProps)(e,["user","ip","source_id","fk_workspace_id","base_id","row_id","fk_model_id","op_type","op_sub_type","status","description","details"]);return await t.metaInsert2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,a)};return a?await i():i()}static async auditList(e){const t=r.default.ncMeta.knex(c.MetaTable.AUDIT).join(c.MetaTable.USERS,`${c.MetaTable.USERS}.email`,`${c.MetaTable.AUDIT}.user`).select(`${c.MetaTable.AUDIT}.*`,`${c.MetaTable.USERS}.display_name`).where("row_id",e.row_id).where("fk_model_id",e.fk_model_id).where("op_type","!=",s.AuditOperationTypes.COMMENT).orderBy("created_at","desc"),a=await t;return null==a?void 0:a.map((e=>new Audit(e)))}static async baseAuditList(e,{limit:t=25,offset:a=0,sourceId:i,orderBy:s}){return await r.default.ncMeta.metaList2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,{condition:Object.assign({base_id:e},i?{source_id:i}:{}),orderBy:Object.assign(Object.assign({},(null==s?void 0:s.created_at)?{created_at:null==s?void 0:s.created_at}:(null==s?void 0:s.user)?{}:{created_at:"desc"}),(null==s?void 0:s.user)?{user:null==s?void 0:s.user}:{}),limit:t,offset:a})}static async baseAuditCount(e,{sourceId:t}){return await r.default.ncMeta.metaCount(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,{condition:Object.assign({base_id:e},t?{source_id:t}:{})})}static async sourceAuditList(e,{limit:t=25,offset:a=0}){return await r.default.ncMeta.metaList2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,{condition:{source_id:e},orderBy:{created_at:"desc"},limit:t,offset:a})}static async sourceAuditCount(e){var t;return null===(t=await r.default.ncMeta.knex(c.MetaTable.AUDIT).where({source_id:e}).count("id",{as:"count"}).first())||void 0===t?void 0:t.count}static async projectAuditList({limit:e=25,offset:t=0,orderBy:a}){return await r.default.ncMeta.metaList2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,{limit:e,offset:t,orderBy:Object.assign(Object.assign({},(null==a?void 0:a.created_at)?{created_at:null==a?void 0:a.created_at}:(null==a?void 0:a.user)?{}:{created_at:"desc"}),(null==a?void 0:a.user)?{user:null==a?void 0:a.user}:{})})}static async projectAuditCount(){return await r.default.ncMeta.metaCount(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.AUDIT,{})}}t.default=Audit},98768:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=i(a(57804)),l=a(70220),c=a(64612),d=a(19684),u=a(43820);class BarcodeColumn{constructor(e){Object.assign(this,e)}static async insert(e,t,a=s.default.ncMeta){const i=(0,l.extractProps)(t,["fk_column_id","fk_barcode_value_column_id","barcode_format"]);return await d.Column.get(e,{colId:i.fk_column_id},a)||u.NcError.fieldNotFound(i.fk_column_id),await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.COL_BARCODE,i),this.read(e,t.fk_column_id,a)}static async read(e,t,a=s.default.ncMeta){let i=t&&await r.default.get(`${c.CacheScope.COL_BARCODE}:${t}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.COL_BARCODE,{fk_column_id:t}),await r.default.set(`${c.CacheScope.COL_BARCODE}:${t}`,i)),i?new BarcodeColumn(i):null}async getValueColumn(e,t=s.default.ncMeta){return d.Column.get(e,{colId:this.fk_barcode_value_column_id},t)}}t.default=BarcodeColumn},30136:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(23324),r=a(19684),l=i(a(76584)),c=a(64612),d=a(70220),u=i(a(57804)),p=a(26944),m=i(a(82096)),_=a(24408),f=new s.Logger("Base");class Base{constructor(e){this.is_meta=!1,Object.assign(this,e)}static castType(e){return e&&new Base(e)}static async createProject(e,t=l.default.ncMeta){var a;const i=(0,d.extractProps)(e,["id","title","prefix","description","is_meta","status","meta","color","order"]);i.order||(i.order=await t.metaGetNextOrder(c.MetaTable.PROJECT,{})),i.meta&&(i.meta=(0,p.stringifyMetaProp)(i));const{id:s}=await t.metaInsert2(c.RootScopes.BASE,c.RootScopes.BASE,c.MetaTable.PROJECT,i),m={workspace_id:e.fk_workspace_id,base_id:s};for(const i of e.sources)await r.Source.createBase(m,Object.assign(Object.assign({type:null===(a=i.config)||void 0===a?void 0:a.client},i),{baseId:s}),t);return await u.default.del(c.CacheScope.INSTANCE_META),(0,_.cleanCommandPaletteCache)(m.workspace_id).catch((()=>{f.error("Failed to clean command palette cache")})),this.getWithInfo(m,s,!0,t).then((async e=>(await u.default.appendToList(c.CacheScope.PROJECT,[],`${c.CacheScope.PROJECT}:${s}`),e)))}static async list(e,t=l.default.ncMeta){const a=await u.default.getList(c.CacheScope.PROJECT,[]);let{list:i}=a;const{isNoneList:s}=a;s||i.length||(i=await t.metaList2(c.RootScopes.BASE,c.RootScopes.BASE,c.MetaTable.PROJECT,{xcCondition:{_or:[{deleted:{eq:!1}},{deleted:{eq:null}}]},orderBy:{order:"asc"}}),await u.default.setList(c.CacheScope.PROJECT,[],i));const r=[],d=i.filter((e=>0===e.deleted||!1===e.deleted||null===e.deleted)).sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))).map((e=>{const a=this.castType(e);return r.push(a.getSources(!1,t)),a}));return await Promise.all(r),d}static async get(e,t,a=l.default.ncMeta){let i=t&&await u.default.get(`${c.CacheScope.PROJECT}:${t}`,c.CacheGetType.TYPE_OBJECT);return i?i.deleted&&(i=null):(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.PROJECT,{id:t,deleted:!1}),i&&(i.meta=(0,p.parseMetaProp)(i),await u.default.set(`${c.CacheScope.PROJECT}:${t}`,i))),this.castType(i)}async getSources(e=!0,t=l.default.ncMeta){const a=await r.Source.list({workspace_id:this.fk_workspace_id,base_id:this.id},{baseId:this.id},t);return this.sources=a,e||a.forEach((e=>{e.config=void 0,e.integration_config=void 0})),a}static async getWithInfo(e,t,a=!0,i=l.default.ncMeta){let s=t&&await u.default.get(`${c.CacheScope.PROJECT}:${t}`,c.CacheGetType.TYPE_OBJECT);if(s?(null==s?void 0:s.deleted)&&(s=null):(s=await i.metaGet2(e.workspace_id,e.base_id,c.MetaTable.PROJECT,{id:t,deleted:!1}),s&&(s.meta=(0,p.parseMetaProp)(s),await u.default.set(`${c.CacheScope.PROJECT}:${t}`,s)),(null==s?void 0:s.uuid)&&await u.default.set(`${c.CacheScope.PROJECT_ALIAS}:${s.uuid}`,t)),s){const e=this.castType(s);return await e.getSources(a,i),e}return null}static async softDelete(e,t,a=l.default.ncMeta){await this.clearConnectionPool(e,t,a);const i=`${c.CacheScope.PROJECT}:${t}`,s=await u.default.get(i,c.CacheGetType.TYPE_OBJECT);return s&&await u.default.del([`${c.CacheScope.PROJECT_ALIAS}:${s.title}`,`${c.CacheScope.PROJECT_ALIAS}:${s.uuid}`,`${c.CacheScope.PROJECT_ALIAS}:ref:${s.title}`,`${c.CacheScope.PROJECT_ALIAS}:ref:${s.id}`]),await u.default.del(c.CacheScope.INSTANCE_META),await u.default.deepDel(`${c.CacheScope.PROJECT}:${t}`,c.CacheDelDirection.CHILD_TO_PARENT),(0,_.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{f.error("Failed to clean command palette cache")})),await a.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.PROJECT,{deleted:!0},t)}static async update(e,t,a,i=l.default.ncMeta){const s=(0,d.extractProps)(a,["title","prefix","status","description","meta","color","deleted","order","sources","uuid","password","roles"]),r=`${c.CacheScope.PROJECT}:${t}`;let m=await u.default.get(r,c.CacheGetType.TYPE_OBJECT);return m&&(m.uuid&&s.uuid&&m.uuid!==s.uuid&&(await u.default.del(`${c.CacheScope.PROJECT_ALIAS}:${m.uuid}`),await u.default.set(`${c.CacheScope.PROJECT_ALIAS}:${s.uuid}`,t)),m.uuid&&null===s.uuid&&await u.default.del(`${c.CacheScope.PROJECT_ALIAS}:${m.uuid}`),m.title&&s.title&&m.title!==s.title&&(await u.default.del(`${c.CacheScope.PROJECT_ALIAS}:${m.title}`),await u.default.set(`${c.CacheScope.PROJECT_ALIAS}:${s.title}`,t)),m=Object.assign(Object.assign({},m),s),await u.default.del(c.CacheScope.INSTANCE_META),await u.default.set(r,m)),s.meta&&(s.meta=(0,p.stringifyMetaProp)(s)),(0,_.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{f.error("Failed to clean command palette cache")})),await i.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.PROJECT,s,t)}static async delete(e,t,a=l.default.ncMeta){let i=await this.get(e,t,a);const s=await r.BaseUser.getUsersList(e,{base_id:t},a);for(const i of s)await r.BaseUser.delete(e,t,i.id,a);const d=await r.Source.list(e,{baseId:t},a);for(const t of d)await t.delete(e,a);return i=await this.get(e,t,a),i&&await u.default.del([`${c.CacheScope.PROJECT_ALIAS}:${i.uuid}`,`${c.CacheScope.PROJECT_ALIAS}:${i.title}`,`${c.CacheScope.PROJECT_ALIAS}:ref:${i.title}`,`${c.CacheScope.PROJECT_ALIAS}:ref:${i.id}`]),await u.default.deepDel(`${c.CacheScope.PROJECT}:${t}`,c.CacheDelDirection.CHILD_TO_PARENT),await a.metaDelete(e.workspace_id,e.base_id,c.MetaTable.AUDIT,{base_id:t}),(0,_.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{f.error("Failed to clean command palette cache")})),await a.metaDelete(e.workspace_id,e.base_id,c.MetaTable.PROJECT,t)}static async getByUuid(e,t,a=l.default.ncMeta){const i=t&&await u.default.get(`${c.CacheScope.PROJECT_ALIAS}:${t}`,c.CacheGetType.TYPE_STRING);let s=null;return i?this.get(e,i,a):(s=await l.default.ncMeta.metaGet2(e.workspace_id,e.base_id,c.MetaTable.PROJECT,{uuid:t}),s&&(s.meta=(0,p.parseMetaProp)(s),await u.default.set(`${c.CacheScope.PROJECT_ALIAS}:${t}`,null==s?void 0:s.id)),(null==s?void 0:s.id)&&this.get(e,null==s?void 0:s.id,a))}static async getWithInfoByTitle(e,t,a=l.default.ncMeta){const i=await this.getByTitle(e,t,a);return i&&await i.getSources(!1,a),i}static async getByTitle(e,t,a=l.default.ncMeta){const i=t&&await u.default.get(`${c.CacheScope.PROJECT_ALIAS}:${t}`,c.CacheGetType.TYPE_STRING);let s=null;return i?this.get(e,i,a):(s=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.PROJECT,{title:t,deleted:!1}),s&&(s.meta=(0,p.parseMetaProp)(s),await u.default.set(`${c.CacheScope.PROJECT_ALIAS}:${t}`,null==s?void 0:s.id)),(null==s?void 0:s.id)&&this.get(e,null==s?void 0:s.id,a))}static async getByTitleOrId(e,t,a=l.default.ncMeta){const i=t&&await u.default.get(`${c.CacheScope.PROJECT_ALIAS}:ref:${t}`,c.CacheGetType.TYPE_STRING);let s=null;return i?this.get(e,i,a):(s=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.PROJECT,{deleted:!1},null,{_or:[{id:{eq:t}},{title:{eq:t}}]}),s&&(s.meta=(0,p.parseMetaProp)(s),await u.default.set(`${c.CacheScope.PROJECT_ALIAS}:ref:${t}`,null==s?void 0:s.id)),(null==s?void 0:s.id)&&this.get(e,null==s?void 0:s.id,a))}static async getWithInfoByTitleOrId(e,t,a=l.default.ncMeta){const i=await this.getByTitleOrId(e,t,a);return i&&(i.meta=(0,p.parseMetaProp)(i),await i.getSources(!1,a)),i}static async clearConnectionPool(e,t,a=l.default.ncMeta){const i=await this.get(e,t,a);if(i){const e=await i.getSources(!1,a);for(const t of e)await m.default.deleteAwait(t)}}}t.default=Base},96516:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=a(23324),l=i(a(30136)),c=a(64612),d=i(a(76584)),u=i(a(57804)),p=a(70220),m=a(26944),_=a(43820),f=a(24408),h=new r.Logger("BaseUser");class BaseUser{constructor(e){Object.assign(this,e)}static castType(e){return e&&new BaseUser(e)}static async bulkInsert(e,t,a=d.default.ncMeta){const i=t.map((e=>(0,p.extractProps)(e,["fk_user_id","base_id","roles","invited_by"])));if(!i.length)return;const s=await a.bulkMetaInsert(e.workspace_id,e.base_id,c.MetaTable.PROJECT_USERS,i,!0),r=[...new Set(s.map((e=>e.base_id)))];for(const e of r)await u.default.deepDel(`${c.CacheScope.BASE_USER}:${e}:list`,c.CacheDelDirection.PARENT_TO_CHILD);for(const e of s)await u.default.set(`${c.CacheScope.BASE_USER}:${e.base_id}:${e.fk_user_id}`,e),await u.default.appendToList(c.CacheScope.BASE_USER,[e.base_id],`${c.CacheScope.BASE_USER}:${e.base_id}:${e.fk_user_id}`),(0,f.cleanCommandPaletteCacheForUser)(e.fk_user_id).catch((()=>{h.error("Error cleaning command palette cache")}))}static async insert(e,t,a=d.default.ncMeta){const i=(0,p.extractProps)(t,["fk_user_id","base_id","roles","invited_by","starred","order","hidden"]),{base_id:s,fk_user_id:r}=await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.PROJECT_USERS,i,!0),l=await this.get(e,s,r,a);return await u.default.appendToList(c.CacheScope.BASE_USER,[s],`${c.CacheScope.BASE_USER}:${s}:${r}`),(0,f.cleanCommandPaletteCacheForUser)(r).catch((()=>{h.error("Error cleaning command palette cache")})),l}static async get(e,t,a,i=d.default.ncMeta){let s=t&&a&&await u.default.get(`${c.CacheScope.BASE_USER}:${t}:${a}`,c.CacheGetType.TYPE_OBJECT);if(!s||!s.roles){const e=i.knex(c.MetaTable.USERS).select(`${c.MetaTable.USERS}.id`,`${c.MetaTable.USERS}.email`,`${c.MetaTable.USERS}.display_name`,`${c.MetaTable.USERS}.invite_token`,`${c.MetaTable.USERS}.roles as main_roles`,`${c.MetaTable.USERS}.created_at as created_at`,`${c.MetaTable.PROJECT_USERS}.base_id`,`${c.MetaTable.PROJECT_USERS}.roles as roles`);e.leftJoin(c.MetaTable.PROJECT_USERS,(function(){this.on(`${c.MetaTable.PROJECT_USERS}.fk_user_id`,"=",`${c.MetaTable.USERS}.id`).andOn(`${c.MetaTable.PROJECT_USERS}.base_id`,"=",i.knex.raw("?",[t]))})),e.where(`${c.MetaTable.USERS}.id`,a),s=await e.first(),s&&await u.default.set(`${c.CacheScope.BASE_USER}:${t}:${a}`,s)}return s&&(s.is_mapped=!!s.base_id),this.castType(s)}static async getUsersList(e,{base_id:t,mode:a="full",include_ws_deleted:i=!0},s=d.default.ncMeta){const r=await u.default.getList(c.CacheScope.BASE_USER,[t]);let{list:l}=r;const{isNoneList:p}=r,m=["invite_token"];if(!p&&!l.length){const e=s.knex(c.MetaTable.USERS).select(`${c.MetaTable.USERS}.id`,`${c.MetaTable.USERS}.email`,`${c.MetaTable.USERS}.display_name`,`${c.MetaTable.USERS}.invite_token`,`${c.MetaTable.USERS}.roles as main_roles`,`${c.MetaTable.USERS}.created_at as created_at`,`${c.MetaTable.PROJECT_USERS}.base_id`,`${c.MetaTable.PROJECT_USERS}.roles as roles`);e.leftJoin(c.MetaTable.PROJECT_USERS,(function(){this.on(`${c.MetaTable.PROJECT_USERS}.fk_user_id`,"=",`${c.MetaTable.USERS}.id`).andOn(`${c.MetaTable.PROJECT_USERS}.base_id`,"=",s.knex.raw("?",[t]))})),l=await e,l=l.map((e=>(e.base_id=t,this.castType(e)))),await u.default.setList(c.CacheScope.BASE_USER,[t],l,["base_id","id"])}if("full"===a)return l;for(const e of l)for(const t of m)delete e[t];return l}static async getUsersCount(e,{base_id:t,query:a},i=d.default.ncMeta){var s;const r=i.knex(c.MetaTable.USERS);return a&&r.where("email","like",`%${null===(s=a.toLowerCase)||void 0===s?void 0:s.call(a)}%`),r.leftJoin(c.MetaTable.PROJECT_USERS,(function(){this.on(`${c.MetaTable.PROJECT_USERS}.fk_user_id`,"=",`${c.MetaTable.USERS}.id`).andOn(`${c.MetaTable.PROJECT_USERS}.base_id`,"=",i.knex.raw("?",[t]))})),(await r.count("id",{as:"count"}).first()).count}static async updateRoles(e,t,a,i,s=d.default.ncMeta){const r=await s.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.PROJECT_USERS,{roles:i},{fk_user_id:a,base_id:t});return await u.default.update(`${c.CacheScope.BASE_USER}:${t}:${a}`,{roles:i}),(0,f.cleanCommandPaletteCacheForUser)(a).catch((()=>{h.error("Error cleaning command palette cache")})),r}static async update(e,t,a,i,s=d.default.ncMeta){const r=(0,p.extractProps)(i,["starred","hidden","order"]);return await s.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.PROJECT_USERS,r,{fk_user_id:a,base_id:t}),await u.default.update(`${c.CacheScope.BASE_USER}:${t}:${a}`,r),await this.get(e,t,a,s)}static async delete(e,t,a,i=d.default.ncMeta){const s=await i.metaDelete(e.workspace_id,e.base_id,c.MetaTable.PROJECT_USERS,{fk_user_id:a,base_id:t});return await u.default.deepDel(`${c.CacheScope.BASE_USER}:${t}:list`,c.CacheDelDirection.PARENT_TO_CHILD),(0,f.cleanCommandPaletteCacheForUser)(a).catch((()=>{h.error("Error cleaning command palette cache")})),s}static async getProjectsIdList(e,t=d.default.ncMeta){return e||_.NcError.badRequest("User Id is required"),await t.knex(c.MetaTable.PROJECT_USERS).where({fk_user_id:e})}static async getProjectsList(e,t,a=d.default.ncMeta){const i=a.knex(c.MetaTable.PROJECT).select(`${c.MetaTable.PROJECT}.id`).select(`${c.MetaTable.PROJECT}.title`).select(`${c.MetaTable.PROJECT}.prefix`).select(`${c.MetaTable.PROJECT}.status`).select(`${c.MetaTable.PROJECT}.description`).select(`${c.MetaTable.PROJECT}.meta`).select(`${c.MetaTable.PROJECT}.color`).select(`${c.MetaTable.PROJECT}.is_meta`).select(`${c.MetaTable.PROJECT}.created_at`).select(`${c.MetaTable.PROJECT}.updated_at`).select(`${c.MetaTable.PROJECT_USERS}.starred`).select(`${c.MetaTable.PROJECT_USERS}.roles as project_role`).select(`${c.MetaTable.PROJECT_USERS}.updated_at as last_accessed`).leftJoin(c.MetaTable.PROJECT_USERS,(function(){this.on(`${c.MetaTable.PROJECT_USERS}.base_id`,`${c.MetaTable.PROJECT}.id`),this.andOn(`${c.MetaTable.PROJECT_USERS}.fk_user_id`,a.knex.raw("?",[e]))})).where(`${c.MetaTable.PROJECT_USERS}.fk_user_id`,a.knex.raw("?",[e])).where((function(){this.where(`${c.MetaTable.PROJECT}.deleted`,!1).orWhereNull(`${c.MetaTable.PROJECT}.deleted`)})).where((function(){this.whereNull(`${c.MetaTable.PROJECT_USERS}.roles`).orWhereNot(`${c.MetaTable.PROJECT_USERS}.roles`,s.ProjectRoles.NO_ACCESS)}));t.starred&&i.where(`${c.MetaTable.PROJECT_USERS}.starred`,!0),t.shared&&i.where((function(){this.where((function(){this.where(`${c.MetaTable.PROJECT_USERS}.fk_user_id`,e).whereNot(`${c.MetaTable.PROJECT_USERS}.roles`,s.ProjectRoles.OWNER).whereNotNull(`${c.MetaTable.PROJECT_USERS}.roles`)}))})),t.recent&&i.orderBy(`${c.MetaTable.PROJECT_USERS}.updated_at`,"desc"),i.whereNot(`${c.MetaTable.PROJECT}.deleted`,!0);const r=await i;if(r&&(null==r?void 0:r.length)){const e=[],i=r.filter((e=>!(null==t?void 0:t.type)||e.type===t.type)).sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))).map((t=>{const i=l.default.castType(t);return i.meta=(0,m.parseMetaProp)(i),e.push(i.getSources(!1,a)),i}));return await Promise.all(e),i}return[]}static async updateOrInsert(e,t,a,i,s=d.default.ncMeta){return await this.get(e,t,a,s)?await this.update(e,t,a,i,s):await this.insert(e,{base_id:t,fk_user_id:a,invited_by:i.invited_by})}}t.default=BaseUser},86384:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(a(76584)),l=s(a(57804)),c=a(70220),d=a(64612),u=a(26944);class ButtonColumn{constructor(e){const{parsed_tree:t}=e,a=i(e,["parsed_tree"]);this.parsed_tree=t,Object.assign(this,a)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,[..."url"===t.type?["formula_raw","formula","error","parsed_tree"]:["fk_webhook_id"],"theme","color","label","type","icon","fk_column_id"]);return"url"===t.type&&(i.parsed_tree=(0,u.stringifyMetaProp)(i,"parsed_tree")),await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.COL_BUTTON,i),this.read(e,t.fk_column_id,a)}static async read(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.COL_BUTTON}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.COL_BUTTON,{fk_column_id:t}),i&&("url"===i.type&&(i.parsed_tree=(0,u.parseMetaProp)(i,"parsed_tree")),await l.default.set(`${d.CacheScope.COL_BUTTON}:${t}`,i))),i?new ButtonColumn(i):null}static async update(e,t,a,i=r.default.ncMeta){const s=(0,c.extractProps)(a,[..."url"===a.type?["fk_column_id","formula_raw","formula","error","parsed_tree"]:["fk_webhook_id"],"theme","color","type","icon","label"]);"url"===a.type&&(a.parsed_tree=(0,u.stringifyMetaProp)(a,"parsed_tree")),"parsed_tree"in s&&(s.parsed_tree=(0,u.stringifyMetaProp)(s,"parsed_tree")),await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.COL_BUTTON,s,{fk_column_id:t}),await l.default.update(`${d.CacheScope.COL_BUTTON}:${t}`,s)}getParsedTree(){return this.parsed_tree}}t.default=ButtonColumn},91412:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(a(76584)),l=s(a(57804)),c=a(70220),d=a(64612);class CalendarRange{constructor(e){Object.assign(this,e)}static async bulkInsert(e,t,a=r.default.ncMeta){const i=[];for(const e of t){const t=(0,c.extractProps)(e,["fk_from_column_id","fk_view_id"]);i.push(t)}if(!i.length)return!1;const s=i[0],u=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW_RANGE,s);return await l.default.deepDel(`${d.CacheScope.CALENDAR_VIEW_RANGE}:${u.fk_view_id}:list`,d.CacheDelDirection.PARENT_TO_CHILD),await l.default.set(`${d.CacheScope.CALENDAR_VIEW_RANGE}:${u.id}`,u),await l.default.appendToList(d.CacheScope.CALENDAR_VIEW_RANGE,[u.fk_view_id],`${d.CacheScope.CALENDAR_VIEW_RANGE}:${u.id}`),!0}static async read(e,t,a=r.default.ncMeta){const s=await l.default.getList(d.CacheScope.CALENDAR_VIEW_RANGE,[t]);let{list:c}=s;const{isNoneList:u}=s;return u||c.length||(c=await a.metaList2(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW_RANGE,{condition:{fk_view_id:t}}),await l.default.setList(d.CacheScope.CALENDAR_VIEW_RANGE,[t],c.map((e=>{var{created_at:t,updated_at:a}=e;return i(e,["created_at","updated_at"])})))),(null==c?void 0:c.length)?{ranges:c.map((e=>{var{created_at:t,updated_at:a}=e,s=i(e,["created_at","updated_at"]);return new CalendarRange(s)}))}:null}static async find(e,t,a=r.default.ncMeta){const i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW_RANGE,{fk_view_id:t});return i&&new CalendarRange(i)}static async IsColumnBeingUsedAsRange(e,t,a=r.default.ncMeta){return(await a.metaList2(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW_RANGE,{xcCondition:{_or:[{fk_from_column_id:{eq:t}}]}})).length>0}}t.default=CalendarRange},35948:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(70220),r=a(26944),l=i(a(57804)),c=i(a(76584)),d=a(64612),u=i(a(91412));class CalendarView{constructor(e){Object.assign(this,e)}static async get(e,t,a=c.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.CALENDAR_VIEW}:${t}`,d.CacheGetType.TYPE_OBJECT);if(i){const s=await u.default.read(e,t,a);i.calendar_range=s?s.ranges:[]}else{i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW,{fk_view_id:t});const s=await u.default.read(e,t,a);i&&s&&(i.calendar_range=s.ranges),await l.default.set(`${d.CacheScope.CALENDAR_VIEW}:${t}`,i)}return i&&new CalendarView(i)}static async insert(e,t,a=c.default.ncMeta){const i={base_id:t.base_id,source_id:t.source_id,fk_view_id:t.fk_view_id,meta:t.meta};return await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW,i,!0),this.get(e,t.fk_view_id,a)}static async update(e,t,a,i=c.default.ncMeta){const p=(0,s.extractProps)(a,["fk_cover_image_col_id","meta"]);a.calendar_range&&(await i.metaDelete(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW_RANGE,{fk_view_id:t}),await l.default.del(`${d.CacheScope.CALENDAR_VIEW}:${t}`),await u.default.bulkInsert(e,a.calendar_range.map((e=>Object.assign({fk_view_id:t},e))),i));const m=await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.CALENDAR_VIEW,(0,r.prepareForDb)(p),{fk_view_id:t});return await l.default.update(`${d.CacheScope.CALENDAR_VIEW}:${t}`,(0,r.prepareForResponse)(p)),m}}t.default=CalendarView},28192:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=i(a(57804)),c=a(70220),d=a(71956),u=a(64612);class CalendarViewColumn{constructor(e){Object.assign(this,e)}static async get(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${u.CacheScope.CALENDAR_VIEW_COLUMN}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.CALENDAR_VIEW_COLUMNS,t),i.meta=i.meta&&"string"==typeof i.meta?JSON.parse(i.meta):i.meta,await l.default.set(`${u.CacheScope.CALENDAR_VIEW_COLUMN}:${t}`,i)),i&&new CalendarViewColumn(i)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_view_id","fk_column_id","show","base_id","source_id","underline","bold","italic"]);i.order=await a.metaGetNextOrder(u.MetaTable.CALENDAR_VIEW_COLUMNS,{fk_view_id:i.fk_view_id});const{id:d}=await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.CALENDAR_VIEW_COLUMNS,i);{const i=await s.default.get(e,t.fk_view_id,a);await s.default.clearSingleQueryCache(e,i.fk_model_id,[i],a)}return this.get(e,d,a).then((async e=>(await l.default.appendToList(u.CacheScope.CALENDAR_VIEW_COLUMN,[t.fk_view_id],`${u.CacheScope.CALENDAR_VIEW_COLUMN}:${d}`),e)))}static async list(e,t,a=r.default.ncMeta){const i=await l.default.getList(u.CacheScope.CALENDAR_VIEW_COLUMN,[t]);let{list:s}=i;const{isNoneList:c}=i;if(!c&&!s.length){s=await a.metaList2(e.workspace_id,e.base_id,u.MetaTable.CALENDAR_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}});for(const e of s)e.meta=(0,d.deserializeJSON)(e.meta);await l.default.setList(u.CacheScope.CALENDAR_VIEW_COLUMN,[t],s)}return s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new CalendarViewColumn(e)))}static async update(e,t,a,i=r.default.ncMeta){const d=(0,c.extractProps)(a,["show","order","underline","bold","italic"]),p=await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.CALENDAR_VIEW_COLUMNS,d,t);await l.default.update(`${u.CacheScope.CALENDAR_VIEW_COLUMN}:${t}`,d);{const a=await this.get(e,t,i),r=await s.default.get(e,a.fk_view_id,i);await s.default.clearSingleQueryCache(e,r.fk_model_id,[r])}return p}}t.default=CalendarViewColumn},57596:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=a(23324),l=i(a(84748)),c=i(a(90652)),d=i(a(30468)),u=i(a(31196)),p=i(a(23696)),m=i(a(84072)),_=i(a(70176)),f=i(a(95428)),h=i(a(22996)),g=i(a(69004)),y=i(a(98768)),b=a(19684),w=a(70220),v=a(43820),T=i(a(33755)),k=i(a(76584)),S=a(64612),M=i(a(57804)),O=a(26944),I=a(22e3),C=["#cfdffe","#d0f1fd","#c2f5e8","#ffdaf6","#ffdce5","#fee2d5","#ffeab6","#d1f7c4","#ede2fe","#eeeeee"],E=new r.Logger("Column");class Column{constructor(e){Object.assign(this,e)}async getModel(e,t=k.default.ncMeta){return m.default.getByIdOrName(e,{id:this.fk_model_id},t)}static async insert(e,t,a=k.default.ncMeta){var i;t.fk_model_id||v.NcError.badRequest("Missing model id");const r=(0,w.extractProps)(t,["id","fk_model_id","column_name","title","uidt","dt","np","ns","clen","cop","pk","rqd","un","ct","ai","unique","cdf","cc","csn","dtx","dtxp","dtxs","au","pv","order","base_id","source_id","system","meta","virtual","description"]);if(r.column_name||(r.column_name=t.cn),r.title||(r.title=t._cn),r.meta&&"object"==typeof r.meta&&(r.meta=JSON.stringify(r.meta)),r.order=null!==(i=t.order)&&void 0!==i?i:await a.metaGetNextOrder(S.MetaTable.COLUMNS,{fk_model_id:t.fk_model_id}),t.validate&&("string"==typeof t.validate?r.validate=t.validate:r.validate=JSON.stringify(t.validate)),!t.source_id){const i=await m.default.getByIdOrName(e,{id:t.fk_model_id},a);r.source_id=i.source_id}if(!t.uidt)throw new Error("UI Datatype not found");const l=await a.metaInsert2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,r),c=await this.get(e,{colId:l.id},a);return await M.default.appendToList(S.CacheScope.COLUMN,[t.fk_model_id],`${S.CacheScope.COLUMN}:${l.id}`),await this.insertColOption(e,t,l.id,a),await _.default.insertColumnToAllViews(e,{fk_column_id:l.id,fk_model_id:t.fk_model_id,column_show:{show:!(t.uidt===s.UITypes.LinkToAnotherRecord||t.uidt===s.UITypes.Links&&"mm"===t.type&&!t.view_id)&&!t.view_id,view_id:t.view_id},column_order:t.column_order},a),await _.default.clearSingleQueryCache(e,t.fk_model_id,null,a),c}static async insertColOption(e,t,a,i=k.default.ncMeta){var r,m,_,f;switch(t.uidt||t.ui_data_type){case s.UITypes.Lookup:await d.default.insert(e,{fk_column_id:a,fk_relation_column_id:t.fk_relation_column_id,fk_lookup_column_id:t.fk_lookup_column_id},i);break;case s.UITypes.Rollup:await u.default.insert(e,{fk_column_id:a,fk_relation_column_id:t.fk_relation_column_id,fk_rollup_column_id:t.fk_rollup_column_id,rollup_function:t.rollup_function},i);break;case s.UITypes.Links:case s.UITypes.LinkToAnotherRecord:await c.default.insert(e,{fk_column_id:a,type:t.type,fk_child_column_id:t.fk_child_column_id,fk_parent_column_id:t.fk_parent_column_id,fk_target_view_id:t.fk_target_view_id,fk_mm_model_id:t.fk_mm_model_id,fk_mm_child_column_id:t.fk_mm_child_column_id,fk_mm_parent_column_id:t.fk_mm_parent_column_id,ur:t.ur,dr:t.dr,fk_index_name:t.fk_index_name,fk_related_model_id:t.fk_related_model_id,virtual:t.virtual},i);break;case s.UITypes.QrCode:await g.default.insert(e,{fk_column_id:a,fk_qr_value_column_id:t.fk_qr_value_column_id},i);break;case s.UITypes.Barcode:await y.default.insert(e,{fk_column_id:a,fk_barcode_value_column_id:t.fk_barcode_value_column_id,barcode_format:t.barcode_format},i);break;case s.UITypes.Button:await b.ButtonColumn.insert(e,{fk_column_id:a,formula:null==t?void 0:t.formula,formula_raw:null==t?void 0:t.formula_raw,parsed_tree:null==t?void 0:t.parsed_tree,icon:null==t?void 0:t.icon,type:t.type,theme:t.theme,color:t.color,fk_webhook_id:null==t?void 0:t.fk_webhook_id,label:t.label});break;case s.UITypes.Formula:await l.default.insert(e,{fk_column_id:a,formula:t.formula,formula_raw:t.formula_raw,parsed_tree:t.parsed_tree},i);break;case s.UITypes.MultiSelect:if(null===(r=t.colOptions)||void 0===r?void 0:r.options){const s=[];for(const[e,i]of t.colOptions.options.entries()||[].entries())"enum"!==t.dt&&"set"!==t.dt||(i.title=i.title.trimEnd()),s.push(Object.assign(Object.assign({color:C[e%C.length]},i),{fk_column_id:a,order:e+1}));await p.default.bulkInsert(e,s,i)}else{const s=[];for(const[e,i]of(null===(m=t.dtxp)||void 0===m?void 0:m.split(",").entries())||[].entries())s.push({fk_column_id:a,title:i.replace(/^'/,"").replace(/'$/,""),order:e+1,color:C[e%C.length]});await p.default.bulkInsert(e,s,i)}break;case s.UITypes.SingleSelect:if(null===(_=t.colOptions)||void 0===_?void 0:_.options){const s=[];for(const[e,i]of t.colOptions.options.entries()||[].entries())"enum"!==t.dt&&"set"!==t.dt||(i.title=i.title.trimEnd()),s.push(Object.assign(Object.assign({color:C[e%C.length]},i),{fk_column_id:a,order:e+1}));await p.default.bulkInsert(e,s,i)}else{const s=[];for(const[e,i]of(null===(f=t.dtxp)||void 0===f?void 0:f.split(",").entries())||[].entries())s.push({fk_column_id:a,title:i.replace(/^'/,"").replace(/'$/,""),order:e+1,color:C[e%C.length]});await p.default.bulkInsert(e,s,i)}}}async getColOptions(e,t=k.default.ncMeta){let a;switch(this.uidt){case s.UITypes.Lookup:a=await d.default.read(e,this.id,t);break;case s.UITypes.Rollup:a=await u.default.read(e,this.id,t);break;case s.UITypes.LinkToAnotherRecord:a=await c.default.read(e,this.id,t);break;case s.UITypes.Links:a=await b.LinksColumn.read(e,this.id,t);break;case s.UITypes.MultiSelect:case s.UITypes.SingleSelect:a=await p.default.read(e,this.id,t);break;case s.UITypes.Formula:a=await l.default.read(e,this.id,t);break;case s.UITypes.Button:a=await b.ButtonColumn.read(e,this.id,t),a||(a={type:"url",theme:"solid",color:"brand",label:"Button",error:"Invalid configuration",formula_raw:""});break;case s.UITypes.QrCode:a=await g.default.read(e,this.id,t);break;case s.UITypes.Barcode:a=await y.default.read(e,this.id,t)}return this.colOptions=a,a}async loadModel(e,t=!1,a=k.default.ncMeta){return this.model&&!t||(this.model=await m.default.getByIdOrName(e,{id:this.fk_model_id},a)),this.model}static async list(e,{fk_model_id:t,fk_default_view_id:a},i=k.default.ncMeta){const s=await M.default.getList(S.CacheScope.COLUMN,[t]);let{list:r}=s;const{isNoneList:l}=s,c=a?await _.default.getColumns(e,a,i):[],d=c.reduce(((e,t)=>(e[t.fk_column_id]=t.order,e)),{});return l||r.length||(r=await i.metaList2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{condition:{fk_model_id:t},orderBy:{order:"asc"}}),r.forEach((e=>{e.meta=(0,O.parseMetaProp)(e)})),await M.default.setList(S.CacheScope.COLUMN,[t],r)),r.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),Promise.all(r.map((async t=>{c.length&&(t.meta=Object.assign(Object.assign({},(0,O.parseMetaProp)(t)),{defaultViewColOrder:d[t.id]}));const a=new Column(t);return await a.getColOptions(e,i),a})))}static async get(e,{colId:t},a=k.default.ncMeta){let i=t&&await M.default.get(`${S.CacheScope.COLUMN}:${t}`,S.CacheGetType.TYPE_OBJECT);if(!i&&(i=await a.metaGet2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,t),i)){try{i.meta=JSON.parse(i.meta)}catch(e){i.meta={}}await M.default.set(`${S.CacheScope.COLUMN}:${t}`,i)}if(i){const e=new Column(i);return await e.getColOptions({workspace_id:e.fk_workspace_id,base_id:e.base_id},a),e}return null}static async delete(e,t,a=k.default.ncMeta){const i=await this.get(e,{colId:t},a);if(!i)return;{const i=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_QRCODE,{condition:{fk_qr_value_column_id:t}});for(const t of i)await Column.delete(e,t.fk_column_id,a)}{const i=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_BARCODE,{condition:{fk_barcode_value_column_id:t}});for(const t of i)await Column.delete(e,t.fk_column_id,a)}{const i=await M.default.getList(S.CacheScope.COL_LOOKUP,[t]);let{list:s}=i;const{isNoneList:r}=i;r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_LOOKUP,{condition:{fk_lookup_column_id:t}}));for(const t of s)await Column.delete(e,t.fk_column_id,a)}{const i=await M.default.getList(S.CacheScope.COL_ROLLUP,[t]);let{list:s}=i;const{isNoneList:r}=i;r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_ROLLUP,{condition:{fk_rollup_column_id:t}}));for(const t of s)await Column.delete(e,t.fk_column_id,a)}{const r=await M.default.getList(S.CacheScope.COLUMN,[i.fk_model_id]);let{list:l}=r;const{isNoneList:c}=r;c||l.length||(l=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{condition:{fk_model_id:i.fk_model_id,uidt:s.UITypes.Button}})),l=l.filter((e=>e.uidt===s.UITypes.Button));for(const s of l){const r=await new Column(s).getColOptions(e,a);"url"===r.type&&r.formula&&(0,T.default)({formula:r,columnId:t,title:null==i?void 0:i.title})&&await b.ButtonColumn.update(e,s.id,r,a)}}{const r=await M.default.getList(S.CacheScope.COLUMN,[i.fk_model_id]);let{list:c}=r;const{isNoneList:d}=r;d||c.length||(c=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{condition:{fk_model_id:i.fk_model_id,uidt:s.UITypes.Formula}})),c=c.filter((e=>e.uidt===s.UITypes.Formula));for(const s of c){const r=await new Column(s).getColOptions(e,a);r.formula&&(0,T.default)({formula:r,columnId:t,title:null==i?void 0:i.title})&&await l.default.update(e,s.id,r,a)}}if((0,s.isLinksOrLTAR)(i.uidt)){{const i=await M.default.getList(S.CacheScope.COL_LOOKUP,[t]);let{list:s}=i;const{isNoneList:r}=i;r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_LOOKUP,{condition:{fk_relation_column_id:t}}));for(const t of s)await Column.delete(e,t.fk_column_id,a)}{const i=await M.default.getList(S.CacheScope.COL_ROLLUP,[t]);let{list:s}=i;const{isNoneList:r}=i;r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_ROLLUP,{condition:{fk_relation_column_id:t}}));for(const t of s)await Column.delete(e,t.fk_column_id,a)}}{const i=await M.default.getList(S.CacheScope.SORT,[t]);let{list:s}=i;const{isNoneList:r}=i;r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.SORT,{condition:{fk_column_id:t}}));for(const t of s)await f.default.delete(e,t.id,a)}{const i=await M.default.getList(S.CacheScope.FILTER_EXP,[t]);let{list:s}=i;const{isNoneList:r}=i;r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.FILTER_EXP,{condition:{fk_column_id:t}}));for(const t of s)t.fk_parent_id||await h.default.delete(e,t.id,a)}await h.default.deleteAllByParentColumn(e,t,a),await Column.deleteCoverImageColumnId(e,t,a);let r=null,c=null;switch(i.uidt){case s.UITypes.Rollup:r=S.MetaTable.COL_ROLLUP,c=S.CacheScope.COL_ROLLUP;break;case s.UITypes.Lookup:r=S.MetaTable.COL_LOOKUP,c=S.CacheScope.COL_LOOKUP;break;case s.UITypes.LinkToAnotherRecord:case s.UITypes.Links:r=S.MetaTable.COL_RELATIONS,c=S.CacheScope.COL_RELATION;break;case s.UITypes.MultiSelect:case s.UITypes.SingleSelect:r=S.MetaTable.COL_SELECT_OPTIONS,c=S.CacheScope.COL_SELECT_OPTION;break;case s.UITypes.Formula:r=S.MetaTable.COL_FORMULA,c=S.CacheScope.COL_FORMULA;break;case s.UITypes.Button:r=S.MetaTable.COL_BUTTON,c=S.CacheScope.COL_BUTTON;break;case s.UITypes.QrCode:r=S.MetaTable.COL_QRCODE,c=S.CacheScope.COL_QRCODE;break;case s.UITypes.Barcode:r=S.MetaTable.COL_BARCODE,c=S.CacheScope.COL_BARCODE}r&&c&&(await a.metaDelete(e.workspace_id,e.base_id,r,{fk_column_id:i.id}),await M.default.deepDel(`${c}:${i.id}`,S.CacheDelDirection.CHILD_TO_PARENT));const d=[S.MetaTable.GRID_VIEW_COLUMNS,S.MetaTable.FORM_VIEW_COLUMNS,S.MetaTable.KANBAN_VIEW_COLUMNS,S.MetaTable.GALLERY_VIEW_COLUMNS,S.MetaTable.CALENDAR_VIEW_COLUMNS],u=[S.CacheScope.GRID_VIEW_COLUMN,S.CacheScope.FORM_VIEW_COLUMN,S.CacheScope.KANBAN_VIEW_COLUMN,S.CacheScope.GALLERY_VIEW_COLUMN,S.CacheScope.CALENDAR_VIEW_COLUMN];for(let i=0;i<d.length;i++){const s=d[i],r=u[i],l=await a.metaList2(e.workspace_id,e.base_id,s,{condition:{fk_column_id:t}});await a.metaDelete(e.workspace_id,e.base_id,s,{fk_column_id:t});for(const e of l)await M.default.deepDel(`${r}:${e.id}`,S.CacheDelDirection.CHILD_TO_PARENT)}const p=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_RELATIONS,{xcCondition:{_or:[{fk_child_column_id:{eq:i.id}},{fk_parent_column_id:{eq:i.id}},{fk_mm_child_column_id:{eq:i.id}},{fk_mm_parent_column_id:{eq:i.id}}]}});for(const t of p)await Column.delete(e,t.fk_column_id,a);await b.FileReference.bulkDelete(e,{fk_column_id:i.id},a),await a.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,i.id),await M.default.deepDel(`${S.CacheScope.COLUMN}:${i.id}`,S.CacheDelDirection.CHILD_TO_PARENT),await _.default.clearSingleQueryCache(e,i.fk_model_id,null,a)}static async update(e,t,a,i=k.default.ncMeta,r=!1){const c=await Column.get(e,{colId:t},i);switch(c.uidt){case s.UITypes.Lookup:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_LOOKUP,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_LOOKUP}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.Rollup:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_ROLLUP,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_ROLLUP}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.LinkToAnotherRecord:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_RELATIONS,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_RELATION}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.Formula:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_FORMULA,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_FORMULA}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.Button:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_BUTTON,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_BUTTON}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.QrCode:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_QRCODE,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_QRCODE}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.Barcode:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_BARCODE,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_BARCODE}:${t}`,S.CacheDelDirection.CHILD_TO_PARENT);break;case s.UITypes.MultiSelect:case s.UITypes.SingleSelect:await i.metaDelete(e.workspace_id,e.base_id,S.MetaTable.COL_SELECT_OPTIONS,{fk_column_id:t}),await M.default.deepDel(`${S.CacheScope.COL_SELECT_OPTION}:${t}:list`,S.CacheDelDirection.PARENT_TO_CHILD)}const d=(0,w.extractProps)(a,["column_name","title","description","uidt","dt","np","ns","clen","cop","pk","rqd","un","ct","ai","unique","cdf","cc","csn","dtx","dtxp","dtxs","au","pv","system","validate","meta"]);if(a.validate&&("string"==typeof a.validate?d.validate=a.validate:d.validate=JSON.stringify(a.validate)),!s.AllowedColumnTypesForQrAndBarcodes.includes(d.uidt)){const a=await i.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_QRCODE,{condition:{fk_qr_value_column_id:t}}),s=await i.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_BARCODE,{condition:{fk_barcode_value_column_id:t}});for(const t of a)await Column.delete(e,t.fk_column_id,i);for(const t of s)await Column.delete(e,t.fk_column_id,i)}if(a.column_order&&a.column_order.order&&a.column_order.view_id){const t=(await _.default.getColumns(e,a.column_order.view_id,i)).find((e=>e.fk_column_id===a.id));await _.default.updateColumn(e,a.column_order.view_id,t.id,{order:a.column_order.order},i)}c.uidt===s.UITypes.Attachment&&c.uidt!==a.uidt&&await Column.deleteCoverImageColumnId(e,a.id,i),await i.metaUpdate(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,(0,O.prepareForDb)(d),t),await M.default.update(`${S.CacheScope.COLUMN}:${t}`,(0,O.prepareForResponse)(d)),await this.insertColOption(e,a,t,i),await _.default.clearSingleQueryCache(e,c.fk_model_id,null,i);const u=await Column.get(e,{colId:t},i);r||(0,I.getFormulasReferredTheColumn)(e,{column:u,columns:await Column.list(e,{fk_model_id:c.fk_model_id},i)},i).then((async t=>{for(const a of t)a.uidt===s.UITypes.Formula?await l.default.update(e,a.id,{parsed_tree:null},i):a.uidt===s.UITypes.Button&&await b.ButtonColumn.update(e,a.id,{parsed_tree:null},i)})).catch((e=>{E.error(e)}));{const a=await i.metaList2(e.workspace_id,e.base_id,S.MetaTable.COL_RELATIONS,{xcCondition:{_and:[{_or:[{fk_child_column_id:{eq:t}},{fk_parent_column_id:{eq:t}},{fk_mm_child_column_id:{eq:t}},{fk_mm_parent_column_id:{eq:t}}]},{fk_related_model_id:{neq:c.fk_model_id}}]}});for(const t of a)await _.default.clearSingleQueryCache(e,t.colOptions.fk_related_model_id,null,i)}}static async updateAlias(e,t,{title:a},i=k.default.ncMeta){await i.metaUpdate(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{title:a},t),await M.default.update(`${S.CacheScope.COLUMN}:${t}`,{title:a});const s=await Column.get(e,{colId:t},i);await _.default.clearSingleQueryCache(e,s.fk_model_id,null,i)}getValidators(){if(this.validate&&"string"==typeof this.validate)try{return JSON.parse(this.validate)}catch(e){}return null}async delete(e,t=k.default.ncMeta){return await Column.delete(e,this.id,t)}static async checkTitleAvailable(e,{column_name:t,fk_model_id:a,exclude_id:i},s=k.default.ncMeta){return!await s.metaGet2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{column_name:t,fk_model_id:a},null,i&&{id:{neq:i}})}static async checkAliasAvailable(e,{title:t,fk_model_id:a,exclude_id:i},s=k.default.ncMeta){return!await s.metaGet2(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{title:t,fk_model_id:a},null,i&&{id:{neq:i}})}static async markAsSystemField(e,t,a=!0,i=k.default.ncMeta){await i.metaUpdate(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,{system:a},t),await M.default.update(`${S.CacheScope.COLUMN}:${t}`,{system:a})}static getMaxColumnNameLength(e){let t=255;return"mysql2"===e||"mysql"===e?t=64:"pg"===e?t=59:"mssql"===e&&(t=128),t}static async updateMeta(e,{colId:t,meta:a},i=k.default.ncMeta){await i.metaUpdate(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,(0,O.prepareForDb)({meta:a}),t),await M.default.update(`${S.CacheScope.COLUMN}:${t}`,(0,O.prepareForResponse)({meta:a}))}static async updateValidation(e,{colId:t,validate:a},i=k.default.ncMeta){await i.metaUpdate(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,(0,O.prepareForDb)({validate:a},"validate"),t),await M.default.update(`${S.CacheScope.COLUMN}:${t}`,{validate:a})}static async updateTargetView(e,{colId:t,fk_target_view_id:a},i=k.default.ncMeta){await i.metaUpdate(e.workspace_id,e.base_id,S.MetaTable.COL_RELATIONS,{fk_target_view_id:a},{fk_column_id:t}),await M.default.update(`${S.CacheScope.COL_RELATION}:${t}`,{fk_target_view_id:a})}static async bulkInsert(e,t,a=k.default.ncMeta){const i=[],s=[];for(const e of t.columns){const r=await a.genNanoid(S.MetaTable.COLUMNS),l=Object.assign(Object.assign({},e),{id:r,base_id:t.base_id,source_id:t.source_id,fk_model_id:t.fk_model_id}),c=(0,w.extractProps)(l,["id","fk_model_id","column_name","description","title","uidt","dt","np","ns","clen","cop","pk","rqd","un","ct","ai","unique","cdf","cc","csn","dtx","dtxp","dtxs","au","pv","order","base_id","source_id","system","meta"]);e.meta&&"object"==typeof e.meta&&(c.meta=JSON.stringify(e.meta)),e.validate&&("string"==typeof e.validate?c.validate=e.validate:c.validate=JSON.stringify(e.validate)),i.push(c),s.push(l)}return 0===s.length?[]:(await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COLUMNS,i,!0),await Column.bulkInsertColOption(e,s,a),s)}static async bulkInsertColOption(e,t,a=k.default.ncMeta){var i,r,l,c;const d=new Map;for(const e of t){const t=e.uidt===s.UITypes.MultiSelect?s.UITypes.SingleSelect:e.uidt;let u=d.get(t);switch(u||d.set(t,u=[]),e.uidt||e.ui_data_type){case s.UITypes.Lookup:u.push({fk_column_id:e.id,fk_relation_column_id:e.fk_relation_column_id,fk_lookup_column_id:e.fk_lookup_column_id});break;case s.UITypes.Rollup:u.push({fk_column_id:e.id,fk_relation_column_id:e.fk_relation_column_id,fk_rollup_column_id:e.fk_rollup_column_id,rollup_function:e.rollup_function});break;case s.UITypes.Links:case s.UITypes.LinkToAnotherRecord:u.push({fk_column_id:e.id,type:e.type,fk_child_column_id:e.fk_child_column_id,fk_parent_column_id:e.fk_parent_column_id,fk_mm_model_id:e.fk_mm_model_id,fk_mm_child_column_id:e.fk_mm_child_column_id,fk_mm_parent_column_id:e.fk_mm_parent_column_id,ur:e.ur,dr:e.dr,fk_index_name:e.fk_index_name,fk_related_model_id:e.fk_related_model_id,virtual:e.virtual});break;case s.UITypes.QrCode:u.push({fk_column_id:e.id,fk_qr_value_column_id:e.fk_qr_value_column_id},a);break;case s.UITypes.Barcode:u.push({fk_column_id:e.id,fk_barcode_value_column_id:e.fk_barcode_value_column_id,barcode_format:e.barcode_format});break;case s.UITypes.Formula:u.push({fk_column_id:e.id,formula:e.formula,formula_raw:e.formula_raw,parsed_tree:e.parsed_tree});break;case s.UITypes.MultiSelect:if(null===(i=e.colOptions)||void 0===i?void 0:i.options)for(const[t,a]of e.colOptions.options.entries()||[].entries())"enum"!==e.dt&&"set"!==e.dt||(a.title=a.title.trimEnd()),u.push(Object.assign(Object.assign({color:C[t%C.length]},(0,w.extractProps)(a,["title","fk_column_id","color"])),{fk_column_id:e.id,order:t+1}));else for(const[t,a]of(null===(r=e.dtxp)||void 0===r?void 0:r.split(",").entries())||[].entries())u.push({fk_column_id:e.id,title:a.replace(/^'/,"").replace(/'$/,""),order:t+1,color:C[t%C.length]});break;case s.UITypes.SingleSelect:if(null===(l=e.colOptions)||void 0===l?void 0:l.options)for(const[t,a]of e.colOptions.options.entries()||[].entries())"enum"!==e.dt&&"set"!==e.dt||(a.title=a.title.trimEnd()),u.push(Object.assign(Object.assign({color:C[t%C.length]},(0,w.extractProps)(a,["title","fk_column_id","color"])),{fk_column_id:e.id,order:t+1}));else for(const[t,a]of(null===(c=e.dtxp)||void 0===c?void 0:c.split(",").entries())||[].entries())u.push({fk_column_id:e.id,title:a.replace(/^'/,"").replace(/'$/,""),order:t+1,color:C[t%C.length]})}}for(const t of d.keys())switch(t){case s.UITypes.SingleSelect:case s.UITypes.MultiSelect:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_SELECT_OPTIONS,d.get(t));break;case s.UITypes.Lookup:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_LOOKUP,d.get(t));break;case s.UITypes.Rollup:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_ROLLUP,d.get(t));break;case s.UITypes.Links:case s.UITypes.LinkToAnotherRecord:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_RELATIONS,d.get(t));break;case s.UITypes.QrCode:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_QRCODE,d.get(t));break;case s.UITypes.Barcode:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_BARCODE,d.get(t));break;case s.UITypes.Formula:await a.bulkMetaInsert(e.workspace_id,e.base_id,S.MetaTable.COL_FORMULA,d.get(t))}}static async deleteCoverImageColumnId(e,t,a=k.default.ncMeta){const i=[],s=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.GALLERY_VIEW,{condition:{fk_cover_image_col_id:t}});for(const t of s)i.push(b.GalleryView.update(e,t.fk_view_id,{fk_cover_image_col_id:null},a));const r=await a.metaList2(e.workspace_id,e.base_id,S.MetaTable.KANBAN_VIEW,{condition:{fk_cover_image_col_id:t}});for(const t of r)i.push(b.KanbanView.update(e,t.fk_view_id,{fk_cover_image_col_id:null},a));await Promise.all(i)}}t.default=Column},92944:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=a(64612),l=a(26944),c=a(70220),d=i(a(84072)),u=a(43820);class Comment{constructor(e){Object.assign(this,e)}static async get(e,t,a=s.default.ncMeta){const i=await a.metaGet2(e.workspace_id,e.base_id,r.MetaTable.COMMENTS,t);return i&&new Comment(i)}static async list(e,{row_id:t,fk_model_id:a},i=s.default.ncMeta){return(await i.knex(r.MetaTable.COMMENTS).select(`${r.MetaTable.COMMENTS}.*`).where("row_id",t).where("fk_model_id",a).where((function(){this.whereNull("is_deleted").orWhere("is_deleted","!=",!0)})).orderBy("created_at","asc")).map((e=>new Comment(e)))}static async insert(e,t,a=s.default.ncMeta){const i=(0,c.extractProps)(t,["id","fk_model_id","row_id","comment","parent_comment_id","source_id","base_id","fk_model_id","created_by","created_by_email"]);if(i.fk_model_id||u.NcError.tableNotFound(i.fk_model_id),!i.source_id){const t=await d.default.getByIdOrName(e,{id:i.fk_model_id},a);i.source_id=t.source_id}return await a.metaInsert2(e.workspace_id,e.base_id,r.MetaTable.COMMENTS,(0,l.prepareForDb)(i))}static async update(e,t,a,i=s.default.ncMeta){const d=(0,c.extractProps)(a,["comment","resolved_by","resolved_by_email"]);return await i.metaUpdate(e.workspace_id,e.base_id,r.MetaTable.COMMENTS,(0,l.prepareForDb)(d),t),Comment.get(e,t,i)}static async resolve(e,t,a,i=s.default.ncMeta){const d=(0,c.extractProps)(a,["resolved_by","resolved_by_email"]);return await i.metaUpdate(e.workspace_id,e.base_id,r.MetaTable.COMMENTS,(0,l.prepareForDb)(d),t,{},!0),Comment.get(e,t,i)}static async delete(e,t,a=s.default.ncMeta){return await a.metaUpdate(e.workspace_id,e.base_id,r.MetaTable.COMMENTS,{is_deleted:!0},t),!0}static async deleteModelComments(e,t,a=s.default.ncMeta){return a.metaDelete(e.workspace_id,e.base_id,r.MetaTable.COMMENTS,{fk_model_id:t})}static async commentsCount(e,t){const a=await s.default.ncMeta.knex(r.MetaTable.COMMENTS).count("id",{as:"count"}).select("row_id").whereIn("row_id",t.ids).where("fk_model_id",t.fk_model_id).where((function(){this.whereNull("is_deleted").orWhere("is_deleted","!=",!0)})).groupBy("row_id");return null==a?void 0:a.map((e=>new Comment(e)))}}t.default=Comment},66191:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(26944),r=i(a(76584)),l=a(70220),c=a(64612),d=i(a(57804));class Extension{constructor(e){Object.assign(this,e)}static async get(e,t,a=r.default.ncMeta){let i=await d.default.get(`${c.CacheScope.EXTENSION}:${t}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.EXTENSIONS,t),i&&(i=(0,s.prepareForResponse)(i,["kv_store","meta"]),d.default.set(`${c.CacheScope.EXTENSION}:${t}`,i))),i&&new Extension(i)}static async list(e,t,a=r.default.ncMeta){const i=await d.default.getList(c.CacheScope.EXTENSION,[t]);let{list:l}=i;const{isNoneList:u}=i;return u||l.length||(l=await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.EXTENSIONS,{condition:{base_id:t},orderBy:{created_at:"asc"}}),l&&(l=l.map((e=>(0,s.prepareForResponse)(e,["kv_store","meta"]))),d.default.setList(c.CacheScope.EXTENSION,[t],l))),null==l?void 0:l.sort(((e,t)=>{var a,i;return(null!==(a=null==e?void 0:e.order)&&void 0!==a?a:1/0)-(null!==(i=null==t?void 0:t.order)&&void 0!==i?i:1/0)})).map((e=>new Extension(e)))}static async insert(e,t,a=r.default.ncMeta){const i=(0,l.extractProps)(t,["id","base_id","fk_user_id","extension_id","title","kv_store","meta","order"]);null!==i.order&&void 0!==i.order||(i.order=await a.metaGetNextOrder(c.MetaTable.EXTENSIONS,{base_id:i.base_id}));const{id:u}=await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.EXTENSIONS,(0,s.prepareForDb)(i,["kv_store","meta"]));return this.get(e,u,a).then((async e=>(await d.default.appendToList(c.CacheScope.EXTENSION,[t.base_id],`${c.CacheScope.EXTENSION}:${u}`),e)))}static async update(e,t,a,i=r.default.ncMeta){const u=(0,l.extractProps)(a,["fk_user_id","extension_id","title","kv_store","meta","order"]);return await i.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.EXTENSIONS,(0,s.prepareForDb)(u,["kv_store","meta"]),t),await d.default.update(`${c.CacheScope.EXTENSION}:${t}`,(0,s.prepareForResponse)(u,["kv_store","meta"])),this.get(e,t,i)}static async delete(e,t,a=r.default.ncMeta){const i=await a.metaDelete(e.workspace_id,e.base_id,c.MetaTable.EXTENSIONS,t);return await d.default.deepDel(`${c.CacheScope.EXTENSION}:${t}`,c.CacheDelDirection.CHILD_TO_PARENT),i}}t.default=Extension},76844:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=a(64612),l=a(70220);class FileReference{constructor(e){Object.assign(this,e)}static async insert(e,t,a=s.default.ncMeta){const i=(0,l.extractProps)(t,["id","storage","file_url","file_size","fk_user_id","source_id","fk_model_id","fk_column_id","is_external","deleted"]),{id:c}=await a.metaInsert2(e.workspace_id,e.base_id,r.MetaTable.FILE_REFERENCES,i);return c}static async update(e,t,a,i=s.default.ncMeta){const c=(0,l.extractProps)(a,["deleted"]);return t=Array.isArray(t)?t:[t],i.bulkMetaUpdate(e.workspace_id,e.base_id,r.MetaTable.FILE_REFERENCES,c,t)}static async delete(e,t,a=s.default.ncMeta){t=Array.isArray(t)?t:[t],await a.bulkMetaUpdate(e.workspace_id,e.base_id,r.MetaTable.FILE_REFERENCES,{deleted:!0},t)}static async bulkDelete(e,t,a=s.default.ncMeta){await a.bulkMetaUpdate(e.workspace_id,e.base_id,r.MetaTable.FILE_REFERENCES,{deleted:!0},null,t)}static async get(e,t,a=s.default.ncMeta){const i=await a.metaGet2(e.workspace_id,e.base_id,r.MetaTable.FILE_REFERENCES,t);return i&&new FileReference(i)}}t.default=FileReference},22996:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(84072)),l=i(a(57596)),c=i(a(82568)),d=i(a(70176)),u=i(a(76584)),p=a(64612),m=i(a(57804)),_=a(43820),f=a(70220);class Filter{constructor(e){Object.assign(this,e)}static castType(e){return e&&new Filter(e)}castType(e){return e&&new Filter(e)}async getModel(e,t=u.default.ncMeta){return this.fk_view_id?(await d.default.get(e,this.fk_view_id,t)).getModel(e,t):r.default.getByIdOrName(e,{id:this.fk_model_id},t)}static async insert(e,t,a=u.default.ncMeta){var i;const s=(0,f.extractProps)(t,["id","fk_view_id","fk_hook_id","fk_link_col_id","fk_value_col_id","fk_parent_column_id","fk_column_id","comparison_op","comparison_sub_op","value","fk_parent_id","is_group","logical_op","base_id","source_id","order"]),r=["fk_parent_column_id","fk_view_id","fk_hook_id","fk_link_col_id"].find((e=>t[e]));if(s.order=await a.metaGetNextOrder(p.MetaTable.FILTER_EXP,{[r]:t[r]}),!t.source_id){let i;t.fk_view_id&&!t.fk_parent_column_id?i=await d.default.get(e,t.fk_view_id,a):t.fk_hook_id?i=await c.default.get(e,t.fk_hook_id,a):t.fk_link_col_id?i=await l.default.get(e,{colId:t.fk_link_col_id},a):t.fk_parent_column_id?i=await l.default.get(e,{colId:t.fk_parent_column_id},a):t.fk_column_id?i=await l.default.get(e,{colId:t.fk_column_id},a):_.NcError.invalidFilter(JSON.stringify(t)),null!=i&&(s.source_id=i.source_id)}const m=await a.metaInsert2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,s);return(null===(i=null==t?void 0:t.children)||void 0===i?void 0:i.length)&&await Promise.all(t.children.map((i=>this.insert(e,Object.assign(Object.assign({},i),{fk_parent_id:m.id,[r]:t[r]}),a)))),await this.redisPostInsert(e,m.id,t,a)}static async redisPostInsert(e,t,a,i=u.default.ncMeta){if(!t||!(a.fk_view_id||a.fk_hook_id||a.fk_parent_column_id))throw new Error(`Mandatory fields missing in FILTER_EXP cache population : id(${t}), fk_view_id(${a.fk_view_id}), fk_hook_id(${a.fk_hook_id}), fk_parent_column_id(${a.fk_parent_column_id})`);const s=`${p.CacheScope.FILTER_EXP}:${t}`;let r=await m.default.get(s,p.CacheGetType.TYPE_OBJECT);if(r||(r=await i.metaGet2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,t),await m.default.set(s,r).then((async()=>{const e=[];a.fk_view_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_view_id],s)),a.fk_hook_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_hook_id],s)),a.fk_parent_column_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_parent_column_id],s)),a.fk_parent_id&&(a.fk_view_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_view_id,a.fk_parent_id],s)),a.fk_hook_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_hook_id,a.fk_parent_id],s)),a.fk_parent_column_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_parent_column_id,a.fk_parent_id],s)),e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_parent_id],s))),a.fk_column_id&&e.push(m.default.appendToList(p.CacheScope.FILTER_EXP,[a.fk_column_id],s)),await Promise.all(e)}))),a.fk_view_id){const t=await d.default.get(e,a.fk_view_id,i);await d.default.clearSingleQueryCache(e,t.fk_model_id,[t],i)}return this.castType(r)}static async update(e,t,a,i=u.default.ncMeta){const s=(0,f.extractProps)(a,["fk_column_id","comparison_op","comparison_sub_op","value","fk_parent_id","is_group","logical_op","fk_value_col_id"]);"string"==typeof s.value&&(s.value=s.value.slice(0,255));const r=await i.metaUpdate(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,s,t);await m.default.update(`${p.CacheScope.FILTER_EXP}:${t}`,s);{const a=await this.get(e,t,i);if(a.fk_view_id){const t=await d.default.get(e,a.fk_view_id,i);await d.default.clearSingleQueryCache(e,t.fk_model_id,[{id:a.fk_view_id}],i)}}return r}static async delete(e,t,a=u.default.ncMeta){const i=await this.get(e,t,a),s=async t=>{if(t){for(const i of await(null==t?void 0:t.getChildren(e,a))||[])await s(i);await a.metaDelete(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,t.id),await m.default.deepDel(`${p.CacheScope.FILTER_EXP}:${t.id}`,p.CacheDelDirection.CHILD_TO_PARENT)}};if(await s(i),i.fk_view_id){const t=await d.default.get(e,i.fk_view_id,a);await d.default.clearSingleQueryCache(e,t.fk_model_id,[{id:i.fk_view_id}],a)}}getColumn(e,t=u.default.ncMeta){return this.fk_column_id?l.default.get(e,{colId:this.fk_column_id},t):null}async getGroup(e,t=u.default.ncMeta){if(!this.fk_parent_id)return null;let a=await m.default.get(`${p.CacheScope.FILTER_EXP}:${this.fk_parent_id}`,2);return a||(a=await t.metaGet2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{id:this.fk_parent_id}),await m.default.set(`${p.CacheScope.FILTER_EXP}:${this.fk_parent_id}`,a)),this.castType(a)}async getChildren(e,t=u.default.ncMeta){if(this.children)return this.children;if(!this.is_group)return null;const a=await m.default.getList(p.CacheScope.FILTER_EXP,[this.id],{key:"order"});let{list:i}=a;const{isNoneList:s}=a;return s||i.length||(i=await t.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_parent_id:this.id},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[this.id],i)),i&&i.map((e=>this.castType(e)))}static async getFilterObject(e,{viewId:t,hookId:a,linkColId:i,parentColId:r},l=u.default.ncMeta){var c;const d=await m.default.getList(p.CacheScope.FILTER_EXP,[r||t||a||i],{key:"order"});let{list:_}=d;const{isNoneList:f}=d;if(!f&&!_.length){const s={};t&&!r?s.fk_view_id=t:a?s.fk_hook_id=a:i?s.fk_link_col_id=i:r&&(s.fk_parent_column_id=r),_=await l.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:s,orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[r||t||a||i],_)}const h={is_group:!0,children:[],logical_op:"and"},g={},y={};for(const t of _)t._fk_parent_id?(g[t._fk_parent_id]=g[t._fk_parent_id]||[],g[t._fk_parent_id].push(t),y[t.id]=t,t.column=await new Filter(t).getColumn(e,l),null===(c=t.column)||void 0===c||c.uidt,s.UITypes.LinkToAnotherRecord):(h.children.push(t),y[h.id]=h);for(const[e,t]of Object.entries(g))(null==y?void 0:y[e])&&(y[e].children=t);return h}static async deleteAll(e,t,a=u.default.ncMeta){const i=await this.getFilterObject(e,{viewId:t},a),s=async t=>{if(t){for(const e of(null==t?void 0:t.children)||[])await s(e);t.id&&(await a.metaDelete(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,t.id),await m.default.deepDel(`${p.CacheScope.FILTER_EXP}:${t.id}`,p.CacheDelDirection.CHILD_TO_PARENT))}};await s(i);{const i=await d.default.get(e,t,a);await d.default.clearSingleQueryCache(e,i.fk_model_id,[i],a)}}static async deleteAllByHook(e,t,a=u.default.ncMeta){const i=await this.getFilterObject(e,{hookId:t},a),s=async t=>{if(t){for(const e of(null==t?void 0:t.children)||[])await s(e);t.id&&(await a.metaDelete(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,t.id),await m.default.deepDel(`${p.CacheScope.FILTER_EXP}:${t.id}`,p.CacheDelDirection.CHILD_TO_PARENT))}};await s(i)}static async deleteAllByParentColumn(e,t,a=u.default.ncMeta){const i=await this.getFilterObject(e,{parentColId:t},a),s=async t=>{if(t){for(const e of(null==t?void 0:t.children)||[])await s(e);t.id&&(await a.metaDelete(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,t.id),await m.default.deepDel(`${p.CacheScope.FILTER_EXP}:${t.id}`,p.CacheDelDirection.CHILD_TO_PARENT))}};await s(i)}static async get(e,t,a=u.default.ncMeta){let i=t&&await m.default.get(`${p.CacheScope.FILTER_EXP}:${t}`,p.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{id:t}),await m.default.set(`${p.CacheScope.FILTER_EXP}:${t}`,i)),this.castType(i)}static async allViewFilterList(e,{viewId:t},a=u.default.ncMeta){const i=await m.default.getList(p.CacheScope.FILTER_EXP,[t]);let{list:s}=i;const{isNoneList:r}=i;return r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_view_id:t}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t],s)),(null==s?void 0:s.map((e=>this.castType(e))))||[]}static async rootFilterList(e,{viewId:t},a=u.default.ncMeta){var i;const s=await m.default.getList(p.CacheScope.FILTER_EXP,[t],{key:"order"});let{list:r}=s;const{isNoneList:l}=s;return l||r.length||(r=await a.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t],r)),null===(i=null==r?void 0:r.filter((e=>!e.fk_parent_id)))||void 0===i?void 0:i.map((e=>this.castType(e)))}static async rootFilterListByHook(e,{hookId:t},a=u.default.ncMeta){var i;const s=await m.default.getList(p.CacheScope.FILTER_EXP,[t],{key:"order"});let{list:r}=s;const{isNoneList:l}=s;return l||r.length||(r=await a.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_hook_id:t},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t],r)),null===(i=null==r?void 0:r.filter((e=>!e.fk_parent_id)))||void 0===i?void 0:i.map((e=>this.castType(e)))}static async rootFilterListByParentColumn(e,{parentColId:t},a=u.default.ncMeta){var i;const s=await m.default.getList(p.CacheScope.FILTER_EXP,[t],{key:"order"});let{list:r}=s;const{isNoneList:l}=s;return l||r.length||(r=await a.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_parent_column_id:t},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t],r)),null===(i=null==r?void 0:r.filter((e=>!e.fk_parent_id)))||void 0===i?void 0:i.map((e=>this.castType(e)))}static async parentFilterList(e,{parentId:t},a=u.default.ncMeta){const i=await m.default.getList(p.CacheScope.FILTER_EXP,[t],{key:"order"});let{list:s}=i;const{isNoneList:r}=i;return r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_parent_id:t},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t],s)),null==s?void 0:s.map((e=>this.castType(e)))}static async parentFilterListByHook(e,{hookId:t,parentId:a},i=u.default.ncMeta){const s=await m.default.getList(p.CacheScope.FILTER_EXP,[t,a],{key:"order"});let{list:r}=s;const{isNoneList:l}=s;return l||r.length||(r=await i.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_parent_id:a,fk_hook_id:t},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t,a],r)),null==r?void 0:r.map((e=>this.castType(e)))}static async parentFilterListByParentColumn(e,{parentColId:t,parentId:a},i=u.default.ncMeta){const s=await m.default.getList(p.CacheScope.FILTER_EXP,[t,a],{key:"order"});let{list:r}=s;const{isNoneList:l}=s;return l||r.length||(r=await i.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{fk_parent_id:a,fk_parent_column_id:t},orderBy:{order:"asc"}}),await m.default.setList(p.CacheScope.FILTER_EXP,[t,a],r)),null==r?void 0:r.map((e=>this.castType(e)))}static async hasEmptyOrNullFilters(e,t,a=u.default.ncMeta){return(await a.metaList2(e.workspace_id,e.base_id,p.MetaTable.FILTER_EXP,{condition:{base_id:t},xcCondition:{_or:[{comparison_op:{eq:"null"}},{comparison_op:{eq:"notnull"}},{comparison_op:{eq:"empty"}},{comparison_op:{eq:"notempty"}}]}})).length>0}static async rootFilterListByLink(e,{columnId:t},a=u.default.ncMeta){return[]}}t.default=Filter},18716:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(19684),r=i(a(95240)),l=i(a(70176)),c=a(70220),d=i(a(57804)),u=i(a(76584)),p=a(71956),m=a(64612),_=a(26944);class FormView{constructor(e){Object.assign(this,e)}static async get(e,t,a=u.default.ncMeta){let i=t&&await d.default.get(`${m.CacheScope.FORM_VIEW}:${t}`,m.CacheGetType.TYPE_OBJECT);i||(i=await a.metaGet2(e.workspace_id,e.base_id,m.MetaTable.FORM_VIEW,{fk_view_id:t}),i&&(i.meta=(0,p.deserializeJSON)(i.meta),await d.default.set(`${m.CacheScope.FORM_VIEW}:${t}`,i)));const s=await this.convertAttachmentType({banner_image_url:null==i?void 0:i.banner_image_url,logo_url:null==i?void 0:i.logo_url},a);return i.banner_image_url=s.banner_image_url||null,i.logo_url=s.logo_url||null,i&&new FormView(i)}static async insert(e,t,a=u.default.ncMeta){const i=(0,c.extractProps)(t,["fk_view_id","base_id","source_id","heading","subheading","success_msg","redirect_url","redirect_after_secs","email","banner_image_url","logo_url","submit_another_form","show_blank_form","meta"]);i.meta&&(i.meta=(0,p.serializeJSON)(i.meta)),(null==i?void 0:i.logo_url)&&(i.logo_url=this.serializeAttachmentJSON(i.logo_url)),(null==i?void 0:i.banner_image_url)&&(i.banner_image_url=this.serializeAttachmentJSON(i.banner_image_url));const s=await l.default.get(e,t.fk_view_id,a);return t.source_id||(i.source_id=s.source_id),await a.metaInsert2(e.workspace_id,e.base_id,m.MetaTable.FORM_VIEW,i,!0),this.get(e,t.fk_view_id,a)}static async update(e,t,a,i=u.default.ncMeta){const s=(0,c.extractProps)(a,["heading","subheading","success_msg","redirect_url","redirect_after_secs","email","banner_image_url","logo_url","submit_another_form","show_blank_form","meta"]);(null==s?void 0:s.logo_url)&&(s.logo_url=this.serializeAttachmentJSON(s.logo_url)),(null==s?void 0:s.banner_image_url)&&(s.banner_image_url=this.serializeAttachmentJSON(s.banner_image_url));const r=await i.metaUpdate(e.workspace_id,e.base_id,m.MetaTable.FORM_VIEW,(0,_.prepareForDb)(s),{fk_view_id:t});return await d.default.update(`${m.CacheScope.FORM_VIEW}:${t}`,(0,_.prepareForResponse)(s)),r}async getColumns(e,t=u.default.ncMeta){return this.columns=await r.default.list(e,this.fk_view_id,t)}static async getWithInfo(e,t,a=u.default.ncMeta){const i=await this.get(e,t,a);return await i.getColumns(e,a),i}static serializeAttachmentJSON(e){return e?(0,p.serializeJSON)((0,c.extractProps)((0,p.deserializeJSON)(e),["url","path","title","mimetype","size","icon"])):e}static async convertAttachmentType(e,t=u.default.ncMeta){try{if(e){const a=[];for(const i in e)e[i]&&"string"==typeof e[i]&&(e[i]=(0,p.deserializeJSON)(e[i])),a.push(s.PresignedUrl.signAttachment({attachment:e[i]},t));await Promise.all(a)}}catch(e){}return e}}t.default=FormView},95240:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=i(a(57804)),c=a(70220),d=a(71956),u=a(64612),p=a(26944);class FormViewColumn{constructor(e){Object.assign(this,e)}static async get(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${u.CacheScope.FORM_VIEW_COLUMN}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.FORM_VIEW_COLUMNS,t),i.meta=i.meta&&"string"==typeof i.meta?JSON.parse(i.meta):i.meta,await l.default.set(`${u.CacheScope.FORM_VIEW_COLUMN}:${t}`,i)),i&&new FormViewColumn(i)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_view_id","fk_column_id","show","base_id","source_id","label","help","description","required","enable_scanner","meta"]);i.order=await a.metaGetNextOrder(u.MetaTable.FORM_VIEW_COLUMNS,{fk_view_id:i.fk_view_id}),i.meta&&(i.meta=(0,d.serializeJSON)(i.meta));const p=await s.default.get(e,i.fk_view_id,a);i.source_id||(i.source_id=p.source_id);const{id:m}=await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.FORM_VIEW_COLUMNS,i);return this.get(e,m,a).then((async e=>(await l.default.appendToList(u.CacheScope.FORM_VIEW_COLUMN,[t.fk_view_id],`${u.CacheScope.FORM_VIEW_COLUMN}:${m}`),e)))}static async list(e,t,a=r.default.ncMeta){const i=await l.default.getList(u.CacheScope.FORM_VIEW_COLUMN,[t]);let{list:s}=i;const{isNoneList:c}=i;if(!c&&!s.length){s=await a.metaList2(e.workspace_id,e.base_id,u.MetaTable.FORM_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}});for(const e of s)e.meta=(0,d.deserializeJSON)(e.meta);await l.default.setList(u.CacheScope.FORM_VIEW_COLUMN,[t],s)}return s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new FormViewColumn(e)))}static async update(e,t,a,i=r.default.ncMeta){const s=(0,c.extractProps)(a,["label","help","description","required","show","order","meta","enable_scanner"]),d=await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.FORM_VIEW_COLUMNS,(0,p.prepareForDb)(s),t);return await l.default.update(`${u.CacheScope.FORM_VIEW_COLUMN}:${t}`,(0,p.prepareForResponse)(s)),d}}t.default=FormViewColumn},84748:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(a(76584)),l=s(a(57804)),c=a(70220),d=a(64612),u=a(26944);class FormulaColumn{constructor(e){const{parsed_tree:t}=e,a=i(e,["parsed_tree"]);this.parsed_tree=t,Object.assign(this,a)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_column_id","formula_raw","formula","error","parsed_tree"]);return i.parsed_tree=(0,u.stringifyMetaProp)(i,"parsed_tree"),await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.COL_FORMULA,i),this.read(e,t.fk_column_id,a)}static async read(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.COL_FORMULA}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.COL_FORMULA,{fk_column_id:t}),i&&(i.parsed_tree=(0,u.parseMetaProp)(i,"parsed_tree"),await l.default.set(`${d.CacheScope.COL_FORMULA}:${t}`,i))),i?new FormulaColumn(i):null}static async update(e,t,a,i=r.default.ncMeta){const s=(0,c.extractProps)(a,["formula","formula_raw","fk_column_id","error","parsed_tree"]);"parsed_tree"in s&&(s.parsed_tree=(0,u.stringifyMetaProp)(s,"parsed_tree")),await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.COL_FORMULA,s,{fk_column_id:t}),await l.default.update(`${d.CacheScope.COL_FORMULA}:${t}`,s)}getParsedTree(){return this.parsed_tree}}t.default=FormulaColumn},39944:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(70176)),l=i(a(76584)),c=i(a(57804)),d=a(70220),u=a(64612),p=a(26944);class GalleryView{constructor(e){Object.assign(this,e)}static async get(e,t,a=l.default.ncMeta){let i=t&&await c.default.get(`${u.CacheScope.GALLERY_VIEW}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.GALLERY_VIEW,{fk_view_id:t}),await c.default.set(`${u.CacheScope.GALLERY_VIEW}:${t}`,i)),i&&new GalleryView(i)}static async insert(e,t,a=l.default.ncMeta){var i,c;const m=await r.default.get(e,t.fk_view_id,a).then((t=>null==t?void 0:t.getModel(e,a))).then((t=>t.getColumns(e,a))),_=(0,d.extractProps)(t,["base_id","source_id","fk_view_id","next_enabled","prev_enabled","cover_image_idx","cover_image","restrict_types","restrict_size","restrict_number","meta"]);_.fk_cover_image_col_id=void 0!==(null==t?void 0:t.fk_cover_image_col_id)?null==t?void 0:t.fk_cover_image_col_id:null===(i=null==m?void 0:m.find((e=>e.uidt===s.UITypes.Attachment)))||void 0===i?void 0:i.id,_.meta={fk_cover_image_object_fit:(null===(c=(0,p.parseMetaProp)(_))||void 0===c?void 0:c.fk_cover_image_object_fit)||"fit"},_.meta=(0,p.stringifyMetaProp)(_);const f=await r.default.get(e,_.fk_view_id,a);return _.source_id||(_.source_id=f.source_id),await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.GALLERY_VIEW,_,!0),this.get(e,t.fk_view_id,a)}static async update(e,t,a,i=l.default.ncMeta){const s=(0,d.extractProps)(a,["fk_cover_image_col_id","meta"]),m=await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.GALLERY_VIEW,(0,p.prepareForDb)(s),{fk_view_id:t});await c.default.update(`${u.CacheScope.GALLERY_VIEW}:${t}`,(0,p.prepareForResponse)(s));const _=await r.default.get(e,t,i);return await r.default.clearSingleQueryCache(e,_.fk_model_id,[{id:t}],i),m}}t.default=GalleryView},56648:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=i(a(57804)),c=a(70220),d=a(64612);class GalleryViewColumn{constructor(e){Object.assign(this,e)}static async get(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.GALLERY_VIEW_COLUMN}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.GALLERY_VIEW_COLUMNS,t),await l.default.set(`${d.CacheScope.GALLERY_VIEW_COLUMN}:${t}`,i)),i&&new GalleryViewColumn(i)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_view_id","fk_column_id","show","base_id","source_id"]);i.order=await a.metaGetNextOrder(d.MetaTable.GALLERY_VIEW_COLUMNS,{fk_view_id:t.fk_view_id});const u=await s.default.get(e,i.fk_view_id,a);i.source_id||(i.source_id=u.source_id);const{id:p}=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.GALLERY_VIEW_COLUMNS,i);{const i=await s.default.get(e,t.fk_view_id,a);await s.default.clearSingleQueryCache(e,i.fk_model_id,[i],a)}return this.get(e,p,a).then((async e=>(await l.default.appendToList(d.CacheScope.GALLERY_VIEW_COLUMN,[t.fk_view_id],`${d.CacheScope.GALLERY_VIEW_COLUMN}:${p}`),e)))}static async list(e,t,a=r.default.ncMeta){const i=await l.default.getList(d.CacheScope.GALLERY_VIEW_COLUMN,[t]);let{list:s}=i;const{isNoneList:c}=i;return c||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,d.MetaTable.GALLERY_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),await l.default.setList(d.CacheScope.GALLERY_VIEW_COLUMN,[t],s)),s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new GalleryViewColumn(e)))}static async update(e,t,a,i=r.default.ncMeta){const u=(0,c.extractProps)(a,["order","show"]),p=await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.GALLERY_VIEW_COLUMNS,u,t),m=`${d.CacheScope.GALLERY_VIEW_COLUMN}:${t}`;await l.default.update(m,u);{const a=await this.get(e,t,i),r=await s.default.get(e,a.fk_view_id,i);await s.default.clearSingleQueryCache(e,r.fk_model_id,[r])}return p}}t.default=GalleryViewColumn},66044:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(92760)),r=i(a(70176)),l=i(a(76584)),c=i(a(57804)),d=a(70220),u=a(64612),p=a(26944);class GridView{constructor(e){Object.assign(this,e)}async getColumns(e){return this.columns=await s.default.list(e,this.fk_view_id)}static async get(e,t,a=l.default.ncMeta){let i=t&&await c.default.get(`${u.CacheScope.GRID_VIEW}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.GRID_VIEW,{fk_view_id:t}),await c.default.set(`${u.CacheScope.GRID_VIEW}:${t}`,i)),i&&new GridView(i)}static async insert(e,t,a=l.default.ncMeta){const i=(0,d.extractProps)(t,["fk_view_id","base_id","source_id","row_height"]),s=await r.default.get(e,i.fk_view_id,a);return i.source_id||(i.source_id=s.source_id),await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.GRID_VIEW,i,!0),this.get(e,t.fk_view_id,a)}static async getWithInfo(e,t,a=l.default.ncMeta){return await this.get(e,t,a)}static async update(e,t,a,i=l.default.ncMeta){const s=(0,d.extractProps)(a,["row_height","meta"]),r=await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.GRID_VIEW,(0,p.prepareForDb)(s),{fk_view_id:t});return await c.default.update(`${u.CacheScope.GRID_VIEW}:${t}`,(0,p.prepareForResponse)(s)),r}}t.default=GridView},92760:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=a(70220),c=i(a(57804)),d=a(64612);class GridViewColumn{constructor(e){Object.assign(this,e)}static async list(e,t,a=r.default.ncMeta){const i=await c.default.getList(d.CacheScope.GRID_VIEW_COLUMN,[t]);let{list:s}=i;const{isNoneList:l}=i;return l||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,d.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),await c.default.setList(d.CacheScope.GRID_VIEW_COLUMN,[t],s)),s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new GridViewColumn(e)))}static async get(e,t,a=r.default.ncMeta){let i=t&&await c.default.get(`${d.CacheScope.GRID_VIEW_COLUMN}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.GRID_VIEW_COLUMNS,t),await c.default.set(`${d.CacheScope.GRID_VIEW_COLUMN}:${t}`,i)),i&&new GridViewColumn(i)}static async insert(e,t,a=r.default.ncMeta){var i,u;const p=(0,l.extractProps)(t,["fk_view_id","fk_column_id","show","base_id","source_id","order","width","group_by","group_by_order","group_by_sort"]);p.order=null!==(i=null==t?void 0:t.order)&&void 0!==i?i:await a.metaGetNextOrder(d.MetaTable.GRID_VIEW_COLUMNS,{fk_view_id:t.fk_view_id});const m=await s.default.get(e,p.fk_view_id,a);p.source_id||(p.source_id=m.source_id),p.width=null!==(u=null==t?void 0:t.width)&&void 0!==u?u:"180px";const{id:_}=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.GRID_VIEW_COLUMNS,p);await s.default.fixPVColumnForView(e,t.fk_view_id,a);{const i=await s.default.get(e,t.fk_view_id,a);await s.default.clearSingleQueryCache(e,i.fk_model_id,[i],a)}return this.get(e,_,a).then((async e=>(await c.default.appendToList(d.CacheScope.GRID_VIEW_COLUMN,[t.fk_view_id],`${d.CacheScope.GRID_VIEW_COLUMN}:${_}`),e)))}static async update(e,t,a,i=r.default.ncMeta){const u=(0,l.extractProps)(a,["order","show","width","group_by","group_by_order","group_by_sort","aggregation"]),p=await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.GRID_VIEW_COLUMNS,u,t);await c.default.update(`${d.CacheScope.GRID_VIEW_COLUMN}:${t}`,u);{const a=await this.get(e,t,i),r=await s.default.get(e,a.fk_view_id,i);await s.default.clearSingleQueryCache(e,r.fk_model_id,[r],i)}return p}}t.default=GridViewColumn},82568:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(84072)),r=i(a(22996)),l=i(a(50732)),c=a(64612),d=i(a(76584)),u=i(a(57804)),p=a(70220),m=a(43820);class Hook{constructor(e){Object.assign(this,e)}static async get(e,t,a=d.default.ncMeta){let i=t&&await u.default.get(`${c.CacheScope.HOOK}:${t}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.HOOKS,t),await u.default.set(`${c.CacheScope.HOOK}:${t}`,i)),i&&new Hook(i)}async getFilters(e,t=d.default.ncMeta){return await r.default.rootFilterListByHook(e,{hookId:this.id},t)}static async list(e,t,a=d.default.ncMeta){const i=await u.default.getList(c.CacheScope.HOOK,[t.fk_model_id]);let{list:s}=i;const{isNoneList:r}=i;return r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.HOOKS,{condition:{fk_model_id:t.fk_model_id},orderBy:{created_at:"asc"}}),await u.default.setList(c.CacheScope.HOOK,[t.fk_model_id],s)),t.event&&(s=s.filter((e=>{var a,i;return(null===(a=e.event)||void 0===a?void 0:a.toLowerCase())===(null===(i=t.event)||void 0===i?void 0:i.toLowerCase())}))),t.operation&&(s=s.filter((e=>{var a,i;return(null===(a=e.operation)||void 0===a?void 0:a.toLowerCase())===(null===(i=t.operation)||void 0===i?void 0:i.toLowerCase())}))),null==s?void 0:s.map((e=>new Hook(e)))}static async insert(e,t,a=d.default.ncMeta){const i=(0,p.extractProps)(t,["fk_model_id","title","description","env","type","event","operation","async","url","headers","condition","notification","retries","retry_interval","timeout","active","base_id","source_id"]);i.notification&&"object"==typeof i.notification&&(i.notification=JSON.stringify(i.notification));const r=await s.default.getByIdOrName(e,{id:t.fk_model_id},a);i.source_id||(i.source_id=r.source_id),i.version="v2";const{id:l}=await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.HOOKS,i);return this.get(e,l,a).then((async e=>(await u.default.appendToList(c.CacheScope.HOOK,[e.fk_model_id],`${c.CacheScope.HOOK}:${l}`),e)))}static async update(e,t,a,i=d.default.ncMeta){const s=(0,p.extractProps)(a,["title","description","env","type","event","operation","async","payload","url","headers","condition","notification","retries","retry_interval","timeout","active","version"]);return s.version&&s.operation&&"v1"===s.version&&["bulkInsert","bulkUpdate","bulkDelete"].includes(s.operation)&&m.NcError.badRequest(`${s.operation} not supported in v1 hook`),s.notification&&"object"==typeof s.notification&&(s.notification=JSON.stringify(s.notification)),await i.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.HOOKS,s,t),await u.default.update(`${c.CacheScope.HOOK}:${t}`,s),this.get(e,t,i)}static async delete(e,t,a=d.default.ncMeta){const i=await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.FILTER_EXP,{condition:{fk_hook_id:t}});for(const t of i)await u.default.deepDel(`${c.CacheScope.FILTER_EXP}:${t.id}`,c.CacheDelDirection.CHILD_TO_PARENT),await l.default.delete(e,t.id,a);return await u.default.deepDel(`${c.CacheScope.HOOK}:${t}`,c.CacheDelDirection.CHILD_TO_PARENT),await a.metaDelete(e.workspace_id,e.base_id,c.MetaTable.HOOKS,t)}static async hookUsages(e,t,a=d.default.ncMeta){return await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.COL_BUTTON,{condition:{fk_webhook_id:t}})}}t.default=Hook},50732:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(84072)),l=i(a(57596)),c=i(a(70176)),d=i(a(76584)),u=a(64612),p=i(a(57804)),m=a(70220);class Filter{constructor(e){Object.assign(this,e)}async getModel(e,t=d.default.ncMeta){return this.fk_view_id?(await c.default.get(e,this.fk_view_id,t)).getModel(e,t):r.default.getByIdOrName(e,{id:this.fk_model_id},t)}static async insert(e,t,a=d.default.ncMeta){var i;const s=(0,m.extractProps)(t,["id","fk_view_id","fk_column_id","comparison_op","value","fk_parent_id","is_group","logical_op","base_id","source_id"]),r=await l.default.get(e,{colId:t.fk_column_id},a);t.source_id||(s.source_id=r.source_id);const c=await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,s);return(null===(i=null==t?void 0:t.children)||void 0===i?void 0:i.length)&&await Promise.all(t.children.map((t=>this.insert(e,Object.assign(Object.assign({},t),{fk_parent_id:c.id}),a)))),await this.redisPostInsert(e,c.id,t,a)}static async redisPostInsert(e,t,a,i=d.default.ncMeta){if(!t||!a.fk_view_id)throw new Error(`Mandatory fields missing in FILTER_EXP cache population : id(${t}), fk_view_id(${a.fk_view_id}), fk_parent_id(${a.fk_view_id})`);const s=`${u.CacheScope.FILTER_EXP}:${t}`;let r=await p.default.get(s,u.CacheGetType.TYPE_OBJECT);return r||(r=await i.metaGet2(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,t),await p.default.set(s,r).then((async()=>{const e=[];e.push(p.default.appendToList(u.CacheScope.FILTER_EXP,[a.fk_view_id],s)),a.fk_parent_id&&(e.push(p.default.appendToList(u.CacheScope.FILTER_EXP,[a.fk_view_id,a.fk_parent_id],s)),e.push(p.default.appendToList(u.CacheScope.FILTER_EXP,[a.fk_parent_id],s))),a.fk_column_id&&e.push(p.default.appendToList(u.CacheScope.FILTER_EXP,[a.fk_column_id],s)),await Promise.all(e)}))),new Filter(r)}static async update(e,t,a,i=d.default.ncMeta){const s=(0,m.extractProps)(a,["fk_column_id","comparison_op","value","fk_parent_id","is_group","logical_op"]);await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,s,t),await p.default.update(`${u.CacheScope.FILTER_EXP}:${t}`,s)}static async delete(e,t,a=d.default.ncMeta){const i=await this.get(e,t,a),s=async t=>{if(t){for(const i of await(null==t?void 0:t.getChildren(e,a))||[])await s(i);await a.metaDelete(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,t.id),await p.default.deepDel(`${u.CacheScope.FILTER_EXP}:${t.id}`,u.CacheDelDirection.CHILD_TO_PARENT)}};await s(i)}getColumn(e,t=d.default.ncMeta){return this.fk_column_id?l.default.get(e,{colId:this.fk_column_id},t):null}async getChildren(e,t=d.default.ncMeta){if(this.children)return this.children;if(!this.is_group)return null;const a=await p.default.getList(u.CacheScope.FILTER_EXP,[this.id],{key:"order"});let{list:i}=a;const{isNoneList:s}=a;return s||i.length||(i=await t.metaList2(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,{condition:{fk_parent_id:this.id}}),await p.default.setList(u.CacheScope.FILTER_EXP,[this.id],i)),i&&i.map((e=>new Filter(e)))}static async getFilterObject(e,{viewId:t},a=d.default.ncMeta){var i;const r=await p.default.getList(u.CacheScope.FILTER_EXP,[t],{key:"order"});let{list:l}=r;const{isNoneList:c}=r;c||l.length||(l=await a.metaList2(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,{condition:{fk_view_id:t}}),await p.default.setList(u.CacheScope.FILTER_EXP,[t],l));const m={is_group:!0,children:[],logical_op:"and"},_={},f={};for(const t of l)t._fk_parent_id?(_[t._fk_parent_id]=_[t._fk_parent_id]||[],_[t._fk_parent_id].push(t),f[t.id]=t,t.column=await new Filter(t).getColumn(e,a),null===(i=t.column)||void 0===i||i.uidt,s.UITypes.LinkToAnotherRecord):(m.children.push(t),f[m.id]=m);for(const[e,t]of Object.entries(_))(null==f?void 0:f[e])&&(f[e].children=t);return m}static async get(e,t,a=d.default.ncMeta){let i=t&&await p.default.get(`${u.CacheScope.FILTER_EXP}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,{id:t}),await p.default.set(`${u.CacheScope.FILTER_EXP}:${t}`,i)),i&&new Filter(i)}static async rootFilterList(e,{viewId:t},a=d.default.ncMeta){const i=await p.default.getList(u.CacheScope.FILTER_EXP,[t],{key:"order"});let{list:s}=i;const{isNoneList:r}=i;return r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,u.MetaTable.FILTER_EXP,{condition:{fk_view_id:t}}),await p.default.setList(u.CacheScope.FILTER_EXP,[t],s)),null==s?void 0:s.map((e=>new Filter(e)))}}t.default=Filter},76072:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(82568)),r=i(a(76584)),l=a(70220),c=a(64612);class HookLog{constructor(e){Object.assign(this,e)}static async list(e,t,{limit:a=25,offset:i=0},s=r.default.ncMeta){const l=await s.metaList2(e.workspace_id,e.base_id,c.MetaTable.HOOK_LOGS,Object.assign(Object.assign({condition:{fk_hook_id:t.fk_hook_id}},"ERROR"===process.env.NC_AUTOMATION_LOG_LEVEL&&{xcCondition:{error_message:{neq:null}}}),{orderBy:{created_at:"desc"},limit:a,offset:i}));return null==l?void 0:l.map((e=>new HookLog(e)))}static async insert(e,t,a=r.default.ncMeta){if("OFF"===process.env.NC_AUTOMATION_LOG_LEVEL)return;const i=(0,l.extractProps)(t,["source_id","base_id","fk_hook_id","type","event","operation","test_call","payload","conditions","notification","error_code","error_message","error","execution_time","response","triggered_by"]),d=await s.default.get(e,t.fk_hook_id,a);return t.source_id||(i.source_id=d.source_id),"object"==typeof i.notification&&(i.notification=JSON.stringify(i.notification)),i.execution_time=parseInt(i.execution_time)||0,await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.HOOK_LOGS,i)}static async count(e,{hookId:t},a=r.default.ncMeta){var i,s;const l=a.knex(c.MetaTable.HOOK_LOGS);return t&&l.where(`${c.MetaTable.HOOK_LOGS}.fk_hook_id`,t),"ERROR"===process.env.NC_AUTOMATION_LOG_LEVEL&&l.whereNotNull(`${c.MetaTable.HOOK_LOGS}.error_message`),null!==(s=null===(i=await l.count("id",{as:"count"}).first())||void 0===i?void 0:i.count)&&void 0!==s?s:0}}t.default=HookLog},78076:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(64612),r=i(a(76584)),l=a(70220),c=a(43820),d=a(26944),u=a(62304),p=a(99572);class Integration{constructor(e){Object.assign(this,e)}static castType(e){return e&&new Integration(e)}static encryptConfigIfRequired(e){e.config=(0,u.encryptPropIfRequired)({data:e}),e.is_encrypted=(0,u.isEncryptionRequired)()}static async createIntegration(e,t=r.default.ncMeta){const a=(0,l.extractProps)(e,["title","config","type","sub_type","enabled","meta","created_by","is_private","is_encrypted"]);this.encryptConfigIfRequired(a),"meta"in a&&(a.meta=(0,d.stringifyMetaProp)(a)),e.workspaceId&&(a.fk_workspace_id=a.fk_workspace_id||e.workspaceId),a.order=await t.metaGetNextOrder(s.MetaTable.INTEGRATIONS,a.fk_workspace_id?{fk_workspace_id:a.fk_workspace_id}:{});const{id:i}=await t.metaInsert2(a.fk_workspace_id,s.RootScopes.WORKSPACE,s.MetaTable.INTEGRATIONS,a);return await this.get({workspace_id:a.fk_workspace_id},i,!1,t)}static async updateIntegration(e,t,a,i=r.default.ncMeta){const p=await Integration.get(e,t,!1,i);p||c.NcError.integrationNotFound(t);const m=(0,l.extractProps)(a,["title","type","sub_type","order","enabled","meta","deleted","config","is_private","is_encrypted"]);m.config&&(m.config=(0,u.encryptPropIfRequired)({data:m}),m.is_encrypted=(0,u.isEncryptionRequired)(),this.encryptConfigIfRequired(m)),m.type||(m.type=p.type),"meta"in m&&(m.meta=(0,d.stringifyMetaProp)(m)),p.order||m.order||m.order<=1&&(m.order=2),await i.metaUpdate(e.workspace_id,s.RootScopes.WORKSPACE,s.MetaTable.INTEGRATIONS,(0,d.prepareForDb)(m),p.id);return await this.get(e,p.id,!1,i)}static async list(e,t=r.default.ncMeta){var a;const{offset:i}=e;let{limit:l}=e;void 0===i||l||(l=25);const c=t.knex(s.MetaTable.INTEGRATIONS);c.where((t=>{t.where(`${s.MetaTable.INTEGRATIONS}.is_private`,!1).orWhereNull(`${s.MetaTable.INTEGRATIONS}.is_private`).orWhere(`${s.MetaTable.INTEGRATIONS}.created_by`,e.userId)})),e.type&&c.where(`${s.MetaTable.INTEGRATIONS}.type`,e.type),e.sub_type&&c.where(`${s.MetaTable.INTEGRATIONS}.sub_type`,e.sub_type),c.where((e=>{e.where(`${s.MetaTable.INTEGRATIONS}.deleted`,!1).orWhereNull(`${s.MetaTable.INTEGRATIONS}.deleted`)})),e.query&&c.where(`${s.MetaTable.INTEGRATIONS}.title`,"like",`%${e.query}%`);const m=c.clone();e.includeSourceCount&&m.select(`${s.MetaTable.INTEGRATIONS}.*`,t.knex.raw(`count(${s.MetaTable.SOURCES}.id) as source_count`)).leftJoin(s.MetaTable.SOURCES,`${s.MetaTable.INTEGRATIONS}.id`,`${s.MetaTable.SOURCES}.fk_integration_id`).groupBy(`${s.MetaTable.INTEGRATIONS}.id`);const _=await m.limit(l).offset(i).orderBy(`${s.MetaTable.INTEGRATIONS}.order`,"asc");for(const e of _)e.meta=(0,d.parseMetaProp)(e,"meta");const f=null==_?void 0:_.map((e=>this.castType(e)));if(e.includeDatabaseInfo)for(const e of f){const t=e.getConfig();e.config=(0,u.partialExtract)(t,["client",["connection","database"],["connection","filepath"],["connection","connection","filepath"],["searchPath"]])}if(l){const e=+(null===(a=await c.count(`${s.MetaTable.INTEGRATIONS}.id`,{as:"count"}).first())||void 0===a?void 0:a.count)||0;return new p.PagedResponseImpl(f,{count:e,limit:l,offset:i})}return new p.PagedResponseImpl(f,{count:f.length,limit:f.length})}static async get(e,t,a=!1,i=r.default.ncMeta){const l=await i.metaGet2(e.workspace_id,e.workspace_id===s.RootScopes.BYPASS?s.RootScopes.BYPASS:s.RootScopes.WORKSPACE,s.MetaTable.INTEGRATIONS,e.workspace_id&&e.workspace_id!==s.RootScopes.BYPASS?{id:t,fk_workspace_id:e.workspace_id}:t,null,a?{}:{_or:[{deleted:{neq:!0}},{deleted:{eq:null}}]});return l&&(l.meta=(0,d.parseMetaProp)(l,"meta")),this.castType(l)}async getConnectionConfig(){var e;const t=this.getConfig();return"sqlite3"===(null==t?void 0:t.client)&&(t.connection.filename=t.connection.filename||(null===(e=t.connection)||void 0===e?void 0:e.connection.filename)),t}getConfig(){return(0,u.decryptPropIfRequired)({data:this})}async delete(e=r.default.ncMeta){return await e.metaDelete(this.fk_workspace_id,s.RootScopes.WORKSPACE,s.MetaTable.INTEGRATIONS,this.id)}async softDelete(e=r.default.ncMeta){await e.metaUpdate(this.fk_workspace_id,s.RootScopes.WORKSPACE,s.MetaTable.INTEGRATIONS,{deleted:!0},this.id)}async getSources(e=r.default.ncMeta){const t=e.knex(s.MetaTable.SOURCES),a=await t.select(`${s.MetaTable.SOURCES}.id`).select(`${s.MetaTable.SOURCES}.alias`).select(`${s.MetaTable.PROJECT}.title as project_title`).select(`${s.MetaTable.SOURCES}.base_id`).innerJoin(s.MetaTable.PROJECT,`${s.MetaTable.SOURCES}.base_id`,`${s.MetaTable.PROJECT}.id`).where(`${s.MetaTable.SOURCES}.fk_integration_id`,this.id).where((e=>{e.where(`${s.MetaTable.SOURCES}.deleted`,!1).orWhereNull(`${s.MetaTable.SOURCES}.deleted`)})).where((e=>{e.where(`${s.MetaTable.PROJECT}.deleted`,!1).orWhereNull(`${s.MetaTable.PROJECT}.deleted`)}));return this.sources=a}}t.default=Integration},14700:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=a(64612),l=i(a(57804)),c=a(70220),d=a(26944);class Job{constructor(e){Object.assign(this,e)}static async insert(e,t,a=s.default.ncMeta){const i=(0,c.extractProps)(t,["job","status","result","fk_user_id"]),{id:l}=await a.metaInsert2(e.workspace_id,e.base_id,r.MetaTable.JOBS,i);return this.get(e,l,a)}static async update(e,t,a,i=s.default.ncMeta){const u=(0,c.extractProps)(a,["status","result"]),p=await i.metaUpdate(e.workspace_id,e.base_id,r.MetaTable.JOBS,(0,d.prepareForDb)(u,"result"),t);return await l.default.update(`${r.CacheScope.JOBS}:${t}`,(0,d.prepareForResponse)(u,"result")),p}static async delete(e,t,a=s.default.ncMeta){await a.metaDelete(e.workspace_id,e.base_id,r.MetaTable.JOBS,t),await l.default.deepDel(`${r.CacheScope.JOBS}:${t}`,r.CacheDelDirection.CHILD_TO_PARENT)}static async get(e,t,a=s.default.ncMeta){let i=t&&await l.default.get(`${r.CacheScope.JOBS}:${t}`,r.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,r.MetaTable.JOBS,t),i=(0,d.prepareForResponse)(i,"result"),await l.default.set(`${r.CacheScope.JOBS}:${t}`,i)),i&&new Job(i)}static async list(e,t,a=s.default.ncMeta){return(await a.metaList2(e.workspace_id,e.base_id,r.MetaTable.JOBS,t)).map((e=>new Job((0,d.prepareForResponse)(e,"result"))))}}t.default=Job},36060:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(70176)),l=i(a(76584)),c=i(a(57804)),d=a(70220),u=a(64612),p=a(26944);class KanbanView{constructor(e){Object.assign(this,e)}static async get(e,t,a=l.default.ncMeta){let i=t&&await c.default.get(`${u.CacheScope.KANBAN_VIEW}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.KANBAN_VIEW,{fk_view_id:t}),i=(0,p.prepareForResponse)(i),await c.default.set(`${u.CacheScope.KANBAN_VIEW}:${t}`,i)),i&&new KanbanView(i)}static async getViewsByGroupingColId(e,t,a=l.default.ncMeta){return await a.metaList2(e.workspace_id,e.base_id,u.MetaTable.KANBAN_VIEW,{condition:{fk_grp_col_id:t}})}static async insert(e,t,a=l.default.ncMeta){var i,c;const m=await r.default.get(e,t.fk_view_id,a).then((t=>null==t?void 0:t.getModel(e,a))).then((t=>t.getColumns(e,a))),_=(0,d.extractProps)(t,["base_id","source_id","fk_view_id","fk_grp_col_id","meta"]);_.fk_cover_image_col_id=void 0!==(null==t?void 0:t.fk_cover_image_col_id)?null==t?void 0:t.fk_cover_image_col_id:null===(i=null==m?void 0:m.find((e=>e.uidt===s.UITypes.Attachment)))||void 0===i?void 0:i.id,_.meta={fk_cover_image_object_fit:(null===(c=(0,p.parseMetaProp)(_))||void 0===c?void 0:c.fk_cover_image_object_fit)||"fit"},_.meta=(0,p.stringifyMetaProp)(_);const f=await r.default.get(e,_.fk_view_id,a);return _.source_id||(_.source_id=f.source_id),await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.KANBAN_VIEW,_,!0),this.get(e,t.fk_view_id,a)}static async update(e,t,a,i=l.default.ncMeta){const s=(0,d.extractProps)(a,["fk_cover_image_col_id","fk_grp_col_id","meta"]),m=await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.KANBAN_VIEW,(0,p.prepareForDb)(s),{fk_view_id:t});await c.default.update(`${u.CacheScope.KANBAN_VIEW}:${t}`,(0,p.prepareForResponse)(s));const _=await r.default.get(e,t);return await r.default.clearSingleQueryCache(e,_.fk_model_id,[{id:t}],i),m}}t.default=KanbanView},52284:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=i(a(57804)),c=a(70220),d=a(64612);class KanbanViewColumn{constructor(e){Object.assign(this,e)}static async get(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.KANBAN_VIEW_COLUMN}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.KANBAN_VIEW_COLUMNS,t),await l.default.set(`${d.CacheScope.KANBAN_VIEW_COLUMN}:${t}`,i)),i&&new KanbanViewColumn(i)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_view_id","fk_column_id","show","base_id","source_id"]);i.order=await a.metaGetNextOrder(d.MetaTable.KANBAN_VIEW_COLUMNS,{fk_view_id:t.fk_view_id});const u=await s.default.get(e,i.fk_view_id,a);i.source_id||(i.source_id=u.source_id);const{id:p}=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.KANBAN_VIEW_COLUMNS,i);return this.get(e,p,a).then((async e=>(await l.default.appendToList(d.CacheScope.KANBAN_VIEW_COLUMN,[t.fk_view_id],`${d.CacheScope.KANBAN_VIEW_COLUMN}:${p}`),e)))}static async list(e,t,a=r.default.ncMeta){const i=await l.default.getList(d.CacheScope.KANBAN_VIEW_COLUMN,[t]);let{list:s}=i;const{isNoneList:c}=i;return c||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,d.MetaTable.KANBAN_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),await l.default.setList(d.CacheScope.KANBAN_VIEW_COLUMN,[t],s)),s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new KanbanViewColumn(e)))}static async update(e,t,a,i=r.default.ncMeta){const u=(0,c.extractProps)(a,["order","show"]),p=await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.KANBAN_VIEW_COLUMNS,u,t),m=`${d.CacheScope.KANBAN_VIEW_COLUMN}:${t}`;await l.default.update(m,u);{const a=await this.get(e,t,i),r=await s.default.get(e,a.fk_view_id,i);await s.default.clearSingleQueryCache(e,r.fk_model_id,[r])}return p}}t.default=KanbanViewColumn},90652:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(84072)),r=i(a(57596)),l=i(a(76584)),c=i(a(57804)),d=a(70220),u=a(64612),p=a(19684);class LinkToAnotherRecordColumn{constructor(e){Object.assign(this,Object.assign({virtual:!1},e))}async getChildColumn(e,t=l.default.ncMeta){return this.childColumn=await r.default.get(e,{colId:this.fk_child_column_id},t)}async getMMChildColumn(e,t=l.default.ncMeta){return this.mmChildColumn=await r.default.get(e,{colId:this.fk_mm_child_column_id},t)}async getParentColumn(e,t=l.default.ncMeta){return this.parentColumn=await r.default.get(e,{colId:this.fk_parent_column_id},t)}async getMMParentColumn(e,t=l.default.ncMeta){return this.mmParentColumn=await r.default.get(e,{colId:this.fk_mm_parent_column_id},t)}async getMMModel(e,t=l.default.ncMeta){return this.mmModel=await s.default.getByIdOrName(e,{id:this.fk_mm_model_id},t)}async getRelatedTable(e,t=l.default.ncMeta){return this.relatedTable=await s.default.getByIdOrName(e,{id:this.fk_related_model_id},t)}static async insert(e,t,a=l.default.ncMeta){const i=(0,d.extractProps)(t,["fk_column_id","type","fk_child_column_id","fk_parent_column_id","fk_mm_model_id","fk_mm_child_column_id","fk_mm_parent_column_id","fk_target_view_id","ur","dr","fk_index_name","fk_related_model_id","virtual"]);return await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.COL_RELATIONS,i),this.read(e,t.fk_column_id,a)}async getChildView(e,t=l.default.ncMeta){if(this.fk_target_view_id)return await p.View.get(e,this.fk_target_view_id,t)}static async read(e,t,a=l.default.ncMeta){let i=t&&await c.default.get(`${u.CacheScope.COL_RELATION}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.COL_RELATIONS,{fk_column_id:t}),await c.default.set(`${u.CacheScope.COL_RELATION}:${t}`,i)),i?new LinkToAnotherRecordColumn(i):null}static async update(e,t,a){}}t.default=LinkToAnotherRecordColumn},7980:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(19684),r=i(a(90652)),l=i(a(76584));class LinksColumn extends r.default{constructor(){super(...arguments),this.rollup_function="count"}get fk_relation_column_id(){return this.fk_column_id}get fk_rollup_column_id(){return"hm"===this.type?this.fk_child_column_id:"mm"===this.type?this.fk_parent_column_id:void 0}async getRelationColumn(e,t=l.default.ncMeta){return await s.Column.get(e,{colId:this.fk_column_id},t)}async getRollupColumn(e,t=l.default.ncMeta){return await s.Column.get(e,{colId:this.fk_rollup_column_id},t)}static async read(e,t,a=l.default.ncMeta){const i=await super.read(e,t,a);return i&&new LinksColumn(i)}static async insert(e,t,a=l.default.ncMeta){const i=await super.insert(e,t,a);return i&&new LinksColumn(i)}}t.default=LinksColumn},30468:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(57596)),r=i(a(76584)),l=i(a(57804)),c=a(70220),d=a(64612);class LookupColumn{constructor(e){Object.assign(this,e)}async getRelationColumn(e){return await s.default.get(e,{colId:this.fk_relation_column_id})}async getLookupColumn(e){return await s.default.get(e,{colId:this.fk_lookup_column_id})}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_column_id","fk_relation_column_id","fk_lookup_column_id"]);return await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.COL_LOOKUP,i),this.read(e,t.fk_column_id,a).then((async e=>(await l.default.appendToList(d.CacheScope.COL_LOOKUP,[t.fk_lookup_column_id],`${d.CacheScope.COL_LOOKUP}:${t.fk_column_id}`),await l.default.appendToList(d.CacheScope.COL_LOOKUP,[t.fk_relation_column_id],`${d.CacheScope.COL_LOOKUP}:${t.fk_column_id}`),e)))}static async read(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.COL_LOOKUP}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.COL_LOOKUP,{fk_column_id:t}),await l.default.set(`${d.CacheScope.COL_LOOKUP}:${t}`,i)),i?new LookupColumn(i):null}}t.default=LookupColumn},40144:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(4388)),l=a(70220),c=i(a(57804)),d=i(a(76584)),u=a(64612),p=a(26944);class MapView{constructor(e){Object.assign(this,e)}static async get(e,t,a=d.default.ncMeta){let i=t&&await c.default.get(`${u.CacheScope.MAP_VIEW}:${t}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,u.MetaTable.MAP_VIEW,{fk_view_id:t}),await c.default.set(`${u.CacheScope.MAP_VIEW}:${t}`,i)),i&&new MapView(i)}static async insert(e,t,a=d.default.ncMeta){const i={base_id:t.base_id,source_id:t.source_id,fk_view_id:t.fk_view_id,fk_geo_data_col_id:t.fk_geo_data_col_id,meta:t.meta},r=await s.default.get(e,i.fk_view_id,a);return i.source_id||(i.source_id=r.source_id),await a.metaInsert2(e.workspace_id,e.base_id,u.MetaTable.MAP_VIEW,i,!0),this.get(e,t.fk_view_id,a)}static async update(e,t,a,i=d.default.ncMeta){const m=(0,l.extractProps)(a,["fk_geo_data_col_id","meta"]);if(null!=a.fk_geo_data_col_id){const i=(await r.default.list(e,t)).find((e=>e.fk_column_id===a.fk_geo_data_col_id));await s.default.updateColumn(e,a.fk_view_id,i.id,{show:!0})}const _=await i.metaUpdate(e.workspace_id,e.base_id,u.MetaTable.MAP_VIEW,(0,p.prepareForDb)(m),{fk_view_id:t});return await c.default.update(`${u.CacheScope.MAP_VIEW}:${t}`,(0,p.prepareForResponse)(m)),_}}t.default=MapView},4388:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=i(a(57804)),c=a(64612),d=a(70220);class MapViewColumn{constructor(e){Object.assign(this,e)}static async get(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${c.CacheScope.MAP_VIEW_COLUMN}:${t}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.MAP_VIEW_COLUMNS,t),await l.default.set(`${c.CacheScope.MAP_VIEW_COLUMN}:${t}`,i)),i&&new MapViewColumn(i)}static async insert(e,t,a=r.default.ncMeta){const i={fk_view_id:t.fk_view_id,fk_column_id:t.fk_column_id,order:await a.metaGetNextOrder(c.MetaTable.MAP_VIEW_COLUMNS,{fk_view_id:t.fk_view_id}),show:t.show,base_id:t.base_id,source_id:t.source_id},d=await s.default.get(e,i.fk_view_id,a);i.source_id||(i.source_id=d.source_id);const{id:u}=await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.MAP_VIEW_COLUMNS,i);return this.get(e,u,a).then((async e=>(await l.default.appendToList(c.CacheScope.MAP_VIEW_COLUMN,[t.fk_view_id],`${c.CacheScope.MAP_VIEW_COLUMN}:${u}`),e)))}static async list(e,t,a=r.default.ncMeta){const i=await l.default.getList(c.CacheScope.MAP_VIEW_COLUMN,[t]);let{list:s}=i;const{isNoneList:d}=i;return d||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.MAP_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),await l.default.setList(c.CacheScope.MAP_VIEW_COLUMN,[t],s)),s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new MapViewColumn(e)))}static async update(e,t,a,i=r.default.ncMeta){const u=(0,d.extractProps)(a,["order","show","width","group_by","group_by_order","group_by_sort"]),p=await i.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.MAP_VIEW_COLUMNS,u,t),m=`${c.CacheScope.MAP_VIEW_COLUMN}:${t}`;await l.default.update(m,u);{const a=await this.get(e,t,i),r=await s.default.get(e,a.fk_view_id,i);await s.default.clearSingleQueryCache(e,r.fk_model_id,[r])}return p}}t.default=MapViewColumn},84072:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(44578)),l=a(23324),c=i(a(82568)),d=i(a(70176)),u=i(a(92944)),p=i(a(57596)),m=a(70220),_=a(44356),f=a(43820),h=a(64612),g=i(a(57804)),y=i(a(76584)),b=a(70240),w=a(19684),v=a(24408),T=a(26944),k=a(19684),S=new l.Logger("Model");class Model{constructor(e){Object.assign(this,e)}async getColumns(e,t=y.default.ncMeta,a=void 0){return this.columns=await p.default.list(e,{fk_model_id:this.id,fk_default_view_id:a},t),this.columns}async getViews(e,t=!1,a=y.default.ncMeta){return this.views=await d.default.listWithInfo(e,this.id,a),this.views}get primaryKey(){var e;return this.columns?this.columns.find((e=>{var t;return e.pk&&(e.ai||(null===(t=e.meta)||void 0===t?void 0:t.ag))}))||(null===(e=this.columns)||void 0===e?void 0:e.find((e=>e.pk))):null}get primaryKeys(){var e;return this.columns?null===(e=this.columns)||void 0===e?void 0:e.filter((e=>e.pk)):null}get displayValue(){var e;if(!this.columns)return null;const t=null===(e=this.columns)||void 0===e?void 0:e.find((e=>e.pv));if(t)return t;if(this.mm)return this.columns[0];const a=this.columns.indexOf(this.primaryKey);return a<this.columns.length-1?this.columns[a+1]:this.columns[0]}static async insert(e,t,a,i,r=y.default.ncMeta){const l=(0,m.extractProps)(i,["table_name","title","description","mm","order","type","id","meta"]);l.mm=!!l.mm,l.order||(l.order=await r.metaGetNextOrder(h.MetaTable.FORM_VIEW_COLUMNS,{base_id:t,source_id:a})),l.type||(l.type=s.ModelTypes.TABLE),l.source_id=a;const{id:c}=await r.metaInsert2(e.workspace_id,e.base_id,h.MetaTable.MODELS,l),u=await p.default.bulkInsert(e,{columns:(null==i?void 0:i.columns)||[],fk_model_id:c,source_id:a,base_id:t},r);await d.default.insertMetaOnly(e,{fk_model_id:c,title:i.title||i.table_name,is_default:!0,type:s.ViewTypes.GRID,base_id:t,source_id:a},{getColumns:async()=>u},r);const _=await this.getWithInfo(e,{id:c},r);return a&&await g.default.appendToList(h.CacheScope.MODEL,[t,a],`${h.CacheScope.MODEL}:${c}`),await g.default.appendToList(h.CacheScope.MODEL,[t],`${h.CacheScope.MODEL}:${c}`),(0,v.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{S.error("Failed to clean command palette cache")})),_}static async list(e,{base_id:t,source_id:a},i=y.default.ncMeta){var s,r;const l=await g.default.getList(h.CacheScope.MODEL,[t,a]);let{list:c}=l;const{isNoneList:d}=l;if(!d&&!c.length){c=await i.metaList2(e.workspace_id,e.base_id,h.MetaTable.MODELS,Object.assign({orderBy:{order:"asc"}},a?{condition:{source_id:a}}:{}));for(const e of c)e.meta=(0,T.parseMetaProp)(e);a?await g.default.setList(h.CacheScope.MODEL,[t,a],c):await g.default.setList(h.CacheScope.MODEL,[t],c)}c.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0)));for(const t of c)void 0===(null===(s=t.meta)||void 0===s?void 0:s.hasNonDefaultViews)&&(t.meta=Object.assign(Object.assign({},null!==(r=t.meta)&&void 0!==r?r:{}),{hasNonDefaultViews:await Model.getNonDefaultViewsCountAndReset(e,{modelId:t.id},i)}));return c.map((e=>new Model(e)))}static async listWithInfo(e,{base_id:t,db_alias:a},i=y.default.ncMeta){var s,r;const l=await g.default.getList(h.CacheScope.MODEL,[t,a]);let{list:c}=l;const{isNoneList:d}=l;if(!d&&!c.length){c=await i.metaList2(e.workspace_id,e.base_id,h.MetaTable.MODELS);for(const e of c)e.meta=(0,T.parseMetaProp)(e);await g.default.setList(h.CacheScope.MODEL,[t],c)}for(const t of c)void 0===(null===(s=t.meta)||void 0===s?void 0:s.hasNonDefaultViews)&&(t.meta=Object.assign(Object.assign({},null!==(r=t.meta)&&void 0!==r?r:{}),{hasNonDefaultViews:await Model.getNonDefaultViewsCountAndReset(e,{modelId:t.id},i)}));return c.map((e=>new Model(e)))}static async get(e,t,a=y.default.ncMeta){let i=t&&await g.default.get(`${h.CacheScope.MODEL}:${t}`,h.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,t),i&&(i.meta=(0,T.parseMetaProp)(i),await g.default.set(`${h.CacheScope.MODEL}:${i.id}`,i))),i&&new Model(i)}static async getByIdOrName(e,t,a=y.default.ncMeta){const i="id"in t?null==t?void 0:t.id:t;let s=i&&await g.default.get(`${h.CacheScope.MODEL}:${i}`,h.CacheGetType.TYPE_OBJECT);return s||(s=await a.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,i),s&&(s.meta=(0,T.parseMetaProp)(s))),s?(s.meta=(0,T.parseMetaProp)(s),await g.default.set(`${h.CacheScope.MODEL}:${s.id}`,s),new Model(s)):null}static async getWithInfo(e,{table_name:t,id:a},i=y.default.ncMeta){let s=a&&await g.default.get(`${h.CacheScope.MODEL}:${a}`,h.CacheGetType.TYPE_OBJECT);if(s||(s=await i.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,a||{table_name:t}),s&&(s.meta=(0,T.parseMetaProp)(s),await g.default.set(`${h.CacheScope.MODEL}:${s.id}`,s))),s){const t=new Model(s);await t.getViews(e,!1,i);const a=t.views.find((e=>e.is_default)).id,r=await t.getColumns(e,i,a);return t.columnsById=r.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.id]:t})),{}),t}return null}static async getBaseModelSQL(e,t,a=y.default.ncMeta){var i,s,r;const l=(null==t?void 0:t.model)||await this.get(e,t.id,a),c=t.source||await k.Source.get(e,l.source_id,!1,a);if(!(null==t?void 0:t.viewId)&&t.extractDefaultView){const i=await d.default.getDefaultView(e,l.id,a);t.viewId=i.id}let u;return(null==c?void 0:c.isMeta(!0,1))?u=null===(i=c.getConfig())||void 0===i?void 0:i.schema:"pg"===(null==c?void 0:c.type)&&(u=null===(r=null===(s=c.getConfig())||void 0===s?void 0:s.searchPath)||void 0===r?void 0:r[0]),new b.BaseModelSqlv2({context:e,dbDriver:t.dbDriver,viewId:t.viewId,model:l,schema:u})}async delete(e,t=y.default.ncMeta,a=!1){await u.default.deleteModelComments(e,this.id,t);for(const a of await this.getViews(e,!0,t))await a.delete(e,t);for(const a of await c.default.list(e,{fk_model_id:this.id},t))await c.default.delete(e,a.id,t);for(const a of await this.getColumns(e,t)){let i=null,r=null;switch(a.uidt){case s.UITypes.Rollup:i=h.MetaTable.COL_ROLLUP,r=h.CacheScope.COL_ROLLUP;break;case s.UITypes.Lookup:i=h.MetaTable.COL_LOOKUP,r=h.CacheScope.COL_LOOKUP;break;case s.UITypes.ForeignKey:case s.UITypes.LinkToAnotherRecord:i=h.MetaTable.COL_RELATIONS,r=h.CacheScope.COL_RELATION;break;case s.UITypes.MultiSelect:case s.UITypes.SingleSelect:i=h.MetaTable.COL_SELECT_OPTIONS,r=h.CacheScope.COL_SELECT_OPTION;break;case s.UITypes.Formula:i=h.MetaTable.COL_FORMULA,r=h.CacheScope.COL_FORMULA;break;case s.UITypes.QrCode:i=h.MetaTable.COL_QRCODE,r=h.CacheScope.COL_QRCODE;break;case s.UITypes.Barcode:i=h.MetaTable.COL_BARCODE,r=h.CacheScope.COL_BARCODE}i&&r&&(await t.metaDelete(e.workspace_id,e.base_id,i,{fk_column_id:a.id}),await g.default.deepDel(`${r}:${a.id}`,h.CacheDelDirection.CHILD_TO_PARENT))}if(a){const a=await t.metaList2(e.workspace_id,e.base_id,h.MetaTable.COL_RELATIONS,{condition:{fk_related_model_id:this.id}});for(const e of a)await g.default.deepDel(`${h.CacheScope.COL_RELATION}:${e.fk_column_id}`,h.CacheDelDirection.CHILD_TO_PARENT);await t.metaDelete(e.workspace_id,e.base_id,h.MetaTable.COL_RELATIONS,{fk_related_model_id:this.id})}return await g.default.deepDel(`${h.CacheScope.COLUMN}:${this.id}`,h.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(e.workspace_id,e.base_id,h.MetaTable.COLUMNS,{fk_model_id:this.id}),await w.FileReference.bulkDelete(e,{fk_model_id:this.id},t),await g.default.deepDel(`${h.CacheScope.MODEL}:${this.id}`,h.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(e.workspace_id,e.base_id,h.MetaTable.MODELS,this.id),await g.default.del([`${h.CacheScope.MODEL_ALIAS}:${this.base_id}:${this.id}`,`${h.CacheScope.MODEL_ALIAS}:${this.base_id}:${this.source_id}:${this.id}`,`${h.CacheScope.MODEL_ALIAS}:${this.base_id}:${this.title}`,`${h.CacheScope.MODEL_ALIAS}:${this.base_id}:${this.source_id}:${this.title}`]),(0,v.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{S.error("Failed to clean command palette cache")})),!0}async mapAliasToColumn(e,t,a={isMySQL:!1,isSqlite:!1,isMssql:!1,isPg:!1},i,l){var c,d;const u={};for(const p of l||await this.getColumns(e)){if((0,s.isVirtualCol)(p))continue;let e=void 0!==(null==t?void 0:t[p.column_name])?null==t?void 0:t[p.column_name]:null==t?void 0:t[p.title];if(void 0!==e){if(p.uidt===s.UITypes.Attachment&&"string"!=typeof e&&(e=JSON.stringify(e)),p.uidt===s.UITypes.DateTime&&(0,r.default)(e).isValid()){const{isMySQL:t,isSqlite:s,isMssql:l,isPg:c}=a;e.indexOf("-")<0&&e.indexOf("+")<0&&"Z"!==e.slice(-1)&&(e+="+00:00"),e=t?i.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,r.default)(e).utc().format("YYYY-MM-DD HH:mm:ss")]):s?(0,r.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ"):c?i.raw("? AT TIME ZONE CURRENT_SETTING('timezone')",[(0,r.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ")]):l?i.raw("SWITCHOFFSET(CONVERT(datetimeoffset, ?), DATENAME(TzOffset, SYSDATETIMEOFFSET()))",[(0,r.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ")]):(0,r.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ")}u[(0,_.sanitize)(p.column_name)]=e,a.isPg&&"bytea"===p.dt&&(u[(0,_.sanitize)(p.column_name)]=i.raw(`decode(?, '${"hex"===(null===(c=p.meta)||void 0===c?void 0:c.format)?"hex":"escape"}')`,["hex"===(null===(d=p.meta)||void 0===d?void 0:d.format)&&(e+"").length%2==1?"0"+e:e]))}}return u}async mapColumnToAlias(e,t,a){const i={};for(const r of a||await this.getColumns(e)){if((0,s.isVirtualCol)(r))continue;let e=void 0!==(null==t?void 0:t[r.title])?null==t?void 0:t[r.title]:null==t?void 0:t[r.column_name];void 0!==e&&(r.uidt===s.UITypes.Attachment&&"string"!=typeof e&&(e=JSON.stringify(e)),i[(0,_.sanitize)(r.title)]=e)}return i}static async updateAliasAndTableName(e,t,a,i,r=y.default.ncMeta){a||f.NcError.badRequest("Missing 'title' property in body"),i||f.NcError.badRequest("Missing 'table_name' property in body");const l=await this.get(e,t,r),c=await r.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.MODELS,{title:a,table_name:i},t);{const i=await d.default.getDefaultView(e,t,r);i&&await d.default.update(e,i.id,{title:a})}await g.default.update(`${h.CacheScope.MODEL}:${t}`,{title:a,table_name:i}),await g.default.del([`${h.CacheScope.MODEL_ALIAS}:${l.base_id}:${l.id}`,`${h.CacheScope.MODEL_ALIAS}:${l.base_id}:${l.source_id}:${l.id}`,`${h.CacheScope.MODEL_ALIAS}:${l.base_id}:${l.title}`,`${h.CacheScope.MODEL_ALIAS}:${l.base_id}:${l.source_id}:${l.title}`]),(0,v.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{S.error("Failed to clean command palette cache")})),await d.default.clearSingleQueryCache(e,t,null,r);for(const a of await this.get(e,t).then((t=>t.getColumns(e)))){if(!(0,s.isLinksOrLTAR)(a))continue;const i=await a.getColOptions(e,r);i.fk_related_model_id!==t&&await d.default.clearSingleQueryCache(e,i.fk_related_model_id,null,r)}return c}static async markAsMmTable(e,t,a=!0,i=y.default.ncMeta){const s=await i.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.MODELS,{mm:a},t);return await g.default.update(`${h.CacheScope.MODEL}:${t}`,{mm:a}),s}async getAliasColMapping(e){return(await this.getColumns(e)).reduce(((e,t)=>(t.column_name&&(e[t.title]=t.column_name),e)),{})}async getColAliasMapping(e){return(await this.getColumns(e)).reduce(((e,t)=>(t.column_name&&(e[t.column_name]=t.title),e)),{})}static async updateOrder(e,t,a,i=y.default.ncMeta){const s=await i.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.MODELS,{order:a},t);return await g.default.update(`${h.CacheScope.MODEL}:${t}`,{order:a}),s}static async updatePrimaryColumn(e,t,a,i=y.default.ncMeta){var r;const l=await this.getWithInfo(e,{id:t},i),c=l.columns.find((e=>e.id===a));c||f.NcError.fieldNotFound(a);for(const t of(null===(r=l.columns)||void 0===r?void 0:r.filter((e=>e.pv)))||[])await i.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.COLUMNS,{pv:!1},t.id),await g.default.update(`${h.CacheScope.COLUMN}:${t.id}`,{pv:!1});await i.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.COLUMNS,{pv:!0},c.id),await g.default.update(`${h.CacheScope.COLUMN}:${c.id}`,{pv:!0});const u=await i.metaList2(e.workspace_id,e.base_id,h.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_column_id:c.id}});if(u.length)for(const t of u)await d.default.fixPVColumnForView(e,t.fk_view_id,i);const p=new Set;for(const t of l.columns){if(!(0,s.isLinksOrLTAR)(t))continue;const a=await t.getColOptions(e);p.add(null==a?void 0:a.fk_related_model_id)}return await Promise.all(Array.from(p).map((async t=>{await d.default.clearSingleQueryCache(e,t,null,i)}))),!0}static async setAsMm(e,t,a=y.default.ncMeta){await a.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.MODELS,{mm:!0},t),await g.default.update(`${h.CacheScope.MODEL}:${t}`,{mm:!0})}static async getByAliasOrId(e,{base_id:t,source_id:a,aliasOrId:i},s=y.default.ncMeta){const r=a?`${h.CacheScope.MODEL_ALIAS}:${t}:${a}:${i}`:`${h.CacheScope.MODEL_ALIAS}:${t}:${i}`,l=t&&i&&await g.default.get(r,h.CacheGetType.TYPE_STRING);if(!l){const l=a?await s.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,{base_id:t,source_id:a},null,{_or:[{id:{eq:i}},{title:{eq:i}}]}):await s.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,{base_id:t},null,{_or:[{id:{eq:i}},{title:{eq:i}}]});return l&&(await g.default.set(r,l.id),await g.default.set(`${h.CacheScope.MODEL}:${l.id}`,l)),l&&new Model(l)}return l&&this.get(e,l)}static async checkTitleAvailable(e,{table_name:t,source_id:a,exclude_id:i},s=y.default.ncMeta){return!await s.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,Object.assign({table_name:t},a?{source_id:a}:{}),null,i&&{id:{neq:i}})}static async checkAliasAvailable(e,{title:t,source_id:a,exclude_id:i},s=y.default.ncMeta){return!await s.metaGet2(e.workspace_id,e.base_id,h.MetaTable.MODELS,Object.assign({title:t},a?{source_id:a}:{}),null,i&&{id:{neq:i}})}async getAliasColObjMap(e,t){return(t||await this.getColumns(e)).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.title]:t})),{})}static async updateMeta(e,t,a,i=y.default.ncMeta){const s=(0,m.extractProps)(a,["description","meta"]),r=await i.metaUpdate(e.workspace_id,e.base_id,h.MetaTable.MODELS,(0,T.prepareForDb)(s),t);return await g.default.update(`${h.CacheScope.MODEL}:${t}`,(0,T.prepareForResponse)(s)),r}static async getNonDefaultViewsCountAndReset(e,{modelId:t},a=y.default.ncMeta){const i=await this.get(e,t,a);let s=(0,T.parseMetaProp)(i);const r=await d.default.list(e,t,a);return s=Object.assign(Object.assign({},null!=s?s:{}),{hasNonDefaultViews:r.length>1}),await this.updateMeta(e,t,{meta:s},a),null==s?void 0:s.hasNonDefaultViews}}t.default=Model},70912:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(70176)),r=i(a(76584)),l=a(64612),c=i(a(57804)),d=a(70220);class ModelRoleVisibility{constructor(e){Object.assign(this,e)}static async list(e,t){const a=await c.default.getList(l.CacheScope.MODEL_ROLE_VISIBILITY,[t]);let{list:i}=a;const{isNoneList:s}=a;return s||i.length||(i=await r.default.ncMeta.metaList2(e.workspace_id,e.base_id,l.MetaTable.MODEL_ROLE_VISIBILITY),await c.default.setList(l.CacheScope.MODEL_ROLE_VISIBILITY,[t],i,["fk_view_id","role"])),null==i?void 0:i.map((e=>new ModelRoleVisibility(e)))}static async get(e,t,a=r.default.ncMeta){let i=t.fk_view_id&&t.role&&await c.default.get(`${l.CacheScope.MODEL_ROLE_VISIBILITY}:${t.fk_view_id}:${t.role}`,l.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,l.MetaTable.MODEL_ROLE_VISIBILITY,{fk_view_id:t.fk_view_id,role:t.role}),await c.default.set(`${l.CacheScope.MODEL_ROLE_VISIBILITY}:${t.fk_view_id}:${t.role}`,i)),i&&new ModelRoleVisibility(i)}static async update(e,t,a,i,s=r.default.ncMeta){const d=await s.metaUpdate(e.workspace_id,e.base_id,l.MetaTable.MODEL_ROLE_VISIBILITY,{disabled:i.disabled},{fk_view_id:t,role:a});return await c.default.update(`${l.CacheScope.MODEL_ROLE_VISIBILITY}:${t}:${a}`,{disabled:i.disabled}),d}async delete(e,t=r.default.ncMeta){return await ModelRoleVisibility.delete(e,this.fk_view_id,this.role,t)}static async delete(e,t,a,i=r.default.ncMeta){const s=await i.metaDelete(e.workspace_id,e.base_id,l.MetaTable.MODEL_ROLE_VISIBILITY,{fk_view_id:t,role:a});return await c.default.deepDel(`${l.CacheScope.MODEL_ROLE_VISIBILITY}:${t}:${a}`,l.CacheDelDirection.CHILD_TO_PARENT),s}static async insert(e,t,a=r.default.ncMeta){const i=(0,d.extractProps)(t,["role","disabled","fk_view_id","base_id","source_id"]),u=await s.default.get(e,t.fk_view_id,a);i.source_id||(i.source_id=u.source_id);const p=await a.metaInsert2(e.workspace_id,e.base_id,l.MetaTable.MODEL_ROLE_VISIBILITY,i);return i.id=p.id,this.get(e,{fk_view_id:t.fk_view_id,role:t.role},a).then((async a=>{const i=`${l.CacheScope.MODEL_ROLE_VISIBILITY}:${t.fk_view_id}:${t.role}`;return await c.default.appendToList(l.CacheScope.MODEL_ROLE_VISIBILITY,[e.base_id],i),a}))}}t.default=ModelRoleVisibility},1980:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(70220),r=i(a(76584)),l=a(64612),c=a(26944);t.default=class Notification{constructor(e){Object.assign(this,e)}static async insert(e,t=r.default.ncMeta){const a=(0,s.extractProps)(e,["body","type","fk_user_id","is_read","is_deleted"]);return await t.metaInsert2(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.NOTIFICATION,(0,c.prepareForDb)(a,"body"))}static async get(e,t=r.default.ncMeta){const a=(0,s.extractProps)(e,["id","fk_user_id"]);return await t.metaGet2(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.NOTIFICATION,a)}static async list(e,t=r.default.ncMeta){const{limit:a=10,offset:i=0}=e,d=(0,s.extractProps)(e,["is_read","is_deleted","fk_user_id"]),u=await t.metaList2(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.NOTIFICATION,{condition:d,limit:a,offset:i,orderBy:{created_at:"desc"}});for(const e of u)(0,c.prepareForResponse)(e,"body");return u}static async count(e,t=r.default.ncMeta){const a=(0,s.extractProps)(e,["is_read","is_deleted","fk_user_id"]);return await t.metaCount(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.NOTIFICATION,{condition:a})}static async update(e,t,a=r.default.ncMeta){const i=(0,s.extractProps)(t,["body","type","fk_user_id","is_read","is_deleted"]);return await a.metaUpdate(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.NOTIFICATION,(0,c.prepareForDb)(i,"body"),e)}static async markAllAsRead(e,t=r.default.ncMeta){return t.metaUpdate(l.RootScopes.ROOT,l.RootScopes.ROOT,l.MetaTable.NOTIFICATION,{is_read:!0},{fk_user_id:e,is_read:!1})}}},60160:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=i(a(57804)),l=a(70220),c=a(64612);class Plugin{constructor(e){Object.assign(this,e)}static async get(e,t=s.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.PLUGIN}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.PLUGIN,e),await r.default.set(`${c.CacheScope.PLUGIN}:${e}`,a)),a&&new Plugin(a)}static async list(e=s.default.ncMeta){const t=await r.default.getList(c.CacheScope.PLUGIN,[]);let{list:a}=t;const{isNoneList:i}=t;return i||a.length||(a=await e.metaList2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.PLUGIN),await r.default.setList(c.CacheScope.PLUGIN,[],a)),a}static async count(e=s.default.ncMeta){var t;return null===(t=await e.knex(c.MetaTable.PLUGIN).count("id",{as:"count"}))||void 0===t?void 0:t.count}static async update(e,t){const a=(0,l.extractProps)(t,["input","active"]);return a.input&&"object"==typeof a.input&&(a.input=JSON.stringify(a.input)),await s.default.ncMeta.metaUpdate(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.PLUGIN,a,e),await r.default.update(`${c.CacheScope.PLUGIN}:${e}`,a),await r.default.update(`${c.CacheScope.PLUGIN}:${t.title}`,a),this.get(e)}static async isPluginActive(e){var t;return!!(null===(t=await this.getPluginByTitle(e))||void 0===t?void 0:t.active)}static async getPluginByTitle(e,t=s.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.PLUGIN}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.PLUGIN,{title:e}),await r.default.set(`${c.CacheScope.PLUGIN}:${e}`,a)),a}}t.default=Plugin},12776:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(92080),l=s(a(20112)),c=s(a(92696)),d=s(a(23080)),u=s(a(76584)),p=s(a(57804)),m=a(64612),_=a(19176);const f=isNaN(parseInt(process.env.NC_ATTACHMENT_EXPIRE_SECONDS))?7200:parseInt(process.env.NC_ATTACHMENT_EXPIRE_SECONDS);class PresignedUrl{constructor(e){Object.assign(this,e)}static async add(e){const{path:t,url:a,expires_at:i,expiresInSeconds:s=f}=e;await p.default.setExpiring(`${m.CacheScope.PRESIGNED_URL}:path:${(0,c.default)(t)}`,{path:t,url:a,expires_at:i},s),await p.default.setExpiring(`${m.CacheScope.PRESIGNED_URL}:url:${(0,c.default)(decodeURIComponent(a))}`,{path:t,url:a,expires_at:i},s)}static async delete(e){const{path:t,url:a}=e;await p.default.del(`${m.CacheScope.PRESIGNED_URL}:path:${(0,c.default)(t)}`),await p.default.del(`${m.CacheScope.PRESIGNED_URL}:url:${(0,c.default)(a)}`)}static async getPath(e,t=u.default.ncMeta){const a=e&&await p.default.get(`${m.CacheScope.PRESIGNED_URL}:url:${(0,c.default)(e)}`,m.CacheGetType.TYPE_OBJECT);return a?a&&new Date(a.expires_at).getTime()<(new Date).getTime()?(await this.delete({path:a.path,url:a.url}),null):null==a?void 0:a.path:null}static async getSignedUrl(e,t=u.default.ncMeta){const a=/^https?:\/\//i.test(e.pathOrUrl);let i=(a?(0,_.getPathFromUrl)(e.pathOrUrl):e.pathOrUrl).replace(/^\/+/,"");const{expireSeconds:s=f,filename:h,mimetype:g}=e,y=!!e.preview&&(0,_.isPreviewAllowed)({path:i,mimetype:g}),b=function(e){const t=6e5;return new Date(Math.ceil(e.getTime()/t)*t)}(new Date((new Date).getTime()+1e3*s)),w=Math.ceil((b.getTime()-(new Date).getTime())/1e3);let v;const T={};y?(T.ResponseContentDisposition="inline;",h&&(T.ResponseContentDisposition=(0,l.default)(h,{type:"inline"}))):(T.ResponseContentDisposition="attachment;",h&&(T.ResponseContentDisposition=(0,l.default)(h,{type:"attachment"}))),g&&(T.ResponseContentType=g);const k=`${i}?${new URLSearchParams(T).toString()}`,S=await p.default.get(`${m.CacheScope.PRESIGNED_URL}:path:${(0,c.default)(k)}`,m.CacheGetType.TYPE_OBJECT);if(S){if(new Date(S.expires_at).getTime()>(new Date).getTime())return S.url;await this.delete({path:S.path,url:S.url})}const M=await d.default.storageAdapter(t);return"function"==typeof M.getSignedUrl?(v=await M.getSignedUrl(i,w,T),await this.add({path:k,url:v,expires_at:b,expiresInSeconds:w})):(v=a?e.pathOrUrl:`dltemp/${(0,r.nanoid)(16)}/${b.getTime()}/${i}`,i=`${i}?${new URLSearchParams(T).toString()}`,await this.add({path:i,url:v,expires_at:b,expiresInSeconds:w})),v}static async signAttachment(e,t=u.default.ncMeta){const{nestedKeys:a=[],attachment:s,preview:r=!0,mimetype:l}=e,c=i(e,["nestedKeys","attachment","preview","mimetype"]),d=a.reduce(((e,t)=>(e[t]||(e[t]={}),e[t])),s);(null==s?void 0:s.path)?d.signedPath=await PresignedUrl.getSignedUrl(Object.assign({pathOrUrl:s.path.replace(/^download[/\\]/i,""),preview:r,mimetype:l||s.mimetype},c?Object.assign({},c):{}),t):(null==s?void 0:s.url)&&(d.signedUrl=await PresignedUrl.getSignedUrl(Object.assign({pathOrUrl:s.url,preview:r,mimetype:l||s.mimetype},c?Object.assign({},c):{}),t))}}t.default=PresignedUrl},69004:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=i(a(57804)),l=a(70220),c=a(64612),d=a(19684),u=a(43820);class QrCodeColumn{constructor(e){Object.assign(this,e)}static async insert(e,t,a=s.default.ncMeta){const i=(0,l.extractProps)(t,["fk_column_id","fk_qr_value_column_id"]);return await d.Column.get(e,{colId:i.fk_column_id},a)||u.NcError.fieldNotFound(i.fk_column_id),await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.COL_QRCODE,i),this.read(e,t.fk_column_id,a)}static async read(e,t,a=s.default.ncMeta){let i=t&&await r.default.get(`${c.CacheScope.COL_QRCODE}:${t}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.COL_QRCODE,{fk_column_id:t}),await r.default.set(`${c.CacheScope.COL_QRCODE}:${t}`,i)),i?new QrCodeColumn(i):null}async getValueColumn(e){return d.Column.get(e,{colId:this.fk_qr_value_column_id})}}t.default=QrCodeColumn},31196:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ROLLUP_FUNCTIONS=void 0;const s=i(a(57596)),r=i(a(76584)),l=i(a(57804)),c=a(70220),d=a(64612),u=a(43820);t.ROLLUP_FUNCTIONS=["count","min","max","avg","countDistinct","sumDistinct","avgDistinct","sum"];class RollupColumn{constructor(e){Object.assign(this,e)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["fk_column_id","fk_relation_column_id","fk_rollup_column_id","rollup_function"]);return await s.default.get(e,{colId:i.fk_column_id},a)||u.NcError.fieldNotFound(i.fk_column_id),await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.COL_ROLLUP,i),this.read(e,t.fk_column_id,a).then((async e=>(await l.default.appendToList(d.CacheScope.COL_ROLLUP,[t.fk_rollup_column_id],`${d.CacheScope.COL_ROLLUP}:${t.fk_column_id}`),await l.default.appendToList(d.CacheScope.COL_ROLLUP,[t.fk_relation_column_id],`${d.CacheScope.COL_ROLLUP}:${t.fk_column_id}`),e)))}static async read(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.COL_ROLLUP}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.COL_ROLLUP,{fk_column_id:t}),await l.default.set(`${d.CacheScope.COL_ROLLUP}:${t}`,i)),i?new RollupColumn(i):null}async getRollupColumn(e,t=r.default.ncMeta){return s.default.get(e,{colId:this.fk_rollup_column_id},t)}async getRelationColumn(e,t=r.default.ncMeta){return s.default.get(e,{colId:this.fk_relation_column_id},t)}}t.default=RollupColumn},23696:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(a(76584)),l=s(a(57804)),c=a(70220),d=a(64612),u=a(19684),p=a(43820);class SelectOption{constructor(e){Object.assign(this,e)}static async insert(e,t,a=r.default.ncMeta){const i=(0,c.extractProps)(t,["id","title","fk_column_id","color","order"]);await u.Column.get(e,{colId:i.fk_column_id},a)||p.NcError.fieldNotFound(i.fk_column_id);const{id:s}=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.COL_SELECT_OPTIONS,i);return this.get(e,s,a).then((async e=>(await l.default.appendToList(d.CacheScope.COL_SELECT_OPTION,[t.fk_column_id],`${d.CacheScope.COL_SELECT_OPTION}:${s}`),e)))}static async bulkInsert(e,t,a=r.default.ncMeta){const i=[];for(const e of t){const t=(0,c.extractProps)(e,["id","title","fk_column_id","color","order"]);i.push(t)}if(!i.length)return!1;const s=await a.bulkMetaInsert(e.workspace_id,e.base_id,d.MetaTable.COL_SELECT_OPTIONS,i);for(const e of s)await l.default.set(`${d.CacheScope.COL_SELECT_OPTION}:${e.id}`,e),await l.default.appendToList(d.CacheScope.COL_SELECT_OPTION,[e.fk_column_id],`${d.CacheScope.COL_SELECT_OPTION}:${e.id}`);return!0}static async get(e,t,a=r.default.ncMeta){let i=t&&await l.default.get(`${d.CacheScope.COL_SELECT_OPTION}:${t}`,d.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.COL_SELECT_OPTIONS,t),await l.default.set(`${d.CacheScope.COL_SELECT_OPTION}:${t}`,i)),i&&new SelectOption(i)}static async read(e,t,a=r.default.ncMeta){const s=await l.default.getList(d.CacheScope.COL_SELECT_OPTION,[t]);let{list:c}=s;const{isNoneList:u}=s;return u||c.length||(c=await a.metaList2(e.workspace_id,e.base_id,d.MetaTable.COL_SELECT_OPTIONS,{condition:{fk_column_id:t}}),await l.default.setList(d.CacheScope.COL_SELECT_OPTION,[t],c.map((e=>{var{created_at:t,updated_at:a}=e;return i(e,["created_at","updated_at"])})))),(null==c?void 0:c.length)?{options:c.map((e=>{var{created_at:t,updated_at:a}=e,s=i(e,["created_at","updated_at"]);return new SelectOption(s)})).sort(((e,t)=>e.order-t.order))}:null}static async find(e,t,a,i=r.default.ncMeta){const s=await i.metaGet2(e.workspace_id,e.base_id,d.MetaTable.COL_SELECT_OPTIONS,{fk_column_id:t,title:a});return s&&new SelectOption(s)}}t.default=SelectOption},95428:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(84072)),r=i(a(57596)),l=i(a(76584)),c=a(64612),d=i(a(57804)),u=a(70220),p=i(a(70176));class Sort{constructor(e){Object.assign(this,e)}static async deleteAll(e,t,a=l.default.ncMeta){await d.default.deepDel(`${c.CacheScope.SORT}:${t}`,c.CacheDelDirection.PARENT_TO_CHILD),await a.metaDelete(e.workspace_id,e.base_id,c.MetaTable.SORT,{fk_view_id:t});{const i=await p.default.get(e,t,a);await p.default.clearSingleQueryCache(e,i.fk_model_id,[i],a)}}static async insert(e,t,a=l.default.ncMeta){var i;const s=(0,u.extractProps)(t,["id","fk_view_id","fk_column_id","direction","base_id","source_id"]);s.order=t.push_to_top?1:(+(null===(i=await a.knex(c.MetaTable.SORT).max("order",{as:"order"}).where({fk_view_id:t.fk_view_id}).first())||void 0===i?void 0:i.order)||0)+1;const m=await r.default.get(e,{colId:t.fk_column_id},a);t.source_id||(s.source_id=m.source_id),t.push_to_top&&await a.knex(c.MetaTable.SORT).where({fk_view_id:t.fk_view_id}).increment("order",1);const _=await a.metaInsert2(e.workspace_id,e.base_id,c.MetaTable.SORT,s);if(t.push_to_top){const i=await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.SORT,{condition:{fk_view_id:t.fk_view_id},orderBy:{order:"asc"}});await d.default.setList(c.CacheScope.SORT,[t.fk_view_id],i)}{const t=await p.default.get(e,_.fk_view_id,a);await p.default.clearSingleQueryCache(e,t.fk_model_id,[t],a)}return this.get(e,_.id,a).then((async e=>(t.push_to_top||(await d.default.appendToList(c.CacheScope.SORT,[t.fk_view_id],`${c.CacheScope.SORT}:${_.id}`),await d.default.appendToList(c.CacheScope.SORT,[t.fk_column_id],`${c.CacheScope.SORT}:${_.id}`)),e)))}getColumn(e,t=l.default.ncMeta){return this.fk_column_id?r.default.get(e,{colId:this.fk_column_id},t):null}static async list(e,{viewId:t},a=l.default.ncMeta){if(!t)return null;const i=await d.default.getList(c.CacheScope.SORT,[t]);let{list:s}=i;const{isNoneList:r}=i;return r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,c.MetaTable.SORT,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),await d.default.setList(c.CacheScope.SORT,[t],s)),s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),s.map((e=>new Sort(e)))}static async update(e,t,a,i=l.default.ncMeta){const s=await i.metaUpdate(e.workspace_id,e.base_id,c.MetaTable.SORT,{fk_column_id:a.fk_column_id,direction:a.direction},t);await d.default.update(`${c.CacheScope.SORT}:${t}`,{fk_column_id:a.fk_column_id,direction:a.direction});{const a=await this.get(e,t,i),s=await p.default.get(e,a.fk_view_id,i);await p.default.clearSingleQueryCache(e,s.fk_model_id,[s],i)}return s}static async delete(e,t,a=l.default.ncMeta){const i=await this.get(e,t,a);if(await a.metaDelete(e.workspace_id,e.base_id,c.MetaTable.SORT,t),await d.default.deepDel(`${c.CacheScope.SORT}:${t}`,c.CacheDelDirection.CHILD_TO_PARENT),null==i?void 0:i.fk_view_id){const t=await p.default.get(e,i.fk_view_id,a);await p.default.clearSingleQueryCache(e,t.fk_model_id,[t],a)}}static async get(e,t,a=l.default.ncMeta){let i=t&&await d.default.get(`${c.CacheScope.SORT}:${t}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,c.MetaTable.SORT,t),await d.default.set(`${c.CacheScope.SORT}:${t}`,i)),i&&new Sort(i)}async getModel(e,t=l.default.ncMeta){return s.default.getByIdOrName(e,{id:this.fk_view_id},t)}}t.default=Sort},16708:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=a(81104),l=a(19684),c=i(a(57804)),d=a(64612),u=i(a(76584)),p=a(70220),m=a(43820),_=i(a(82096)),f=a(26944),h=a(89604),g=a(81472),y=i(a(70176)),b=a(62304);class Source{constructor(e){Object.assign(this,e)}static castType(e){return e&&new Source(e)}static encryptConfigIfRequired(e){e.config=(0,b.encryptPropIfRequired)({data:e}),e.is_encrypted=(0,b.isEncryptionRequired)()}static async createBase(e,t,a=u.default.ncMeta){const i=(0,p.extractProps)(t,["id","alias","config","type","is_meta","is_local","inflection_column","inflection_table","order","enabled","meta","is_schema_readonly","is_data_readonly","fk_integration_id","is_encrypted"]);this.encryptConfigIfRequired(i),"meta"in i&&(i.meta=(0,f.stringifyMetaProp)(i)),i.order=await a.metaGetNextOrder(d.MetaTable.SOURCES,{base_id:t.baseId});const{id:s}=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.SOURCES,i),r=await this.get(e,s,!1,a);return await c.default.appendToList(d.CacheScope.SOURCE,[t.baseId],`${d.CacheScope.SOURCE}:${s}`),r}static async update(e,t,a,i=u.default.ncMeta){const s=await this.get(e,t,!1,i);s||m.NcError.sourceNotFound(t);const r=(0,p.extractProps)(a,["alias","config","type","is_meta","is_local","inflection_column","inflection_table","order","enabled","meta","deleted","fk_sql_executor_id","is_schema_readonly","is_data_readonly","fk_integration_id","is_encrypted"]);return r.config&&this.encryptConfigIfRequired(r),r.type||(r.type=s.type),"meta"in r&&(r.meta=(0,f.stringifyMetaProp)(r)),s.order||r.order||(r.order=await i.metaGetNextOrder(d.MetaTable.SOURCES,{base_id:s.base_id}),r.order<=1&&!s.isMeta()&&(r.order=2)),s.isMeta()&&(r.order=1),s.isMeta()||(r.order<=1&&m.NcError.badRequest("Cannot change order to 1 or less"),s.order<=1&&!r.order&&(r.order=await i.metaGetNextOrder(d.MetaTable.SOURCES,{base_id:s.base_id}))),await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.SOURCES,(0,f.prepareForDb)(r),s.id),await c.default.update(`${d.CacheScope.SOURCE}:${t}`,(0,f.prepareForResponse)(r)),this.updateRelatedCaches(e,t,i).catch((e=>{console.error(e)})),h.JobsRedis.available&&(await h.JobsRedis.emitWorkerCommand(g.InstanceCommands.RELEASE,t),await h.JobsRedis.emitPrimaryCommand(g.InstanceCommands.RELEASE,t)),await this.get(e,s.id,!1,i)}static async list(e,t,a=u.default.ncMeta){const i=await c.default.getList(d.CacheScope.SOURCE,[t.baseId]);let{list:s}=i;const{isNoneList:r}=i;if(!r&&!s.length){const i=a.knex(d.MetaTable.SOURCES).select(`${d.MetaTable.SOURCES}.*`).where(`${d.MetaTable.SOURCES}.base_id`,e.base_id).where((e=>{e.where(`${d.MetaTable.SOURCES}.deleted`,!1).orWhereNull(`${d.MetaTable.SOURCES}.deleted`)})).orderBy(`${d.MetaTable.SOURCES}.order`,"asc");this.extendQb(i,e),s=await i;for(const e of s)e.meta=(0,f.parseMetaProp)(e,"meta");await c.default.setList(d.CacheScope.SOURCE,[t.baseId],s)}return s.sort(((e,t)=>{var a,i;return(null!==(a=null==e?void 0:e.order)&&void 0!==a?a:1/0)-(null!==(i=null==t?void 0:t.order)&&void 0!==i?i:1/0)})),null==s?void 0:s.map((e=>this.castType(e)))}static async get(e,t,a=!1,i=u.default.ncMeta){let s=t&&await c.default.get(`${d.CacheScope.SOURCE}:${t}`,d.CacheGetType.TYPE_OBJECT);if(!s){const r=i.knex(d.MetaTable.SOURCES).select(`${d.MetaTable.SOURCES}.*`).where(`${d.MetaTable.SOURCES}.id`,t).where(`${d.MetaTable.SOURCES}.base_id`,e.base_id);this.extendQb(r,e),a||r.where((e=>{e.where(`${d.MetaTable.SOURCES}.deleted`,!1).orWhereNull(`${d.MetaTable.SOURCES}.deleted`)})),s=await r.first(),s&&(s.meta=(0,f.parseMetaProp)(s,"meta")),await c.default.set(`${d.CacheScope.SOURCE}:${t}`,s)}return this.castType(s)}async getConnectionConfig(){var e;if(this.is_meta||this.is_local){const e=await _.default.getDataConfig(),t=Object.assign({},e);return"sqlite3"===t.client&&(t.connection=e),t}const t=this.getConfig();return"sqlite3"===(null==t?void 0:t.client)&&(t.connection.filename=t.connection.filename||(null===(e=t.connection)||void 0===e?void 0:e.connection.filename)),t}getConfig(e=!1){var t,a;if(this.is_meta){const e=null===(a=null===(t=u.default.getConfig())||void 0===t?void 0:t.meta)||void 0===a?void 0:a.db,i=Object.assign({},e);return"sqlite3"===i.client&&(i.connection=e),i}const i=(0,b.decryptPropIfRequired)({data:this});if(e)return i;if(!this.integration_config)return i;const s=(0,b.decryptPropIfRequired)({data:this,prop:"integration_config"});return(0,b.deepMerge)(s,(0,b.partialExtract)(i||{},[["connection","database"],["searchPath"]]))}getSourceConfig(){return this.getConfig(!0)}getProject(e,t=u.default.ncMeta){return l.Base.get(e,this.base_id,t)}async sourceCleanup(e=u.default.ncMeta){await _.default.deleteAwait(this),h.JobsRedis.available&&(await h.JobsRedis.emitWorkerCommand(g.InstanceCommands.RELEASE,this.id),await h.JobsRedis.emitPrimaryCommand(g.InstanceCommands.RELEASE,this.id))}async delete(e,t=u.default.ncMeta,{force:a}={}){(await Source.list(e,{baseId:this.base_id},t))[0].id!==this.id&&!this.isMeta()||a||m.NcError.badRequest("Cannot delete first source");const i=await l.Model.list(e,{source_id:this.id,base_id:this.base_id},t),r=[],p={[s.UITypes.Lookup]:1,[s.UITypes.Rollup]:2,[s.UITypes.ForeignKey]:3,[s.UITypes.LinkToAnotherRecord]:4};for(const a of i)for(const i of await a.getColumns(e,t)){let e=null,t=null;switch(i.uidt){case s.UITypes.Rollup:e=d.MetaTable.COL_ROLLUP,t=d.CacheScope.COL_ROLLUP;break;case s.UITypes.Lookup:e=d.MetaTable.COL_LOOKUP,t=d.CacheScope.COL_LOOKUP;break;case s.UITypes.ForeignKey:case s.UITypes.LinkToAnotherRecord:e=d.MetaTable.COL_RELATIONS,t=d.CacheScope.COL_RELATION}e&&t&&r.push({col:i,colOptionTableName:e,cacheScopeName:t})}r.sort(((e,t)=>p[e.col.uidt]-p[t.col.uidt]));for(const a of r)await t.metaDelete(e.workspace_id,e.base_id,a.colOptionTableName,{fk_column_id:a.col.id}),await c.default.deepDel(`${a.cacheScopeName}:${a.col.id}`,d.CacheDelDirection.CHILD_TO_PARENT);for(const a of i)await a.delete(e,t,!0);const _=await l.SyncSource.list(e,this.base_id,this.id,t);for(const a of _)await l.SyncSource.delete(e,a.id,t);await this.sourceCleanup(t);const f=await t.metaDelete(e.workspace_id,e.base_id,d.MetaTable.SOURCES,this.id);return await c.default.deepDel(`${d.CacheScope.SOURCE}:${this.id}`,d.CacheDelDirection.CHILD_TO_PARENT),f}async softDelete(e,t=u.default.ncMeta,{force:a}={}){(await Source.list(e,{baseId:this.base_id},t))[0].id!==this.id&&!this.isMeta()||a||m.NcError.badRequest("Cannot delete first base"),await Source.update(e,this.id,{deleted:!0},t),await c.default.deepDel(`${d.CacheScope.SOURCE}:${this.id}`,d.CacheDelDirection.CHILD_TO_PARENT)}async getModels(e,t=u.default.ncMeta){return await l.Model.list(e,{base_id:this.base_id,source_id:this.id},t)}async shareErd(e,t=u.default.ncMeta){if(!this.erd_uuid){const a=(0,r.v4)();this.erd_uuid=a,await t.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.SOURCES,{erd_uuid:this.erd_uuid},this.id),await c.default.update(`${d.CacheScope.SOURCE}:${this.id}`,{erd_uuid:this.erd_uuid})}return this}async disableShareErd(e,t=u.default.ncMeta){return this.erd_uuid&&(this.erd_uuid=null,await t.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.SOURCES,{erd_uuid:this.erd_uuid},this.id),await c.default.update(`${d.CacheScope.SOURCE}:${this.id}`,{erd_uuid:this.erd_uuid})),this}isMeta(e=!1,t=0){return e?0===t?this.is_meta:this.is_local:this.is_meta||this.is_local}static extendQb(e,t){e.select(`${d.MetaTable.INTEGRATIONS}.config as integration_config`,`${d.MetaTable.INTEGRATIONS}.title as integration_title`).leftJoin(d.MetaTable.INTEGRATIONS,`${d.MetaTable.SOURCES}.fk_integration_id`,`${d.MetaTable.INTEGRATIONS}.id`)}static async updateRelatedCaches(e,t,a=u.default.ncMeta){const i=await l.Model.list(e,{source_id:t,base_id:e.base_id},a);for(const t of i)await y.default.clearSingleQueryCache(e,t.id,null,a)}}t.default=Source},21960:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(43820),r=a(70220),l=i(a(76584)),c=a(64612),d=i(a(57804));class Store{constructor(e){Object.assign(this,e)}static async get(e,t=!1,a=l.default.ncMeta){if(t){const t=e&&await d.default.get(`${c.CacheScope.STORE}:${e}`,c.CacheGetType.TYPE_OBJECT);if(t)return t}const i=await a.metaGet(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.STORE,{key:e});return t&&await d.default.set(`${c.CacheScope.STORE}:${e}`,i),i}static async saveOrUpdate(e,t=l.default.ncMeta){e.key||s.NcError.badRequest("Key is required");const a=(0,r.extractProps)(e,["key","value","type","env","tag"]);await Store.get(e.key,!1,t)?await t.metaUpdate(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.STORE,a,{key:e.key}):await t.metaInsert2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.STORE,a,!0),e.key&&await d.default.del(`${c.CacheScope.STORE}:${e.key}`)}}t.default=Store},33612:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76584)),r=a(70220),l=a(64612);class SyncLogs{constructor(e){Object.assign(this,e)}static async list(e,t,a=s.default.ncMeta){const i=await a.metaList2(e.workspace_id,e.base_id,l.MetaTable.SYNC_LOGS,{condition:{base_id:t},orderBy:{created_at:"asc"}});return null==i?void 0:i.map((e=>new SyncLogs(e)))}static async insert(e,t,a=s.default.ncMeta){const i=(0,r.extractProps)(t,["base_id","fk_sync_source_id","time_taken","status","status_details"]),{id:c}=await a.metaInsert2(e.workspace_id,e.base_id,l.MetaTable.SYNC_LOGS,i);return new SyncLogs(Object.assign(Object.assign({},i),{id:c}))}}t.default=SyncLogs},83108:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(97844)),r=a(43820),l=i(a(76584)),c=a(70220),d=a(64612);class SyncSource{constructor(e){Object.assign(this,e)}getUser(e=l.default.ncMeta){return s.default.get(this.fk_user_id,e)}static async get(e,t,a=l.default.ncMeta){const i=await a.metaGet2(e.workspace_id,e.base_id,d.MetaTable.SYNC_SOURCE,t);if(i.details&&"string"==typeof i.details)try{i.details=JSON.parse(i.details)}catch(e){}return i&&new SyncSource(i)}static async list(e,t,a,i=l.default.ncMeta){const s=a?{base_id:t,source_id:a}:{base_id:t},r=await i.metaList2(e.workspace_id,e.base_id,d.MetaTable.SYNC_SOURCE,{condition:s,orderBy:{created_at:"asc"}});for(const e of r)if(e.details&&"string"==typeof e.details)try{e.details=JSON.parse(e.details)}catch(e){}return null==r?void 0:r.map((e=>new SyncSource(e)))}static async insert(e,t,a=l.default.ncMeta){const i=(0,c.extractProps)(t,["id","title","type","details","base_id","source_id","fk_user_id"]);i.details&&"object"==typeof i.details&&(i.details=JSON.stringify(i.details));const{id:s}=await a.metaInsert2(e.workspace_id,e.base_id,d.MetaTable.SYNC_SOURCE,i);return this.get(e,s,a)}static async update(e,t,a,i=l.default.ncMeta){const s=(0,c.extractProps)(a,["id","title","type","details","deleted","order","base_id","source_id"]);return s.details&&"object"==typeof s.details&&(s.details=JSON.stringify(s.details)),await i.metaUpdate(e.workspace_id,e.base_id,d.MetaTable.SYNC_SOURCE,s,t),this.get(e,t,i)}static async delete(e,t,a=l.default.ncMeta){return await a.metaDelete(e.workspace_id,e.base_id,d.MetaTable.SYNC_SOURCE,t)}static async deleteByUserId(e,t=l.default.ncMeta){return e||r.NcError.badRequest("User Id is required"),await t.knex(d.MetaTable.SYNC_SOURCE).where({fk_user_id:e}).del()}}t.default=SyncSource},97844:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=a(43820),l=i(a(76584)),c=a(70220),d=i(a(57804)),u=a(64612),p=a(19684),m=a(62304);class User{constructor(e){Object.assign(this,e)}static castType(e){return e&&new User(e)}static async insert(e,t=l.default.ncMeta){const a=(0,c.extractProps)(e,["id","email","password","salt","invite_token","invite_token_expires","reset_password_expires","reset_password_token","email_verification_token","email_verified","roles","token_version"]);a.email&&(a.email=a.email.toLowerCase());const{id:i}=await t.metaInsert2(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,a);await d.default.del(u.CacheScope.INSTANCE_META);const s=await p.Base.list(null,t);for(const e of s)await d.default.deepDel(`${u.CacheScope.BASE_USER}:${e.id}:list`,u.CacheDelDirection.PARENT_TO_CHILD);return this.get(i,t)}static async update(e,t,a=l.default.ncMeta){var i,s;const p=(0,c.extractProps)(t,["email","password","salt","invite_token","invite_token_expires","reset_password_expires","reset_password_token","email_verification_token","email_verified","roles","token_version","display_name","avatar"]);if(p.email){p.email=p.email.toLowerCase();const t=await this.getByEmail(p.email,a);t&&t.id!==e&&r.NcError.badRequest("email is in use")}else p.email=null===(s=null===(i=await this.get(e,a))||void 0===i?void 0:i.email)||void 0===s?void 0:s.toLowerCase();const m=await this.get(e,a);return await d.default.del(`${u.CacheScope.USER}:${m.email}`),await a.metaUpdate(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,p,e),await this.clearCache(e,a),this.get(e,a)}static async getByEmail(e,t=l.default.ncMeta){const a=null==e?void 0:e.toLowerCase();let i=a&&await d.default.get(`${u.CacheScope.USER}:${a}`,u.CacheGetType.TYPE_OBJECT);return i||(i=await t.metaGet2(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,{email:a}),await d.default.set(`${u.CacheScope.USER}:${a}`,i)),this.castType(i)}static async isFirst(e=l.default.ncMeta){return!await e.metaGet2(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,{})}static async count({query:e=""}={},t=l.default.ncMeta){var a;const i=t.knex(u.MetaTable.USERS);return e&&i.where("email","like",`%${null===(a=e.toLowerCase)||void 0===a?void 0:a.call(e)}%`),(await i.count("id",{as:"count"}).first()).count}static async get(e,t=l.default.ncMeta){let a=e&&await d.default.get(`${u.CacheScope.USER}:${e}`,u.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,e),await d.default.set(`${u.CacheScope.USER}:${e}`,a)),this.castType(a)}static async getByRefreshToken(e,t=l.default.ncMeta){const a=await p.UserRefreshToken.getByToken(e,t);return a?await t.metaGet2(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,a.fk_user_id):null}static async list({limit:e,offset:t,query:a=""}={},i=l.default.ncMeta){let s=i.knex(u.MetaTable.USERS);return t&&(s=s.offset(t)),e&&(s=s.limit(e)),s=s.select(`${u.MetaTable.USERS}.id`,`${u.MetaTable.USERS}.email`,`${u.MetaTable.USERS}.email_verified`,`${u.MetaTable.USERS}.invite_token`,`${u.MetaTable.USERS}.created_at`,`${u.MetaTable.USERS}.updated_at`,`${u.MetaTable.USERS}.roles`,`${u.MetaTable.USERS}.display_name`).select(i.knex(u.MetaTable.PROJECT_USERS).count().whereRaw(`${u.MetaTable.USERS}.id = ${u.MetaTable.PROJECT_USERS}.fk_user_id`).as("projectsCount")),a&&s.where((function(){this.where((function(){this.whereNotNull("display_name").andWhereNot("display_name","").andWhere("display_name","like",`%${a.toLowerCase()}%`)})).orWhere((function(){this.where("email","like",`%${a.toLowerCase()}%`)}))})),s}static async delete(e,t=l.default.ncMeta){e||r.NcError.badRequest("userId is required");return await this.get(e,t)||r.NcError.userNotFound(e),await this.clearCache(e,t),await t.metaDelete(u.RootScopes.ROOT,u.RootScopes.ROOT,u.MetaTable.USERS,e)}static async getWithRoles(e,t,a,i=l.default.ncMeta){var c;const d=null!==(c=a.user)&&void 0!==c?c:await this.get(t,i);d||r.NcError.userNotFound(t);const u=await new Promise((t=>{a.baseId?p.BaseUser.get(e,a.baseId,d.id).then((async e=>{const a=null==e?void 0:e.roles;t(a?(0,s.extractRolesObj)(a):null)})):t(null)}));return Object.assign(Object.assign({},(0,m.sanitiseUserObj)(d)),{roles:d.roles?(0,s.extractRolesObj)(d.roles):null,base_roles:u||null})}static async clearCache(e,t=l.default.ncMeta){const a=await this.get(e,t);a||r.NcError.userNotFound(e);const i=await p.BaseUser.getProjectsList(e,{},t);for(const e of i)await d.default.deepDel(`${u.CacheScope.BASE_USER}:${e.id}:list`,u.CacheDelDirection.PARENT_TO_CHILD);await d.default.del(`${u.CacheScope.USER}:${e}`),await d.default.del(`${u.CacheScope.USER}:${a.email}`)}}t.default=User},4788:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(44578)),r=i(a(76584)),l=a(70220),c=a(64612),d=a(26944),u=parseInt(process.env.NC_REFRESH_TOKEN_EXP_IN_DAYS,10)||90;if(u<=0)throw new Error("NC_REFRESH_TOKEN_EXP_IN_DAYS must be a positive number");t.default=class UserRefreshToken{static async insert(e,t=r.default.ncMeta){await t.metaDelete(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.USER_REFRESH_TOKENS,{fk_user_id:e.fk_user_id},{expires_at:{lt:(0,s.default)().toDate()}});const a=(0,l.extractProps)(e,["fk_user_id","token","expires_at","meta"]);return"expires_at"in a||(a.expires_at=(0,s.default)().add(u,"day").toDate()),"meta"in a&&(a.meta=(0,d.stringifyMetaProp)(a)),await t.metaInsert2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.USER_REFRESH_TOKENS,a,!0),a}static async updateOldToken(e,t,a=r.default.ncMeta){return await a.metaUpdate(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.USER_REFRESH_TOKENS,{token:t,expires_at:(0,s.default)().add(u,"day").toDate()},{token:e})}static async deleteToken(e,t=r.default.ncMeta){return await t.metaDelete(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.USER_REFRESH_TOKENS,{token:e})}static async deleteAllUserToken(e,t=r.default.ncMeta){return await t.metaDelete(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.USER_REFRESH_TOKENS,{fk_user_id:e})}static async getByToken(e,t=r.default.ncMeta){const a=await t.metaGet2(c.RootScopes.ROOT,c.RootScopes.ROOT,c.MetaTable.USER_REFRESH_TOKENS,{token:e});return a?(a.meta=(0,d.parseMetaProp)(a),a):null}}},70176:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=a(23324),l=i(a(84072)),c=i(a(18716)),d=i(a(66044)),u=i(a(36060)),p=i(a(39944)),m=i(a(35948)),_=i(a(92760)),f=i(a(28192)),h=i(a(91412)),g=i(a(95428)),y=i(a(22996)),b=i(a(56648)),w=i(a(95240)),v=i(a(52284)),T=i(a(57596)),k=i(a(40144)),S=i(a(4388)),M=a(70220),O=i(a(57804)),I=a(64612),C=i(a(76584)),E=a(26944),x=a(19684),L=a(24408),{v4:R}=a(81104),N=new r.Logger("View");class View{constructor(e){Object.assign(this,e)}static async get(e,t,a=C.default.ncMeta){let i=t&&await O.default.get(`${I.CacheScope.VIEW}:${t}`,I.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,t),i&&(i.meta=(0,E.parseMetaProp)(i),await O.default.set(`${I.CacheScope.VIEW}:${i.id}`,i))),i&&new View(i)}static async getByTitleOrId(e,{fk_model_id:t,titleOrId:a},i=C.default.ncMeta){const s=a&&await O.default.get(`${I.CacheScope.VIEW_ALIAS}:${t}:${a}`,I.CacheGetType.TYPE_STRING);if(!s){const s=await i.metaGet2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{fk_model_id:t},null,{_or:[{id:{eq:a}},{title:{eq:a}}]});return s&&(await O.default.set(`${I.CacheScope.VIEW}:${t}:${s.id}`,s),s.meta=(0,E.parseMetaProp)(s),await O.default.set(`${I.CacheScope.VIEW_ALIAS}:${t}:${a}`,s.id)),s&&new View(s)}return s&&this.get(e,(null==s?void 0:s.id)||s)}static async getDefaultView(e,t,a=C.default.ncMeta){let i=t&&await O.default.get(`${I.CacheScope.VIEW}:${t}:default`,I.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{fk_model_id:t,is_default:1},null),i&&(i.meta=(0,E.parseMetaProp)(i),await O.default.set(`${I.CacheScope.VIEW}:${t}:default`,i))),i&&new View(i)}static async list(e,t,a=C.default.ncMeta){const i=await O.default.getList(I.CacheScope.VIEW,[t]);let{list:s}=i;const{isNoneList:r}=i;if(!r&&!s.length){s=await a.metaList2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{condition:{fk_model_id:t},orderBy:{order:"asc"}});for(const e of s)e.meta=(0,E.parseMetaProp)(e);await O.default.setList(I.CacheScope.VIEW,[t],s)}return s.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==s?void 0:s.map((e=>new View(e)))}static async insert(e,t,a=C.default.ncMeta){const i=(0,M.extractProps)(t,["id","title","is_default","description","type","fk_model_id","base_id","source_id","meta"]);i.order=await a.metaGetNextOrder(I.MetaTable.VIEWS,{fk_model_id:t.fk_model_id}),i.show=!0,i.meta||(i.meta={}),i.meta=(0,E.stringifyMetaProp)(i);const r=await l.default.getByIdOrName(e,{id:t.fk_model_id},a);t.source_id||(i.source_id=r.source_id);const _=t.copy_from_id&&await View.get(e,t.copy_from_id,a);await(null==_?void 0:_.getView(e));const{id:f}=await a.metaInsert2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,i);let b=await(await l.default.getByIdOrName(e,{id:t.fk_model_id},a)).getColumns(e,a);switch(t.type){case s.ViewTypes.GRID:await d.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:f}),a);break;case s.ViewTypes.MAP:await k.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:f}),a);break;case s.ViewTypes.GALLERY:await p.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:f}),a);break;case s.ViewTypes.FORM:await c.default.insert(e,Object.assign(Object.assign(Object.assign({heading:t.title},(null==_?void 0:_.view)||{}),t),{fk_view_id:f}),a);break;case s.ViewTypes.KANBAN:t.fk_grp_col_id=t.fk_grp_col_id,await u.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:f}),a);break;case s.ViewTypes.CALENDAR:{const i=(0,M.extractProps)(t,["calendar_range"]);if(!i.calendar_range)break;const s=i.calendar_range;s.forEach((e=>{e.fk_view_id=f})),await m.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:f}),a),await h.default.bulkInsert(e,s,a)}}if(_){const t=await _.getSorts(e,a),i=await _.getFilters(e,a);b=await _.getColumns(e,a);for(const i of t)await g.default.insert(e,Object.assign(Object.assign({},(0,M.extractProps)(i,["fk_column_id","direction","base_id","source_id","order"])),{fk_view_id:f,id:null}),a);for(const t of i.children)await y.default.insert(e,Object.assign(Object.assign({},(0,M.extractProps)(t,["id","fk_parent_column_id","fk_column_id","comparison_op","comparison_sub_op","value","fk_parent_id","is_group","logical_op","base_id","source_id","order"])),{fk_view_id:f,id:null}),a)}{let i=1,r=0,l=0,c=null;t.type===s.ViewTypes.CALENDAR&&(c=await View.getRangeColumnsAsArray(e,f,a)),t.type!==s.ViewTypes.KANBAN||_||b.sort(((e,t)=>{const a=t.pv-e.pv,i=+(t.uidt===s.UITypes.Attachment)-+(e.uidt===s.UITypes.Attachment),r=+(t.uidt===s.UITypes.SingleLineText)-+(e.uidt===s.UITypes.SingleLineText),l=+(t.uidt===s.UITypes.Number)-+(e.uidt===s.UITypes.Number),c=t.order-e.order;return a||i||r||l||c}));for(const d of b){let h=!("show"in d)||d.show;const g=!1,y=!1,b=!1;if(t.type===s.ViewTypes.GALLERY){const t=await p.default.get(e,f,a);d.id===t.fk_cover_image_col_id||d.pv||r<3?(h=!0,r++):h=!1}else if(t.type!==s.ViewTypes.KANBAN||_)if(t.type!==s.ViewTypes.CALENDAR||_){if(t.type===s.ViewTypes.MAP&&!_){const t=await k.default.get(e,f,a);d.id===(null==t?void 0:t.fk_geo_data_col_id)&&(h=!0)}}else{const t=await m.default.get(e,f,a);h=!(!c||!c.includes(d.id))||(d.id===(null==t?void 0:t.fk_cover_image_col_id)||d.pv)}else{const t=await u.default.get(e,f,a);d.id===(null==t?void 0:t.fk_grp_col_id)?h=!0:d.id===t.fk_cover_image_col_id||d.pv||l<3&&!(0,s.isSystemColumn)(d)?(h=!0,l++):h=!1}const w=d.fk_column_id?await T.default.get(e,{colId:d.fk_column_id},a):d;(0,s.isSystemColumn)(w)&&(h=!1),await View.insertColumn(e,Object.assign(Object.assign(Object.assign({order:i++},w),d),{view_id:f,fk_column_id:d.fk_column_id||d.id,show:h,underline:g,bold:y,italic:b,id:null}),a)}}return await l.default.getNonDefaultViewsCountAndReset(e,{modelId:t.fk_model_id},a),(0,L.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{N.error("Failed to clean command palette cache")})),View.get(e,f,a).then((async e=>(await O.default.appendToList(I.CacheScope.VIEW,[t.fk_model_id],`${I.CacheScope.VIEW}:${f}`),e)))}static async getRangeColumnsAsArray(e,t,a){const i=await h.default.read(e,t,a);if(i){const e=new Set;return i.ranges.forEach((t=>{e.add(t.fk_from_column_id)})),Array.from(e)}return[]}static async insertColumnToAllViews(e,t,a=C.default.ncMeta){var i,r,l,c,d;const u={fk_column_id:t.fk_column_id,fk_model_id:t.fk_model_id,order:t.order,show:t.column_show.show},p=await this.list(e,t.fk_model_id,a),m=await T.default.list(e,{fk_model_id:t.fk_model_id},a),h=new Map(m.map((e=>[e.id,e])));for(const m of p){const p=Object.assign(Object.assign({},u),{fk_view_id:m.id});if((null===(i=t.column_show)||void 0===i?void 0:i.view_id)===m.id)p.show=!0;else if(m.uuid);else if(m.type===s.ViewTypes.GALLERY){const t=null===(r=await b.default.list(e,m.id,a))||void 0===r?void 0:r.filter((e=>e.show&&!(0,s.isSystemColumn)(h.get(e.fk_column_id)))).length;p.show=t<3}else if(m.type===s.ViewTypes.KANBAN){const t=null===(l=await v.default.list(e,m.id,a))||void 0===l?void 0:l.filter((e=>e.show&&!(0,s.isSystemColumn)(h.get(e.fk_column_id)))).length;p.show=t<3}else m.type!==s.ViewTypes.FORM&&(p.show=!0);switch((null===(c=t.column_order)||void 0===c?void 0:c.view_id)===m.id&&(p.order=null===(d=t.column_order)||void 0===d?void 0:d.order),m.type){case s.ViewTypes.GRID:await _.default.insert(e,p,a);break;case s.ViewTypes.GALLERY:await b.default.insert(e,p,a);break;case s.ViewTypes.MAP:await S.default.insert(e,Object.assign(Object.assign({},u),{fk_view_id:m.id}),a);break;case s.ViewTypes.KANBAN:await v.default.insert(e,p,a);break;case s.ViewTypes.CALENDAR:await f.default.insert(e,Object.assign(Object.assign({},u),{fk_view_id:m.id}),a);break;case s.ViewTypes.FORM:await w.default.insert(e,p,a)}}}static async insertColumn(e,t,a=C.default.ncMeta){const i=await this.get(e,t.view_id,a);let r;switch(i.type){case s.ViewTypes.GRID:r=await _.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:i.id}),a);break;case s.ViewTypes.GALLERY:r=await b.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:i.id}),a);break;case s.ViewTypes.MAP:r=await S.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:i.id}),a);break;case s.ViewTypes.FORM:r=await w.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:i.id}),a);break;case s.ViewTypes.KANBAN:r=await v.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:i.id}),a);break;case s.ViewTypes.CALENDAR:r=await f.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:i.id}),a)}return r}static async listWithInfo(e,t,a=C.default.ncMeta){const i=await this.list(e,t,a);for(const t of i)await t.getViewWithInfo(e,a);return i}static async getColumns(e,t,a=C.default.ncMeta){let i=[];switch((await this.get(e,t,a)).type){case s.ViewTypes.GRID:i=await _.default.list(e,t,a);break;case s.ViewTypes.GALLERY:i=await b.default.list(e,t,a);break;case s.ViewTypes.MAP:i=await S.default.list(e,t,a);break;case s.ViewTypes.FORM:i=await w.default.list(e,t,a);break;case s.ViewTypes.KANBAN:i=await v.default.list(e,t,a);break;case s.ViewTypes.CALENDAR:i=await f.default.list(e,t,a)}return i}static async getViewColumnId(e,{viewId:t,colId:a},i=C.default.ncMeta){const r=await this.get(e,t);if(!r)return;let l,c;switch(r.type){case s.ViewTypes.GRID:l=I.MetaTable.GRID_VIEW_COLUMNS,c=I.CacheScope.GRID_VIEW_COLUMN;break;case s.ViewTypes.GALLERY:l=I.MetaTable.GALLERY_VIEW_COLUMNS,c=I.CacheScope.GALLERY_VIEW_COLUMN;break;case s.ViewTypes.MAP:l=I.MetaTable.MAP_VIEW_COLUMNS,c=I.CacheScope.MAP_VIEW_COLUMN;break;case s.ViewTypes.FORM:l=I.MetaTable.FORM_VIEW_COLUMNS,c=I.CacheScope.FORM_VIEW_COLUMN;break;case s.ViewTypes.KANBAN:l=I.MetaTable.KANBAN_VIEW_COLUMNS,c=I.CacheScope.KANBAN_VIEW_COLUMN;break;case s.ViewTypes.CALENDAR:l=I.MetaTable.CALENDAR_VIEW_COLUMNS,c=I.CacheScope.CALENDAR_VIEW_COLUMN}const d=`${c}:viewColumnId:${a}`,u=await O.default.get(d,I.CacheGetType.TYPE_STRING);if(u)return u;const p=await i.metaGet2(e.workspace_id,e.base_id,l,{fk_view_id:t,fk_column_id:a});return p?(await O.default.set(d,p.id),p.id):void 0}static async updateColumn(e,t,a,i,r=C.default.ncMeta){const l=await this.get(e,t,r);let c,d;switch(l.type){case s.ViewTypes.GRID:c=I.MetaTable.GRID_VIEW_COLUMNS,d=I.CacheScope.GRID_VIEW_COLUMN;break;case s.ViewTypes.MAP:c=I.MetaTable.MAP_VIEW_COLUMNS,d=I.CacheScope.MAP_VIEW_COLUMN;break;case s.ViewTypes.GALLERY:c=I.MetaTable.GALLERY_VIEW_COLUMNS,d=I.CacheScope.GALLERY_VIEW_COLUMN;break;case s.ViewTypes.KANBAN:c=I.MetaTable.KANBAN_VIEW_COLUMNS,d=I.CacheScope.KANBAN_VIEW_COLUMN;break;case s.ViewTypes.FORM:c=I.MetaTable.FORM_VIEW_COLUMNS,d=I.CacheScope.FORM_VIEW_COLUMN;break;case s.ViewTypes.CALENDAR:c=I.MetaTable.CALENDAR_VIEW_COLUMNS,d=I.CacheScope.CALENDAR_VIEW_COLUMN}let u=(0,M.extractProps)(i,["order","show"]);if(l.type===s.ViewTypes.GRID){const t=await r.metaGet2(e.workspace_id,e.base_id,I.MetaTable.COLUMNS,{fk_model_id:l.fk_model_id,pv:!0}),i=await r.metaGet2(e.workspace_id,e.base_id,I.MetaTable.GRID_VIEW_COLUMNS,{fk_view_id:l.id,fk_column_id:t.id});i&&i.id===a&&(u.order=1,u.show=!0)}l.type===s.ViewTypes.CALENDAR&&(u=Object.assign(Object.assign({},u),(0,M.extractProps)(i,["underline","bold","italic"])));const p=await r.metaUpdate(e.workspace_id,e.base_id,c,u,a);return await O.default.update(`${d}:${a}`,u),await View.clearSingleQueryCache(e,l.fk_model_id,[l],r),p}static async insertOrUpdateColumn(e,t,a,i,r=C.default.ncMeta){const l=await this.get(e,t,r),c=this.extractViewColumnsTableName(l),d=await r.metaGet2(e.workspace_id,e.base_id,c,{fk_view_id:t,fk_column_id:a});if(d)return await r.metaUpdate(e.workspace_id,e.base_id,c,{order:i.order,show:i.show},d.id),await View.clearSingleQueryCache(e,l.fk_model_id,[l],r),Object.assign(Object.assign({},d),i);switch(l.type){case s.ViewTypes.GRID:return await _.default.insert(e,{fk_view_id:t,fk_column_id:a,order:i.order,show:i.show},r);case s.ViewTypes.GALLERY:return await b.default.insert(e,{fk_view_id:t,fk_column_id:a,order:i.order,show:i.show},r);case s.ViewTypes.KANBAN:return await v.default.insert(e,{fk_view_id:t,fk_column_id:a,order:i.order,show:i.show},r);case s.ViewTypes.MAP:return await S.default.insert(e,{fk_view_id:t,fk_column_id:a,order:i.order,show:i.show},r);case s.ViewTypes.FORM:return await w.default.insert(e,{fk_view_id:t,fk_column_id:a,order:i.order,show:i.show},r);case s.ViewTypes.CALENDAR:return await f.default.insert(e,{fk_view_id:t,fk_column_id:a,order:i.order,show:i.show},r)}return await r.metaInsert2(e.workspace_id,e.base_id,c,{source_id:l.source_id,fk_view_id:t,fk_column_id:a,order:i.order,show:i.show})}static async getByUUID(e,t,a=C.default.ncMeta){const i=await a.metaGet2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{uuid:t});return i&&(i.meta=(0,E.parseMetaProp)(i)),i&&new View(i)}static async share(e,t,a=C.default.ncMeta){var i;const s=await this.get(e,t);if(!s.uuid){const i=R();s.uuid=i,await a.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{uuid:s.uuid},t),await O.default.update(`${I.CacheScope.VIEW}:${s.id}`,{uuid:s.uuid})}if(!s.meta||!("allowCSVDownload"in s.meta)){const r=Object.assign(Object.assign({},null!==(i=s.meta)&&void 0!==i?i:{}),{allowCSVDownload:!0});s.meta=r,await a.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.VIEWS,(0,E.prepareForDb)({meta:r}),t),await O.default.update(`${I.CacheScope.VIEW}:${s.id}`,(0,E.prepareForResponse)({meta:r}))}return s}static async passwordUpdate(e,t,{password:a},i=C.default.ncMeta){await i.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{password:a},t),await O.default.update(`${I.CacheScope.VIEW}:${t}`,{password:a})}static async sharedViewDelete(e,t,a=C.default.ncMeta){await a.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{uuid:null},t),await O.default.update(`${I.CacheScope.VIEW}:${t}`,{uuid:null})}static async update(e,t,a,i=C.default.ncMeta){const r=(0,M.extractProps)(a,["title","order","description","show_system_fields","lock_type","password","meta","uuid"]),l=await this.get(e,t,i);await i.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.VIEWS,(0,E.prepareForDb)(r),t),await O.default.del(`${I.CacheScope.VIEW}:${l.fk_model_id}:${l.title}`),await O.default.update(`${I.CacheScope.VIEW}:${t}`,(0,E.prepareForResponse)(r)),l.is_default&&await O.default.update(`${I.CacheScope.VIEW}:${l.fk_model_id}:default`,(0,E.prepareForResponse)(r));const c=await this.get(e,t,i);return c.type===s.ViewTypes.GRID&&"show_system_fields"in r&&await View.fixPVColumnForView(e,t,i),await View.clearSingleQueryCache(e,c.fk_model_id,[c],i),(0,L.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{N.error("Failed to clean command palette cache")})),c}static async delete(e,t,a=C.default.ncMeta){const i=await this.get(e,t,a);await g.default.deleteAll(e,t,a),await y.default.deleteAll(e,t,a);const r=this.extractViewTableName(i),c=this.extractViewTableNameScope(i),d=this.extractViewColumnsTableName(i),u=this.extractViewColumnsTableNameScope(i);if(await a.metaDelete(e.workspace_id,e.base_id,d,{fk_view_id:t}),await a.metaDelete(e.workspace_id,e.base_id,r,{fk_view_id:t}),await a.metaDelete(e.workspace_id,e.base_id,I.MetaTable.VIEWS,t),await O.default.deepDel(`${c}:${t}`,I.CacheDelDirection.CHILD_TO_PARENT),i.type===s.ViewTypes.CALENDAR&&(await a.metaDelete(e.workspace_id,e.base_id,I.MetaTable.CALENDAR_VIEW_RANGE,{fk_view_id:t}),await O.default.deepDel(`${I.CacheScope.CALENDAR_VIEW_RANGE}:${t}`,I.CacheDelDirection.CHILD_TO_PARENT)),await O.default.deepDel(`${u}:${t}`,I.CacheDelDirection.CHILD_TO_PARENT),await O.default.deepDel(`${I.CacheScope.VIEW}:${t}`,I.CacheDelDirection.CHILD_TO_PARENT),await O.default.del([`${I.CacheScope.VIEW_ALIAS}:${i.fk_model_id}:${i.title}`,`${I.CacheScope.VIEW_ALIAS}:${i.fk_model_id}:${i.id}`]),null==i?void 0:i.id){const t=await a.metaList2(e.workspace_id,e.base_id,I.MetaTable.COL_RELATIONS,{condition:{fk_target_view_id:i.id}});for(const a of t)await x.LinkToAnotherRecordColumn.update(e,a.fk_column_id,{fk_target_view_id:null})}await View.clearSingleQueryCache(e,i.fk_model_id,[i],a),(0,L.cleanCommandPaletteCache)(e.workspace_id).catch((()=>{N.error("Failed to clean command palette cache")})),await l.default.getNonDefaultViewsCountAndReset(e,{modelId:i.fk_model_id},a)}static async showAllColumns(e,t,a=[],i=C.default.ncMeta){const s=await this.get(e,t),r=this.extractViewColumnsTableName(s),l=this.extractViewColumnsTableNameScope(s),c=await s.getModel(e,i).then((t=>t.getColumns(e,i))),d=await this.getColumns(e,t,i),u=d.map((e=>e.fk_column_id)),p=await O.default.getList(l,[t]),{list:m}=p,{isNoneList:_}=p;if(!_&&(null==m?void 0:m.length))for(const e of m)(null==a?void 0:a.length)&&a.includes(e.fk_column_id)||(e.show=!0,await O.default.set(`${l}:${e.id}`,e));for(const s of c){if(null==a?void 0:a.includes(s.id))continue;const l=u.indexOf(s.id);l>-1?await this.updateColumn(e,t,d[l].id,{show:!0},i):await this.insertColumn(e,{view_id:t,order:await i.metaGetNextOrder(r,{fk_view_id:t}),show:!0,fk_column_id:s.id},i)}}static async hideAllColumns(e,t,a=[],i=C.default.ncMeta){const r=await this.get(e,t,i),l=this.extractViewColumnsTableName(r),c=this.extractViewColumnsTableNameScope(r);if(r.type===s.ViewTypes.GRID){const t=await i.metaGet2(e.workspace_id,e.base_id,I.MetaTable.COLUMNS,{fk_model_id:r.fk_model_id,pv:!0});t&&a.push(t.id)}const d=await O.default.getList(c,[t]),{list:u}=d,{isNoneList:p}=d,m=r.type===s.ViewTypes.MAP?[(await k.default.get(e,t,i)).fk_geo_data_col_id]:[],_=[...a,...m];if(!p&&(null==u?void 0:u.length))for(const e of u)(null==_?void 0:_.length)&&_.includes(e.fk_column_id)||(e.show=!1,await O.default.set(`${c}:${e.id}`,e));return await i.metaUpdate(e.workspace_id,e.base_id,l,{show:!1},{fk_view_id:t},(null==_?void 0:_.length)?{_not:{fk_column_id:{in:a}}}:null)}static async shareViewList(e,t,a=C.default.ncMeta){const i=await O.default.getList(I.CacheScope.VIEW,[t]);let{list:s}=i;const{isNoneList:r}=i;return r||s.length||(s=await a.metaList2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{xcCondition:{fk_model_id:{eq:t},_not:{uuid:{eq:null}}}}),await O.default.setList(I.CacheScope.VIEW,[t],s)),s=s.filter((e=>null!==e.uuid)),null==s?void 0:s.map((e=>new View(e)))}static async fixPVColumnForView(e,t,a=C.default.ncMeta){const i=await a.metaList2(e.workspace_id,e.base_id,I.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),s=[];for(const t of i){const i=await a.metaGet2(e.workspace_id,e.base_id,I.MetaTable.COLUMNS,t.fk_column_id);i&&s.push(i)}const r=s.find((e=>e.pv));if(r){const t=i.find((e=>e.fk_column_id===r.id)),s=i.findIndex((e=>e.fk_column_id===r.id)),l=i.map((e=>e.order)),c=Math.min(...l);if(t.show||(await a.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.GRID_VIEW_COLUMNS,{show:!0},t.id),await O.default.set(`${I.CacheScope.GRID_VIEW_COLUMN}:${t.id}`,t)),t.order===c&&1===l.filter((e=>e===c)).length)return;if(0!==s){const e=i.splice(s,1);i.unshift(...e)}for(let t=0;t<i.length;t++)await a.metaUpdate(e.workspace_id,e.base_id,I.MetaTable.GRID_VIEW_COLUMNS,{order:t+1},i[t].id),await O.default.set(`${I.CacheScope.GRID_VIEW_COLUMN}:${i[t].id}`,i[t])}const l=await a.metaList2(e.workspace_id,e.base_id,I.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}});await O.default.setList(I.CacheScope.GRID_VIEW_COLUMN,[t],l)}static async clearSingleQueryCache(e,t,a,i=C.default.ncMeta){if(!C.default.isEE())return;let s=a||(await O.default.getList(I.CacheScope.VIEW,[t])).list;a||(null==s?void 0:s.length)||(s=await i.metaList2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,{condition:{fk_model_id:t}}));const r=[];for(const e of s)r.push(`${I.CacheScope.SINGLE_QUERY}:${t}:${e.id}:queries`,`${I.CacheScope.SINGLE_QUERY}:${t}:${e.id}:count`,`${I.CacheScope.SINGLE_QUERY}:${t}:${e.id}:read`);r.push(`${I.CacheScope.SINGLE_QUERY}:${t}:default:queries`,`${I.CacheScope.SINGLE_QUERY}:${t}:default:count`,`${I.CacheScope.SINGLE_QUERY}:${t}:default:read`),await O.default.del(r)}static async bulkColumnInsertToViews(e,{columns:t,viewColumns:a,copyFromView:i},r,l=C.default.ncMeta){const c=[];if(a)for(let e=0;e<a.length;e++){const t=r.type===s.ViewTypes.FORM?(0,E.prepareForDb)(a[e]):a[e];c.push(Object.assign(Object.assign({},(0,M.extractProps)(t,["fk_view_id","fk_column_id","show","base_id","source_id","order",...r.type===s.ViewTypes.CALENDAR?["bold","italic","underline"]:[],...r.type===s.ViewTypes.FORM?["label","help","description","required","enable_scanner","meta"]:["width","group_by","group_by_order","group_by_sort","aggregation"]])),{fk_view_id:r.id,base_id:r.base_id,source_id:r.source_id}))}else{t||(t=await T.default.list(e,{fk_model_id:r.fk_model_id})),i||t.sort(((e,t)=>+t.pv-+e.pv));let a,d=1,m=0,_=0;if(r.type==s.ViewTypes.CALENDAR){const t=await h.default.read(e,r.id,l);t&&(a=t.ranges.map((e=>[e.fk_from_column_id,e.fk_to_column_id])).flat())}for(let f=0;f<t.length;f++){const h=t[f];let g=!("show"in h)||h.show;const y=s.CommonAggregations.None;if(r.type===s.ViewTypes.GALLERY){const t=await p.default.get(e,r.id,l);h.id===t.fk_cover_image_col_id&&h.pv||h.id!==t.fk_cover_image_col_id&&(h.pv||m<3)?(g=!0,m++):g=!1}else if(r.type!==s.ViewTypes.KANBAN||i)if(r.type!==s.ViewTypes.MAP||i){if(r.type===s.ViewTypes.FORM&&(0,s.isSystemColumn)(h))g=!1;else if(r.type===s.ViewTypes.CALENDAR){if(!a)break;a.includes(h.id)&&(g=!0)}}else{const t=await k.default.get(e,r.id,l);h.id===(null==t?void 0:t.fk_geo_data_col_id)&&(g=!0)}else{const t=await u.default.get(e,r.id,l);h.id===(null==t?void 0:t.fk_grp_col_id)&&h.pv?g=!0:h.id===t.fk_cover_image_col_id&&h.pv||h.id!==t.fk_cover_image_col_id&&h.pv||h.id!==t.fk_cover_image_col_id&&_<3&&!(0,s.isSystemColumn)(h)?(g=!0,_++):g=!1}c.push(Object.assign({fk_column_id:h.id,order:d++,show:g,fk_view_id:r.id,base_id:r.base_id,source_id:r.source_id},r.type===s.ViewTypes.GRID?{aggregation:y}:{}))}}switch(r.type){case s.ViewTypes.GRID:await l.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.GRID_VIEW_COLUMNS,c);break;case s.ViewTypes.GALLERY:await l.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.GALLERY_VIEW_COLUMNS,c);break;case s.ViewTypes.MAP:await l.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.MAP_VIEW_COLUMNS,c);break;case s.ViewTypes.KANBAN:await l.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.KANBAN_VIEW_COLUMNS,c);break;case s.ViewTypes.FORM:await l.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.FORM_VIEW_COLUMNS,c);break;case s.ViewTypes.CALENDAR:await l.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.CALENDAR_VIEW_COLUMNS,c)}}static async insertMetaOnly(e,t,a,i=C.default.ncMeta){const r=(0,M.extractProps)(t,["id","title","is_default","description","type","fk_model_id","base_id","source_id","meta"]);r.order||(r.order=await i.metaGetNextOrder(I.MetaTable.VIEWS,{fk_model_id:t.fk_model_id})),r.show=!0,r.meta||(r.meta={}),r.meta=(0,E.stringifyMetaProp)(r);const _=t.copy_from_id&&await View.get(e,t.copy_from_id,i);await(null==_?void 0:_.getView(e));const f=await l.default.getByIdOrName(e,{id:t.fk_model_id},i);t.source_id||(r.source_id=f.source_id);const g=await i.metaInsert2(e.workspace_id,e.base_id,I.MetaTable.VIEWS,r),{id:b}=g;switch(t.type){case s.ViewTypes.GRID:await d.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:b}),i);break;case s.ViewTypes.MAP:await k.default.insert(e,Object.assign(Object.assign({},t),{fk_view_id:b}),i);break;case s.ViewTypes.GALLERY:await p.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:b}),i);break;case s.ViewTypes.FORM:await c.default.insert(e,Object.assign(Object.assign(Object.assign({heading:t.title},(null==_?void 0:_.view)||{}),t),{fk_view_id:b}),i);break;case s.ViewTypes.KANBAN:t.fk_grp_col_id=t.fk_grp_col_id,await u.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:b}),i);break;case s.ViewTypes.CALENDAR:{const a=(0,M.extractProps)(t,["calendar_range"]);if(!a.calendar_range)break;const s=a.calendar_range;s.forEach((e=>{e.fk_view_id=b})),await h.default.bulkInsert(e,s,i),await m.default.insert(e,Object.assign(Object.assign(Object.assign({},(null==_?void 0:_.view)||{}),t),{fk_view_id:b}),i);break}}if(_){const t=await _.getSorts(e,i),a=await y.default.rootFilterList(e,{viewId:_.id},i),s=await _.getColumns(e,i),r=[],l=[];for(const e of t)r.push(Object.assign(Object.assign({},(0,M.extractProps)(e,["fk_column_id","direction","base_id","source_id"])),{fk_view_id:b,id:void 0}));for(const t of a){const a=async(t,s=null)=>{const r=await i.genNanoid(I.MetaTable.FILTER_EXP);l.push(Object.assign(Object.assign({},(0,M.extractProps)(t,["fk_parent_column_id","fk_column_id","comparison_op","comparison_sub_op","value","fk_parent_id","is_group","logical_op","base_id","source_id","order"])),{fk_view_id:b,id:r,fk_parent_id:s})),t.is_group&&await Promise.all((await t.getChildren(e)||[]).map((async e=>{await a(e,r)})))};await a(t)}await i.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.SORT,r),await i.bulkMetaInsert(e.workspace_id,e.base_id,I.MetaTable.FILTER_EXP,l,!0),await View.bulkColumnInsertToViews(e,{viewColumns:s,copyFromView:_},g)}else await View.bulkColumnInsertToViews(e,{columns:await a.getColumns(e,i)},g);return await l.default.getNonDefaultViewsCountAndReset(e,{modelId:t.fk_model_id},i),g}static extractViewColumnsTableName(e){let t;switch(e.type){case s.ViewTypes.GRID:t=I.MetaTable.GRID_VIEW_COLUMNS;break;case s.ViewTypes.GALLERY:t=I.MetaTable.GALLERY_VIEW_COLUMNS;break;case s.ViewTypes.KANBAN:t=I.MetaTable.KANBAN_VIEW_COLUMNS;break;case s.ViewTypes.FORM:t=I.MetaTable.FORM_VIEW_COLUMNS;break;case s.ViewTypes.MAP:t=I.MetaTable.MAP_VIEW_COLUMNS;break;case s.ViewTypes.CALENDAR:t=I.MetaTable.CALENDAR_VIEW_COLUMNS}return t}static extractViewTableName(e){let t;switch(e.type){case s.ViewTypes.GRID:t=I.MetaTable.GRID_VIEW;break;case s.ViewTypes.GALLERY:t=I.MetaTable.GALLERY_VIEW;break;case s.ViewTypes.KANBAN:t=I.MetaTable.KANBAN_VIEW;break;case s.ViewTypes.FORM:t=I.MetaTable.FORM_VIEW;break;case s.ViewTypes.MAP:t=I.MetaTable.MAP_VIEW;break;case s.ViewTypes.CALENDAR:t=I.MetaTable.CALENDAR_VIEW}return t}static extractViewColumnsTableNameScope(e){let t;switch(e.type){case s.ViewTypes.GRID:t=I.CacheScope.GRID_VIEW_COLUMN;break;case s.ViewTypes.GALLERY:t=I.CacheScope.GALLERY_VIEW_COLUMN;break;case s.ViewTypes.MAP:t=I.CacheScope.MAP_VIEW_COLUMN;break;case s.ViewTypes.KANBAN:t=I.CacheScope.KANBAN_VIEW_COLUMN;break;case s.ViewTypes.FORM:t=I.CacheScope.FORM_VIEW_COLUMN;break;case s.ViewTypes.CALENDAR:t=I.CacheScope.CALENDAR_VIEW_COLUMN}return t}static extractViewTableNameScope(e){let t;switch(e.type){case s.ViewTypes.GRID:t=I.CacheScope.GRID_VIEW;break;case s.ViewTypes.GALLERY:t=I.CacheScope.GALLERY_VIEW;break;case s.ViewTypes.MAP:t=I.CacheScope.MAP_VIEW;break;case s.ViewTypes.KANBAN:t=I.CacheScope.KANBAN_VIEW;break;case s.ViewTypes.FORM:t=I.CacheScope.FORM_VIEW;break;case s.ViewTypes.CALENDAR:t=I.CacheScope.CALENDAR_VIEW}return t}async getModel(e,t=C.default.ncMeta){return this.model=await l.default.getByIdOrName(e,{id:this.fk_model_id},t)}async getModelWithInfo(e,t=C.default.ncMeta){return this.model=await l.default.getWithInfo(e,{id:this.fk_model_id},t)}async getView(e,t=C.default.ncMeta){switch(this.type){case s.ViewTypes.GRID:this.view=await d.default.get(e,this.id,t);break;case s.ViewTypes.KANBAN:this.view=await u.default.get(e,this.id,t);break;case s.ViewTypes.GALLERY:this.view=await p.default.get(e,this.id,t);break;case s.ViewTypes.MAP:this.view=await k.default.get(e,this.id,t);break;case s.ViewTypes.FORM:this.view=await c.default.get(e,this.id,t);break;case s.ViewTypes.CALENDAR:this.view=await m.default.get(e,this.id,t)}return this.view}async getViewWithInfo(e,t=C.default.ncMeta){switch(this.type){case s.ViewTypes.GRID:this.view=await d.default.getWithInfo(e,this.id,t);break;case s.ViewTypes.KANBAN:this.view=await u.default.get(e,this.id,t);break;case s.ViewTypes.GALLERY:this.view=await p.default.get(e,this.id,t);break;case s.ViewTypes.MAP:this.view=await k.default.get(e,this.id,t);break;case s.ViewTypes.FORM:this.view=await c.default.get(e,this.id,t);break;case s.ViewTypes.CALENDAR:this.view=await m.default.get(e,this.id,t)}return this.view}async getFilters(e,t=C.default.ncMeta){return this.filter=await y.default.getFilterObject(e,{viewId:this.id},t)}async getSorts(e,t=C.default.ncMeta){return this.sorts=await g.default.list(e,{viewId:this.id},t)}async getColumns(e,t=C.default.ncMeta){return this.columns=await View.getColumns(e,this.id,t)}async delete(e,t=C.default.ncMeta){await View.delete(e,this.id,t)}}t.default=View},19684:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonColumn=t.FileReference=t.Integration=t.Job=t.Comment=t.Extension=t.UserRefreshToken=t.PresignedUrl=t.Notification=t.LinksColumn=t.View=t.User=t.SyncSource=t.SyncLogs=t.Store=t.Sort=t.SelectOption=t.RollupColumn=t.QrCodeColumn=t.BaseUser=t.Base=t.Plugin=t.ModelRoleVisibility=t.Model=t.MapViewColumn=t.MapView=t.LookupColumn=t.LinkToAnotherRecordColumn=t.KanbanViewColumn=t.KanbanView=t.HookLog=t.HookFilter=t.Hook=t.GridViewColumn=t.GridView=t.GalleryViewColumn=t.GalleryView=t.FormViewColumn=t.FormView=t.FormulaColumn=t.Filter=t.CalendarRange=t.CalendarViewColumn=t.CalendarView=t.Column=t.Source=t.BarcodeColumn=t.Audit=t.ApiToken=void 0;var s=a(15316);Object.defineProperty(t,"ApiToken",{enumerable:!0,get:function(){return i(s).default}});var r=a(45988);Object.defineProperty(t,"Audit",{enumerable:!0,get:function(){return i(r).default}});var l=a(98768);Object.defineProperty(t,"BarcodeColumn",{enumerable:!0,get:function(){return i(l).default}});var c=a(16708);Object.defineProperty(t,"Source",{enumerable:!0,get:function(){return i(c).default}});var d=a(57596);Object.defineProperty(t,"Column",{enumerable:!0,get:function(){return i(d).default}});var u=a(35948);Object.defineProperty(t,"CalendarView",{enumerable:!0,get:function(){return i(u).default}});var p=a(28192);Object.defineProperty(t,"CalendarViewColumn",{enumerable:!0,get:function(){return i(p).default}});var m=a(91412);Object.defineProperty(t,"CalendarRange",{enumerable:!0,get:function(){return i(m).default}});var _=a(22996);Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return i(_).default}});var f=a(84748);Object.defineProperty(t,"FormulaColumn",{enumerable:!0,get:function(){return i(f).default}});var h=a(18716);Object.defineProperty(t,"FormView",{enumerable:!0,get:function(){return i(h).default}});var g=a(95240);Object.defineProperty(t,"FormViewColumn",{enumerable:!0,get:function(){return i(g).default}});var y=a(39944);Object.defineProperty(t,"GalleryView",{enumerable:!0,get:function(){return i(y).default}});var b=a(56648);Object.defineProperty(t,"GalleryViewColumn",{enumerable:!0,get:function(){return i(b).default}});var w=a(66044);Object.defineProperty(t,"GridView",{enumerable:!0,get:function(){return i(w).default}});var v=a(92760);Object.defineProperty(t,"GridViewColumn",{enumerable:!0,get:function(){return i(v).default}});var T=a(82568);Object.defineProperty(t,"Hook",{enumerable:!0,get:function(){return i(T).default}});var k=a(50732);Object.defineProperty(t,"HookFilter",{enumerable:!0,get:function(){return i(k).default}});var S=a(76072);Object.defineProperty(t,"HookLog",{enumerable:!0,get:function(){return i(S).default}});var M=a(36060);Object.defineProperty(t,"KanbanView",{enumerable:!0,get:function(){return i(M).default}});var O=a(52284);Object.defineProperty(t,"KanbanViewColumn",{enumerable:!0,get:function(){return i(O).default}});var I=a(90652);Object.defineProperty(t,"LinkToAnotherRecordColumn",{enumerable:!0,get:function(){return i(I).default}});var C=a(30468);Object.defineProperty(t,"LookupColumn",{enumerable:!0,get:function(){return i(C).default}});var E=a(40144);Object.defineProperty(t,"MapView",{enumerable:!0,get:function(){return i(E).default}});var x=a(4388);Object.defineProperty(t,"MapViewColumn",{enumerable:!0,get:function(){return i(x).default}});var L=a(84072);Object.defineProperty(t,"Model",{enumerable:!0,get:function(){return i(L).default}});var R=a(70912);Object.defineProperty(t,"ModelRoleVisibility",{enumerable:!0,get:function(){return i(R).default}});var N=a(60160);Object.defineProperty(t,"Plugin",{enumerable:!0,get:function(){return i(N).default}});var A=a(30136);Object.defineProperty(t,"Base",{enumerable:!0,get:function(){return i(A).default}});var D=a(96516);Object.defineProperty(t,"BaseUser",{enumerable:!0,get:function(){return i(D).default}});var j=a(69004);Object.defineProperty(t,"QrCodeColumn",{enumerable:!0,get:function(){return i(j).default}});var P=a(31196);Object.defineProperty(t,"RollupColumn",{enumerable:!0,get:function(){return i(P).default}});var q=a(23696);Object.defineProperty(t,"SelectOption",{enumerable:!0,get:function(){return i(q).default}});var U=a(95428);Object.defineProperty(t,"Sort",{enumerable:!0,get:function(){return i(U).default}});var $=a(21960);Object.defineProperty(t,"Store",{enumerable:!0,get:function(){return i($).default}});var Y=a(33612);Object.defineProperty(t,"SyncLogs",{enumerable:!0,get:function(){return i(Y).default}});var B=a(83108);Object.defineProperty(t,"SyncSource",{enumerable:!0,get:function(){return i(B).default}});var F=a(97844);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return i(F).default}});var V=a(70176);Object.defineProperty(t,"View",{enumerable:!0,get:function(){return i(V).default}});var H=a(7980);Object.defineProperty(t,"LinksColumn",{enumerable:!0,get:function(){return i(H).default}});var G=a(1980);Object.defineProperty(t,"Notification",{enumerable:!0,get:function(){return i(G).default}});var W=a(12776);Object.defineProperty(t,"PresignedUrl",{enumerable:!0,get:function(){return i(W).default}});var z=a(4788);Object.defineProperty(t,"UserRefreshToken",{enumerable:!0,get:function(){return i(z).default}});var J=a(66191);Object.defineProperty(t,"Extension",{enumerable:!0,get:function(){return i(J).default}});var K=a(92944);Object.defineProperty(t,"Comment",{enumerable:!0,get:function(){return i(K).default}});var Q=a(14700);Object.defineProperty(t,"Job",{enumerable:!0,get:function(){return i(Q).default}});var X=a(78076);Object.defineProperty(t,"Integration",{enumerable:!0,get:function(){return i(X).default}});var Z=a(76844);Object.defineProperty(t,"FileReference",{enumerable:!0,get:function(){return i(Z).default}});var ee=a(86384);Object.defineProperty(t,"ButtonColumn",{enumerable:!0,get:function(){return i(ee).default}})},81408:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,k,S,M,O,I,C,E,x,L,R,N,A=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),D=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),j=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},P=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&A(t,e,a);return D(t,e),t},q=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},U=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthController=void 0;const $=a(23324),Y=a(79224),B=a(70816),F=a(16184),V=a(71040),H=P(a(58016)),G=a(50628),W=a(52144),z=a(23668),J=a(43820),K=a(47932),Q=a(67240),X=a(53432),Z=a(48967);let ee=class AuthController{constructor(e,t,a){this.usersService=e,this.appHooksService=t,this.config=a}async signup(e,t){this.config.get("auth",{infer:!0}).disableEmailAuth&&J.NcError.forbidden("Email authentication is disabled"),t.json(await this.usersService.signup({body:e.body,req:e,res:t}))}async refreshToken(e,t){t.json(await this.usersService.refreshToken({body:e.body,req:e,res:t}))}async signin(e,t){this.config.get("auth",{infer:!0}).disableEmailAuth&&J.NcError.forbidden("Email authentication is disabled"),await this.setRefreshToken({req:e,res:t}),t.json(await this.usersService.login(e.user,e))}async signOut(e,t){var a,i;(null===(i=(a=e).isAuthenticated)||void 0===i?void 0:i.call(a))||J.NcError.forbidden("Not allowed"),t.json(await this.usersService.signOut({req:e,res:t}))}async googleSignin(e,t){await this.setRefreshToken({req:e,res:t}),t.json(await this.usersService.login(e.user,e))}googleAuthenticate(){}async me(e){return Object.assign(Object.assign({},e.user),{roles:(0,V.extractRolesObj)(e.user.roles),workspace_roles:(0,V.extractRolesObj)(e.user.workspace_roles),base_roles:(0,V.extractRolesObj)(e.user.base_roles)})}async passwordChange(e,t){var a,i;(null===(i=(a=e).isAuthenticated)||void 0===i?void 0:i.call(a))||J.NcError.forbidden("Not allowed"),await this.usersService.passwordChange({user:e.user,req:e,body:e.body}),await this.setRefreshToken({req:e,res:t}),t.json({msg:"Password has been updated successfully"})}async passwordForgot(e){return await this.usersService.passwordForgot({siteUrl:e.ncSiteUrl,body:e.body,req:e}),{msg:"Please check your email to reset the password"}}async tokenValidate(e){return await this.usersService.tokenValidate({token:e}),{msg:"Token has been validated successfully"}}async passwordReset(e,t,a){return await this.usersService.passwordReset({token:t,body:a,req:e}),{msg:"Password has been reset successfully"}}async emailVerification(e,t){return await this.usersService.emailVerification({token:t,req:e}),{msg:"Email has been verified successfully"}}async renderPasswordReset(e,t,i){try{t.send(H.render((await Promise.resolve().then((()=>P(a(63704))))).default,{ncPublicUrl:process.env.NC_PUBLIC_URL||"",token:JSON.stringify(i),baseUrl:"/"}))}catch(e){return t.status(400).json({msg:e.message})}}async setRefreshToken({res:e,req:t}){await this.usersService.setRefreshToken({res:e,req:t})}};t.AuthController=ee,j([(0,$.Post)(["/auth/user/signup","/api/v1/db/auth/user/signup","/api/v1/auth/user/signup","/api/v2/auth/user/signup"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Res)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(l=void 0!==Z.NcRequest&&Z.NcRequest)?l:Object,"function"==typeof(c=void 0!==Y.Response&&Y.Response)?c:Object]),q("design:returntype","function"==typeof(d="undefined"!=typeof Promise&&Promise)?d:Object)],ee.prototype,"signup",null),j([(0,$.Post)(["/auth/token/refresh","/api/v1/db/auth/token/refresh","/api/v1/auth/token/refresh","/api/v2/auth/token/refresh"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Res)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(u=void 0!==Z.NcRequest&&Z.NcRequest)?u:Object,"function"==typeof(p=void 0!==Y.Response&&Y.Response)?p:Object]),q("design:returntype","function"==typeof(m="undefined"!=typeof Promise&&Promise)?m:Object)],ee.prototype,"refreshToken",null),j([(0,$.Post)(["/auth/user/signin","/api/v1/db/auth/user/signin","/api/v1/auth/user/signin","/api/v2/auth/user/signin"]),(0,$.UseGuards)(X.PublicApiLimiterGuard,(0,B.AuthGuard)("local")),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Res)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(_=void 0!==Z.NcRequest&&Z.NcRequest)?_:Object,"function"==typeof(f=void 0!==Y.Response&&Y.Response)?f:Object]),q("design:returntype",Promise)],ee.prototype,"signin",null),j([(0,$.UseGuards)(z.GlobalGuard),(0,$.Post)(["/api/v1/auth/user/signout","/api/v2/auth/user/signout"]),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Res)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(h=void 0!==Z.NcRequest&&Z.NcRequest)?h:Object,"function"==typeof(g=void 0!==Y.Response&&Y.Response)?g:Object]),q("design:returntype","function"==typeof(y="undefined"!=typeof Promise&&Promise)?y:Object)],ee.prototype,"signOut",null),j([(0,$.Post)("/auth/google/genTokenByCode"),(0,$.HttpCode)(200),(0,$.UseGuards)(X.PublicApiLimiterGuard,(0,B.AuthGuard)("google")),U(0,(0,$.Req)()),U(1,(0,$.Res)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(b=void 0!==Z.NcRequest&&Z.NcRequest)?b:Object,"function"==typeof(w=void 0!==Y.Response&&Y.Response)?w:Object]),q("design:returntype",Promise)],ee.prototype,"googleSignin",null),j([(0,$.Get)("/auth/google"),(0,$.UseGuards)(X.PublicApiLimiterGuard,(0,B.AuthGuard)("google")),q("design:type",Function),q("design:paramtypes",[]),q("design:returntype",void 0)],ee.prototype,"googleAuthenticate",null),j([(0,$.Get)(["/auth/user/me","/api/v1/db/auth/user/me","/api/v1/auth/user/me","/api/v2/auth/user/me"]),(0,$.UseGuards)(Q.MetaApiLimiterGuard,z.GlobalGuard),U(0,(0,$.Req)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(v=void 0!==Z.NcRequest&&Z.NcRequest)?v:Object]),q("design:returntype",Promise)],ee.prototype,"me",null),j([(0,$.Post)(["/user/password/change","/api/v1/db/auth/password/change","/api/v1/auth/password/change","/api/v2/auth/password/change"]),(0,$.UseGuards)(Q.MetaApiLimiterGuard,z.GlobalGuard),(0,K.Acl)("passwordChange",{scope:"org"}),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Res)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(T=void 0!==Z.NcRequest&&Z.NcRequest)?T:Object,Object]),q("design:returntype","function"==typeof(k="undefined"!=typeof Promise&&Promise)?k:Object)],ee.prototype,"passwordChange",null),j([(0,$.Post)(["/auth/password/forgot","/api/v1/db/auth/password/forgot","/api/v1/auth/password/forgot","/api/v2/auth/password/forgot"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),(0,$.HttpCode)(200),U(0,(0,$.Req)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(S=void 0!==Z.NcRequest&&Z.NcRequest)?S:Object]),q("design:returntype","function"==typeof(M="undefined"!=typeof Promise&&Promise)?M:Object)],ee.prototype,"passwordForgot",null),j([(0,$.Post)(["/auth/token/validate/:tokenId","/api/v1/db/auth/token/validate/:tokenId","/api/v1/auth/token/validate/:tokenId","/api/v2/auth/token/validate/:tokenId"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),(0,$.HttpCode)(200),U(0,(0,$.Param)("tokenId")),q("design:type",Function),q("design:paramtypes",[String]),q("design:returntype","function"==typeof(O="undefined"!=typeof Promise&&Promise)?O:Object)],ee.prototype,"tokenValidate",null),j([(0,$.Post)(["/auth/password/reset/:tokenId","/api/v1/db/auth/password/reset/:tokenId","/api/v1/auth/password/reset/:tokenId","/api/v2/auth/password/reset/:tokenId"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Param)("tokenId")),U(2,(0,$.Body)()),q("design:type",Function),q("design:paramtypes",["function"==typeof(I=void 0!==Z.NcRequest&&Z.NcRequest)?I:Object,String,Object]),q("design:returntype","function"==typeof(C="undefined"!=typeof Promise&&Promise)?C:Object)],ee.prototype,"passwordReset",null),j([(0,$.Post)(["/api/v1/db/auth/email/validate/:tokenId","/api/v1/auth/email/validate/:tokenId","/api/v2/auth/email/validate/:tokenId"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),(0,$.HttpCode)(200),U(0,(0,$.Req)()),U(1,(0,$.Param)("tokenId")),q("design:type",Function),q("design:paramtypes",["function"==typeof(E=void 0!==Z.NcRequest&&Z.NcRequest)?E:Object,String]),q("design:returntype","function"==typeof(x="undefined"!=typeof Promise&&Promise)?x:Object)],ee.prototype,"emailVerification",null),j([(0,$.Get)(["/api/v1/db/auth/password/reset/:tokenId","/api/v2/db/auth/password/reset/:tokenId","/auth/password/reset/:tokenId"]),(0,$.UseGuards)(X.PublicApiLimiterGuard),U(0,(0,$.Req)()),U(1,(0,$.Res)()),U(2,(0,$.Param)("tokenId")),q("design:type",Function),q("design:paramtypes",["function"==typeof(L=void 0!==Z.NcRequest&&Z.NcRequest)?L:Object,"function"==typeof(R=void 0!==Y.Response&&Y.Response)?R:Object,String]),q("design:returntype","function"==typeof(N="undefined"!=typeof Promise&&Promise)?N:Object)],ee.prototype,"renderPasswordReset",null),t.AuthController=ee=j([(0,$.Controller)(),q("design:paramtypes",["function"==typeof(i=void 0!==G.UsersService&&G.UsersService)?i:Object,"function"==typeof(s=void 0!==W.AppHooksService&&W.AppHooksService)?s:Object,"function"==typeof(r=void 0!==F.ConfigService&&F.ConfigService)?r:Object])],ee)},360:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthModule=t.authModuleMetadata=void 0;const s=a(23324),r=a(70816),l=a(89096),c=a(20444),d=a(97268),u=a(1148),p=a(14996),m=a(38796),_=a(93460),f=a(81408);t.authModuleMetadata={imports:[r.PassportModule,l.NocoModule],controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[f.AuthController]:[]],providers:[_.AuthService,d.LocalStrategy,u.AuthTokenStrategy,p.BaseViewStrategy,c.BasicStrategy,m.GoogleStrategyProvider],exports:[]};let h=class AuthModule{};t.AuthModule=h,t.AuthModule=h=i([(0,s.Module)(t.authModuleMetadata)],h)},93460:function(e,t,a){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&s(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=t.CreateUserDto=void 0;const m=a(50970),_=a(71040),f=a(23324),h=c(a(31920)),g=a(81104),y=p(a(76584)),b=a(57512),w=a(50628);t.CreateUserDto=class CreateUserDto{};let v=class AuthService{constructor(e){this.usersService=e}async validateUser(e,t){const a=await this.usersService.findOne(e);if(a){const{password:e,salt:i}=a,s=u(a,["password","salt"]),r=await(0,m.promisify)(h.hash)(t,a.salt);if(a.password===r)return s}return null}async login(e){delete e.password,delete e.salt;const t=e;return{token:(0,b.genJwt)(t,y.default.getConfig())}}async signup(e){const{email:t,firstname:a,lastname:i}=e;let{password:s}=e;const r=t.toLowerCase();let l=await this.usersService.findOne(r);const c=await(0,m.promisify)(h.genSalt)(10);s=await(0,m.promisify)(h.hash)(s,c);const d=(0,g.v4)();return l||await this.registerNewUserIfAllowed({firstname:a,lastname:i,email:r,salt:c,password:s,email_verification_token:d}),l=await this.usersService.findOne(r),await this.login(l)}async registerNewUserIfAllowed({firstname:e,lastname:t,email:a,salt:i,password:s,email_verification_token:r}){const l=_.OrgUserRoles.CREATOR;return await this.usersService.insert({firstname:e,lastname:t,email:a,salt:i,password:s,email_verification_token:r,roles:l,token_version:""})}};t.AuthService=v,t.AuthService=v=l([(0,f.Injectable)(),d("design:paramtypes",["function"==typeof(i=void 0!==w.UsersService&&w.UsersService)?i:Object])],v)},63704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!DOCTYPE html>\n<html>\n<head>\n    <title>NocoDB - Reset Password</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">\n    <link href="<%= ncPublicUrl %>/css/fonts.roboto.css" rel="stylesheet">\n    <link href="<%= ncPublicUrl %>/css/materialdesignicons.5.x.min.css" rel="stylesheet">\n    <link href="<%= ncPublicUrl %>/css/vuetify.2.x.min.css" rel="stylesheet">\n    <script src="<%= ncPublicUrl %>/js/vue.2.6.14.min.js"><\/script>\n</head>\n<body>\n<div id="app">\n    <v-app>\n        <v-container>\n            <v-row class="justify-center">\n                <v-col class="col-12 col-md-6">\n                    <v-alert v-if="success" type="success">\n                        Password reset successful!\n                    </v-alert>\n                    <template v-else>\n\n                        <v-form ref="form" v-model="validForm" v-if="valid === true" ref="formType" class="ma-auto"\n                                lazy-validation>\n\n\n                            <v-text-field\n                                    name="input-10-2"\n                                    label="New password"\n                                    type="password"\n                                    v-model="formdata.password"\n                                    :rules="[v => !!v ||  \'Password is required\']"\n                            ></v-text-field>\n\n                            <v-text-field\n                                    name="input-10-2"\n                                    type="password"\n                                    label="Confirm new password"\n                                    v-model="formdata.newPassword"\n                                    :rules="[v => !!v ||  \'Password is required\', v =>  v === formdata.password  || \'Password mismatch\']"\n                            ></v-text-field>\n\n                            <v-btn\n                                    :disabled="!validForm"\n                                    large\n                                    @click="resetPassword"\n                            >\n                                RESET PASSWORD\n                            </v-btn>\n\n                        </v-form>\n                        <div v-else-if="valid === false">Not a valid url</div>\n                        <div v-else>\n                            <v-skeleton-loader type="actions"></v-skeleton-loader>\n                        </div>\n                    </template>\n                </v-col>\n            </v-row>\n        </v-container>\n    </v-app>\n</div>\n<script src="<%= ncPublicUrl %>/js/vuetify.2.x.min.js"><\/script>\n<script src="<%= ncPublicUrl %>/js/axios.0.19.2.min.js"><\/script>\n\n<script>\n  var app = new Vue({\n    el: \'#app\',\n    vuetify: new Vuetify(),\n    data: {\n      valid: null,\n      validForm: false,\n      token: <%= token %>,\n      greeting: \'Password Reset\',\n      formdata: {\n        password: \'\',\n        newPassword: \'\'\n      },\n      success: false\n    },\n    methods: {\n      async resetPassword() {\n        if (this.$refs.form.validate()) {\n          try {\n            const res = await axios.post(\'<%= baseUrl %>api/v1/db/auth/password/reset/\' + this.token, {\n              ...this.formdata\n            });\n            this.success = true;\n          } catch (e) {\n            if (e.response && e.response.data && e.response.data.msg) {\n              alert(\'Failed to reset password: \' + e.response.data.msg)\n            } else {\n              alert(\'Some error occurred\')\n            }\n          }\n        }\n      }\n    },\n    async created() {\n      try {\n        const valid = (await axios.post(\'<%= baseUrl %>api/v1/db/auth/token/validate/\' + this.token)).data;\n        this.valid = !!valid;\n      } catch (e) {\n        this.valid = false;\n      }\n    }\n  })\n<\/script>\n</body>\n</html>'},88336:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n  <meta name="viewport" content="width=device-width">\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n  <title>Simple Transactional Email</title>\n  <style>\n@media only screen and (max-width: 620px) {\n  table[class=body] h1 {\n    font-size: 28px !important;\n    margin-bottom: 10px !important;\n  }\n\n  table[class=body] p,\ntable[class=body] ul,\ntable[class=body] ol,\ntable[class=body] td,\ntable[class=body] span,\ntable[class=body] a {\n    font-size: 16px !important;\n  }\n\n  table[class=body] .wrapper,\ntable[class=body] .article {\n    padding: 10px !important;\n  }\n\n  table[class=body] .content {\n    padding: 0 !important;\n  }\n\n  table[class=body] .container {\n    padding: 0 !important;\n    width: 100% !important;\n  }\n\n  table[class=body] .main {\n    border-left-width: 0 !important;\n    border-radius: 0 !important;\n    border-right-width: 0 !important;\n  }\n\n  table[class=body] .btn table {\n    width: 100% !important;\n  }\n\n  table[class=body] .btn a {\n    width: 100% !important;\n  }\n\n  table[class=body] .img-responsive {\n    height: auto !important;\n    max-width: 100% !important;\n    width: auto !important;\n  }\n}\n@media all {\n  .ExternalClass {\n    width: 100%;\n  }\n\n  .ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\n    line-height: 100%;\n  }\n\n  .apple-link a {\n    color: inherit !important;\n    font-family: inherit !important;\n    font-size: inherit !important;\n    font-weight: inherit !important;\n    line-height: inherit !important;\n    text-decoration: none !important;\n  }\n\n  #MessageViewBody a {\n    color: inherit;\n    text-decoration: none;\n    font-size: inherit;\n    font-family: inherit;\n    font-weight: inherit;\n    line-height: inherit;\n  }\n\n  .btn-primary table td:hover {\n    background-color: #34495e !important;\n  }\n\n  .btn-primary a:hover {\n    background-color: #34495e !important;\n    border-color: #34495e !important;\n  }\n}\n</style>\n</head>\n<body class="" style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader" style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">This is preheader text. Some clients will show this text as a preview.</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;" width="100%" bgcolor="#f6f6f6">\n  <tr>\n    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    <td class="container" style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;" width="580" valign="top">\n      <div class="content" style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n        \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n        <table role="presentation" class="main" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;" width="100%">\n\n          \x3c!-- START MAIN CONTENT AREA --\x3e\n          <tr>\n            <td class="wrapper" style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;" valign="top">\n              <table role="presentation" border="0" cellpadding="0" cellspacing="0" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;" width="100%">\n                <tr>\n                  <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">\n                    <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">Hi,</p>\n                    <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">To change your NocoDB account password click the following link.</p>\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="btn btn-primary" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; box-sizing: border-box; width: 100%;" width="100%">\n                      <tbody>\n                      <tr>\n                        <td align="left" style="font-family: sans-serif; font-size: 14px; vertical-align: top; padding-bottom: 15px;" valign="top">\n                          <table role="presentation" border="0" cellpadding="0" cellspacing="0" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: auto;">\n                            <tbody>\n                            <tr>\n                              <td style="font-family: sans-serif; font-size: 14px; vertical-align: top; border-radius: 5px; text-align: center; background-color: #3498db;" valign="top" align="center" bgcolor="#1088ff"> <a href="<%= resetLink %>" target="_blank" style="border: solid 1px rgb(23, 139, 255); border-radius: 5px; box-sizing: border-box; cursor: pointer; display: inline-block; font-size: 14px; font-weight: bold; margin: 0; padding: 12px 25px; text-decoration: none; text-transform: capitalize; background-color: rgb(23, 139, 255); border-color: #3498db; color: #ffffff;">Reset Password</a> </td>\n                            </tr>\n                            </tbody>\n                          </table>\n                        </td>\n                      </tr>\n                      </tbody>\n                    </table>\n                    <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">Thanks regards NocoDB.</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          \x3c!-- END MAIN CONTENT AREA --\x3e\n        </table>\n        \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n        \x3c!-- START FOOTER --\x3e\n        <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n          <table role="presentation" border="0" cellpadding="0" cellspacing="0" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;" width="100%">\n            <tr>\n              <td class="content-block" style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;" valign="top" align="center">\n                <span class="apple-link" style="color: #999999; font-size: 12px; text-align: center;"></span>\n\x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n              </td>\n            </tr>\n            <tr>\n              <td class="content-block powered-by" style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;" valign="top" align="center">\n              <a href="http://nocodb.com/">NocoDB</a>\n\x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n              </td>\n            </tr>\n          </table>\n        </div>\n        \x3c!-- END FOOTER --\x3e\n\n      </div>\n    </td>\n    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n  </tr>\n</table>\n</body>\n</html>\n'},67628:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n    <meta name="viewport" content="width=device-width">\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n    <title>Simple Transactional Email</title>\n    <style>\n        @media only screen and (max-width: 620px) {\n            table[class=body] h1 {\n                font-size: 28px !important;\n                margin-bottom: 10px !important;\n            }\n\n            table[class=body] p,\n            table[class=body] ul,\n            table[class=body] ol,\n            table[class=body] td,\n            table[class=body] span,\n            table[class=body] a {\n                font-size: 16px !important;\n            }\n\n            table[class=body] .wrapper,\n            table[class=body] .article {\n                padding: 10px !important;\n            }\n\n            table[class=body] .content {\n                padding: 0 !important;\n            }\n\n            table[class=body] .container {\n                padding: 0 !important;\n                width: 100% !important;\n            }\n\n            table[class=body] .main {\n                border-left-width: 0 !important;\n                border-radius: 0 !important;\n                border-right-width: 0 !important;\n            }\n\n            table[class=body] .btn table {\n                width: 100% !important;\n            }\n\n            table[class=body] .btn a {\n                width: 100% !important;\n            }\n\n            table[class=body] .img-responsive {\n                height: auto !important;\n                max-width: 100% !important;\n                width: auto !important;\n            }\n        }\n\n        @media all {\n            .ExternalClass {\n                width: 100%;\n            }\n\n            .ExternalClass,\n            .ExternalClass p,\n            .ExternalClass span,\n            .ExternalClass font,\n            .ExternalClass td,\n            .ExternalClass div {\n                line-height: 100%;\n            }\n\n            .apple-link a {\n                color: inherit !important;\n                font-family: inherit !important;\n                font-size: inherit !important;\n                font-weight: inherit !important;\n                line-height: inherit !important;\n                text-decoration: none !important;\n            }\n\n            #MessageViewBody a {\n                color: inherit;\n                text-decoration: none;\n                font-size: inherit;\n                font-family: inherit;\n                font-weight: inherit;\n                line-height: inherit;\n            }\n\n            .btn-primary table td:hover {\n                background-color: #34495e !important;\n            }\n\n            .btn-primary a:hover {\n                background-color: #34495e !important;\n                border-color: #34495e !important;\n            }\n        }\n    </style>\n</head>\n<body class=""\n      style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader"\n      style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">This is preheader text. Some clients will show this text as a preview.</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body"\n       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;"\n       width="100%" bgcolor="#f6f6f6">\n    <tr>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n        <td class="container"\n            style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;"\n            width="580" valign="top">\n            <div class="content"\n                 style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n                \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n                <table role="presentation" class="main"\n                       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;"\n                       width="100%">\n\n                    \x3c!-- START MAIN CONTENT AREA --\x3e\n                    <tr>\n                        <td class="wrapper"\n                            style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;"\n                            valign="top">\n                            <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                   style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                                   width="100%">\n                                <tr>\n                                    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;"\n                                        valign="top">\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Hi,</p>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Please verify your e-mail address by clicking the following button.</p>\n                                        <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                               class="btn btn-primary"\n                                               style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; box-sizing: border-box; width: 100%;"\n                                               width="100%">\n                                            <tbody>\n                                            <tr>\n                                                <td align="left"\n                                                    style="font-family: sans-serif; font-size: 14px; vertical-align: top; padding-bottom: 15px;"\n                                                    valign="top">\n                                                    <table role="presentation" border="0" cellpadding="0"\n                                                           cellspacing="0"\n                                                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: auto;">\n                                                        <tbody>\n                                                        <tr>\n                                                            <td style="font-family: sans-serif; font-size: 14px; vertical-align: top; border-radius: 5px; text-align: center; background-color: #3498db;"\n                                                                valign="top" align="center" bgcolor="#1088ff"><a\n                                                                        href="<%= verifyLink %>" target="_blank"\n                                                                        style="border: solid 1px rgb(23, 139, 255); border-radius: 5px; box-sizing: border-box; cursor: pointer; display: inline-block; font-size: 14px; font-weight: bold; margin: 0; padding: 12px 25px; text-decoration: none; text-transform: capitalize; background-color: rgb(23, 139, 255); border-color: #3498db; color: #ffffff;">Verify</a>\n                                                            </td>\n                                                        </tr>\n                                                        </tbody>\n                                                    </table>\n                                                </td>\n                                            </tr>\n                                            </tbody>\n                                        </table>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Thank you and have a nice day,<br><%= adminEmail %></p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    \x3c!-- END MAIN CONTENT AREA --\x3e\n                </table>\n                \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n                \x3c!-- START FOOTER --\x3e\n                <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                           width="100%">\n                        <tr>\n                            <td class="content-block"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <span class="apple-link"\n                                      style="color: #999999; font-size: 12px; text-align: center;"></span>\n                                \x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="content-block powered-by"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <a href="http://nocodb.com/">NocoDB</a>\n                                \x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                \x3c!-- END FOOTER --\x3e\n\n            </div>\n        </td>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    </tr>\n</table>\n</body>\n</html>\n'},61436:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},22120:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitterModule=void 0;const s=a(23324),r=a(30688);let l=class EventEmitterModule{};t.EventEmitterModule=l,t.EventEmitterModule=l=i([(0,s.Global)(),(0,s.Module)({providers:[{provide:"IEventEmitter",useFactory:()=>new r.FallbackEventEmitter}],exports:["IEventEmitter"]})],l)},30688:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FallbackEventEmitter=void 0;const s=i(a(28010));t.FallbackEventEmitter=class FallbackEventEmitter{constructor(){this.emitter=new s.default}emit(e,t){this.emitter.emit(e,t)}on(e,t){return this.emitter.on(e,t),()=>this.emitter.off(e,t)}removeListener(e,t){this.emitter.off(e,t)}removeAllListeners(e){this.emitter.clearListeners(e)}}},92924:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.QueueService=void 0;const p=a(23324),m=u(a(27216)),_=u(a(28010)),f=a(21904),h=a(81472),g=a(104);let y=i=class QueueService{constructor(e,t){this.jobsEventService=e,this.jobsMap=t,this.emitter.on(h.JobStatus.ACTIVE,(e=>{const t=this.queueMemory.find((t=>t.id===e.job.id));t.status=h.JobStatus.ACTIVE,this.jobsEventService.onActive.apply(this.jobsEventService,[t])})),this.emitter.on(h.JobStatus.COMPLETED,(e=>{const t=this.queueMemory.find((t=>t.id===e.job.id));t.status=h.JobStatus.COMPLETED,this.jobsEventService.onCompleted.apply(this.jobsEventService,[t,e.result]),this.removeJob(t)})),this.emitter.on(h.JobStatus.FAILED,(e=>{const t=this.queueMemory.find((t=>t.id===e.job.id));t.status=h.JobStatus.FAILED,this.jobsEventService.onFailed.apply(this.jobsEventService,[t,e.error]),this.removeJob(t)}))}async jobWrapper(e){this.emitter.emit(h.JobStatus.ACTIVE,{job:e});try{const{this:t,fn:a="job"}=this.jobsMap.jobs[e.name],i=await t[a](e);this.emitter.emit(h.JobStatus.COMPLETED,{job:e,result:i})}catch(t){this.emitter.emit(h.JobStatus.FAILED,{job:e,error:t})}}get emitter(){return i._emitter}get queue(){return i.queue}get queueMemory(){return i.queueMemory}get queueIndex(){return i.queueIdCounter}set queueIndex(e){i.queueIdCounter=e}add(e,t,a){const i=(null==a?void 0:a.jobId)||""+this.queueIndex++,s=this.queueMemory.find((e=>e.id===i));let r;return s?(s.status!==h.JobStatus.WAITING&&(s.status=h.JobStatus.WAITING),r=s):r={id:`${i}`,name:e,status:h.JobStatus.WAITING,data:t},(null==a?void 0:a.delay)?setTimeout((()=>{s||this.queueMemory.push(r),this.queue.add((()=>this.jobWrapper(r)))}),a.delay):(s||this.queueMemory.push(r),this.queue.add((()=>this.jobWrapper(r)))),{id:i,name:e}}getJobs(e){return e=Array.isArray(e)?e:[e],this.queueMemory.filter((t=>e.includes(t.status)))}getJob(e){return this.queueMemory.find((t=>t.id===e))}removeJob(e){const t=this.queueMemory.findIndex((t=>t.id===e.id));t&&this.queueMemory.splice(t,1)}};t.QueueService=y,y.queue=new m.default({concurrency:2}),y.queueIdCounter=1,y.processed=0,y.queueMemory=[],y._emitter=new _.default,t.QueueService=y=i=l([(0,p.Injectable)(),d(1,(0,p.Inject)((0,p.forwardRef)((()=>g.JobsMap)))),c("design:paramtypes",["function"==typeof(s=void 0!==f.JobsEventService&&f.JobsEventService)?s:Object,"function"==typeof(r=void 0!==g.JobsMap&&g.JobsMap)?r:Object])],y)},711:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsService=void 0;const l=a(23324),c=a(92924),d=a(81472),u=a(19684),p=a(64612);let m=class JobsService{constructor(e){this.fallbackQueueService=e}async onModuleInit(){await this.add(d.JobTypes.InitMigrationJobs,{})}async add(e,t,a){var i;const s=Object.assign({workspace_id:p.RootScopes.ROOT,base_id:p.RootScopes.ROOT},(null==t?void 0:t.context)||{});let r;if(null==a?void 0:a.jobId){const e=await u.Job.get(s,a.jobId);e&&(r=e,e.status!==d.JobStatus.WAITING&&await u.Job.update(s,e.id,{status:d.JobStatus.WAITING}))}return r||(r=await u.Job.insert(s,{job:e,status:d.JobStatus.WAITING,fk_user_id:null===(i=null==t?void 0:t.user)||void 0===i?void 0:i.id})),t.jobName=e,(null===d.JobVersions||void 0===d.JobVersions?void 0:d.JobVersions[e])&&(t._jobVersion=d.JobVersions[e]),this.fallbackQueueService.add(e,t,Object.assign({jobId:r.id},a)),r}async jobStatus(e){var t;return await(null===(t=await this.fallbackQueueService.getJob(e))||void 0===t?void 0:t.status)}async jobList(){return await this.fallbackQueueService.getJobs([d.JobStatus.ACTIVE,d.JobStatus.WAITING,d.JobStatus.DELAYED,d.JobStatus.PAUSED])}async resumeQueue(){await this.fallbackQueueService.queue.start()}async pauseQueue(){await this.fallbackQueueService.queue.pause()}};t.JobsService=m,t.JobsService=m=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==c.QueueService&&c.QueueService)?i:Object])],m)},16428:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.elapsedTime=t.initTime=void 0;const s=i(a(89576)),r=a(81472),l=(0,s.default)("nc:jobs:timings");t.initTime=()=>({hrTime:process.hrtime()});t.elapsedTime=(e,t,a)=>{const i=process.hrtime(e.hrTime)[0].toFixed(3),s=process.hrtime(e.hrTime)[1]/1e6;t&&l(`${t}: ${i}s ${s}ms`,`${r.JOBS_QUEUE}${a?`:${a}`:""}`),e.hrTime=process.hrtime()}},21904:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsEventService=void 0;const p=a(42736),m=a(80344),_=a(40628),f=a(23324),h=a(81472),g=a(19684),y=a(64612);let b=i=class JobsEventService{constructor(e){this.eventEmitter=e,this.logger=new f.Logger(i.name)}onActive(e){g.Job.update({workspace_id:y.RootScopes.ROOT,base_id:y.RootScopes.ROOT},e.id.toString(),{status:h.JobStatus.ACTIVE}).then((()=>{this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.ACTIVE})})).catch((t=>{this.logger.error(`Failed to update job (${e.id}) status to active: ${t.message}`)}))}onFailed(e,t){this.logger.error(`---- !! JOB FAILED !! ----\nid:${e.id}\nerror:${t.name} (${t.message})\n\nstack: ${t.stack}`),g.Job.update({workspace_id:y.RootScopes.ROOT,base_id:y.RootScopes.ROOT},e.id.toString(),{status:h.JobStatus.FAILED,result:null==t?void 0:t.data}).then((()=>{this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.FAILED,data:{error:{message:null==t?void 0:t.message},result:null==t?void 0:t.data}})})).catch((t=>{this.logger.error(`Failed to update job (${e.id}) status to failed: ${t.message}`)}))}onCompleted(e,t){t!==h.JobStatus.REQUEUED?g.Job.update({workspace_id:y.RootScopes.ROOT,base_id:y.RootScopes.ROOT},e.id.toString(),{status:h.JobStatus.COMPLETED,result:t}).then((()=>{this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.COMPLETED,data:{result:t}})})).catch((t=>{this.logger.error(`Failed to update job (${e.id}) status to completed: ${t.message}`)})):this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.REQUEUED})}};t.JobsEventService=b,d([(0,p.OnQueueActive)(),u("design:type",Function),u("design:paramtypes",["function"==typeof(r=void 0!==m.Job&&m.Job)?r:Object]),u("design:returntype",void 0)],b.prototype,"onActive",null),d([(0,p.OnQueueFailed)(),u("design:type",Function),u("design:paramtypes",["function"==typeof(l=void 0!==m.Job&&m.Job)?l:Object,Object]),u("design:returntype",void 0)],b.prototype,"onFailed",null),d([(0,p.OnQueueCompleted)(),u("design:type",Function),u("design:paramtypes",["function"==typeof(c=void 0!==m.Job&&m.Job)?c:Object,Object]),u("design:returntype",void 0)],b.prototype,"onCompleted",null),t.JobsEventService=b=i=d([(0,p.Processor)(h.JOBS_QUEUE),u("design:paramtypes",["function"==typeof(s=void 0!==_.EventEmitter2&&_.EventEmitter2)?s:Object])],b)},104:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsMap=void 0;const g=a(23324),y=a(86524),b=a(34976),w=a(70008),v=a(71648),T=a(95208),k=a(36428),S=a(53888),M=a(52628),O=a(93156),I=a(47304),C=a(81472);let E=class JobsMap{constructor(e,t,a,i,s,r,l,c,d,u){this.duplicateProcessor=e,this.atImportProcessor=t,this.metaSyncProcessor=a,this.sourceCreateProcessor=i,this.sourceDeleteProcessor=s,this.webhookHandlerProcessor=r,this.dataExportProcessor=l,this.thumbnailGeneratorProcessor=c,this.attachmentCleanUpProcessor=d,this.initMigrationJobs=u,this._jobMap={[C.JobTypes.DuplicateBase]:{this:this.duplicateProcessor,fn:"duplicateBase"},[C.JobTypes.DuplicateModel]:{this:this.duplicateProcessor,fn:"duplicateModel"},[C.JobTypes.DuplicateColumn]:{this:this.duplicateProcessor,fn:"duplicateColumn"},[C.JobTypes.AtImport]:{this:this.atImportProcessor},[C.JobTypes.MetaSync]:{this:this.metaSyncProcessor},[C.JobTypes.SourceCreate]:{this:this.sourceCreateProcessor},[C.JobTypes.SourceDelete]:{this:this.sourceDeleteProcessor},[C.JobTypes.HandleWebhook]:{this:this.webhookHandlerProcessor},[C.JobTypes.DataExport]:{this:this.dataExportProcessor},[C.JobTypes.ThumbnailGenerator]:{this:this.thumbnailGeneratorProcessor},[C.JobTypes.AttachmentCleanUp]:{this:this.attachmentCleanUpProcessor},[C.JobTypes.InitMigrationJobs]:{this:this.initMigrationJobs}}}get jobs(){return this._jobMap}};t.JobsMap=E,t.JobsMap=E=f([(0,g.Injectable)(),h("design:paramtypes",["function"==typeof(i=void 0!==y.DuplicateProcessor&&y.DuplicateProcessor)?i:Object,"function"==typeof(s=void 0!==b.AtImportProcessor&&b.AtImportProcessor)?s:Object,"function"==typeof(r=void 0!==w.MetaSyncProcessor&&w.MetaSyncProcessor)?r:Object,"function"==typeof(l=void 0!==v.SourceCreateProcessor&&v.SourceCreateProcessor)?l:Object,"function"==typeof(c=void 0!==T.SourceDeleteProcessor&&T.SourceDeleteProcessor)?c:Object,"function"==typeof(d=void 0!==k.WebhookHandlerProcessor&&k.WebhookHandlerProcessor)?d:Object,"function"==typeof(u=void 0!==S.DataExportProcessor&&S.DataExportProcessor)?u:Object,"function"==typeof(p=void 0!==M.ThumbnailGeneratorProcessor&&M.ThumbnailGeneratorProcessor)?p:Object,"function"==typeof(m=void 0!==O.AttachmentCleanUpProcessor&&O.AttachmentCleanUpProcessor)?m:Object,"function"==typeof(_=void 0!==I.InitMigrationJobs&&I.InitMigrationJobs)?_:Object])],E)},892:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},40452:function(e,t,a){"use strict";var i,s,r,l,c=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsController=void 0;const m=a(23324),_=a(40628),f=a(92080),h=a(81472),g=a(81472),y=a(23668),b=p(a(57804)),w=a(64612),v=a(67240),T=a(892),k=a(89604),S=a(48967),M=(0,f.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14),O=3e4;let I=class JobsController{constructor(e){this.jobsService=e,this.jobRooms={},this.localJobs={},this.closedJobs=[]}async listen(e,t,a){var i;const{_mid:s=0,data:r}=a,l=r.id;let c;e.setHeader("Cache-Control","no-cache, must-revalidate"),e.resId=M(),c=this.localJobs[l]?this.localJobs[l].messages:null===(i=await b.default.get(`${w.CacheScope.JOBS_POLLING}:${l}:messages`,w.CacheGetType.TYPE_OBJECT))||void 0===i?void 0:i.messages;const d=[];if(c&&c.forEach((e=>{e._mid>s&&d.push(e)})),d.length>0)e.send(d);else if(this.closedJobs.includes(l))e.send({status:"close"});else{if(this.jobRooms[l])this.jobRooms[l].listeners.push(e);else if(this.jobRooms[l]={listeners:[e]},k.JobsRedis.available){const e=await k.JobsRedis.subscribe(l,(async t=>{this.jobRooms[l]&&this.jobRooms[l].listeners.forEach((e=>{e.headersSent||e.send({status:"refresh"})}));const a=t.cmd;if(delete t.cmd,a===g.JobEvents.STATUS)[h.JobStatus.COMPLETED,h.JobStatus.FAILED].includes(t.status)&&(await e(),delete this.jobRooms[l],setTimeout((()=>{this.closedJobs.push(l)}),1e3),setTimeout((()=>{this.closedJobs=this.closedJobs.filter((e=>e!==l))}),6e4))}))}e.on("close",(()=>{var t;l&&(null===(t=this.jobRooms[l])||void 0===t?void 0:t.listeners)&&(this.jobRooms[l].listeners=this.jobRooms[l].listeners.filter((t=>t.resId!==e.resId)))})),setTimeout((()=>{e.headersSent||e.send({status:"refresh"})}),O)}}async sendJobStatus(e){let t;const a=e.id;if(e.status===h.JobStatus.REQUEUED)return this.jobRooms[a]&&this.jobRooms[a].listeners.forEach((e=>{e.headersSent||e.send({status:"refresh"})})),delete this.jobRooms[a],delete this.localJobs[a],void await b.default.del(`${w.CacheScope.JOBS_POLLING}:${a}:messages`);this.localJobs[a]?(t={status:"update",data:e,_mid:++this.localJobs[a]._mid},this.localJobs[a].messages.push(t),this.localJobs[a].messages.length>20&&this.localJobs[a].messages.shift(),await b.default.set(`${w.CacheScope.JOBS_POLLING}:${a}:messages`,{messages:this.localJobs[a].messages})):(t={status:"update",data:e,_mid:1},this.localJobs[a]={messages:[t],_mid:1},await b.default.set(`${w.CacheScope.JOBS_POLLING}:${a}:messages`,{messages:this.localJobs[a].messages})),this.jobRooms[a]&&this.jobRooms[a].listeners.forEach((e=>{e.headersSent||e.send(t)})),k.JobsRedis.available&&await k.JobsRedis.publish(a,Object.assign({cmd:g.JobEvents.STATUS},e)),[h.JobStatus.COMPLETED,h.JobStatus.FAILED].includes(e.status)&&(this.closedJobs.push(a),setTimeout((()=>{this.closedJobs=this.closedJobs.filter((e=>e!==a))}),6e4),setTimeout((async()=>{delete this.jobRooms[a],delete this.localJobs[a],await b.default.del(`${w.CacheScope.JOBS_POLLING}:${a}:messages`)}),6e4))}async sendJobLog(e){let t;const a=e.id;this.localJobs[a]?(t={status:"update",data:e,_mid:++this.localJobs[a]._mid},this.localJobs[a].messages.push(t),this.localJobs[a].messages.length>20&&this.localJobs[a].messages.shift(),await b.default.set(`${w.CacheScope.JOBS_POLLING}:${a}:messages`,{messages:this.localJobs[a].messages})):(t={status:"update",data:e,_mid:1},this.localJobs[a]={messages:[t],_mid:1},await b.default.set(`${w.CacheScope.JOBS_POLLING}:${a}:messages`,{messages:this.localJobs[a].messages})),this.jobRooms[a]&&this.jobRooms[a].listeners.forEach((e=>{e.headersSent||e.send(t)})),k.JobsRedis.available&&await k.JobsRedis.publish(a,Object.assign({cmd:g.JobEvents.LOG},e))}};t.JobsController=I,c([(0,m.Post)("/jobs/listen"),(0,m.HttpCode)(200),u(0,(0,m.Res)()),u(1,(0,m.Req)()),u(2,(0,m.Body)()),d("design:type",Function),d("design:paramtypes",[Object,"function"==typeof(s=void 0!==S.NcRequest&&S.NcRequest)?s:Object,Object]),d("design:returntype",Promise)],I.prototype,"listen",null),c([(0,_.OnEvent)(g.JobEvents.STATUS),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],I.prototype,"sendJobStatus",null),c([(0,_.OnEvent)(g.JobEvents.LOG),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype","function"==typeof(l="undefined"!=typeof Promise&&Promise)?l:Object)],I.prototype,"sendJobLog",null),t.JobsController=I=c([(0,m.Controller)(),(0,m.UseGuards)(v.MetaApiLimiterGuard,y.GlobalGuard),u(0,(0,m.Inject)("JobsService")),d("design:paramtypes",["function"==typeof(i=void 0!==T.IJobsService&&T.IJobsService)?i:Object])],I)},5636:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsModule=t.JobsModuleMetadata=void 0;const s=a(23324),r=a(42736),l=a(89096),c=a(83676),d=a(7156),u=a(47408),p=a(34976),m=a(73564),_=a(86524),f=a(62220),h=a(70008),g=a(61304),y=a(71648),b=a(67752),w=a(95208),v=a(36428),T=a(53888),k=a(1052),S=a(52628),M=a(93156),O=a(29972),I=a(104),C=a(47304),E=a(31760),x=a(8311),L=a(26144),R=a(40452),N=a(14832),A=a(21904),D=a(711),j=a(92924),P=a(81472);t.JobsModuleMetadata={imports:[(0,s.forwardRef)((()=>l.NocoModule)),...process.env.NC_REDIS_JOB_URL?[r.BullModule.forRoot({url:process.env.NC_REDIS_JOB_URL}),r.BullModule.registerQueue({name:P.JOBS_QUEUE,defaultJobOptions:{removeOnComplete:!0,attempts:1}})]:[]],controllers:[R.JobsController,..."true"!==process.env.NC_WORKER_CONTAINER?[m.DuplicateController,u.AtImportController,f.MetaSyncController,g.SourceCreateController,b.SourceDeleteController,k.DataExportController]:[]],providers:[I.JobsMap,A.JobsEventService,...process.env.NC_REDIS_JOB_URL?[]:[j.QueueService],{provide:"JobsService",useClass:process.env.NC_REDIS_JOB_URL?N.JobsService:D.JobsService},L.JobsLogService,O.JobsProcessor,c.ExportService,d.ImportService,_.DuplicateProcessor,p.AtImportProcessor,h.MetaSyncProcessor,y.SourceCreateProcessor,w.SourceDeleteProcessor,v.WebhookHandlerProcessor,T.DataExportProcessor,S.ThumbnailGeneratorProcessor,M.AttachmentCleanUpProcessor,C.InitMigrationJobs,E.AttachmentMigration,x.ThumbnailMigration],exports:["JobsService"]};let q=class JobsModule{};t.JobsModule=q,t.JobsModule=q=i([(0,s.Module)(t.JobsModuleMetadata)],q)},29972:function(e,t,a){"use strict";var i,s,r,l,c,d,u=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsProcessor=void 0;const _=a(42736),f=a(23324),h=a(80344),g=a(81472),y=a(892),b=a(104),w=a(21904),v=a(81472),T=null!==(i=process.env.NC_WORKER_CONCURRENCY)&&void 0!==i?i:5;let k=s=class JobsProcessor{constructor(e,t,a){this.jobsService=e,this.jobsEventService=t,this.jobsMap=a,this.logger=new f.Logger(s.name)}async process(e){var t;const{jobName:a}=e.data;if(!this.jobsMap.jobs[a])return this.logger.error(`Job not found for ${a}`),void await this.requeue(e);const{this:i,fn:s="job"}=this.jobsMap.jobs[a];if(!i[s])return this.logger.error(`Job function not found for ${a}`),void await this.requeue(e);if((g.JobVersions[a]||(null===(t=e.data)||void 0===t?void 0:t._jobVersion))&&g.JobVersions[a]!==e.data._jobVersion)return this.logger.error(`Job version mismatch for ${a}`),void await this.requeue(e);try{return await i[s](e)}catch(e){throw this.logger.error(`Error processing job ${a}`,e),e}}async requeue(e){var t,a,i,s;await e.releaseLock(),await e.remove(),await this.jobsEventService.onCompleted(e,v.JobStatus.REQUEUED);const r=null!==(a=null===(t=e.data)||void 0===t?void 0:t._jobDelay)&&void 0!==a?a:0,l=null!==(s=null===(i=e.data)||void 0===i?void 0:i._jobAttempt)&&void 0!==s?s:1;if(!(l>g.JOB_REQUEUE_LIMIT))return e.data._jobDelay=r+5e3,e.data._jobAttempt=l+1,this.jobsService.add(e.data.jobName,e.data,{jobId:e.id.toString(),delay:e.data._jobDelay});this.logger.error(`Job ${e.data.jobName} failed after 10 attempts`)}};t.JobsProcessor=k,u([(0,_.Process)({concurrency:+T}),p("design:type",Function),p("design:paramtypes",["function"==typeof(d=void 0!==h.Job&&h.Job)?d:Object]),p("design:returntype",Promise)],k.prototype,"process",null),t.JobsProcessor=k=s=u([(0,_.Processor)(g.JOBS_QUEUE),m(0,(0,f.Inject)("JobsService")),p("design:paramtypes",["function"==typeof(r=void 0!==y.IJobsService&&y.IJobsService)?r:Object,"function"==typeof(l=void 0!==w.JobsEventService&&w.JobsEventService)?l:Object,"function"==typeof(c=void 0!==b.JobsMap&&b.JobsMap)?c:Object])],k)},47408:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AtImportController=void 0;const u=a(23324),p=a(79224),m=a(23668),_=a(47932),f=a(19684),h=a(43820),g=a(81472),y=a(67240),b=a(892),w=a(26212),v=a(48967);let T=class AtImportController{constructor(e){this.jobsService=e}async triggerSync(e,t){(await this.jobsService.jobList()).find((e=>e.data.syncId===t.params.syncId))&&h.NcError.badRequest("Sync already in progress");const a=await f.SyncSource.get(e,t.params.syncId),i=await a.getUser();let s=t.ncSiteUrl;process.env.NC_DOCKER&&(s=`http://localhost:${process.env.PORT||8080}`);return{id:(await this.jobsService.add(g.JobTypes.AtImport,Object.assign(Object.assign({context:e,syncId:t.params.syncId},(null==a?void 0:a.details)||{}),{baseId:a.base_id,sourceId:a.source_id,authToken:"",baseURL:s,user:i}))).id}}async abortImport(){return{}}};t.AtImportController=T,l([(0,u.Post)(["/api/v1/db/meta/syncs/:syncId/trigger","/api/v2/meta/syncs/:syncId/trigger"]),(0,_.Acl)("airtableImport"),(0,u.HttpCode)(200),d(0,(0,w.TenantContext)()),d(1,(0,u.Req)()),c("design:type",Function),c("design:paramtypes",["function"==typeof(s=void 0!==v.NcContext&&v.NcContext)?s:Object,"function"==typeof(r=void 0!==p.Request&&p.Request)?r:Object]),c("design:returntype",Promise)],T.prototype,"triggerSync",null),l([(0,u.Post)(["/api/v1/db/meta/syncs/:syncId/abort","/api/v2/meta/syncs/:syncId/abort"]),(0,_.Acl)("airtableImport"),(0,u.HttpCode)(200),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],T.prototype,"abortImport",null),t.AtImportController=T=l([(0,u.Controller)(),(0,u.UseGuards)(y.MetaApiLimiterGuard,m.GlobalGuard),d(0,(0,u.Inject)("JobsService")),c("design:paramtypes",["function"==typeof(i=void 0!==b.IJobsService&&b.IJobsService)?i:Object])],T)},34976:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},k=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AtImportProcessor=void 0;const M=S(a(43936)),O=a(71040),I=S(a(86814)),C=S(a(54784)),E=S(a(44578)),x=S(a(51718)),L=S(a(48616)),R=a(71040),N=S(a(89576)),A=a(23324),D=a(26144),j=S(a(91216)),P=a(13204),q=S(a(95315)),U=a(19684),$=a(43468),Y=a(58504),B=a(74056),F=a(26272),V=a(53311),H=a(69200),G=a(48968),W=a(98348),z=a(54024),J=a(40668),K=a(50976),Q=a(69680),X=a(38900),Z=a(38040),ee=a(76383),te=a(75564),ae=a(87424),ie=S(a(82096)),ne=new A.Logger("at-import");E.default.extend(x.default);const se={blue:"#cfdfff",cyan:"#d0f0fd",teal:"#c2f5e9",green:"#d1f7c4",orange:"#fee2d5",yellow:"#ffeab6",red:"#ffdce5",pink:"#ffdaf6",purple:"#ede2fe",gray:"#eee",blueMedium:"#9cc7ff",cyanMedium:"#77d1f3",tealMedium:"#72ddc3",greenMedium:"#93e088",orangeMedium:"#ffa981",yellowMedium:"#ffd66e",redMedium:"#ff9eb7",pinkMedium:"#f99de2",purpleMedium:"#cdb0ff",grayMedium:"#ccc",blueDark:"#2d7ff9",cyanDark:"#18bfff",tealDark:"#20d9d2",greenDark:"#20c933",orangeDark:"#ff6f2c",yellowDark:"#fcb400",redDark:"#f82b60",pinkDark:"#ff08c2",purpleDark:"#8b46ff",grayDark:"#666",blueDarker:"#2750ae",cyanDarker:"#0b76b7",tealDarker:"#06a09b",greenDarker:"#338a17",orangeDarker:"#d74d26",yellowDarker:"#b87503",redDarker:"#ba1e45",pinkDarker:"#b2158b",purpleDarker:"#6b1cb0",grayDarker:"#444"};let oe=class AtImportProcessor{constructor(e,t,a,i,s,r,l,c,d,u,p,m,_,f,h,g,y){this.tablesService=e,this.viewsService=t,this.basesService=a,this.attachmentsService=i,this.columnsService=s,this.filtersService=r,this.formColumnsService=l,this.formsService=c,this.galleriesService=d,this.gridsService=u,this.baseUsersService=p,this.viewColumnsService=m,this.sortsService=_,this.bulkDataAliasService=f,this.jobsLogService=h,this.gridColumnService=g,this.telemetryService=y,this.debugLog=(0,N.default)("nc:jobs:at-import")}async job(e){var t;this.debugLog(`job started for ${e.id}`);const a=e.data.context,i=e.data,s={user:{id:i.user.id,email:i.user.email},clientIp:i.clientIp},r=new q.default("aTblId","ncId","ncName","ncParent");await r.init();const l=i.user.roles.split(",").reduce(((e,t)=>Object.assign({[t]:!0},e))),c={async addToMappingTbl(e,t,a,i){await r.addRow({aTblId:e,ncId:t,ncName:a,ncParent:i})},async getNcIdFromAtId(e){var t;return null===(t=await r.getRow("aTblId",e,["ncId"]))||void 0===t?void 0:t.ncId},async getNcParentFromAtId(e){var t;return null===(t=await r.getRow("aTblId",e,["ncParent"]))||void 0===t?void 0:t.ncParent},async getNcNameFromAtId(e){var t;return null===(t=await r.getRow("aTblId",e,["ncName"]))||void 0===t?void 0:t.ncName}},d=t=>{this.jobsLogService.sendLog(e,{message:t}),this.debugLog(t)},u=t=>{this.jobsLogService.sendLog(e,{message:`WARNING: ${t}`}),this.debugLog(t)},p=t=>{w&&this.jobsLogService.sendLog(e,{message:t}),this.debugLog(t)},m=[],_=()=>w?Date.now():0,f=(e,t)=>{if(!w)return;const a=Date.now()-e;m.push({d:a,e:t})};let h,g;const y=Date.now(),b=!1,w=!1;let v=[],T={};const k=[],S=[],x=[],N="ncRecordId",A="ncRecordHash",D={},Y={},B={},F=(e,t,a)=>{B[e]||(B[e]={}),B[e][t]=a},V=(e,t)=>B[e][t],H=le("sheet"),G={sort:0,filter:0,view:{total:0,grid:0,gallery:0,form:0},fetchAt:{count:0,time:0},migrationSkipLog:{count:0,log:[]},data:{records:0,nestedLinks:0}},W=(e,t,a,i)=>{G.migrationSkipLog.count++,G.migrationSkipLog.log.push(`tn[${e}] cn[${t}] type[${a}] :: ${i}`),u(`Skipped${e?` ${e} :: `:""}${t?`${t}`:""}${a?` (${a})`:""} :: ${i}`)},z=async e=>{const t=Date.now(),a=await j.default.readView(e),i=Date.now()-t;return G.fetchAt.count++,G.fetchAt.time+=i,a.view},J=()=>{var e;return null===(e=null==T?void 0:T.sources.find((e=>e.id===i.sourceId)))||void 0===e?void 0:e.type},K={foreignKey:O.UITypes.Links,text:O.UITypes.SingleLineText,multilineText:O.UITypes.LongText,richText:O.UITypes.LongText,multipleAttachment:O.UITypes.Attachment,checkbox:O.UITypes.Checkbox,multiSelect:O.UITypes.MultiSelect,select:O.UITypes.SingleSelect,collaborator:O.UITypes.Collaborator,multiCollaborator:O.UITypes.Collaborator,date:O.UITypes.Date,phone:O.UITypes.PhoneNumber,number:O.UITypes.Decimal,rating:O.UITypes.Rating,formula:O.UITypes.Formula,rollup:O.UITypes.Rollup,count:O.UITypes.Rollup,lookup:O.UITypes.Lookup,autoNumber:O.UITypes.Decimal,barcode:O.UITypes.SingleLineText,button:O.UITypes.Button},Q=(e,t)=>{var a;const i=le("column",t),s=le("field",t),r=null===(a=(0,$.sanitizeColumnName)(e,J()))||void 0===a?void 0:a.slice(0,50);return{title:s(e.trim().replace(/\./g,"_")),column_name:i(r)}},X={tables:[],tablesById:{}},Z=e=>{for(let t=0;t<v.length;t++){const a=v[t],i=a.columns.find((t=>t.id===e));if(void 0!==i)return{tn:a.name,cn:i.name}}},ee=async e=>{const t=await c.getNcParentFromAtId(e),a=await c.getNcIdFromAtId(e);return a&&t?X.tablesById[t].columns.find((e=>e.id===a)):0},te=async e=>X.tables.find((t=>t.title===e)),ae=e=>{var t,a,i,s,r,l,c,d,u,p;let m=K[e.type];switch(e.type){case"text":"email"===(null===(t=e.typeOptions)||void 0===t?void 0:t.validatorName)?m=O.UITypes.Email:"url"===(null===(a=e.typeOptions)||void 0===a?void 0:a.validatorName)&&(m=O.UITypes.URL);break;case"number":"percentV2"===(null===(i=e.typeOptions)||void 0===i?void 0:i.format)?m=O.UITypes.Percent:"duration"===(null===(s=e.typeOptions)||void 0===s?void 0:s.format)?m=O.UITypes.Duration:"currency"===(null===(r=e.typeOptions)||void 0===r?void 0:r.format)?m=O.UITypes.Currency:(null===(l=e.typeOptions)||void 0===l?void 0:l.precision)>0&&(m=O.UITypes.Decimal);break;case"formula":("CREATED_TIME()"===(null===(c=e.typeOptions)||void 0===c?void 0:c.formulaTextParsed)||"LAST_MODIFIED_TIME()"===(null===(d=e.typeOptions)||void 0===d?void 0:d.formulaTextParsed))&&(m=O.UITypes.DateTime);break;case"computation":"collaborator"===(null===(u=e.typeOptions)||void 0===u?void 0:u.resultType)&&(m=O.UITypes.Collaborator);break;case"date":(null===(p=e.typeOptions)||void 0===p?void 0:p.isDateTime)&&(m=O.UITypes.DateTime)}return m},oe=async e=>{var t;switch(e.type){case"select":case"multiSelect":{const a=[];let i=1;for(const[,s]of Object.entries(e.typeOptions.choices))s.name=null===(t=s.name)||void 0===t?void 0:t.slice(0,255),"multiSelect"===e.type&&(s.name=s.name.replace(/,/g,".")),""===s.name&&(s.name="nc_empty"),a.find((e=>e.title===s.name))?u(`Duplicate select option found: ${e.name} :: ${s.name}`):(a.push({order:i++,title:s.name,color:se[s.color]?se[s.color]:L.default.random().toHexString()}),await c.addToMappingTbl(s.id,void 0,s.name));return{type:e.type,data:a}}default:return{type:void 0}}},re=async e=>{var t;const r=await(async e=>{const t=[];for(let s=0;s<e.length;++s){const r={};i.options.syncViews?G.view.total+=e[s].views.reduce(((e,t)=>["grid","form","gallery"].includes(t.type)?++e:e),0):G.view.total=e.length,r.title=e[s].name;let l=(0,$.sanitizeColumnName)(e[s].name,J());l=null==l?void 0:l.slice(0,50),r.table_name=H(l),r.columns=[];const c=await U.Source.get(a,i.sourceId),d=[...O.SqlUiFactory.create({client:c.type}).getNewTableColumns().filter((e=>"id"===e.column_name)),{title:N,column_name:N,uidt:O.UITypes.SingleLineText,system:!0},{title:A,column_name:A,uidt:O.UITypes.SingleLineText,system:!0}];r.columns.push(...d);for(const e of d)Q(e.title,r.table_name),F(r.title,e.title,e.title);for(let t=0;t<e[s].columns.length;t++){const a=e[s].columns[t];if(["foreignKey","lookup","rollup","count"].includes(a.type))continue;const i=Q(a.name,r.table_name);F(r.title,a.name,i.title);const l={title:i.title,column_name:i.column_name,uidt:ae(a)};if(l.uidt===O.UITypes.Formula){W(e[s].name,i.title,a.type,"column type not supported yet");continue}"text"===a.type&&(l.dt="text"),["sqlite3","mysql2"].includes(J())&&l.uidt===O.UITypes.Decimal&&(l.dt="double",l.dtxp=22,l.dtxs="2");const c=await oe(a);switch(c.type){case"select":case"multiSelect":l.colOptions={options:[...c.data]},["mysql","mysql2"].includes(J())&&(l.dtxp=c.data.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")||"''")}r.columns.push(l)}t.push(r)}return t})(e);for(let u=0;u<r.length;u++){d(`:: [${u+1}/${r.length}] ${r[u].title}`),p(`NC API: base.tableCreate ${r[u].title}`);let m=_();const h=await this.tablesService.tableCreate(a,{sourceId:i.sourceId,baseId:T.id,table:r[u],user:i.user});f(m,"dbTable.create"),ke(h),await c.addToMappingTbl(e[u].id,h.id,h.title);for(let a=0;a<h.columns.length;a++){const i=null===(t=e[u].columns.find((e=>V(h.title,e.name.trim().replace(/\./g,"_"))===h.columns[a].title)))||void 0===t?void 0:t.id;i&&await c.addToMappingTbl(i,h.columns[a].id,h.columns[a].title,h.id)}p(`NC API: dbView.list ${h.id}`),m=_();const g={list:[]};g.list=await this.viewsService.viewList(a,{tableId:h.id,user:{roles:l,base_roles:{owner:!0}}}),f(m,"dbView.list");const y=e[u].views.find((e=>"grid"===e.type));p(`NC API: dbView.update ${g.list[0].id} ${y.name}`),m=_(),await this.viewsService.viewUpdate(a,{viewId:g.list[0].id,view:{title:y.name},user:i.user,req:s}),f(m,"dbView.update"),await Se(h.id),await c.addToMappingTbl(y.id,h.views[0].id,y.name,h.id)}return r},ce=async e=>{var t,r,l,d;for(let u=0;u<e.length;u++){const m=e[u].columns.filter((e=>"foreignKey"===e.type));if(m.length)for(let h=0;h<m.length;h++){p(`[${u+1}/${e.length}] Configuring Links :: [${h+1}/${m.length}] ${e[u].name}`);{const e=Z(m[h].id),a=Z(null===(t=m[h].typeOptions)||void 0===t?void 0:t.symmetricColumnId);p(`LTAR ${e.tn}:${e.cn} <${m[h].typeOptions.relationship}> ${null==a?void 0:a.tn}:${null==a?void 0:a.cn}`)}if(he(m[h].id)){const e=k.findIndex((e=>e.aTbl.tblId===m[h].typeOptions.foreignTableId&&e.aTbl.id===m[h].typeOptions.symmetricColumnId));let t=_();const s=await this.tablesService.getTableWithAccessibleViews(a,{tableId:k[e].nc.childId,user:Object.assign(Object.assign({},i.user),{base_roles:{owner:!0}})});f(t,"dbTable.read"),t=_();const r=await this.tablesService.getTableWithAccessibleViews(a,{tableId:k[e].nc.parentId,user:Object.assign(Object.assign({},i.user),{base_roles:{owner:!0}})});f(t,"dbTable.read");let l=r.columns.find((t=>t.title===k[e].nc.title));if(void 0===l){W(null==r?void 0:r.title,k[e].nc.title,O.UITypes.Links,"Link error");continue}(0,R.isLinksOrLTAR)(l)||(l=r.columns.find((t=>t.title===k[e].nc.title+"_2")));let u={};u="hm"==l.colOptions.type?s.columns.find((e=>(0,R.isLinksOrLTAR)(e)&&e.colOptions.fk_child_column_id===l.colOptions.fk_child_column_id&&e.colOptions.fk_parent_column_id===l.colOptions.fk_parent_column_id)):s.columns.find((e=>(0,R.isLinksOrLTAR)(e)&&e.colOptions.fk_child_column_id===l.colOptions.fk_parent_column_id&&e.colOptions.fk_parent_column_id===l.colOptions.fk_child_column_id&&e.colOptions.fk_mm_model_id===l.colOptions.fk_mm_model_id));const g=Q(m[h].name,s.table_name);p(`NC API: dbTableColumn.update rename symmetric column ${g.title}`),t=_();const y=await this.columnsService.columnUpdate(a,{columnId:u.id,column:Object.assign(Object.assign({},u),{title:g.title,column_name:g.column_name}),user:i.user});f(t,"dbTableColumn.update"),ke(y);const b=null===(d=y.columns.find((e=>e.title===g.title)))||void 0===d?void 0:d.id;await c.addToMappingTbl(m[h].id,b,g.title,y.id)}else{const t=await c.getNcIdFromAtId(e[u].id),d=Z(null===(r=m[h].typeOptions)||void 0===r?void 0:r.symmetricColumnId);let g=t;d&&(g=(await te(d.tn)).id);let y=_();const b=await this.tablesService.getTableWithAccessibleViews(a,{tableId:t,user:Object.assign(Object.assign({},i.user),{base_roles:{owner:!0}})});f(y,"dbTable.read");const w=Q(m[h].name,b.table_name);Y[b.id]=Y[b.id]||{},Y[b.id][w.title]=m[h].name,p(`NC API: dbTableColumn.create LinkToAnotherRecord ${w.title}`),y=_();const v=await this.columnsService.columnAdd(a,{tableId:t,column:{uidt:O.UITypes.Links,title:w.title,column_name:w.column_name,parentId:t,childId:g,type:"mm"},req:s,user:i.user});f(y,"dbTableColumn.create"),ke(v);const T=null===(l=v.columns.find((e=>e.title===w.title)))||void 0===l?void 0:l.id;await c.addToMappingTbl(m[h].id,T,w.title,v.id);const S={nc:{title:w.title,parentId:t,childId:g,type:"mm"},aTbl:Object.assign({tblId:e[u].id},m[h])};k.push(S)}}}},de=async e=>{var t,r,l,d,u,m,h;for(let m=0;m<e.length;m++){const h=e[m].columns.filter((e=>"lookup"===e.type)),g=await c.getNcIdFromAtId(e[m].id),y=X.tablesById[g];if(h.length)for(let w=0;w<h.length;w++){if(p(`[${m+1}/${e.length}] Configuring Lookup :: [${w+1}/${h.length}] ${e[m].name}`),null===(d=null===(l=null===(r=null===(t=h[w])||void 0===t?void 0:t.typeOptions)||void 0===r?void 0:r.dependencies)||void 0===l?void 0:l.invalidColumnIds)||void 0===d?void 0:d.length){b,W(y.title,h[w].name,h[w].type,"invalid column ID in dependency list");continue}const v=await c.getNcIdFromAtId(h[w].typeOptions.relationColumnId),T=await c.getNcIdFromAtId(h[w].typeOptions.foreignTableRollupColumnId);if(!T||!v){h[w].srcTableId=g,S.push(h[w]);continue}const k=Q(h[w].name,y.table_name);p(`NC API: dbTableColumn.create LOOKUP ${k.title}`);const M=_(),I=await this.columnsService.columnAdd(a,{tableId:g,column:{uidt:O.UITypes.Lookup,title:k.title,column_name:k.column_name,fk_relation_column_id:v,fk_lookup_column_id:T},req:s,user:i.user});f(M,"dbTableColumn.create"),ke(I);const C=null===(u=I.columns.find((e=>e.title===h[w].name)))||void 0===u?void 0:u.id;await c.addToMappingTbl(h[w].id,C,h[w].name,I.id)}}let g=2,y=0;for(;S.length;){if(y===S.length){for(let e=0;e<S.length;e++){const t=S[e].typeOptions.foreignTableRollupColumnId,a=Z(t);W(null===(m=X.tablesById[S[e].srcTableId])||void 0===m?void 0:m.title,S[e].name,S[e].type,`foreign table field not found [${a.tn}/${a.cn}]`)}b;break}y=S.length;for(let e=0;e<S.length;e++){const t=S[0].srcTableId,s=X.tablesById[t],r=await c.getNcIdFromAtId(S[0].typeOptions.relationColumnId),l=await c.getNcIdFromAtId(S[0].typeOptions.foreignTableRollupColumnId);if(!l||!r)continue;const d=Q(S[0].name,s.table_name);p(`Configuring Nested Lookup: Level-${g} [${e+1}/${y} ${d.title}]`),p(`NC API: dbTableColumn.create LOOKUP ${d.title}`);const u=_(),m=await this.columnsService.columnAdd(a,{tableId:t,column:{uidt:O.UITypes.Lookup,title:d.title,column_name:d.column_name,fk_relation_column_id:r,fk_lookup_column_id:l},req:{user:i.user.email,clientIp:""},user:i.user});f(u,"dbTableColumn.create"),ke(m);const b=null===(h=m.columns.find((e=>e.title===S[0].name)))||void 0===h?void 0:h.id;await c.addToMappingTbl(S[0].id,b,S[0].name,m.id),S.splice(0,1)}g++}},ue=async e=>{var t,r,l,d,m,h,g;for(let y=0;y<e.length;y++){const w=e[y].columns.filter((e=>"rollup"===e.type||"count"===e.type)),v=await c.getNcIdFromAtId(e[y].id),T=X.tablesById[v];if(w.length)for(let k=0;k<w.length;k++){p(`[${y+1}/${e.length}] Configuring Rollup :: [${k+1}/${w.length}] ${e[y].name}`);const S="count"===w[k].type?"count":{AND:"",ARRAYCOMPACT:"",ARRAYJOIN:"",ARRAYUNIQUE:"",AVERAGE:"avg",CONCATENATE:"",COUNT:"count",COUNTA:"",COUNTALL:"count",MAX:"max",MIN:"min",OR:"",SUM:"sum",XOR:""}[w[k].typeOptions.formulaTextParsed.split("(")[0]];if(""===S||void 0===S){W(T.title,w[k].name,w[k].type,`rollup function ${w[k].typeOptions.formulaTextParsed} not supported yet`);continue}if(null===(d=null===(l=null===(r=null===(t=w[k])||void 0===t?void 0:t.typeOptions)||void 0===r?void 0:r.dependencies)||void 0===l?void 0:l.invalidColumnIds)||void 0===d?void 0:d.length){b,W(T.title,w[k].name,w[k].type,"invalid column ID in dependency list");continue}const M=await c.getNcIdFromAtId(w[k].typeOptions.relationColumnId);let I=await c.getNcIdFromAtId(w[k].typeOptions.foreignTableRollupColumnId);if(!I&&"count"===w[k].type){const e=await ee(w[k].typeOptions.relationColumnId),t=null===(m=null==e?void 0:e.colOptions)||void 0===m?void 0:m.fk_related_model_id;t&&(I=null===(h=X.tablesById[t].columns.find((e=>e.pk)))||void 0===h?void 0:h.id)}if(!I){w[k].srcTableId=v,x.push(w[k]);continue}const C=await ee(w[k].typeOptions.foreignTableRollupColumnId);if((null==C?void 0:C.uidt)===O.UITypes.Formula||(null==C?void 0:C.uidt)===O.UITypes.Lookup||(null==C?void 0:C.uidt)===O.UITypes.Rollup||(null==C?void 0:C.uidt)===O.UITypes.Checkbox){W(T.title,w[k].name,w[k].type,"rollup referring to a column type not supported yet");continue}const E=Q(w[k].name,T.table_name);p(`NC API: dbTableColumn.create ROLLUP ${E.title}`);const L=_();try{const e=await this.columnsService.columnAdd(a,{tableId:v,column:{uidt:O.UITypes.Rollup,title:E.title,column_name:E.column_name,fk_relation_column_id:M,fk_rollup_column_id:I,rollup_function:S},req:s,user:i.user});f(L,"dbTableColumn.create"),ke(e);const t=null===(g=e.columns.find((e=>e.title===w[k].name)))||void 0===g?void 0:g.id;await c.addToMappingTbl(w[k].id,t,w[k].name,e.id)}catch(e){u(`Skipped creating rollup column ${w[k].name} :: ${e.message}`)}}}p(`Nested rollup: ${x.length}`)},pe=async()=>{var e;const t=S.length;for(let r=0;r<S.length;r++){const l=S[0].srcTableId,d=X.tablesById[l],u=await c.getNcIdFromAtId(S[0].typeOptions.relationColumnId),m=await c.getNcIdFromAtId(S[0].typeOptions.foreignTableRollupColumnId);if(!m||!u)continue;const h=Q(S[0].name,d.table_name);p(`Configuring Lookup over Rollup :: [${r+1}/${t}] ${h.title}`),p(`NC API: dbTableColumn.create LOOKUP ${h.title}`);const g=_(),y=await this.columnsService.columnAdd(a,{tableId:l,column:{uidt:O.UITypes.Lookup,title:h.title,column_name:h.column_name,fk_relation_column_id:u,fk_lookup_column_id:m},req:s,user:i.user});f(g,"dbTableColumn.create"),ke(y);const b=null===(e=y.columns.find((e=>e.title===S[0].name)))||void 0===e?void 0:e.id;await c.addToMappingTbl(S[0].id,b,S[0].name,y.id),S.splice(0,1)}},me=async e=>{for(let t=0;t<e.length;t++){p(`[${t+1}/${e.length}] Configuring Display value : ${e[t].name}`);const i=e[t].primaryColumnId,s=await c.getNcIdFromAtId(i);if(s){p("NC API: dbTableColumn.primaryColumnSet");const i=_();await this.columnsService.columnSetAsPrimary(a,{columnId:s}),f(i,"dbTableColumn.primaryColumnSet");const r=await c.getNcIdFromAtId(e[t].id);await Se(r)}}},_e=async(e,t,i)=>{var s;let r;const l=_();return"form"===t?(r=(await this.formsService.formViewGet(a,{formViewId:e})).columns,f(l,"dbView.formRead")):"gallery"===t?(r=(await this.galleriesService.galleryViewGet(a,{galleryViewId:e})).columns,f(l,"dbView.galleryRead")):(r=await this.viewColumnsService.columnList(a,{viewId:e}),f(l,"dbView.gridColumnsList")),null===(s=r.find((e=>e.fk_column_id===i)))||void 0===s?void 0:s.id},fe=async(e,t,a)=>{var r,l,c;const u=(0,C.default)(a),p=Object.assign({},a.fields);Object.keys(p).forEach((e=>{const a=V(t.title,e.trim().replace(/\./g,"_"));e!==a&&(p[a]=p[e],delete p[e])}));for(const[e,a]of Object.entries(p)){const u=null===(r=t.columns.find((t=>t.title===e)))||void 0===r?void 0:r.uidt;if(a||(0,R.isLinksOrLTAR)(u)||u===O.UITypes.Lookup||u===O.UITypes.Rollup)switch(u){case O.UITypes.Currency:p[e]=(+a).toFixed(2);break;case O.UITypes.LinkToAnotherRecord:case O.UITypes.Links:false,delete p[e];break;case O.UITypes.Lookup:case O.UITypes.Rollup:delete p[e];break;case O.UITypes.Collaborator:if(Array.isArray(a)){let t="";for(let i=0;i<a.length;i++)t+=`${null===(l=a[i])||void 0===l?void 0:l.name} <${null===(c=a[i])||void 0===c?void 0:c.email}>, `,p[e]=t}else p[e]=`${null==a?void 0:a.name} <${null==a?void 0:a.email}>`;break;case O.UITypes.Button:p[e]=`${null==a?void 0:a.label} <${null==a?void 0:a.url}>`;break;case O.UITypes.DateTime:case O.UITypes.CreatedTime:case O.UITypes.LastModifiedTime:p[e]=(0,E.default)(a).format("YYYY-MM-DD HH:mm");break;case O.UITypes.Date:/\d{5,}/.test(a)?(p[e]=null,d(`:: Invalid date ${a}`)):p[e]=(0,E.default)(a).format("YYYY-MM-DD");break;case O.UITypes.SingleSelect:""===a&&(p[e]="nc_empty"),p[e]=a;break;case O.UITypes.MultiSelect:p[e]=null==a?void 0:a.map((e=>""===e?"nc_empty":`${e.replace(/,/g,".")}`)).join(",");break;case O.UITypes.Attachment:if(i.options.syncAttachment){let t=[];try{d(` :: Retrieving attachment :: ${null==a?void 0:a.map((e=>{var t,a;return null===(a=null===(t=e.filename)||void 0===t?void 0:t.split("?"))||void 0===a?void 0:a[0]})).join(", ")}`);const e=`${(0,M.default)().format("YYYY/MM/DD")}/${(0,C.default)(i.user.id)}`;t=await this.attachmentsService.uploadViaURL({path:e,urls:null==a?void 0:a.map((e=>{var t,a;return{fileName:null===(a=null===(t=e.filename)||void 0===t?void 0:t.split("?"))||void 0===a?void 0:a[0],url:e.url,size:e.size,mimetype:e.type}})),req:s})}catch(e){ne.log(e)}p[e]=JSON.stringify(t)}else p[e]=null;break;case O.UITypes.SingleLineText:(null==a?void 0:a.text)&&(p[e]=a.text);break;case O.UITypes.LongText:p[e]=a.replace(/\u0000/g,"")}else p[e]=null}return p[N]=a.id,p[A]=u,p},he=e=>!!k.find((t=>t.aTbl.typeOptions.symmetricColumnId===e)),ge=async e=>{p(`Create Base: ${e}`);const t=_();T=await this.basesService.baseCreate({base:{title:e},user:{id:i.user.id},req:s}),f(t,"base.create")},ye=async e=>{p(`Getting base meta: ${e}`);const t=_();T=await this.basesService.getProjectWithInfo(a,{baseId:e}),f(t,"base.read")},be=async(e,t)=>{var r;if(e.options.syncViews)for(let e=0;e<t.length;e++){const l=(await te(t[e].name)).id,c=t[e].views.filter((e=>"gallery"===e.type)),u=G.view.grid+G.view.gallery+G.view.form;G.view.gallery+=c.length;for(let m=0;m<c.length;m++){p("   Axios fetch view-data"),await z(c[m].id);const h=null===(r=t[e].views.find((e=>e.id===c[m].id)))||void 0===r?void 0:r.name;d(`:: [${u+m+1}/${G.view.total}] Gallery : ${t[e].name} / ${h}`),p(`NC API dbView.galleryCreate :: ${h}`);const g=_();await this.galleriesService.galleryViewCreate(a,{tableId:l,gallery:{title:h},user:i.user,req:s}),f(g,"dbView.galleryCreate"),await Se(l)}}},we=async(e,t)=>{var r,l,u,m,h;if(e.options.syncViews)for(let e=0;e<t.length;e++){const g=await c.getNcIdFromAtId(t[e].id),y=t[e].views.filter((e=>"form"===e.type)),b=G.view.grid+G.view.gallery+G.view.form;G.view.form+=y.length;for(let c=0;c<y.length;c++){p("   Axios fetch view-data");const w=await z(y[c].id),v=null===(r=t[e].views.find((e=>e.id===y[c].id)))||void 0===r?void 0:r.name;d(`:: [${b+c+1}/${G.view.total}] Form : ${t[e].name} / ${v}`);let T="NO_REFRESH",k="Thank you for submitting the form!",S="";(null===(l=w.metadata)||void 0===l?void 0:l.form)&&((null===(u=w.metadata.form)||void 0===u?void 0:u.refreshAfterSubmit)&&(T=w.metadata.form.refreshAfterSubmit),(null===(m=w.metadata.form)||void 0===m?void 0:m.afterSubmitMessage)&&(k=w.metadata.form.afterSubmitMessage),(null===(h=w.metadata.form)||void 0===h?void 0:h.description)&&(S=w.metadata.form.description));const M={title:v,heading:v,subheading:S,success_msg:k,submit_another_form:T.includes("REFRESH_BUTTON"),show_blank_form:T.includes("AUTO_REFRESH")};p(`NC API dbView.formCreate :: ${v}`);const O=_(),I=await this.formsService.formViewCreate(a,{tableId:g,body:M,user:i.user,req:s});f(O,"dbView.formCreate"),p(`[${e+1}/${t.length}][Form View][${c+1}/${y.length}] Create ${v}`),await Se(g),p("   Configure show/hide columns"),await Le(I.id,w,t[e].name,v,"form")}}},ve=async(e,t)=>{var r,u,m,h;for(let g=0;g<t.length;g++){const y=await c.getNcIdFromAtId(t[g].id),b=t[g].views.filter((e=>"grid"===e.type));let w=g;i.options.syncViews&&(w=G.view.grid+G.view.gallery+G.view.form),G.view.grid+=b.length;for(let i=0;i<(e.options.syncViews?b.length:1);i++){p("   Axios fetch view-data");const e=await z(b[i].id),v=null===(r=t[g].views.find((e=>e.id===b[i].id)))||void 0===r?void 0:r.name,T=_(),k={list:[]};k.list=await this.viewsService.viewList(a,{tableId:y,user:{roles:l,base_roles:{owner:!0}}}),f(T,"dbView.list");let S=null===(m=null===(u=null==k?void 0:k.list)||void 0===u?void 0:u.find((e=>e.tn===v)))||void 0===m?void 0:m.id;if(d(`:: [${w+i+1}/${G.view.total}] Grid : ${t[g].name} / ${v}`),i>0){p(`NC API dbView.gridCreate :: ${v}`);const e=_(),t=await this.gridsService.gridViewCreate(a,{tableId:y,grid:{title:v},req:s});f(e,"dbView.gridCreate"),await Se(y),await c.addToMappingTbl(b[i].id,t.id,v,y),S=t.id}p("   Configure show/hide columns"),await Le(S,e,t[g].name,v,"grid"),(null==e?void 0:e.filters)&&(p("   Configure filter set"),e.filters.filterSet.find((e=>"nested"===(null==e?void 0:e.type)))||await Ce(S,e.filters)),(null===(h=null==e?void 0:e.lastSortsApplied)||void 0===h?void 0:h.sortSet.length)&&(p("   Configure sort set"),await xe(S,e.lastSortsApplied)),(null==e?void 0:e.groupLevels)&&(p("   Configure group set"),await Ee(S,e.groupLevels))}}},Te=async e=>{const t={owner:"owner",create:"creator",edit:"editor",comment:"commenter",read:"viewer",none:"viewer"},i=e.appBlanket.userInfoById,r=Object.keys(i).length;let l=0;for(const[,e]of Object.entries(i)){p(`[${++l}/${r}] NC API auth.baseUserAdd :: ${e.email}`);const i=_();await this.baseUsersService.userInvite({workspace_id:a.workspace_id,base_id:T.id},{baseId:T.id,baseUser:{email:e.email,roles:t[e.permissionLevel]},req:s}).catch((e=>{e.message||ne.log(e)})),f(i,"auth.baseUserAdd")}},ke=e=>{const t=e.id,a=X.tables.findIndex((e=>e.id===t));-1!==a&&X.tables.splice(a,1),X.tables.push(e),X.tablesById[t]=e},Se=async e=>{const t=_(),s=await this.tablesService.getTableWithAccessibleViews(a,{tableId:e,user:Object.assign(Object.assign({},i.user),{base_roles:{owner:!0}})});f(t,"dbTable.read"),ke(s)},Me=[],Oe=async e=>{var t,a,s,r,l,c,u,p;const m={table_name:"",aTbl:{columns:0,links:0,lookup:0,rollup:0},nc:{columns:0,links:0,lookup:0,rollup:0,invalidColumn:0}};for(let i=0;i<e.length;i++){m.table_name=e[i].name;const d=e[i].columns.filter((e=>"foreignKey"===e.type)),_=e[i].columns.filter((e=>"lookup"===e.type)),f=e[i].columns.filter((e=>"rollup"===e.type||"count"===e.type));let h=0;for(let e=0;e<_.length;e++)(null===(r=null===(s=null===(a=null===(t=_[e])||void 0===t?void 0:t.typeOptions)||void 0===a?void 0:a.dependencies)||void 0===s?void 0:s.invalidColumnIds)||void 0===r?void 0:r.length)&&h++;for(let e=0;e<f.length;e++)(null===(p=null===(u=null===(c=null===(l=f[e])||void 0===l?void 0:l.typeOptions)||void 0===c?void 0:c.dependencies)||void 0===u?void 0:u.invalidColumnIds)||void 0===p?void 0:p.length)&&h++;m.aTbl.columns=e[i].columns.length,m.aTbl.links=d.length,m.aTbl.lookup=_.length,m.aTbl.rollup=f.length;const g=await te(e[i].name),y=g.columns.filter((e=>(0,R.isLinksOrLTAR)(e))),b=g.columns.filter((e=>e.uidt===O.UITypes.Lookup)),w=g.columns.filter((e=>e.uidt===O.UITypes.Rollup));m.nc.columns=g.columns.length-y.length/2,m.nc.links=y.length/2,m.nc.lookup=b.length,m.nc.rollup=w.length,m.nc.invalidColumn=h;const v=JSON.parse(JSON.stringify(m));Me.push(v)}const _=Me.reduce(((e,t)=>e+t.nc.columns),0),f=Me.reduce(((e,t)=>e+t.nc.links),0),h=Me.reduce(((e,t)=>e+t.nc.lookup),0),g=Me.reduce(((e,t)=>e+t.nc.rollup),0);d("Quick Summary:"),d(`:: Total Tables:   ${e.length}`),d(`:: Total Columns:  ${_}`),d(`::   Links:        ${f}`),d(`::   Lookup:       ${h}`),d(`::   Rollup:       ${g}`),d(`:: Total Filters:  ${G.filter}`),d(`:: Total Sort:     ${G.sort}`),d(`:: Total Views:    ${G.view.total}`),d(`::   Grid:         ${G.view.grid}`),d(`::   Gallery:      ${G.view.gallery}`),d(`::   Form:         ${G.view.form}`),d(`:: Total Records:  ${G.data.records}`),d(`:: Total Nested Links: ${G.data.nestedLinks}`);const b=Date.now()-y;d(`:: Migration time:      ${b}`),d(`:: Axios fetch count:   ${G.fetchAt.count}`),d(`:: Axios fetch time:    ${G.fetchAt.time}`),this.telemetryService.sendEvent({evt_type:"a:airtable-import:success",user_id:i.user.id,email:i.user.email,data:{stats:{migrationTime:b,totalTables:e.length,totalColumns:_,links:f,lookup:h,rollup:g,totalFilters:G.filter,totalSort:G.sort,view:{total:G.view.total,grid:G.view.grid,gallery:G.view.gallery,form:G.view.form},axios:{count:G.fetchAt.count,time:G.fetchAt.time},totalRecords:G.data.records,nestedLinks:G.data.nestedLinks}}})},Ie={"=":"eq","!=":"neq","<":"lt","<=":"lte",">":"gt",">=":"gte",isEmpty:"blank",isNotEmpty:"notblank",contains:"like",doesNotContain:"nlike",isAnyOf:"anyof",isNoneOf:"nanyof","|":"anyof","&":"allof"},Ce=async(e,t)=>{var r,l,d,p;for(let m=0;m<t.filterSet.length;m++){const h=t.filterSet[m],g=await ee(h.columnId);if(!g){W(await c.getNcNameFromAtId(e),g.title,g.uidt,"filter config skipped; column not migrated");continue}const y=g.id,b=g.uidt,w=[];if(b!==O.UITypes.Links){if(b===O.UITypes.SingleSelect||b===O.UITypes.MultiSelect){if("doesNotContain"===h.operator&&(h.operator="isNoneOf"),Array.isArray(h.value)){for(let e=0;e<h.value.length;e++)h.value[e]=await c.getNcNameFromAtId(h.value[e]);const e={fk_column_id:y,logical_op:t.conjunction,comparison_op:Ie[h.operator],value:h.value.join(",")};w.push(e)}else if(h.value){const e={fk_column_id:y,logical_op:t.conjunction,comparison_op:Ie[h.operator],value:await c.getNcNameFromAtId(h.value)};w.push(e)}}else if(b===O.UITypes.Date||b===O.UITypes.DateTime)if("isWithin"===h.operator){const e={fk_column_id:y,logical_op:t.conjunction,comparison_op:h.operator,comparison_sub_op:null===(r=h.value)||void 0===r?void 0:r.mode,value:null===(l=h.value)||void 0===l?void 0:l.numberOfDays};w.push(e)}else{const e={fk_column_id:y,logical_op:t.conjunction,comparison_op:Ie[h.operator],comparison_sub_op:null===(d=h.value)||void 0===d?void 0:d.mode,value:null===(p=h.value)||void 0===p?void 0:p.exactDate};w.push(e)}else if(h.value){const e={fk_column_id:y,logical_op:t.conjunction,comparison_op:Ie[h.operator],value:h.value};w.push(e)}for(let t=0;t<w.length;t++){const r=_();try{await this.filtersService.filterCreate(a,{viewId:e,filter:w[t],user:i.user,req:s})}catch(t){u(`Skipped creating filter for ${e} :: ${t.message}`)}f(r,"dbTableFilter.create"),G.filter++}}else W(await c.getNcNameFromAtId(e),g.title,g.uidt,"filter config skipped; filter over date datatype not supported yet")}},Ee=async(e,t)=>{var i;const r=[];for(let a=0;a<t.length;a++){const i=t[a],s=await ee(i.columnId);if(!s){W(await c.getNcNameFromAtId(e),s.title,s.uidt,"group config skipped; column not migrated");continue}const l=s.id,d=s.uidt;d===O.UITypes.Date||d===O.UITypes.DateTime||d===O.UITypes.Links||d===O.UITypes.MultiSelect||d===O.UITypes.SingleSelect||d===O.UITypes.SingleLineText||d===O.UITypes.Formula||d===O.UITypes.Checkbox||d===O.UITypes.Collaborator||d===O.UITypes.Number?r.push({group_column_id:l,direction:i.order}):W(await c.getNcNameFromAtId(e),s.title,s.uidt,`group config skipped; group over ${d}  not supported yet`)}const l=await this.viewColumnsService.columnList(a,{viewId:e});for(let e=0;e<r.length;e++){const t=null===(i=l.find((t=>t.fk_column_id===r[e].group_column_id)))||void 0===i?void 0:i.id;try{await this.gridColumnService.gridColumnUpdate(a,{gridViewColumnId:t,grid:{group_by:!0,group_by_order:e+1,group_by_sort:"ascending"===r[e].direction?"asc":"desc"},req:s})}catch(e){}}},xe=async(e,t)=>{var i;for(let r=0;r<t.sortSet.length;r++){const l=null===(i=await ee(t.sortSet[r].columnId))||void 0===i?void 0:i.id;if(l){const i=_();await this.sortsService.sortCreate(a,{viewId:e,sort:{fk_column_id:l,direction:t.sortSet[r].ascending?"asc":"desc"},req:s}),f(i,"dbTableSort.create")}G.sort++}},Le=async(e,t,i,r,l)=>{var d,u,p,m;const h=[N,A],g=t.columnOrder,y=await te(i),b=y.views.find((e=>e.title===r)).id;let w;const v=_();"form"===l?(w=(await this.formsService.formViewGet(a,{formViewId:b})).columns,f(v,"dbView.formRead")):"gallery"===l?(w=(await this.galleriesService.galleryViewGet(a,{galleryViewId:b})).columns,f(v,"dbView.galleryRead")):(w=await this.viewColumnsService.columnList(a,{viewId:b}),f(v,"dbView.gridColumnsList"));for(let e=0;e<h.length;e++){const t=y.columns.find((t=>t.title===h[e])).id,i=null===(d=w.find((e=>e.fk_column_id===t)))||void 0===d?void 0:d.id;if(void 0===i)continue;const r=_();await this.viewColumnsService.columnUpdate(a,{viewId:b,columnId:i,column:{show:!1,order:e+1+g.length},req:s}),f(r,"dbViewColumn.update")}for(let e=0;e<g.length;e++){const i=await c.getNcIdFromAtId(g[e].columnId),r=await _e(b,l,i);if(void 0===r)continue;const d={show:g[e].visibility,order:e+1};if("form"===l&&(null===(m=null===(p=null===(u=null==t?void 0:t.metadata)||void 0===u?void 0:u.form)||void 0===p?void 0:p.fieldsByColumnId)||void 0===m?void 0:m[g[e].columnId])){const i=t.metadata.form.fieldsByColumnId[g[e].columnId],l=Object.assign({},d);(null==i?void 0:i.title)&&(l.label=i.title),(null==i?void 0:i.required)&&(l.required=i.required),(null==i?void 0:i.description)&&(l.description=i.description);const c=_();await this.formColumnsService.columnUpdate(a,{formViewColumnId:r,formViewColumn:l,req:s}),f(c,"dbView.formColumnUpdate")}const h=_();await this.viewColumnsService.columnUpdate(a,{viewId:b,columnId:r,column:d,req:s}),f(h,"dbViewColumn.update")}};try{if(d("SDK initialized"),w){const e=await this.tablesService.getAccessibleTables(a,{baseId:i.baseId,sourceId:i.sourceId,roles:Object.assign(Object.assign({},l),{owner:!0})});for(const t of e)await this.tablesService.tableDelete(a,{tableId:t.id,user:i.user,forceDeleteRelations:!0})}p("Base initialization started"),p("Base initialized"),d("Retrieving Airtable schema");const e=await(async e=>{const t=Date.now();if(!e.shareId)throw{message:"Invalid Shared Base ID :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"};if(e.shareId.startsWith("exp")){const t=await j.default.readTemplate(e.shareId);await j.default.initialize(t.template.exploreApplication.shareId)}else await j.default.initialize(e.shareId,e.appId);const a=await j.default.read(),i=Date.now()-t;if(G.fetchAt.count++,G.fetchAt.time+=i,!a.baseId)throw{message:"Invalid Shared Base ID :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"};const s=a.schema;return g=a.baseId,h=new I.default({apiKey:e.apiKey}).base(g),v=s.tableSchemas,s})(i),r=e.tableSchemas;if(p("Base schema extraction completed"),i.baseId)await ye(i.baseId),i.baseName=null==T?void 0:T.title,i.sourceId=i.sourceId||T.sources[0].id,p("Getting existing base meta");else{if(!i.baseName)throw new Error("Base name or id not provided");await ge(i.baseName),p("Base created")}if(d("Importing Tables..."),await re(r),p("Table creation completed"),p("Configuring Links"),await ce(r),p("Migrating LTAR columns completed"),i.options.syncLookup&&(p("Configuring Lookup"),await de(r),p("Migrating Lookup columns completed")),i.options.syncRollup&&(p("Configuring Rollup"),await ue(r),p("Migrating Rollup columns completed"),i.options.syncLookup&&(p("Migrating Lookup form Rollup columns"),await pe(),p("Migrating Lookup form Rollup columns completed"))),p("Configuring Display Value column"),await me(r),p("Configuring Display Value column completed"),i.options.syncUsers&&(d("Configuring User(s)"),await Te(e),p("Adding users completed")),d("Syncing views"),await ve(i,r),await we(i,r),await be(i,r),p("Syncing views completed"),i.options.syncData)try{const e=_(),c={list:[]};c.list=await this.tablesService.getAccessibleTables(a,{baseId:T.id,sourceId:i.sourceId,roles:Object.assign(Object.assign({},l),{owner:!0})});const m=await U.Source.get(a,i.sourceId);f(e,"base.tableList"),d("Reading Records...");const g=new Map,y={};for(let e=0;e<c.list.length;e++){if(void 0===r.find((t=>t.name===c.list[e].title)))continue;const l=_(),b=await this.tablesService.getTableWithAccessibleViews(a,{tableId:c.list[e].id,user:Object.assign(Object.assign({},i.user),{base_roles:{owner:!0}})});f(l,"dbTable.read");const w=await(0,P.importData)(a,{baseName:i.baseId,table:b,atBase:h,nocoBaseDataProcessing_v2:fe,syncDB:i,source:m,services:{tableService:this.tablesService,bulkDataService:this.bulkDataAliasService},fields:null,insertedAssocRef:D,atNcAliasRef:Y,ncLinkMappingTable:k,idMap:g,idCounter:y,logBasic:d,logDetailed:p,logWarning:u,req:s});if("pg"===m.type){const t=await U.Model.getBaseModelSQL(a,{id:c.list[e].id,viewId:null,dbDriver:await ie.default.get(m)});await t.dbDriver.raw("SELECT setval(pg_get_serial_sequence('??', ?), ?);",[t.getTnPath(c.list[e].table_name),"id",t.dbDriver.raw("(SELECT MAX(id) FROM ??)",[t.getTnPath(c.list[e].table_name)])])}else if("mssql"===m.type){const i=await U.Model.getBaseModelSQL(a,{id:c.list[e].id,viewId:null,dbDriver:await ie.default.get(m)}),s=await i.execAndGetRows(i.dbDriver.raw("SELECT MAX(id) as mx FROM ??",[i.getTnPath(c.list[e].table_name)]).toQuery());await i.dbDriver.raw("DBCC CHECKIDENT ('??', RESEED, ?)",[i.getTnPath(c.list[e].table_name),(null===(t=null==s?void 0:s[0])||void 0===t?void 0:t.mx)||1])}G.data.records+=w.importedCount,G.data.nestedLinks+=w.nestedLinkCount,p(`Data inserted from ${b.title}`)}}catch(e){d("There was an error while migrating data! Please make sure your API key is correct."),d(`Data migration failed: ${e}`)}await Oe(r)}catch(e){for(const e of X.tables)await this.tablesService.tableDelete(a,{tableId:e.id,user:i.user,forceDeleteRelations:!0});throw e.message&&(this.telemetryService.sendEvent({evt_type:"a:airtable-import:error",user_id:i.user.id,email:i.user.email,data:{error:e.message}}),ne.log(e)),e}this.debugLog(`job completed for ${e.id}`)}};t.AtImportProcessor=oe,t.AtImportProcessor=oe=T([(0,A.Injectable)(),k("design:paramtypes",["function"==typeof(i=void 0!==Q.TablesService&&Q.TablesService)?i:Object,"function"==typeof(s=void 0!==Z.ViewsService&&Z.ViewsService)?s:Object,"function"==typeof(r=void 0!==J.BasesService&&J.BasesService)?r:Object,"function"==typeof(l=void 0!==Y.AttachmentsService&&Y.AttachmentsService)?l:Object,"function"==typeof(c=void 0!==B.ColumnsService&&B.ColumnsService)?c:Object,"function"==typeof(d=void 0!==V.FiltersService&&V.FiltersService)?d:Object,"function"==typeof(u=void 0!==H.FormColumnsService&&H.FormColumnsService)?u:Object,"function"==typeof(p=void 0!==ee.FormsService&&ee.FormsService)?p:Object,"function"==typeof(m=void 0!==G.GalleriesService&&G.GalleriesService)?m:Object,"function"==typeof(_=void 0!==W.GridsService&&W.GridsService)?_:Object,"function"==typeof(f=void 0!==z.BaseUsersService&&z.BaseUsersService)?f:Object,"function"==typeof(h=void 0!==X.ViewColumnsService&&X.ViewColumnsService)?h:Object,"function"==typeof(g=void 0!==K.SortsService&&K.SortsService)?g:Object,"function"==typeof(y=void 0!==F.BulkDataAliasService&&F.BulkDataAliasService)?y:Object,"function"==typeof(b=void 0!==D.JobsLogService&&D.JobsLogService)?b:Object,"function"==typeof(w=void 0!==te.GridColumnsService&&te.GridColumnsService)?w:Object,"function"==typeof(v=void 0!==ae.TelemetryService&&ae.TelemetryService)?v:Object])],oe);const re={},le=(e="name",t="default")=>{const a=`${t}_${e}}`;return re[a]||(re[a]={}),(t=e)=>{let i="_"===t?e:t,s=0;for(;i.toLowerCase()in re[a];)i=`${t}_${++s}`;return re[a][i.toLowerCase()]=!0,i}}},95315:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(48378),r=i(a(69176)),l=new(a(23324).Logger)("EntityMap");class DBStream extends s.Readable{constructor(e,t){super({objectMode:!0}),this.db=e,this.sql=t,this.stmt=this.db.prepare(this.sql),this.on("end",(()=>this.stmt.finalize()))}_read(){const e=this;this.stmt.get((function(t,a){t?e.emit("error",t):(a&&(a=c(a)),e.push(a||null))}))}}function c(e){for(const t of Object.keys(e)){if(e[t]&&e[t].startsWith("JSON::"))try{e[t]=JSON.parse(e[t].replace("JSON::",""))}catch(e){l.log(e)}u(t)!==t&&(e[u(t)]=e[t],delete e[t])}return e}function d(e){return e.replace(/'/g,"''").replace(/[A-Z]/g,(e=>`_${e}`))}function u(e){return e.replace(/''/g,"'").replace(/_[A-Z]/g,(e=>e[1]))}t.default=class EntityMap{constructor(...e){this.initialized=!1,this.cols=e.map((e=>d(e))),this.db=new Promise(((e,t)=>{const a=new r.default.Database(":memory:"),i=this.cols.length>0?this.cols.join(" TEXT, ")+" TEXT":"mappingPlaceholder TEXT";a.run(`CREATE TABLE mapping (${i})`,(i=>{i&&(l.log(i),t(i)),e(a)}))}))}async init(){this.initialized||(this.db=await this.db,this.initialized=!0)}destroy(){this.initialized&&this.db&&this.db.close()}async addRow(e){if(!this.initialized)throw"Please initialize first!";const t=Object.keys(e).map((e=>d(e))),a=t.map((e=>`'${e}'`)).join(", "),i=t.map((()=>"?")).join(", "),s=[];for(const e of t.filter((e=>!this.cols.includes(e))))s.push(new Promise(((t,a)=>{this.db.run(`ALTER TABLE mapping ADD '${e}' TEXT;`,(i=>{i&&(l.log(i),a(i)),this.cols.push(e),t(!0)}))})));await Promise.all(s);const r=Object.values(e).map((e=>"object"==typeof e?`JSON::${JSON.stringify(e)}`:e));return new Promise(((e,t)=>{this.db.run(`INSERT INTO mapping (${a}) VALUES (${i})`,r,(a=>{a&&(l.log(a),t(a)),e(!0)}))}))}getRow(e,t,a=[]){if(!this.initialized)throw"Please initialize first!";return new Promise(((i,s)=>{e=d(e),a=a.map((e=>d(e))),this.db.get(`SELECT ${a.length?a.join(", "):"*"} FROM mapping WHERE ${e} = ?`,[t],((e,t)=>{e&&(l.log(e),s(e)),t&&(t=c(t)),i(t)}))}))}getCount(){if(!this.initialized)throw"Please initialize first!";return new Promise(((e,t)=>{this.db.get("SELECT COUNT(*) as count FROM mapping",((a,i)=>{a&&(l.log(a),t(a)),e(i.count)}))}))}getStream(e=[]){if(!this.initialized)throw"Please initialize first!";return e=e.map((e=>d(e))),new DBStream(this.db,`SELECT ${e.length?e.join(", "):"*"} FROM mapping`)}getLimit(e,t,a=[]){if(!this.initialized)throw"Please initialize first!";return new Promise(((i,s)=>{a=a.map((e=>d(e))),this.db.all(`SELECT ${a.length?a.join(", "):"*"} FROM mapping LIMIT ${e} OFFSET ${t}`,((e,t)=>{e&&(l.log(e),s(e));for(let e of t)e=c(e);i(t)}))}))}}},91216:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(23324),r=i(a(71178)),l=a(91196),c=a(44680),d=a(74712),u=new s.Logger("FetchAT"),p={initialized:!1};async function m(e,t){p.cookie="",t&&""!==t||(t=null);const a=`https://airtable.com/${t?`${t}/`:""}${e}`;try{const e=await r.default.get(a,{headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"none","sec-fetch-user":"?1","upgrade-insecure-requests":"1","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36"},referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET"});for(const t of e.headers["set-cookie"])p.cookie+=t.split(";")[0]+"; ";const t=e.data,i=t.match(/(?<=var headers =)(.*)(?=;)/g),s=t.match(/(?<=fetch\(")(\\.*)(?=")/g);if(!i||!s)throw{message:"Please ensure www.airtable.com/<SharedBaseID> is available for public access. Refer https://bit.ly/3x0OdXI for details"};p.headers=JSON.parse(t.match(/(?<=var headers =)(.*)(?=;)/g)[0].trim()),p.link=t.match(/(?<=fetch\(")(\\.*)(?=")/g)[0].trim().replace(/\\u[\dA-F]{4}/gi,(function(e){return String.fromCharCode(parseInt(e.replace(/\\u/g,""),16))})),p.link=p.link.replace("%22mayExcludeCellDataForLargeViews%22%3Afalse","%22mayExcludeCellDataForLargeViews%22%3Atrue"),p.baseInfo=decodeURIComponent(p.link).match(/{(.*)}/g)[0].split("&").reduce(((e,t)=>{try{return Object.assign(e,JSON.parse(t.includes("=")?t.split("=")[1]:t))}catch(a){if(t.includes("="))return Object.assign(e,{[t.split("=")[0]]:t.split("=")[1]})}}),{}),p.baseId=p.baseInfo.applicationId,p.initialized=!0}catch(e){throw u.log(e),p.initialized=!1,e.message?e:{message:"Error processing Shared Base :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}}t.default={initialize:m,read:async function(){if(!p.initialized)throw{message:"Error Initializing :: please try again !!"};try{const e=await(0,r.default)("https://airtable.com"+p.link,{headers:Object.assign({accept:"*/*","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36","x-time-zone":"Europe/Berlin",cookie:p.cookie},p.headers),referrerPolicy:"no-referrer",body:null,method:"GET",responseType:"stream"}),t=await new Promise(((t,a)=>{const i=e.data.pipe((0,c.parser)()).pipe((0,d.ignore)({filter:"data.tableDatas"})).pipe((0,l.streamObject)()),s={};i.on("data",(e=>{e.key&&(s[e.key]=e.value)})),i.on("error",(e=>{a(e)})),i.on("end",(()=>{t(s)}))}));if(null==t?void 0:t.data)return{schema:null==t?void 0:t.data,baseId:p.baseId,baseInfo:p.baseInfo};throw new Error("Error Reading :: Data missing")}catch(e){throw u.log(e),{message:"Error Reading :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}},readView:async function(e){if(!p.initialized)throw{message:"Error Initializing :: please try again !!"};try{const t=await(0,r.default)(`https://airtable.com/v0.3/view/${e}/readData?stringifiedObjectParams=${encodeURIComponent(JSON.stringify({mayOnlyIncludeRowAndCellDataForIncludedViews:!0,mayExcludeCellDataForLargeViews:!0}))}&requestId=${p.baseInfo.requestId}&accessPolicy=${encodeURIComponent(JSON.stringify({allowedActions:p.baseInfo.allowedActions,shareId:p.baseInfo.shareId,applicationId:p.baseInfo.applicationId,generationNumber:p.baseInfo.generationNumber,expires:p.baseInfo.expires,signature:p.baseInfo.signature}))}`,{headers:Object.assign({accept:"*/*","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36","x-time-zone":"Europe/Berlin",cookie:p.cookie},p.headers),referrerPolicy:"no-referrer",body:null,method:"GET",responseType:"stream"}),a=await new Promise(((e,a)=>{const i=t.data.pipe((0,c.parser)()).pipe((0,d.ignore)({filter:"data.rowOrder"})).pipe((0,l.streamObject)()),s={};i.on("data",(e=>{e.key&&(s[e.key]=e.value)})),i.on("error",(e=>{a(e)})),i.on("end",(()=>{e(s)}))}));if(null==a?void 0:a.data)return{view:a.data};throw new Error("Error Reading :: Data missing")}catch(e){throw u.log(e),{message:"Error Reading View :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}},readTemplate:async function(e){p.initialized||await m("shrO8aYf3ybwSdDKn");try{const t=await(0,r.default)(`https://www.airtable.com/v0.3/exploreApplications/${e}`,{headers:Object.assign({accept:"*/*","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36","x-time-zone":"Europe/Berlin",cookie:p.cookie},p.headers),referrer:"https://www.airtable.com/",referrerPolicy:"same-origin",body:null,method:"GET",mode:"cors",credentials:"include"});if(null==t?void 0:t.data)return{template:t.data};throw new Error("Error Reading :: Data missing")}catch(e){throw u.log(e),{message:"Error Fetching :: Ensure www.airtable.com/templates/featured/<TemplateID> is accessible."}}}}},13204:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.importData=async function(e,{baseName:t,table:a,atBase:s,nocoBaseDataProcessing_v2:l,syncDB:d,source:f,logBasic:w=(e=>{}),logDetailed:v=(e=>{}),logWarning:T=(e=>{}),services:k,insertedAssocRef:S={},atNcAliasRef:M,ncLinkMappingTable:O,idMap:I,idCounter:C,req:E}){try{const x={streamingCounter:0},L=new r.Readable({read(){}});return L.pause(),async function({table:e,fields:t,atBase:a,dataStream:i,counter:s,logBasic:r=(e=>{}),logWarning:l=(e=>{})}){return new Promise((c=>{const d={pageSize:100};t&&(d.fields=t);let u=0;a(e.title).select(d).eachPage((async function(t,a){let l=0;for(const e of t)i.push(JSON.stringify(Object.assign({_atId:e.id},e.fields))),s.streamingCounter++,u++,l++;r(`:: Reading '${e.title}' data :: ${Math.max(1,u-l)} - ${u}`),s&&s.streamingCounter>=g&&await new Promise((e=>{const t=setInterval((()=>{s.streamingCounter<g/2&&(clearInterval(t),e(!0))}),100)})),a()}),(async function(t){t&&(p.error(t),l(`There were errors on reading '${e.title}' data :: ${t}`)),i.push(null),c(!0)}))}))}({table:a,atBase:s,dataStream:L,counter:x,logBasic:w,logDetailed:v,logWarning:T}).catch((e=>{p.error(e),T(`There were errors on reading '${a.title}' data :: ${e}`)})),new Promise((async s=>{const r=new u.default({concurrency:h}),g=b(e,{table:a,baseName:t,insertedAssocRef:S,dataStream:L,atNcAliasRef:M,ncLinkMappingTable:O,syncDB:d,source:f,services:k,queue:r,idMap:I,idCounter:C,logBasic:w,logDetailed:v,logWarning:T}).catch((e=>{p.error(e),T(`There were errors on importing '${a.title}' LTAR data :: ${e}`)}));let R=[],N=0,A=0,D=0;L.on("data",(async s=>{x.streamingCounter--,s=JSON.parse(s),r.add((()=>new Promise((async u=>{try{void 0===C[a.id]&&(C[a.id]=1);const{_atId:p}=s,h=i(s,["_atId"]);I.has(p)||I.set(p,C[a.id]++);const g=await l(d,a,{id:p,fields:h});if(R.push(Object.assign(Object.assign({},g),{id:I.get(p)})),D++,D>=m){if((0,c.default)(R)>=_){let i=R.splice(0,R.length);await k.bulkDataService.bulkDataInsert(e,{baseName:t,tableName:a.id,body:i,cookie:E,skip_hooks:!0,foreign_key_checks:!!f.isMeta(),allowSystemColumn:!0}),w(`:: Importing '${a.title}' data :: ${N} - ${N+i.length}`),N+=i.length,i=[]}D=0}r.size<y/2&&L.resume(),u(!0)}catch(e){p.error(e),T(`There were errors on importing '${a.title}' data :: ${e}`),r.size<y/2&&L.resume(),u(!0)}})))),r.size>=y&&L.pause()})),L.on("end",(async()=>{try{await r.onIdle(),R.length>0&&(await k.bulkDataService.bulkDataInsert(e,{baseName:t,tableName:a.id,body:R,cookie:E,skip_hooks:!0,foreign_key_checks:!!f.isMeta(),allowSystemColumn:!0}),w(`:: Importing '${a.title}' data :: ${N} - ${N+R.length}`),N+=R.length,R=[]),A=await g,s({importedCount:N,nestedLinkCount:A})}catch(e){p.error(e),T(`There were errors on importing '${a.title}' data :: ${e}`),s({importedCount:N,nestedLinkCount:A})}}))}))}catch(e){throw e}},t.importLTARData=b;const r=a(48378),l=a(71040),c=s(a(19776)),d=a(23324),u=s(a(27216)),p=new d.Logger("at-import:readAndProcessData"),m=+process.env.AT_IMPORT_BULK_DATA_BATCH_COUNT||10,_=+process.env.AT_IMPORT_BULK_DATA_BATCH_SIZE||20480,f=+process.env.AT_IMPORT_BULK_LINK_BATCH_COUNT||500,h=+process.env.AT_IMPORT_BULK_PARALLEL_PROCESS||2,g=+process.env.AT_IMPORT_STREAM_BUFFER_LIMIT||100,y=+process.env.AT_IMPORT_QUEUE_BUFFER_LIMIT||20;async function b(e,{table:t,baseName:a,insertedAssocRef:s={},dataStream:r,atNcAliasRef:c,ncLinkMappingTable:d,syncDB:u,source:m,services:_,queue:h,idMap:g,idCounter:b,logBasic:w=(e=>{}),logWarning:v=(e=>{})}){const T=[],k=await _.tableService.getTableWithAccessibleViews(e,{tableId:t.id,user:u.user});for(const t of k.columns){if(!(0,l.isLinksOrLTAR)(t.uidt)||t.colOptions.type!==l.RelationTypes.MANY_TO_MANY)continue;if(t.colOptions.fk_mm_model_id in s)continue;if(d.every((e=>e.nc.title!==t.title)))continue;s[t.colOptions.fk_mm_model_id]=!0;const a=await _.tableService.getTableWithAccessibleViews(e,{tableId:t.colOptions.fk_mm_model_id,user:u.user});T.push({modelMeta:a,colMeta:t,curCol:a.columns.find((e=>e.id===t.colOptions.fk_mm_child_column_id)),refCol:a.columns.find((e=>e.id===t.colOptions.fk_mm_parent_column_id))})}let S=0,M=0;const O={};return new Promise(((s,l)=>{r.on("data",(async s=>{s=JSON.parse(s);for(const l of T)O[l.modelMeta.id]||(O[l.modelMeta.id]=[]),h.add((()=>new Promise((async d=>{var u;try{void 0===b[l.colMeta.colOptions.fk_related_model_id]&&(b[l.colMeta.colOptions.fk_related_model_id]=1),void 0===b[t.id]&&(b[t.id]=1);const{_atId:p}=s,v=i(s,["_atId"]);g.has(p)||(v.id=g.set(p,b[t.id]++));const T=(null==v?void 0:v[c[t.id][l.colMeta.title]])||[];for(const i of T)if(g.has(i)||g.set(i,b[l.colMeta.colOptions.fk_related_model_id]++),O[l.modelMeta.id].push({[l.curCol.title]:g.get(p),[l.refCol.title]:g.get(i)}),(null===(u=O[l.modelMeta.id])||void 0===u?void 0:u.length)>=f){let i=O[l.modelMeta.id].splice(0,O[l.modelMeta.id].length);const s=M;M+=i.length,w(`:: Importing '${t.title}' LTAR data :: ${s} - ${s+i.length}`),await _.bulkDataService.bulkDataInsert(e,{baseName:a,tableName:l.modelMeta.id,body:i,cookie:{},skip_hooks:!0,foreign_key_checks:!!m.isMeta(),allowSystemColumn:!0}),i=[]}h.size<y/2&&r.resume(),d(!0)}catch(e){p.error(e),v(`There were errors on importing '${t.title}' LTAR data :: ${e}`),h.size<y/2&&r.resume(),d(!0)}}))));h.size>=y&&r.pause()})),r.on("end",(async()=>{var i;try{await h.onIdle();for(const s of T)(null===(i=O[s.modelMeta.id])||void 0===i?void 0:i.length)>=0&&(w(`:: Importing '${t.title}' LTAR data :: ${M} - ${M+O[s.modelMeta.id].length}`),await _.bulkDataService.bulkDataInsert(e,{baseName:a,tableName:s.modelMeta.id,body:O[s.modelMeta.id],cookie:{},skip_hooks:!0,foreign_key_checks:!!m.isMeta(),allowSystemColumn:!0}),M+=O[s.modelMeta.id].length,O[s.modelMeta.id]=[]);S+=M,s(S)}catch(e){l(e)}})),r.resume()}))}},93156:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentCleanUpProcessor=void 0;const s=i(a(67072)),r=i(a(89576)),l=i(a(76584)),c=a(64612),d=i(a(23080)),u=a(19176),p=process.env.NC_ATTACHMENT_RETENTION_DAYS||10;t.AttachmentCleanUpProcessor=class AttachmentCleanUpProcessor{constructor(){this.debugLog=(0,r.default)("nc:jobs:attachment-clean-up")}async job(e){if(0==+p)return;this.debugLog(`job started for ${e.id}`);const t=l.default.ncMeta,a=await d.default.storageAdapter(),i=a.name,r=t.knexConnection(c.MetaTable.FILE_REFERENCES).select("file_url").max("updated_at",{as:"last_updated_at"}).groupBy("file_url").havingRaw("COUNT(*) = COUNT(CASE WHEN deleted THEN 1 END)"),m=await r.select("file_url");for(const e of m){if(new Date(e.last_updated_at).getTime()>(new Date).getTime()-24*+p*60*60*1e3)continue;let r;const l=await t.knexConnection(c.MetaTable.FILE_REFERENCES).where("file_url",e.file_url).select("storage","file_url").whereNotNull("storage").first();if(!l||(e.storage=l.storage,e.storage===i)){r="Local"===i?e.file_url.replace(/^download\//,""):(0,u.getPathFromUrl)(e.file_url,!0);try{await a.fileDelete(s.default.join("nc","uploads",r));const i=["tiny.jpg","small.jpg","card_cover.jpg"];for(const e of i)await a.fileDelete(s.default.join("nc","thumbnails",r,e));await t.knexConnection(c.MetaTable.FILE_REFERENCES).where("file_url",e.file_url).del()}catch(t){this.debugLog(`error deleting file ${e.file_url}: ${t.message}`)}}}this.debugLog(`job completed for ${e.id}`)}}},1052:function(e,t,a){"use strict";var i,s,r,l,c=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataExportController=void 0;const p=a(23324),m=a(23668),_=a(47932),f=a(40668),h=a(19684),g=a(81472),y=a(67240),b=a(892),w=a(26212),v=a(48967),T=a(43820);let k=class DataExportController{constructor(e,t){this.jobsService=e,this.basesService=t}async exportModelData(e,t,a,i,s){const r=await h.View.get(e,a);r||T.NcError.viewNotFound(a);return await this.jobsService.add(g.JobTypes.DataExport,{context:e,options:s,modelId:r.fk_model_id,viewId:a,user:t.user,exportAs:i,ncSiteUrl:t.ncSiteUrl})}};t.DataExportController=k,c([(0,p.Post)(["/api/v2/export/:viewId/:exportAs"]),(0,p.HttpCode)(200),(0,_.Acl)("dataList"),u(0,(0,w.TenantContext)()),u(1,(0,p.Req)()),u(2,(0,p.Param)("viewId")),u(3,(0,p.Param)("exportAs")),u(4,(0,p.Body)()),d("design:type",Function),d("design:paramtypes",["function"==typeof(r=void 0!==v.NcContext&&v.NcContext)?r:Object,"function"==typeof(l=void 0!==v.NcRequest&&v.NcRequest)?l:Object,String,String,Object]),d("design:returntype",Promise)],k.prototype,"exportModelData",null),t.DataExportController=k=c([(0,p.Controller)(),(0,p.UseGuards)(y.MetaApiLimiterGuard,m.GlobalGuard),u(0,(0,p.Inject)("JobsService")),d("design:paramtypes",["function"==typeof(i=void 0!==b.IJobsService&&b.IJobsService)?i:Object,"function"==typeof(s=void 0!==f.BasesService&&f.BasesService)?s:Object])],k)},53888:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataExportProcessor=void 0;const d=a(48378),u=c(a(67072)),p=a(23324),m=c(a(43936)),_=a(16428),f=a(83676),h=a(19684),g=a(43820),y=c(a(23080));function b(e){return(null==e?void 0:e.is_default)?"Default View":null==e?void 0:e.title}let w=i=class DataExportProcessor{constructor(e){this.exportService=e,this.logger=new p.Logger(i.name)}async job(e){const{context:t,options:a,modelId:i,viewId:s,user:r,exportAs:l,ncSiteUrl:c}=e.data;"csv"!==l&&g.NcError.notImplemented(`Export as ${l}`);const p=(0,_.initTime)(),f=await h.Model.get(t,i);f||g.NcError.tableNotFound(i);const w=await h.View.get(t,s);w||g.NcError.viewNotFound(s);const v=(0,m.default)().format("YYYY-MM-DD/HH"),T=await y.default.storageAdapter(),k=`nc/uploads/data-export/${v}/${i}/${f.title} (${b(w)}) - ${Date.now()}.csv`;let S=null;try{const e=new d.Readable({read(){}});e.setEncoding("utf8");let r=null;const m=T.fileCreateByStream(k,e).catch((e=>{this.logger.error(e),r=e}));if(this.exportService.streamModelDataAsCsv(t,{dataStream:e,linkStream:null,baseId:f.base_id,modelId:f.id,viewId:w.id,ncSiteUrl:c,delimiter:null==a?void 0:a.delimiter}).catch((t=>{this.logger.debug(t),e.push(null),r=t})),S=await m,S=S?await h.PresignedUrl.getSignedUrl({pathOrUrl:S,filename:`${f.title} (${b(w)}).csv`,expireSeconds:10800,preview:!1,mimetype:"text/csv"}):await h.PresignedUrl.getSignedUrl({pathOrUrl:u.default.join(k.replace("nc/uploads/","")),filename:`${f.title} (${b(w)}).csv`,expireSeconds:10800,preview:!1,mimetype:"text/csv"}),r)throw r;(0,_.elapsedTime)(p,`exported data for model ${i} view ${s} as ${l}`,"exportData")}catch(e){throw{data:{extension_id:null==a?void 0:a.extension_id,title:`${f.title} (${b(w)})`},message:e.message}}return{timestamp:new Date,extension_id:null==a?void 0:a.extension_id,type:l,title:`${f.title} (${b(w)})`,url:S}}};t.DataExportProcessor=w,t.DataExportProcessor=w=i=r([(0,p.Injectable)(),l("design:paramtypes",["function"==typeof(s=void 0!==f.ExportService&&f.ExportService)?s:Object])],w)},73564:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateController=void 0;const y=a(23324),b=a(71040),w=a(23668),v=a(47932),T=a(40668),k=a(19684),S=a(82048),M=a(81472),O=a(67240),I=a(892),C=a(26212),E=a(48967),x=a(64612),L=a(43820);let R=class DuplicateController{constructor(e,t){this.jobsService=e,this.basesService=t}async duplicateSharedBase(e,t,a,i,s){const r=await k.Base.getByUuid({workspace_id:x.RootScopes.BASE,base_id:x.RootScopes.BASE},i);if(!r)throw new Error(`Base not found for id '${i}'`);const l=(await r.getSources())[0];if(!l)throw new Error("Source not found!");const c=await k.Base.list(e.workspace_id),d=(0,S.generateUniqueName)(`${r.title} copy`,c.map((e=>e.title))),u=await this.basesService.baseCreate({base:Object.assign({title:d,status:b.ProjectStatus.JOB},s.base||{}),user:{id:t.user.id},req:t});return{id:(await this.jobsService.add(M.JobTypes.DuplicateBase,{context:{workspace_id:r.fk_workspace_id,base_id:r.id},user:t.user,baseId:r.id,sourceId:l.id,dupProjectId:u.id,options:Object.assign(Object.assign({},s.options),{excludeHooks:!0})||{},req:{user:t.user,clientIp:t.clientIp,headers:t.headers}})).id,base_id:u.id}}async duplicateBase(e,t,a,i,s){const r=await k.Base.get(e,a);if(!r)throw new Error(`Base not found for id '${a}'`);const l=i?await k.Source.get(e,i):(await r.getSources())[0];if(!l)throw new Error("Source not found!");const c=await k.Base.list(e.workspace_id),d=(0,S.generateUniqueName)(`${r.title} copy`,c.map((e=>e.title))),u=await this.basesService.baseCreate({base:Object.assign({title:d,status:b.ProjectStatus.JOB},s.base||{}),user:{id:t.user.id},req:t});return{id:(await this.jobsService.add(M.JobTypes.DuplicateBase,{context:e,user:t.user,baseId:r.id,sourceId:l.id,dupProjectId:u.id,options:s.options||{},req:{user:t.user,clientIp:t.clientIp,headers:t.headers}})).id,base_id:u.id}}async duplicateModel(e,t,a,i,s){const r=await k.Base.get(e,a);if(!r)throw new Error(`Base not found for id '${a}'`);const l=await k.Model.get(e,i);if(!l)throw new Error("Model not found!");const c=await k.Source.get(e,l.source_id);c.is_schema_readonly&&L.NcError.sourceMetaReadOnly(c.alias),c.is_data_readonly&&L.NcError.sourceDataReadOnly(c.alias);const d=await c.getModels(e),u=(0,S.generateUniqueName)(s.title||`${l.title} copy`,d.map((e=>e.title)));return{id:(await this.jobsService.add(M.JobTypes.DuplicateModel,{context:e,user:t.user,baseId:r.id,sourceId:c.id,modelId:l.id,title:u,options:s.options||{},req:{user:t.user,clientIp:t.clientIp,headers:t.headers}})).id}}async duplicateColumn(e,t,a,i,s){const r=await k.Base.get(e,a);if(!r)throw new Error(`Base not found for id '${a}'`);const l=await k.Column.get(e,{source_id:r.id,colId:i});if(!l)throw new Error("Column not found!");const c=await k.Model.get(e,l.fk_model_id);if(!c)throw new Error("Model not found!");const d=await k.Source.get(e,c.source_id);b.readonlyMetaAllowedTypes.includes(l.uidt)||(d.is_schema_readonly&&L.NcError.sourceMetaReadOnly(d.alias),d.is_data_readonly&&L.NcError.sourceDataReadOnly(d.alias));return{id:(await this.jobsService.add(M.JobTypes.DuplicateColumn,{context:e,user:t.user,baseId:r.id,sourceId:l.source_id,modelId:c.id,columnId:l.id,options:s.options||{},extra:s.extra||{},req:{user:t.user,clientIp:t.clientIp,headers:t.headers}})).id}}};t.DuplicateController=R,f([(0,y.Post)(["/api/v1/db/meta/duplicate/:workspaceId/shared/:sharedBaseId","/api/v1/meta/duplicate/:workspaceId/shared/:sharedBaseId"]),(0,y.HttpCode)(200),(0,v.Acl)("duplicateSharedBase",{scope:"org"}),g(0,(0,C.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("workspaceId")),g(3,(0,y.Param)("sharedBaseId")),g(4,(0,y.Body)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(r=void 0!==E.NcContext&&E.NcContext)?r:Object,"function"==typeof(l=void 0!==E.NcRequest&&E.NcRequest)?l:Object,String,String,Object]),h("design:returntype",Promise)],R.prototype,"duplicateSharedBase",null),f([(0,y.Post)(["/api/v1/db/meta/duplicate/:baseId/:sourceId?","/api/v2/meta/duplicate/:baseId/:sourceId?"]),(0,y.HttpCode)(200),(0,v.Acl)("duplicateBase"),g(0,(0,C.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("baseId")),g(3,(0,y.Param)("sourceId")),g(4,(0,y.Body)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(c=void 0!==E.NcContext&&E.NcContext)?c:Object,"function"==typeof(d=void 0!==E.NcRequest&&E.NcRequest)?d:Object,String,String,Object]),h("design:returntype",Promise)],R.prototype,"duplicateBase",null),f([(0,y.Post)(["/api/v1/db/meta/duplicate/:baseId/table/:modelId","/api/v2/meta/duplicate/:baseId/table/:modelId"]),(0,y.HttpCode)(200),(0,v.Acl)("duplicateModel"),g(0,(0,C.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("baseId")),g(3,(0,y.Param)("modelId")),g(4,(0,y.Body)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(u=void 0!==E.NcContext&&E.NcContext)?u:Object,"function"==typeof(p=void 0!==E.NcRequest&&E.NcRequest)?p:Object,String,String,Object]),h("design:returntype",Promise)],R.prototype,"duplicateModel",null),f([(0,y.Post)(["/api/v1/db/meta/duplicate/:baseId/column/:columnId","/api/v2/meta/duplicate/:baseId/column/:columnId"]),(0,y.HttpCode)(200),(0,v.Acl)("duplicateColumn"),g(0,(0,C.TenantContext)()),g(1,(0,y.Req)()),g(2,(0,y.Param)("baseId")),g(3,(0,y.Param)("columnId")),g(4,(0,y.Body)()),h("design:type",Function),h("design:paramtypes",["function"==typeof(m=void 0!==E.NcContext&&E.NcContext)?m:Object,"function"==typeof(_=void 0!==E.NcRequest&&E.NcRequest)?_:Object,String,String,Object]),h("design:returntype",Promise)],R.prototype,"duplicateColumn",null),t.DuplicateController=R=f([(0,y.Controller)(),(0,y.UseGuards)(O.MetaApiLimiterGuard,w.GlobalGuard),g(0,(0,y.Inject)("JobsService")),h("design:paramtypes",["function"==typeof(i=void 0!==I.IJobsService&&I.IJobsService)?i:Object,"function"==typeof(s=void 0!==T.BasesService&&T.BasesService)?s:Object])],R)},86524:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateProcessor=void 0;const m=a(48378),_=p(a(5520)),f=p(a(89576)),h=a(71040),g=a(23324),y=a(19684),b=a(40668),w=a(82048),v=a(26272),T=a(74056),k=a(81472),S=a(16428),M=a(83676),O=a(7156);let I=class DuplicateProcessor{constructor(e,t,a,i,s){this.exportService=e,this.importService=t,this.projectsService=a,this.bulkDataService=i,this.columnsService=s,this.debugLog=(0,f.default)("nc:jobs:duplicate")}async duplicateBase(e){var t;this.debugLog(`job started for ${e.id} (${k.JobTypes.DuplicateBase})`);const a=(0,S.initTime)(),{context:i,sourceId:s,dupProjectId:r,req:l,options:c}=e.data,d=i.base_id;"1"===(null===(t=l.user)||void 0===t?void 0:t.id)&&delete l.user;const u=(null==c?void 0:c.excludeData)||!1,p=(null==c?void 0:c.excludeHooks)||!1,m=(null==c?void 0:c.excludeViews)||!1,_=await y.Base.get(i,d),f=await y.Base.get(i,r),h=await y.Source.get(i,s),g={workspace_id:f.fk_workspace_id,base_id:f.id};try{if(!_||!f||!h)throw new Error("Base or source not found!");const e=l.user,t=(await h.getModels(i)).filter((e=>e.source_id===h.id&&!e.mm&&"table"===e.type)),s=await this.exportService.serializeModels(i,{modelIds:t.map((e=>e.id)),excludeViews:m,excludeHooks:p,excludeData:u});if((0,S.elapsedTime)(a,`serialize models schema for ${h.base_id}::${h.id}`,"duplicateBase"),!s)throw new Error(`Export failed for source '${h.id}'`);await f.getSources();const r=f.sources[0],c=await this.importService.importModels(g,{user:e,baseId:f.id,sourceId:r.id,data:s,req:l});if((0,S.elapsedTime)(a,"import models schema","duplicateBase"),!c)throw new Error(`Import failed for source '${h.id}'`);u||await this.importModelsData(g,i,{idMap:c,sourceProject:_,sourceModels:t,destProject:f,destBase:r,hrTime:a,req:l}),await this.projectsService.baseUpdate(g,{baseId:f.id,base:{status:null},user:l.user,req:l})}catch(e){throw(null==f?void 0:f.id)&&await this.projectsService.baseSoftDelete(g,{baseId:f.id,user:l.user,req:l}),e}return this.debugLog(`job completed for ${e.id} (${k.JobTypes.DuplicateBase})`),{id:f.id}}async duplicateModel(e){this.debugLog(`job started for ${e.id} (${k.JobTypes.DuplicateModel})`);const t=(0,S.initTime)(),{context:a,sourceId:i,modelId:s,title:r,req:l,options:c}=e.data,d=a.base_id,u=(null==c?void 0:c.excludeData)||!1,p=(null==c?void 0:c.excludeHooks)||!1,m=(null==c?void 0:c.excludeViews)||!1,_=await y.Base.get(a,d),f=await y.Source.get(a,i),g=l.user,b=(await f.getModels(a)).filter((e=>!e.mm&&"table"===e.type)),v=b.find((e=>e.id===s));await v.getColumns(a);const T=v.columns.filter((e=>(0,h.isLinksOrLTAR)(e))).map((e=>e.colOptions.fk_related_model_id)).filter((e=>e)),M=b.filter((e=>T.includes(e.id))),O=(await this.exportService.serializeModels(a,{modelIds:[s],excludeViews:m,excludeHooks:p,excludeData:u}))[0];if((0,S.elapsedTime)(t,`serialize model schema for ${s}`,"duplicateModel"),!O)throw new Error(`Export failed for source '${f.id}'`);O.model.title=r,O.model.table_name=r.toLowerCase().replace(/ /g,"_");const I=await this.importService.importModels(a,{baseId:d,sourceId:i,data:[O],user:g,req:l,externalModels:M});if((0,S.elapsedTime)(t,"import model schema","duplicateModel"),!I)throw new Error(`Import failed for model '${s}'`);if(!u){const e={};for(const t of M){const a=t.columns.filter((e=>{var t;return(0,h.isLinksOrLTAR)(e)&&(e.colOptions.type===h.RelationTypes.BELONGS_TO||e.colOptions.type===h.RelationTypes.ONE_TO_ONE&&(null===(t=e.meta)||void 0===t?void 0:t.bt))&&e.colOptions.fk_related_model_id===v.id})).map((e=>e.id));a.length>0&&(e[t.id]=e[t.id]?e[t.id]:[t.primaryKey.id],e[t.id].push(...a))}await this.importModelsData(a,a,{idMap:I,sourceProject:_,sourceModels:[v],destProject:_,destBase:f,hrTime:t,modelFieldIds:e,externalModels:M,req:l}),(0,S.elapsedTime)(t,"import model data","duplicateModel")}return this.debugLog(`job completed for ${e.id} (${k.JobTypes.DuplicateModel})`),{id:(0,w.findWithIdentifier)(I,v.id)}}async duplicateColumn(e){this.debugLog(`job started for ${e.id} (${k.JobTypes.DuplicateColumn})`);const t=(0,S.initTime)(),{context:a,sourceId:i,columnId:s,extra:r,req:l,options:c}=e.data,d=a.base_id,u=(null==c?void 0:c.excludeData)||!1,p=await y.Base.get(a,d),m=await y.Column.get(a,{source_id:i,colId:s}),_=l.user,f=await y.Source.get(a,m.source_id),g=(await f.getModels(a)).filter((e=>!e.mm&&"table"===e.type)),b=g.find((e=>e.id===m.fk_model_id)),v=await b.getColumns(a),T=(0,w.generateUniqueName)(`${m.title} copy`,v.map((e=>e.title))),M=[m].filter((e=>(0,h.isLinksOrLTAR)(e))).map((e=>e.colOptions.fk_related_model_id)).filter((e=>e)),O=g.filter((e=>M.includes(e.id))),I=(await this.exportService.serializeModels(a,{modelIds:[b.id,...M],excludeData:u,excludeHooks:!0,excludeViews:!0}))[0];if((0,S.elapsedTime)(t,`serialize model schema for ${b.id}`,"duplicateColumn"),!I)throw new Error(`Export failed for model '${b.id}'`);const C=I.model.columns.find((e=>e.id.includes(s))),E=C.cdf;C.title=T,C.column_name=T.toLowerCase().replace(/ /g,"_"),C.cdf=null,Object.assign(C,r);const x=await this.importService.importModels(a,{baseId:d,sourceId:f.id,data:[I],user:_,req:l,externalModels:O,existingModel:b,importColumnIds:[s]});if((0,S.elapsedTime)(t,"import model schema","duplicateColumn"),!x)throw new Error(`Import failed for model '${b.id}'`);if(!u){const e={};e[b.id]=[b.primaryKey.id],e[b.id].push(s);for(const t of O){const a=t.columns.filter((e=>{var t;return(0,h.isLinksOrLTAR)(e)&&(e.colOptions.type===h.RelationTypes.BELONGS_TO||e.colOptions.type===h.RelationTypes.ONE_TO_ONE&&(null===(t=e.meta)||void 0===t?void 0:t.bt))&&e.colOptions.fk_related_model_id===b.id})).map((e=>e.id));a.length>0&&(e[t.id]=e[t.id]?e[t.id]:[t.primaryKey.id],e[t.id].push(...a))}await this.importModelsData(a,a,{idMap:x,sourceProject:p,sourceModels:[],destProject:p,destBase:f,hrTime:t,modelFieldIds:e,externalModels:[b,...O.filter((e=>e.id!==b.id))],req:l}),(0,S.elapsedTime)(t,"import model data","duplicateColumn")}const L=await y.Column.get(a,{source_id:p.id,colId:(0,w.findWithIdentifier)(x,m.id)});return(0,h.isVirtualCol)(L)||await this.columnsService.columnUpdate(a,{columnId:(0,w.findWithIdentifier)(x,m.id),column:Object.assign(Object.assign({},L),{cdf:E}),user:l.user}),this.debugLog(`job completed for ${e.id} (${k.JobTypes.DuplicateColumn})`),{id:(0,w.findWithIdentifier)(x,m.id)}}async importModelsData(e,t,a){const{idMap:i,sourceProject:s,sourceModels:r,destProject:l,destBase:c,hrTime:d,modelFieldIds:u,externalModels:p,req:f}=a;let g=[],b=null;for(const a of r){if(b)break;const r=new m.Readable({read(){}}),u=new m.Readable({read(){}});this.exportService.streamModelDataAsCsv(t,{dataStream:r,linkStream:u,baseId:s.id,modelId:a.id,handledMmList:g}).catch((e=>{this.debugLog(e),r.push(null),u.push(null),b=e}));const p=await y.Model.get(e,(0,w.findWithIdentifier)(i,a.id));await this.importService.importDataFromCsvStream(e,{idMap:i,dataStream:r,destProject:l,destBase:c,destModel:p,req:f}),g=await this.importService.importLinkFromCsvStream(e,{idMap:i,linkStream:u,destProject:l,destBase:c,handledLinks:g}),(0,S.elapsedTime)(d,`import data and links for ${p.title}`,"importModelsData")}if(b)throw b;if(p)for(const t of p){const a=null==u?void 0:u[t.id];if(!a)continue;const r=new m.Readable({read(){}}),p=new m.Readable({read(){}});let b=null;this.exportService.streamModelDataAsCsv(e,{dataStream:r,linkStream:p,baseId:s.id,modelId:t.id,handledMmList:g,_fieldIds:a}).catch((e=>{this.debugLog(e),r.push(null),p.push(null),b=e}));const w=[];let v=[];const T=await y.Model.get(e,t.id);if(await new Promise((t=>{_.default.parse(r,{newline:"\r\n",step:async(t,a)=>{var s,r,d;if(w.length){if(0===t.errors.length){const i={};for(let e=0;e<w.length;e++)w[e]&&""!==t.data[e]&&(i[w[e]]=t.data[e]);if(v.push(i),v.length>1e3){a.pause();try{v=v.filter((e=>Object.keys(e).length>1)),v.length>0&&await this.bulkDataService.bulkDataUpdate(e,{baseName:l.id,tableName:T.id,body:v,cookie:f,raw:!0})}catch(e){this.debugLog(e)}v=[],a.resume()}}}else{a.pause();for(const a of t.data){const t=i.get(a);if(t){const a=await y.Column.get(e,{source_id:c.id,colId:t});if(a)if((null===(s=a.colOptions)||void 0===s?void 0:s.type)===h.RelationTypes.BELONGS_TO||(null===(r=a.colOptions)||void 0===r?void 0:r.type)===h.RelationTypes.ONE_TO_ONE&&(null===(d=a.meta)||void 0===d?void 0:d.bt)){const i=await y.Column.get(e,{source_id:c.id,colId:a.colOptions.fk_child_column_id});i?w.push(i.column_name):(w.push(null),this.debugLog(`child column not found (${t})`))}else w.push(a.column_name);else w.push(null),this.debugLog(`column not found (${t})`)}else w.push(null),this.debugLog(`id not found (${a})`)}a.resume()}},complete:async()=>{if(v.length>0){try{v=v.filter((e=>Object.keys(e).length>1)),v.length>0&&await this.bulkDataService.bulkDataUpdate(e,{baseName:l.id,tableName:T.id,body:v,cookie:f,raw:!0})}catch(e){this.debugLog(e)}v=[]}t(null)}})})),b)throw b;g=await this.importService.importLinkFromCsvStream(e,{idMap:i,linkStream:p,destProject:l,destBase:c,handledLinks:g}),(0,S.elapsedTime)(d,`map existing links to ${T.title}`,"importModelsData")}}};t.DuplicateProcessor=I,t.DuplicateProcessor=I=d([(0,g.Injectable)(),u("design:paramtypes",["function"==typeof(i=void 0!==M.ExportService&&M.ExportService)?i:Object,"function"==typeof(s=void 0!==O.ImportService&&O.ImportService)?s:Object,"function"==typeof(r=void 0!==b.BasesService&&b.BasesService)?r:Object,"function"==typeof(l=void 0!==v.BulkDataAliasService&&v.BulkDataAliasService)?l:Object,"function"==typeof(c=void 0!==T.ColumnsService&&T.ColumnsService)?c:Object])],I)},83676:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExportService=void 0;const d=a(48378),u=a(71040),p=a(5520),m=c(a(89576)),_=a(23324),f=a(16428),h=a(19684),g=c(a(82096)),y=a(44980),b=a(82048),w=c(a(23080)),v=a(43820),T=a(68144),k=a(26944);let S=class ExportService{constructor(e){this.datasService=e,this.debugLog=(0,m.default)("nc:jobs:import")}async serializeModels(e,t){var a,i,s,r;const{modelIds:c}=t,d=(null==t?void 0:t.excludeData)||!1,p=(null==t?void 0:t.excludeViews)||!1,m=(null==t?void 0:t.excludeHooks)||!1,_=[],f=new Map,y=[],w=[],T=new Map;for(const t of c){const c=await h.Model.get(e,t);let S;if(!c)return v.NcError.tableNotFound(t);const M=y.find((e=>e.id===c.base_id)),O=M||await h.Base.get(e,c.base_id),I=w.find((e=>e.id===c.source_id)),C=I||await h.Source.get(e,c.source_id);M||y.push(O),I||w.push(C),T.has(C.id)||T.set(C.id,await(0,b.generateBaseIdMap)(e,C,f)),await c.getColumns(e),await c.getViews(e),p&&(c.views=c.views.filter((e=>e.is_default)));for(const t of c.columns){if(await t.getColOptions(e),!d&&"pg"===C.type&&t.ai)try{const a=await h.Model.getBaseModelSQL(e,{id:c.id,viewId:null,dbDriver:await g.default.get(C)}),i=await g.default.getSqlClient(C),s=await i.raw("SELECT pg_get_serial_sequence('??', ?) as seq;",[a.getTnPath(c.table_name),t.column_name]);if(s.rows.length>0&&s.rows[0].seq){const e=s.rows[0].seq,t=await i.raw(`SELECT last_value as last FROM ${e};`);t.rows.length>0&&(S=t.rows[0].last)}}catch(e){this.debugLog(e)}if(t.colOptions)for(const[s,r]of Object.entries(t.colOptions))switch(s){case"fk_mm_child_column_id":case"fk_mm_parent_column_id":case"fk_mm_model_id":case"fk_parent_column_id":case"fk_child_column_id":case"fk_related_model_id":case"fk_relation_column_id":case"fk_lookup_column_id":case"fk_rollup_column_id":case"fk_qr_value_column_id":case"fk_barcode_value_column_id":case"fk_webhook_id":t.colOptions[s]=f.get(r);break;case"fk_target_view_id":if(r){const a=await h.View.get(e,r);f.set(a.id,`${C.base_id}::${C.id}::${(0,b.getEntityIdentifier)(a.fk_model_id)}::${a.id}`),t.colOptions[s]=f.get(r)}break;case"options":for(const e of t.colOptions.options)delete e.id,delete e.fk_column_id;break;case"formula":t.colOptions.formula_raw=null===(a=t.colOptions[s])||void 0===a?void 0:a.replace(/\{\{.*?\}\}/gm,(e=>{const t=c.columns.find((t=>t.id===e.slice(2,-2)));return`{${null==t?void 0:t.title}}`})),t.colOptions[s]=null===(i=t.colOptions[s])||void 0===i?void 0:i.replace(/(?<=\{\{).*?(?=\}\})/gm,(e=>f.get(e)));break;case"id":case"created_at":case"updated_at":case"fk_column_id":delete t.colOptions[s]}if("pg"===C.type&&t.cdf){const e=t.cdf.toString(),a=e.match(/'/g);if(a&&a.length%2!=0){const a=e.lastIndexOf("'");t.cdf=e.substring(0,a)}}if((0,u.isLinksOrLTAR)(t)){const a=t.colOptions;if(a.filter=await h.Filter.getFilterObject(e,{linkColId:t.id}),null===(r=null===(s=a.filter)||void 0===s?void 0:s.children)||void 0===r?void 0:r.length){const e=[];for(const i of a.filter.children){const a={id:`${f.get(t.id)}::${i.id}`,fk_column_id:f.get(i.fk_column_id),fk_parent_id:`${f.get(t.id)}::${i.fk_parent_id}`,fk_link_col_id:f.get(t.id),fk_value_col_id:i.fk_value_col_id?f.get(i.fk_value_col_id):null,is_group:i.is_group,logical_op:i.logical_op,comparison_op:i.comparison_op,comparison_sub_op:i.comparison_sub_op,value:i.value};a.is_group&&(delete a.comparison_op,delete a.comparison_sub_op,delete a.value),e.push(a)}a.filter.children=e}}}for(const t of c.views){if(f.set(t.id,`${f.get(c.id)}::${t.id}`),await t.getColumns(e),await t.getFilters(e),await t.getSorts(e),t.filter){const e=[];for(const a of t.filter.children){const i={id:`${f.get(t.id)}::${a.id}`,fk_parent_column_id:a.fk_parent_column_id?f.get(a.fk_parent_column_id):null,fk_column_id:f.get(a.fk_column_id),fk_parent_id:`${f.get(t.id)}::${a.fk_parent_id}`,is_group:a.is_group,logical_op:a.logical_op,comparison_op:a.comparison_op,comparison_sub_op:a.comparison_sub_op,value:a.value};i.is_group&&(delete i.comparison_op,delete i.comparison_sub_op,delete i.value),e.push(i)}t.filter.children=e}if(t.sorts){const e=[];for(const a of t.sorts){const t={fk_column_id:f.get(a.fk_column_id),direction:a.direction};e.push(t)}t.sorts=e}if(t.view)for(const[e,a]of Object.entries(t.view))switch(e){case"fk_column_id":case"fk_cover_image_col_id":case"fk_grp_col_id":t.view[e]=f.get(a);break;case"meta":if(t.type===u.ViewTypes.KANBAN){const e=(0,k.parseMetaProp)(t.view);for(const[t,a]of Object.entries(e)){if(!Array.isArray(a))continue;const i=f.get(t);for(const e of a)e.fk_column_id=f.get(e.fk_column_id),delete e.id;e[i]=a,delete e[t]}t.view.meta=e}break;case"calendar_range":if(t.type===u.ViewTypes.CALENDAR){const a=t.view[e];t.view[e]=a.map((e=>({fk_to_column_id:f.get(e.fk_to_column_id),fk_from_column_id:f.get(e.fk_from_column_id)})))}break;case"created_at":case"updated_at":case"fk_view_id":case"base_id":case"source_id":case"uuid":delete t.view[e]}}const E=[];if(!m){const t=await h.Hook.list(e,{fk_model_id:c.id});for(const a of t){f.set(a.id,`${f.get(a.fk_model_id)}::${a.id}`);const t=await a.getFilters(e),i=[];if(t)for(const e of t){const t={id:`${f.get(a.id)}::${e.id}`,fk_column_id:f.get(e.fk_column_id),fk_parent_id:e.fk_parent_id,is_group:e.is_group,logical_op:e.logical_op,comparison_op:e.comparison_op,comparison_sub_op:e.comparison_sub_op,value:e.value};t.is_group&&(delete t.comparison_op,delete t.comparison_sub_op,delete t.value),i.push(t)}E.push({id:f.get(a.id),title:a.title,active:a.active,condition:a.condition,event:a.event,operation:a.operation,notification:a.notification,version:a.version,filters:i})}}_.push({model:{id:f.get(c.id),prefix:O.prefix,title:c.title,table_name:(0,b.clearPrefix)(c.table_name,O.prefix),description:c.description,pgSerialLastVal:S,meta:c.meta,columns:c.columns.map((e=>({description:e.description,id:f.get(e.id),ai:e.ai,column_name:e.column_name,cc:e.cc,cdf:e.cdf,dt:e.dt,dtxp:e.dtxp,dtxs:e.dtxs,meta:e.meta,pk:e.pk,pv:e.pv,order:e.order,rqd:e.rqd,system:e.system,uidt:e.uidt,title:e.title,un:e.un,unique:e.unique,colOptions:e.colOptions})))},views:c.views.map((e=>({description:e.description,id:f.get(e.id),is_default:e.is_default,type:e.type,meta:e.meta,order:e.order,title:e.title,show:e.show,show_system_fields:e.show_system_fields,filter:e.filter,sorts:e.sorts,lock_type:e.lock_type,columns:e.columns.map((e=>{const t=e,{id:a,fk_view_id:i,fk_column_id:s,base_id:r,source_id:c,created_at:d,updated_at:u,uuid:p}=t,m=l(t,["id","fk_view_id","fk_column_id","base_id","source_id","created_at","updated_at","uuid"]);return Object.assign({fk_column_id:f.get(s)},m)})),view:e.view}))),hooks:E})}return _}async streamModelDataAsCsv(e,t){var a,i,s;const{dataStream:r,linkStream:l,handledMmList:c}=t,d=!l,{model:p,view:m}=await(0,y.getViewAndModelByAliasOrId)(e,{baseName:t.baseId,tableName:t.modelId,viewName:t.viewId}),_=await h.Source.get(e,p.source_id);await p.getColumns(e);const f=new Map;if(!d)for(const a of p.columns.filter((e=>{var t,a,i;return e.uidt===u.UITypes.LinkToAnotherRecord&&((null===(t=e.colOptions)||void 0===t?void 0:t.type)===u.RelationTypes.BELONGS_TO||(null===(a=e.colOptions)||void 0===a?void 0:a.type)===u.RelationTypes.ONE_TO_ONE&&(null===(i=e.meta)||void 0===i?void 0:i.bt))}))){await a.getColOptions(e);const i=p.columns.find((e=>{var t;return e.id===(null===(t=a.colOptions)||void 0===t?void 0:t.fk_child_column_id)}));if(i){if(t._fieldIds&&t._fieldIds.includes(a.id)){t._fieldIds.push(i.id);const e=t._fieldIds.indexOf(a.id);t._fieldIds.splice(e,1)}f.set(i.id,`${a.base_id}::${a.source_id}::${a.fk_model_id}::${a.id}`)}}let b=t._fieldIds?p.columns.filter((e=>{var a;return null===(a=t._fieldIds)||void 0===a?void 0:a.includes(e.id)})).map((e=>e.title)).join(","):p.columns.filter((e=>!(0,u.isLinksOrLTAR)(e))).map((e=>e.title)).join(",");if(d){b=(await m.getColumns(e)).sort(((e,t)=>e.order-t.order)).filter((e=>e.show)).map((e=>p.columns.find((t=>t.id===e.fk_column_id)).title)).join(",")}const w=t._fieldIds?p.columns.filter((e=>{var a;return null===(a=t._fieldIds)||void 0===a?void 0:a.includes(e.id)})).filter((e=>{var t;return(0,u.isLinksOrLTAR)(e)&&"mm"===(null===(t=e.colOptions)||void 0===t?void 0:t.type)})):p.columns.filter((e=>{var t;return(0,u.isLinksOrLTAR)(e)&&"mm"===(null===(t=e.colOptions)||void 0===t?void 0:t.type)})),v=!d&&w.length>0;r.setEncoding("utf8");const T=e=>{for(const t of e)for(const[e,a]of Object.entries(t)){const i=p.columns.find((t=>t.title===e));if(i){const s=`${i.base_id}::${i.source_id}::${i.fk_model_id}::${i.id}`;switch(i.uidt){case u.UITypes.ForeignKey:f.has(i.id)&&(t[f.get(i.id)]=a,delete t[e]);break;case u.UITypes.Attachment:try{t[s]=JSON.stringify(a)}catch(e){t[s]=a}break;case u.UITypes.User:case u.UITypes.CreatedBy:case u.UITypes.LastModifiedBy:if(a){const e=[],i=Array.isArray(a)?a:[a];for(const t of i)e.push(t.id);t[s]=e.join(",")}else t[s]=a;break;case u.UITypes.Formula:case u.UITypes.Lookup:case u.UITypes.Button:case u.UITypes.Rollup:case u.UITypes.Barcode:case u.UITypes.QrCode:break;default:t[s]=a}delete t[e]}}return{data:e}},k=async a=>{for(const i of a)for(const[a,s]of Object.entries(i)){const r=p.columns.find((e=>e.title===a));r&&(i[a]=await(0,y.serializeCellValue)(e,{value:s,column:r,siteUrl:t.ncSiteUrl}))}return{data:a}},S=await h.Model.getBaseModelSQL(e,{id:p.id,viewId:null==m?void 0:m.id,dbDriver:await g.default.get(_)});try{await this.recursiveRead(e,d?k:T,S,r,p,m,0,200,b,!0,t.delimiter,d)}catch(e){throw this.debugLog(e),e}if(v){l.setEncoding("utf8");let t=!1;for(const r of w){if(c.includes(null===(a=r.colOptions)||void 0===a?void 0:a.fk_mm_model_id))continue;const d=await h.Model.get(e,null===(i=r.colOptions)||void 0===i?void 0:i.fk_mm_model_id);await d.getColumns(e);const p=d.columns.find((e=>{var t;return e.id===(null===(t=r.colOptions)||void 0===t?void 0:t.fk_mm_child_column_id)})),m=d.columns.find((e=>{var t;return e.id===(null===(t=r.colOptions)||void 0===t?void 0:t.fk_mm_parent_column_id)})),f=p.title,y=m.title,b=d.columns.filter((e=>e.uidt===u.UITypes.ForeignKey)).map((e=>e.title)).join(","),w=e=>(e.map((e=>(e.column=r.id,e.child=e[f],e.parent=e[y],delete e[f],delete e[y],e))),{data:e}),v=200,T=0,k=d.source_id===_.id?_:await h.Source.get(e,d.source_id),S=await h.Model.getBaseModelSQL(e,{id:d.id,dbDriver:await g.default.get(k)});try{await this.recursiveLinkRead(e,w,S,l,d,void 0,T,v,b,!t),t=!0}catch(e){throw this.debugLog(e),e}c.push(null===(s=r.colOptions)||void 0===s?void 0:s.fk_mm_model_id)}l.push(null)}else l&&l.push(null)}async recursiveRead(e,t,a,i,s,r,l,c,d,u=!1,m=",",_=!1){return new Promise(((f,h)=>{this.datasService.getDataList(e,{model:s,view:r,query:{limit:c,offset:l,fields:d},baseModel:a,ignoreViewFilterAndSort:!_,limitOverride:c}).then((g=>{try{u||i.push("\r\n");const y=t(g.list);y instanceof Promise?y.then((({data:y})=>{i.push((0,p.unparse)(y,{header:u,delimiter:m})),g.pageInfo.isLastPage?(i.push(null),f()):this.recursiveRead(e,t,a,i,s,r,l+c,c,d,!1,m,_).then(f).catch(h)})):(i.push((0,p.unparse)(y.data,{header:u})),g.pageInfo.isLastPage?(i.push(null),f()):this.recursiveRead(e,t,a,i,s,r,l+c,c,d,!1,m,_).then(f).catch(h))}catch(e){h(e)}})).catch(h)}))}async recursiveLinkRead(e,t,a,i,s,r,l,c,d,u=!1){return new Promise(((m,_)=>{this.datasService.getDataList(e,{model:s,view:r,query:{limit:c,offset:l,fields:d},baseModel:a,ignoreViewFilterAndSort:!0,limitOverride:c}).then((f=>{try{u||i.push("\r\n");const{data:h}=t(f.list);h&&i.push((0,p.unparse)(h,{header:u})),f.pageInfo.isLastPage?m():this.recursiveLinkRead(e,t,a,i,s,r,l+c,c,d).then(m).catch(_)}catch(e){_(e)}})).catch(_)}))}async exportBase(e,t){const a=(0,f.initTime)(),i=await h.Source.get(e,t.sourceId);i||v.NcError.sourceNotFound(t.sourceId);const s=await h.Base.get(e,i.base_id),r=(await i.getModels(e)).filter((e=>e.source_id===i.id&&!e.mm&&"table"===e.type)),l=await this.serializeModels(e,{modelIds:r.map((e=>e.id))});(0,f.elapsedTime)(a,`serialize models for ${i.base_id}::${i.id}`,"exportBase");const c={id:`${s.id}::${i.id}`,models:l},u=await w.default.storageAdapter(),p=`export/${s.id}/${i.id}/${t.path}`;try{const t=new d.Readable({read(){}});t.setEncoding("utf8"),t.push(JSON.stringify(c)),t.push(null),await u.fileCreateByStream(`${p}/schema.json`,t);const l=[],m=new d.Readable({read(){}}),_=u.fileCreateByStream(`${p}/data/links.csv`,m);for(const t of r){const a=new d.Readable({read(){}}),i=new d.Readable({read(){}}),r=new Promise((e=>{i.on("data",(e=>{m.push(e)})),i.on("end",(()=>{m.push("\r\n"),e(null)})),i.on("error",(t=>{this.debugLog(t),e(null)}))})),c=u.fileCreateByStream(`${p}/data/${t.id}.csv`,a);let _=null;if(this.streamModelDataAsCsv(e,{dataStream:a,linkStream:i,baseId:s.id,modelId:t.id,handledMmList:l}).catch((e=>{this.debugLog(e),a.push(null),i.push(null),_=e})),await Promise.all([c,r]),_)throw _}m.push(null),await _,(0,f.elapsedTime)(a,`export source ${i.base_id}::${i.id}`,"exportBase")}catch(e){throw v.NcError.badRequest(e)}return{path:p}}};t.ExportService=S,t.ExportService=S=s([(0,_.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==T.DatasService&&T.DatasService)?i:Object])],S)},7156:function(e,t,a){"use strict";var i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},T=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},k=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},S=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImportService=void 0;const M=a(71040),O=a(23324),I=S(a(5520)),C=S(a(89576)),E=a(16428),x=a(19684),L=a(19684),R=a(82048),N=a(43820),A=a(69680),D=a(74056),j=a(53311),P=a(50976),q=a(38900),U=a(75564),$=a(69200),Y=a(98348),B=a(76383),F=a(10140),V=a(48968),H=a(86935),G=a(5348),W=a(38040),z=S(a(23080)),J=a(26272),K=S(a(82096)),Q=a(43468);let X=i=class ImportService{constructor(e,t,a,s,r,l,c,d,u,p,m,_,f,h,g){this.tablesService=e,this.columnsService=t,this.filtersService=a,this.sortsService=s,this.viewColumnsService=r,this.gridColumnsService=l,this.formColumnsService=c,this.gridsService=d,this.formsService=u,this.galleriesService=p,this.calendarsService=m,this.kanbansService=_,this.bulkDataService=f,this.hooksService=h,this.viewsService=g,this.debugLog=(0,C.default)("nc:jobs:import"),this.logger=new O.Logger(i.name)}async importModels(e,t){var a,i,s,r,l,c,d,u,p,m,_,f,h,g,y,b,w,v,T,S,O,I,C,A,D;const j=(0,E.initTime)(),P=new Map,q=new Map,U=e=>P.get(e)||q.get(e),$=await L.Base.get(e,t.baseId);if(!$)return N.NcError.baseNotFound(t.baseId);const Y=await L.Source.get(e,t.sourceId);if(!Y)return N.NcError.sourceNotFound(t.sourceId);const B=new Map,F=new Map;if(t.data=Array.isArray(t.data)?t.data:t.data.models,t.existingModel&&(t.externalModels=[t.existingModel,...t.externalModels]),t.externalModels)for(const a of t.externalModels){q.set(`${a.base_id}::${a.source_id}::${a.id}`,a.id),await a.getColumns(e),await a.getViews(e);const t=a.primaryKey;t&&P.set(`${a.base_id}::${a.source_id}::${a.id}::${t.id}`,t.id);for(const e of a.columns)q.set(`${a.base_id}::${a.source_id}::${a.id}::${e.id}`,e.id);for(const e of a.views)q.set(`${a.base_id}::${a.source_id}::${a.id}::${e.id}`,e.id);const i=await x.Hook.list(e,{fk_model_id:a.id});for(const e of i)q.set(`${a.base_id}::${a.source_id}::${a.id}::${e.id}`,e.id)}(0,E.elapsedTime)(j,"generate id map for external models","importModels");for(const a of t.data){const i=a.model,s=i.columns.filter((e=>!(0,M.isVirtualCol)(e)&&e.uidt!==M.UITypes.ForeignKey&&(!t.importColumnIds||t.importColumnIds.includes((0,R.getEntityIdentifier)(e.id))))),r=t.existingModel||await this.tablesService.tableCreate(e,{baseId:$.id,sourceId:Y.id,user:t.user,table:(0,R.withoutId)(Object.assign(Object.assign({},i),{columns:s.map((e=>(0,R.withoutId)(e)))}))});if(P.set(i.id,r.id),t.existingModel){if(s.length)for(const a of s){const i=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign({},a)),req:t.req,user:t.user});for(const e of i.columns)if(e.title===a.title){P.set(a.id,e.id);break}}}else for(const t of r.columns){const a=i.columns.find((e=>e.column_name&&(0,Q.sanitizeColumnName)(e.column_name,Y.type)===t.column_name));if(P.set(a.id,t.id),"pg"===Y.type&&i.pgSerialLastVal&&t.ai){const a=await L.Model.getBaseModelSQL(e,{id:r.id,viewId:null,dbDriver:await K.default.get(Y)}),s=await K.default.getSqlClient(Y);await s.raw("SELECT setval(pg_get_serial_sequence('??', ?), ?);",[a.getTnPath(r.table_name),t.column_name,i.pgSerialLastVal])}}B.set(i.id,r)}for(const a of t.data){if(t.existingModel)break;if(!(null==a?void 0:a.hooks))break;const i=a.model,s=a.hooks,r=B.get(i.id);for(const a of s){const{filters:i}=a,s=k(a,["filters"]),l=(0,R.withoutId)(Object.assign({},s)),c=await this.hooksService.hookCreate(e,{tableId:r.id,hook:Object.assign({},l),req:t.req});c&&P.set(a.id,c.id)}}(0,E.elapsedTime)(j,"create tables with static columns","importModels");const V=[],H=[];for(const k of t.data){const S=k.model,O=B.get(S.id),I=S.columns.filter((e=>(0,M.isLinksOrLTAR)(e)&&!e.system&&(!t.importColumnIds||t.importColumnIds.includes((0,R.getEntityIdentifier)(e.id)))));for(const k of I)if(k.colOptions){const I=k.colOptions;if(P.has(I.fk_related_model_id)){if("mm"===I.type){if(!F.has(I.fk_mm_model_id)){delete k.column_name;const i=await this.columnsService.columnAdd(e,{tableId:O.id,column:(0,R.withoutId)(Object.assign(Object.assign({},k),{parentId:U((0,R.getParentIdentifier)(I.fk_child_column_id)),childId:U((0,R.getParentIdentifier)(I.fk_parent_column_id)),type:I.type,virtual:I.virtual,ur:I.ur,dr:I.dr,childViewId:I.fk_target_view_id&&U(I.fk_target_view_id)})),req:t.req,user:t.user});for(const e of i.columns)if(e.title===k.title){P.set(k.id,e.id),F.set(I.fk_mm_model_id,e.colOptions.fk_mm_model_id);break}const s=(0,R.getParentIdentifier)(I.fk_parent_column_id)===S.id?i:await L.Model.get(e,U((0,R.getParentIdentifier)(I.fk_parent_column_id)));(0,R.getParentIdentifier)(I.fk_parent_column_id)!==S.id&&await s.getColumns(e);const r=t.data.find((e=>e.model.id===(0,R.getParentIdentifier)(I.fk_parent_column_id))).model.columns.find((e=>{var t;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_mm_model_id)===I.fk_mm_model_id&&e.id!==k.id}));for(const i of s.columns)if((null===(a=null==i?void 0:i.colOptions)||void 0===a?void 0:a.fk_mm_model_id)===F.get(I.fk_mm_model_id)&&i.id!==U(k.id)){if(P.set(r.id,i.id),i.title!==r.title){s.columns.find((e=>e.title===r.title))&&(r.title=(0,R.generateUniqueName)(`${r.title} copy`,s.columns.map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:i.id,column:Object.assign(Object.assign({},i),{column_name:r.title,title:r.title}),user:t.user})}break}}}else if(I.type===M.RelationTypes.HAS_MANY||I.type===M.RelationTypes.ONE_TO_ONE&&!(null===(i=k.meta)||void 0===i?void 0:i.bt)){delete k.column_name;const a=await this.columnsService.columnAdd(e,{tableId:O.id,column:(0,R.withoutId)(Object.assign(Object.assign({},k),{parentId:U((0,R.getParentIdentifier)(I.fk_parent_column_id)),childId:U((0,R.getParentIdentifier)(I.fk_child_column_id)),type:I.type,virtual:I.virtual,ur:I.ur,dr:I.dr,childViewId:I.fk_target_view_id&&U(I.fk_target_view_id)})),req:t.req,user:t.user});for(const e of a.columns)if(e.title===k.title){P.set(k.id,e.id),P.set(I.fk_parent_column_id,e.colOptions.fk_parent_column_id),P.set(I.fk_child_column_id,e.colOptions.fk_child_column_id);break}const i=I.fk_related_model_id===S.id?a:await L.Model.get(e,U(I.fk_related_model_id));I.fk_related_model_id!==S.id&&await i.getColumns(e);const c=t.data.find((e=>e.model.id===I.fk_related_model_id)).model.columns.find((e=>{var t,a;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_parent_column_id)===I.fk_parent_column_id&&(null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===I.fk_child_column_id&&e.id!==k.id}));for(const a of i.columns){if(a.id!==U(k.id)&&(null===(s=a.colOptions)||void 0===s?void 0:s.fk_parent_column_id)===U(I.fk_parent_column_id)&&(null===(r=a.colOptions)||void 0===r?void 0:r.fk_child_column_id)===U(I.fk_child_column_id)&&(P.set(c.id,a.id),a.title!==c.title)){i.columns.find((e=>e.title===c.title))&&(c.title=(0,R.generateUniqueName)(`${c.title} copy`,i.columns.filter((e=>e.id!==a.id)).map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:c.title,title:c.title}),user:t.user})}if(a.id===U(I.fk_child_column_id)){const s=null===(l=t.data.find((e=>e.model.id===I.fk_related_model_id)))||void 0===l?void 0:l.model.columns.find((e=>e.id===I.fk_child_column_id));if(s&&a.title!==(null==s?void 0:s.title)){i.columns.find((e=>e.title===s.title))&&(s.title=(0,R.generateUniqueName)(`${s.title} copy`,i.columns.filter((e=>e.id!==a.id)).map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:s.column_name,title:s.title}),user:t.user})}}}}}else if(q.has(I.fk_related_model_id))if("mm"===I.type){if(!F.has(I.fk_mm_model_id)){delete k.column_name;const a=await this.columnsService.columnAdd(e,{tableId:O.id,column:(0,R.withoutId)(Object.assign(Object.assign({},k),{parentId:U((0,R.getParentIdentifier)(I.fk_child_column_id)),childId:U((0,R.getParentIdentifier)(I.fk_parent_column_id)),type:I.type,virtual:I.virtual,ur:I.ur,dr:I.dr,childViewId:I.fk_target_view_id&&U(I.fk_target_view_id)})),req:t.req,user:t.user});for(const e of a.columns)if(e.title===k.title){P.set(k.id,e.id),F.set(I.fk_mm_model_id,e.colOptions.fk_mm_model_id);break}const i=(0,R.getParentIdentifier)(I.fk_parent_column_id)===S.id?a:await L.Model.get(e,U((0,R.getParentIdentifier)(I.fk_parent_column_id)));(0,R.getParentIdentifier)(I.fk_parent_column_id)!==S.id&&await i.getColumns(e);const s=((null===(c=t.data.find((e=>e.model.id===(0,R.getParentIdentifier)(I.fk_parent_column_id))))||void 0===c?void 0:c.model)||t.externalModels.find((e=>e.id===(0,R.getEntityIdentifier)((0,R.getParentIdentifier)(I.fk_parent_column_id))))).columns.find((e=>{var t,a;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_mm_model_id)===I.fk_mm_model_id&&e.id!==k.id||(null===(a=e.colOptions)||void 0===a?void 0:a.fk_mm_model_id)===(0,R.getEntityIdentifier)(I.fk_mm_model_id)&&e.id!==(0,R.getEntityIdentifier)(k.id)}));for(const a of i.columns)if((null===(d=null==a?void 0:a.colOptions)||void 0===d?void 0:d.fk_mm_model_id)===F.get(I.fk_mm_model_id)&&a.id!==U(k.id)){if(s.id.includes("::")?P.set(s.id,a.id):P.set(`${s.base_id}::${s.source_id}::${s.fk_model_id}::${s.id}`,a.id),a.title!==s.title){i.columns.find((e=>e.title===s.title))&&(s.title=(0,R.generateUniqueName)(`${s.title} copy`,i.columns.map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:s.title,title:s.title}),user:t.user})}break}}}else if(I.type===M.RelationTypes.HAS_MANY||I.type===M.RelationTypes.ONE_TO_ONE&&!(null===(u=k.meta)||void 0===u?void 0:u.bt)){if(!F.has(`${I.fk_parent_column_id}::${I.fk_child_column_id}`)){delete k.column_name;const a=await this.columnsService.columnAdd(e,{tableId:O.id,column:(0,R.withoutId)(Object.assign(Object.assign({},k),{parentId:U((0,R.getParentIdentifier)(I.fk_parent_column_id)),childId:U((0,R.getParentIdentifier)(I.fk_child_column_id)),type:I.type,virtual:I.virtual,ur:I.ur,dr:I.dr,childViewId:I.fk_target_view_id&&U(I.fk_target_view_id)})),req:t.req,user:t.user});F.set(`${I.fk_parent_column_id}::${I.fk_child_column_id}`,`${I.fk_parent_column_id}::${I.fk_child_column_id}`);for(const e of a.columns)if(e.title===k.title){P.set(k.id,e.id),P.set(I.fk_parent_column_id,e.colOptions.fk_parent_column_id),P.set(I.fk_child_column_id,e.colOptions.fk_child_column_id);break}const i=I.fk_related_model_id===S.id?a:await L.Model.get(e,U(I.fk_related_model_id));I.fk_related_model_id!==S.id&&await i.getColumns(e);const s=((null===(p=t.data.find((e=>e.model.id===I.fk_related_model_id)))||void 0===p?void 0:p.model)||t.externalModels.find((e=>e.id===(0,R.getEntityIdentifier)(I.fk_related_model_id)))).columns.find((e=>{var t,a,i,s;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_parent_column_id)===I.fk_parent_column_id&&(null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===I.fk_child_column_id&&e.id!==k.id||(null===(i=e.colOptions)||void 0===i?void 0:i.fk_parent_column_id)===(0,R.getEntityIdentifier)(I.fk_parent_column_id)&&(null===(s=e.colOptions)||void 0===s?void 0:s.fk_child_column_id)===(0,R.getEntityIdentifier)(I.fk_child_column_id)&&e.id!==(0,R.getEntityIdentifier)(k.id)}));for(const a of i.columns)if(a.id!==U(k.id)&&(null===(m=a.colOptions)||void 0===m?void 0:m.fk_parent_column_id)===U(I.fk_parent_column_id)&&(null===(_=a.colOptions)||void 0===_?void 0:_.fk_child_column_id)===U(I.fk_child_column_id)){if(s.id.includes("::")?P.set(s.id,a.id):P.set(`${s.base_id}::${s.source_id}::${s.fk_model_id}::${s.id}`,a.id),a.title!==s.title){i.columns.find((e=>e.title===s.title))&&(s.title=(0,R.generateUniqueName)(`${s.title} copy`,i.columns.filter((e=>e.id!==a.id)).map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:s.title,title:s.title}),user:t.user})}if(a.id===U(I.fk_child_column_id)){const s=null===(f=t.data.find((e=>e.model.id===I.fk_related_model_id)))||void 0===f?void 0:f.model.columns.find((e=>e.id===I.fk_child_column_id));if(s&&a.title!==(null==s?void 0:s.title)){i.columns.find((e=>e.title===s.title))&&(s.title=(0,R.generateUniqueName)(`${s.title} copy`,i.columns.filter((e=>e.id!==a.id)).map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:s.column_name,title:s.title}),user:t.user})}}}}}else if((I.type===M.RelationTypes.BELONGS_TO||I.type===M.RelationTypes.ONE_TO_ONE&&(null===(h=k.meta)||void 0===h?void 0:h.bt))&&!F.has(`${I.fk_parent_column_id}::${I.fk_child_column_id}`)){delete k.column_name;const a=await this.columnsService.columnAdd(e,{tableId:O.id,column:(0,R.withoutId)(Object.assign(Object.assign({},k),{parentId:U((0,R.getParentIdentifier)(I.fk_parent_column_id)),childId:U((0,R.getParentIdentifier)(I.fk_child_column_id)),type:I.type,virtual:I.virtual,ur:I.ur,dr:I.dr,childViewId:I.fk_target_view_id&&U(I.fk_target_view_id)})),req:t.req,user:t.user});F.set(`${I.fk_parent_column_id}::${I.fk_child_column_id}`,`${I.fk_parent_column_id}::${I.fk_child_column_id}`);for(const e of a.columns)if(e.title===k.title){P.set(k.id,e.id),P.set(I.fk_parent_column_id,e.colOptions.fk_parent_column_id),P.set(I.fk_child_column_id,e.colOptions.fk_child_column_id);break}const i=I.fk_related_model_id===S.id?a:await L.Model.get(e,U(I.fk_related_model_id));I.fk_related_model_id!==S.id&&await i.getColumns(e);const s=((null===(g=t.data.find((e=>e.model.id===I.fk_related_model_id)))||void 0===g?void 0:g.model)||t.externalModels.find((e=>e.id===(0,R.getEntityIdentifier)(I.fk_related_model_id)))).columns.find((e=>{var t,a,i,s;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_parent_column_id)===I.fk_parent_column_id&&(null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===I.fk_child_column_id&&e.id!==k.id||(null===(i=e.colOptions)||void 0===i?void 0:i.fk_parent_column_id)===(0,R.getEntityIdentifier)(I.fk_parent_column_id)&&(null===(s=e.colOptions)||void 0===s?void 0:s.fk_child_column_id)===(0,R.getEntityIdentifier)(I.fk_child_column_id)&&e.id!==(0,R.getEntityIdentifier)(k.id)}));for(const a of i.columns){if(a.id!==U(k.id)&&(null===(y=a.colOptions)||void 0===y?void 0:y.fk_parent_column_id)===U(I.fk_parent_column_id)&&(null===(b=a.colOptions)||void 0===b?void 0:b.fk_child_column_id)===U(I.fk_child_column_id)&&(s.id.includes("::")?P.set(s.id,a.id):P.set(`${s.base_id}::${s.source_id}::${s.fk_model_id}::${s.id}`,a.id),a.title!==s.title)){i.columns.find((e=>e.title===s.title))&&(s.title=(0,R.generateUniqueName)(`${s.title} copy`,i.columns.filter((e=>e.id!==a.id)).map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:s.title,title:s.title}),user:t.user})}if(a.id===U(I.fk_child_column_id)){const s=null===(w=t.data.find((e=>e.model.id===I.fk_related_model_id)))||void 0===w?void 0:w.model.columns.find((e=>e.id===I.fk_child_column_id));if(s&&a.title!==(null==s?void 0:s.title)){i.columns.find((e=>e.title===s.title))&&(s.title=(0,R.generateUniqueName)(`${s.title} copy`,i.columns.filter((e=>e.id!==a.id)).map((e=>e.title)))),await this.columnsService.columnUpdate(e,{columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:s.column_name,title:s.title}),user:t.user})}}}}(null===(T=null===(v=I.filter)||void 0===v?void 0:v.children)||void 0===T?void 0:T.length)&&H.push((async()=>{var a;const i=null===(a=I.filter)||void 0===a?void 0:a.children;for(const a of i){const i=await this.filtersService.linkFilterCreate(e,{columnId:U(k.id),filter:(0,R.withoutId)(Object.assign(Object.assign({},a),{fk_value_col_id:U(a.fk_value_col_id),fk_link_col_id:U(a.fk_link_col_id),fk_column_id:U(a.fk_column_id),fk_parent_id:U(a.fk_parent_id)})),user:t.user,req:t.req});i&&P.set(a.id,i.id)}}))}V.push(...S.columns.filter((e=>(e.uidt===M.UITypes.Lookup||e.uidt===M.UITypes.Rollup||e.uidt===M.UITypes.Formula||e.uidt===M.UITypes.Button||e.uidt===M.UITypes.QrCode||e.uidt===M.UITypes.CreatedTime||e.uidt===M.UITypes.LastModifiedTime||e.uidt===M.UITypes.CreatedBy||e.uidt===M.UITypes.LastModifiedBy||e.uidt===M.UITypes.Barcode)&&(!t.importColumnIds||t.importColumnIds.includes((0,R.getEntityIdentifier)(e.id))))))}(0,E.elapsedTime)(j,"create LTAR columns","importModels");const G=[];for(const e of V){const t=[];if((null===(S=e.colOptions)||void 0===S?void 0:S.fk_lookup_column_id)&&t.push(e.colOptions.fk_lookup_column_id),(null===(O=e.colOptions)||void 0===O?void 0:O.fk_rollup_column_id)&&t.push(e.colOptions.fk_rollup_column_id),null===(I=e.colOptions)||void 0===I?void 0:I.formula){const a=null===(C=e.colOptions)||void 0===C?void 0:C.formula.match(/(?<=\{\{).*?(?=\}\})/gm);a&&a.length>0&&t.push(...e.colOptions.formula.match(/(?<=\{\{).*?(?=\}\})/gm))}let a;(null===(A=e.colOptions)||void 0===A?void 0:A.fk_qr_value_column_id)&&t.push(e.colOptions.fk_qr_value_column_id),(null===(D=e.colOptions)||void 0===D?void 0:D.fk_barcode_value_column_id)&&t.push(e.colOptions.fk_barcode_value_column_id);for(let e=G.length-1;e>=0;e--)if(t.includes(G[e].id)){a=G[e];break}a?G.splice(G.indexOf(a)+1,0,e):G.unshift(e)}for(const a of G){const{colOptions:i}=a,s=k(a,["colOptions"]);if(a.uidt===M.UITypes.Lookup){if(!U(i.fk_relation_column_id))continue;const r=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{fk_lookup_column_id:U(i.fk_lookup_column_id),fk_relation_column_id:U(i.fk_relation_column_id)})),req:t.req,user:t.user});for(const e of r.columns)if(e.title===a.title){P.set(a.id,e.id);break}}else if(a.uidt===M.UITypes.Rollup){if(!U(i.fk_relation_column_id))continue;const r=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{fk_rollup_column_id:U(i.fk_rollup_column_id),fk_relation_column_id:U(i.fk_relation_column_id),rollup_function:i.rollup_function})),req:t.req,user:t.user});for(const e of r.columns)if(e.title===a.title){P.set(a.id,e.id);break}}else if(a.uidt===M.UITypes.Formula){const r=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{formula_raw:i.formula_raw})),req:t.req,user:t.user});for(const e of r.columns)if(e.title===a.title){P.set(a.id,e.id);break}}else if(a.uidt===M.UITypes.Button){const r=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{formula_raw:null==i?void 0:i.formula_raw,label:null==i?void 0:i.label,color:null==i?void 0:i.color,theme:null==i?void 0:i.theme,icon:null==i?void 0:i.icon,type:null==i?void 0:i.type,fk_webhook_id:U(null==i?void 0:i.fk_webhook_id)})),req:t.req,user:t.user});for(const e of r.columns)if(e.title===a.title){P.set(a.id,e.id);break}}else if(a.uidt===M.UITypes.CreatedTime||a.uidt===M.UITypes.LastModifiedTime||a.uidt===M.UITypes.CreatedBy||a.uidt===M.UITypes.LastModifiedBy){if(a.system)continue;const i=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{column_name:"system",system:!1})),req:t.req,user:t.user});for(const e of i.columns)if(e.title===a.title){P.set(a.id,e.id);break}}else if(a.uidt===M.UITypes.QrCode){const r=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{fk_qr_value_column_id:U(i.fk_qr_value_column_id)})),req:t.req,user:t.user});for(const e of r.columns)if(e.title===a.title){P.set(a.id,e.id);break}}else if(a.uidt===M.UITypes.Barcode){s.validate=null;const r=await this.columnsService.columnAdd(e,{tableId:U((0,R.getParentIdentifier)(a.id)),column:(0,R.withoutId)(Object.assign(Object.assign({},s),{fk_barcode_value_column_id:U(i.fk_barcode_value_column_id)})),req:t.req,user:t.user});for(const e of r.columns)if(e.title===a.title){P.set(a.id,e.id);break}}}(0,E.elapsedTime)(j,"create referenced columns","importModels");for(const a of t.data){if(t.existingModel)break;const i=a.model,s=a.views,r=B.get(i.id);await r.getViews(e);for(const a of s){const i=(0,R.withoutId)(Object.assign({},a)),s=await this.createView(e,P,r,i,r.views,t.user,t.req);if(!s)continue;P.set(a.id,s.id);const l=a.filter.children;for(const a of l){const i=await this.filtersService.filterCreate(e,{viewId:s.id,filter:(0,R.withoutId)(Object.assign(Object.assign({},a),{fk_parent_column_id:U(a.fk_parent_column_id),fk_column_id:U(a.fk_column_id),fk_parent_id:U(a.fk_parent_id)})),user:t.user,req:t.req});P.set(a.id,i.id)}for(const i of a.sorts)await this.sortsService.sortCreate(e,{viewId:s.id,sort:(0,R.withoutId)(Object.assign(Object.assign({},i),{fk_column_id:U(i.fk_column_id)})),req:t.req});const c=await this.viewColumnsService.columnList(e,{viewId:s.id});for(const i of c){const r=a.columns.find((e=>e.fk_column_id===(0,R.reverseGet)(P,i.fk_column_id)));if(!r)continue;const l=s.type===M.ViewTypes.CALENDAR?{bold:r.bold,italic:r.italic,underline:r.underline}:{};await this.viewColumnsService.columnUpdate(e,{viewId:s.id,columnId:i.id,column:Object.assign({show:r.show,order:r.order},l),req:t.req})}switch(s.type){case M.ViewTypes.GRID:for(const i of c){const s=a.columns.find((e=>e.fk_column_id===(0,R.reverseGet)(P,i.fk_column_id)));if(!s)continue;const{fk_column_id:r}=s,l=k(s,["fk_column_id"]);await this.gridColumnsService.gridColumnUpdate(e,{gridViewColumnId:i.id,grid:Object.assign({},(0,R.withoutNull)(l)),req:t.req})}break;case M.ViewTypes.FORM:for(const i of c){const s=a.columns.find((e=>e.fk_column_id===(0,R.reverseGet)(P,i.fk_column_id)));if(!s)continue;const{fk_column_id:r}=s,l=k(s,["fk_column_id"]);await this.formColumnsService.columnUpdate(e,{formViewColumnId:i.id,formViewColumn:Object.assign({},(0,R.withoutNull)(l)),req:t.req})}case M.ViewTypes.GALLERY:case M.ViewTypes.KANBAN:case M.ViewTypes.CALENDAR:}a.order!==s.order&&await this.viewsService.viewUpdate(e,{viewId:s.id,view:{order:a.order},user:t.user,req:t.req})}}(0,E.elapsedTime)(j,"create views","importModels");for(const a of t.data){if(t.existingModel)break;if(!(null==a?void 0:a.hooks))break;const i=a.hooks;for(const a of i){const{filters:i}=a;for(const s of i){const i=await this.filtersService.hookFilterCreate(e,{hookId:U(a.id),filter:(0,R.withoutId)(Object.assign(Object.assign({},s),{fk_column_id:U(s.fk_column_id),fk_parent_id:U(s.fk_parent_id)})),user:t.user,req:t.req});P.set(s.id,i.id)}}}(0,E.elapsedTime)(j,"create hooks","importModels");for(const e of H)await e();return(0,E.elapsedTime)(j,"create link filters","importModels"),P}async createView(e,t,a,i,s,r,l){if(i.is_default){const t=s.find((e=>e.is_default));if(t){const a=(0,R.withoutNull)(i.view);a&&await this.gridsService.gridViewUpdate(e,{viewId:t.id,grid:a,req:l})}return t}switch(i.type){case M.ViewTypes.GRID:{const t=await this.gridsService.gridViewCreate(e,{tableId:a.id,grid:i,req:l}),s=(0,R.withoutNull)(i.view);return s&&await this.gridsService.gridViewUpdate(e,{viewId:t.id,grid:s,req:l}),t}case M.ViewTypes.FORM:{const t=await this.formsService.formViewCreate(e,{tableId:a.id,body:i,user:r,req:l}),s=(0,R.withoutNull)(i.view);return s&&await this.formsService.formViewUpdate(e,{formViewId:t.id,form:s,req:l}),t}case M.ViewTypes.CALENDAR:return await this.calendarsService.calendarViewCreate(e,{tableId:a.id,calendar:Object.assign(Object.assign({},i),{calendar_range:i.view.calendar_range.map((e=>({fk_from_column_id:t.get(e.fk_from_column_id),fk_to_column_id:t.get(e.fk_to_column_id)})))}),user:r,req:l});case M.ViewTypes.GALLERY:{const s=await this.galleriesService.galleryViewCreate(e,{tableId:a.id,gallery:i,user:r,req:l}),c=(0,R.withoutNull)(i.view);if(c){for(const[e,a]of Object.entries(c))if("fk_cover_image_col_id"===e)c[e]=t.get(a);await this.galleriesService.galleryViewUpdate(e,{galleryViewId:s.id,gallery:c,req:l})}return s}case M.ViewTypes.KANBAN:{const s=await this.kanbansService.kanbanViewCreate(e,{tableId:a.id,kanban:i,user:r,req:l}),c=(0,R.withoutNull)(i.view);if(c){const i=await L.Column.get(e,{source_id:a.source_id,colId:t.get(c.fk_grp_col_id)});for(const[e,a]of Object.entries(c))switch(e){case"fk_grp_col_id":case"fk_cover_image_col_id":c[e]=t.get(a);break;case"meta":{const s={};for(const[e,r]of Object.entries(a)){if(!Array.isArray(r)){s[e]=r;continue}const a=[];for(const e of r)if(e.fk_column_id){const s=i.colOptions.options.find((t=>t.title===e.title)).id;a.push(Object.assign(Object.assign({},e),{fk_column_id:t.get(e.fk_column_id),id:s}))}else delete e.fk_column_id,a.push(Object.assign(Object.assign({},e),{id:"uncategorized"}));s[t.get(e)]=a}c[e]=s;break}}await this.kanbansService.kanbanViewUpdate(e,{kanbanViewId:s.id,kanban:c,req:l})}return s}}return null}async importBase(e,t){const a=(0,E.initTime)(),{user:i,baseId:s,sourceId:r,src:l,req:c}=t,d=await L.Base.get(e,s),u=await L.Source.get(e,r);if(!d)return N.NcError.baseNotFound(s);if(!u)return N.NcError.sourceNotFound(r);switch(l.type){case"local":{const t=l.path.replace(/\/$/,""),p=await z.default.storageAdapter();try{const l=JSON.parse(await p.fileRead(`${t}/schema.json`));(0,E.elapsedTime)(a,"read schema from file","importBase");let m=[];const _=await this.importModels(e,{user:i,baseId:s,sourceId:r,data:l,req:c});if((0,E.elapsedTime)(a,"import models schema","importBase"),_){const i=(await p.getDirectoryList(`${t}/data`)).filter((e=>!e.match(/links\.csv$/))),s=`${t}/data/links.csv`;for(const s of i){const i=await p.fileReadByStream(`${t}/data/${s}`),r=(0,R.findWithIdentifier)(_,s.replace(/\.csv$/,"")),l=await L.Model.get(e,r);this.debugLog(`Importing ${l.title}...`),await this.importDataFromCsvStream(e,{idMap:_,dataStream:i,destProject:d,destBase:u,destModel:l,req:c}),(0,E.elapsedTime)(a,`import data for ${l.title}`,"importBase")}(0,E.elapsedTime)(a);const r=await p.fileReadByStream(s);m=await this.importLinkFromCsvStream(e,{idMap:_,linkStream:r,destProject:d,destBase:u,handledLinks:m}),(0,E.elapsedTime)(a,"import links","importBase")}}catch(e){throw new Error(e)}break}}}importDataFromCsvStream(e,t){const{idMap:a,dataStream:i,destBase:s,destProject:r,destModel:l,req:c}=t,d=[];let u=[];return new Promise((t=>{I.default.parse(i,{newline:"\r\n",step:async(t,i)=>{var p,m,_;if(d.length){if(0===t.errors.length){const a={};for(let e=0;e<d.length;e++)d[e]&&""!==t.data[e]&&(a[d[e]]=t.data[e]);if(u.push(a),u.length>1e3){i.pause();try{await this.bulkDataService.bulkDataInsert(e,{baseName:r.id,tableName:l.id,body:u,cookie:c,chunkSize:u.length+1,foreign_key_checks:!!s.isMeta(),raw:!0})}catch(e){this.logger.error(e)}u=[],i.resume()}}}else{i.pause();for(const i of t.data){const t=a.get(i);if(t){const a=await L.Column.get(e,{source_id:s.id,colId:t});if(a)if((null===(p=a.colOptions)||void 0===p?void 0:p.type)===M.RelationTypes.BELONGS_TO||(null===(m=a.colOptions)||void 0===m?void 0:m.type)===M.RelationTypes.ONE_TO_ONE&&(null===(_=a.meta)||void 0===_?void 0:_.bt)){const t=await L.Column.get(e,{source_id:s.id,colId:a.colOptions.fk_child_column_id});t?d.push(t.column_name):(d.push(null),this.debugLog(`child column not found (${a.colOptions.fk_child_column_id})`))}else d.push(a.column_name);else d.push(null),this.debugLog(`column not found (${t})`)}else d.push(null),this.debugLog(`id not found (${i})`)}i.resume()}},complete:async()=>{if(u.length>0){try{await this.bulkDataService.bulkDataInsert(e,{baseName:r.id,tableName:l.id,body:u,cookie:c,chunkSize:u.length+1,foreign_key_checks:!!s.isMeta(),raw:!0})}catch(e){this.logger.error(e)}u=[]}t(null)}})}))}async importLinkFromCsvStream(e,t){const{idMap:a,linkStream:i,destBase:s,destProject:r,handledLinks:l}=t,c={},d=async()=>{for(const[t,a]of Object.entries(c))try{if(0===a.length)continue;await this.bulkDataService.bulkDataInsert(e,{baseName:r.id,tableName:t,body:a,cookie:null,chunkSize:1e3,foreign_key_checks:!!s.isMeta(),raw:!0}),c[t]=[]}catch(e){this.logger.error(e)}};let u=!1,p=-1,m=-1,_=-1;const f={},h={};return new Promise((t=>{I.default.parse(i,{newline:"\r\n",step:async(t,i)=>{if(u){if(0===t.errors.length){const r=t.data[p],u=t.data[m],g=t.data[_];if(r&&u&&g)if(f[g]){const e=f[g].colOptions.fk_mm_model_id,t=h[e];c[e].push({[t.parent]:u,[t.child]:r})}else{i.pause(),await d();const t=await L.Column.get(e,{source_id:s.id,colId:(0,R.findWithIdentifier)(a,g)});if(t){const a=await t.getColOptions(e),i=await a.getMMChildColumn(e),s=await a.getMMParentColumn(e);h[t.colOptions.fk_mm_model_id]={parent:s.column_name,child:i.column_name},f[g]=t,l.push(t.colOptions.fk_mm_model_id);const d=t.colOptions.fk_mm_model_id;c[d]=[];const p=h[d];c[d].push({[p.parent]:u,[p.child]:r})}else this.debugLog(`column not found (${g})`);i.resume()}}}else{for(const[e,a]of Object.entries(t.data))"child"===a?p=parseInt(e):"parent"===a?m=parseInt(e):"column"===a&&(_=parseInt(e));u=!0}},complete:async()=>{await d(),t(l)}})}))}};t.ImportService=X,t.ImportService=X=i=v([(0,O.Injectable)(),T("design:paramtypes",["function"==typeof(s=void 0!==A.TablesService&&A.TablesService)?s:Object,"function"==typeof(r=void 0!==D.ColumnsService&&D.ColumnsService)?r:Object,"function"==typeof(l=void 0!==j.FiltersService&&j.FiltersService)?l:Object,"function"==typeof(c=void 0!==P.SortsService&&P.SortsService)?c:Object,"function"==typeof(d=void 0!==q.ViewColumnsService&&q.ViewColumnsService)?d:Object,"function"==typeof(u=void 0!==U.GridColumnsService&&U.GridColumnsService)?u:Object,"function"==typeof(p=void 0!==$.FormColumnsService&&$.FormColumnsService)?p:Object,"function"==typeof(m=void 0!==Y.GridsService&&Y.GridsService)?m:Object,"function"==typeof(_=void 0!==B.FormsService&&B.FormsService)?_:Object,"function"==typeof(f=void 0!==V.GalleriesService&&V.GalleriesService)?f:Object,"function"==typeof(h=void 0!==F.CalendarsService&&F.CalendarsService)?h:Object,"function"==typeof(g=void 0!==H.KanbansService&&H.KanbansService)?g:Object,"function"==typeof(y=void 0!==J.BulkDataAliasService&&J.BulkDataAliasService)?y:Object,"function"==typeof(b=void 0!==G.HooksService&&G.HooksService)?b:Object,"function"==typeof(w=void 0!==W.ViewsService&&W.ViewsService)?w:Object])],X)},26144:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsLogService=void 0;const l=a(23324),c=a(40628),d=a(81472);let u=class JobsLogService{constructor(e){this.eventEmitter=e}sendLog(e,t){this.eventEmitter.emit(d.JobEvents.LOG,{id:e.id.toString(),data:t})}};t.JobsLogService=u,t.JobsLogService=u=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==c.EventEmitter2&&c.EventEmitter2)?i:Object])],u)},62220:function(e,t,a){"use strict";var i,s,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaSyncController=void 0;const m=a(23324),_=a(23668),f=a(47932),h=a(43820),g=a(81472),y=a(67240),b=a(892),w=a(26212),v=a(48967);let T=class MetaSyncController{constructor(e){this.jobsService=e}async metaDiffSync(e,t,a){(await this.jobsService.jobList()).find((e=>e.name===g.JobTypes.MetaSync&&e.data.baseId===t))&&h.NcError.badRequest("Meta sync already in progress for this base");return{id:(await this.jobsService.add(g.JobTypes.MetaSync,{context:e,baseId:t,sourceId:"all",user:a.user,req:{user:a.user,clientIp:a.clientIp,headers:a.headers}})).id}}async baseMetaDiffSync(e,t,a,i){(await this.jobsService.jobList()).find((e=>e.name===g.JobTypes.MetaSync&&e.data.baseId===t&&(e.data.baseId===t||"all"===e.data.baseId)))&&h.NcError.badRequest("Meta sync already in progress for this base");return{id:(await this.jobsService.add(g.JobTypes.MetaSync,{context:e,baseId:t,sourceId:a,user:i.user,req:{user:i.user,clientIp:i.clientIp,headers:i.headers}})).id}}};t.MetaSyncController=T,d([(0,m.Post)(["/api/v1/db/meta/projects/:baseId/meta-diff","/api/v2/meta/bases/:baseId/meta-diff"]),(0,m.HttpCode)(200),(0,f.Acl)("metaDiffSync"),p(0,(0,w.TenantContext)()),p(1,(0,m.Param)("baseId")),p(2,(0,m.Req)()),u("design:type",Function),u("design:paramtypes",["function"==typeof(s=void 0!==v.NcContext&&v.NcContext)?s:Object,String,"function"==typeof(r=void 0!==v.NcRequest&&v.NcRequest)?r:Object]),u("design:returntype",Promise)],T.prototype,"metaDiffSync",null),d([(0,m.Post)(["/api/v1/db/meta/projects/:baseId/meta-diff/:sourceId","/api/v2/meta/bases/:baseId/meta-diff/:sourceId"]),(0,m.HttpCode)(200),(0,f.Acl)("baseMetaDiffSync"),p(0,(0,w.TenantContext)()),p(1,(0,m.Param)("baseId")),p(2,(0,m.Param)("sourceId")),p(3,(0,m.Req)()),u("design:type",Function),u("design:paramtypes",["function"==typeof(l=void 0!==v.NcContext&&v.NcContext)?l:Object,String,String,"function"==typeof(c=void 0!==v.NcRequest&&v.NcRequest)?c:Object]),u("design:returntype",Promise)],T.prototype,"baseMetaDiffSync",null),t.MetaSyncController=T=d([(0,m.Controller)(),(0,m.UseGuards)(y.MetaApiLimiterGuard,_.GlobalGuard),p(0,(0,m.Inject)("JobsService")),u("design:paramtypes",["function"==typeof(i=void 0!==b.IJobsService&&b.IJobsService)?i:Object])],T)},70008:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaSyncProcessor=void 0;const c=l(a(89576)),d=a(23324),u=a(69484);let p=class MetaSyncProcessor{constructor(e){this.metaDiffsService=e,this.debugLog=(0,c.default)("nc:jobs:meta-sync")}async job(e){this.debugLog(`job started for ${e.id}`);const t=e.data,a=t.context,i=a.base_id;"all"===t.sourceId?await this.metaDiffsService.metaDiffSync(a,{baseId:i,req:t.req}):await this.metaDiffsService.baseMetaDiffSync(a,{baseId:i,sourceId:t.sourceId,req:t.req}),this.debugLog(`job completed for ${e.id}`)}};t.MetaSyncProcessor=p,t.MetaSyncProcessor=p=s([(0,d.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.MetaDiffsService&&u.MetaDiffsService)?i:Object])],p)},61304:function(e,t,a){"use strict";var i,s,r,l,c=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceCreateController=void 0;const p=a(23324),m=a(71040),_=a(23668),f=a(47932),h=a(43820),g=a(81472),y=a(67240),b=a(892),w=a(26212),v=a(48967);let T=class SourceCreateController{constructor(e){this.jobsService=e}async baseCreate(e,t,a,i){(await this.jobsService.jobList()).find((e=>e.name===g.JobTypes.SourceCreate&&e.data.baseId===t))&&h.NcError.badRequest("Another source creation is in progress for this base.");return{id:(await this.jobsService.add(g.JobTypes.SourceCreate,{context:e,user:i.user,baseId:t,source:a,req:{user:i.user,clientIp:i.clientIp,headers:i.headers}})).id}}};t.SourceCreateController=T,c([(0,p.Post)(["/api/v1/db/meta/projects/:baseId/bases","/api/v2/meta/bases/:baseId/sources"]),(0,p.HttpCode)(200),(0,f.Acl)("sourceCreate"),u(0,(0,w.TenantContext)()),u(1,(0,p.Param)("baseId")),u(2,(0,p.Body)()),u(3,(0,p.Req)()),d("design:type",Function),d("design:paramtypes",["function"==typeof(s=void 0!==v.NcContext&&v.NcContext)?s:Object,String,"function"==typeof(r=void 0!==m.BaseReqType&&m.BaseReqType)?r:Object,"function"==typeof(l=void 0!==v.NcRequest&&v.NcRequest)?l:Object]),d("design:returntype",Promise)],T.prototype,"baseCreate",null),t.SourceCreateController=T=c([(0,p.Controller)(),(0,p.UseGuards)(y.MetaApiLimiterGuard,_.GlobalGuard),u(0,(0,p.Inject)("JobsService")),d("design:paramtypes",["function"==typeof(i=void 0!==b.IJobsService&&b.IJobsService)?i:Object])],T)},71648:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceCreateProcessor=void 0;const d=c(a(89576)),u=a(23324),p=a(92900),m=a(26144);let _=class SourceCreateProcessor{constructor(e,t){this.sourcesService=e,this.jobsLogService=t,this.debugLog=(0,d.default)("nc:jobs:source-create")}async job(e){this.debugLog(`job started for ${e.id}`);const{context:t,baseId:a,source:i,req:s}=e.data,{source:r,error:l}=await this.sourcesService.baseCreate(t,{baseId:a,source:i,logger:t=>{this.jobsLogService.sendLog(e,{message:t}),this.debugLog(t)},req:s});if(l)throw await this.sourcesService.baseDelete(t,{sourceId:r.id,req:{}}),l;r.isMeta()&&delete r.config,this.debugLog(`job completed for ${e.id}`)}};t.SourceCreateProcessor=_,t.SourceCreateProcessor=_=r([(0,u.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==p.SourcesService&&p.SourcesService)?i:Object,"function"==typeof(s=void 0!==m.JobsLogService&&m.JobsLogService)?s:Object])],_)},67752:function(e,t,a){"use strict";var i,s,r,l,c=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceDeleteController=void 0;const p=a(23324),m=a(23668),_=a(47932),f=a(43820),h=a(81472),g=a(92900),y=a(67240),b=a(892),w=a(26212),v=a(48967);let T=class SourceDeleteController{constructor(e,t){this.jobsService=e,this.sourcesService=t}async baseDelete(e,t,a){(await this.jobsService.jobList()).find((e=>e.name===h.JobTypes.SourceDelete&&e.data.sourceId===t))&&f.NcError.badRequest("There is already a job running to delete this base."),await this.sourcesService.baseSoftDelete(e,{sourceId:t});return{id:(await this.jobsService.add(h.JobTypes.SourceDelete,{context:e,user:a.user,sourceId:t,req:{user:a.user,clientIp:a.clientIp,headers:a.headers}})).id}}};t.SourceDeleteController=T,c([(0,p.Delete)(["/api/v1/db/meta/projects/:baseId/bases/:sourceId","/api/v2/meta/bases/:baseId/sources/:sourceId"]),(0,_.Acl)("baseDelete"),u(0,(0,w.TenantContext)()),u(1,(0,p.Param)("sourceId")),u(2,(0,p.Req)()),d("design:type",Function),d("design:paramtypes",["function"==typeof(r=void 0!==v.NcContext&&v.NcContext)?r:Object,String,"function"==typeof(l=void 0!==v.NcRequest&&v.NcRequest)?l:Object]),d("design:returntype",Promise)],T.prototype,"baseDelete",null),t.SourceDeleteController=T=c([(0,p.Controller)(),(0,p.UseGuards)(y.MetaApiLimiterGuard,m.GlobalGuard),u(0,(0,p.Inject)("JobsService")),d("design:paramtypes",["function"==typeof(i=void 0!==b.IJobsService&&b.IJobsService)?i:Object,"function"==typeof(s=void 0!==g.SourcesService&&g.SourcesService)?s:Object])],T)},95208:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceDeleteProcessor=void 0;const c=l(a(89576)),d=a(23324),u=a(92900);let p=class SourceDeleteProcessor{constructor(e){this.sourcesService=e,this.debugLog=(0,c.default)("nc:jobs:source-delete")}async job(e){this.debugLog(`job started for ${e.id}`);const{context:t,sourceId:a,req:i}=e.data;await this.sourcesService.baseDelete(t,{sourceId:a,req:i}),this.debugLog(`job completed for ${e.id}`)}};t.SourceDeleteProcessor=p,t.SourceDeleteProcessor=p=s([(0,d.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.SourcesService&&u.SourcesService)?i:Object])],p)},52628:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailGeneratorProcessor=void 0;const s=i(a(67072)),r=a(48378),l=a(23324),c=i(a(92696)),d=i(a(23080)),u=a(19176),p=i(a(76584));class ThumbnailGeneratorProcessor{constructor(){this.logger=new l.Logger(ThumbnailGeneratorProcessor.name)}async job(e){var t;const{attachments:a}=e.data,i=[];for(const e of a){const a=await this.generateThumbnail(e);a&&i.push({path:null!==(t=e.path)&&void 0!==t?t:e.url,card_cover:null==a?void 0:a.card_cover,small:null==a?void 0:a.small,tiny:null==a?void 0:a.tiny})}return i}async generateThumbnail(e){var t;const a=p.default.sharp;if(!a)return null;a.concurrency(1);try{const t=await d.default.storageAdapter(),{file:i,relativePath:l}=await this.getFileData(e,t),u={card_cover:s.default.join("nc","thumbnails",l,"card_cover.jpg"),small:s.default.join("nc","thumbnails",l,"small.jpg"),tiny:s.default.join("nc","thumbnails",l,"tiny.jpg")},p=a(i,{limitInputPixels:!1});for(const[e,i]of Object.entries(u)){let s;switch(e){case"card_cover":s=512;break;case"small":s=128;break;case"tiny":s=64;break;default:s=32}const l=await p.resize(void 0,s,{fit:a.fit.cover,kernel:"lanczos3"}).toBuffer();await t.fileCreateByStream((0,c.default)(i),r.Readable.from(l),{mimetype:"image/jpeg"})}return u}catch(a){return this.logger.error({message:`Failed to generate thumbnails for ${null!==(t=e.path)&&void 0!==t?t:e.url}`,error:null==a?void 0:a.message}),null}}async getFileData(e,t){let a;e.path?a=s.default.join("nc","uploads",e.path.replace(/^download[/\\]/i,"")):e.url&&(a=(0,u.getPathFromUrl)(e.url).replace(/^\/+/,""));const i=await t.fileRead(a);return a=a.replace(/^.*?nc[/\\]uploads[/\\]/,""),{file:i,relativePath:a}}}t.ThumbnailGeneratorProcessor=ThumbnailGeneratorProcessor},36428:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebhookHandlerProcessor=void 0;const i=a(23324),s=a(14836),r=a(19684);class WebhookHandlerProcessor{constructor(){this.logger=new i.Logger(WebhookHandlerProcessor.name)}async job(e){const{context:t,hookId:a,modelId:i,viewId:l,prevData:c,newData:d,user:u}=e.data,p=await r.Hook.get(t,a);if(!p)return void this.logger.error(`Hook not found for id: ${a}`);const m=await r.Model.get(t,i);if(!m)return void this.logger.error(`Model not found for id: ${i}`);const _=l?await r.View.get(t,l):null;await(0,s.invokeWebhook)(t,{hook:p,model:m,view:_,prevData:c,newData:d,user:u})}}t.WebhookHandlerProcessor=WebhookHandlerProcessor},47304:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitMigrationJobs=void 0;const p=u(a(89576)),m=a(23324),_=a(81472),f=a(892),h=a(31760),g=a(8311),y=a(1512);let b=class InitMigrationJobs{constructor(e,t,a){this.jobsService=e,this.attachmentMigration=t,this.thumbnailMigration=a,this.migrationJobsList=[{version:"1",job:_.MigrationJobTypes.Attachment,service:this.attachmentMigration},{version:"2",job:_.MigrationJobTypes.Thumbnail,service:this.thumbnailMigration}],this.debugLog=(0,p.default)("nc:migration-jobs:init"),this.log=(...e)=>{console.log("[init-migration-jobs]: ",...e)}}async job(e){this.debugLog(`job started for ${e.id}`);const t=await(0,y.getMigrationJobsState)();if(t.locked&&Date.now()-t.stall_check>6e5&&(t.locked=!1,t.stall_check=Date.now(),await(0,y.updateMigrationJobsState)(t)),t.locked){if(t.instance===y.instanceUuid)return;return void setTimeout((()=>{this.jobsService.add(_.JobTypes.InitMigrationJobs,{})}),6e5)}const a=this.migrationJobsList.filter((e=>+e.version>+t.version));if(!a.length)return;t.locked=!0,t.stall_check=Date.now(),await(0,y.updateMigrationJobsState)(t,t),await new Promise((e=>setTimeout(e,5e3)));const i=await(0,y.getMigrationJobsState)();if(i.locked&&i.instance===y.instanceUuid){const e=a[0];try{const a=(0,y.setMigrationJobsStallInterval)(),i=await e.service.job();i?(t.version=e.version,t.locked=!1,t.stall_check=Date.now()):(t.locked=!1,t.stall_check=Date.now()),await(0,y.updateMigrationJobsState)(t),clearInterval(a),i?await this.jobsService.add(_.JobTypes.InitMigrationJobs,{}):this.log("A migration job failed!")}catch(e){this.log("Error running migration: ",e)}}this.debugLog(`job completed for ${e.id}`)}};t.InitMigrationJobs=b,t.InitMigrationJobs=b=l([(0,m.Injectable)(),d(0,(0,m.Inject)((0,m.forwardRef)((()=>"JobsService")))),c("design:paramtypes",["function"==typeof(i=void 0!==f.IJobsService&&f.IJobsService)?i:Object,"function"==typeof(s=void 0!==h.AttachmentMigration&&h.AttachmentMigration)?s:Object,"function"==typeof(r=void 0!==g.ThumbnailMigration&&g.ThumbnailMigration)?r:Object])],b)},31760:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentMigration=void 0;const r=s(a(67072)),l=s(a(89576)),c=s(a(27216)),d=a(71040),u=a(23324),p=a(19684),m=s(a(23080)),_=s(a(76584)),f=a(64612),h=s(a(82096)),g=a(19684),y=a(70220),b=s(a(55420)),w=a(19176);let v=class AttachmentMigration{constructor(){this.debugLog=(0,l.default)("nc:migration-jobs:attachment"),this.log=(...e)=>{console.log("[nc_job_001_attachment]: ",...e)}}async job(){var e;try{const t=_.default.ncMeta,a="nc_temp_file_references",i="nc_temp_processed_models",s=await t.knexConnection.schema.hasTable(a),l=await t.knexConnection.schema.hasTable(i);s||await t.knexConnection.schema.createTable(a,(e=>{e.increments("id").primary(),e.text("file_path").notNullable(),e.string("mimetype"),e.boolean("referenced").defaultTo(!1),e.boolean("thumbnail_generated").defaultTo(!1),e.index("file_path")})),l||await t.knexConnection.schema.createTable(i,(e=>{e.increments("id").primary(),e.string("fk_model_id").notNullable(),e.integer("offset").defaultTo(0),e.boolean("completed").defaultTo(!1),e.index("fk_model_id")}));const u=await m.default.storageAdapter(t),v=u.name,T=await u.scanFiles("nc/uploads/**"),k=[],S=[];let M=0,O=null;T.on("data",(async e=>{if(k.push({file_path:e}),k.length>=100){T.pause();try{const e=k.splice(0,k.length);M+=e.length;const i=(await t.knexConnection(a).whereIn("file_path",e.map((e=>e.file_path)))).map((e=>e.file_path)),s=e.filter((e=>!i.includes(e.file_path)));s.length>0&&S.push(t.knexConnection(a).insert(s).catch((e=>{this.log("Error inserting file references"),this.log(e),O=e}))),this.log(`Scanned ${M} files`)}catch(e){this.log("There was an error while scanning files"),this.log(e),O=e}T.resume()}}));try{await new Promise(((e,t)=>{T.on("end",e),T.on("error",t)})),await Promise.all(S)}catch(e){throw this.log("There was an error while scanning files"),this.log(e),e}if(M+=k.length,this.log(`Completed scanning with ${M} files`),O)throw O;k.length>0&&await t.knexConnection(a).insert(k);let I=0;const C=async e=>{var s;const{fk_workspace_id:l,base_id:c,source_id:u,fk_model_id:m}=e,_={workspace_id:l,base_id:c},T=await p.Source.get(_,u);if(!T)return void this.log(`source not found for ${u}`);const k=!T.isMeta(),S=await g.Model.get(_,m);if(!S)return void this.log(`model not found for ${m}`);await S.getColumns(_);const M=S.columns.filter((e=>e.uidt===d.UITypes.Attachment)),O=await h.default.get(T);if(!O)return void this.log(`connection can't achieved for ${u}`);const I=await g.Model.getBaseModelSQL(_,{model:S,dbDriver:O});if(k)try{this.log(`Checking connection for ${u} (${T.alias})`),await Promise.race([I.execAndParse("SELECT 1",null,{raw:!0}),new Promise(((e,t)=>setTimeout((()=>t(new Error("timeout"))),1e4)))]),this.log(`External source ${u} (${T.alias}) is accessible`)}catch(e){throw this.log(`External source ${u} (${T.alias}) is not accessible`),e}const C=await t.knexConnection(i).where("fk_model_id",m).first();let E=0;C?E=C.offset:await t.knexConnection(i).insert({fk_model_id:m,offset:0});const x=await I.count();for(this.log(`Processing model "${S.title}" with ${x} records and ${M.length} attachment columns`);;){const e=await I.list({fieldsSet:new Set(S.primaryKeys.map((e=>e.title)).concat(M.map((e=>e.title)))),sort:S.primaryKeys.map((e=>e.title)),limit:50,offset:E},{ignoreViewFilterAndSort:!0});if(E+=50,!(null==e?void 0:e.length))break;const l=[];for(const i of e){const e={};let c=!1;for(const l of M){let d=i[l.title];if(null==d?void 0:d.length){try{"string"==typeof d&&(d=JSON.parse(d))}catch(e){this.log(`error parsing attachment data ${d}`);continue}if(Array.isArray(d)){d=d.map((e=>(0,y.extractProps)(e,["id","url","path","title","mimetype","size","icon","width","height"])));for(const e of d)try{if("path"in e||"url"in e){const i=`nc/uploads/${(null===(s=e.path)||void 0===s?void 0:s.replace(/^download\//,""))||(0,w.getPathFromUrl)(e.url,!0)}`,d=await t.knexConnection(a).where("file_path",i).first();if(d){if(!d.referenced){const s=r.default.basename(i),l=e.mimetype||b.default[r.default.extname(s).slice(1)];await t.knexConnection(a).where("file_path",i).update({mimetype:l,referenced:!0});await t.knexConnection(f.MetaTable.FILE_REFERENCES).where("file_url",e.path||e.url).andWhere("storage",v).first()||await p.FileReference.insert({workspace_id:f.RootScopes.ROOT,base_id:f.RootScopes.ROOT},{storage:v,file_url:e.path||e.url,file_size:e.size,deleted:!0})}}else this.log(`file not found in file references table ${e.path||e.url} | ${i} | ${S.fk_workspace_id} - ${S.base_id} - ${S.id}`);if("id"in e){await p.FileReference.get(_,e.id)||await p.FileReference.insert(_,{id:e.id,source_id:T.id,fk_model_id:m,fk_column_id:l.id,file_url:e.path||e.url,file_size:e.size,is_external:!T.isMeta(),deleted:!1})}else e.id=await p.FileReference.insert(_,{source_id:T.id,fk_model_id:m,fk_column_id:l.id,file_url:e.path||e.url,file_size:e.size,is_external:!T.isMeta(),deleted:!1}),c=!0}}catch(t){throw this.log(`Error processing attachment ${JSON.stringify(e)}`),this.log(t),t}}c&&(e[l.column_name]=JSON.stringify(d))}}if(0!==Object.keys(e).length){for(const t of S.primaryKeys)e[t.column_name]=i[t.title];l.push(e)}}if(l.length>0)for(const e of l){const t=await I._wherePk(I.extractPksValues(e));t?await I.execAndParse(I.dbDriver(I.tnPath).update(e).where(t),null,{raw:!0}):this.log(`where pk not found for ${e}`)}await t.knexConnection(i).where("fk_model_id",m).update({offset:E})}await t.knexConnection(i).where("fk_model_id",m).update({completed:!0})},E=[..._.default.isEE()?["fk_workspace_id"]:[],"base_id","source_id","fk_model_id"],x=null===(e=await t.knexConnection.from(t.knexConnection(f.MetaTable.COLUMNS).select(E).where("uidt",d.UITypes.Attachment).whereNotIn("fk_model_id",t.knexConnection(i).select("fk_model_id").where("completed",!0)).groupBy(E).as("t")).count("*",{as:"count"}).first())||void 0===e?void 0:e.count,L=new Set(["placeholder"]);let R=[{fk_model_id:"placeholder",processing:!0}];const N=2,A=new c.default({concurrency:N}),D=async e=>{try{await C(e),this.log(`Processed ${I} of ${x} models`)}catch(t){this.log(`Error processing model ${e.fk_model_id}`),this.log(t),L.add(e.fk_model_id)}finally{const t=R.find((t=>t.fk_model_id===e.fk_model_id));t&&(t.processing=!1),I+=1,this.log(`Processed ${I} of ${x} models`)}};for(;;){if(A.pending>N){await new Promise((e=>setTimeout(e,1e3)));continue}R=R.filter((e=>e.processing));const e=await t.knexConnection(f.MetaTable.COLUMNS).select(E).where("uidt",d.UITypes.Attachment).whereNotIn("fk_model_id",t.knexConnection(i).select("fk_model_id").where("completed",!0)).whereNotIn("fk_model_id",Array.from(L).map((e=>e)).concat(R.map((e=>e.fk_model_id)))).groupBy(E).limit(100);if(!(null==e?void 0:e.length))break;for(const t of e)R.push({fk_model_id:t.fk_model_id,processing:!0}),A.add((()=>D(t))).catch((e=>{this.log(`Error processing model ${t.fk_model_id}`),this.log(e),L.add(t.fk_model_id)}))}await A.onIdle(),this.log(`Processed total of ${x} models with attachments`)}catch(e){return this.log("There was an error while processing attachment migration job"),this.log(e),!1}return!0}};t.AttachmentMigration=v,t.AttachmentMigration=v=i([(0,u.Injectable)()],v)},8311:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailMigration=void 0;const c=l(a(67072)),d=l(a(89576)),u=a(23324),p=l(a(27216)),m=l(a(23080)),_=l(a(76584)),f=l(a(55420)),h=a(64612),g=a(52628),y=a(19176);let b=class ThumbnailMigration{constructor(e){this.thumbnailGeneratorProcessor=e,this.debugLog=(0,d.default)("nc:migration-jobs:attachment"),this.log=(...e)=>{console.log("[nc_job_002_thumbnail]: ",...e)}}async job(){var e;try{if(!_.default.sharp)return this.log("Thumbnail generation is not supported in this platform at the moment. Skipping thumbnail migration for now!"),!0;const t=_.default.ncMeta,a=await m.default.storageAdapter(t),i="nc_temp_file_references";if(!await t.knexConnection.schema.hasTable(i)){await t.knexConnection.schema.createTable(i,(e=>{e.increments("id").primary(),e.string("file_path").notNullable(),e.string("mimetype"),e.boolean("referenced").defaultTo(!1),e.boolean("thumbnail_generated").defaultTo(!1),e.index("file_path")}));const e=await a.scanFiles("nc/uploads/**"),s=[],r=[];let l=0,d=null;e.on("data",(async e=>{const a=c.default.basename(e),u=f.default[c.default.extname(a).slice(1)];if(s.push({file_path:e,mimetype:u,referenced:!0}),s.length>=100)try{const e=s.splice(0);l+=e.length;const a=(await t.knexConnection(i).whereIn("file_path",s.map((e=>e.file_path)))).map((e=>e.file_path)),c=e.filter((e=>!a.includes(e.file_path)));c.length>0&&r.push(t.knexConnection(i).insert(c).catch((e=>{this.log("Error inserting file references"),this.log(e),d=e}))),this.log(`Scanned ${l} files`)}catch(e){this.log("There was an error while scanning files"),this.log(e),d=e}}));try{await new Promise(((t,a)=>{e.on("end",t),e.on("error",a)})),await Promise.all(r)}catch(e){throw this.log("There was an error while scanning files"),this.log(e),e}if(l+=s.length,this.log(`Completed scanning with ${l} files`),d)throw d;s.length>0&&await t.knexConnection(i).insert(s)}const s=null===(e=await t.knexConnection(i).where("thumbnail_generated",!1).andWhere("referenced",!0).andWhere("mimetype","like","image/%").count("*",{as:"count"}).first())||void 0===e?void 0:e.count;let r=0;const l=10,d=1,u=[];let g=[];const b=new p.default({concurrency:d});this.log(`Starting thumbnail generation for ${s} images`);const w=async(e,a)=>{try{const s={};a?(s.url=e.file_path,s.mimetype=e.mimetype):(s.path=c.default.join("download",e.file_path.replace(/^nc\/uploads\//,"")),s.mimetype=e.mimetype);(await this.thumbnailGeneratorProcessor.job({data:{context:{base_id:h.RootScopes.ROOT,workspace_id:h.RootScopes.ROOT},attachments:[s]}})).length>0?await t.knexConnection(i).where("id",e.id).update({thumbnail_generated:!0}):(this.log(`Error generating thumbnail for file ${e.file_path}`),u.push(e.id))}catch(t){this.log(`Error generating thumbnail for file ${e.file_path}`),this.log(t),u.push(e.id)}finally{r+=1,this.log(`Processed ${r} out of ${s} images`);const t=g.find((t=>t.id===e.id));t&&(t.processed=!0)}};for(;;){if(b.pending>d){await new Promise((e=>setTimeout(e,1e3)));continue}g=g.filter((e=>!e.processed));const e=await t.knexConnection(i).whereNotIn("id",u.concat(g.map((e=>e.id)))).andWhere("thumbnail_generated",!1).andWhere("referenced",!0).andWhere("mimetype","like","image/%").limit(l);if(0===e.length)break;try{for(const s of e){let e;const r=/^https?:\/\//i.test(s.file_path);e=r?(0,y.getPathFromUrl)(s.file_path).replace(/^\/+/,""):s.file_path;const l=e.replace(/nc\/uploads/,"nc/thumbnails");try{const e=await a.getDirectoryList(l);["card_cover.jpg","small.jpg","tiny.jpg"].every((t=>e.includes(t)))&&(await t.knexConnection(i).where("file_path",s.file_path).update({thumbnail_generated:!0}),s.thumbnail_generated=!0)}catch(e){}s.thumbnail_generated||(g.push({id:s.id,processed:!1}),b.add((()=>w(s,r))))}}catch(e){this.log("error while generating thumbnail:",e)}}await b.onIdle()}catch(e){return this.log("There was an error while generating thumbnails for old attachments"),this.log(e),!1}return this.log("Thumbnail generation for old attachments completed successfully"),!0}};t.ThumbnailMigration=b,t.ThumbnailMigration=b=s([(0,u.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==g.ThumbnailGeneratorProcessor&&g.ThumbnailGeneratorProcessor)?i:Object])],b)},89604:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobsRedis=void 0;const i=a(23324),s=a(88228),r=a(81472);class JobsRedis{static async initJobs(){if(!s.PubSubRedis.initialized){if(!s.PubSubRedis.available)return;await s.PubSubRedis.init()}const e=async(e,t)=>{try{if(!t)return;const a=t.split(":"),i=a.shift();e===r.InstanceTypes.WORKER?this.workerCallbacks[i]&&await this.workerCallbacks[i](...a):e===r.InstanceTypes.PRIMARY&&this.primaryCallbacks[i]&&await this.primaryCallbacks[i](...a)}catch(e){this.logger.error({message:`Error processing redis pub-sub message ${t}`,error:{message:null==e?void 0:e.message,stack:null==e?void 0:e.stack}})}};"true"===process.env.NC_WORKER_CONTAINER?await s.PubSubRedis.subscribe(r.InstanceTypes.WORKER,(async t=>{await e(r.InstanceTypes.WORKER,t)})):await s.PubSubRedis.subscribe(r.InstanceTypes.PRIMARY,(async t=>{await e(r.InstanceTypes.PRIMARY,t)}))}static async workerCount(){if(!s.PubSubRedis.initialized){if(!s.PubSubRedis.available)return;await s.PubSubRedis.init(),await this.initJobs()}return new Promise((e=>{s.PubSubRedis.redisClient.publish(r.InstanceTypes.WORKER,"count",((t,a)=>{t?(this.logger.warn(t),e(0)):e(a)}))}))}static async emitWorkerCommand(e,...t){const a=`${e}${t.length?`:${t.join(":")}`:""}`;await s.PubSubRedis.publish(r.InstanceTypes.WORKER,a)}static async emitPrimaryCommand(e,...t){const a=`${e}${t.length?`:${t.join(":")}`:""}`;await s.PubSubRedis.publish(r.InstanceTypes.PRIMARY,a)}}t.JobsRedis=JobsRedis,JobsRedis.logger=new i.Logger(JobsRedis.name),JobsRedis.available=s.PubSubRedis.available,JobsRedis.primaryCallbacks={},JobsRedis.workerCallbacks={},JobsRedis.publish=s.PubSubRedis.publish,JobsRedis.subscribe=s.PubSubRedis.subscribe},14832:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsService=void 0;const d=a(42736),u=a(23324),p=a(80344),m=a(81472),_=a(89604),f=a(19684),h=a(64612);let g=i=class JobsService{constructor(e){this.jobsQueue=e,this.logger=new u.Logger(i.name)}async onModuleInit(){"false"===process.env.NC_WORKER_CONTAINER&&await this.jobsQueue.pause(!0),await this.toggleQueue(),_.JobsRedis.workerCallbacks[m.InstanceCommands.RESUME_LOCAL]=async()=>{this.logger.log("Resuming local queue"),await this.jobsQueue.resume(!0)},_.JobsRedis.workerCallbacks[m.InstanceCommands.PAUSE_LOCAL]=async()=>{this.logger.log("Pausing local queue"),await this.jobsQueue.pause(!0)},await this.add(m.JobTypes.InitMigrationJobs,{})}async toggleQueue(){if("true"!==process.env.NC_WORKER_CONTAINER&&"false"!==process.env.NC_WORKER_CONTAINER){const e=await _.JobsRedis.workerCount(),t=await this.jobsQueue.isPaused(!0);0===e&&t?await this.jobsQueue.resume(!0):e>0&&!t&&await this.jobsQueue.pause(!0)}}async add(e,t,a){var i;await this.toggleQueue();const s=Object.assign({workspace_id:h.RootScopes.ROOT,base_id:h.RootScopes.ROOT},(null==t?void 0:t.context)||{});let r;if(null==a?void 0:a.jobId){const e=await f.Job.get(s,a.jobId);e&&(r=e,e.status!==m.JobStatus.WAITING&&await f.Job.update(s,e.id,{status:m.JobStatus.WAITING}))}return r||(r=await f.Job.insert(s,{job:e,status:m.JobStatus.WAITING,fk_user_id:null===(i=null==t?void 0:t.user)||void 0===i?void 0:i.id})),t.jobName=e,(null===m.JobVersions||void 0===m.JobVersions?void 0:m.JobVersions[e])&&(t._jobVersion=m.JobVersions[e]),await this.jobsQueue.add(t,Object.assign({jobId:r.id},a)),r}async jobStatus(e){const t=await this.jobsQueue.getJob(e);if(t)return await t.getState()}async jobList(){return await this.jobsQueue.getJobs([m.JobStatus.ACTIVE,m.JobStatus.WAITING,m.JobStatus.DELAYED,m.JobStatus.PAUSED])}async resumeQueue(){this.logger.log("Resuming global queue"),await this.jobsQueue.resume()}async pauseQueue(){this.logger.log("Pausing global queue"),await this.jobsQueue.pause()}async emitWorkerCommand(e,...t){return _.JobsRedis.emitWorkerCommand(e,...t)}async emitPrimaryCommand(e,...t){return _.JobsRedis.emitPrimaryCommand(e,...t)}};t.JobsService=g,t.JobsService=g=i=r([(0,u.Injectable)(),c(0,(0,d.InjectQueue)(m.JOBS_QUEUE)),l("design:paramtypes",["function"==typeof(s=void 0!==p.Queue&&p.Queue)?s:Object])],g)},89096:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NocoModule=t.nocoModuleMetadata=void 0;const r=a(23324),l=a(17376),c=s(a(34552)),d=a(22120),u=a(5636),p=a(83884),m=a(76712),_=a(99236),f=a(93076),h=a(23668),g=a(52144),y=a(87424),b=a(83920),w=a(26972),v=a(57612),T=a(50628),k=a(12916),S=a(49804),M=a(65472),O=a(62828),I=a(66364),C=a(23976),E=a(60468),x=a(78792),L=a(84520),R=a(45996),N=a(48204),A=a(28924),D=a(74580),j=a(64228),P=a(31004),q=a(69860),U=a(28972),$=a(76020),Y=a(93052),B=a(78804),F=a(6660),V=a(56356),H=a(36536),G=a(37832),W=a(20640),z=a(64364),J=a(15420),K=a(22820),Q=a(83968),X=a(62084),Z=a(67404),ee=a(19844),te=a(65460),ae=a(5460),ie=a(19984),ne=a(84432),se=a(26580),oe=a(58504),re=a(15404),le=a(92900),ce=a(73548),de=a(10140),ue=a(74056),pe=a(80948),me=a(53311),_e=a(69200),fe=a(76383),he=a(48968),ge=a(75564),ye=a(98348),be=a(5348),we=a(86935),ve=a(54256),Te=a(69484),ke=a(80348),Se=a(83816),Me=a(20780),Oe=a(70935),Ie=a(81328),Ce=a(77060),Ee=a(40668),xe=a(10064),Le=a(96844),Re=a(50976),Ne=a(73560),Ae=a(69680),De=a(37156),je=a(38900),Pe=a(38040),qe=a(57116),Ue=a(84828),$e=a(54024),Ye=a(50264),Be=a(54268),Fe=a(41004),Ve=a(31188),He=a(44596),Ge=a(54596),We=a(35300),ze=a(40824),Je=a(77108),Ke=a(15132),Qe=a(45916),Xe=a(40404),Ze=a(67616),et=a(68144),tt=a(21388),at=a(84844),it=a(25040),nt=a(93680),st=a(50960),ot=a(26272),rt=a(15952),lt=a(6012),ct=a(40581),dt=a(22892),ut=a(33888),pt=a(70636),mt=a(34936),_t=a(47132);t.nocoModuleMetadata={imports:[d.EventEmitterModule,u.JobsModule,l.MulterModule.register({storage:c.default.diskStorage({}),limits:{fieldSize:k.NC_ATTACHMENT_FIELD_SIZE}})],controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[v.UsersController,M.ApiDocsController,O.ApiTokensController,..."true"===process.env.NC_SECURE_ATTACHMENTS?[C.AttachmentsSecureController]:[I.AttachmentsController],E.AuditsController,x.SourcesController,L.CachesController,R.CalendarsController,N.ColumnsController,A.CommentsController,D.FiltersController,j.FormColumnsController,P.FormsController,q.GalleriesController,U.GridColumnsController,$.GridsController,Y.HooksController,B.KanbansController,F.MapsController,V.MetaDiffsController,H.ModelVisibilitiesController,G.OrgLcenseController,W.OrgTokensController,z.OrgUsersController,J.PluginsController,Ue.BaseUsersController,K.BasesController,Q.PublicMetasController,ne.ViewsController,ie.ViewColumnsController,ae.UtilsController,te.TablesController,ee.SyncController,Z.SortsController,X.SharedBasesController,Be.NotificationsController,Ve.CommandPaletteController,Ge.ExtensionsController,ze.JobsMetaController,mt.IntegrationsController,Je.DataTableController,tt.DatasController,ut.CalendarDatasController,at.BulkDataAliasController,Qe.DataAliasController,nt.DataAliasNestedController,it.DataAliasExportController,st.OldDatasController,Ze.PublicDatasController,Xe.PublicDatasExportController]:[]],providers:[p.InitMetaServiceProvider,m.JwtStrategyProvider,h.GlobalGuard,f.SocketGateway,g.AppHooksService,b.AppHooksListenerService,y.TelemetryService,w.HookHandlerService,T.UsersService,qe.ApiDocsService,se.ApiTokensService,oe.AttachmentsService,re.AuditsService,le.SourcesService,ce.CachesService,de.CalendarsService,ue.ColumnsService,pe.CommentsService,me.FiltersService,_e.FormColumnsService,fe.FormsService,he.GalleriesService,ge.GridColumnsService,ye.GridsService,be.HooksService,we.KanbansService,ve.MapsService,Te.MetaDiffsService,ke.ModelVisibilitiesService,Se.OrgLcenseService,Me.OrgTokensEeService,Oe.OrgTokensService,Ie.OrgUsersService,Ce.PluginsService,$e.BaseUsersService,Ee.BasesService,xe.PublicMetasService,Pe.ViewsService,je.ViewColumnsService,De.UtilsService,Ae.TablesService,Ne.SyncService,Re.SortsService,Le.SharedBasesService,Ye.NotificationsService,Fe.CommandPaletteService,He.ExtensionsService,We.JobsMetaService,_t.IntegrationsService,Ke.DataTableService,et.DatasService,ot.BulkDataAliasService,rt.DataAliasNestedService,pt.CalendarDatasService,lt.OldDatasService,dt.PublicDatasService,ct.PublicDatasExportService],exports:[g.AppHooksService,y.TelemetryService,w.HookHandlerService,_.JwtStrategy,T.UsersService,S.MetaService,Ae.TablesService,ue.ColumnsService,me.FiltersService,Re.SortsService,Pe.ViewsService,je.ViewColumnsService,ye.GridsService,de.CalendarsService,ge.GridColumnsService,fe.FormsService,_e.FormColumnsService,he.GalleriesService,we.KanbansService,Ee.BasesService,oe.AttachmentsService,$e.BaseUsersService,be.HooksService,Te.MetaDiffsService,le.SourcesService,De.UtilsService,et.DatasService,ot.BulkDataAliasService]};let ft=class NocoModule{};t.NocoModule=ft,t.NocoModule=ft=i([(0,r.Module)(t.nocoModuleMetadata)],ft)},85188:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(2058)),r=a(50970),l=a(48378),c=i(a(67072)),d=i(a(71178)),u=a(1384),p=a(94760),m=a(20500),_=a(21816),f=a(84988);t.default=class GenericS3{constructor(e){this.input=e}get defaultParams(){return{Bucket:this.input.bucket}}async init(){}patchKey(e){return e}async test(){try{const e=(0,f.generateTempFilePath)(),t=s.default.createWriteStream(e);return await(0,f.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,r.promisify)(s.default.unlink)(e),!0}catch(e){throw e}}async fileRead(e){const t=new p.GetObjectCommand({Key:this.patchKey(e),Bucket:this.input.bucket}),{Body:a}=await this.s3Client.send(t),i=a;return new Promise(((e,t)=>{const a=[];i.on("data",(e=>{a.push(e)})),i.on("end",(()=>{const t=Buffer.concat(a);e(t)})),i.on("error",(e=>{t(e)}))}))}async fileCreate(e,t){const a=s.default.createReadStream(t.path);return this.fileCreateByStream(e,a,{mimetype:null==t?void 0:t.mimetype})}async fileCreateByStream(e,t,a){try{const i=new Promise(((e,a)=>{t.on("error",(e=>{a(e)}))})),s=Object.assign(Object.assign({},this.defaultParams),{Body:t,Key:e,ContentType:(null==a?void 0:a.mimetype)||"application/octet-stream"}),r=this.upload(s);return await Promise.race([r,i])}catch(e){throw e}}async fileCreateByUrl(e,t,{fetchOptions:{buffer:a}={buffer:!1}}){try{const i=await d.default.get(t,{httpAgent:(0,u.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,u.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),responseType:a?"arraybuffer":"stream"}),s=Object.assign(Object.assign({},this.defaultParams),{Body:i.data,Key:e,ContentType:i.headers["content-type"]});return{url:await this.upload(s),data:i.data}}catch(e){throw e}}async getSignedUrl(e,t=7200,a){const i=new p.GetObjectCommand(Object.assign({Key:this.patchKey(e),Bucket:this.input.bucket},a));return(0,m.getSignedUrl)(this.s3Client,i,{expiresIn:t})}async upload(e){try{const t=new _.Upload({client:this.s3Client,params:Object.assign({ACL:"public-read"},e)});return(await t.done()).Location}catch(e){throw console.error("Error uploading file",e),e}}fileReadByStream(e){return Promise.resolve(void 0)}async getDirectoryList(e){return this.s3Client.listObjectsV2({Prefix:e,Bucket:this.input.bucket}).then((e=>e.Contents.map((e=>c.default.basename(e.Key)))))}async fileDelete(e){return this.s3Client.deleteObject({Key:this.patchKey(e),Bucket:this.input.bucket}).then((()=>!0))}async scanFiles(e){(e=(e=e.replace(/\./g,"")).replace(/^\//,"")).startsWith("nc/uploads/")||(e=`nc/uploads/${e}`),e=e.replace(/\*/g,"");const t=new l.Readable({read(){}});t.setEncoding("utf8");const a=async i=>{this.s3Client.listObjectsV2(Object.assign({Bucket:this.input.bucket,Prefix:e},i?{ContinuationToken:i}:{})).then((e=>{e.Contents.forEach((e=>{t.push(e.Key)})),e.IsTruncated?a(e.NextContinuationToken):t.push(null)}))};return a().catch((e=>{t.emit("error",e)})),t}}},17288:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(21816),r=a(94760),l=i(a(85188));class Backblaze extends l.default{constructor(e){super(e),this.name="Backblaze"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e={region:this.patchRegion(this.input.region),credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:`https://s3.${this.patchRegion(this.input.region)}.backblazeb2.com`};this.s3Client=new r.S3(e)}patchKey(e){return(e.startsWith(`${this.input.bucket}/nc/uploads`)||e.startsWith(`${this.input.bucket}/nc/thumbnails`))&&(e=e.replace(`${this.input.bucket}/`,"")),e}async upload(e){try{const t=new s.Upload({client:this.s3Client,params:e});if(await t.done())return`https://${this.input.bucket}.s3.${this.input.region}.backblazeb2.com/${e.Key}`}catch(e){throw console.error("Error uploading file",e),e}}patchRegion(e){return e.startsWith("s3.")&&(e=e.slice(3)),e}}t.default=Backblaze},75023:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(17288)),r=a(80856);class BackblazePlugin extends r.XcStoragePlugin{getAdapter(){return BackblazePlugin.storageAdapter}async init(e){BackblazePlugin.storageAdapter=new s.default(e),await BackblazePlugin.storageAdapter.init()}}t.default=BackblazePlugin},24263:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(75023)).default,title:"Backblaze",version:"0.0.5",logo:"plugins/backblaze.jpeg",tags:"Storage",description:"Backblaze B2 is enterprise-grade, S3 compatible storage that companies around the world use to store and serve data while improving their cloud OpEx vs. Amazon S3 and others.",inputs:{title:"Configure Backblaze B2",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"e.g. us-west-001",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"i.e. keyID in App Keys",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"i.e. applicationKey in App Keys",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Backblaze B2.",msgOnUninstall:""},category:"Storage"};t.default=r},24120:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71178)),r=a(1384);t.default=class Discord{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of(null==t?void 0:t.channels)||[])try{return await s.default.post(a,{content:e,httpAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0})})}catch(e){throw console.log(e),e}}}},42004:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(24120)),r=a(80856);class DiscordPlugin extends r.XcWebhookNotificationPlugin{getAdapter(){return DiscordPlugin.notificationAdapter}async init(e){DiscordPlugin.notificationAdapter=new s.default,await DiscordPlugin.notificationAdapter.init()}}t.default=DiscordPlugin},87624:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(42004)).default,title:"Discord",version:"0.0.1",logo:"plugins/discord.png",description:"Discord is the easiest way to talk over voice, video, and text. Talk, chat, hang out, and stay close with your friends and communities.",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Discord",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:s.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",type:s.XcType.Password,placeholder:"Webhook URL",required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and Discord is enabled for notification.",msgOnUninstall:""}};t.default=r},76532:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(2058)),r=a(50970),l=a(48378),c=a(31808),d=i(a(71178)),u=a(1384),p=a(84988);t.default=class Gcs{constructor(e){this.name="Gcs",this.input=e}patchKey(e){let t=decodeURIComponent(e);return t.startsWith(`${this.bucketName}/`)&&(t=t.replace(`${this.bucketName}/`,"")),t}async init(){const e={credentials:{client_email:this.input.client_email,private_key:this.input.private_key.replace(/\\n/gm,"\n")}};this.input.project_id&&(e.projectId=this.input.project_id),this.bucketName=this.input.bucket,this.storageClient=new c.Storage(e)}async test(){try{const e=(0,p.generateTempFilePath)(),t=s.default.createWriteStream(e);return await(0,p.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:t.bytesWritten.toString()}),await(0,r.promisify)(s.default.unlink)(e),!0}catch(e){throw e}}async fileRead(e){const t=this.storageClient.bucket(this.bucketName).file(this.patchKey(e)),[a]=await t.exists();if(!a)throw new Error(`File ${this.patchKey(e)} does not exist`);const[i]=await t.download();return i}async fileCreate(e,t){const[a]=await this.storageClient.bucket(this.bucketName).upload(t.path,{destination:this.patchKey(e),contentType:(null==t?void 0:t.mimetype)||"application/octet-stream",gzip:!0,predefinedAcl:"publicRead",metadata:{cacheControl:"public, max-age=31536000"}});return a.publicUrl()}async fileCreateByStream(e,t,a={}){const i=this.storageClient.bucket(this.bucketName).file(this.patchKey(e));return await new Promise(((e,s)=>{t.pipe(i.createWriteStream({gzip:!0,predefinedAcl:"publicRead",metadata:{contentType:a.mimetype||"application/octet-stream",cacheControl:"public, max-age=31536000"}})).on("finish",(()=>e())).on("error",s)})),i.publicUrl()}async fileCreateByUrl(e,t,{fetchOptions:{buffer:a}={buffer:!1}}){const i=await d.default.get(t,{httpAgent:(0,u.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,u.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),responseType:a?"arraybuffer":"stream"}),s=this.storageClient.bucket(this.bucketName).file(e);return await s.save(i.data),{url:s.publicUrl(),data:i.data}}async fileDelete(e){await this.storageClient.bucket(this.bucketName).file(e).delete()}async fileReadByStream(e){return this.storageClient.bucket(this.bucketName).file(this.patchKey(e)).createReadStream()}async getDirectoryList(e){const[t]=await this.storageClient.bucket(this.bucketName).getFiles({prefix:e});return t.map((e=>e.name))}async getSignedUrl(e,t=7200,a){const i={version:"v4",action:"read",expires:Date.now()+1e3*t,extensionHeaders:a},[s]=await this.storageClient.bucket(this.bucketName).file(this.patchKey(e)).getSignedUrl(i);return s}async scanFiles(e){(e=(e=e.replace(/\./g,"")).replace(/^\//,"")).startsWith("nc/uploads/")||(e=`nc/uploads/${e}`);const t=new l.Readable({objectMode:!0,read(){}}),a=this.storageClient.bucket(this.input.bucket).getFilesStream({prefix:e,autoPaginate:!0});return a.on("error",(e=>{t.emit("error",e)})),a.on("data",(e=>{t.push(e.name)})),a.on("end",(()=>{t.push(null)})),t}}},85432:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(76532)),r=a(80856);class GcsPlugin extends r.XcStoragePlugin{getAdapter(){return GcsPlugin.storageAdapter}async init(e){GcsPlugin.storageAdapter=new s.default(e),await GcsPlugin.storageAdapter.init()}}t.default=GcsPlugin},11168:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(85432)).default,title:"GCS",version:"0.0.3",logo:"plugins/gcs.png",description:"Google Cloud Storage is a RESTful online file storage web service for storing and accessing data on Google Cloud Platform infrastructure.",price:"Free",tags:"Storage",category:"Storage",inputs:{title:"Configure Google Cloud Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"client_email",label:"Client Email",placeholder:"Client Email",type:s.XcType.SingleLineText,required:!0},{key:"private_key",label:"Private Key",placeholder:"Private Key",type:s.XcType.Password,required:!0},{key:"project_id",label:"Project ID",placeholder:"Project ID",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Google Cloud Storage.",msgOnUninstall:""}};t.default=r},48432:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class LinodeObjectStorage extends r.default{constructor(e){super(e),this.name="LinodeObjectStorage"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e={region:this.input.region,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:`https://${this.input.region}.linodeobjects.com`};this.s3Client=new s.S3(e)}}t.default=LinodeObjectStorage},63244:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(48432)),r=a(80856);class LinodeObjectStoragePlugin extends r.XcStoragePlugin{getAdapter(){return LinodeObjectStoragePlugin.storageAdapter}async init(e){LinodeObjectStoragePlugin.storageAdapter=new s.default(e),await LinodeObjectStoragePlugin.storageAdapter.init()}}t.default=LinodeObjectStoragePlugin},85471:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(63244)).default,title:"Linode",version:"0.0.4",logo:"plugins/linode.svg",tags:"Storage",description:"S3-compatible Linode Object Storage makes it easy and more affordable to manage unstructured data such as content assets, as well as sophisticated and data-intensive storage challenges around artificial intelligence and machine learning.",inputs:{title:"Configure Linode Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Linode Object Storage.",msgOnUninstall:""},category:"Storage"};t.default=r},45472:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const l=r(a(49718));t.default=class Mailer{constructor(e){this.input=e}async init(){var e;this.mailersend=new l.default({api_key:null===(e=this.input)||void 0===e?void 0:e.api_key})}async mailSend(e){const t=[new l.Recipient(e.to)],a=(new l.EmailParams).setFrom(this.input.from).setFromName(this.input.from_name).setRecipients(t).setSubject(e.subject).setHtml(e.html).setText(e.text),i=await this.mailersend.send(a);if(401===i.status)throw new Error(i.status)}async test(e){try{return await this.mailSend({to:e,subject:"Test email",html:"Test email"}),!0}catch(e){throw e}}}},56932:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(45472)),r=a(80856);class MailerSendPlugin extends r.XcEmailPlugin{getAdapter(){return MailerSendPlugin.storageAdapter}async init(e){MailerSendPlugin.storageAdapter=new s.default(e),await MailerSendPlugin.storageAdapter.init()}}t.default=MailerSendPlugin},55916:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(56932)).default,title:"MailerSend",version:"0.0.2",logo:"plugins/mailersend.svg",description:"MailerSend email client",price:"Free",tags:"Email",category:"Email",inputs:{title:"Configure MailerSend",items:[{key:"api_key",label:"API key",placeholder:"eg: ***************",type:s.XcType.Password,required:!0},{key:"from",label:"From",placeholder:"eg: admin@run.com",type:s.XcType.SingleLineText,required:!0},{key:"from_name",label:"From name",placeholder:"eg: Adam",type:s.XcType.SingleLineText,required:!0}],actions:[{label:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Email notifications are now set up using MailerSend.",msgOnUninstall:""}};t.default=r},84428:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71178)),r=a(1384);t.default=class Mattermost{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of(null==t?void 0:t.channels)||[])try{return await s.default.post(a,{text:e,httpAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0})})}catch(e){throw console.log(e),e}}}},9832:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(84428)),r=a(80856);class MattermostPlugin extends r.XcWebhookNotificationPlugin{getAdapter(){return MattermostPlugin.notificationAdapter}async init(e){MattermostPlugin.notificationAdapter=new s.default,await MattermostPlugin.notificationAdapter.init()}}t.default=MattermostPlugin},23532:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(9832)).default,title:"Mattermost",version:"0.0.1",logo:"plugins/mattermost.png",description:"Mattermost brings all your team communication into one place, making it searchable and accessible anywhere.",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Mattermost",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:s.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",placeholder:"Webhook URL",type:s.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and Mattermost is enabled for notification.",msgOnUninstall:""}};t.default=r},7192:function(e,t,a){"use strict";var i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,a=e[Symbol.asyncIterator];return a?a.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(a){t[a]=e[a]&&function(t){return new Promise((function(i,s){(function(e,t,a,i){Promise.resolve(i).then((function(t){e({value:t,done:a})}),t)})(i,s,(t=e[a](t)).done,t.value)}))}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(a(2058)),l=a(48378),c=a(60960),d=s(a(71178)),u=a(1384);t.default=class Minio{constructor(e){this.name="Minio",this.input=e}async init(){const e={port:+this.input.port||9e3,endPoint:this.input.endPoint,useSSL:!0===this.input.useSSL,accessKey:this.input.access_key,secretKey:this.input.access_secret};this.minioClient=new c.Client(e),this.input.useSSL&&this.input.ca&&this.minioClient.setRequestOptions({ca:this.input.ca})}async test(){try{const e=l.Readable.from(["Hello from Minio, NocoDB"]);return await this.fileCreateByStream("nc-test-file.txt",e),!0}catch(e){throw e}}async fileRead(e){const t=await this.minioClient.getObject(this.input.bucket,e);return new Promise(((e,a)=>{const i=[];t.on("data",(e=>{i.push(e)})),t.on("end",(()=>{const t=Buffer.concat(i);e(t)})),t.on("error",(e=>{a(e)}))}))}async fileCreate(e,t){const a=r.default.createReadStream(t.path);return this.fileCreateByStream(e,a,{mimetype:null==t?void 0:t.mimetype})}async fileCreateByStream(e,t,a){try{const i=new Promise(((e,a)=>{t.on("error",(e=>{a(e)}))})),s={Key:e,Body:t,metaData:{ContentType:null==a?void 0:a.mimetype,size:null==a?void 0:a.size}},r=this.upload(s);return await Promise.race([r,i])}catch(e){throw e}}async fileCreateByUrl(e,t,{fetchOptions:{buffer:a}={buffer:!1}}){const i=await d.default.get(t,{httpAgent:(0,u.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,u.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),responseType:a?"arraybuffer":"stream"}),s={ACL:"public-read",Key:e,Body:i.data,metaData:{ContentType:i.headers["content-type"]}};return{url:await this.upload(s),data:i.data}}async upload(e){try{return await this.minioClient.putObject(this.input.bucket,e.Key,e.Body,e.metaData),this.input.useSSL&&443===this.input.port?`https://${this.input.endPoint}/${e.Key}`:this.input.useSSL||80!==this.input.port?`http${this.input.useSSL?"s":""}://${this.input.endPoint}:${this.input.port}/${e.Key}`:`http://${this.input.endPoint}/${e.Key}`}catch(e){throw console.error("Error uploading file",e),e}}async getSignedUrl(e,t=7200,a){return(e.startsWith(`${this.input.bucket}/nc/uploads`)||e.startsWith(`${this.input.bucket}/nc/thumbnails`))&&(e=e.replace(`${this.input.bucket}/`,"")),this.minioClient.presignedGetObject(this.input.bucket,e,t,a)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return this.minioClient.removeObject(this.input.bucket,e).then((()=>!0))}async scanFiles(e){(e=(e=e.replace(/\./g,"")).replace(/^\//,"")).startsWith("nc/uploads/")||(e=`nc/uploads/${e}`),e=e.replace(/\*/g,"");const t=new l.Readable({read(){}});t.setEncoding("utf8");return(async()=>{var a,s,r,l;try{const p=this.minioClient.listObjectsV2(this.input.bucket,e,!0);try{for(var c,d=!0,u=i(p);!(a=(c=await u.next()).done);d=!0){l=c.value,d=!1;const e=l;t.push(e.name)}}catch(e){s={error:e}}finally{try{d||a||!(r=u.return)||await r.call(u)}finally{if(s)throw s.error}}t.push(null)}catch(e){t.emit("error",e)}})().catch((e=>{t.emit("error",e)})),t}}},6336:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(7192)),r=a(80856);class MinioPlugin extends r.XcStoragePlugin{getAdapter(){return MinioPlugin.storageAdapter}async init(e){MinioPlugin.storageAdapter=new s.default(e),await MinioPlugin.storageAdapter.init()}}t.default=MinioPlugin},37144:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(6336)).default,title:"Minio",version:"0.0.4",logo:"plugins/minio.png",description:"MinIO is a High Performance Object Storage released under Apache License v2.0. It is API compatible with Amazon S3 cloud storage service.",price:"Free",tags:"Storage",category:"Storage",inputs:{title:"Configure Minio",items:[{key:"endPoint",label:"Minio Endpoint",placeholder:"Minio Endpoint",type:s.XcType.SingleLineText,required:!0},{key:"port",label:"Port",placeholder:"Port",type:s.XcType.Number,required:!0},{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"ca",label:"Ca",placeholder:"Ca",type:s.XcType.LongText},{key:"useSSL",label:"Use SSL",placeholder:"Use SSL",type:s.XcType.Checkbox,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Minio.",msgOnUninstall:""}};t.default=r},64588:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class OvhCloud extends r.default{constructor(e){super(e),this.name="OvhCloud"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e={region:this.input.region,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:`https://s3.${this.input.region}.cloud.ovh.net`};this.s3Client=new s.S3(e)}}t.default=OvhCloud},95200:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(64588)),r=a(80856);class OvhCloudPlugin extends r.XcStoragePlugin{getAdapter(){return OvhCloudPlugin.storageAdapter}async init(e){OvhCloudPlugin.storageAdapter=new s.default(e),await OvhCloudPlugin.storageAdapter.init()}}t.default=OvhCloudPlugin},23180:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(95200)).default,title:"Ovh",version:"0.0.4",logo:"plugins/ovhCloud.png",tags:"Storage",description:"Upload your files to a space that you can access via HTTPS using the OpenStack Swift API, or the S3 API. ",inputs:{title:"Configure OvhCloud Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in OvhCloud Object Storage.",msgOnUninstall:""},category:"Storage"};t.default=r},56756:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class R2 extends r.default{constructor(e){super(e),this.name="R2"}get defaultParams(){return{Bucket:this.input.bucket,ACL:"private"}}async init(){const e={region:"auto",endpoint:this.input.hostname,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret}};this.s3Client=new s.S3(e)}}t.default=R2},26896:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(56756)),r=a(80856);class R2Plugin extends r.XcStoragePlugin{getAdapter(){return R2Plugin.storageAdapter}async init(e){R2Plugin.storageAdapter=new s.default(e),await R2Plugin.storageAdapter.init()}}t.default=R2Plugin},76220:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(26896)).default,title:"Cloudflare R2",version:"0.0.3",logo:"plugins/r2.png",description:"Cloudflare R2 is an S3-compatible, zero egress-fee, globally distributed object storage.",tags:"Storage",inputs:{title:"Configure Cloudflare R2 Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"hostname",label:"Host Name",placeholder:"e.g.: *****.r2.cloudflarestorage.com",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Cloudflare R2 Storage.",msgOnUninstall:""},category:"Storage"};t.default=r},15828:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=a(21816),l=i(a(85188));class S3 extends l.default{constructor(e){super(e),this.name="S3"}get defaultParams(){return Object.assign(Object.assign({},this.input.acl?{ACL:this.input.acl}:{}),{Bucket:this.input.bucket})}patchKey(e){return this.input.force_path_style?((e.startsWith(`${this.input.bucket}/nc/uploads`)||e.startsWith(`${this.input.bucket}/nc/thumbnails`))&&(e=e.replace(`${this.input.bucket}/`,"")),e):e}async init(){var e;const t={region:this.input.region,forcePathStyle:null!==(e=this.input.force_path_style)&&void 0!==e&&e};this.input.access_key&&this.input.access_secret&&(t.credentials={accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret}),this.input.endpoint&&(t.endpoint=this.input.endpoint),this.s3Client=new s.S3(t)}async upload(e){try{const t=new r.Upload({client:this.s3Client,params:Object.assign(Object.assign({},this.defaultParams),e)});if(await t.done()){const t=this.input.endpoint?new URL(this.input.endpoint).host:`s3.${this.input.region}.amazonaws.com`;return this.input.force_path_style?`https://${t}/${this.input.bucket}/${e.Key}`:`https://${this.input.bucket}.${t}/${e.Key}`}throw new Error("Upload failed or no data returned.")}catch(e){throw console.error(e),e}}}t.default=S3},32031:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(15828)),r=a(80856);class S3Plugin extends r.XcStoragePlugin{getAdapter(){return S3Plugin.storageAdapter}async init(e){S3Plugin.storageAdapter=new s.default(e),await S3Plugin.storageAdapter.init()}}t.default=S3Plugin},63252:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(32031)).default,title:"S3",version:"0.0.6",logo:"plugins/s3.png",description:"Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.",inputs:{title:"Configure Amazon S3",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:s.XcType.SingleLineText,required:!0},{key:"endpoint",label:"Endpoint",placeholder:"Endpoint",type:s.XcType.SingleLineText,required:!1},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!1},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!1},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"",type:s.XcType.SingleLineText,required:!1},{key:"force_path_style",label:"Force Path Style",placeholder:"Default set to false",type:s.XcType.Checkbox,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in AWS S3.",msgOnUninstall:""},category:s.PluginCategory.STORAGE,tags:"Storage"};t.default=r},44876:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class ScalewayObjectStorage extends r.default{constructor(e){super(e),this.name="ScalewayObjectStorage"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e={region:this.input.region,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:`https://s3.${this.input.region}.scw.cloud`};this.s3Client=new s.S3(e)}}t.default=ScalewayObjectStorage},27092:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(44876)),r=a(80856);class ScalewayObjectStoragePlugin extends r.XcStoragePlugin{async init(e){ScalewayObjectStoragePlugin.storageAdapter=new s.default(e),await ScalewayObjectStoragePlugin.storageAdapter.init()}getAdapter(){return ScalewayObjectStoragePlugin.storageAdapter}}t.default=ScalewayObjectStoragePlugin},87732:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(27092)).default,title:"Scaleway",version:"0.0.4",logo:"plugins/scaleway.png",tags:"Storage",description:"Scaleway Object Storage is an S3-compatible object store from Scaleway Cloud Platform.",inputs:{title:"Setup Scaleway",items:[{key:"bucket",label:"Bucket name",placeholder:"Bucket name",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region of bucket",placeholder:"Region of bucket",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Scaleway Object Storage.",msgOnUninstall:""},category:"Storage"};t.default=r},7020:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(66808)),r=a(2208);t.default=class SES{constructor(e){this.input=e}async init(){const e=new r.SES({apiVersion:"2006-03-01",region:this.input.region,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret}});this.transporter=s.default.createTransport({SES:{ses:e,aws:{SendRawEmailCommand:r.SendRawEmailCommand}}})}async mailSend(e){this.transporter&&this.transporter.sendMail(Object.assign(Object.assign({},e),{from:this.input.from}),((e,t)=>{e?console.log(e):console.log("Message sent: "+t.response)}))}async test(){try{return await this.mailSend({to:this.input.from,subject:"Test email",html:"Test email"}),!0}catch(e){throw e}}}},66564:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(7020)),r=a(80856);class SESPlugin extends r.XcEmailPlugin{getAdapter(){return SESPlugin.storageAdapter}async init(e){SESPlugin.storageAdapter=new s.default(e),await SESPlugin.storageAdapter.init()}}t.default=SESPlugin},8024:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(66564)).default,title:"SES",version:"0.0.2",logo:"plugins/aws.png",description:"Amazon Simple Email Service (SES) is a cost-effective, flexible, and scalable email service that enables developers to send mail from within any application.",price:"Free",tags:"Email",category:"Email",inputs:{title:"Configure Amazon Simple Email Service (SES)",items:[{key:"from",label:"From",placeholder:"From",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Email notifications are now set up using Amazon SES.",msgOnUninstall:""}};t.default=r},75436:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71178)),r=a(1384);t.default=class Slack{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of(null==t?void 0:t.channels)||[])try{return await s.default.post(a,{text:e,httpAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0})})}catch(e){throw console.log(e),e}}}},54128:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(75436)),r=a(80856);class SlackPlugin extends r.XcWebhookNotificationPlugin{getAdapter(){return SlackPlugin.notificationAdapter}async init(e){SlackPlugin.notificationAdapter=new s.default,await SlackPlugin.notificationAdapter.init()}}t.default=SlackPlugin},54332:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(54128)).default,title:"Slack",version:"0.0.1",logo:"plugins/slack.webp",description:"Slack brings team communication and collaboration into one place so you can get more work done, whether you belong to a large enterprise or a small business. ",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Slack",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:s.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",placeholder:"Webhook URL",type:s.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and Slack is enabled for notification.",msgOnUninstall:""}};t.default=r},83684:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(66808));t.default=class SMTP{constructor(e){this.input=e}async init(){var e,t,a,i,r,l,c,d,u,p,m,_,f,h,g,y;const b=Object.assign({name:null===(e=this.input)||void 0===e?void 0:e.name,host:null===(t=this.input)||void 0===t?void 0:t.host,port:parseInt(null===(a=this.input)||void 0===a?void 0:a.port,10),secure:"boolean"==typeof(null===(i=this.input)||void 0===i?void 0:i.secure)?null===(r=this.input)||void 0===r?void 0:r.secure:"true"===(null===(l=this.input)||void 0===l?void 0:l.secure),ignoreTLS:"boolean"==typeof(null===(c=this.input)||void 0===c?void 0:c.ignoreTLS)?null===(d=this.input)||void 0===d?void 0:d.ignoreTLS:"true"===(null===(u=this.input)||void 0===u?void 0:u.ignoreTLS),tls:{rejectUnauthorized:null===(p=this.input)||void 0===p?void 0:p.rejectUnauthorized}},(null===(m=this.input)||void 0===m?void 0:m.username)||(null===(_=this.input)||void 0===_?void 0:_.password)?{auth:Object.assign(Object.assign({},(null===(f=this.input)||void 0===f?void 0:f.username)?{user:null===(h=this.input)||void 0===h?void 0:h.username}:{}),(null===(g=this.input)||void 0===g?void 0:g.password)?{pass:null===(y=this.input)||void 0===y?void 0:y.password}:{})}:{});this.transporter=s.default.createTransport(b)}async mailSend(e){this.transporter&&await this.transporter.sendMail(Object.assign(Object.assign({},e),{from:this.input.from}))}async test(){try{return await this.mailSend({to:this.input.from,subject:"Test email",html:"Test email"}),!0}catch(e){throw console.log("SMTP test error :: ",e),new Error("SMTP test failed, please check server log for more details.")}}}},9516:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(83684)),r=a(80856);class SMTPPlugin extends r.XcEmailPlugin{getAdapter(){return SMTPPlugin.storageAdapter}async init(e){SMTPPlugin.storageAdapter=new s.default(e),await SMTPPlugin.storageAdapter.init()}}t.default=SMTPPlugin},20752:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(9516)).default,title:"SMTP",version:"0.0.4",description:"SMTP email client",price:"Free",tags:"Email",category:"Email",inputs:{title:"Configure Email SMTP",items:[{key:"from",label:"From address",placeholder:"admin@run.com",type:s.XcType.SingleLineText,required:!0,help_text:"Successfully configured! Email notifications are now set up using SMTP."},{key:"host",label:"SMTP server",placeholder:"smtp.run.com",help_text:"Enter outgoing mail server address (SMTP). If you do not have this information available, contact your email service provider",type:s.XcType.SingleLineText,required:!0},{key:"name",label:"From domain",placeholder:"your-domain.com",type:s.XcType.SingleLineText,required:!0,help_text:"Specify the domain name that will be used in the 'From' address (e.g., yourdomain.com). This should match the domain of the From Address."},{key:"port",label:"SMTP port",placeholder:"Port",type:s.XcType.SingleLineText,required:!0,help_text:"Enter the port number used by the SMTP server (e.g., 587 for TLS, 465 for SSL, or 25 for non-secure connections)."},{key:"username",label:"Username",placeholder:"Username",type:s.XcType.SingleLineText,required:!1,help_text:"Enter the username required to authenticate with the SMTP server. This is usually your email address."},{key:"password",label:"Password",placeholder:"Password",type:s.XcType.Password,required:!1,help_text:"Enter the password associated with the SMTP server username. Click the eye icon to view the password as you type"},{key:"secure",label:"Use secure connection",placeholder:"Secure",type:s.XcType.Checkbox,required:!1,help_text:"Enable this on if your SMTP server requires a secure connection (SSL/TLS)."},{key:"ignoreTLS",label:"Ignore TLS errors",placeholder:"Ignore TLS",type:s.XcType.Checkbox,required:!1,help_text:"Enable this if you want to bypass any TLS errors that may occur during the connection. Only use this if necessary, as it may compromise security."},{key:"rejectUnauthorized",label:"Reject unauthorized",placeholder:"Reject unauthorized",type:s.XcType.Checkbox,required:!1,help_text:"Enable this on to reject emails that fail authentication checks, ensuring only authorized emails are sent."}],actions:[{label:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and email notification will use SMTP configuration",msgOnUninstall:"",docs:[]}};t.default=r},208:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class Spaces extends r.default{constructor(e){super(e),this.name="Spaces"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e={region:"us-east-1",forcePathStyle:!1,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:`https://${this.input.region||"nyc3"}.digitaloceanspaces.com`};this.s3Client=new s.S3(e)}}t.default=Spaces},64928:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(208)),r=a(80856);class SpacesPlugin extends r.XcStoragePlugin{getAdapter(){return SpacesPlugin.storageAdapter}async init(e){SpacesPlugin.storageAdapter=new s.default(e),await SpacesPlugin.storageAdapter.init()}}t.default=SpacesPlugin},79956:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(64928)).default,title:"Spaces",version:"0.0.2",logo:"plugins/spaces.png",description:"Store & deliver vast amounts of content with a simple architecture.",price:"Free",tags:"Storage",category:"Storage",inputs:{title:"DigitalOcean Spaces",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in DigitalOcean Spaces.",msgOnUninstall:""}};t.default=r},57608:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(2058)),r=i(a(67072)),l=a(50970),c=a(48378),d=i(a(75058)),u=i(a(71178)),p=a(1384),m=a(5114),_=a(19176);t.default=class Local{constructor(){this.name="Local"}async fileCreate(e,t){const a=(0,_.validateAndNormaliseLocalPath)(e);try{await(0,d.default)(r.default.dirname(a));const e=await(0,l.promisify)(s.default.readFile)(t.path);await(0,l.promisify)(s.default.writeFile)(a,e),await(0,l.promisify)(s.default.unlink)(t.path)}catch(e){throw e}}async fileCreateByUrl(e,t,{fetchOptions:{buffer:a}={buffer:!1}}){const i=(0,_.validateAndNormaliseLocalPath)(e);return new Promise(((e,l)=>{u.default.get(t,{responseType:a?"arraybuffer":"stream",headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","accept-language":"en-US,en;q=0.9","cache-control":"no-cache",pragma:"no-cache","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36",origin:"https://www.airtable.com/"},httpAgent:(0,p.useAgent)(t,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,p.useAgent)(t,{stopPortScanningByUrlRedirection:!0})}).then((async t=>{await(0,d.default)(r.default.dirname(i)),s.default.writeFile(i,t.data,(a=>{if(a)return l(a);e({url:null,data:t.data})}))})).catch((e=>{l(e.message)}))}))}async fileCreateByStream(e,t){return new Promise(((a,i)=>{const l=(0,_.validateAndNormaliseLocalPath)(e);try{(0,d.default)(r.default.dirname(l)).then((()=>{const e=s.default.createWriteStream(l);e.on("finish",(()=>a())),e.on("error",(e=>i(e))),t.pipe(e)}))}catch(e){throw e}}))}async fileReadByStream(e){const t=(0,_.validateAndNormaliseLocalPath)(e);return s.default.createReadStream(t,{encoding:"utf8"})}async getDirectoryList(e){const t=(0,_.validateAndNormaliseLocalPath)(e);return s.default.promises.readdir(t)}fileDelete(e){return s.default.promises.unlink((0,_.validateAndNormaliseLocalPath)(e))}async fileRead(e){try{return await s.default.promises.readFile((0,_.validateAndNormaliseLocalPath)(e,!0))}catch(e){throw e}}async scanFiles(e){(e=(e=(e=e.replace(/\//g,r.default.sep)).replace(/\./g,"")).replace(/^\//,"")).startsWith(r.default.join("nc","uploads"))||(e=r.default.join("nc","uploads",e));const t=(0,m.globStream)(e,{nodir:!0});return c.Readable.from(t)}init(){return Promise.resolve(void 0)}test(){return Promise.resolve(!1)}}},48876:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71178)),r=a(1384);t.default=class Teams{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of(null==t?void 0:t.channels)||[])try{return await s.default.post(a,{Text:e,httpAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,r.useAgent)(a,{stopPortScanningByUrlRedirection:!0})})}catch(e){throw console.log(e),e}}}},80968:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(48876)),r=a(80856);class TeamsPlugin extends r.XcWebhookNotificationPlugin{getAdapter(){return TeamsPlugin.notificationAdapter}async init(e){TeamsPlugin.notificationAdapter=new s.default,await TeamsPlugin.notificationAdapter.init()}}t.default=TeamsPlugin},97096:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(80968)).default,title:"Microsoft Teams",version:"0.0.1",logo:"plugins/teams.ico",description:"Microsoft Teams is for everyone · Instantly go from group chat to video call with the touch of a button.",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Microsoft Teams",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:s.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",placeholder:"Webhook URL",type:s.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and Microsoft Teams is enabled for notification.",msgOnUninstall:""}};t.default=r},71460:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(50280));t.default=class Twilio{constructor(e){this.input=e}async init(){this.client=(0,s.default)(this.input.sid,this.input.token)}async sendMessage(e,t){var a;for(const i of(null===(a=null==t?void 0:t.to)||void 0===a?void 0:a.split(/\s*?,\s*?/))||[])try{await this.client.messages.create({body:e,from:this.input.from,to:i})}catch(e){throw console.log(e),e}}}},53732:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71460)),r=a(80856);class TwilioPlugin extends r.XcWebhookNotificationPlugin{getAdapter(){return TwilioPlugin.notificationAdapter}async init(e){TwilioPlugin.notificationAdapter=new s.default(e),await TwilioPlugin.notificationAdapter.init()}}t.default=TwilioPlugin},30544:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(53732)).default,title:"Twilio",version:"0.0.1",logo:"plugins/twilio.png",description:"With Twilio, unite communications and strengthen customer relationships across your business – from marketing and sales to customer service and operations.",price:"Free",tags:"Chat",category:"Twilio",inputs:{title:"Configure Twilio",items:[{key:"sid",label:"Account SID",placeholder:"Account SID",type:s.XcType.SingleLineText,required:!0},{key:"token",label:"Auth Token",placeholder:"Auth Token",type:s.XcType.Password,required:!0},{key:"from",label:"From Phone Number",placeholder:"From Phone Number",type:s.XcType.SingleLineText,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and Twilio is enabled for notification.",msgOnUninstall:""}};t.default=r},72116:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(50280));t.default=class TwilioWhatsapp{constructor(e){this.input=e}async init(){this.client=(0,s.default)(this.input.sid,this.input.token)}async sendMessage(e,t){var a;for(const i of(null===(a=null==t?void 0:t.to)||void 0===a?void 0:a.split(/\s*?,\s*?/))||[])try{await this.client.messages.create({body:e,from:`whatsapp:${this.input.from}`,to:`whatsapp:${i}`})}catch(e){throw console.log(e),e}}}},51688:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(72116)),r=a(80856);class TwilioWhatsappPlugin extends r.XcWebhookNotificationPlugin{getAdapter(){return TwilioWhatsappPlugin.notificationAdapter}async init(e){TwilioWhatsappPlugin.notificationAdapter=new s.default(e),await TwilioWhatsappPlugin.notificationAdapter.init()}}t.default=TwilioWhatsappPlugin},92660:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(51688)).default,title:"Whatsapp Twilio",version:"0.0.1",logo:"plugins/whatsapp.png",description:"With Twilio, unite communications and strengthen customer relationships across your business – from marketing and sales to customer service and operations.",price:"Free",tags:"Chat",category:"Twilio",inputs:{title:"Configure Twilio",items:[{key:"sid",label:"Account SID",placeholder:"Account SID",type:s.XcType.SingleLineText,required:!0},{key:"token",label:"Auth Token",placeholder:"Auth Token",type:s.XcType.Password,required:!0},{key:"from",label:"From Phone Number",placeholder:"From Phone Number",type:s.XcType.SingleLineText,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully installed and Whatsapp Twilio is enabled for notification.",msgOnUninstall:""}};t.default=r},84244:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(20100)),r=a(80856);class UpCloudPlugin extends r.XcStoragePlugin{getAdapter(){return UpCloudPlugin.storageAdapter}async init(e){UpCloudPlugin.storageAdapter=new s.default(e),await UpCloudPlugin.storageAdapter.init()}}t.default=UpCloudPlugin},20100:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class UpoCloud extends r.default{constructor(e){super(e),this.name="UpoCloud"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e=this.input.endpoint.startsWith("https://")?this.input.endpoint:`https://${this.input.endpoint}`,t={region:this.input.region,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:e};this.s3Client=new s.S3(t)}}t.default=UpoCloud},74076:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(84244)).default,title:"UpCloud",version:"0.0.4",logo:"plugins/upcloud.png",description:"The perfect home for your data. Thanks to the S3-compatible programmable interface,\nyou have a host of options for existing tools and code implementations.\n",tags:"Storage",inputs:{title:"Configure UpCloud Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"endpoint",label:"Endpoint",placeholder:"Endpoint",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in UpCloud Object Storage.",msgOnUninstall:""},category:"Storage"};t.default=r},16096:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(94760),r=i(a(85188));class Vultr extends r.default{constructor(e){super(e),this.name="Vultr"}get defaultParams(){var e;return{Bucket:this.input.bucket,ACL:(null===(e=this.input)||void 0===e?void 0:e.acl)||"public-read"}}async init(){const e={region:this.input.region,credentials:{accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret},endpoint:this.input.hostname};this.s3Client=new s.S3(e)}}t.default=Vultr},89436:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(16096)),r=a(80856);class VultrPlugin extends r.XcStoragePlugin{getAdapter(){return VultrPlugin.storageAdapter}async init(e){VultrPlugin.storageAdapter=new s.default(e),await VultrPlugin.storageAdapter.init()}}t.default=VultrPlugin},49128:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r={builder:i(a(89436)).default,title:"Vultr",version:"0.0.4",logo:"plugins/vultr.png",description:"Using Vultr Object Storage can give flexibility and cloud storage that allows applications greater flexibility and access worldwide.",tags:"Storage",inputs:{title:"Configure Vultr Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:s.XcType.SingleLineText,required:!0},{key:"hostname",label:"Host Name",placeholder:"e.g.: ewr1.vultrobjects.com",type:s.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:s.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:s.XcType.Password,required:!0},{key:"acl",label:"Access Control Lists (ACL)",placeholder:"Default set to public-read",type:s.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:s.XcActionType.TEST,type:s.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:s.XcActionType.SUBMIT,type:s.XcType.Button}],msgOnInstall:"Successfully configured! Attachments will now be stored in Vultr Object Storage.",msgOnUninstall:""},category:"Storage"};t.default=r},83884:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitMetaServiceProvider=void 0;const s=a(62304),r=a(40444),l=a(49804),c=i(a(76584)),d=i(a(23080)),u=i(a(45500)),p=i(a(57804)),m=i(a(68592)),_=i(a(77320)),f=a(19684),h=a(39143),g=a(64612),y=a(1512),b=a(55160),w=i(a(448));t.InitMetaServiceProvider={useFactory:async e=>{var t;await(0,h.prepareEnv)();const a=await h.NcConfig.createByEnv();process.env.NC_VERSION="0225002",process.env.NC_MIGRATION_JOBS_VERSION="2",await p.default.init();const i=new l.MetaService(a),v=await i.knexConnection.schema.hasTable(g.MetaTable.STORE)?await i.metaGet(g.RootScopes.ROOT,g.RootScopes.ROOT,g.MetaTable.STORE,{key:"NC_CONFIG_MAIN"}):null;if(v){if(+JSON.parse(v.value).version<100002)throw new Error("You are trying to upgrade from an old version of NocoDB. Please upgrade to 0.207.3 first and then you can upgrade to the latest version.")}else{if(null===(t=await i.baseList())||void 0===t?void 0:t.length)throw new Error("You are trying to upgrade from an old version of NocoDB. Please upgrade to 0.207.3 first and then you can upgrade to the latest version.")}return await i.init(),c.default._ncMeta=i,c.default.config=a,c.default.eventEmitter=e,v||await(0,y.updateMigrationJobsState)({version:process.env.NC_MIGRATION_JOBS_VERSION}),await c.default.initJwt(),await(0,_.default)(i),await d.default.init(c.default.ncMeta),await c.default.loadEEState(),"true"===process.env.NC_CLOUD&&await(0,r.populatePluginsForCloud)({ncMeta:c.default.ncMeta}),await u.default.upgrade({ncMeta:c.default._ncMeta}),s.T.init({instance:m.default}),s.T.emit("evt_app_started",await f.User.count()),await(0,b.initBaseBehavior)(),await(0,w.default)(i),i},provide:l.MetaService,inject:["IEventEmitter"]}},76712:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtStrategyProvider=void 0;const s=a(65528),r=a(49804),l=a(50628),c=a(99236),d=i(a(76584));t.JwtStrategyProvider={provide:c.JwtStrategy,useFactory:async(e,t)=>{const a=t.config;await d.default.initJwt();const i=Object.assign({jwtFromRequest:s.ExtractJwt.fromHeader("xc-auth"),passReqToCallback:!0,secretOrKey:a.auth.jwt.secret},a.auth.jwt.options);return new c.JwtStrategy(i,e)},inject:[l.UsersService,r.MetaService]}},88228:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PubSubRedis=void 0;const s=a(23324),r=i(a(44696));class PubSubRedis{static async init(){PubSubRedis.available&&(PubSubRedis.redisClient=new r.default(process.env.NC_REDIS_JOB_URL),PubSubRedis.redisSubscriber=new r.default(process.env.NC_REDIS_JOB_URL),PubSubRedis.initialized=!0)}static async publish(e,t){if(!PubSubRedis.initialized){if(!PubSubRedis.available)return;await PubSubRedis.init()}try{"string"==typeof t?await PubSubRedis.redisClient.publish(e,t):await PubSubRedis.redisClient.publish(e,JSON.stringify(t))}catch(e){PubSubRedis.logger.error(e)}}static async subscribe(e,t){if(!PubSubRedis.initialized){if(!PubSubRedis.available)return;await PubSubRedis.init()}await PubSubRedis.redisSubscriber.subscribe(e);const a=async(a,i)=>{if(e===a){try{i=JSON.parse(i)}catch(e){}await t(i)}};return PubSubRedis.redisSubscriber.on("message",a),async(t=!1)=>{t||await PubSubRedis.redisSubscriber.unsubscribe(e),PubSubRedis.redisSubscriber.off("message",a)}}}t.PubSubRedis=PubSubRedis,PubSubRedis.initialized=!1,PubSubRedis.available=!!process.env.NC_REDIS_JOB_URL,PubSubRedis.logger=new s.Logger(PubSubRedis.name)},19084:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const l=r(a(73132));t.default=l},57116:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiDocsService=void 0;const r=a(23324),l=s(a(47364)),c=s(a(8944)),d=a(43820),u=a(19684);let p=class ApiDocsService{async swaggerJson(e,t){const a=await u.Base.get(e,t.baseId);a||d.NcError.baseNotFound(t.baseId);const i=await u.Model.list(e,{base_id:t.baseId,source_id:null}),s=await(0,l.default)(e,a,i);return s.servers=[{url:t.siteUrl},{url:"{customUrl}",variables:{customUrl:{default:t.siteUrl,description:"Provide custom nocodb app base url"}}}],s}async swaggerJsonV2(e,t){const a=await u.Base.get(e,t.baseId);a||d.NcError.baseNotFound(t.baseId);const i=await u.Model.list(e,{base_id:t.baseId,source_id:null}),s=await(0,c.default)(e,a,i);return s.servers=[{url:t.siteUrl},{url:"{customUrl}",variables:{customUrl:{default:t.siteUrl,description:"Provide custom nocodb app base url"}}}],s}};t.ApiDocsService=p,t.ApiDocsService=p=i([(0,r.Injectable)()],p)},95564:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,{base:t,model:a,columns:i,views:l},c=r.default.ncMeta){const d=await(0,s.getModelPaths)(e,{tableName:a.title,type:a.type,orgs:"v1",columns:i,baseName:t.id});for(const{view:r,columns:c}of l){const l=i.filter((e=>{var t;return null===(t=c.find((t=>t.fk_column_id===e.column.id)))||void 0===t?void 0:t.show}));Object.assign(d,await(0,s.getViewPaths)(e,{tableName:a.title,viewName:r.title,type:a.type,orgs:"v1",columns:l,baseName:t.id}))}return d};const s=a(75760),r=i(a(76584))},7172:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({base:e,model:t,columns:a,views:i},l=r.default.ncMeta){const c=(0,s.getModelSchemas)({tableName:t.title,orgs:"v1",baseName:e.title,columns:a});for(const{view:r,columns:l}of i){const i=a.filter((e=>{var t;return null===(t=l.find((t=>t.fk_column_id===e.column.id)))||void 0===t?void 0:t.show}));Object.assign(c,(0,s.getViewSchemas)({tableName:t.title,viewName:r.title,orgs:"v1",columns:i,baseName:e.title}))}return c};const s=a(95732),r=i(a(76584))},84648:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(10024)),l=i(a(76584));t.default=async(e,t,a,i=l.default.ncMeta)=>{const c=await a.getSources().then((e=>{var t;return null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.type}));return Promise.all(t.map((async t=>{const a={title:t.title,type:"object",virtual:!0,column:t};switch(t.uidt){case s.UITypes.LinkToAnotherRecord:{const r=await t.getColOptions(e,i);if(r){const t=await r.getRelatedTable(e,i);r.type===s.RelationTypes.BELONGS_TO?(a.type=void 0,a.$ref=`#/components/schemas/${t.title}Request`):(a.type="array",a.items={$ref:`#/components/schemas/${t.title}Request`})}}break;case s.UITypes.Formula:case s.UITypes.Lookup:a.type="object";break;case s.UITypes.Rollup:case s.UITypes.Links:a.type="number";break;case s.UITypes.Attachment:a.type="array",a.items={$ref:"#/components/schemas/Attachment"};break;case s.UITypes.LastModifiedTime:case s.UITypes.CreatedTime:a.type="string";break;case s.UITypes.LastModifiedBy:case s.UITypes.CreatedBy:a.type="object";break;default:a.virtual=!1,r.default.setSwaggerType(t,a,c)}return a})))}},47364:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,a,i=u.default.ncMeta){const p=Object.assign(Object.assign({},r.default),{paths:{},components:Object.assign(Object.assign({},r.default.components),{schemas:Object.assign({},r.default.components.schemas)})});for(const r of a){let a={};const u=await(0,d.default)(e,await r.getColumns(e,i),t,i),m=[];for(const t of await r.getViews(e,!1,i)||[])t.type===s.ViewTypes.GRID&&m.push({view:t,columns:await t.getColumns(e,i)});r.mm||(a=await(0,l.default)(e,{base:t,model:r,columns:u,views:m},i));const _=await(0,c.default)({base:t,model:r,columns:u,views:m},i);Object.assign(p.paths,a),Object.assign(p.components.schemas,_)}return p};const s=a(71040),r=i(a(50584)),l=i(a(95564)),c=i(a(7172)),d=i(a(84648)),u=i(a(76584))},70080:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csvExportResponseHeader=void 0,t.csvExportResponseHeader={"nc-export-offset":{schema:{type:"integer"},description:"Offset of next set of data which will be helpful if there is large amount of data. It will returns `-1` if all set of data exported.",example:"1000"}}},96344:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNestedParams=t.nestedOffsetParam=t.nestedLimitParam=t.nestedSortParam=t.nestedFieldParam=t.nestedWhereParam=t.csvExportOffsetParam=t.exportTypeParam=t.referencedRowIdParam=t.columnNameParam=t.columnNameQueryParam=t.shuffleParam=t.offsetParam=t.limitParam=t.whereParam=t.sortParam=t.fieldsParam=t.relationTypeParam=t.rowIdParam=void 0;const i=a(71040);t.rowIdParam={schema:{type:"string"},name:"rowId",in:"path",required:!0,example:1,description:"Primary key of the record you want to read. If the table have composite primary key then combine them by using `___` and pass it as primary key."},t.relationTypeParam={schema:{type:"string",enum:["mm","hm"]},name:"relationType",in:"path",required:!0},t.fieldsParam={schema:{type:"string"},in:"query",name:"fields",description:"Array of field names or comma separated filed names to include in the response objects. In array syntax pass it like `fields[]=field1&fields[]=field2` or alternately `fields=field1,field2`."},t.sortParam={schema:{type:"string"},in:"query",name:"sort",description:"Comma separated field names to sort rows, rows will sort in ascending order based on provided columns. To sort in descending order provide `-` prefix along with column name, like `-field`. Example : `sort=field1,-field2`"},t.whereParam={schema:{type:"string"},in:"query",name:"where",description:"This can be used for filtering rows, which accepts complicated where conditions. For more info visit [here](https://docs.nocodb.com/developer-resources/rest-apis#comparison-operators). Example : `where=(field1,eq,value)`"},t.limitParam={schema:{type:"number",minimum:1},in:"query",name:"limit",description:"The `limit` parameter used for pagination, the response collection size depends on limit value with default value `25` and maximum value `1000`, which can be overridden by environment variables `DB_QUERY_LIMIT_DEFAULT` and `DB_QUERY_LIMIT_MAX` respectively.",example:25},t.offsetParam={schema:{type:"number",minimum:0},in:"query",name:"offset",description:"The `offset` parameter used for pagination, the value helps to select collection from a certain index.",example:0},t.shuffleParam={schema:{type:"number",minimum:0,maximum:1},in:"query",name:"shuffle",description:"The `shuffle` parameter used for pagination, the response will be shuffled if it is set to 1.",example:0},t.columnNameQueryParam={schema:{type:"string"},in:"query",name:"column_name",description:"Column name of the column you want to group by, eg. `column_name=column1`"};t.columnNameParam=e=>{const t=[];for(const{column:a}of e)(0,i.isLinksOrLTAR)(a)&&!a.system&&t.push(a.title);return{schema:{type:"string",enum:t},name:"columnName",in:"path",required:!0}},t.referencedRowIdParam={schema:{type:"string"},name:"refRowId",in:"path",required:!0},t.exportTypeParam={schema:{type:"string",enum:["csv","excel"]},name:"type",in:"path",required:!0},t.csvExportOffsetParam={schema:{type:"number",minimum:0},in:"query",name:"offset",description:"Helps to start export from a certain index. You can get the next set of data offset from previous response header named `nc-export-offset`.",example:0};t.nestedWhereParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][where]`,description:`This can be used for filtering rows in nested column \`${e}\`, which accepts complicated where conditions. For more info visit [here](https://docs.nocodb.com/developer-resources/rest-apis#comparison-operators). Example : \`nested[${e}][where]=(field1,eq,value)\``});t.nestedFieldParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][fields]`,description:`Array of field names or comma separated filed names to include in the in nested column \`${e}\` result. In array syntax pass it like \`fields[]=field1&fields[]=field2.\`. Example : \`nested[${e}][fields]=field1,field2\``});t.nestedSortParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][sort]`,description:`Comma separated field names to sort rows in nested column \`${e}\` rows, it will sort in ascending order based on provided columns. To sort in descending order provide \`-\` prefix along with column name, like \`-field\`. Example : \`nested[${e}][sort]=field1,-field2\``});t.nestedLimitParam=e=>({schema:{type:"number",minimum:1},in:"query",name:`nested[${e}][limit]`,description:`The \`limit\` parameter used for pagination of nested \`${e}\` rows, the response collection size depends on limit value and default value is \`25\`.`,example:"25"});t.nestedOffsetParam=e=>({schema:{type:"number",minimum:0},in:"query",name:`nested[${e}][offset]`,description:`The \`offset\` parameter used for pagination  of nested \`${e}\` rows, the value helps to select collection from a certain index.`,example:0});t.getNestedParams=async(e,a)=>await a.reduce((async(a,{column:s})=>{if(s.uidt===i.UITypes.LinkToAnotherRecord){if(s.system)return a;return(await s.getColOptions(e)).type!==i.RelationTypes.BELONGS_TO?[...await a,(0,t.nestedWhereParam)(s.title),(0,t.nestedOffsetParam)(s.title),(0,t.nestedLimitParam)(s.title),(0,t.nestedFieldParam)(s.title),(0,t.nestedSortParam)(s.title)]:[...await a,(0,t.nestedFieldParam)(s.title)]}return a}),Promise.resolve([]))},75760:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getViewPaths=t.getModelPaths=void 0,t.isRelationExist=c;const i=a(71040),s=a(96344),r=a(70080);t.getModelPaths=async(e,t)=>Object.assign(Object.assign({[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}`]:Object.assign({get:{summary:`${t.tableName} list`,operationId:`${t.tableName.toLowerCase()}-db-table-row-list`,description:`List of all rows from ${t.tableName} ${t.type} and response data fields can be filtered based on query params.`,tags:[t.tableName],parameters:[s.fieldsParam,s.sortParam,s.whereParam,s.limitParam,s.shuffleParam,s.offsetParam,...await(0,s.getNestedParams)(e,t.columns)],responses:{200:{description:"OK",content:{"application/json":{schema:l(`${t.tableName}Response`)}}}}}},t.type===i.ModelTypes.TABLE?{post:{summary:`${t.tableName} create`,description:"Insert a new row in table by providing a key value pair object where key refers to the column alias. All the required fields should be included with payload excluding `autoincrement` and column with default value.",operationId:`${t.tableName.toLowerCase()}-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Response`}}}}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Request`}}}}}}:{}),[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/{rowId}`]:Object.assign({parameters:[s.rowIdParam]},t.type===i.ModelTypes.TABLE?{get:{parameters:[s.fieldsParam],summary:`${t.tableName} read`,description:"Read a row data by using the **primary key** column value.",operationId:`${t.tableName.toLowerCase()}-read`,responses:{201:{description:"Created",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Response`}}}}},tags:[t.tableName]},patch:{summary:`${t.tableName} update`,operationId:`${t.tableName.toLowerCase()}-update`,description:"Partial update row in table by providing a key value pair object where key refers to the column alias. You need to only include columns which you want to update.",responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Request`}}}}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{}}}}},delete:{summary:`${t.tableName} delete`,operationId:`${t.tableName.toLowerCase()}-delete`,responses:{200:{description:"OK"}},tags:[t.tableName],description:"Delete a row by using the **primary key** column value."}}:{}),[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/count`]:{get:{summary:`${t.tableName} count`,operationId:`${t.tableName.toLowerCase()}-count`,description:"Get rows count of a table by applying optional filters.",tags:[t.tableName],parameters:[s.whereParam],responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}}}},[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/find-one`]:{get:{summary:`${t.tableName} find-one`,operationId:`${t.tableName.toLowerCase()}-db-table-row-find-one`,description:"Find first record matching the conditions.",tags:[t.tableName],parameters:[s.fieldsParam,s.whereParam,s.sortParam],responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Response`}}}}}}},[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/groupby`]:{get:{summary:`${t.tableName} groupby`,operationId:`${t.tableName.toLowerCase()}-groupby`,description:"Group by a column.",tags:[t.tableName],parameters:[s.columnNameQueryParam,s.sortParam,s.whereParam,s.limitParam,s.offsetParam,s.shuffleParam],responses:{200:{description:"OK",content:{"application/json":{schema:{type:"object",properties:{list:{type:"array",items:{$ref:"#/components/schemas/Groupby"}},PageInfo:{$ref:"#/components/schemas/Paginated"}}}}}}}}}},t.type===i.ModelTypes.TABLE?Object.assign({[`/api/v1/db/data/bulk/${t.orgs}/${t.baseName}/${t.tableName}`]:{post:{summary:`${t.tableName} bulk insert`,description:"To insert large amount of data in a single api call you can use this api. It's similar to insert method but here you can pass array of objects to insert into table. Array object will be key value paired column name and value.",operationId:`${t.tableName.toLowerCase()}-bulk-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{}}}}},patch:{summary:`${t.tableName} bulk  update`,description:"To update multiple records using it's primary key you can use this api. Bulk updated api accepts array object in which each object should contain it's primary columns value mapped to corresponding alias. In addition to primary key you can include the fields which you want to update",operationId:`${t.tableName.toLowerCase()}-bulk-update`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{}}}}},delete:{summary:`${t.tableName} bulk delete by IDs`,description:"To delete multiple records using it's primary key you can use this api. Bulk delete api accepts array object in which each object should contain it's primary columns value mapped to corresponding alias.",operationId:`${t.tableName.toLowerCase()}-bulk-delete`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{}}}}}},[`/api/v1/db/data/bulk/${t.orgs}/${t.baseName}/${t.tableName}/all`]:{parameters:[s.whereParam],patch:{summary:`${t.tableName} Bulk update with conditions`,description:"This api helps you update multiple table rows in a single api call. You don't have to pass the record id instead you can filter records and apply the changes to filtered records. Payload is similar as normal update in which you can pass any partial row data to be updated.",operationId:`${t.tableName.toLowerCase()}-bulk-update-all`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{}}}}},delete:{summary:"Bulk delete with conditions",description:"This api helps you delete multiple table rows in a single api call. You don't have to pass the record id instead you can filter records and delete filtered records.",operationId:`${t.tableName.toLowerCase()}-bulk-delete-all`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName]}}},c(t.columns)?{[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/{rowId}/{relationType}/{columnName}`]:{parameters:[s.rowIdParam,s.relationTypeParam,(0,s.columnNameParam)(t.columns)],get:{summary:"Relation row list",operationId:`${t.tableName.toLowerCase()}-nested-list`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],parameters:[s.limitParam,s.offsetParam]}},[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/{rowId}/{relationType}/{columnName}/{refRowId}`]:{parameters:[s.rowIdParam,s.relationTypeParam,(0,s.columnNameParam)(t.columns),s.referencedRowIdParam],post:{summary:"Relation row add",operationId:`${t.tableName.toLowerCase()}-nested-add`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],parameters:[s.limitParam,s.shuffleParam,s.offsetParam],description:""},delete:{summary:"Relation row remove",operationId:`${t.tableName.toLowerCase()}-nested-remove`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName]}},[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/{rowId}/{relationType}/{columnName}/exclude`]:{parameters:[s.rowIdParam,s.relationTypeParam,(0,s.columnNameParam)(t.columns)],get:{summary:"Referenced tables rows excluding current records children/parent",operationId:`${t.tableName.toLowerCase()}-nested-children-excluded-list`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[t.tableName],parameters:[s.limitParam,s.shuffleParam,s.offsetParam]}}}:{}):{}),{[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/export/{type}`]:{parameters:[s.exportTypeParam],get:{summary:"Rows export",operationId:`${t.tableName.toLowerCase()}-csv-export`,description:"Export all the records from a table.Currently we are only supports `csv` export.",tags:[t.tableName],responses:{200:{description:"OK",content:{"application/octet-stream":{schema:{}}},headers:r.csvExportResponseHeader}},parameters:[s.csvExportOffsetParam]}}});function l(e){return{type:"object",properties:{list:{type:"array",items:{$ref:`#/components/schemas/${e}`}},PageInfo:{$ref:"#/components/schemas/Paginated"}}}}function c(e){return e.some((e=>(0,i.isLinksOrLTAR)(e.column)&&!e.column.system))}t.getViewPaths=async(e,t)=>Object.assign(Object.assign({[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/views/${t.viewName}`]:Object.assign({get:{summary:`${t.viewName} list`,operationId:`${t.tableName}-${t.viewName}-row-list`,description:`List of all rows from ${t.viewName} grid view and data of fields can be filtered based on query params. Data and fields in a grid view will be filtered and sorted by default based on the applied options in Dashboard.`,tags:[`${t.viewName} ( ${t.tableName} grid )`],parameters:[s.fieldsParam,s.sortParam,s.whereParam,...await(0,s.getNestedParams)(e,t.columns)],responses:{200:{description:"OK",content:{"application/json":{schema:l(`${t.tableName}${t.viewName}GridResponse`)}}}}}},t.type===i.ModelTypes.TABLE?{post:{summary:`${t.viewName} create`,description:"Insert a new row in table by providing a key value pair object where key refers to the column alias. All the required fields should be included with payload excluding `autoincrement` and column with default value.",operationId:`${t.tableName}-${t.viewName}-row-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[`${t.viewName} ( ${t.tableName} grid )`],requestBody:{content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}${t.viewName}GridRequest`}}}}}}:{}),[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/views/${t.viewName}/count`]:{get:{summary:`${t.viewName} count`,operationId:`${t.tableName}-${t.viewName}-row-count`,description:"",tags:[`${t.viewName} ( ${t.tableName} grid )`],parameters:[s.whereParam],responses:{200:{description:"OK",content:{"application/json":{schema:{type:"object",properties:{count:{type:"number"}}}}}}}}}},t.type===i.ModelTypes.TABLE?{[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/views/${t.viewName}/{rowId}`]:{parameters:[s.rowIdParam],get:{summary:`${t.viewName} read`,description:"Read a row data by using the **primary key** column value.",operationId:`${t.tableName}-${t.viewName}-row-read`,responses:{200:{description:"Created",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}${t.viewName}GridResponse`}}}}},tags:[`${t.viewName} ( ${t.tableName} grid )`]},patch:{summary:`${t.viewName} update`,description:"Partial update row in table by providing a key value pair object where key refers to the column alias. You need to only include columns which you want to update.",operationId:`${t.tableName}-${t.viewName}-row-update`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[`${t.viewName} ( ${t.tableName} grid )`],requestBody:{content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}${t.viewName}GridRequest`}}}}},delete:{summary:`${t.viewName} delete`,operationId:`${t.tableName}-${t.viewName}-row-delete`,responses:{200:{description:"OK"}},tags:[`${t.viewName} ( ${t.tableName} grid )`],description:"Delete a row by using the **primary key** column value."}}}:{}),{[`/api/v1/db/data/${t.orgs}/${t.baseName}/${t.tableName}/views/${t.viewName}/export/{type}`]:{parameters:[s.exportTypeParam],get:{summary:`${t.viewName} export`,operationId:`${t.tableName}-${t.viewName}-row-export`,description:"Export all the records from a table view. Currently we are only supports `csv` export.",tags:[`${t.viewName} ( ${t.tableName} grid )`],responses:{200:{description:"OK",content:{"application/octet-stream":{schema:{}}},headers:r.csvExportResponseHeader}},parameters:[]}}})},95732:function(e,t){"use strict";var a=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.getViewSchemas=t.getModelSchemas=void 0;t.getModelSchemas=e=>{var t,i;return{[`${e.tableName}Response`]:{title:`${e.tableName} Response`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(t=e.columns)||void 0===t?void 0:t.reduce(((e,t)=>{var{title:i,virtual:s,column:r}=t,l=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),{[i]:l})}),{}))||{})},[`${e.tableName}Request`]:{title:`${e.tableName} Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(i=e.columns)||void 0===i?void 0:i.reduce(((e,t)=>{var{title:i,virtual:s,column:r}=t,l=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),s?{}:{[i]:l})}),{}))||{})}}};t.getViewSchemas=e=>{var t,i;return{[`${e.tableName}${e.viewName}GridResponse`]:{title:`${e.tableName} : ${e.viewName} Response`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(t=e.columns)||void 0===t?void 0:t.reduce(((e,t)=>{var{title:i,virtual:s,column:r}=t,l=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),{[i]:l})}),{}))||{})},[`${e.tableName}${e.viewName}GridRequest`]:{title:`${e.tableName} : ${e.viewName} Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(i=e.columns)||void 0===i?void 0:i.reduce(((e,t)=>{var{title:i,virtual:s,column:r}=t,l=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),s?{}:{[i]:l})}),{}))||{})}}}},50520:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,{model:t,columns:a,views:i},l=r.default.ncMeta){return await(0,s.getModelPaths)(e,{tableName:t.title,tableId:t.id,views:i,type:t.type,columns:a})};const s=a(92),r=i(a(76584))},65652:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({base:e,model:t,columns:a},i=r.default.ncMeta){return(0,s.getModelSchemas)({tableName:t.title,orgs:"v1",baseName:e.title,columns:a})};const s=a(64212),r=i(a(76584))},60988:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(71040),r=i(a(10024)),l=i(a(76584));t.default=async(e,t,a,i=l.default.ncMeta)=>{const c=await a.getSources().then((e=>{var t;return null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.type}));return Promise.all(t.map((async t=>{const a={title:t.title,type:"object",virtual:!0,column:t};switch(t.uidt){case s.UITypes.LinkToAnotherRecord:{const s=await t.getColOptions(e,i);if(s){const t=await s.getRelatedTable(e,i);a.type=void 0,a.$ref=`#/components/schemas/${t.title}Request`}}break;case s.UITypes.Formula:case s.UITypes.Lookup:a.type="object";break;case s.UITypes.Rollup:case s.UITypes.Links:a.type="number";break;case s.UITypes.Attachment:a.type="array",a.items={$ref:"#/components/schemas/Attachment"};break;case s.UITypes.LastModifiedTime:case s.UITypes.CreatedTime:a.type="string";break;case s.UITypes.LastModifiedBy:case s.UITypes.CreatedBy:a.type="object";break;default:a.virtual=!1,r.default.setSwaggerType(t,a,c)}return a})))}},8944:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,a,i=u.default.ncMeta){const p=Object.assign(Object.assign({},r.default),{paths:{},components:Object.assign(Object.assign({},r.default.components),{schemas:Object.assign({},r.default.components.schemas)})});for(const r of a){let a={};const u=await(0,d.default)(e,await r.getColumns(e,i),t,i),m=[];for(const t of await r.getViews(e,!1,i)||[])t.type===s.ViewTypes.GRID&&m.push({view:t,columns:await t.getColumns(e,i)});r.mm||(a=await(0,l.default)(e,{model:r,columns:u,views:m},i));const _=await(0,c.default)({base:t,model:r,columns:u,views:m},i);Object.assign(p.paths,a),Object.assign(p.components.schemas,_)}return p};const s=a(71040),r=i(a(50096)),l=i(a(50520)),c=i(a(65652)),d=i(a(60988)),u=i(a(76584))},4580:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNestedParams=t.nestedOffsetParam=t.nestedLimitParam=t.nestedSortParam=t.nestedFieldParam=t.nestedWhereParam=t.csvExportOffsetParam=t.exportTypeParam=t.referencedRowIdParam=t.viewIdParams=t.linkFieldNameParam=t.columnNameQueryParam=t.shuffleParam=t.offsetParam=t.limitParam=t.whereParam=t.sortParam=t.fieldsParam=t.recordIdParam=void 0;const i=a(71040);t.recordIdParam={schema:{type:"string"},name:"recordId",in:"path",required:!0,example:1,description:"Primary key of the record you want to read. If the table have composite primary key then combine them by using `___` and pass it as primary key."},t.fieldsParam={schema:{type:"string"},in:"query",name:"fields",description:"Array of field names or comma separated filed names to include in the response objects. In array syntax pass it like `fields[]=field1&fields[]=field2` or alternately `fields=field1,field2`."},t.sortParam={schema:{type:"string"},in:"query",name:"sort",description:"Comma separated field names to sort rows, rows will sort in ascending order based on provided columns. To sort in descending order provide `-` prefix along with column name, like `-field`. Example : `sort=field1,-field2`"},t.whereParam={schema:{type:"string"},in:"query",name:"where",description:"This can be used for filtering rows, which accepts complicated where conditions. For more info visit [here](https://docs.nocodb.com/developer-resources/rest-apis#comparison-operators). Example : `where=(field1,eq,value)`"},t.limitParam={schema:{type:"number",minimum:1},in:"query",name:"limit",description:"The `limit` parameter used for pagination, the response collection size depends on limit value with default value `25` and maximum value `1000`, which can be overridden by environment variables `DB_QUERY_LIMIT_DEFAULT` and `DB_QUERY_LIMIT_MAX` respectively.",example:25},t.offsetParam={schema:{type:"number",minimum:0},in:"query",name:"offset",description:"The `offset` parameter used for pagination, the value helps to select collection from a certain index.",example:0},t.shuffleParam={schema:{type:"number",minimum:0,maximum:1},in:"query",name:"shuffle",description:"The `shuffle` parameter used for pagination, the response will be shuffled if it is set to 1.",example:0},t.columnNameQueryParam={schema:{type:"string"},in:"query",name:"column_name",description:"Column name of the column you want to group by, eg. `column_name=column1`"};t.linkFieldNameParam=e=>{const t=[],a=["**Links Field Identifier** corresponding to the relation field `Links` established between tables.\n\nLink Columns:"];for(const{column:s}of e)(0,i.isLinksOrLTAR)(s)&&!s.system&&(t.push(s.id),a.push(`* ${s.id} - ${s.title}`));return{schema:{type:"string",enum:t},name:"linkFieldId",in:"path",required:!0,description:a.join("\n")}};t.viewIdParams=e=>{const t=[],a=["Allows you to fetch records that are currently visible within a specific view.\n\nViews:"];for(const{view:i}of e)t.push(i.id),a.push(`* ${i.id} - ${i.is_default?"Default view":i.title}`);return{schema:{type:"string",enum:t},description:a.join("\n"),name:"viewId",in:"query",required:!1}},t.referencedRowIdParam={schema:{type:"string"},name:"refRowId",in:"path",required:!0},t.exportTypeParam={schema:{type:"string",enum:["csv","excel"]},name:"type",in:"path",required:!0},t.csvExportOffsetParam={schema:{type:"number",minimum:0},in:"query",name:"offset",description:"Helps to start export from a certain index. You can get the next set of data offset from previous response header named `nc-export-offset`.",example:0};t.nestedWhereParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][where]`,description:`This can be used for filtering rows in nested column \`${e}\`, which accepts complicated where conditions. For more info visit [here](https://docs.nocodb.com/developer-resources/rest-apis#comparison-operators). Example : \`nested[${e}][where]=(field1,eq,value)\``});t.nestedFieldParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][fields]`,description:`Array of field names or comma separated filed names to include in the in nested column \`${e}\` result. In array syntax pass it like \`fields[]=field1&fields[]=field2.\`. Example : \`nested[${e}][fields]=field1,field2\``});t.nestedSortParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][sort]`,description:`Comma separated field names to sort rows in nested column \`${e}\` rows, it will sort in ascending order based on provided columns. To sort in descending order provide \`-\` prefix along with column name, like \`-field\`. Example : \`nested[${e}][sort]=field1,-field2\``});t.nestedLimitParam=e=>({schema:{type:"number",minimum:1},in:"query",name:`nested[${e}][limit]`,description:`The \`limit\` parameter used for pagination of nested \`${e}\` rows, the response collection size depends on limit value and default value is \`25\`.`,example:"25"});t.nestedOffsetParam=e=>({schema:{type:"number",minimum:0},in:"query",name:`nested[${e}][offset]`,description:`The \`offset\` parameter used for pagination  of nested \`${e}\` rows, the value helps to select collection from a certain index.`,example:0});t.getNestedParams=async(e,a)=>await a.reduce((async(a,{column:s})=>{if(s.uidt===i.UITypes.LinkToAnotherRecord&&!s.system){return(await s.getColOptions(e)).type!==i.RelationTypes.BELONGS_TO?[...await a,(0,t.nestedWhereParam)(s.title),(0,t.nestedOffsetParam)(s.title),(0,t.nestedLimitParam)(s.title),(0,t.nestedFieldParam)(s.title),(0,t.nestedSortParam)(s.title)]:[...await a,(0,t.nestedFieldParam)(s.title)]}return a}),Promise.resolve([]))},92:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getModelPaths=void 0;const i=a(71040),s=a(4580),r=a(75760);t.getModelPaths=async(e,t)=>{return Object.assign({[`/api/v2/tables/${t.tableId}/records`]:Object.assign({get:{summary:`${t.tableName} list`,operationId:`${t.tableName.toLowerCase()}-db-table-row-list`,description:`List of all rows from ${t.tableName} ${t.type} and response data fields can be filtered based on query params.`,tags:[t.tableName],parameters:[(0,s.viewIdParams)(t.views),s.fieldsParam,s.sortParam,s.whereParam,s.limitParam,s.shuffleParam,s.offsetParam,...await(0,s.getNestedParams)(e,t.columns)],responses:{200:{description:"OK",content:{"application/json":{schema:(a=`${t.tableName}Response`,{type:"object",properties:{list:{type:"array",items:{$ref:`#/components/schemas/${a}`}},PageInfo:{$ref:"#/components/schemas/Paginated"}}})}}}}}},t.type===i.ModelTypes.TABLE?{post:{summary:`${t.tableName} create`,description:"Insert a new row in table by providing a key value pair object where key refers to the column alias. All the required fields should be included with payload excluding `autoincrement` and column with default value.",operationId:`${t.tableName.toLowerCase()}-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Response`}}}},400:{$ref:"#/components/responses/BadRequest"}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{oneOf:[{$ref:`#/components/schemas/${t.tableName}Request`},{type:"array",items:{$ref:`#/components/schemas/${t.tableName}Request`}}]}}}}},patch:{summary:`${t.tableName} update`,operationId:`${t.tableName.toLowerCase()}-update`,description:"Partial update row in table by providing a key value pair object where key refers to the column alias. You need to only include columns which you want to update.",responses:{200:{description:"OK",content:{"application/json":{schema:{}}}},400:{$ref:"#/components/responses/BadRequest"}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{oneOf:[{$ref:`#/components/schemas/${t.tableName}Request`},{type:"array",items:{$ref:`#/components/schemas/${t.tableName}Request`}}]}}}}},delete:{summary:`${t.tableName} delete`,operationId:`${t.tableName.toLowerCase()}-delete`,responses:{200:{description:"OK"}},tags:[t.tableName],description:"Delete a row by using the **primary key** column value.",requestBody:{content:{"application/json":{schema:{oneOf:[{$ref:`#/components/schemas/${t.tableName}IdRequest`},{type:"array",items:{$ref:`#/components/schemas/${t.tableName}IdRequest`}}]}}}}}}:{}),[`/api/v2/tables/${t.tableId}/records/{recordId}`]:{get:{parameters:[s.recordIdParam,s.fieldsParam],summary:`${t.tableName} read`,description:"Read a row data by using the **primary key** column value.",operationId:`${t.tableName.toLowerCase()}-read`,tags:[t.tableName],responses:{201:{description:"Created",content:{"application/json":{schema:{$ref:`#/components/schemas/${t.tableName}Response`}}}}}}},[`/api/v2/tables/${t.tableId}/records/count`]:{parameters:[(0,s.viewIdParams)(t.views)],get:{summary:`${t.tableName} count`,operationId:`${t.tableName.toLowerCase()}-count`,description:"Get rows count of a table by applying optional filters.",tags:[t.tableName],parameters:[s.whereParam],responses:{200:{description:"OK",content:{"application/json":{schema:{type:"object",properties:{count:{type:"number"}},required:["list","pageInfo"]},examples:{"Example 1":{value:{count:3}}}}}},400:{$ref:"#/components/responses/BadRequest"}}}}},(0,r.isRelationExist)(t.columns)?{[`/api/v2/tables/${t.tableId}/links/{linkFieldId}/records/{recordId}`]:{parameters:[(0,s.linkFieldNameParam)(t.columns),s.recordIdParam],get:{summary:"Link Records list",operationId:`${t.tableName.toLowerCase()}-nested-list`,description:"This API endpoint allows you to retrieve list of linked records for a specific `Link field` and `Record ID`. The response is an array of objects containing Primary Key and its corresponding display value.",tags:[t.tableName],parameters:[s.fieldsParam,s.sortParam,s.whereParam,s.limitParam,s.offsetParam],responses:{200:{description:"OK",content:{"application/json":{schema:{type:"object",properties:{list:{type:"array",description:"List of data objects",items:{type:"object"}},pageInfo:{$ref:"#/components/schemas/Paginated",description:"Paginated Info"}},required:["list","pageInfo"]}}}},400:{$ref:"#/components/responses/BadRequest"}}},post:{summary:"Link Records",operationId:`${t.tableName.toLowerCase()}-nested-link`,responses:{200:{description:"OK",content:{"application/json":{schema:{},examples:{"Example 1":{value:!0}}}}},400:{$ref:"#/components/responses/BadRequest"}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{oneOf:[{type:"object"},{type:"array",items:{type:"object"}}]},examples:{"Example 1":{value:[{Id:4},{Id:5}]},"Example 2":{value:{Id:4}}}}}},description:"This API endpoint allows you to link records to a specific `Link field` and `Record ID`. The request payload is an array of record-ids from the adjacent table for linking purposes. Note that any existing links, if present, will be unaffected during this operation.",parameters:[s.recordIdParam]},delete:{summary:"Unlink Records",operationId:`${t.tableName.toLowerCase()}-nested-unlink`,responses:{200:{description:"OK",content:{"application/json":{schema:{},examples:{"Example 1":{value:!0}}}}},400:{$ref:"#/components/responses/BadRequest"}},tags:[t.tableName],requestBody:{content:{"application/json":{schema:{oneOf:[{type:"array",items:{type:"object"}}]},examples:{"Example 1":{value:[{Id:1},{Id:2}]}}}}},description:"This API endpoint allows you to unlink records from a specific `Link field` and `Record ID`. The request payload is an array of record-ids from the adjacent table for unlinking purposes. Note that, \n- duplicated record-ids will be ignored.\n- non-existent record-ids will be ignored.",parameters:[s.recordIdParam]}}}:{});var a}},64212:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.getViewSchemas=t.getModelSchemas=void 0;const s=a(71040);t.getModelSchemas=e=>{var t,a,r;return{[`${e.tableName}Response`]:{title:`${e.tableName} Response`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(t=e.columns)||void 0===t?void 0:t.reduce(((e,t)=>{var{title:a,virtual:s,column:r}=t,l=i(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),r.system?{}:{[a]:l})}),{}))||{})},[`${e.tableName}Request`]:{title:`${e.tableName} Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(a=e.columns)||void 0===a?void 0:a.reduce(((e,t)=>{var a,{title:r,virtual:l,column:c}=t,d=i(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),l||(0,s.isSystemColumn)(c)||c.ai||(null===(a=c.meta)||void 0===a?void 0:a.ag)?{}:{[r]:d})}),{}))||{})},[`${e.tableName}IdRequest`]:{title:`${e.tableName} Id Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(r=e.columns)||void 0===r?void 0:r.reduce(((e,t)=>{var{title:a,virtual:s,column:r}=t,l=i(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),r.pk?{[a]:l}:{})}),{}))||{})}}};t.getViewSchemas=e=>{var t,a;return{[`${e.tableName}${e.viewName}GridResponse`]:{title:`${e.tableName} : ${e.viewName} Response`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(t=e.columns)||void 0===t?void 0:t.reduce(((e,t)=>{var{title:a,virtual:s,column:r}=t,l=i(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),{[a]:l})}),{}))||{})},[`${e.tableName}${e.viewName}GridRequest`]:{title:`${e.tableName} : ${e.viewName} Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(a=e.columns)||void 0===a?void 0:a.reduce(((e,t)=>{var{title:a,virtual:s,column:r}=t,l=i(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),s?{}:{[a]:l})}),{}))||{})}}}},26580:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiTokensService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43820),p=a(43468),m=a(19684);let _=class ApiTokensService{constructor(e){this.appHooksService=e}async apiTokenList(e){return await m.ApiToken.list(e.userId)}async apiTokenCreate(e){return(0,p.validatePayload)("swagger.json#/components/schemas/ApiTokenReq",e.tokenBody),this.appHooksService.emit(c.AppEvents.API_TOKEN_CREATE,{userId:e.userId,tokenBody:e.tokenBody,req:e.req}),await m.ApiToken.insert(Object.assign(Object.assign({},e.tokenBody),{fk_user_id:e.userId}))}async apiTokenDelete(e){var t;const a=await m.ApiToken.get(e.tokenId);return(0,c.extractRolesObj)(e.user.roles)[c.OrgUserRoles.SUPER_ADMIN]||a.fk_user_id===e.user.id||u.NcError.notFound("Token not found"),this.appHooksService.emit(c.AppEvents.API_TOKEN_DELETE,{userId:null===(t=e.user)||void 0===t?void 0:t.id,tokenId:e.tokenId,req:e.req}),await m.ApiToken.delete(e.tokenId)}};t.ApiTokensService=_,t.ApiTokensService=_=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],_)},83920:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AppHooksListenerService=void 0;const d=a(23324),u=a(71040),p=a(62304),m=a(19684),_=a(87424),f=a(52144);let h=i=class AppHooksListenerService{constructor(e,t){this.appHooksService=e,this.telemetryService=t,this.logger=new d.Logger(i.name)}async hookHandler({event:e,data:t}){var a;switch(e){case u.AppEvents.PROJECT_INVITE:{const e=t;await this.auditInsert({base_id:e.base.id,op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.INVITE,user:e.invitedBy.email,description:`invited ${e.user.email} to ${e.base.id} base `,ip:e.ip});const a=await m.User.count();this.telemetryService.sendEvent({evt_type:"base:invite",count:a})}break;case u.AppEvents.PROJECT_USER_UPDATE:{const e=t;await this.auditInsert({base_id:e.base.id,op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.ROLES_MANAGEMENT,user:e.updatedBy.email,description:`Roles for ${e.user.email} with has been updated to ${e.baseUser.roles}`,ip:e.ip})}break;case u.AppEvents.PROJECT_USER_RESEND_INVITE:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.RESEND_INVITE,user:e.user.email,description:`${e.user.email} has been re-invited`,ip:e.ip,base_id:e.base.id})}break;case u.AppEvents.USER_PASSWORD_CHANGE:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.PASSWORD_CHANGE,user:e.user.email,description:"Password has been changed",ip:e.ip})}break;case u.AppEvents.USER_PASSWORD_FORGOT:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.PASSWORD_FORGOT,user:e.user.email,description:"Password Reset has been requested",ip:e.ip})}break;case u.AppEvents.USER_PASSWORD_RESET:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.PASSWORD_RESET,user:e.user.email,description:"Password has been reset",ip:e.ip})}break;case u.AppEvents.USER_EMAIL_VERIFICATION:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.EMAIL_VERIFICATION,user:e.user.email,description:"Email has been verified",ip:e.ip})}break;case u.AppEvents.TABLE_CREATE:{const e=t;await this.auditInsert({base_id:e.table.base_id,source_id:e.table.source_id,op_type:u.AuditOperationTypes.TABLE,op_sub_type:u.AuditOperationSubTypes.CREATE,user:null===(a=e.user)||void 0===a?void 0:a.email,description:`Table ${e.table.table_name} with alias ${e.table.title} has been created`,ip:e.ip})}break;case u.AppEvents.TABLE_DELETE:{const{table:e,ip:a,user:i}=t;await this.auditInsert({base_id:e.base_id,source_id:e.source_id,op_type:u.AuditOperationTypes.TABLE,op_sub_type:u.AuditOperationSubTypes.DELETE,user:null==i?void 0:i.email,description:`Deleted ${e.type} ${e.table_name} with alias ${e.title}  `,ip:a})}break;case u.AppEvents.COLUMN_UPDATE:{const{column:e,ip:a,user:i,table:s}=t;await this.auditInsert({base_id:e.base_id,op_type:u.AuditOperationTypes.TABLE_COLUMN,op_sub_type:u.AuditOperationSubTypes.UPDATE,user:null==i?void 0:i.email,description:`The column ${e.column_name} with alias ${e.title} from table ${s.table_name} has been updated`,ip:a})}break;case u.AppEvents.COLUMN_CREATE:{const{column:e,ip:a,user:i,table:s}=t;await this.auditInsert({base_id:s.base_id,op_type:u.AuditOperationTypes.TABLE_COLUMN,op_sub_type:u.AuditOperationSubTypes.CREATE,user:null==i?void 0:i.email,description:`The column ${e.column_name} with alias ${e.title} from table ${s.table_name} has been created`,ip:a})}break;case u.AppEvents.COLUMN_DELETE:{const{column:e,ip:a,user:i,table:s}=t;await this.auditInsert({base_id:e.base_id,op_type:u.AuditOperationTypes.TABLE_COLUMN,op_sub_type:u.AuditOperationSubTypes.DELETE,user:null==i?void 0:i.email,description:`The column ${e.column_name} with alias ${e.title} from table ${s.table_name} has been deleted`,ip:a})}break;case u.AppEvents.USER_SIGNIN:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.SIGNIN,user:e.user.email,ip:e.ip,description:e.auditDescription})}break;case u.AppEvents.USER_SIGNUP:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.AUTHENTICATION,op_sub_type:u.AuditOperationSubTypes.SIGNUP,user:e.user.email,description:"User has signed up",ip:e.ip})}break;case u.AppEvents.ORG_USER_INVITE:{const e=t;this.telemetryService.sendEvent({evt_type:"org:user:invite",count:e.count}),await this.auditInsert({op_type:u.AuditOperationTypes.ORG_USER,op_sub_type:u.AuditOperationSubTypes.INVITE,user:e.invitedBy.email,description:`${e.user.email} has been invited to the organisation`,ip:e.ip})}break;case u.AppEvents.ORG_USER_RESEND_INVITE:{const e=t;await this.auditInsert({op_type:u.AuditOperationTypes.ORG_USER,op_sub_type:u.AuditOperationSubTypes.RESEND_INVITE,user:e.invitedBy.email,description:`${e.user.email} has been re-invited`,ip:e.ip})}break;case u.AppEvents.ATTACHMENT_UPLOAD:this.telemetryService.sendEvent({evt_type:"image:uploaded",type:null==t?void 0:t.type});break;case u.AppEvents.WEBHOOK_TRIGGER:this.telemetryService.sendEvent({evt_type:"webhook:trigger",type:null==t?void 0:t.type})}}onModuleDestroy(){var e;null===(e=this.unsubscribe)||void 0===e||e.call(this)}onModuleInit(){this.unsubscribe=this.appHooksService.onAll(this.hookHandler.bind(this))}async auditInsert(e){await m.Audit.insert(e);try{p.T.event(Object.assign(Object.assign({},e),{created_at:Date.now()}))}catch(e){this.logger.error(e)}}};t.AppHooksListenerService=h,t.AppHooksListenerService=h=i=l([(0,d.Injectable)(),c("design:paramtypes",["function"==typeof(s=void 0!==f.AppHooksService&&f.AppHooksService)?s:Object,"function"==typeof(r=void 0!==_.TelemetryService&&_.TelemetryService)?r:Object])],h)},52144:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppHooksService=void 0;const c=a(23324),d=a(61436),u="__nc_all_events__";let p=class AppHooksService{constructor(e){this.eventEmitter=e,this.listenerUnsubscribers=new Map}on(e,t){const a=this.eventEmitter.on(e,t);return this.listenerUnsubscribers.set(t,a),a}emit(e,t){this.eventEmitter.emit(e,t),this.eventEmitter.emit(u,{event:e,data:t})}removeListener(e,t){var a;null===(a=this.listenerUnsubscribers.get(t))||void 0===a||a(),this.listenerUnsubscribers.delete(t)}removeListeners(e){return this.eventEmitter.removeAllListeners(e)}removeAllListener(e){var t;null===(t=this.listenerUnsubscribers.get(e))||void 0===t||t(),this.listenerUnsubscribers.delete(e)}onAll(e){const t=this.eventEmitter.on(u,e);return this.listenerUnsubscribers.set(e,t),t}};t.AppHooksService=p,t.AppHooksService=p=s([(0,c.Injectable)(),l(0,(0,c.Inject)("IEventEmitter")),r("design:paramtypes",["function"==typeof(i=void 0!==d.IEventEmitter&&d.IEventEmitter)?i:Object])],p)},58504:function(e,t,a){"use strict";var i,s,r,l=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&l(t,e,a);return c(t,e),t},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},_=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentsService=void 0;const f=_(a(67072)),h=_(a(78716)),g=a(71040),y=a(23324),b=a(92080),w=_(a(92696)),v=_(a(27216)),T=_(a(71178)),k=_(a(54784)),S=_(a(43936)),M=a(52144),O=_(a(23080)),I=u(a(55420)),C=a(19684),E=a(36616),x=a(43820),L=a(892),R=a(81472),N=a(64612),A=a(19176),D=_(a(76584)),j=["image/"],P=e=>e.replace(/[\\/:*?"<>'`#|%~{}[\]^]/g,"_");let q=i=class AttachmentsService{constructor(e,t){this.appHooksService=e,this.jobsService=t,this.logger=new y.Logger(i.name)}async upload(e){var t,a,i,s,r;const l=(null===(t=e.req)||void 0===t?void 0:t.user.id)||"anonymous";e.path=e.path||`${(0,S.default)().format("YYYY/MM/DD")}/${(0,k.default)(l)}`;const c=this.sanitizeUrlPath((null===(i=null===(a=e.path)||void 0===a?void 0:a.toString())||void 0===i?void 0:i.split("/"))||[""]),d=f.default.join("nc","uploads",...c),u=await O.default.storageAdapter(),p=new v.default({concurrency:1}),m=[],_=[];if((null===(s=e.files)||void 0===s?void 0:s.length)||x.NcError.badRequest("No attachment provided!"),p.addAll(null===(r=e.files)||void 0===r?void 0:r.map((e=>async()=>{try{const t=(0,E.utf8ify)(e.originalname),a=`${P(f.default.parse(t).name)}_${(0,b.nanoid)(5)}${f.default.extname(t)}`,i={};if(e.mimetype.includes("image")){const t=D.default.sharp;if(t)try{const a=await t(e.path,{limitInputPixels:!1}).metadata();a.width&&a.height&&(i.width=a.width,i.height=a.height)}catch(t){this.logger.error(`${e.path} is not an image file`)}}const s=await u.fileCreate((0,w.default)(f.default.join(d,a)),e);await C.FileReference.insert({workspace_id:N.RootScopes.ROOT,base_id:N.RootScopes.ROOT},{storage:u.name,file_url:null!=s?s:f.default.join("download",c.join("/"),a),file_size:e.size,fk_user_id:l,deleted:!0});const r=Object.assign(Object.assign(Object.assign({},s?{url:s}:{path:f.default.join("download",c.join("/"),a)}),{title:t,mimetype:e.mimetype,size:e.size,icon:I.mimeIcons[f.default.extname(t).slice(1)]||void 0}),i);await C.PresignedUrl.signAttachment({attachment:r}),m.push(r)}catch(e){_.push(e)}}))),await p.onIdle(),_.length){for(const e of _)this.logger.error(e);throw _[0]}const h=m.filter((e=>j.some((t=>e.mimetype.startsWith(t)))));return h.length&&await this.jobsService.add(R.JobTypes.ThumbnailGenerator,{context:{base_id:N.RootScopes.ROOT,workspace_id:N.RootScopes.ROOT},attachments:h}),this.appHooksService.emit(g.AppEvents.ATTACHMENT_UPLOAD,{type:"file",req:e.req}),m}async uploadViaURL(e){var t,a,i,s,r,l;const c=(null===(t=e.req)||void 0===t?void 0:t.user.id)||"anonymous";e.path=e.path||`${(0,S.default)().format("YYYY/MM/DD")}/${(0,k.default)(c)}`;const d=this.sanitizeUrlPath((null===(i=null===(a=null==e?void 0:e.path)||void 0===a?void 0:a.toString())||void 0===i?void 0:i.split("/"))||[""]),u=f.default.join("nc","uploads",...d),p=await O.default.storageAdapter(),m=new v.default({concurrency:1}),_=[],y=[];if((null===(s=e.urls)||void 0===s?void 0:s.length)||x.NcError.badRequest("No attachment provided!"),m.addAll(null===(l=null===(r=e.urls)||void 0===r?void 0:r.map)||void 0===l?void 0:l.call(r,(e=>async()=>{var t;try{const{url:a,fileName:i}=e;let s,r,l,m=a;a.startsWith("data:")||(r=await T.default.head(a,{maxRedirects:5}),s=null===(t=r.headers["content-type"])||void 0===t?void 0:t.split(";")[0],l=r.headers["content-length"],m=r.request.res.responseUrl);const g=h.default.parse(m,!0),y=decodeURIComponent(g.pathname),v=i||f.default.basename(y),k=`${P(f.default.parse(v).name)}_${(0,b.nanoid)(5)}${f.default.extname(v)}`;s||(s=I.default[f.default.extname(v).slice(1)]);const{url:S,data:M}=await p.fileCreateByUrl((0,w.default)(f.default.join(u,k)),m,{fetchOptions:{buffer:s.includes("image")}}),O={};if(s.includes("image")){const e=D.default.sharp;if(e)try{const t=await e(M,{limitInputPixels:!0}).metadata();t.width&&t.height&&(O.width=t.width,O.height=t.height)}catch(e){this.logger.error(`${M.path} is not an image file`)}}await C.FileReference.insert({workspace_id:N.RootScopes.ROOT,base_id:N.RootScopes.ROOT},{storage:p.name,file_url:null!=S?S:f.default.join("download",d.join("/"),k),file_size:l?parseInt(l):e.size,fk_user_id:c,deleted:!0});const E=Object.assign(Object.assign(Object.assign({},S?{url:S}:{path:f.default.join("download",d.join("/"),k)}),{title:v,mimetype:s||e.mimetype,size:l?parseInt(l):e.size,icon:I.mimeIcons[f.default.extname(v).slice(1)]||void 0}),O);await C.PresignedUrl.signAttachment({attachment:E}),_.push(E)}catch(e){y.push(e)}}))),await m.onIdle(),y.length)throw y.forEach((e=>this.logger.error(e))),y[0];const M=_.filter((e=>j.some((t=>e.mimetype.startsWith(t)))));return M.length&&await this.jobsService.add(R.JobTypes.ThumbnailGenerator,{context:{base_id:N.RootScopes.ROOT,workspace_id:N.RootScopes.ROOT},attachments:M}),this.appHooksService.emit(g.AppEvents.ATTACHMENT_UPLOAD,{type:"url",req:e.req}),_}async getFile(e){const t=I.default[f.default.extname(e.path).split("/").pop().slice(1)]||"text/plain";return{path:(0,A.validateAndNormaliseLocalPath)(e.path,!0),type:t}}async getAttachmentFromRecord(e){const{record:t,column:a,urlOrPath:i}=e,s=t[a.title];s&&s.length||x.NcError.genericNotFound("Attachment",i);const r=s.find((e=>e.url===i||e.path===i));return r||x.NcError.genericNotFound("Attachment",i),await C.PresignedUrl.signAttachment({attachment:r,preview:!1,filename:r.title,expireSeconds:300}),Object.assign({},(null==r?void 0:r.path)?{path:r.signedPath}:{url:r.signedUrl})}sanitizeUrlPath(e){return e.map((e=>e.replace(/[/.?#]+/g,"_")))}};t.AttachmentsService=q,t.AttachmentsService=q=i=d([(0,y.Injectable)(),m(1,(0,y.Inject)((0,y.forwardRef)((()=>"JobsService")))),p("design:paramtypes",["function"==typeof(s=void 0!==M.AppHooksService&&M.AppHooksService)?s:Object,"function"==typeof(r=void 0!==L.IJobsService&&L.IJobsService)?r:Object])],q)},15404:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuditsService=void 0;const d=a(23324),u=c(a(68552)),p=a(71040),m=a(83920),_=a(43468),f=a(19684),h=a(52144);let g=class AuditsService{constructor(e,t){this.appHooksListenerService=e,this.appHooksService=t}async auditRowUpdate(e,t){var a;(0,_.validatePayload)("swagger.json#/components/schemas/AuditRowUpdateReq",t.body);const i=await f.Model.getByIdOrName(e,{id:t.body.fk_model_id});return await f.Audit.insert({fk_model_id:t.body.fk_model_id,row_id:t.rowId,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.UPDATE,description:u.default.sanitize(`Table ${i.table_name} : field ${t.body.column_name} got changed from  ${t.body.prev_value} to ${t.body.value}`),details:u.default.sanitize(`<span class="">${t.body.column_name}</span>\n  : <span class="text-decoration-line-through red px-2 lighten-4 black--text">${t.body.prev_value}</span>\n  <span class="black--text green lighten-4 px-2">${t.body.value}</span>`),ip:t.clientIp,user:null===(a=t.user)||void 0===a?void 0:a.email})}async auditOnlyList(e){return await f.Audit.auditList(e.query)}async auditList(e){return await f.Audit.baseAuditList(e.baseId,e.query)}async auditCount(e){return await f.Audit.baseAuditCount(e.baseId,e.query)}async sourceAuditList(e){return await f.Audit.sourceAuditList(e.sourceId,e.query)}async sourceAuditCount(e){return await f.Audit.sourceAuditCount(e.sourceId)}async projectAuditList(e){return await f.Audit.projectAuditList(e.query)}async projectAuditCount(){return await f.Audit.projectAuditCount()}};t.AuditsService=g,t.AuditsService=g=r([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==m.AppHooksListenerService&&m.AppHooksListenerService)?i:Object,"function"==typeof(s=void 0!==h.AppHooksService&&h.AppHooksService)?s:Object])],g)},54024:function(e,t,a){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&s(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseUsersService=void 0;const p=a(23324),m=a(71040),_=a(81104),f=c(a(58016)),h=u(a(33848)),g=a(43468),y=u(a(76584)),b=a(52144),w=a(43820),v=u(a(23080)),T=a(99572),k=a(36616),S=a(19684),M=a(64612),O=a(70220),I=a(78599),C=a(62304);let E=class BaseUsersService{constructor(e){this.appHooksService=e}async userList(e,t){const a=await S.BaseUser.getUsersList(e,{base_id:t.baseId,mode:t.mode});return new T.PagedResponseImpl(a,{count:a.length})}async userInvite(e,t){var a,i,s,r;(0,g.validatePayload)("swagger.json#/components/schemas/ProjectUserReq",t.baseUser),(0,I.getProjectRolePower)({base_roles:(0,m.extractRolesObj)(t.baseUser.roles)})>(0,I.getProjectRolePower)(t.req.user)&&w.NcError.badRequest("Insufficient privilege to invite with this role"),[m.ProjectRoles.OWNER,m.ProjectRoles.CREATOR,m.ProjectRoles.EDITOR,m.ProjectRoles.COMMENTER,m.ProjectRoles.VIEWER,m.ProjectRoles.NO_ACCESS].includes(t.baseUser.roles)||w.NcError.badRequest("Invalid role");const l=(t.baseUser.email||"").toLowerCase().split(/\s*,\s*/).map((e=>e.trim())),c=l.filter((e=>!h.default.isEmail(e)));if(!l.length)return w.NcError.badRequest("Invalid email address");c.length&&w.NcError.badRequest("Invalid email address : "+c.join(", "));const d=(0,_.v4)(),u=[];for(const c of l){const p=await S.User.getByEmail(c),_=await S.Base.get(e,t.baseId);if(!_)return w.NcError.baseNotFound(t.baseId);if(p){const s=await S.BaseUser.get(e,t.baseId,p.id),r=await S.Base.get(e,t.baseId);if(!r)return w.NcError.baseNotFound(t.baseId);(null==s?void 0:s.is_mapped)&&(null==s?void 0:s.roles)?w.NcError.badRequest(`${p.email} with role ${s.roles} already exists in this base`):(null==s?void 0:s.is_mapped)?await S.BaseUser.updateRoles(e,t.baseId,p.id,t.baseUser.roles):await S.BaseUser.insert(e,{base_id:t.baseId,fk_user_id:p.id,roles:t.baseUser.roles||"editor",invited_by:null===(i=null===(a=t.req)||void 0===a?void 0:a.user)||void 0===i?void 0:i.id}),this.appHooksService.emit(m.AppEvents.PROJECT_INVITE,{base:r,user:p,invitedBy:t.req.user,ip:t.req.clientIp,req:t.req})}else try{const a=await S.User.insert({invite_token:d,invite_token_expires:new Date(Date.now()+864e5),email:c,roles:m.OrgUserRoles.VIEWER,token_version:(0,k.randomTokenString)()});if(await S.BaseUser.insert(e,{base_id:t.baseId,fk_user_id:a.id,roles:t.baseUser.roles,invited_by:null===(r=null===(s=t.req)||void 0===s?void 0:s.user)||void 0===r?void 0:r.id}),this.appHooksService.emit(m.AppEvents.PROJECT_INVITE,{base:_,user:a,invitedBy:t.req.user,ip:t.req.clientIp,req:t.req}),1===l.length&&!await this.sendInviteEmail(c,d,t.req))return{invite_token:d,email:c};this.sendInviteEmail(c,d,t.req)}catch(e){if(console.log(e),1===l.length)throw e;u.push({email:c,error:e.message})}}return 1===l.length?{msg:"The user has been invited successfully"}:{invite_token:d,emails:l,error:u}}async baseUserUpdate(e,t){var a;(0,g.validatePayload)("swagger.json#/components/schemas/ProjectUserReq",t.baseUser),t.baseId||w.NcError.badRequest("Missing base id");const i=await S.Base.get(e,t.baseId);if(!i)return w.NcError.baseNotFound(t.baseId);[m.ProjectRoles.OWNER,m.ProjectRoles.CREATOR,m.ProjectRoles.EDITOR,m.ProjectRoles.COMMENTER,m.ProjectRoles.VIEWER,m.ProjectRoles.NO_ACCESS].includes(t.baseUser.roles)||w.NcError.badRequest("Invalid role");const s=await S.User.get(t.userId);s||w.NcError.badRequest(`User with id '${t.userId}' doesn't exist`);const r=await S.User.getWithRoles(e,t.userId,{user:s,baseId:t.baseId});if(r||w.NcError.badRequest(`User with id '${t.userId}' doesn't exist in this base`),null===(a=(0,m.extractRolesObj)(r.base_roles))||void 0===a?void 0:a[m.ProjectRoles.OWNER]){1===(await S.BaseUser.getUsersList(e,{base_id:t.baseId})).filter((e=>{var t;return null===(t=e.roles)||void 0===t?void 0:t.includes(m.ProjectRoles.OWNER)})).length&&w.NcError.badRequest("At least one owner is required")}return(0,I.getProjectRolePower)(r)>(0,I.getProjectRolePower)(t.req.user)&&w.NcError.badRequest("Insufficient privilege to update user"),await S.BaseUser.updateRoles(e,t.baseId,t.userId,t.baseUser.roles),this.appHooksService.emit(m.AppEvents.PROJECT_USER_UPDATE,{base:i,user:s,updatedBy:t.req.user,ip:t.req.clientIp,baseUser:t.baseUser,req:t.req}),{msg:"User has been updated successfully"}}async baseUserDelete(e,t){var a,i,s,r,l;const c=t.baseId;(null===(a=t.req.user)||void 0===a?void 0:a.id)===t.userId&&w.NcError.badRequest("Admin can't delete themselves!");const d=await S.User.get(t.userId);d||w.NcError.userNotFound(t.userId),(null===(s=null===(i=t.req.user)||void 0===i?void 0:i.base_roles)||void 0===s?void 0:s.owner)||(null===(r=d.roles)||void 0===r?void 0:r.split(",").includes("super"))&&w.NcError.forbidden("Insufficient privilege to delete a super admin user.");const u=await S.User.getWithRoles(e,t.userId,{baseId:c});if((0,I.getProjectRolePower)(u.base_roles)>(0,I.getProjectRolePower)(t.req.user)&&w.NcError.badRequest("Insufficient privilege to delete user"),null===(l=(0,m.extractRolesObj)(u.base_roles))||void 0===l?void 0:l[m.ProjectRoles.OWNER]){1===(await S.BaseUser.getUsersList(e,{base_id:t.baseId})).filter((e=>{var t;return null===(t=e.roles)||void 0===t?void 0:t.includes(m.ProjectRoles.OWNER)})).length&&w.NcError.badRequest("At least one owner is required")}return t.req.user.id===t.userId&&t.req.user.roles.includes("owner")&&w.NcError.badRequest("Admin can't delete themselves!"),await S.BaseUser.delete(e,c,t.userId),!0}async baseUserInviteResend(e,t){const a=await S.User.get(t.userId);a||w.NcError.badRequest(`User with id '${t.userId}' not found`);const i=await S.Base.get(e,t.baseId);if(!i)return w.NcError.baseNotFound(t.baseId);const s=(0,_.v4)();await S.User.update(a.id,{invite_token:s,invite_token_expires:new Date(Date.now()+864e5)});return await y.default.ncMeta.metaGet2(e.workspace_id,e.base_id,M.MetaTable.PLUGIN,{category:m.PluginCategory.EMAIL,active:!0})||w.NcError.badRequest("No Email Plugin is found. Please go to App Store to configure first or copy the invitation URL to users instead."),await this.sendInviteEmail(a.email,s,t.req),this.appHooksService.emit(m.AppEvents.PROJECT_USER_RESEND_INVITE,{base:i,user:a,invitedBy:t.req.user,ip:t.req.clientIp,baseUser:t.baseUser,req:t.req}),!0}async sendInviteEmail(e,t,i){var s,r,l,d;try{const u=(await Promise.resolve().then((()=>c(a(11536))))).default,p=await v.default.emailAdapter();if(p)return await p.mailSend({to:e,subject:"Verify email",html:f.render(u,{signupLink:`${i.ncSiteUrl}${null===(s=y.default.getConfig())||void 0===s?void 0:s.dashboardPath}#/signup/${t}`,baseName:(0,C.sanitiseEmailContent)(null===(r=i.body)||void 0===r?void 0:r.baseName),roles:(0,C.sanitiseEmailContent)(((null===(l=i.body)||void 0===l?void 0:l.roles)||"").split(",").map((e=>e.replace(/^./,(e=>e.toUpperCase())))).join(", ")),adminEmail:null===(d=i.user)||void 0===d?void 0:d.email})}),!0}catch(e){throw console.log("Warning : `mailSend` failed, Please configure emailClient configuration.",e.message),e}}async baseUserMetaUpdate(e,t){var a,i,s,r;const l=(0,O.extractProps)(t.body,["starred","order","hidden"]);return Object.keys(l).length&&((null===(i=await S.BaseUser.get(e,t.baseId,null===(a=t.user)||void 0===a?void 0:a.id))||void 0===i?void 0:i.is_mapped)?await S.BaseUser.update(e,t.baseId,null===(r=t.user)||void 0===r?void 0:r.id,l):await S.BaseUser.insert(e,Object.assign(Object.assign({},l),{base_id:t.baseId,fk_user_id:null===(s=t.user)||void 0===s?void 0:s.id}))),!0}};t.BaseUsersService=E,t.BaseUsersService=E=l([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(i=void 0!==b.AppHooksService&&b.AppHooksService)?i:Object])],E)},11536:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n    <meta name="viewport" content="width=device-width">\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n    <title>Simple Transactional Email</title>\n    <style>\n        @media only screen and (max-width: 620px) {\n            table[class=body] h1 {\n                font-size: 28px !important;\n                margin-bottom: 10px !important;\n            }\n\n            table[class=body] p,\n            table[class=body] ul,\n            table[class=body] ol,\n            table[class=body] td,\n            table[class=body] span,\n            table[class=body] a {\n                font-size: 16px !important;\n            }\n\n            table[class=body] .wrapper,\n            table[class=body] .article {\n                padding: 10px !important;\n            }\n\n            table[class=body] .content {\n                padding: 0 !important;\n            }\n\n            table[class=body] .container {\n                padding: 0 !important;\n                width: 100% !important;\n            }\n\n            table[class=body] .main {\n                border-left-width: 0 !important;\n                border-radius: 0 !important;\n                border-right-width: 0 !important;\n            }\n\n            table[class=body] .btn table {\n                width: 100% !important;\n            }\n\n            table[class=body] .btn a {\n                width: 100% !important;\n            }\n\n            table[class=body] .img-responsive {\n                height: auto !important;\n                max-width: 100% !important;\n                width: auto !important;\n            }\n        }\n\n        @media all {\n            .ExternalClass {\n                width: 100%;\n            }\n\n            .ExternalClass,\n            .ExternalClass p,\n            .ExternalClass span,\n            .ExternalClass font,\n            .ExternalClass td,\n            .ExternalClass div {\n                line-height: 100%;\n            }\n\n            .apple-link a {\n                color: inherit !important;\n                font-family: inherit !important;\n                font-size: inherit !important;\n                font-weight: inherit !important;\n                line-height: inherit !important;\n                text-decoration: none !important;\n            }\n\n            #MessageViewBody a {\n                color: inherit;\n                text-decoration: none;\n                font-size: inherit;\n                font-family: inherit;\n                font-weight: inherit;\n                line-height: inherit;\n            }\n\n            .btn-primary table td:hover {\n                background-color: #34495e !important;\n            }\n\n            .btn-primary a:hover {\n                background-color: #34495e !important;\n                border-color: #34495e !important;\n            }\n        }\n    </style>\n</head>\n<body class=""\n      style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader"\n      style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">This is preheader text. Some clients will show this text as a preview.</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body"\n       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;"\n       width="100%" bgcolor="#f6f6f6">\n    <tr>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n        <td class="container"\n            style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;"\n            width="580" valign="top">\n            <div class="content"\n                 style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n                \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n                <table role="presentation" class="main"\n                       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;"\n                       width="100%">\n\n                    \x3c!-- START MAIN CONTENT AREA --\x3e\n                    <tr>\n                        <td class="wrapper"\n                            style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;"\n                            valign="top">\n                            <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                   style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                                   width="100%">\n                                <tr>\n                                    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;"\n                                        valign="top">\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Hi,</p>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            You have been invited to become "<%= roles -%>" of the NocoDB base "<%= baseName %>".\n                                            Click the button below to accept the invitation.</p>\n                                        <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                               class="btn btn-primary"\n                                               style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; box-sizing: border-box; width: 100%;"\n                                               width="100%">\n                                            <tbody>\n                                            <tr>\n                                                <td align="left"\n                                                    style="font-family: sans-serif; font-size: 14px; vertical-align: top; padding-bottom: 15px;"\n                                                    valign="top">\n                                                    <table role="presentation" border="0" cellpadding="0"\n                                                           cellspacing="0"\n                                                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: auto;">\n                                                        <tbody>\n                                                        <tr>\n                                                            <td style="font-family: sans-serif; font-size: 14px; vertical-align: top; border-radius: 5px; text-align: center; background-color: #3498db;"\n                                                                valign="top" align="center" bgcolor="#1088ff"><a\n                                                                        href="<%= signupLink %>" target="_blank"\n                                                                        style="border: solid 1px rgb(23, 139, 255); border-radius: 5px; box-sizing: border-box; cursor: pointer; display: inline-block; font-size: 14px; font-weight: bold; margin: 0; padding: 12px 25px; text-decoration: none; text-transform: capitalize; background-color: rgb(23, 139, 255); border-color: #3498db; color: #ffffff;">Signup</a>\n                                                            </td>\n                                                        </tr>\n                                                        </tbody>\n                                                    </table>\n                                                </td>\n                                            </tr>\n                                            </tbody>\n                                        </table>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Have a nice day,<br><%= adminEmail %></p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    \x3c!-- END MAIN CONTENT AREA --\x3e\n                </table>\n                \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n                \x3c!-- START FOOTER --\x3e\n                <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                           width="100%">\n                        <tr>\n                            <td class="content-block"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <span class="apple-link"\n                                      style="color: #999999; font-size: 12px; text-align: center;"></span>\n                                \x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="content-block powered-by"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <a href="http://nocodb.com/">NocoDB</a>\n                                \x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                \x3c!-- END FOOTER --\x3e\n\n            </div>\n        </td>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    </tr>\n</table>\n</body>\n</html>\n'},40668:function(e,t,a){"use strict";var i,s,r,l=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&l(t,e,a);return c(t,e),t},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BasesService=void 0;const _=a(50970),f=a(23324),h=u(a(68552)),g=a(92080),y=a(71040),b=a(52144),w=a(43468),v=a(43820),T=a(70220),k=m(a(47660)),S=a(19684),M=m(a(76584)),O=a(39143),I=a(49804),C=a(64612),E=a(69680),x=(0,g.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",4);let L=class BasesService{constructor(e,t,a){this.appHooksService=e,this.metaService=t,this.tablesService=a}async baseList(e,t){var a;return(0,y.extractRolesObj)(null===(a=t.user)||void 0===a?void 0:a.roles)[y.OrgUserRoles.SUPER_ADMIN]?await S.Base.list():await S.BaseUser.getProjectsList(t.user.id,t.query)}async getProjectWithInfo(e,t){const{includeConfig:a=!0}=t;return await S.Base.getWithInfo(e,t.baseId,a)}sanitizeProject(e){var t;const a=Object.assign({},e);return null===(t=a.sources)||void 0===t||t.forEach((e=>{["config"].forEach((t=>delete e[t]))})),a}async baseUpdate(e,t){(0,w.validatePayload)("swagger.json#/components/schemas/ProjectUpdateReq",t.base);const a=await S.Base.getWithInfo(e,t.baseId),i=(0,T.extractPropsAndSanitize)(null==t?void 0:t.base,["title","meta","color","status","order"]);await this.validateProjectTitle(e,i,a),void 0!==(null==i?void 0:i.order)&&(i.order=isNaN(+i.order)?0:+i.order);const s=await S.Base.update(e,t.baseId,i);return this.appHooksService.emit(y.AppEvents.PROJECT_UPDATE,{base:a,user:t.user,req:t.req}),s}async validateProjectTitle(e,t,a){(null==t?void 0:t.title)&&a.title!==t.title&&await S.Base.getByTitle({workspace_id:C.RootScopes.BASE,base_id:C.RootScopes.BASE},t.title)&&v.NcError.badRequest("Base title already in use")}async baseSoftDelete(e,t){const a=await S.Base.getWithInfo(e,t.baseId);return a||v.NcError.baseNotFound(t.baseId),await S.Base.softDelete(e,t.baseId),this.appHooksService.emit(y.AppEvents.PROJECT_DELETE,{base:a,user:t.user,req:t.req}),!0}async baseCreate(e){var t,i,s,r,l,c,d,u;(0,w.validatePayload)("swagger.json#/components/schemas/ProjectReq",e.base);const p=await this.metaService.genNanoid(C.MetaTable.PROJECT),m=e.base;if(m.id=p,m.external){process.env.NC_CONNECT_TO_EXTERNAL_DB_DISABLED&&v.NcError.badRequest("Connecting to external db is disabled");for(const t of m.sources||[])if(!t.fk_integration_id){const a=await S.Integration.createIntegration({title:t.alias||m.title,type:y.IntegrationsType.Database,sub_type:null===(r=t.config)||void 0===r?void 0:r.client,is_private:!!(null===(l=e.req.user)||void 0===l?void 0:l.id),config:t.config,workspaceId:null===(c=e.req)||void 0===c?void 0:c.ncWorkspaceId,created_by:null===(d=e.req.user)||void 0===d?void 0:d.id});t.fk_integration_id=a.id,t.config={client:null===(u=m.config)||void 0===u?void 0:u.client}}m.is_meta=!1}else{const e=x();m.prefix=`nc_${e}__`,m.is_meta=!0;const r=await(null===(i=null===(t=M.default.getConfig())||void 0===t?void 0:t.meta)||void 0===i?void 0:i.db);if("pg"===(null==r?void 0:r.client)&&"true"!==process.env.NC_DISABLE_PG_DATA_REFLECTION)m.prefix="",m.sources=[{type:"pg",is_local:!0,is_meta:!1,config:{schema:p},inflection_column:"camelize",inflection_table:"camelize"}];else if("sqlite3"===(null==r?void 0:r.client)&&"true"===process.env.NC_MINIMAL_DBS){const e=a(2058),t=(0,O.getToolDir)(),i=(0,g.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);await(0,_.promisify)(e.exists)(`${t}/nc_minimal_dbs`)||await(0,_.promisify)(e.mkdir)(`${t}/nc_minimal_dbs`);const s=i(),r=h.sanitize(m.title);m.prefix="",m.sources=[{type:"sqlite3",is_meta:!1,is_local:!0,config:{client:"sqlite3",connection:{client:"sqlite3",database:r,connection:{filename:`${t}/nc_minimal_dbs/${r}_${s}.db`}}},inflection_column:"camelize",inflection_table:"camelize"}]}else{const e=null===(s=M.default.getConfig().meta)||void 0===s?void 0:s.db;m.sources=[{type:null==e?void 0:e.client,config:null,is_meta:!0,inflection_column:"camelize",inflection_table:"camelize"}]}}(null==m?void 0:m.title.length)>50&&v.NcError.badRequest("Base title exceeds 50 characters"),m.title=h.sanitize(m.title),m.slug=m.title;const f=await S.Base.createProject(m),b={workspace_id:f.fk_workspace_id,base_id:f.id};await S.BaseUser.insert(b,{fk_user_id:e.user.id,base_id:f.id,roles:"owner"}),await(0,k.default)(f);for(const t of await f.getSources())if("true"!==process.env.NC_CLOUD&&!f.is_meta){const a=await(0,w.populateMeta)(b,t,f);this.appHooksService.emit(y.AppEvents.APIS_CREATED,{info:a,req:e.req}),t.config=void 0}return this.appHooksService.emit(y.AppEvents.PROJECT_CREATE,{base:f,user:e.user,xcdb:!m.external,req:e.req}),f}async createDefaultBase(e){const t=await this.baseCreate({base:{title:"Getting Started",type:"database"},user:e.user,req:e.req}),a={workspace_id:t.fk_workspace_id,base_id:t.id},i=y.SqlUiFactory.create({client:t.sources[0].type}),s=null==i?void 0:i.getNewTableColumns(),r=await this.tablesService.tableCreate(a,{baseId:t.id,sourceId:t.sources[0].id,table:{title:"Features",table_name:"Features",columns:s},user:e.user});return t.tables=[r],t}};t.BasesService=L,t.BasesService=L=d([(0,f.Injectable)(),p("design:paramtypes",["function"==typeof(i=void 0!==b.AppHooksService&&b.AppHooksService)?i:Object,"function"==typeof(s=void 0!==I.MetaService&&I.MetaService)?s:Object,"function"==typeof(r=void 0!==E.TablesService&&E.TablesService)?r:Object])],L)},26272:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BulkDataAliasService=void 0;const r=a(23324),l=a(44980),c=s(a(82096)),d=a(19684);let u=class BulkDataAliasService{async getModelViewBase(e,t){const{model:a,view:i}=await(0,l.getViewAndModelByAliasOrId)(e,t);return{model:a,view:i,source:await d.Source.get(e,a.source_id)}}async executeBulkOperation(e,t){const{model:a,view:i,source:s}=await this.getModelViewBase(e,t),r=await d.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await c.default.get(s)});return await r[t.operation].apply(null,t.options)}async bulkDataInsert(e,t){return await this.executeBulkOperation(e,Object.assign(Object.assign({},t),{operation:"bulkInsert",options:[t.body,{cookie:t.cookie,foreign_key_checks:t.foreign_key_checks,skip_hooks:t.skip_hooks,raw:t.raw,allowSystemColumn:t.allowSystemColumn}]}))}async bulkDataUpdate(e,t){return await this.executeBulkOperation(e,Object.assign(Object.assign({},t),{operation:"bulkUpdate",options:[t.body,{cookie:t.cookie,raw:t.raw}]}))}async bulkDataUpdateAll(e,t){return await this.executeBulkOperation(e,Object.assign(Object.assign({},t),{operation:"bulkUpdateAll",options:[t.query,t.body,{cookie:t.cookie}]}))}async bulkDataDelete(e,t){return await this.executeBulkOperation(e,Object.assign(Object.assign({},t),{operation:"bulkDelete",options:[t.body,{cookie:t.cookie}]}))}async bulkDataDeleteAll(e,t){return await this.executeBulkOperation(e,Object.assign(Object.assign({},t),{operation:"bulkDeleteAll",options:[t.query]}))}};t.BulkDataAliasService=u,t.BulkDataAliasService=u=i([(0,r.Injectable)()],u)},73548:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CachesService=void 0;const r=a(23324),l=s(a(57804));let c=class CachesService{async cacheGet(){return await l.default.export()}async cacheDelete(){return await l.default.destroy(),!0}};t.CachesService=c,t.CachesService=c=i([(0,r.Injectable)()],c)},70636:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CalendarDatasService=void 0;const d=a(23324),u=a(71040),p=c(a(44578)),m=a(19684),_=a(43820),f=a(68144);let h=i=class CalendarDatasService{constructor(e){this.datasService=e,this.logger=new d.Logger(i.name)}async getCalendarDataList(e,t){var a;const{viewId:i,query:s,from_date:r,to_date:l}=t;r&&l||_.NcError.badRequest("from_date and to_date are required"),(0,p.default)(l).diff((0,p.default)(r),"days")>42&&_.NcError.badRequest("Date range should not exceed 42 days");const c=await m.View.get(e,i);c||_.NcError.viewNotFound(i),c.type!==u.ViewTypes.CALENDAR&&_.NcError.badRequest("View is not a calendar view");const d=await m.CalendarRange.read(e,c.id);(null===(a=null==d?void 0:d.ranges)||void 0===a?void 0:a.length)||_.NcError.badRequest("No ranges found");const f=await this.buildFilterArr(e,{viewId:i,from_date:r,to_date:l});s.filterArrJson=JSON.stringify([...f,...s.filterArrJson?JSON.parse(s.filterArrJson):[]]);const h=await m.Model.getByIdOrName(e,{id:c.fk_model_id});return await this.datasService.dataList(e,Object.assign(Object.assign(Object.assign({},t),s),{viewName:c.id,baseName:h.base_id,tableName:h.id,limitOverride:3e3}))}async getPublicCalendarRecordCount(e,t){const{sharedViewUuid:a,password:i,query:s={}}=t,r=await m.View.getByUUID(e,a);return r||_.NcError.viewNotFound(a),r.type!==u.ViewTypes.CALENDAR&&_.NcError.notFound("View is not a calendar view"),r.password&&r.password!==i?_.NcError.invalidSharedViewPassword():this.getCalendarRecordCount(e,{viewId:r.id,query:s,from_date:t.from_date,to_date:t.to_date})}async getPublicCalendarDataList(e,t){const{sharedViewUuid:a,password:i,query:s={}}=t,r=await m.View.getByUUID(e,a);return r||_.NcError.viewNotFound(a),r.type!==u.ViewTypes.CALENDAR&&_.NcError.notFound("View is not a calendar view"),r.password&&r.password!==i?_.NcError.invalidSharedViewPassword():this.getCalendarDataList(e,{viewId:r.id,query:s,from_date:t.from_date,to_date:t.to_date})}async getCalendarRecordCount(e,t){var a;const{viewId:i,query:s,from_date:r,to_date:l}=t;r&&l||_.NcError.badRequest("from_date and to_date are required"),(0,p.default)(l).diff((0,p.default)(r),"days")>395&&_.NcError.badRequest("Date range should not exceed 395 days");const c=await m.View.get(e,i);c||_.NcError.viewNotFound(i),c.type!==u.ViewTypes.CALENDAR&&_.NcError.badRequest("View is not a calendar view");const d=await m.CalendarRange.read(e,c.id);(null==d?void 0:d.ranges.length)||_.NcError.badRequest("No ranges found");const f=await this.buildFilterArr(e,{viewId:i,from_date:r,to_date:l});s.filterArrJson=JSON.stringify([...f,...s.filterArrJson?JSON.parse(s.filterArrJson):[]]);const h=await m.Model.getByIdOrName(e,{id:c.fk_model_id}),g=await this.datasService.dataList(e,Object.assign(Object.assign({},t),{baseName:h.base_id,tableName:h.id,ignorePagination:!0}));g||_.NcError.notFound("Data not found");const y=[],b=await h.getColumns(e);return null===(a=null==d?void 0:d.ranges)||void 0===a||a.forEach((e=>{var t;const a=null===(t=b.find((t=>t.id===e.fk_from_column_id)))||void 0===t?void 0:t.title;g.list.forEach((e=>{const t=(0,p.default)(e[a]);a&&t.isValid()&&y.push(t.format("YYYY-MM-DD HH:mm:ssZ"))}))})),{count:y.length,dates:Array.from(new Set(y))}}async buildFilterArr(e,{viewId:t,from_date:a,to_date:i}){var s;const r=await m.CalendarRange.read(e,t);(null===(s=null==r?void 0:r.ranges)||void 0===s?void 0:s.length)||_.NcError.badRequest("No ranges found");const l={is_group:!0,logical_op:"and",children:[]};return null==r||r.ranges.forEach((e=>{const t=e.fk_from_column_id;let s=[];t&&(s=[{fk_column_id:t,comparison_op:"lt",comparison_sub_op:"exactDate",value:i},{fk_column_id:t,comparison_op:"gt",comparison_sub_op:"exactDate",value:a}]),s.length>0&&l.children.push(s)})),[l]}};t.CalendarDatasService=h,t.CalendarDatasService=h=i=r([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(s=void 0!==f.DatasService&&f.DatasService)?s:Object])],h)},10140:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CalendarsService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(43820),_=a(19684),f=l(a(57804)),h=a(64612);let g=class CalendarsService{constructor(e){this.appHooksService=e}async calendarViewGet(e,t){return await _.CalendarView.get(e,t.calendarViewId)}async calendarViewCreate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",t.calendar);const a=await _.Model.get(e,t.tableId),{id:i}=await _.View.insertMetaOnly(e,Object.assign(Object.assign({},t.calendar),{fk_model_id:t.tableId,type:d.ViewTypes.CALENDAR,base_id:a.base_id,source_id:a.source_id}),a),s=await _.View.get(e,i);return await f.default.appendToList(h.CacheScope.VIEW,[s.fk_model_id],`${h.CacheScope.VIEW}:${i}`),this.appHooksService.emit(d.AppEvents.VIEW_CREATE,{view:s,showAs:"calendar",user:t.user,req:t.req}),s}async calendarViewUpdate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/CalendarUpdateReq",t.calendar);const a=await _.View.get(e,t.calendarViewId);a||m.NcError.viewNotFound(t.calendarViewId);const i=await _.CalendarView.update(e,t.calendarViewId,t.calendar);return this.appHooksService.emit(d.AppEvents.VIEW_UPDATE,{view:a,showAs:"calendar",req:t.req}),i}};t.CalendarsService=g,t.CalendarsService=g=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],g)},74056:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnsService=t.Altered=void 0;const d=a(23324),u=a(71040),p=a(42496),m=c(a(54784)),_=a(26944),f=a(19684),h=a(52144),g=c(a(28148)),y=c(a(93260)),b=a(43468),w=a(43820),v=c(a(66368)),T=a(98644),k=c(a(22200)),S=c(a(51987)),M=c(a(76584)),O=c(a(82096)),I=a(64612),C=a(49804);var E;async function x(e,t,a){if(t[e])return t[e];const i=await a();return t[e]=i,i}!function(e){e[e.NEW_COLUMN=1]="NEW_COLUMN",e[e.DELETE_COLUMN=4]="DELETE_COLUMN",e[e.UPDATE_COLUMN=8]="UPDATE_COLUMN"}(E||(t.Altered=E={}));let L=class ColumnsService{constructor(e,t){this.metaService=e,this.appHooksService=t,this.deleteHmOrBtRelation=async(e,{relationColOpt:t,source:a,childColumn:i,childTable:s,parentColumn:r,parentTable:l,sqlMgr:c,ncMeta:d=M.default.ncMeta,virtual:p,custom:m=!1},_=!1)=>{var h,g,y,b;if(s&&!m){let m;if(m=t?t.fk_index_name:(null===(h=await s.getColumns(e,d).then((async t=>{for(const a of t)if(a.uidt===u.UITypes.LinkToAnotherRecord){const t=await a.getColOptions(e,d);if(t.fk_related_model_id===l.id)return{colOptions:t}}})))||void 0===h?void 0:h.colOptions).fk_index_name,!(null==t?void 0:t.virtual)&&!p)try{await c.sqlOpPlus(a,"relationDelete",{childColumn:i.column_name,childTable:s.table_name,parentTable:l.table_name,parentColumn:r.column_name,foreignKeyName:m})}catch(e){console.log(e.message)}}if(!t)return;const w=await t.getRelatedTable(e,d).then((t=>t.getColumns(e,d))),v="bt"===t.type?"hm":"bt";for(const t of w){if(!(0,u.isLinksOrLTAR)(t.uidt))continue;const a=await t.getColOptions(e,d);if(a.fk_parent_column_id===r.id&&a.fk_child_column_id===i.id&&a.type===v){await f.Column.delete(e,t.id,d);break}}if(await f.Column.delete(e,t.fk_column_id,d),!m&&!_&&i.uidt===u.UITypes.ForeignKey){const r=await f.Model.getWithInfo(e,{id:s.id},d);if(null==t?void 0:t.virtual){const e=null!==(b=null===(y=null===(g=await c.sqlOp(a,"indexList",{tn:r.table_name}))||void 0===g?void 0:g.data)||void 0===y?void 0:y.list)&&void 0!==b?b:[];for(const t of e)t.cn===i.column_name&&await c.sqlOpPlus(a,"indexDelete",Object.assign(Object.assign({},t),{tn:r.table_name,columns:[i.column_name],indexName:t.key_name}))}const l=Object.assign(Object.assign({},r),{tn:r.table_name,originalColumns:r.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:r.columns.map((e=>e.id===i.id?Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name,altered:E.DELETE_COLUMN}):(e.cn=e.column_name,e)))});await c.sqlOpPlus(a,"tableUpdate",l),await f.Column.delete(e,i.id,d)}},this.deleteOoRelation=async(e,{relationColOpt:t,source:a,childColumn:i,childTable:s,parentColumn:r,parentTable:l,sqlMgr:c,ncMeta:d=M.default.ncMeta,virtual:p,custom:m=!1},_=!1)=>{var h,g,y,b;if(s&&!m){let m;if(m=t?t.fk_index_name:(null===(h=await s.getColumns(e,d).then((async t=>{for(const a of t)if(a.uidt===u.UITypes.LinkToAnotherRecord){const t=await a.getColOptions(e,d);if(t.fk_related_model_id===l.id)return{colOptions:t}}})))||void 0===h?void 0:h.colOptions).fk_index_name,!(null==t?void 0:t.virtual)&&!p)try{await c.sqlOpPlus(a,"relationDelete",{childColumn:i.column_name,childTable:s.table_name,parentTable:l.table_name,parentColumn:r.column_name,foreignKeyName:m})}catch(e){console.log(e.message)}}if(!t)return;const w=await t.getRelatedTable(e,d).then((t=>t.getColumns(e,d))),v=u.RelationTypes.ONE_TO_ONE;for(const t of w){if(t.uidt!==u.UITypes.LinkToAnotherRecord)continue;const a=await t.getColOptions(e,d);if(a.fk_parent_column_id===r.id&&a.fk_child_column_id===i.id&&a.type===v){await f.Column.delete(e,t.id,d);break}}if(await f.Column.delete(e,t.fk_column_id,d),!m&&!_&&i.uidt===u.UITypes.ForeignKey){const r=await f.Model.getWithInfo(e,{id:s.id},d);if(null==t?void 0:t.virtual){const e=null!==(b=null===(y=null===(g=await c.sqlOp(a,"indexList",{tn:r.table_name}))||void 0===g?void 0:g.data)||void 0===y?void 0:y.list)&&void 0!==b?b:[];for(const t of e)t.cn===i.column_name&&await c.sqlOpPlus(a,"indexDelete",Object.assign(Object.assign({},t),{tn:r.table_name,columns:[i.column_name],indexName:t.key_name}))}const l=Object.assign(Object.assign({},r),{tn:r.table_name,originalColumns:r.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:r.columns.map((e=>e.id===i.id?Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name,altered:E.DELETE_COLUMN}):(e.cn=e.column_name,e)))});await c.sqlOpPlus(a,"tableUpdate",l),await f.Column.delete(e,i.id,d)}}}async updateFormulas(e,t){const{oldColumn:a,colBody:i}=t;if(a.column_name!==i.column_name||a.title!==i.title){const t=await M.default.ncMeta.knex(I.MetaTable.COL_FORMULA).where("formula","like",`%${a.id}%`);if(t){a.column_name=i.column_name,a.title=i.title;for(const i of t){const t=(0,u.substituteColumnIdWithAliasInFormula)(i.formula,[a]);await f.FormulaColumn.update(e,a.id,{formula_raw:t,parsed_tree:null})}}}}async columnUpdate(e,t){var a,i,s,r,l,c,d,p,m,h,T,k,S,M,I;const C=t.reuse||{},{cookie:L}=t,R=await f.Column.get(e,{colId:t.columnId}),N=await x("table",C,(async()=>f.Model.getWithInfo(e,{id:R.fk_model_id}))),A=await x("source",C,(async()=>f.Source.get(e,N.source_id)));t.column.description!==R.description&&await f.Column.update(e,t.columnId,{description:t.column.description});const D=(null==A?void 0:A.is_schema_readonly)&&u.partialUpdateAllowedTypes.includes(R.uidt);if((null==A?void 0:A.is_schema_readonly)&&(!u.readonlyMetaAllowedTypes.includes(R.uidt)||t.column.uidt&&!u.readonlyMetaAllowedTypes.includes(t.column.uidt))&&!u.partialUpdateAllowedTypes.includes(R.uidt))return await N.getColumns(e),this.appHooksService.emit(u.AppEvents.COLUMN_UPDATE,{table:N,column:R,user:null===(a=t.req)||void 0===a?void 0:a.user,ip:null===(i=t.req)||void 0===i?void 0:i.clientIp,req:t.req}),N;const j=await x("sqlClient",C,(async()=>O.default.getSqlClient(A))),P=j.knex.clientType(),q=f.Column.getMaxColumnNameLength(P);if((0,u.isVirtualCol)(t.column)||D||(t.column.column_name=(0,b.sanitizeColumnName)(t.column.column_name,A.type)),t.column.title&&(t.column.title=t.column.title.trim()),t.column.column_name&&!D){let a=t.column.column_name.slice(0,q-5),i=1;for(;!await f.Column.checkTitleAvailable(e,{column_name:a,fk_model_id:R.fk_model_id,exclude_id:t.columnId});)a=t.column.column_name.slice(0,q-5),a+="_"+i++;t.column.column_name=a}!D&&!(0,u.isVirtualCol)(t.column)&&t.column.column_name.length>q&&w.NcError.badRequest(`Column name ${t.column.column_name} exceeds ${q} characters`),t.column.title&&t.column.title.length>255&&w.NcError.badRequest(`Column title ${t.column.title} exceeds 255 characters`),(0,u.isVirtualCol)(t.column)||(0,u.isCreatedOrLastModifiedTimeCol)(t.column)||(0,u.isCreatedOrLastModifiedByCol)(t.column)||await f.Column.checkTitleAvailable(e,{column_name:t.column.column_name,fk_model_id:R.fk_model_id,exclude_id:t.columnId})||w.NcError.badRequest("Duplicate column name"),await f.Column.checkAliasAvailable(e,{title:t.column.title,fk_model_id:R.fk_model_id,exclude_id:t.columnId})||w.NcError.badRequest("Duplicate column alias");let U=Object.assign({},t.column);if(D||(0,u.isCreatedOrLastModifiedTimeCol)(R)||(0,u.isCreatedOrLastModifiedByCol)(R)||[u.UITypes.Lookup,u.UITypes.Rollup,u.UITypes.LinkToAnotherRecord,u.UITypes.Formula,u.UITypes.QrCode,u.UITypes.Barcode,u.UITypes.ForeignKey,u.UITypes.Links,u.UITypes.Button].includes(R.uidt))if(R.uidt===U.uidt){if([u.UITypes.QrCode,u.UITypes.Barcode].includes(R.uidt))await f.Column.update(e,R.id,Object.assign(Object.assign({},R),U));else if(R.uidt===u.UITypes.Formula){U.formula=await(0,u.substituteColumnAliasWithIdInFormula)(U.formula_raw||U.formula,N.columns),U.parsed_tree=await(0,u.validateFormulaAndExtractTreeWithType)({formula:U.formula||U.formula_raw,columns:N.columns,column:R,clientOrSqlUi:A.type,getMeta:async t=>{const a=await f.Model.get(e,t);return await a.getColumns(e),a}});try{const t=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:await x("dbDriver",C,(async()=>O.default.get(A)))})));await(0,g.default)(t,U.formula,null,N,null,{},null,!0,U.parsed_tree)}catch(e){console.error(e),w.NcError.badRequest("Invalid Formula")}await f.Column.update(e,R.id,Object.assign(Object.assign({},R),U))}else if(R.uidt===u.UITypes.Button){if("url"===U.type){U.formula=await(0,u.substituteColumnAliasWithIdInFormula)(U.formula_raw||U.formula,N.columns),U.parsed_tree=await(0,u.validateFormulaAndExtractTreeWithType)({formula:U.formula||U.formula_raw,columns:N.columns,column:R,clientOrSqlUi:A.type,getMeta:async t=>{const a=await f.Model.get(e,t);return await a.getColumns(e),a}});try{const t=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:await x("dbDriver",C,(async()=>O.default.get(A)))})));await(0,g.default)(t,U.formula,null,N,null,{},null,!0,U.parsed_tree)}catch(e){console.error(e),w.NcError.badRequest("Invalid Formula")}}else if("webhook"===U.type){U.fk_webhook_id||w.NcError.badRequest("Webhook not found");const t=await f.Hook.get(e,U.fk_webhook_id);t&&t.active&&"manual"===t.event||w.NcError.badRequest("Webhook not found")}await f.Column.update(e,R.id,Object.assign(Object.assign({},R),U))}else if(U.title!==R.title&&await f.Column.updateAlias(e,t.columnId,{title:U.title}),"meta"in U&&([u.UITypes.CreatedTime,u.UITypes.LastModifiedTime].includes(R.uidt)||D)&&await f.Column.updateMeta(e,{colId:t.columnId,meta:U.meta}),"validate"in U&&([u.UITypes.URL,u.UITypes.PhoneNumber,u.UITypes.Email].includes(R.uidt)||D)&&await f.Column.updateValidation(e,{colId:t.columnId,validate:U.validate}),(0,u.isLinksOrLTAR)(R)&&("meta"in U&&await f.Column.updateMeta(e,{colId:t.columnId,meta:Object.assign(Object.assign({},R.meta),U.meta)}),(null===U.childViewId||U.childViewId)&&(U.colOptions=U.colOptions||{},U.colOptions.fk_target_view_id=U.childViewId),(U.colOptions.fk_target_view_id||null===U.colOptions.fk_target_view_id)&&await f.Column.updateTargetView(e,{colId:t.columnId,fk_target_view_id:U.colOptions.fk_target_view_id})),[u.UITypes.Links,u.UITypes.LinkToAnotherRecord].includes(R.uidt)&&(null==U?void 0:U.column_order)&&(null===(s=U.column_order)||void 0===s?void 0:s.order)&&(null===(r=U.column_order)||void 0===r?void 0:r.view_id)){const t=(await f.View.getColumns(e,U.column_order.view_id)).find((e=>e.fk_column_id===R.id));await f.View.updateColumn(e,U.column_order.view_id,t.id,{order:U.column_order.order})}await this.updateRollupOrLookup(e,U,R)}else w.NcError.notImplemented(`Updating ${R.uidt} => ${U.uidt}`);else if([u.UITypes.Lookup,u.UITypes.Rollup,u.UITypes.LinkToAnotherRecord,u.UITypes.Formula,u.UITypes.QrCode,u.UITypes.Barcode,u.UITypes.ForeignKey].includes(U.uidt))w.NcError.notImplemented(`Updating ${U.uidt} => ${U.uidt}`);else if([u.UITypes.CreatedTime,u.UITypes.LastModifiedTime,u.UITypes.CreatedBy,u.UITypes.LastModifiedBy].includes(U.uidt))await f.Column.update(e,t.columnId,Object.assign(Object.assign({},R),{title:U.title}));else if([u.UITypes.SingleSelect,u.UITypes.MultiSelect].includes(U.uidt)){U=await(0,v.default)(U,A);const a=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:await x("dbDriver",C,(async()=>O.default.get(A)))})));if(null===(l=U.colOptions)||void 0===l?void 0:l.options){const i=["mysql","mysql2","pg","mssql","sqlite3"],s=(await x("dbDriver",C,(async()=>O.default.get(A)))).clientType();if(R.uidt===u.UITypes.MultiSelect&&U.uidt===u.UITypes.SingleSelect)"mysql"===s||"mysql2"===s?await j.raw("UPDATE ?? SET ?? = SUBSTRING_INDEX(??, ',', 1) WHERE ?? LIKE '%,%';",[a.getTnPath(N.table_name),R.column_name,R.column_name,R.column_name]):"pg"===s?await j.raw("UPDATE ?? SET ?? = split_part(??, ',', 1);",[a.getTnPath(N.table_name),R.column_name,R.column_name]):"mssql"===s?await j.raw("UPDATE ?? SET ?? = LEFT(cast(?? as varchar(max)), CHARINDEX(',', ??) - 1) WHERE CHARINDEX(',', ??) > 0;",[a.getTnPath(N.table_name),R.column_name,R.column_name,R.column_name,R.column_name]):"sqlite3"===s&&await j.raw("UPDATE ?? SET ?? = substr(??, 1, instr(??, ',') - 1) WHERE ?? LIKE '%,%';",[a.getTnPath(N.table_name),R.column_name,R.column_name,R.column_name,R.column_name]);else{const t=await x("dbDriver",C,(async()=>O.default.get(A))),a=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:t}))),i=await a.execAndParse(a.dbDriver.raw("SELECT DISTINCT ?? FROM ??",[R.column_name,a.getTnPath(N.table_name)]).toQuery(),null,{raw:!0});if(i.length&&R.uidt!==U.uidt){const e=U.colOptions.options.map((e=>e.title)),t=i.reduce(((t,a)=>{if(a[R.column_name]){const i=String(a[R.column_name]).split(",");i.length>1&&U.uidt===u.UITypes.SingleSelect&&w.NcError.badRequest("SingleSelect cannot have comma separated values, please use MultiSelect instead.");for(const a of i)e.includes(a.trim())||(t.push({title:a.trim()}),e.push(a.trim()))}return t}),[]);U.colOptions.options=[...U.colOptions.options,...t]}}if(null===(c=R.colOptions)||void 0===c?void 0:c.options)for(const e of R.colOptions.options.filter((e=>null===e.order)))e.title=e.title.replace(/^'/,"").replace(/'$/,"");const r=U.colOptions.options.map((e=>e.title.replace(/'/g,"''")));if(U.cdf){if(U.uidt===u.UITypes.SingleSelect)try{r.includes(U.cdf.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${U.cdf}' is not a select option.`)}catch(e){U.cdf=U.cdf.replace(/^'/,"").replace(/'$/,""),r.includes(U.cdf.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${U.cdf}' is not a select option.`)}else try{for(const e of U.cdf.split(","))r.includes(e.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${e}' is not a select option.`)}catch(e){U.cdf=U.cdf.replace(/^'/,"").replace(/'$/,"");for(const e of U.cdf.split(","))r.includes(e.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${e}' is not a select option.`)}U.cdf="pg"===s||"sqlite3"===s?U.cdf.replace(/'/g,"'"):U.cdf.replace(/'/g,"''"),"pg"===s&&(U.cdf=`'${U.cdf}'`)}const l=U.colOptions.options.map((e=>e.title));if(l.some((function(e){return l.indexOf(e)!==l.lastIndexOf(e)}))&&w.NcError.badRequest("Duplicates are not allowed!"),l.some((function(e){return""===e}))&&w.NcError.badRequest("Empty options are not allowed!"),"enum"===U.dt||"set"===U.dt)for(const e of U.colOptions.options)e.title=e.title.trimEnd();if(U.uidt===u.UITypes.SingleSelect?U.dtxp=(null===(d=U.colOptions)||void 0===d?void 0:d.options.length)?`${U.colOptions.options.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")}`:"":U.uidt===u.UITypes.MultiSelect&&(U.dtxp=(null===(p=U.colOptions)||void 0===p?void 0:p.options.length)?`${U.colOptions.options.map((e=>(e.title.includes(",")&&w.NcError.badRequest("Illegal char(',') for MultiSelect"),`'${e.title.replace(/'/gi,"''")}'`))).join(",")}`:""),"mysql"!==s&&"mysql2"!==s||(U.colOptions.options.length||U.dtxp&&""!==U.dtxp||(U.dtxp="''"),"set"===U.dt&&(null===(m=U.colOptions)||void 0===m?void 0:m.options.length)>64&&(U.dt="text")),null===(h=R.colOptions)||void 0===h?void 0:h.options)for(const e of R.colOptions.options.filter((e=>!U.colOptions.options.find((t=>t.id===e.id)))))i.includes(s)||R.uidt!==u.UITypes.MultiSelect||w.NcError.badRequest("Your database not yet supported for this operation. Please remove option from records manually before dropping."),R.uidt===u.UITypes.SingleSelect?"mssql"===s?await j.raw("UPDATE ?? SET ?? = NULL WHERE ?? LIKE ?",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.title]):await a.bulkUpdateAll({where:`(${R.title},eq,${e.title})`,skipValidationAndHooks:!0},{[R.column_name]:null},{cookie:L}):R.uidt===u.UITypes.MultiSelect&&("mysql"===s||"mysql2"===s?"set"===U.dt?await j.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), ',')) WHERE FIND_IN_SET(?, ??)",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.title,e.title,R.column_name]):await j.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), ','))",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.title]):"pg"===s?await j.raw("UPDATE ?? SET ??  = array_to_string(array_remove(string_to_array(??, ','), ?), ',')",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.title]):"mssql"===s?await j.raw("UPDATE ?? SET ?? = substring(replace(concat(',', ??, ','), concat(',', ?, ','), ','), 2, len(replace(concat(',', ??, ','), concat(',', ?, ','), ',')) - 2)",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.title,R.column_name,e.title]):"sqlite3"===s&&await j.raw("UPDATE ?? SET ?? = TRIM(REPLACE(',' || ?? || ',', ',' || ? || ',', ','), ',')",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.title]));const _=[];if(null===(T=R.colOptions)||void 0===T?void 0:T.options){const r=R.colOptions.options.map((e=>e.title));for(const l of R.colOptions.options.filter((e=>U.colOptions.options.find((t=>t.id===e.id&&t.title!==e.title))))){i.includes(s)||R.uidt!==u.UITypes.MultiSelect||w.NcError.badRequest("Your database not yet supported for this operation. Please remove option from records manually before updating.");const c=Object.assign({},U.colOptions.options.find((e=>l.id===e.id)));if(r.includes(c.title)){const e=Object.assign({},c);let t=1;for(;r.includes(c.title);)c.title=`${e.title}_${t++}`;_.push({def_option:e,temp_title:c.title})}if(!("mysql"!==s&&"mysql2"!==s||"enum"!==R.dt&&"set"!==R.dt)){R.colOptions.options.push({title:c.title});let a="";R.uidt===u.UITypes.SingleSelect?a=R.colOptions.options.length?`${R.colOptions.options.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")}`:"":R.uidt===u.UITypes.MultiSelect&&(a=R.colOptions.options.length?`${R.colOptions.options.map((e=>{if(e.title.includes(","))throw w.NcError.badRequest("Illegal char(',') for MultiSelect"),new Error("");return`'${e.title.replace(/'/gi,"''")}'`})).join(",")}`:"");const i=Object.assign(Object.assign({},N),{tn:N.table_name,originalColumns:N.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(N.columns.map((async e=>{if(e.id===t.columnId){const t=Object.assign(Object.assign(Object.assign({},e),R),{cn:R.column_name,cno:e.column_name,dtxp:a,altered:E.UPDATE_COLUMN});return Promise.resolve(t)}return e.cn=e.column_name,Promise.resolve(e)})))}),s=await x("sqlMgr",C,(async()=>y.default.getSqlMgr(e,{id:A.base_id})));await s.sqlOpPlus(A,"tableUpdate",i),await f.Column.update(e,t.columnId,Object.assign({},R))}R.uidt===u.UITypes.SingleSelect?"mssql"===s?await j.raw("UPDATE ?? SET ?? = ? WHERE ?? LIKE ?",[a.getTnPath(N.table_name),R.column_name,c.title,R.column_name,l.title]):await a.bulkUpdateAll({where:`(${R.title},eq,${l.title})`,skipValidationAndHooks:!0},{[R.column_name]:c.title},{cookie:L}):R.uidt===u.UITypes.MultiSelect&&("mysql"===s||"mysql2"===s?"set"===U.dt?await j.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ','))) WHERE FIND_IN_SET(?, ??)",[a.getTnPath(N.table_name),R.column_name,R.column_name,l.title,c.title,l.title,R.column_name]):await j.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ',')))",[a.getTnPath(N.table_name),R.column_name,R.column_name,l.title,c.title]):"pg"===s?await j.raw("UPDATE ?? SET ??  = array_to_string(array_replace(string_to_array(??, ','), ?, ?), ',')",[a.getTnPath(N.table_name),R.column_name,R.column_name,l.title,c.title]):"mssql"===s?await j.raw("UPDATE ?? SET ?? = substring(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ',')), 2, len(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ','))) - 2)",[a.getTnPath(N.table_name),R.column_name,R.column_name,l.title,c.title,R.column_name,l.title,c.title]):"sqlite3"===s&&await j.raw("UPDATE ?? SET ?? = TRIM(REPLACE(',' || ?? || ',', ',' || ? || ',', ',' || ? || ','), ',')",[a.getTnPath(N.table_name),R.column_name,R.column_name,l.title,c.title]))}}for(const e of _){const t=e.def_option;R.uidt===u.UITypes.SingleSelect?"mssql"===s?await j.raw("UPDATE ?? SET ?? = ? WHERE ?? LIKE ?",[a.getTnPath(N.table_name),R.column_name,t.title,R.column_name,e.temp_title]):await a.bulkUpdateAll({where:`(${R.title},eq,${e.temp_title})`,skipValidationAndHooks:!0},{[R.column_name]:t.title},{cookie:L}):R.uidt===u.UITypes.MultiSelect&&("mysql"===s||"mysql2"===s?"set"===U.dt?await j.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ','))) WHERE FIND_IN_SET(?, ??)",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.temp_title,t.title,e.temp_title,R.column_name]):await j.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ',')))",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.temp_title,t.title,e.temp_title,R.column_name]):"pg"===s?await j.raw("UPDATE ?? SET ??  = array_to_string(array_replace(string_to_array(??, ','), ?, ?), ',')",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.temp_title,t.title]):"mssql"===s?await j.raw("UPDATE ?? SET ?? = substring(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ',')), 2, len(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ','))) - 2)",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.temp_title,t.title,R.column_name,e.temp_title,t.title]):"sqlite3"===s&&await j.raw("UPDATE ?? SET ?? = TRIM(REPLACE(',' || ?? || ',', ',' || ? || ',', ',' || ? || ','), ',')",[a.getTnPath(N.table_name),R.column_name,R.column_name,e.temp_title,t.title]))}}const i=Object.assign(Object.assign({},N),{tn:N.table_name,originalColumns:N.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(N.columns.map((async a=>{if(a.id===t.columnId){const t=Object.assign(Object.assign(Object.assign({},a),U),{cn:U.column_name,cno:a.column_name,altered:E.UPDATE_COLUMN});return await this.updateFormulas(e,{oldColumn:R,colBody:U}),Promise.resolve(t)}return a.cn=a.column_name,Promise.resolve(a)})))}),s=await x("sqlMgr",C,(async()=>y.default.getSqlMgr(e,{id:A.base_id})));if(await s.sqlOpPlus(A,"tableUpdate",i),await f.Column.update(e,t.columnId,Object.assign({},U)),U.uidt===u.UITypes.SingleSelect){const t=await f.KanbanView.getViewsByGroupingColId(e,R.id);for(const a of t){const t=await f.View.get(e,a.fk_view_id);(null==t?void 0:t.uuid)&&(t.meta=(0,_.parseMetaProp)(t),await f.View.update(e,t.id,Object.assign(Object.assign({},t),{meta:Object.assign(Object.assign({},t.meta),{groupingFieldColumn:U})})))}}}else if(U.uidt===u.UITypes.User){if("string"!=typeof U.cdf)U.cdf="";else if(U.cdf){const t=await f.BaseUser.getUsersList(e,{base_id:A.base_id,include_ws_deleted:!1}),a=U.cdf.split(","),i=a.filter((e=>!t.find((t=>t.id===e||t.email===e))));i.length&&w.NcError.badRequest(`The following default users are not part of workspace: ${i.join(", ")}`);const s=a.map((e=>t.find((t=>t.id===e||t.email===e)).id));U.cdf=s.join(",")}if(R.uidt===u.UITypes.User){if(!1===(null===(k=U.meta)||void 0===k?void 0:k.is_multi)&&!0===(null===(S=R.meta)||void 0===S?void 0:S.is_multi)){const t=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:await x("dbDriver",C,(async()=>O.default.get(A)))}))),a=(await x("dbDriver",C,(async()=>O.default.get(A)))).clientType();"mysql"===a||"mysql2"===a?await j.raw("UPDATE ?? SET ?? = SUBSTRING_INDEX(??, ',', 1) WHERE ?? LIKE '%,%';",[t.getTnPath(N.table_name),R.column_name,R.column_name,R.column_name]):"pg"===a?await j.raw("UPDATE ?? SET ?? = split_part(??, ',', 1);",[t.getTnPath(N.table_name),R.column_name,R.column_name]):"mssql"===a?await j.raw("UPDATE ?? SET ?? = LEFT(cast(?? as varchar(max)), CHARINDEX(',', ??) - 1) WHERE CHARINDEX(',', ??) > 0;",[t.getTnPath(N.table_name),R.column_name,R.column_name,R.column_name,R.column_name]):"sqlite3"===a&&await j.raw("UPDATE ?? SET ?? = substr(??, 1, instr(??, ',') - 1) WHERE ?? LIKE '%,%';",[t.getTnPath(N.table_name),R.column_name,R.column_name,R.column_name,R.column_name])}U=await(0,v.default)(U,A);const a=Object.assign(Object.assign({},N),{tn:N.table_name,originalColumns:N.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(N.columns.map((async a=>{if(a.id===t.columnId){const t=Object.assign(Object.assign(Object.assign({},a),U),{cn:U.column_name,cno:a.column_name,altered:E.UPDATE_COLUMN});return await this.updateFormulas(e,{oldColumn:R,colBody:U}),Promise.resolve(t)}return a.cn=a.column_name,Promise.resolve(a)})))}),i=await x("sqlMgr",C,(async()=>y.default.getSqlMgr(e,{id:A.base_id})));await i.sqlOpPlus(A,"tableUpdate",a),await f.Column.update(e,t.columnId,Object.assign({},U))}else{const a=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:await x("dbDriver",C,(async()=>O.default.get(A)))}))),i=await f.BaseUser.getUsersList(e,{base_id:R.base_id});(await a.execAndParse(j.knex.raw("SELECT DISTINCT ?? FROM ??",[R.column_name,a.getTnPath(N.table_name)]).toQuery())).map((e=>e[R.column_name])).some((e=>(null==e?void 0:e.split(",").length)>1))&&(U.meta={is_multi:!0});let s="null";[u.UITypes.URL,u.UITypes.Email,u.UITypes.SingleLineText,u.UITypes.PhoneNumber,u.UITypes.SingleLineText,u.UITypes.LongText,u.UITypes.MultiSelect].includes(R.uidt)&&(s=i.map((e=>j.knex.raw("WHEN ?? = ? THEN ?",[R.column_name,e.email,e.id]).toQuery())).join("\n"),s=`CASE\n${s}\nELSE null\nEND`),await j.raw(`UPDATE ?? SET ?? = ${s};`,[a.getTnPath(N.table_name),R.column_name]),U=await(0,v.default)(U,A);const r=Object.assign(Object.assign({},N),{tn:N.table_name,originalColumns:N.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(N.columns.map((async a=>{if(a.id===t.columnId){const t=Object.assign(Object.assign(Object.assign({},a),U),{cn:U.column_name,cno:a.column_name,altered:E.UPDATE_COLUMN});return await this.updateFormulas(e,{oldColumn:R,colBody:U}),Promise.resolve(t)}return a.cn=a.column_name,Promise.resolve(a)})))}),l=await x("sqlMgr",C,(async()=>y.default.getSqlMgr(e,{id:A.base_id})));await l.sqlOpPlus(A,"tableUpdate",r),await f.Column.update(e,t.columnId,Object.assign({},U))}}else{if(R.uidt===u.UITypes.User){const t=await x("baseModel",C,(async()=>f.Model.getBaseModelSQL(e,{id:N.id,dbDriver:await x("dbDriver",C,(async()=>O.default.get(A)))}))),a=(await f.BaseUser.getUsersList(e,{base_id:R.base_id})).reduce(((e,t)=>j.knex.raw(`REPLACE(${e}, ?, ?)`,[t.id,t.email]).toQuery()),j.knex.raw("??",[R.column_name]).toQuery());await j.raw(`UPDATE ?? SET ?? = ${a};`,[t.getTnPath(N.table_name),R.column_name])}else R.uidt===u.UITypes.SingleSelect&&R.uidt!==U.uidt&&(await f.KanbanView.getViewsByGroupingColId(e,R.id)).length>0&&w.NcError.badRequest(`The column '${R.column_name}' is being used in Kanban View. Please update stack by field or delete Kanban View first.`);U=await(0,v.default)(U,A);const a=Object.assign(Object.assign({},N),{tn:N.table_name,originalColumns:N.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(N.columns.map((async a=>{if(a.id===t.columnId){const t=Object.assign(Object.assign(Object.assign({},a),U),{cn:U.column_name,cno:a.column_name,altered:E.UPDATE_COLUMN});return await this.updateFormulas(e,{oldColumn:R,colBody:U}),Promise.resolve(t)}return a.cn=a.column_name,Promise.resolve(a)})))}),i=await x("sqlMgr",C,(async()=>y.default.getSqlMgr(e,{id:A.base_id})));await i.sqlOpPlus(A,"tableUpdate",a),await f.Column.update(e,t.columnId,Object.assign({},U))}return await N.getColumns(e),this.appHooksService.emit(u.AppEvents.COLUMN_UPDATE,{table:N,column:R,user:null===(M=t.req)||void 0===M?void 0:M.user,ip:null===(I=t.req)||void 0===I?void 0:I.clientIp,req:t.req}),N}async columnGet(e,t){return f.Column.get(e,{colId:t.columnId})}async columnSetAsPrimary(e,t){const a=await f.Column.get(e,{colId:t.columnId});return f.Model.updatePrimaryColumn(e,a.fk_model_id,a.id)}async columnAdd(e,t){var a,i,s,r,l,c,d,p,m;t.column.column_name&&!t.column.title&&(t.column.title=t.column.column_name),(0,b.validatePayload)("swagger.json#/components/schemas/ColumnReq",t.column);const _=t.reuse||{},h=await x("table",_,(async()=>f.Model.getWithInfo(e,{id:t.tableId}))),k=await x("source",_,(async()=>f.Source.get(e,h.source_id)));(null==k?void 0:k.is_schema_readonly)&&!u.readonlyMetaAllowedTypes.includes(t.column.uidt)&&w.NcError.sourceMetaReadOnly(k.alias);const M=await x("base",_,(async()=>k.getProject(e)));if(t.column.title||t.column.column_name){const a=(await x("dbDriver",_,(async()=>O.default.get(k)))).clientType(),i=f.Column.getMaxColumnNameLength(a);if((0,u.isVirtualCol)(t.column)||(t.column.column_name=(0,b.sanitizeColumnName)(t.column.column_name,k.type)),t.column.title&&(t.column.title=t.column.title.trim()),t.column.column_name||(t.column.column_name=t.column.title),t.column.column_name){let a=t.column.column_name.slice(0,i-5),s=1;for(;!await f.Column.checkTitleAvailable(e,{column_name:a,fk_model_id:t.tableId});)a=t.column.column_name.slice(0,i-5),a+="_"+s++;t.column.column_name=a}t.column.column_name&&t.column.column_name.length>i&&w.NcError.badRequest(`Column name ${t.column.column_name} exceeds ${i} characters`),t.column.title&&t.column.title.length>255&&w.NcError.badRequest(`Column title ${t.column.title} exceeds 255 characters`)}(0,u.isVirtualCol)(t.column)||await f.Column.checkTitleAvailable(e,{column_name:t.column.column_name,fk_model_id:t.tableId})||w.NcError.badRequest("Duplicate column name"),await f.Column.checkAliasAvailable(e,{title:t.column.title||t.column.column_name,fk_model_id:t.tableId})||w.NcError.badRequest("Duplicate column alias");let I=t.column;const C={view_id:I.view_id,column_order:I.column_order};switch(I.uidt){case u.UITypes.Rollup:await(0,b.validateRollupPayload)(e,t.column),await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}));break;case u.UITypes.Lookup:await(0,b.validateLookupPayload)(e,t.column),await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}));break;case u.UITypes.Links:case u.UITypes.LinkToAnotherRecord:await this.createLTARColumn(e,Object.assign(Object.assign({},t),{source:k,base:M,reuse:_,colExtra:C})),this.appHooksService.emit(u.AppEvents.RELATION_CREATE,{column:Object.assign(Object.assign({},I),{fk_model_id:t.tableId,base_id:M.id,source_id:k.id}),req:t.req});break;case u.UITypes.QrCode:(0,S.default)(["fk_qr_value_column_id"],t.column),await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}));break;case u.UITypes.Barcode:(0,S.default)(["fk_barcode_value_column_id"],t.column),await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}));break;case u.UITypes.Formula:I.formula=await(0,u.substituteColumnAliasWithIdInFormula)(I.formula_raw||I.formula,h.columns),I.parsed_tree=await(0,u.validateFormulaAndExtractTreeWithType)({formula:I.formula,column:Object.assign(Object.assign({},I),{colOptions:I}),columns:h.columns,clientOrSqlUi:k.type,getMeta:async t=>{const a=await f.Model.get(e,t);return await a.getColumns(e),a}});try{const t=await x("baseModel",_,(async()=>f.Model.getBaseModelSQL(e,{id:h.id,dbDriver:await x("dbDriver",_,(async()=>O.default.get(k)))})));await(0,g.default)(t,I.formula,null,h,null,{},null,!0)}catch(e){console.error(e),w.NcError.badRequest("Invalid Formula")}await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}));break;case u.UITypes.Button:if("url"===I.type){I.formula=await(0,u.substituteColumnAliasWithIdInFormula)(I.formula_raw||I.formula,h.columns),I.parsed_tree=await(0,u.validateFormulaAndExtractTreeWithType)({formula:I.formula,columns:h.columns,column:Object.assign(Object.assign({},I),{colOptions:I}),clientOrSqlUi:k.type,getMeta:async t=>{const a=await f.Model.get(e,t);return await a.getColumns(e),a}});try{const t=await x("baseModel",_,(async()=>f.Model.getBaseModelSQL(e,{id:h.id,dbDriver:await x("dbDriver",_,(async()=>O.default.get(k)))})));await(0,g.default)(t,I.formula,null,h,null,{},null,!0,I.parsed_tree)}catch(e){console.error(e),w.NcError.badRequest("Invalid URL Formula")}}else if("webhook"===I.type){I.fk_webhook_id||(I.fk_webhook_id=null);const t=await f.Hook.get(e,I.fk_webhook_id);t&&t.active&&"manual"===t.event||(I.fk_webhook_id=null)}await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}));break;case u.UITypes.CreatedTime:case u.UITypes.LastModifiedTime:case u.UITypes.CreatedBy:case u.UITypes.LastModifiedBy:{let t;const a=await h.getColumns(e),i=a.find((e=>e.uidt===I.uidt&&e.system));if(i)t=i.column_name;else{let i;switch(I.uidt){case u.UITypes.CreatedTime:t="created_at",i="CreatedAt";break;case u.UITypes.LastModifiedTime:t="updated_at",i="UpdatedAt";break;case u.UITypes.CreatedBy:t="created_by",i="nc_created_by";break;case u.UITypes.LastModifiedBy:t="updated_by",i="nc_updated_by"}a.find((e=>e.column_name===t))&&(t=(0,T.getUniqueColumnName)(a,t));{I=await(0,v.default)(I,k),"sqlite3"===k.type&&(I.cdf=null);const a=Object.assign(Object.assign({},h),{tn:h.table_name,originalColumns:h.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),columns:[...h.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),Object.assign(Object.assign({},I),{cn:t,altered:E.NEW_COLUMN})]}),i=await x("sqlMgr",_,(async()=>y.default.getSqlMgr(e,{id:k.base_id})));await i.sqlOpPlus(k,"tableUpdate",a)}const s=(0,T.getUniqueColumnAliasName)(h.columns,i);await f.Column.insert(e,Object.assign(Object.assign({},I),{title:s,system:1,fk_model_id:h.id,column_name:t}))}await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id,column_name:null}))}break;default:{if(I=await(0,v.default)(I,k),I.uidt===u.UITypes.Duration&&(I.dtxp="20",I.dtxs="4"),[u.UITypes.SingleSelect,u.UITypes.MultiSelect].includes(I.uidt)){(null===(a=I.colOptions)||void 0===a?void 0:a.options)||(I.colOptions=Object.assign(Object.assign({},I.colOptions),{options:[]}));const e=(await O.default.get(k)).clientType(),t=I.colOptions.options.map((e=>e.title.replace(/'/g,"''")));if(I.dtxs="",I.cdf){if(I.uidt===u.UITypes.SingleSelect)try{t.includes(I.cdf.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${I.cdf}' is not a select option.`)}catch(e){I.cdf=I.cdf.replace(/^'/,"").replace(/'$/,""),t.includes(I.cdf.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${I.cdf}' is not a select option.`)}else try{for(const e of I.cdf.split(","))t.includes(e.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${e}' is not a select option.`)}catch(e){I.cdf=I.cdf.replace(/^'/,"").replace(/'$/,"");for(const e of I.cdf.split(","))t.includes(e.replace(/'/g,"''"))||w.NcError.badRequest(`Default value '${e}' is not a select option.`)}I.cdf="pg"===e||"sqlite3"===e?I.cdf.replace(/'/g,"'"):I.cdf.replace(/'/g,"''"),"pg"===e&&(I.cdf=`'${I.cdf}'`)}const l=I.colOptions.options.map((e=>e.title));if(l.some((function(e){return l.indexOf(e)!==l.lastIndexOf(e)}))&&w.NcError.badRequest("Duplicates are not allowed!"),l.some((function(e){return""===e}))&&w.NcError.badRequest("Empty options are not allowed!"),"enum"===I.dt||"set"===I.dt)for(const e of I.colOptions.options)e.title=e.title.trimEnd();I.uidt===u.UITypes.SingleSelect?I.dtxp=(null===(i=I.colOptions)||void 0===i?void 0:i.options.length)?`${I.colOptions.options.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")}`:"":I.uidt===u.UITypes.MultiSelect&&(I.dtxp=(null===(s=I.colOptions)||void 0===s?void 0:s.options.length)?`${I.colOptions.options.map((e=>(e.title.includes(",")&&w.NcError.badRequest("Illegal char(',') for MultiSelect"),`'${e.title.replace(/'/gi,"''")}'`))).join(",")}`:""),"mysql"!==e&&"mysql2"!==e||(I.colOptions.options.length||I.dtxp&&""!==I.dtxp||(I.dtxp="''"),"set"===I.dt&&(null===(r=I.colOptions)||void 0===r?void 0:r.options.length)>64&&(I.dt="text"))}if(I.uidt===u.UITypes.User&&I.cdf){const t=await f.BaseUser.getUsersList(e,{base_id:M.id,include_ws_deleted:!1}),a=I.cdf.split(","),i=a.filter((e=>!t.find((t=>t.id===e||t.email===e))));i.length&&w.NcError.badRequest(`The following default users are not part of workspace: ${i.join(", ")}`);const s=a.map((e=>t.find((t=>t.id===e||t.email===e)).id));I.cdf=s.join(",")}const t=Object.assign(Object.assign({},h),{tn:h.table_name,originalColumns:h.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),columns:[...h.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),Object.assign(Object.assign({},I),{cn:I.column_name,altered:E.NEW_COLUMN})]}),p=await x("sqlClient",_,(async()=>O.default.getSqlClient(k))),m=await x("sqlMgr",_,(async()=>y.default.getSqlMgr(e,{id:k.base_id})));if(await m.sqlOpPlus(k,"tableUpdate",t),!k.isMeta()){const e=(null===(d=null===(c=await p.columnList({tn:h.table_name,schema:null===(l=k.getConfig())||void 0===l?void 0:l.schema}))||void 0===c?void 0:c.data)||void 0===d?void 0:d.list).find((e=>e.cn===I.column_name))||{};Object.assign(I,e)}await f.Column.insert(e,Object.assign(Object.assign({},I),{fk_model_id:h.id}))}}return await h.getColumns(e),this.appHooksService.emit(u.AppEvents.COLUMN_CREATE,{table:h,column:Object.assign(Object.assign({},I),{fk_model_id:h.id}),user:null===(p=t.req)||void 0===p?void 0:p.user,ip:null===(m=t.req)||void 0===m?void 0:m.clientIp,req:t.req}),h}async columnDelete(e,t,a=this.metaService){var i,s,r,l,c;const d=t.reuse||{},p=await f.Column.get(e,{colId:t.columnId},a);p.system&&!t.forceDeleteSystem&&w.NcError.badRequest(`The column '${p.title||p.column_name}' is a system column and cannot be deleted.`);const m=await x("table",d,(async()=>f.Model.getWithInfo(e,{id:p.fk_model_id},a))),_=await x("source",d,(async()=>f.Source.get(e,m.source_id,!1,a)));(null==_?void 0:_.is_schema_readonly)&&!u.readonlyMetaAllowedTypes.includes(p.uidt)&&w.NcError.sourceMetaReadOnly(_.alias);const h=await x("sqlMgr",d,(async()=>y.default.getSqlMgr(e,{id:_.base_id},a)));if(!(0,u.isVirtualCol)(p)){let s=null===(i=(await m.getColumns(e,a)).find((e=>{var a,i,s,r;return(0,u.isLinksOrLTAR)(e.uidt)&&((null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===t.columnId||(null===(i=e.colOptions)||void 0===i?void 0:i.fk_parent_column_id)===t.columnId||(null===(s=e.colOptions)||void 0===s?void 0:s.fk_mm_child_column_id)===t.columnId||(null===(r=e.colOptions)||void 0===r?void 0:r.fk_mm_parent_column_id)===t.columnId)})))||void 0===i?void 0:i.colOptions;if(s||(s=await a.metaGet2(m.fk_workspace_id,m.base_id,I.MetaTable.COL_RELATIONS,{},null,{_or:[{fk_child_column_id:{eq:t.columnId}},{fk_parent_column_id:{eq:t.columnId}},{fk_mm_child_column_id:{eq:t.columnId}},{fk_mm_parent_column_id:{eq:t.columnId}}]})),s){const t=await f.Column.get(e,{colId:s.fk_column_id},a),i=await t.getModel(e,a);w.NcError.columnAssociatedWithLink(p.id,{customMessage:`Column is associated with Link column '${t.title||t.column_name}' (${i.title||i.table_name}). Please delete the link column first.`})}}switch(p.uidt){case u.UITypes.Lookup:case u.UITypes.Rollup:case u.UITypes.QrCode:case u.UITypes.Barcode:case u.UITypes.Button:await f.Column.delete(e,t.columnId,a);break;case u.UITypes.Formula:p.colOptions||await p.getColOptions(e,a),(null===(s=p.colOptions.parsed_tree)||void 0===s?void 0:s.dataType)===u.FormulaDataTypes.DATE&&await f.CalendarRange.IsColumnBeingUsedAsRange(e,p.id,a)&&w.NcError.badRequest(`The column '${p.column_name}' is being used in Calendar View. Please delete Calendar View first.`),await f.Column.delete(e,t.columnId,a);break;case u.UITypes.CreatedTime:case u.UITypes.LastModifiedTime:[u.UITypes.DateTime,u.UITypes.Date].includes(p.uidt)&&await f.CalendarRange.IsColumnBeingUsedAsRange(e,p.id,a)&&w.NcError.badRequest(`The column '${p.column_name}' is being used in Calendar View. Please delete Calendar View first.`),await f.Column.delete(e,t.columnId,a);break;case u.UITypes.CreatedBy:case u.UITypes.LastModifiedBy:await f.Column.delete(e,t.columnId,a);break;case u.UITypes.Links:case u.UITypes.LinkToAnotherRecord:{const t=await p.getColOptions(e,a),i=await t.getChildColumn(e,a),s=await i.getModel(e,a),l=await t.getParentColumn(e,a),c=await l.getModel(e,a),d=null===(r=p.meta)||void 0===r?void 0:r.custom;switch(t.type){case"bt":case"hm":await this.deleteHmOrBtRelation(e,{relationColOpt:t,source:_,childColumn:i,childTable:s,parentColumn:l,parentTable:c,sqlMgr:h,ncMeta:a,custom:d});break;case"oo":await this.deleteOoRelation(e,{relationColOpt:t,source:_,childColumn:i,childTable:s,parentColumn:l,parentTable:c,sqlMgr:h,ncMeta:a,custom:d});break;case"mm":{const r=await t.getMMModel(e,a),p=await t.getMMParentColumn(e,a),m=await t.getMMChildColumn(e,a);d||(await this.deleteHmOrBtRelation(e,{relationColOpt:null,parentColumn:l,childTable:r,sqlMgr:h,parentTable:c,childColumn:p,source:_,ncMeta:a,virtual:!!t.virtual},!0),await this.deleteHmOrBtRelation(e,{relationColOpt:null,parentColumn:i,childTable:r,sqlMgr:h,parentTable:s,childColumn:m,source:_,ncMeta:a,virtual:!!t.virtual},!0));const g=await t.getRelatedTable(e,a).then((t=>t.getColumns(e,a)));for(const s of g){if(!(0,u.isLinksOrLTAR)(s.uidt))continue;const r=await s.getColOptions(e,a);if("mm"===r.type&&r.fk_parent_column_id===i.id&&r.fk_child_column_id===l.id&&r.fk_mm_model_id===t.fk_mm_model_id&&r.fk_mm_parent_column_id===t.fk_mm_child_column_id&&r.fk_mm_child_column_id===t.fk_mm_parent_column_id){await f.Column.delete(e,s.id,a);break}}if(await f.Column.delete(e,t.fk_column_id,a),!d){if(r){await r.getColumns(e,a);for(const t of r.columns){if(!(0,u.isLinksOrLTAR)(t.uidt))continue;"bt"===(await t.getColOptions(e,a)).type&&await f.Column.delete(e,t.id,a)}}await c.getColumns(e,a);for(const i of c.columns){if(!(0,u.isLinksOrLTAR)(i.uidt))continue;(await i.getColOptions(e,a)).fk_related_model_id===t.fk_mm_model_id&&await f.Column.delete(e,i.id,a)}await s.getColumns(e,a);for(const i of s.columns){if(!(0,u.isLinksOrLTAR)(i.uidt))continue;(await i.getColOptions(e,a)).fk_related_model_id===t.fk_mm_model_id&&await f.Column.delete(e,i.id,a)}(null==r?void 0:r.mm)&&(await r.getColumns(e,a),2===r.columns.length&&(r.tn=r.table_name,await h.sqlOpPlus(_,"tableDelete",r),await r.delete(e,a)))}}}}this.appHooksService.emit(u.AppEvents.RELATION_DELETE,{column:p,req:t.req});break;case u.UITypes.ForeignKey:w.NcError.notImplemented(`Support for ${p.uidt}`);break;case u.UITypes.SingleSelect:(await f.KanbanView.getViewsByGroupingColId(e,p.id)).length>0&&w.NcError.badRequest(`The column '${p.column_name}' is being used in Kanban View. Please delete Kanban View first.`);case u.UITypes.DateTime:case u.UITypes.Date:[u.UITypes.DateTime,u.UITypes.Date].includes(p.uidt)&&await f.CalendarRange.IsColumnBeingUsedAsRange(e,p.id,a)&&w.NcError.badRequest(`The column '${p.column_name}' is being used in Calendar View. Please delete Calendar View first.`);default:{const i=Object.assign(Object.assign({},m),{tn:m.table_name,originalColumns:m.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:m.columns.map((e=>e.id===t.columnId?Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name,altered:E.DELETE_COLUMN}):(e.cn=e.column_name,e)))});await h.sqlOpPlus(_,"tableUpdate",i),await f.Column.delete(e,t.columnId,a)}}await m.getColumns(e,a);const g=(0,k.default)(m.columns);return g&&await f.Model.updatePrimaryColumn(e,g.fk_model_id,g.id,a),this.appHooksService.emit(u.AppEvents.COLUMN_DELETE,{table:m,column:p,user:null===(l=t.req)||void 0===l?void 0:l.user,ip:null===(c=t.req)||void 0===c?void 0:c.clientIp,req:t.req}),m}async createLTARColumn(e,t){var a,i,s,r,l,c,d,m,_;(0,S.default)(["parentId","childId","type"],t.column);const h=null!==(a=t.reuse)&&void 0!==a?a:{},g=await f.Model.getWithInfo(e,{id:t.column.parentId}),w=await f.Model.getWithInfo(e,{id:t.column.childId});let v;const k=(null===(i=t.column)||void 0===i?void 0:i.childViewId)?await f.View.getByTitleOrId(e,{fk_model_id:w.id,titleOrId:t.column.childViewId}):null,M=await x("sqlMgr",h,(async()=>y.default.getSqlMgr(e,{id:t.source.base_id}))),O=t.column.uidt===u.UITypes.Links||"bt"===t.column.type;if((t.source.isMeta()||"snowflake"===t.source.type)&&(t.column.virtual=!0),"hm"===t.column.type||"bt"===t.column.type){const a=(0,T.getUniqueColumnName)(await w.getColumns(e),`${g.table_name}_id`);let i;{const s={cn:a,title:a,column_name:a,rqd:!1,pk:!1,ai:!1,cdf:null,dt:g.primaryKey.dt,dtxp:g.primaryKey.dtxp,dtxs:g.primaryKey.dtxs,un:g.primaryKey.un,altered:E.NEW_COLUMN},r=Object.assign(Object.assign({},w),{tn:w.table_name,originalColumns:w.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),columns:[...w.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),s]});await M.sqlOpPlus(t.source,"tableUpdate",r);const{id:l}=await f.Column.insert(e,Object.assign(Object.assign({},s),{uidt:u.UITypes.ForeignKey,fk_model_id:w.id}));v=await f.Column.get(e,{colId:l}),t.column.virtual||(i=(0,b.generateFkName)(g,w),await M.sqlOpPlus(t.source,"relationCreate",{childColumn:a,childTable:w.table_name,parentTable:g.table_name,onDelete:"NO ACTION",onUpdate:"NO ACTION",type:"real",parentColumn:g.primaryKey.column_name,foreignKeyName:i})),("pg"===t.source.type||t.column.virtual)&&await this.createColumnIndex(e,{column:new f.Column(Object.assign(Object.assign({},s),{fk_model_id:w.id})),source:t.source,sqlMgr:M})}await(0,b.createHmAndBtColumn)(e,w,g,v,k,t.column.type,t.column.title,i,t.column.virtual,null,t.column.meta,O,t.colExtra)}else if("oo"===t.column.type){const a=(0,T.getUniqueColumnName)(await w.getColumns(e),`${g.table_name}_id`);let i;{const s={cn:a,title:a,column_name:a,rqd:!1,pk:!1,ai:!1,cdf:null,dt:g.primaryKey.dt,dtxp:g.primaryKey.dtxp,dtxs:g.primaryKey.dtxs,un:g.primaryKey.un,altered:E.NEW_COLUMN,unique:1},r=Object.assign(Object.assign({},w),{tn:w.table_name,originalColumns:w.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),columns:[...w.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),s]});await M.sqlOpPlus(t.source,"tableUpdate",r);const{id:l}=await f.Column.insert(e,Object.assign(Object.assign({},s),{uidt:u.UITypes.ForeignKey,fk_model_id:w.id}));v=await f.Column.get(e,{colId:l}),t.column.virtual||(i=(0,b.generateFkName)(g,w),await M.sqlOpPlus(t.source,"relationCreate",{childColumn:a,childTable:w.table_name,parentTable:g.table_name,onDelete:"NO ACTION",onUpdate:"NO ACTION",type:"real",parentColumn:g.primaryKey.column_name,foreignKeyName:i})),("pg"===t.source.type||t.column.virtual)&&await this.createColumnIndex(e,{column:new f.Column(Object.assign(Object.assign({},s),{fk_model_id:w.id})),source:t.source,sqlMgr:M})}await(0,b.createOOColumn)(e,w,g,v,k,t.column.type,t.column.title,i,t.column.virtual,null,t.column.meta,t.colExtra)}else if("mm"===t.column.type){const a=`${null!==(r=null===(s=t.base)||void 0===s?void 0:s.prefix)&&void 0!==r?r:""}_nc_m2m_${(0,b.randomID)()}`,i=a,h=g.primaryKey,y=w.primaryKey,v=[],S="table1_id",I="table2_id";v.push({cn:I,column_name:I,title:I,rqd:!0,pk:!0,ai:!1,cdf:null,dt:y.dt,dtxp:y.dtxp,dtxs:y.dtxs,un:y.un,altered:1,uidt:u.UITypes.ForeignKey},{cn:S,column_name:S,title:S,rqd:!0,pk:!0,ai:!1,cdf:null,dt:h.dt,dtxp:h.dtxp,dtxs:h.dtxs,un:h.un,altered:1,uidt:u.UITypes.ForeignKey}),await M.sqlOpPlus(t.source,"tableCreate",{tn:a,_tn:i,columns:v});const C=await f.Model.insert(e,t.base.id,t.source.id,{table_name:a,title:i,mm:!0,columns:v});let E,x;if(!t.column.virtual){E=(0,b.generateFkName)(g,w),x=(0,b.generateFkName)(g,w);const e=Object.assign(Object.assign({},t.column),{childTable:a,childColumn:S,parentTable:g.table_name,parentColumn:h.column_name,type:"real",foreignKeyName:E}),i=Object.assign(Object.assign({},t.column),{childTable:a,childColumn:I,parentTable:w.table_name,parentColumn:y.column_name,type:"real",foreignKeyName:x});await M.sqlOpPlus(t.source,"relationCreate",e),await M.sqlOpPlus(t.source,"relationCreate",i)}const L=null===(l=await C.getColumns(e))||void 0===l?void 0:l.find((e=>e.column_name===S)),R=null===(c=await C.getColumns(e))||void 0===c?void 0:c.find((e=>e.column_name===I));await(0,b.createHmAndBtColumn)(e,C,w,R,null,null,null,E,t.column.virtual,!0,null,!1,t.colExtra),await(0,b.createHmAndBtColumn)(e,C,g,L,null,null,null,x,t.column.virtual,!0,null,!1,t.colExtra),await f.Column.insert(e,{title:(0,T.getUniqueColumnAliasName)(await w.getColumns(e),(0,p.pluralize)(g.title)),uidt:O?u.UITypes.Links:u.UITypes.LinkToAnotherRecord,type:"mm",fk_model_id:w.id,fk_child_column_id:y.id,fk_parent_column_id:h.id,fk_target_view_id:null,fk_mm_model_id:C.id,fk_mm_child_column_id:R.id,fk_mm_parent_column_id:L.id,fk_related_model_id:g.id,virtual:t.column.virtual,meta:{plural:(0,p.pluralize)(g.title),singular:(0,p.singularize)(g.title)},system:g.id===w.id}),await f.Column.insert(e,Object.assign({title:(0,T.getUniqueColumnAliasName)(await g.getColumns(e),null!==(d=t.column.title)&&void 0!==d?d:(0,p.pluralize)(w.title)),uidt:O?u.UITypes.Links:u.UITypes.LinkToAnotherRecord,type:"mm",fk_model_id:g.id,fk_child_column_id:h.id,fk_parent_column_id:y.id,fk_target_view_id:null==k?void 0:k.id,fk_mm_model_id:C.id,fk_mm_child_column_id:L.id,fk_mm_parent_column_id:R.id,fk_related_model_id:w.id,virtual:t.column.virtual,meta:Object.assign(Object.assign({},t.column.meta||{}),{plural:(null===(m=t.column.meta)||void 0===m?void 0:m.plural)||(0,p.pluralize)(w.title),singular:(null===(_=t.column.meta)||void 0===_?void 0:_.singular)||(0,p.singularize)(w.title)})},t.colExtra)),"pg"===t.source.type&&(await this.createColumnIndex(e,{column:new f.Column(Object.assign(Object.assign({},v[0]),{fk_model_id:C.id})),source:t.source,sqlMgr:M}),await this.createColumnIndex(e,{column:new f.Column(Object.assign(Object.assign({},v[1]),{fk_model_id:C.id})),source:t.source,sqlMgr:M}))}}async createColumnIndex(e,{column:t,sqlMgr:a,source:i,indexName:s=null,nonUnique:r=!0}){if("snowflake"===i.type)return;const l=await t.getModel(e),c={columns:[t.column_name],tn:l.table_name,non_unique:r,indexName:s};await a.sqlOpPlus(i,"indexCreate",c)}async updateRollupOrLookup(e,t,a){u.UITypes.Lookup===a.uidt&&(0,b.validateRequiredField)(t,["fk_lookup_column_id","fk_relation_column_id"])?(await(0,b.validateLookupPayload)(e,t,a.id),await f.Column.update(e,a.id,t)):u.UITypes.Rollup===a.uidt&&(0,b.validateRequiredField)(t,["fk_relation_column_id","fk_rollup_column_id","rollup_function"])&&(await(0,b.validateRollupPayload)(e,t),await f.Column.update(e,a.id,t))}async columnsHash(e,t){const a=await f.Model.getWithInfo(e,{id:t});a||w.NcError.tableNotFound(t);const i=await a.getColumns(e);return{hash:(0,m.default)(i)}}async columnBulk(e,t,a,i){var s,r;const l=await f.Model.getWithInfo(e,{id:t});l||w.NcError.tableNotFound(t);const c=await l.getColumns(e);(0,m.default)(c)!==a.hash&&w.NcError.badRequest("Columns are updated by someone else! Your changes are rejected. Please refresh the page and try again.");const d=await f.Source.get(e,l.source_id);d||w.NcError.sourceNotFound(l.source_id);const u=await d.getProject(e);u||w.NcError.baseNotFound(d.base_id);const p=await O.default.get(d),_=await O.default.getSqlClient(d),h=await y.default.getSqlMgr(e,{id:d.base_id}),g=await f.Model.getBaseModelSQL(e,{id:l.id,dbDriver:p});p&&_&&h&&g||w.NcError.badRequest("There was an error handling your request");const b={table:l,source:d,base:u,dbDriver:p,sqlClient:_,sqlMgr:h,baseModel:g},v=a.ops;for(const e of v)"update"===e.op?e.column&&(null===(s=e.column)||void 0===s?void 0:s.id)||w.NcError.badRequest("Bad request, update operation requires column id"):"delete"===e.op?e.column&&(null===(r=e.column)||void 0===r?void 0:r.id)||w.NcError.badRequest("Bad request, delete operation requires column id"):"add"===e.op&&(e.column||w.NcError.badRequest("Bad request, add operation requires column"));const T=[];for(const a of v){const s=a.column;if("add"===a.op)try{const a=await this.columnAdd(e,{tableId:t,column:s,req:i,user:i.user,reuse:b});await this.postColumnAdd(e,s,a)}catch(e){T.push(Object.assign(Object.assign({},a),{error:e.message}))}else if("update"===a.op)try{await this.columnUpdate(e,{columnId:a.column.id,column:s,req:i,user:i.user,reuse:b}),await this.postColumnUpdate(e,s)}catch(e){T.push(Object.assign(Object.assign({},a),{error:e.message}))}else if("delete"===a.op)try{await this.columnDelete(e,{columnId:a.column.id,req:i,user:i.user})}catch(e){T.push(Object.assign(Object.assign({},a),{error:e.message}))}}return{failedOps:T}}async postColumnAdd(e,t,a){}async postColumnUpdate(e,t){}};t.ColumnsService=L,t.ColumnsService=L=r([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==C.MetaService&&C.MetaService)?i:Object,"function"==typeof(s=void 0!==h.AppHooksService&&h.AppHooksService)?s:Object])],L)},41004:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.CommandPaletteService=void 0;const s=a(23324),r=a(71040),l=a(71956),c=a(24408),d={[r.ViewTypes.GRID]:"grid",[r.ViewTypes.FORM]:"form",[r.ViewTypes.GALLERY]:"gallery",[r.ViewTypes.KANBAN]:"kanban",[r.ViewTypes.MAP]:"map",[r.ViewTypes.CALENDAR]:"calendar"};let u=class CommandPaletteService{constructor(){this.logger=new s.Logger("CommandPaletteService")}async commandPalette(e){var t,a,i,s,r,u;const p=[];try{const m=await(0,c.getCommandPaletteForUserWorkspace)(null===(t=e.user)||void 0===t?void 0:t.id),_=new Map,f=new Map,h=new Map;for(const e of m)_.has(e.base_id)||_.set(e.base_id,{id:e.base_id,title:e.base_title,meta:(0,l.deserializeJSON)(e.base_meta)}),f.has(e.table_id)||f.set(e.table_id,{id:e.table_id,title:e.table_title,meta:(0,l.deserializeJSON)(e.table_meta),base_id:e.base_id,type:e.table_type}),h.has(e.view_id)||h.set(e.view_id,{id:e.view_id,title:e.view_title,meta:(0,l.deserializeJSON)(e.view_meta),base_id:e.base_id,table_id:e.table_id,is_default:e.view_is_default,type:e.view_type});for(const[e,t]of _)p.push({id:`p-${e}`,title:t.title,icon:"project",iconColor:null===(a=(0,l.deserializeJSON)(t.meta))||void 0===a?void 0:a.iconColor,section:"Bases"});for(const[e,t]of f)p.push({id:`tbl-${e}`,title:t.title,parent:`p-${t.base_id}`,icon:(null===(i=null==t?void 0:t.meta)||void 0===i?void 0:i.icon)||t.type,projectName:null===(s=_.get(t.base_id))||void 0===s?void 0:s.title,section:"Tables"});for(const[e,t]of h)p.push({id:`vw-${e}`,title:`${t.title}`,parent:`tbl-${t.table_id}`,icon:(null===(r=null==t?void 0:t.meta)||void 0===r?void 0:r.icon)||d[t.type]||"table",projectName:null===(u=_.get(t.base_id))||void 0===u?void 0:u.title,section:"Views",is_default:t.is_default,handler:{type:"navigate",payload:`/nc/${t.base_id}/${t.table_id}/${encodeURIComponent(e)}`}})}catch(e){return this.logger.warn(e),[]}return p}};t.CommandPaletteService=u,t.CommandPaletteService=u=i([(0,s.Injectable)()],u)},80948:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsService=void 0;const c=a(23324),d=a(71040),u=a(19684),p=a(43820),m=a(43468),_=a(52144),f=l(a(92944));let h=class CommentsService{constructor(e){this.appHooksService=e}async commentRow(e,t){var a,i;(0,m.validatePayload)("swagger.json#/components/schemas/CommentReq",t.body);const s=await f.default.insert(e,Object.assign(Object.assign({},t.body),{created_by:null===(a=t.user)||void 0===a?void 0:a.id,created_by_email:null===(i=t.user)||void 0===i?void 0:i.email})),r=await u.Model.getByIdOrName(e,{id:t.body.fk_model_id});return this.appHooksService.emit(d.AppEvents.COMMENT_CREATE,{base:await u.Base.getByTitleOrId(e,r.base_id),model:r,user:t.user,comment:s,rowId:t.body.row_id,req:t.req}),s}async commentDelete(e,t){const a=await f.default.get(e,t.commentId);(a.created_by!==t.user.id||a.is_deleted)&&p.NcError.unauthorized("Unauthorized access");const i=await f.default.delete(e,t.commentId),s=await u.Model.getByIdOrName(e,{id:a.fk_model_id});return this.appHooksService.emit(d.AppEvents.COMMENT_DELETE,{base:await u.Base.getByTitleOrId(e,s.base_id),model:s,user:t.user,comment:a,rowId:a.row_id,req:t.req}),i}async commentList(e,t){return await f.default.list(e,t.query)}async commentsCount(e,t){return await f.default.commentsCount(e,{fk_model_id:t.fk_model_id,ids:t.ids})}async commentUpdate(e,t){(0,m.validatePayload)("swagger.json#/components/schemas/CommentUpdateReq",t.body);const a=await f.default.get(e,t.commentId);(a.created_by!==t.user.id||a.is_deleted)&&p.NcError.unauthorized("Unauthorized access");const i=await f.default.update(e,t.commentId,{comment:t.body.comment}),s=await u.Model.getByIdOrName(e,{id:t.body.fk_model_id});return this.appHooksService.emit(d.AppEvents.COMMENT_UPDATE,{base:await u.Base.getByTitleOrId(e,s.base_id),model:s,user:t.user,comment:Object.assign(Object.assign({},a),{comment:t.body.comment}),rowId:a.row_id,req:t.req}),i}};t.CommentsService=h,t.CommentsService=h=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==_.AppHooksService&&_.AppHooksService)?i:Object])],h)},15952:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasNestedService=void 0;const r=a(23324),l=a(71040),c=a(43820),d=a(99572),u=a(44980),p=a(19684),m=s(a(82096));let _=class DataAliasNestedService{async mmList(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),_=await(0,u.getColumnByIdOrName)(e,t.columnName,a);_&&[l.UITypes.LinkToAnotherRecord,l.UITypes.Links].includes(_.uidt)||c.NcError.badRequest("Column is not LTAR");const f=await r.mmList({colId:_.id,parentId:t.rowId},t.query),h=await r.mmListCount({colId:_.id,parentId:t.rowId},t.query);return new d.PagedResponseImpl(f,Object.assign({count:h},t.query))}async mmExcludedList(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),l=await(0,u.getColumnByIdOrName)(e,t.columnName,a),_=await r.getMmChildrenExcludedList({colId:l.id,pid:t.rowId},t.query),f=await r.getMmChildrenExcludedListCount({colId:l.id,pid:t.rowId},t.query);return new d.PagedResponseImpl(_,Object.assign({count:f},t.query))}async hmExcludedList(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),l=await(0,u.getColumnByIdOrName)(e,t.columnName,a),_=await r.getHmChildrenExcludedList({colId:l.id,pid:t.rowId},t.query),f=await r.getHmChildrenExcludedListCount({colId:l.id,pid:t.rowId},t.query);return new d.PagedResponseImpl(_,Object.assign({count:f},t.query))}async btExcludedList(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),l=await(0,u.getColumnByIdOrName)(e,t.columnName,a),_=await r.getBtChildrenExcludedList({colId:l.id,cid:t.rowId},t.query),f=await r.getBtChildrenExcludedListCount({colId:l.id,cid:t.rowId},t.query);return new d.PagedResponseImpl(_,Object.assign({count:f},t.query))}async ooExcludedList(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.notFound("Table not found");const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),l=await(0,u.getColumnByIdOrName)(e,t.columnName,a),_=await r.getExcludedOneToOneChildrenList({colId:l.id,cid:t.rowId},t.query),f=await r.countExcludedOneToOneChildren({colId:l.id,cid:t.rowId},t.query);return new d.PagedResponseImpl(_,Object.assign({count:f},t.query))}async hmList(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),_=await(0,u.getColumnByIdOrName)(e,t.columnName,a);[l.UITypes.LinkToAnotherRecord,l.UITypes.Links].includes(_.uidt)||c.NcError.badRequest("Column is not LTAR");const f=await r.hmList({colId:_.id,id:t.rowId},t.query),h=await r.hmListCount({colId:_.id,id:t.rowId},t.query);return new d.PagedResponseImpl(f,Object.assign({count:h},t.query))}async relationDataRemove(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s),source:s}),l=await(0,u.getColumnByIdOrName)(e,t.columnName,a);return await r.removeChild({colId:l.id,childId:t.refRowId,rowId:t.rowId,cookie:t.cookie}),!0}async relationDataAdd(e,t){const{model:a,view:i}=await(0,u.getViewAndModelByAliasOrId)(e,t);a||c.NcError.tableNotFound(t.tableName);const s=await p.Source.get(e,a.source_id),r=await p.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await m.default.get(s)}),l=await(0,u.getColumnByIdOrName)(e,t.columnName,a);return await r.addChild({colId:l.id,childId:t.refRowId,rowId:t.rowId,cookie:t.cookie}),!0}};t.DataAliasNestedService=_,t.DataAliasNestedService=_=i([(0,r.Injectable)()],_)},15132:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataTableService=void 0;const d=a(23324),u=a(71040),p=a(43468),m=a(62304),_=a(19684),f=a(68144),h=a(43820),g=c(a(4456)),y=a(99572),b=c(a(82096));let w=class DataTableService{constructor(e){this.datasService=e}async dataList(e,t){const{modelId:a,viewId:i,baseId:s}=t,r=l(t,["modelId","viewId","baseId"]),{model:c,view:d}=await this.getModelAndView(e,{modelId:a,viewId:i,baseId:s});return await this.datasService.dataList(e,Object.assign(Object.assign({},r),{model:c,view:d}))}async dataRead(e,t){const{model:a,view:i}=await this.getModelAndView(e,t),s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s),source:s}),l=await r.readByPk(t.rowId,!1,t.query,{throwErrorIfInvalidParams:!0});return l||h.NcError.recordNotFound(t.rowId),l}async dataAggregate(e,t){const{model:a,view:i}=await this.getModelAndView(e,t),s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s),source:s});i.type!==u.ViewTypes.GRID&&h.NcError.badRequest("Aggregation is only supported on grid views");const l=Object.assign({},t.query);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}try{l.aggregation=JSON.parse(l.aggregation)}catch(e){}return await r.aggregate(l,i)}async dataInsert(e,t){const{model:a,view:i}=await this.getModelAndView(e,t),s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)}),l=await r.bulkInsert(Array.isArray(t.body)?t.body:[t.body],{cookie:t.cookie,insertOneByOneAsFallback:!0,isSingleRecordInsertion:!Array.isArray(t.body)});return Array.isArray(t.body)?l:l[0]}async dataUpdate(e,t){const{model:a,view:i}=await this.getModelAndView(e,t);await this.checkForDuplicateRow(e,{rows:t.body,model:a});const s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)});return await r.bulkUpdate(Array.isArray(t.body)?t.body:[t.body],{cookie:t.cookie,throwExceptionIfNotExist:!0,isSingleRecordUpdation:!Array.isArray(t.body)}),this.extractIdObj(e,{body:t.body,model:a})}async dataDelete(e,t){const{model:a,view:i}=await this.getModelAndView(e,t);await this.checkForDuplicateRow(e,{rows:t.body,model:a});const s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)});return await r.bulkDelete(Array.isArray(t.body)?t.body:[t.body],{cookie:t.cookie,throwExceptionIfNotExist:!0,isSingleRecordDeletion:!Array.isArray(t.body)}),this.extractIdObj(e,{body:t.body,model:a})}async dataCount(e,t){const{model:a,view:i}=await this.getModelAndView(e,t),s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)}),l=Object.assign({},t.query);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}return{count:await r.count(l,!1,!0)}}async getModelAndView(e,t){const a=await _.Model.get(e,t.modelId);if(a||h.NcError.tableNotFound(t.modelId),t.baseId&&a.base_id!==t.baseId)throw new Error("Table not belong to base");let i;return t.viewId&&(i=await _.View.get(e,t.viewId),(!i||i.fk_model_id&&i.fk_model_id!==t.modelId)&&h.NcError.viewNotFound(t.viewId)),{model:a,view:i}}async extractIdObj(e,{model:t,body:a}){const i=await t.getColumns(e).then((e=>e.filter((e=>e.pk)))),s=(Array.isArray(a)?a:[a]).map((e=>i.reduce(((t,a)=>{var i;return t[a.title]=null!==(i=e[a.title])&&void 0!==i?i:e[a.column_name],t}),{})));return Array.isArray(a)?s:s[0]}async checkForDuplicateRow(e,{rows:t,model:a}){var i;if(!t||!Array.isArray(t)||1===t.length)return;await a.getColumns(e);const s=new Set;for(const e of t){let t;t=1===a.primaryKeys.length?null!==(i=e[a.primaryKey.title])&&void 0!==i?i:e[a.primaryKey.column_name]:a.primaryKeys.map((t=>{var a;return null!==(a=e[t.title])&&void 0!==a?a:e[t.column_name]})).join("___"),s.has(t)&&h.NcError.unprocessableEntity("Duplicate record with id "+t),null==t&&h.NcError.unprocessableEntity("Primary key is required"),s.add(t)}}async nestedDataList(e,t){var a,i;const{model:s,view:r}=await this.getModelAndView(e,t),l=await _.Source.get(e,s.source_id),c=await _.Model.getBaseModelSQL(e,{id:s.id,viewId:null==r?void 0:r.id,dbDriver:await b.default.get(l)});await c.exist(t.rowId)||h.NcError.recordNotFound(`${t.rowId}`);const d=await this.getColumn(e,t),p=await d.getColOptions(e),f=await p.getRelatedTable(e),{ast:w,dependencyFields:v}=await(0,g.default)(e,{model:f,query:t.query,extractOnlyPrimaries:!((null===(a=t.query)||void 0===a?void 0:a.f)||(null===(i=t.query)||void 0===i?void 0:i.fields))}),T=v;try{T.filterArr=JSON.parse(T.filterArrJson)}catch(e){}try{T.sortArr=JSON.parse(T.sortArrJson)}catch(e){}let k,S;return p.type===u.RelationTypes.MANY_TO_MANY?(k=await c.mmList({colId:d.id,parentId:t.rowId},T),S=await c.mmListCount({colId:d.id,parentId:t.rowId},t.query)):p.type===u.RelationTypes.HAS_MANY?(k=await c.hmList({colId:d.id,id:t.rowId},T),S=await c.hmListCount({colId:d.id,id:t.rowId},t.query)):k=await c.btRead({colId:d.id,id:t.rowId},t.query),k=await(0,m.nocoExecute)(w,k,{},T),p.type===u.RelationTypes.BELONGS_TO?k:new y.PagedResponseImpl(k,Object.assign({count:S},t.query))}async getColumn(e,t){const a=await _.Column.get(e,{colId:t.columnId});return a||h.NcError.fieldNotFound(t.columnId),a.fk_model_id!==t.modelId&&h.NcError.badRequest("Column not belong to model"),(0,u.isLinksOrLTAR)(a)||h.NcError.badRequest("Column is not LTAR"),a}async nestedLink(e,t){this.validateIds(t.refRowIds);const{model:a,view:i}=await this.getModelAndView(e,t),s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)}),l=await this.getColumn(e,t);return await r.addLinks({colId:l.id,childIds:Array.isArray(t.refRowIds)?t.refRowIds:[t.refRowIds],rowId:t.rowId,cookie:t.cookie}),!0}async nestedUnlink(e,t){this.validateIds(t.refRowIds);const{model:a,view:i}=await this.getModelAndView(e,t);a||h.NcError.tableNotFound(t.modelId);const s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)}),l=await this.getColumn(e,t);return await r.removeLinks({colId:l.id,childIds:Array.isArray(t.refRowIds)?t.refRowIds:[t.refRowIds],rowId:t.rowId,cookie:t.cookie}),!0}async nestedListCopyPasteOrDeleteAll(e,t){var a,i;(0,p.validatePayload)("swagger.json#/components/schemas/nestedListCopyPasteOrDeleteAllReq",t.data);const s=t.data.reduce(((e,t)=>(e[t.operation]=t,e)),{});if(!s.deleteAll&&s.copy.fk_related_model_id!==s.paste.fk_related_model_id)throw new Error("The operation is not supported on different fk_related_model_id");const{model:r,view:l}=await this.getModelAndView(e,t),c=await _.Source.get(e,r.source_id),d=await _.Model.getBaseModelSQL(e,{id:r.id,viewId:null==l?void 0:l.id,dbDriver:await b.default.get(c)});if(s.deleteAll&&!await d.exist(s.deleteAll.rowId))h.NcError.recordNotFound(s.deleteAll.rowId);else if(s.copy&&s.paste){const[e,t]=await Promise.all([d.exist(s.copy.rowId),d.exist(s.paste.rowId)]);e||t?e?t||h.NcError.recordNotFound(s.paste.rowId):h.NcError.recordNotFound(s.copy.rowId):h.NcError.recordNotFound(`'${s.copy.rowId}' and '${s.paste.rowId}'`)}const m=await this.getColumn(e,t),f=await m.getColOptions(e),y=await f.getRelatedTable(e);if(await y.getColumns(e),f.type!==u.RelationTypes.MANY_TO_MANY)return;const{dependencyFields:w}=await(0,g.default)(e,{model:y,query:t.query,extractOnlyPrimaries:!((null===(a=t.query)||void 0===a?void 0:a.f)||(null===(i=t.query)||void 0===i?void 0:i.fields))}),v=w;try{v.filterArr=JSON.parse(v.filterArrJson)}catch(e){}try{v.sortArr=JSON.parse(v.sortArrJson)}catch(e){}if(s.deleteAll){let e=await d.mmList({colId:m.id,parentId:s.deleteAll.rowId},v,!0);return e&&Array.isArray(e)?(await d.removeLinks({colId:m.id,childIds:e,rowId:s.deleteAll.rowId,cookie:t.cookie}),e=e.map((e=>y.primaryKeys.reduce(((t,a)=>(t[a.title||a.column_name]=e[a.title||a.column_name],t)),{})))):e=[],{link:[],unlink:e}}if(s.copy&&s.paste){const[e,a]=await Promise.all([d.mmList({colId:s.copy.columnId,parentId:s.copy.rowId},v,!0),d.mmList({colId:m.id,parentId:s.paste.rowId},v,!0)]),i=this.filterAndMapRows(e,a,y.primaryKeys),r=this.filterAndMapRows(a,e,y.primaryKeys);return await Promise.all([i.length&&d.addLinks({colId:m.id,childIds:i,rowId:s.paste.rowId,cookie:t.cookie}),r.length&&d.removeLinks({colId:m.id,childIds:r,rowId:s.paste.rowId,cookie:t.cookie})]),{link:i,unlink:r}}}validateIds(e){if(Array.isArray(e)){const t=new Map,a=new Set;for(const i of e)null==i&&h.NcError.recordNotFound(i),t.has(i)?a.add(i):t.set(i,!0);a.size>0&&h.NcError.duplicateRecord([...a])}else null==e&&h.NcError.recordNotFound(e)}filterAndMapRows(e,t,a){return e.filter((e=>!t.some((t=>a.every((a=>e[a.title||a.column_name]===t[a.title||a.column_name])))))).map((e=>a.reduce(((t,a)=>(t[a.title||a.column_name]=e[a.title||a.column_name],t)),{})))}async bulkDataList(e,t){const{model:a,view:i}=await this.getModelAndView(e,t);let s=t.body;try{s=JSON.parse(s)}catch(e){}(null==s?void 0:s.length)||h.NcError.badRequest("Invalid bulkFilterList");return await s.reduce((async(t,s)=>{const r=await t,l=await this.datasService.dataList(e,{query:Object.assign({},s),model:a,view:i});return r[s.alias]=l,r}),Promise.resolve({}))}async bulkGroupBy(e,t){const{model:a,view:i}=await this.getModelAndView(e,t),s=await _.Source.get(e,a.source_id),r=await _.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await b.default.get(s)});let l=t.body;const c=Object.assign({},t.query);try{l=JSON.parse(l)}catch(e){}try{c.filterArr=JSON.parse(c.filterArrJSON)}catch(e){}(null==l?void 0:l.length)||h.NcError.badRequest("Invalid bulkFilterList");const[d,u]=await Promise.all([r.bulkGroupBy(c,l,i),r.bulkGroupByCount(c,l,i)]);return l.forEach((e=>{let t=d[e.alias];"string"==typeof t&&(t=JSON.parse(t));let a=u[e.alias];"string"==typeof a&&(a=JSON.parse(a)),d[e.alias]=new y.PagedResponseImpl(t,Object.assign(Object.assign({},e),{count:null==a?void 0:a.count}))})),d}};t.DataTableService=w,t.DataTableService=w=s([(0,d.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==f.DatasService&&f.DatasService)?i:Object])],w)},68144:function(e,t,a){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&s(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasService=void 0;const p=a(23324),m=a(71040),_=c(a(42056)),f=u(a(5520)),h=a(62304),g=a(44980),y=a(19684),b=a(43820),w=u(a(4456)),v=a(99572),T=u(a(82096));let k=i=class DatasService{constructor(){this.logger=new p.Logger(i.name)}async dataList(e,t){var a;let{model:i,view:s}=t;if(!i){const a=await(0,g.getViewAndModelByAliasOrId)(e,t);i=a.model,s=a.view}if(t.query.linkColumnId){const r=await y.Column.get(e,{colId:t.query.linkColumnId});r&&(0,m.isLinksOrLTAR)(r)&&r.colOptions.fk_related_model_id===i.id||b.NcError.fieldNotFound(null===(a=t.query)||void 0===a?void 0:a.linkColumnId,{customMessage:`Link column with id ${t.query.linkColumnId} not found`}),r.colOptions.fk_target_view_id&&(s=await y.View.get(e,r.colOptions.fk_target_view_id))}return await this.getDataList(e,{model:i,view:s,query:t.query,throwErrorIfInvalidParams:!0,ignorePagination:t.ignorePagination,limitOverride:t.limitOverride})}async dataFindOne(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t);return await this.getFindOne(e,{model:a,view:i,query:t.query})}async dataGroupBy(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t);return await this.getDataGroupBy(e,{model:a,view:i,query:t.query})}async dataCount(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t),s=await y.Source.get(e,a.source_id),r=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(s),source:s}),l=Object.assign(Object.assign({},t.query),{throwErrorIfInvalidParams:!0});try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}return{count:await r.count(l)}}async dataInsert(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t),s=await y.Source.get(e,a.source_id),r=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(s),source:s});return await r.nestedInsert(t.body,null,t.cookie)}async dataUpdate(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t),s=await y.Source.get(e,a.source_id),r=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(s),source:s});return await r.updateByPk(t.rowId,t.body,null,t.cookie,t.disableOptimization)}async dataDelete(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t),s=await y.Source.get(e,a.source_id),r=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(s),source:s});if(!s.isMeta()){const e=await r.hasLTARData(t.rowId,a);e.length&&b.NcError.badRequest(e)}return await r.delByPk(t.rowId,null,t.cookie)}async getDataList(e,t){const{model:a,view:i,query:s={},ignoreViewFilterAndSort:r=!1}=t,l=await y.Source.get(e,a.source_id),c=t.baseModel||await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(l),source:l}),{ast:d,dependencyFields:u}=await(0,w.default)(e,{model:a,query:s,view:i,throwErrorIfInvalidParams:t.throwErrorIfInvalidParams}),p=u;try{p.filterArr=JSON.parse(p.filterArrJson)}catch(e){}try{p.sortArr=JSON.parse(p.sortArrJson)}catch(e){}p.customConditions=t.customConditions;const[m,_]=await Promise.all([c.count(p,!1,t.throwErrorIfInvalidParams),(async()=>{let e=[];try{e=await(0,h.nocoExecute)(d,await c.list(p,{ignoreViewFilterAndSort:r,throwErrorIfInvalidParams:t.throwErrorIfInvalidParams,ignorePagination:t.ignorePagination,limitOverride:t.limitOverride}),{},p)}catch(e){if(e instanceof b.NcBaseError)throw e;this.logger.error(e),b.NcError.internalServerError("Please check server log for more details")}return e})()]);return new v.PagedResponseImpl(_,Object.assign(Object.assign(Object.assign({},s),t.limitOverride?{limitOverride:t.limitOverride}:{}),{count:m}))}async getFindOne(e,t){const{model:a,view:i,query:s={}}=t,r=await y.Source.get(e,a.source_id),l=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c=Object.assign({},s);try{c.filterArr=JSON.parse(c.filterArrJson)}catch(e){}try{c.sortArr=JSON.parse(c.sortArrJson)}catch(e){}const{ast:d,dependencyFields:u}=await(0,w.default)(e,{model:a,query:c,view:i}),p=await l.findOne(Object.assign(Object.assign({},c),u));return p?await(0,h.nocoExecute)(d,p,{},u):{}}async getDataGroupBy(e,t){const{model:a,view:i,query:s={}}=t,r=await y.Source.get(e,a.source_id),l=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c=Object.assign({},s);try{c.filterArr=JSON.parse(c.filterArrJson)}catch(e){}try{c.sortArr=JSON.parse(c.sortArrJson)}catch(e){}const d=await l.groupBy(c),u=await l.groupByCount(c);return new v.PagedResponseImpl(d,Object.assign(Object.assign({},s),{count:u}))}async dataRead(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t),s=await y.Source.get(e,a.source_id),r=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(s),source:s}),l=await r.readByPk(t.rowId,!1,t.query,{getHiddenColumn:t.getHiddenColumn});return l||b.NcError.recordNotFound(t.rowId),l}async dataExist(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t),s=await y.Source.get(e,a.source_id),r=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(s),source:s});return await r.exist(t.rowId)}async groupedDataList(e,t){const{model:a,view:i}=await(0,g.getViewAndModelByAliasOrId)(e,t);return await this.getGroupedDataList(e,{model:a,view:i,query:t.query,columnId:t.columnId})}async getGroupedDataList(e,t){const{model:a,view:i,query:s={}}=t,r=await y.Source.get(e,a.source_id),l=await y.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),{ast:c,dependencyFields:d}=await(0,w.default)(e,{model:a,query:s,view:i}),u=Object.assign({},d);try{u.filterArr=JSON.parse(u.filterArrJson)}catch(e){}try{u.sortArr=JSON.parse(u.sortArrJson)}catch(e){}try{u.options=JSON.parse(u.optionsArrJson)}catch(e){}let p=[];const m=await l.groupedList(Object.assign(Object.assign({},u),{groupColumnId:t.columnId}));p=await(0,h.nocoExecute)({key:1,value:c},m,{},u);const _=await l.groupedListCount(Object.assign(Object.assign({},u),{groupColumnId:t.columnId}));return p=p.map((e=>{var t,a;const i=null!==(a=null===(t=_.find((t=>t.key===e.key)))||void 0===t?void 0:t.count)&&void 0!==a?a:0;return e.value=new v.PagedResponseImpl(e.value,Object.assign(Object.assign({},s),{count:i})),e})),p}async dataListByViewId(e,t){const a=await y.View.get(e,t.viewId),i=await y.Model.getByIdOrName(e,{id:(null==a?void 0:a.fk_model_id)||t.viewId});return i||b.NcError.tableNotFound((null==a?void 0:a.fk_model_id)||t.viewId),await this.getDataList(e,{model:i,view:a,query:t.query})}async mmList(e,t){var a;const i=await y.View.get(e,t.viewId),s=await y.Model.getByIdOrName(e,{id:(null==i?void 0:i.fk_model_id)||t.viewId});s||b.NcError.tableNotFound((null==i?void 0:i.fk_model_id)||t.viewId);const r=await y.Source.get(e,s.source_id),l=await y.Model.getBaseModelSQL(e,{id:s.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c=`${s.title}List`,d={[c]:1},u=null===(a=await(0,h.nocoExecute)(d,{[c]:async e=>await l.mmList({colId:t.colId,parentId:t.rowId},e)},{},{nested:{[c]:t.query}}))||void 0===a?void 0:a[c],p=await l.mmListCount({colId:t.colId,parentId:t.rowId},t.query);return new v.PagedResponseImpl(u,Object.assign({count:p},t.query))}async mmExcludedList(e,t){var a;const i=await y.View.get(e,t.viewId),s=await y.Model.getByIdOrName(e,{id:(null==i?void 0:i.fk_model_id)||t.viewId});s||b.NcError.tableNotFound((null==i?void 0:i.fk_model_id)||t.viewId);const r=await y.Source.get(e,s.source_id),l=await y.Model.getBaseModelSQL(e,{id:s.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c="List",d={[c]:1},u=null===(a=await(0,h.nocoExecute)(d,{[c]:async e=>await l.getMmChildrenExcludedList({colId:t.colId,pid:t.rowId},e)},{},{nested:{[c]:t.query}}))||void 0===a?void 0:a[c],p=await l.getMmChildrenExcludedListCount({colId:t.colId,pid:t.rowId},t.query);return new v.PagedResponseImpl(u,Object.assign({count:p},t.query))}async hmExcludedList(e,t){var a;const i=await y.View.get(e,t.viewId),s=await y.Model.getByIdOrName(e,{id:(null==i?void 0:i.fk_model_id)||t.viewId});s||b.NcError.tableNotFound((null==i?void 0:i.fk_model_id)||t.viewId);const r=await y.Source.get(e,s.source_id),l=await y.Model.getBaseModelSQL(e,{id:s.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c="List",d={[c]:1},u=null===(a=await(0,h.nocoExecute)(d,{[c]:async e=>await l.getHmChildrenExcludedList({colId:t.colId,pid:t.rowId},e)},{},{nested:{[c]:t.query}}))||void 0===a?void 0:a[c],p=await l.getHmChildrenExcludedListCount({colId:t.colId,pid:t.rowId},t.query);return new v.PagedResponseImpl(u,Object.assign({count:p},t.query))}async btExcludedList(e,t){var a;const i=await y.View.get(e,t.viewId),s=await y.Model.getByIdOrName(e,{id:(null==i?void 0:i.fk_model_id)||t.viewId});if(!s)return b.NcError.tableNotFound((null==i?void 0:i.fk_model_id)||t.viewId);const r=await y.Source.get(e,s.source_id),l=await y.Model.getBaseModelSQL(e,{id:s.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c="List",d={[c]:1},u=null===(a=await(0,h.nocoExecute)(d,{[c]:async e=>await l.getBtChildrenExcludedList({colId:t.colId,cid:t.rowId},e)},{},{nested:{[c]:t.query}}))||void 0===a?void 0:a[c],p=await l.getBtChildrenExcludedListCount({colId:t.colId,cid:t.rowId},t.query);return new v.PagedResponseImpl(u,Object.assign({count:p},t.query))}async hmList(e,t){var a;const i=await y.View.get(e,t.viewId),s=await y.Model.getByIdOrName(e,{id:(null==i?void 0:i.fk_model_id)||t.viewId});s||b.NcError.tableNotFound((null==i?void 0:i.fk_model_id)||t.viewId);const r=await y.Source.get(e,s.source_id),l=await y.Model.getBaseModelSQL(e,{id:s.id,viewId:null==i?void 0:i.id,dbDriver:await T.default.get(r),source:r}),c=`${s.title}List`,d={[c]:1},u=null===(a=await(0,h.nocoExecute)(d,{[c]:async e=>await l.hmList({colId:t.colId,id:t.rowId},e)},{},{nested:{[c]:t.query}}))||void 0===a?void 0:a[c],p=await l.hmListCount({colId:t.colId,id:t.rowId},t.query);return new v.PagedResponseImpl(u,{totalRows:p})}async dataReadByViewId(e,t){try{const a=await y.Model.getByIdOrName(e,{id:t.viewId});a||b.NcError.tableNotFound(t.viewId);const i=await y.Source.get(e,a.source_id),s=await y.Model.getBaseModelSQL(e,{id:a.id,dbDriver:await T.default.get(i),source:i}),{ast:r,dependencyFields:l}=await(0,w.default)(e,{model:a,query:t.query});return await(0,h.nocoExecute)(r,await s.readByPk(t.rowId,!1),{},l)}catch(e){this.logger.error(e),b.NcError.internalServerError("Please check server log for more details")}}async dataInsertByViewId(e,t){const a=await y.Model.getByIdOrName(e,{id:t.viewId});if(!a)return b.NcError.tableNotFound(t.viewId);const i=await y.Source.get(e,a.source_id),s=await y.Model.getBaseModelSQL(e,{id:a.id,dbDriver:await T.default.get(i),source:i});return await s.insert(t.body,null,t.cookie)}async dataUpdateByViewId(e,t){const a=await y.Model.getByIdOrName(e,{id:t.viewId});a||b.NcError.tableNotFound(t.viewId);const i=await y.Source.get(e,a.source_id),s=await y.Model.getBaseModelSQL(e,{id:a.id,dbDriver:await T.default.get(i),source:i});return await s.updateByPk(t.rowId,t.body,null,t.cookie)}async dataDeleteByViewId(e,t){const a=await y.Model.getByIdOrName(e,{id:t.viewId});a||b.NcError.tableNotFound(t.viewId);const i=await y.Source.get(e,a.source_id),s=await y.Model.getBaseModelSQL(e,{id:a.id,dbDriver:await T.default.get(i),source:i});return await s.delByPk(t.rowId,null,t.cookie)}async relationDataDelete(e,t){const a=await y.View.get(e,t.viewId),i=await y.Model.getByIdOrName(e,{id:(null==a?void 0:a.fk_model_id)||t.viewId});i||b.NcError.tableNotFound((null==a?void 0:a.fk_model_id)||t.viewId);const s=await y.Source.get(e,i.source_id),r=await y.Model.getBaseModelSQL(e,{id:i.id,viewId:null==a?void 0:a.id,dbDriver:await T.default.get(s),source:s});return await r.removeChild({colId:t.colId,childId:t.childId,rowId:t.rowId,cookie:t.cookie}),!0}async relationDataAdd(e,t){const a=await y.View.get(e,t.viewId),i=await y.Model.getByIdOrName(e,{id:(null==a?void 0:a.fk_model_id)||t.viewId});i||b.NcError.tableNotFound((null==a?void 0:a.fk_model_id)||t.viewId);const s=await y.Source.get(e,i.source_id),r=await y.Model.getBaseModelSQL(e,{id:i.id,viewId:null==a?void 0:a.id,dbDriver:await T.default.get(s),source:s});return await r.addChild({colId:t.colId,childId:t.childId,rowId:t.rowId,cookie:t.cookie}),!0}async getViewAndModelFromRequestByAliasOrId(e,t){const a=await y.Base.getWithInfoByTitleOrId(e,t.params.baseName),i=await y.Model.getByAliasOrId(e,{base_id:a.id,aliasOrId:t.params.tableName}),s=t.params.viewName&&await y.View.getByTitleOrId(e,{titleOrId:t.params.viewName,fk_model_id:i.id});return i||b.NcError.tableNotFound(t.params.tableName),{model:i,view:s}}async extractXlsxData(e,t){const{view:a,query:i,siteUrl:s}=t,r=await y.Source.get(e,a.source_id);await a.getModelWithInfo(e),await a.getColumns(e),a.model.columns=a.columns.filter((e=>e.show)).map((e=>new y.Column(Object.assign(Object.assign({},e),a.model.columnsById[e.fk_column_id])))).filter((e=>!(0,m.isSystemColumn)(e)||a.show_system_fields));const l=await y.Model.getBaseModelSQL(e,{id:a.model.id,viewId:null==a?void 0:a.id,dbDriver:await T.default.get(r),source:r}),{offset:c,dbRows:d,elapsed:u}=await(0,g.getDbRows)(e,{baseModel:l,view:a,query:i,siteUrl:s}),p=i.fields;return{offset:c,dbRows:d,elapsed:u,data:_.utils.json_to_sheet(d,{header:p})}}async extractCsvData(e,t,a){const i=await y.Source.get(e,t.source_id),s=a.query.fields;await t.getModelWithInfo(e),await t.getColumns(e),t.model.columns=t.columns.filter((e=>e.show)).map((e=>new y.Column(Object.assign(Object.assign({},e),t.model.columnsById[e.fk_column_id])))).filter((e=>!(0,m.isSystemColumn)(e)||t.show_system_fields));const r=await y.Model.getBaseModelSQL(e,{id:t.model.id,viewId:null==t?void 0:t.id,dbDriver:await T.default.get(i),source:i}),{offset:l,dbRows:c,elapsed:d}=await(0,g.getDbRows)(e,{baseModel:r,view:t,query:a.query,siteUrl:a.ncSiteUrl});return{offset:l,dbRows:c,elapsed:d,data:f.default.unparse({fields:t.model.columns.sort(((e,t)=>Array.isArray(s)?s.indexOf(e.title)-s.indexOf(t.title):0)).filter((e=>!s||!Array.isArray(s)||s.includes(e.title))).map((e=>e.title)),data:c},{escapeFormulae:!0})}}async getColumnByIdOrName(e,t,a){const i=(await a.getColumns(e)).find((e=>e.title===t||e.id===t||e.column_name===t));return i||b.NcError.fieldNotFound(t),i}};t.DatasService=k,t.DatasService=k=i=l([(0,p.Injectable)(),d("design:paramtypes",[])],k)},44596:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionsService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(19684);let m=class ExtensionsService{constructor(e){this.appHooksService=e}async extensionList(e,t){return await p.Extension.list(e,t.baseId)}async extensionRead(e,t){return await p.Extension.get(e,t.extensionId)}async extensionCreate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/ExtensionReq",t.extension);const a=await p.Extension.insert(e,Object.assign(Object.assign({},t.extension),{fk_user_id:t.req.user.id}));return this.appHooksService.emit(c.AppEvents.EXTENSION_CREATE,{extensionId:a.id,extension:t.extension,req:t.req}),a}async extensionUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/ExtensionReq",t.extension);const a=await p.Extension.update(e,t.extensionId,t.extension);return this.appHooksService.emit(c.AppEvents.EXTENSION_UPDATE,{extensionId:t.extensionId,extension:t.extension,req:t.req}),a}async extensionDelete(e,t){const a=await p.Extension.delete(e,t.extensionId);return this.appHooksService.emit(c.AppEvents.EXTENSION_DELETE,{extensionId:t.extensionId,req:t.req}),a}};t.ExtensionsService=m,t.ExtensionsService=m=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],m)},53311:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FiltersService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(43820),m=a(19684);let _=class FiltersService{constructor(e){this.appHooksService=e}async hookFilterCreate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/FilterReq",t.filter);const a=await m.Hook.get(e,t.hookId);a||p.NcError.badRequest("Hook not found");const i=await m.Filter.insert(e,Object.assign(Object.assign({},t.filter),{fk_hook_id:t.hookId}));return this.appHooksService.emit(c.AppEvents.FILTER_CREATE,{filter:i,hook:a,req:t.req}),i}async hookFilterList(e,t){return m.Filter.rootFilterListByHook(e,{hookId:t.hookId})}async filterDelete(e,t){const a=await m.Filter.get(e,t.filterId);return a||p.NcError.badRequest("Filter not found"),await m.Filter.delete(e,t.filterId),this.appHooksService.emit(c.AppEvents.FILTER_DELETE,{filter:a,req:t.req}),!0}async filterCreate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/FilterReq",t.filter);const a=await m.View.get(e,t.viewId),i=await m.Filter.insert(e,Object.assign(Object.assign({},t.filter),{fk_view_id:t.viewId}));return this.appHooksService.emit(c.AppEvents.FILTER_CREATE,{filter:i,view:a,req:t.req}),i}async filterUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/FilterReq",t.filter);const a=await m.Filter.get(e,t.filterId);a||p.NcError.badRequest("Filter not found");const i=await m.Filter.update(e,t.filterId,t.filter);return this.appHooksService.emit(c.AppEvents.FILTER_UPDATE,{filter:a,req:t.req}),i}async filterChildrenList(e,t){return m.Filter.parentFilterList(e,{parentId:t.filterId})}async filterGet(e,t){return await m.Filter.get(e,t.filterId)}async filterList(e,t){return await(t.includeAllFilters?m.Filter.allViewFilterList(e,{viewId:t.viewId}):m.Filter.rootFilterList(e,{viewId:t.viewId}))}async linkFilterCreate(e,t){return null}};t.FiltersService=_,t.FiltersService=_=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],_)},69200:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FormColumnsService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(19684);let m=class FormColumnsService{constructor(e){this.appHooksService=e}async columnUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/FormColumnReq",t.formViewColumn);const a=await p.FormViewColumn.update(e,t.formViewColumnId,t.formViewColumn);return this.appHooksService.emit(c.AppEvents.FORM_COLUMN_UPDATE,{req:t.req}),a}};t.FormColumnsService=m,t.FormColumnsService=m=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],m)},76383:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormsService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(43820),_=a(19684),f=l(a(57804)),h=a(64612);let g=class FormsService{constructor(e){this.appHooksService=e}async formViewGet(e,t){return await _.FormView.getWithInfo(e,t.formViewId)}async formViewCreate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",t.body);const a=await _.Model.get(e,t.tableId),i=await _.Source.get(e,a.source_id);i.is_data_readonly&&m.NcError.sourceDataReadOnly(i.alias);const{id:s}=await _.View.insertMetaOnly(e,Object.assign(Object.assign({},t.body),{fk_model_id:t.tableId,type:d.ViewTypes.FORM,base_id:a.base_id,source_id:a.source_id}),a),r=await _.View.get(e,s);return await f.default.appendToList(h.CacheScope.VIEW,[r.fk_model_id],`${h.CacheScope.VIEW}:${s}`),this.appHooksService.emit(d.AppEvents.VIEW_CREATE,{user:t.user,view:r,showAs:"form",req:t.req}),r}async formViewUpdate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/FormUpdateReq",t.form);const a=await _.View.get(e,t.formViewId);a||m.NcError.viewNotFound(t.formViewId);const i=await _.FormView.update(e,t.formViewId,t.form);return this.appHooksService.emit(d.AppEvents.VIEW_UPDATE,{view:a,showAs:"form",req:t.req}),i}};t.FormsService=g,t.FormsService=g=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],g)},48968:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GalleriesService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(43820),_=a(19684),f=l(a(57804)),h=a(64612);let g=class GalleriesService{constructor(e){this.appHooksService=e}async galleryViewGet(e,t){return await _.GalleryView.get(e,t.galleryViewId)}async galleryViewCreate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",t.gallery);const a=await _.Model.get(e,t.tableId),{id:i}=await _.View.insertMetaOnly(e,Object.assign(Object.assign({},t.gallery),{fk_model_id:t.tableId,type:d.ViewTypes.GALLERY,base_id:a.base_id,source_id:a.source_id}),a),s=await _.View.get(e,i);return await f.default.appendToList(h.CacheScope.VIEW,[s.fk_model_id],`${h.CacheScope.VIEW}:${i}`),this.appHooksService.emit(d.AppEvents.VIEW_CREATE,{view:s,showAs:"gallery",req:t.req}),s}async galleryViewUpdate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/GalleryUpdateReq",t.gallery);const a=await _.View.get(e,t.galleryViewId);a||m.NcError.viewNotFound(t.galleryViewId);const i=await _.GalleryView.update(e,t.galleryViewId,t.gallery);return this.appHooksService.emit(d.AppEvents.VIEW_UPDATE,{view:a,showAs:"gallery",req:t.req}),i}};t.GalleriesService=g,t.GalleriesService=g=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],g)},75564:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GridColumnsService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(19684);let m=class GridColumnsService{constructor(e){this.appHooksService=e}async columnList(e,t){return await p.GridViewColumn.list(e,t.gridViewId)}async gridColumnUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/GridColumnReq",t.grid);const a=await p.GridViewColumn.update(e,t.gridViewColumnId,t.grid);return this.appHooksService.emit(c.AppEvents.GRID_COLUMN_UPDATE,{req:t.req}),a}};t.GridColumnsService=m,t.GridColumnsService=m=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],m)},98348:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GridsService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(43820),_=a(19684),f=l(a(57804)),h=a(64612);let g=class GridsService{constructor(e){this.appHooksService=e}async gridViewCreate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",t.grid);const a=await _.Model.get(e,t.tableId),{id:i}=await _.View.insertMetaOnly(e,Object.assign(Object.assign({},t.grid),{fk_model_id:t.tableId,type:d.ViewTypes.GRID,base_id:a.base_id,source_id:a.source_id}),a),s=await _.View.get(e,i);return await f.default.appendToList(h.CacheScope.VIEW,[s.fk_model_id],`${h.CacheScope.VIEW}:${i}`),this.appHooksService.emit(d.AppEvents.VIEW_CREATE,{view:s,showAs:"grid",req:t.req}),s}async gridViewUpdate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/GridUpdateReq",t.grid);const a=await _.View.get(e,t.viewId);a||m.NcError.viewNotFound(t.viewId);const i=await _.GridView.update(e,t.viewId,t.grid);return this.appHooksService.emit(d.AppEvents.VIEW_UPDATE,{view:a,showAs:"map",req:t.req}),i}};t.GridsService=g,t.GridsService=g=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],g)},26972:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HookHandlerService=t.HANDLE_WEBHOOK=void 0;const m=a(23324),_=a(71040),f=p(a(58016)),h=p(a(23080)),g=a(14836),y=a(61436),b=p(a(27108)),w=a(19684),v=a(81472),T=a(892);t.HANDLE_WEBHOOK="__nc_handleHooks";let k=i=class HookHandlerService{constructor(e,t){this.eventEmitter=e,this.jobsService=t,this.logger=new m.Logger(i.name)}async handleHooks(e,{hookName:t,prevData:a,newData:i,user:s,viewId:r,modelId:l,tnPath:c}){var d;const u=await w.View.get(e,r),p=await w.Model.get(e,l);if(("after.insert"===t||"after.bulkInsert"===t)&&u.type===_.ViewTypes.FORM)try{const t=await u.getView(e),a=Object.entries(JSON.parse(null==t?void 0:t.email)||{}).filter((e=>e[1])).map((e=>e[0]));if(null==a?void 0:a.length){const{columns:s}=await w.FormView.getWithInfo(e,t.fk_view_id),r=await p.getColumns(e),l=s.reduce(((e,t)=>Object.assign(e,{[t.fk_column_id]:t})),{});let u=1;const m=null==r?void 0:r.map((e=>Object.assign(Object.assign(Object.assign(Object.assign({},e),{fk_column_id:e.id,fk_view_id:t.fk_view_id}),l[e.id]?l[e.id]:{}),{order:l[e.id]&&l[e.id].order||u++,id:l[e.id]&&l[e.id].id}))).sort(((e,t)=>e.order-t.order)).filter((e=>e.show&&e.uidt!==_.UITypes.Rollup&&e.uidt!==_.UITypes.Lookup&&e.uidt!==_.UITypes.Formula&&e.uidt!==_.UITypes.QrCode&&e.uidt!==_.UITypes.Barcode&&e.uidt!==_.UITypes.SpecificDBType)).sort(((e,t)=>e.order-t.order)).map((e=>(e.required=!!e.required,e))),y=(0,g._transformSubmittedFormDataForEmail)(i,t,m);null===(d=await h.default.emailAdapter(!1))||void 0===d||d.mailSend({to:a.join(","),subject:"NocoDB Form",html:f.default.render(b.default,{data:y,tn:c,_tn:p.title})})}}catch(e){this.logger.error({error:e,details:"Error while sending form submission email",hookName:t})}const[m,y]=t.split("."),T=await w.Hook.list(e,{fk_model_id:l,event:m,operation:y});for(const t of T)if(t.active)try{await this.jobsService.add(v.JobTypes.HandleWebhook,{context:e,hookId:t.id,modelId:l,viewId:r,prevData:a,newData:i,user:s})}catch(e){this.logger.error({error:e,details:"Error while invoking webhook",hook:t.id})}}onModuleInit(){this.unsubscribe=this.eventEmitter.on(t.HANDLE_WEBHOOK,(async e=>{const{context:t}=e,a=u(e,["context"]);return this.handleHooks(t,a)}))}onModuleDestroy(){var e;null===(e=this.unsubscribe)||void 0===e||e.call(this)}};t.HookHandlerService=k,t.HookHandlerService=k=i=l([(0,m.Injectable)(),d(0,(0,m.Inject)("IEventEmitter")),d(1,(0,m.Inject)("JobsService")),c("design:paramtypes",["function"==typeof(s=void 0!==y.IEventEmitter&&y.IEventEmitter)?s:Object,"function"==typeof(r=void 0!==T.IJobsService&&T.IJobsService)?r:Object])],k)},5348:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HooksService=void 0;const p=a(23324),m=a(71040),_=u(a(70176)),f=a(52144),h=a(43468),g=a(43820),y=a(43248),b=a(14836),w=a(19684),v=a(68144),T=a(81472),k=a(892);let S=class HooksService{constructor(e,t,a){this.appHooksService=e,this.dataService=t,this.jobsService=a}validateHookPayload(e){let t={};try{t="string"==typeof e?JSON.parse(e):e}catch(e){}"URL"!==t.type&&"true"===process.env.NC_CLOUD&&g.NcError.badRequest("Only URL notification is supported")}async hookList(e,t){return await w.Hook.list(e,{fk_model_id:t.tableId})}async hookLogList(e,t){return await w.HookLog.list(e,{fk_hook_id:t.hookId},t.query)}async hookCreate(e,t){(0,h.validatePayload)("swagger.json#/components/schemas/HookReq",t.hook),this.validateHookPayload(t.hook.notification);const a=await w.Hook.insert(e,Object.assign(Object.assign({},t.hook),{fk_model_id:t.tableId}));return this.appHooksService.emit(m.AppEvents.WEBHOOK_CREATE,{hook:a,req:t.req}),a}async hookDelete(e,t){const a=await w.Hook.get(e,t.hookId);a||g.NcError.hookNotFound(t.hookId);const i=await w.Hook.hookUsages(e,t.hookId);if(i.length){for(const t of i)await w.ButtonColumn.update(e,t.fk_column_id,{fk_webhook_id:null});await _.default.clearSingleQueryCache(e,a.fk_model_id)}return await w.Hook.delete(e,t.hookId),this.appHooksService.emit(m.AppEvents.WEBHOOK_DELETE,{hook:a,req:t.req}),!0}async hookUpdate(e,t){(0,h.validatePayload)("swagger.json#/components/schemas/HookReq",t.hook);const a=await w.Hook.get(e,t.hookId);if(a||g.NcError.hookNotFound(t.hookId),this.validateHookPayload(t.hook.notification),a.active&&!t.hook.active||a.event!==t.hook.event){const i=await w.Hook.hookUsages(e,t.hookId);if(i.length)for(const t of i)await w.ButtonColumn.update(e,t.fk_column_id,{fk_webhook_id:null});await _.default.clearSingleQueryCache(e,a.fk_model_id)}const i=await w.Hook.update(e,t.hookId,t.hook);return this.appHooksService.emit(m.AppEvents.WEBHOOK_UPDATE,{hook:Object.assign(Object.assign({},a),t.hook),req:t.req}),i}async hookTrigger(e,t){const a=await w.Hook.get(e,t.hookId);a||"manual"===a.event||g.NcError.badRequest("Hook not found");const i=await this.dataService.dataRead(e,{rowId:t.rowId,query:{},baseName:a.base_id,tableName:a.fk_model_id});i||g.NcError.badRequest("Row not found");const s=await w.Model.get(e,a.fk_model_id);try{await this.jobsService.add(T.JobTypes.HandleWebhook,{hookId:a.id,modelId:s.id,viewId:null,prevData:null,newData:i,user:t.req.user})}catch(e){throw e}return!0}async hookTest(e,t){var a;(0,h.validatePayload)("swagger.json#/components/schemas/HookTestReq",t.hookTest),this.validateHookPayload(null===(a=t.hookTest.hook)||void 0===a?void 0:a.notification);const i=await w.Model.getByIdOrName(e,{id:t.tableId}),{hook:s,payload:{data:r,user:l}}=t.hookTest;try{await(0,b.invokeWebhook)(e,{hook:new w.Hook(s),model:i,view:null,prevData:null,newData:r,user:l,testFilters:null==s?void 0:s.filters,throwErrorOnFailure:!0,testHook:!0})}catch(e){throw e}finally{this.appHooksService.emit(m.AppEvents.WEBHOOK_TEST,{hook:s,req:t.req})}return!0}async tableSampleData(e,t){const a=new w.Model(await w.Model.getByIdOrName(e,{id:t.tableId}));return"v1"===t.version?await(0,y.populateSamplePayload)(e,a,!1,t.operation):await(0,y.populateSamplePayloadV2)(e,a,!1,t.operation)}async hookLogCount(e,t){return await w.HookLog.count(e,{hookId:t.hookId})}};t.HooksService=S,t.HooksService=S=l([(0,p.Injectable)(),d(2,(0,p.Inject)("JobsService")),c("design:paramtypes",["function"==typeof(i=void 0!==f.AppHooksService&&f.AppHooksService)?i:Object,"function"==typeof(s=void 0!==v.DatasService&&v.DatasService)?s:Object,"function"==typeof(r=void 0!==k.IJobsService&&k.IJobsService)?r:Object])],S)},47132:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IntegrationsService=void 0;const d=a(23324),u=a(71040),p=a(71040),m=a(52144),_=a(43468),f=a(19684),h=a(43820),g=a(19684),y=a(64612),b=c(a(76584)),w=c(a(57804)),v=c(a(82096)),T=a(89604),k=a(81472),S=a(92900),M=a(82048);let O=class IntegrationsService{constructor(e,t){this.appHooksService=e,this.sourcesService=t}async integrationGetWithConfig(e,t){const a=await f.Integration.get(e,t.integrationId);return a||h.NcError.integrationNotFound(t.integrationId),a.config=await a.getConnectionConfig(),t.includeSources&&await a.getSources(),a}async integrationUpdate(e,t){var a;(0,_.validatePayload)("swagger.json#/components/schemas/IntegrationReq",t.integration);const i=t.integration,s=await f.Integration.updateIntegration(e,t.integrationId,Object.assign(Object.assign({},i),{id:t.integrationId}));return await this.updateIntegrationSourceConfig({integration:s}),s.config=void 0,this.appHooksService.emit(u.AppEvents.INTEGRATION_UPDATE,{integration:s,req:t.req,user:null===(a=t.req)||void 0===a?void 0:a.user}),s}async integrationList(e){var t;return await f.Integration.list({userId:null===(t=e.req.user)||void 0===t?void 0:t.id,includeDatabaseInfo:e.includeDatabaseInfo,type:e.type,limit:e.limit,offset:e.offset,includeSourceCount:!0,query:e.query})}async integrationDelete(e,t){var a;const i=await b.default.ncMeta.startTransaction();try{const s=await f.Integration.get(e,t.integrationId,!0,i);s||h.NcError.integrationNotFound(t.integrationId);const r=i.knex(y.MetaTable.SOURCES).where({fk_integration_id:s.id}).where((e=>{e.where("deleted",!1).orWhere("deleted",null)}));s.fk_workspace_id&&r.where("fk_workspace_id",s.fk_workspace_id);const l=await r.select("id","base_id");if(l.length>0&&!t.force){const e=await Promise.all(l.map((async e=>await f.Base.get({workspace_id:s.fk_workspace_id,base_id:e.base_id},e.base_id,i))));h.NcError.integrationLinkedWithMultiple(e,l)}for(const e of l)await this.sourcesService.baseDelete({workspace_id:s.fk_workspace_id,base_id:e.base_id},{sourceId:e.id,req:t.req},i);await s.delete(i),this.appHooksService.emit(u.AppEvents.INTEGRATION_DELETE,{integration:s,req:t.req,user:null===(a=t.req)||void 0===a?void 0:a.user}),await i.commit()}catch(e){if(await i.rollback(e),e instanceof h.NcError||e instanceof h.NcBaseError)throw e;h.NcError.badRequest(e)}return!0}async integrationSoftDelete(e,t){try{const a=await f.Integration.get(e,t.integrationId);a||h.NcError.integrationNotFound(t.integrationId),await a.softDelete()}catch(e){h.NcError.badRequest(e)}return!0}async integrationCreate(e,t){var a,i,s,r,l,c,d,m,g,y,b,w;let v;if((0,_.validatePayload)("swagger.json#/components/schemas/IntegrationReq",t.integration),t.integration.copy_from_id?(v=await f.Integration.get(e,t.integration.copy_from_id),(null==v?void 0:v.id)||h.NcError.integrationNotFound(t.integration.copy_from_id),v.config=await v.getConnectionConfig()):v=t.integration,null===(a=t.logger)||void 0===a||a.call(t,"Creating the integration"),"sqlite3"===v.sub_type){const e=await f.Integration.list({userId:null===(i=t.req.user)||void 0===i?void 0:i.id,includeDatabaseInfo:!0,type:p.IntegrationsType.Database,sub_type:u.ClientType.SQLITE,limit:1e3,offset:0,includeSourceCount:!1,query:""});if(e.list&&e.list.length>0)for(const t of e.list){const e=t.config;((null===(s=null==e?void 0:e.connection)||void 0===s?void 0:s.filename)||(null===(l=null===(r=null==e?void 0:e.connection)||void 0===r?void 0:r.connection)||void 0===l?void 0:l.filename))===((null===(d=null===(c=v.config)||void 0===c?void 0:c.connection)||void 0===d?void 0:d.filename)||(null===(y=null===(g=null===(m=v.config)||void 0===m?void 0:m.connection)||void 0===g?void 0:g.connection)||void 0===y?void 0:y.filename))&&h.NcError.badRequest("Integration with same file already exists")}}let T="";if(t.integration.copy_from_id){const e=(await f.Integration.list({userId:null===(b=t.req.user)||void 0===b?void 0:b.id,limit:1e3,offset:0,includeSourceCount:!1,query:""})).list||[];T=(0,M.generateUniqueName)(`${v.title} copy`,e.map((e=>e.title)))}const k=await f.Integration.createIntegration(Object.assign(Object.assign(Object.assign({},v),t.integration.copy_from_id?{title:T}:{}),{created_by:t.req.user.id}));return k.config=void 0,this.appHooksService.emit(u.AppEvents.INTEGRATION_CREATE,{integration:k,req:t.req,user:null===(w=t.req)||void 0===w?void 0:w.user}),k}async updateIntegrationSourceConfig({integration:e},t=b.default.ncMeta){const a=await t.metaList2(e.fk_workspace_id,y.RootScopes.WORKSPACE,y.MetaTable.SOURCES,{condition:{fk_integration_id:e.id},xcCondition:{_or:[{deleted:{eq:!1}},{deleted:{eq:null}}]}});for(const t of a){const a=new g.Source(t);await w.default.update(`${y.CacheScope.SOURCE}:${a.id}`,{integration_config:e.config}),await v.default.deleteAwait(a),T.JobsRedis.available&&(await T.JobsRedis.emitWorkerCommand(k.InstanceCommands.RELEASE,a.id),await T.JobsRedis.emitPrimaryCommand(k.InstanceCommands.RELEASE,a.id))}}};t.IntegrationsService=O,t.IntegrationsService=O=r([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==m.AppHooksService&&m.AppHooksService)?i:Object,"function"==typeof(s=void 0!==S.SourcesService&&S.SourcesService)?s:Object])],O)},35300:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsMetaService=void 0;const c=a(23324),d=l(a(44578)),u=a(81472),p=a(19684),m=l(a(76584));let _=class JobsMetaService{constructor(){}async list(e,t,a){return p.Job.list(e,{xcCondition:{_and:[...t.job?[{job:{eq:t.job}}]:[],...t.status?[{status:{eq:t.status}}]:[],{_or:[{updated_at:{gt:m.default.ncMeta.formatDateTime((0,d.default)().subtract(1,"hour").toISOString())}},{status:{eq:u.JobStatus.ACTIVE}},{status:{eq:u.JobStatus.WAITING}},{status:{eq:u.JobStatus.DELAYED}}]}]}}).then((e=>e.map((e=>{if(e.fk_user_id===a.user.id)return e;{const{result:t}=e;return r(e,["result"])}}))))}};t.JobsMetaService=_,t.JobsMetaService=_=i([(0,c.Injectable)(),s("design:paramtypes",[])],_)},86935:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.KanbansService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(43820),_=a(19684),f=l(a(57804)),h=a(64612);let g=class KanbansService{constructor(e){this.appHooksService=e}async kanbanViewGet(e,t){return await _.KanbanView.get(e,t.kanbanViewId)}async kanbanViewCreate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",t.kanban);const a=await _.Model.get(e,t.tableId),{id:i}=await _.View.insertMetaOnly(e,Object.assign(Object.assign({},t.kanban),{fk_model_id:t.tableId,type:d.ViewTypes.KANBAN,base_id:a.base_id,source_id:a.source_id}),a),s=await _.View.get(e,i);return await f.default.appendToList(h.CacheScope.VIEW,[s.fk_model_id],`${h.CacheScope.VIEW}:${i}`),this.appHooksService.emit(d.AppEvents.VIEW_CREATE,{view:s,showAs:"kanban",user:t.user,req:t.req}),s}async kanbanViewUpdate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/KanbanUpdateReq",t.kanban);const a=await _.View.get(e,t.kanbanViewId);a||m.NcError.viewNotFound(t.kanbanViewId);const i=await _.KanbanView.update(e,t.kanbanViewId,t.kanban);return this.appHooksService.emit(d.AppEvents.VIEW_UPDATE,{view:a,showAs:"kanban",req:t.req}),i}};t.KanbansService=g,t.KanbansService=g=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],g)},54256:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MapsService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(43820),_=a(19684),f=a(64612),h=l(a(57804));let g=class MapsService{constructor(e){this.appHooksService=e}async mapViewGet(e,t){return await _.MapView.get(e,t.mapViewId)}async mapViewCreate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",t.map);const a=await _.Model.get(e,t.tableId),{id:i}=await _.View.insertMetaOnly(e,Object.assign(Object.assign({},t.map),{fk_model_id:t.tableId,type:d.ViewTypes.MAP,base_id:a.base_id,source_id:a.source_id}),a),s=await _.View.get(e,i);return await h.default.appendToList(f.CacheScope.VIEW,[s.fk_model_id],`${f.CacheScope.VIEW}:${i}`),this.appHooksService.emit(d.AppEvents.VIEW_CREATE,{view:s,showAs:"map",req:t.req}),s}async mapViewUpdate(e,t){(0,p.validatePayload)("swagger.json#/components/schemas/MapUpdateReq",t.map);const a=await _.View.get(e,t.mapViewId);a||m.NcError.viewNotFound(t.mapViewId);const i=await _.MapView.update(e,t.mapViewId,t.map);return this.appHooksService.emit(d.AppEvents.VIEW_UPDATE,{view:a,showAs:"map",req:t.req}),i}};t.MapsService=g,t.MapsService=g=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],g)},69484:function(e,t,a){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&s(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaDiffsService=t.MetaDiffType=void 0;const p=a(23324),m=a(71040),_=a(42496),f=a(52144),h=u(a(25923)),g=u(a(47724)),y=c(a(57972)),b=a(98644),w=u(a(22200)),v=a(43820),T=u(a(50984)),k=u(a(82096)),S=a(19684);var M;!function(e){e.TABLE_NEW="TABLE_NEW",e.TABLE_REMOVE="TABLE_REMOVE",e.TABLE_COLUMN_ADD="TABLE_COLUMN_ADD",e.TABLE_COLUMN_TYPE_CHANGE="TABLE_COLUMN_TYPE_CHANGE",e.TABLE_COLUMN_PROPS_CHANGED="TABLE_COLUMN_PROPS_CHANGED",e.TABLE_COLUMN_REMOVE="TABLE_COLUMN_REMOVE",e.VIEW_NEW="VIEW_NEW",e.VIEW_REMOVE="VIEW_REMOVE",e.VIEW_COLUMN_ADD="VIEW_COLUMN_ADD",e.VIEW_COLUMN_TYPE_CHANGE="VIEW_COLUMN_TYPE_CHANGE",e.VIEW_COLUMN_REMOVE="VIEW_COLUMN_REMOVE",e.TABLE_RELATION_ADD="TABLE_RELATION_ADD",e.TABLE_RELATION_REMOVE="TABLE_RELATION_REMOVE",e.TABLE_VIRTUAL_M2M_REMOVE="TABLE_VIRTUAL_M2M_REMOVE"}(M||(t.MetaDiffType=M={}));const O=[M.VIEW_COLUMN_REMOVE,M.TABLE_RELATION_REMOVE];let I=class MetaDiffsService{constructor(e){this.appHooksService=e}async getMetaDiff(e,t,a,i){var s,r,l,c,d,u,p,_,f,h,g,y,b,w,v,T,k,S,O,I,C,E,x,L,R,N,A,D,j,P,q,U;if(i.is_meta)return[];const $=[],Y=[],B=null===(c=null===(l=null===(r=await t.tableList({schema:null===(s=i.getConfig())||void 0===s?void 0:s.schema}))||void 0===r?void 0:r.data)||void 0===l?void 0:l.list)||void 0===c?void 0:c.filter((e=>{var t;return!(null==a?void 0:a.prefix)||!i.is_meta||(null===(t=e.tn)||void 0===t?void 0:t.startsWith(null==a?void 0:a.prefix))})),F={},V=await i.getModels(e),H=[],G=[];for(const e of V)e.type===m.ModelTypes.TABLE?H.push(e):e.type===m.ModelTypes.VIEW&&G.push(e);const W=null===(p=null===(u=await t.relationListAll({schema:null===(d=i.getConfig())||void 0===d?void 0:d.schema}))||void 0===u?void 0:u.data)||void 0===p?void 0:p.list;for(const a of B){if("nc_evolutions"===a.tn)continue;const s=H.findIndex((e=>e.table_name===a.tn));if(-1===s){$.push({table_name:a.tn,source_id:i.id,type:m.ModelTypes.TABLE,detectedChanges:[{type:M.TABLE_NEW,msg:"New table"}]});continue}const r=H[s];H.splice(s,1);const l={title:r.title,meta:r.meta,table_name:a.tn,source_id:i.id,type:m.ModelTypes.TABLE,detectedChanges:[]};$.push(l),F[a.tn]=null===(h=null===(f=await t.columnList({tn:a.tn,schema:null===(_=i.getConfig())||void 0===_?void 0:_.schema}))||void 0===f?void 0:f.data)||void 0===h?void 0:h.list,await r.getColumns(e);for(const e of F[a.tn]){const t=r.columns.findIndex((t=>t.column_name===e.cn));if(-1===t){l.detectedChanges.push({type:M.TABLE_COLUMN_ADD,msg:`New column(${e.cn})`,cn:e.cn,id:r.id});continue}const[a]=r.columns.splice(t,1);a.dt!==e.dt&&l.detectedChanges.push({type:M.TABLE_COLUMN_TYPE_CHANGE,msg:`Column type changed(${e.cn})`,cn:a.column_name,id:r.id,column:a}),!!a.pk==!!e.pk&&!!a.rqd==!!e.rqd&&!!a.un==!!e.un&&!!a.ai==!!e.ai&&!!a.unique==!!e.unique||l.detectedChanges.push({type:M.TABLE_COLUMN_PROPS_CHANGED,msg:`Column properties changed (${e.cn})`,cn:a.column_name,id:r.id,column:a})}for(const e of r.columns)[m.UITypes.LinkToAnotherRecord,m.UITypes.Links,m.UITypes.Rollup,m.UITypes.Lookup,m.UITypes.Formula,m.UITypes.QrCode,m.UITypes.Barcode].includes(e.uidt)?(0,m.isLinksOrLTAR)(e.uidt)&&Y.push(e):l.detectedChanges.push({type:M.TABLE_COLUMN_REMOVE,msg:`Column removed(${e.column_name})`,cn:e.column_name,id:r.id,column:e,colId:e.id})}for(const e of H)$.push({table_name:e.table_name,meta:e.meta,source_id:i.id,type:m.ModelTypes.TABLE,detectedChanges:[{type:M.TABLE_REMOVE,msg:"Table removed",tn:e.table_name,id:e.id,model:e}]});for(const a of Y){const s=await a.getColOptions(e),r=await s.getParentColumn(e),l=await s.getChildColumn(e),c=await r.getModel(e),d=await l.getModel(e);if(s.type===m.RelationTypes.MANY_TO_MANY){const u=await s.getMMModel(e),p=B.find((e=>e.tn===c.table_name)),m=B.find((e=>e.tn===u.table_name));if(!p){$.find((e=>e.table_name===d.table_name)).detectedChanges.push({type:M.TABLE_VIRTUAL_M2M_REMOVE,msg:`Many to many removed(${p.tn} removed)`,colId:a.id,column:a});continue}if(!m){$.find((e=>e.table_name===d.table_name)).detectedChanges.push({type:M.TABLE_VIRTUAL_M2M_REMOVE,msg:`Many to many removed(${u.table_name} removed)`,colId:a.id,column:a});continue}const _=F[d.table_name]=F[d.table_name]||(null===(b=null===(y=await t.columnList({tn:d.table_name,schema:null===(g=i.getConfig())||void 0===g?void 0:g.schema}))||void 0===y?void 0:y.data)||void 0===b?void 0:b.list),f=F[c.table_name]=F[c.table_name]||(null===(T=null===(v=await t.columnList({tn:c.table_name,schema:null===(w=i.getConfig())||void 0===w?void 0:w.schema}))||void 0===v?void 0:v.data)||void 0===T?void 0:T.list),h=F[m.tn]=F[m.tn]||(null===(O=null===(S=await t.columnList({tn:m.tn,schema:null===(k=i.getConfig())||void 0===k?void 0:k.schema}))||void 0===S?void 0:S.data)||void 0===O?void 0:O.list),I=await s.getMMChildColumn(e),C=await s.getMMParentColumn(e);(f.every((e=>e.cn!==r.column_name))||_.every((e=>e.cn!==l.column_name))||h.every((e=>e.cn!==I.column_name))||h.every((e=>e.cn!==C.column_name)))&&$.find((e=>e.table_name===d.table_name)).detectedChanges.push({type:M.TABLE_VIRTUAL_M2M_REMOVE,msg:"Many to many removed(One of the relation column removed)",colId:a.id,column:a});continue}if(a.colOptions.virtual)continue;const u=W.find((e=>e.cn===l.column_name&&e.tn===d.table_name&&e.rcn===r.column_name&&e.rtn===c.table_name));u?(u.found=u.found||{},u.found[s.type]||(u.found[s.type]=!0)):$.find((e=>{var t;return e.table_name===(s.type===m.RelationTypes.BELONGS_TO||s.type===m.RelationTypes.ONE_TO_ONE&&(null===(t=a.meta)||void 0===t?void 0:t.bt)?d.table_name:c.table_name)})).detectedChanges.push({type:M.TABLE_RELATION_REMOVE,tn:d.table_name,rtn:c.table_name,cn:l.column_name,rcn:r.column_name,msg:"Relation removed",colId:a.id,column:a})}for(const e of W)(null===(I=null==e?void 0:e.found)||void 0===I?void 0:I[m.RelationTypes.BELONGS_TO])||(null===(C=null==e?void 0:e.found)||void 0===C?void 0:C[m.RelationTypes.ONE_TO_ONE])||null===(E=$.find((t=>t.table_name===e.tn)))||void 0===E||E.detectedChanges.push({type:M.TABLE_RELATION_ADD,tn:e.tn,rtn:e.rtn,cn:e.cn,rcn:e.rcn,msg:"New relation added",relationType:m.RelationTypes.BELONGS_TO,cstn:e.cstn}),(null===(x=null==e?void 0:e.found)||void 0===x?void 0:x[m.RelationTypes.HAS_MANY])||(null===(L=null==e?void 0:e.found)||void 0===L?void 0:L[m.RelationTypes.ONE_TO_ONE])||null===(R=$.find((t=>t.table_name===e.rtn)))||void 0===R||R.detectedChanges.push({type:M.TABLE_RELATION_ADD,tn:e.tn,rtn:e.rtn,cn:e.cn,rcn:e.rcn,msg:"New relation added",relationType:m.RelationTypes.HAS_MANY});const z=null===(j=null===(D=null===(A=await t.viewList({schema:null===(N=i.getConfig())||void 0===N?void 0:N.schema}))||void 0===A?void 0:A.data)||void 0===D?void 0:D.list)||void 0===j?void 0:j.map((e=>(e.type="view",e.tn=e.view_name,e))).filter((e=>{var t;return!(null==a?void 0:a.prefix)||!i.is_meta||(null===(t=e.tn)||void 0===t?void 0:t.startsWith(null==a?void 0:a.prefix))}));for(const a of z){const s=G.findIndex((e=>e.table_name===a.tn));if(-1===s){$.push({table_name:a.tn,source_id:i.id,type:m.ModelTypes.VIEW,detectedChanges:[{type:M.VIEW_NEW,msg:"New view"}]});continue}const r=G[s];G.splice(s,1);const l={title:r.title,meta:r.meta,table_name:a.tn,source_id:i.id,type:m.ModelTypes.VIEW,detectedChanges:[]};$.push(l),F[a.tn]=null===(U=null===(q=await t.columnList({tn:a.tn,schema:null===(P=i.getConfig())||void 0===P?void 0:P.schema}))||void 0===q?void 0:q.data)||void 0===U?void 0:U.list,await r.getColumns(e);for(const e of F[a.tn]){const t=r.columns.findIndex((t=>t.column_name===e.cn));if(-1===t){l.detectedChanges.push({type:M.VIEW_COLUMN_ADD,msg:`New column(${e.cn})`,cn:e.cn,id:r.id});continue}const[a]=r.columns.splice(t,1);a.dt!==e.dt&&l.detectedChanges.push({type:M.TABLE_COLUMN_TYPE_CHANGE,msg:`Column type changed(${e.cn})`,cn:a.column_name,id:r.id,column:a})}for(const e of r.columns)[m.UITypes.LinkToAnotherRecord,m.UITypes.Rollup,m.UITypes.Lookup,m.UITypes.Formula,m.UITypes.Links,m.UITypes.QrCode,m.UITypes.Barcode].includes(e.uidt)||l.detectedChanges.push({type:M.VIEW_COLUMN_REMOVE,msg:`Column removed(${e.column_name})`,cn:e.column_name,id:r.id,column:e,colId:e.id})}for(const e of G)$.push({table_name:e.table_name,meta:e.meta,source_id:i.id,type:m.ModelTypes.TABLE,detectedChanges:[{type:M.VIEW_REMOVE,msg:"Table removed",tn:e.table_name,id:e.id,model:e}]});return $}async metaDiff(e,t){const a=await S.Base.getWithInfo(e,t.baseId);let i=[];for(const t of a.sources)try{if(t.is_meta)continue;const s=await k.default.getSqlClient(t);i=i.concat(await this.getMetaDiff(e,s,a,t))}catch(e){console.log(e)}return i}async baseMetaDiff(e,t){const a=await S.Base.getWithInfo(e,t.baseId),i=await S.Source.get(e,t.sourceId);let s=[];const r=await k.default.getSqlClient(i);return s=await this.getMetaDiff(e,r,a,i),s}async syncBaseMeta(e,t,a,i=!1){var s,r,l,c,d,u,p,f,I,C,E,x,L,R,N,A,D,j,P;if(a.is_meta)return void(i&&v.NcError.badRequest("Cannot sync meta source"));const q=[],U=await k.default.getSqlClient(a),$=await this.getMetaDiff(e,U,t,a);for(const{table_name:i,detectedChanges:v}of $){v.sort(((e,t)=>O.indexOf(t.type)-O.indexOf(e.type)));for(const T of v)switch(T.type){case M.TABLE_NEW:{const d=null===(c=null===(l=null===(r=await U.columnList({tn:i,schema:null===(s=a.getConfig())||void 0===s?void 0:s.schema}))||void 0===r?void 0:r.data)||void 0===l?void 0:l.list)||void 0===c?void 0:c.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})));(0,w.default)(d);const u=await S.Model.insert(e,t.id,a.id,{table_name:i,title:(0,y.default)(i,a.is_meta?t.prefix:"",a),type:m.ModelTypes.TABLE});for(const t of d)await S.Column.insert(e,Object.assign(Object.assign({uidt:(0,g.default)(a,t),fk_model_id:u.id},t),{title:(0,y.getColumnNameAlias)(t.column_name,a)}))}break;case M.VIEW_NEW:{const s=null===(f=null===(p=null===(u=await U.columnList({tn:i,schema:null===(d=a.getConfig())||void 0===d?void 0:d.schema}))||void 0===u?void 0:u.data)||void 0===p?void 0:p.list)||void 0===f?void 0:f.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})));(0,w.default)(s);const r=await S.Model.insert(e,t.id,a.id,{table_name:i,title:(0,y.default)(i,t.prefix,a),type:m.ModelTypes.VIEW});for(const t of s)await S.Column.insert(e,Object.assign(Object.assign({uidt:(0,g.default)(a,t),fk_model_id:r.id},t),{title:(0,y.getColumnNameAlias)(t.column_name,a)}))}break;case M.TABLE_REMOVE:case M.VIEW_REMOVE:await T.model.delete(e);break;case M.TABLE_COLUMN_ADD:case M.VIEW_COLUMN_ADD:{const t=(null===(x=null===(E=null===(C=await U.columnList({tn:i,schema:null===(I=a.getConfig())||void 0===I?void 0:I.schema}))||void 0===C?void 0:C.data)||void 0===E?void 0:E.list)||void 0===x?void 0:x.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===T.cn));t.uidt=(0,g.default)(a,t),t.title=(0,y.getColumnNameAlias)(t.cn,a),await S.Column.insert(e,Object.assign({fk_model_id:T.id},t))}break;case M.TABLE_COLUMN_TYPE_CHANGE:case M.VIEW_COLUMN_TYPE_CHANGE:{const t=(null===(A=null===(N=null===(R=await U.columnList({tn:i,schema:null===(L=a.getConfig())||void 0===L?void 0:L.schema}))||void 0===R?void 0:R.data)||void 0===N?void 0:N.list)||void 0===A?void 0:A.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===T.cn)),s=h.default.create({client:a.type},{});t.uidt=s.getUIDataType(t),t.title=T.column.title,await S.Column.update(e,T.column.id,t)}break;case M.TABLE_COLUMN_PROPS_CHANGED:{const t=(null===(P=null===(j=null===(D=await U.columnList({tn:i}))||void 0===D?void 0:D.data)||void 0===j?void 0:j.list)||void 0===P?void 0:P.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===T.cn));if(!t)break;const{pk:a,ai:s,rqd:r,un:l,unique:c}=t;await S.Column.update(e,T.column.id,{pk:a,ai:s,rqd:r,un:l,unique:c})}break;case M.TABLE_COLUMN_REMOVE:case M.VIEW_COLUMN_REMOVE:case M.TABLE_RELATION_REMOVE:case M.TABLE_VIRTUAL_M2M_REMOVE:await T.column.delete(e);break;case M.TABLE_RELATION_ADD:q.push((async()=>{const t=await S.Model.getByIdOrName(e,{base_id:a.base_id,source_id:a.id,table_name:T.rtn}),i=await S.Model.getByIdOrName(e,{base_id:a.base_id,source_id:a.id,table_name:T.tn}),s=await t.getColumns(e).then((e=>e.find((e=>e.column_name===T.rcn)))),r=await i.getColumns(e).then((e=>e.find((e=>e.column_name===T.cn))));if(await S.Column.update(e,r.id,Object.assign(Object.assign({},r),{uidt:m.UITypes.ForeignKey,system:!0})),T.relationType===m.RelationTypes.BELONGS_TO){const a=(0,b.getUniqueColumnAliasName)(i.columns,`${t.title||t.table_name}`);await S.Column.insert(e,{uidt:m.UITypes.LinkToAnotherRecord,title:a,fk_model_id:i.id,fk_related_model_id:t.id,type:m.RelationTypes.BELONGS_TO,fk_parent_column_id:s.id,fk_child_column_id:r.id,virtual:!1,fk_index_name:T.cstn})}else if(T.relationType===m.RelationTypes.HAS_MANY){const a=(0,b.getUniqueColumnAliasName)(i.columns,(0,_.pluralize)(i.title||i.table_name));await S.Column.insert(e,{uidt:m.UITypes.Links,title:a,fk_model_id:t.id,fk_related_model_id:i.id,type:m.RelationTypes.HAS_MANY,fk_parent_column_id:s.id,fk_child_column_id:r.id,virtual:!1,fk_index_name:T.cstn,meta:{plural:(0,_.pluralize)(i.title),singular:(0,_.singularize)(i.title)}})}}))}}await T.default.executeOperations(q,a.type),await this.extractAndGenerateManyToManyRelations(e,await a.getModels(e))}async metaDiffSync(e,t){const a=await S.Base.getWithInfo(e,t.baseId);for(const t of a.sources)await this.syncBaseMeta(e,a,t);return this.appHooksService.emit(m.AppEvents.META_DIFF_SYNC,{base:a,req:t.req}),!0}async baseMetaDiffSync(e,t){const a=await S.Base.getWithInfo(e,t.baseId),i=await S.Source.get(e,t.sourceId);return await this.syncBaseMeta(e,a,i,!0),this.appHooksService.emit(m.AppEvents.META_DIFF_SYNC,{base:a,source:i,req:t.req}),!0}async isMMRelationExist(e,t,a,i){let s=!1;const r=await i.getColOptions(e);for(const i of await t.getColumns(e))if((0,m.isLinksOrLTAR)(i.uidt)){const t=await i.getColOptions(e);if(t&&t.type===m.RelationTypes.MANY_TO_MANY&&t.fk_mm_model_id===a.id&&t.fk_child_column_id===r.fk_parent_column_id&&t.fk_mm_child_column_id===r.fk_child_column_id){s=!0;break}}return s}async extractAndGenerateManyToManyRelations(e,t){for(const a of t){await a.getColumns(e);const t=a.columns.filter((e=>!(0,m.isVirtualCol)(e))),i=[];for(const t of a.columns)if(t.uidt==m.UITypes.LinkToAnotherRecord){const a=await t.getColOptions(e);(null==a?void 0:a.type)===m.RelationTypes.BELONGS_TO&&i.push(t)}if(2===(null==i?void 0:i.length)&&t.length<5&&2===a.primaryKeys.length){const t=await i[0].colOptions.getRelatedTable(e),s=await i[1].colOptions.getRelatedTable(e);await t.getColumns(e),await s.getColumns(e);const r=await this.isMMRelationExist(e,t,a,i[0]),l=await this.isMMRelationExist(e,s,a,i[1]);r||await S.Column.insert(e,{title:(0,b.getUniqueColumnAliasName)(t.columns,(0,_.pluralize)(s.title)),fk_model_id:t.id,fk_related_model_id:s.id,fk_mm_model_id:a.id,fk_child_column_id:i[0].colOptions.fk_parent_column_id,fk_parent_column_id:i[1].colOptions.fk_parent_column_id,fk_mm_child_column_id:i[0].colOptions.fk_child_column_id,fk_mm_parent_column_id:i[1].colOptions.fk_child_column_id,type:m.RelationTypes.MANY_TO_MANY,uidt:m.UITypes.Links,meta:{plural:(0,_.pluralize)(s.title),singular:(0,_.singularize)(s.title)}}),l||await S.Column.insert(e,{title:(0,b.getUniqueColumnAliasName)(s.columns,(0,_.pluralize)(t.title)),fk_model_id:s.id,fk_related_model_id:t.id,fk_mm_model_id:a.id,fk_child_column_id:i[1].colOptions.fk_parent_column_id,fk_parent_column_id:i[0].colOptions.fk_parent_column_id,fk_mm_child_column_id:i[1].colOptions.fk_child_column_id,fk_mm_parent_column_id:i[0].colOptions.fk_child_column_id,type:m.RelationTypes.MANY_TO_MANY,uidt:m.UITypes.Links,meta:{plural:(0,_.pluralize)(t.title),singular:(0,_.singularize)(t.title)}}),await S.Model.markAsMmTable(e,a.id,!0);for(const t of[i[0],i[1]]){const a=await t.colOptions,i=await a.getRelatedTable(e);for(const t of await i.getColumns(e)){if(!(0,m.isLinksOrLTAR)(t.uidt))continue;const i=await t.getColOptions(e);if(i&&i.type===m.RelationTypes.HAS_MANY&&(i.fk_child_column_id===a.fk_child_column_id&&i.fk_parent_column_id===a.fk_parent_column_id)){await S.Column.markAsSystemField(e,t.id);break}}}}else a.mm&&await S.Model.markAsMmTable(e,a.id,!1)}}};t.MetaDiffsService=I,t.MetaDiffsService=I=l([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(i=void 0!==f.AppHooksService&&f.AppHooksService)?i:Object])],I)},80348:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelVisibilitiesService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(43820),m=a(19684);let _=class ModelVisibilitiesService{constructor(e){this.appHooksService=e}async xcVisibilityMetaSetAll(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/VisibilityRuleReq",t.visibilityRule);const a=await m.Base.getWithInfo(e,t.baseId);a||p.NcError.baseNotFound(t.baseId);for(const a of t.visibilityRule)for(const i of Object.keys(a.disabled)){(await m.View.get(e,a.id)).base_id!==t.baseId&&p.NcError.badRequest("View does not belong to the base");const s=await m.ModelRoleVisibility.get(e,{role:i,fk_view_id:a.id});s?a.disabled[i]?s.disabled||await m.ModelRoleVisibility.update(e,a.id,i,{disabled:a.disabled[i]}):await s.delete(e):a.disabled[i]&&await m.ModelRoleVisibility.insert(e,{fk_view_id:a.id,disabled:a.disabled[i],role:i})}return this.appHooksService.emit(c.AppEvents.UI_ACL_UPDATE,{base:a,req:t.req}),!0}async xcVisibilityMetaGet(e,t){const{includeM2M:a=!0,baseId:i,models:s}=null!=t?t:{},r=["owner","creator","viewer","editor","commenter","guest"].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});let l=s||await m.Model.list(e,{base_id:i,source_id:void 0});l=a?l:l.filter((e=>!e.mm));const c=await l.reduce((async(t,a)=>{const i=await t,s=await a.getViews(e);for(const e of s)i[e.id]=Object.assign(Object.assign({ptn:a.table_name,_ptn:a.title,ptype:a.type,tn:e.title,_tn:e.title,table_meta:a.meta},e),{disabled:Object.assign({},r)});return i}),Promise.resolve({})),d=await m.ModelRoleVisibility.list(e,i);for(const e of d)c[e.fk_view_id]&&(c[e.fk_view_id].disabled[e.role]=!!e.disabled);return Object.values(c)}};t.ModelVisibilitiesService=_,t.ModelVisibilitiesService=_=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],_)},50264:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43820),m=a(99572),_=a(19684),f=a(62304),h=a(88228);let g=i=class NotificationsService{constructor(e){this.appHooks=e,this.logger=new c.Logger(i.name),this.connections=new Map,this.addConnection=(e,t)=>{this.connections.has(e)||this.connections.set(e,[]),this.connections.get(e).push(t)},this.removeConnection=async(e,t,a)=>{if(!this.connections.has(e))return;const i=this.connections.get(e),s=i.findIndex((e=>e.resId===t.resId));s>-1&&i.splice(s,1),0===i.length?(this.connections.delete(e),a&&await a()):(this.connections.set(e,i),a&&await a(!0))}}sendToConnections(e,t){const a=this.connections.get(String(e));for(const e of null!=a?a:[])e.send({status:"success",data:t});this.removeConnectionByUserId(e)}removeConnectionByUserId(e){this.connections.delete(e)}async insertNotification(e,t){await _.Notification.insert(e),h.PubSubRedis.available&&await h.PubSubRedis.publish(`notification:${e.fk_user_id}`,JSON.stringify(e,(0,f.getCircularReplacer)())),this.sendToConnections(e.fk_user_id,JSON.stringify(e,(0,f.getCircularReplacer)()))}async notificationList(e){try{const{limit:t=10,offset:a=0,is_read:i}=e,s=await _.Notification.list({fk_user_id:e.user.id,is_read:i,limit:t,offset:a,is_deleted:!1}),r=await _.Notification.count({fk_user_id:e.user.id,is_deleted:!1}),l=await _.Notification.count({fk_user_id:e.user.id,is_deleted:!1,is_read:!1});return new m.PagedResponseImpl(s,{limit:e.limit,offset:e.offset,count:r},{unreadCount:l})}catch(e){this.logger.error(e)}}async notificationUpdate(e){return _.Notification.get({id:e.notificationId,fk_user_id:e.user.id})||p.NcError.unauthorized("Unauthorized to update notification"),await _.Notification.update(e.notificationId,e.body),!0}async notificationDelete(e){_.Notification.get({id:e.notificationId,fk_user_id:e.user.id})||p.NcError.unauthorized("Unauthorized to delete notification"),await _.Notification.update(e.notificationId,{is_deleted:!0})}async markAllRead(e){var t;return(null===(t=e.user)||void 0===t?void 0:t.id)||p.NcError.badRequest("User id is required"),await _.Notification.markAllAsRead(e.user.id),!0}async hookHandler({event:e,data:t}){const{req:a}=t;switch(e){case d.AppEvents.PROJECT_INVITE:{const{base:e,user:i,invitedBy:s}=t;await this.insertNotification({fk_user_id:i.id,type:d.AppEvents.PROJECT_INVITE,body:{base:{id:e.id,title:e.title,type:e.type},user:{id:s.id,email:s.email,displayName:s.display_name}}},a)}break;case d.AppEvents.WELCOME:{const{user:e,req:a}=t;await this.insertNotification({fk_user_id:e.id,type:d.AppEvents.WELCOME,body:{}},a)}}}onModuleDestroy(){this.appHooks.removeAllListener(this.hookHandler)}onModuleInit(){this.appHooks.on(d.AppEvents.PROJECT_INVITE,(e=>this.hookHandler({event:d.AppEvents.PROJECT_INVITE,data:e}))),this.appHooks.on(d.AppEvents.WELCOME,(e=>this.hookHandler({event:d.AppEvents.WELCOME,data:e})))}};t.NotificationsService=g,t.NotificationsService=g=i=r([(0,c.Injectable)(),l("design:paramtypes",["function"==typeof(s=void 0!==u.AppHooksService&&u.AppHooksService)?s:Object])],g)},83816:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgLcenseService=void 0;const r=a(23324),l=a(12916),c=a(43468),d=s(a(76584)),u=a(19684);let p=class OrgLcenseService{async licenseGet(){const e=await u.Store.get(l.NC_LICENSE_KEY);return{key:null==e?void 0:e.value}}async licenseSet(e){return(0,c.validatePayload)("swagger.json#/components/schemas/LicenseReq",e),await u.Store.saveOrUpdate({value:e.key,key:l.NC_LICENSE_KEY}),await d.default.loadEEState(),!0}};t.OrgLcenseService=p,t.OrgLcenseService=p=i([(0,r.Injectable)()],p)},20780:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgTokensEeService=void 0;const s=a(23324),r=a(71040),l=a(99572),c=a(19684);let d=class OrgTokensEeService{async apiTokenListEE(e){let t=e.user.id;return(0,r.extractRolesObj)(e.user.roles)[r.OrgUserRoles.SUPER_ADMIN]&&(t=void 0),new l.PagedResponseImpl(await c.ApiToken.listWithCreatedBy(Object.assign(Object.assign({},e.query),{fk_user_id:t})),Object.assign(Object.assign({},e.query||{}),{count:await c.ApiToken.count({})}))}};t.OrgTokensEeService=d,t.OrgTokensEeService=d=i([(0,s.Injectable)()],d)},70935:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgTokensService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(43820),m=a(99572),_=a(19684);let f=class OrgTokensService{constructor(e){this.appHooksService=e}async apiTokenList(e){const t=e.user.id;let a=!1;return(0,c.extractRolesObj)(e.user.roles)[c.OrgUserRoles.SUPER_ADMIN]&&(a=!0),new m.PagedResponseImpl(await _.ApiToken.listWithCreatedBy(Object.assign(Object.assign({},e.query),{fk_user_id:t,includeUnmappedToken:a})),Object.assign(Object.assign({},e.query),{count:await _.ApiToken.count({includeUnmappedToken:a,fk_user_id:t})}))}async apiTokenCreate(e){var t;(0,u.validatePayload)("swagger.json#/components/schemas/ApiTokenReq",e.apiToken);const a=await _.ApiToken.insert(Object.assign(Object.assign({},e.apiToken),{fk_user_id:e.user.id}));return this.appHooksService.emit(c.AppEvents.ORG_API_TOKEN_CREATE,{tokenBody:e.apiToken,userId:null===(t=e.user)||void 0===t?void 0:t.id,req:e.req}),a}async apiTokenDelete(e){var t;const a=e.user.id,i=await _.ApiToken.get(e.tokenId);(0,c.extractRolesObj)(e.user.roles)[c.OrgUserRoles.SUPER_ADMIN]||i.fk_user_id===a||p.NcError.notFound("Token not found");const s=await _.ApiToken.delete(e.tokenId);return this.appHooksService.emit(c.AppEvents.ORG_API_TOKEN_DELETE,{tokenId:e.tokenId,userId:null===(t=e.user)||void 0===t?void 0:t.id,req:e.req}),s}};t.OrgTokensService=f,t.OrgTokensService=f=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],f)},81328:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgUsersService=void 0;const d=a(23324),u=a(71040),p=a(81104),m=c(a(33848)),_=a(52144),f=a(54024),h=a(12916),g=a(43468),y=a(43820),b=a(70220),w=a(36616),v=a(19684),T=c(a(76584)),k=a(64612);let S=class OrgUsersService{constructor(e,t){this.baseUsersService=e,this.appHooksService=t}async userList(e){return await v.User.list(e.query)}async userUpdate(e){(0,g.validatePayload)("swagger.json#/components/schemas/OrgUserReq",e.user);const t=(0,b.extractProps)(e.user,["roles"]),a=await v.User.get(e.userId);return(0,u.extractRolesObj)(a.roles)[u.OrgUserRoles.SUPER_ADMIN]&&y.NcError.badRequest("Cannot update super admin roles"),await v.User.update(e.userId,Object.assign({},t))}async userDelete(e){const t=await T.default.ncMeta.startTransaction();try{const a=await v.User.get(e.userId,t);(0,u.extractRolesObj)(a.roles)[u.OrgUserRoles.SUPER_ADMIN]&&y.NcError.badRequest("Cannot delete super admin");const i=await v.BaseUser.getProjectsIdList(e.userId,t);for(const e of i)await v.BaseUser.delete({workspace_id:e.fk_workspace_id,base_id:e.base_id},e.base_id,e.fk_user_id,t);await v.SyncSource.deleteByUserId(e.userId,t),await v.User.delete(e.userId,t),await t.commit()}catch(e){throw await t.rollback(e),e}return!0}async userAdd(e){(0,g.validatePayload)("swagger.json#/components/schemas/OrgUserReq",e.user),e.user.roles&&![u.OrgUserRoles.VIEWER,u.OrgUserRoles.CREATOR].includes(e.user.roles)&&y.NcError.badRequest("Invalid role");const t=(e.user.email||"").toLowerCase().split(/\s*,\s*/).map((e=>e.trim())),a=t.filter((e=>!m.default.isEmail(e)));if(!t.length)return y.NcError.badRequest("Invalid email address");a.length&&y.NcError.badRequest("Invalid email address : "+a.join(", "));const i=(0,p.v4)(),s=[];for(const a of t){let r=await v.User.getByEmail(a);if(r)y.NcError.badRequest("User already exist");else try{r=await v.User.insert({invite_token:i,invite_token_expires:new Date(Date.now()+864e5),email:a,roles:e.user.roles||u.OrgUserRoles.VIEWER,token_version:(0,w.randomTokenString)()});const s=await v.User.count();if(this.appHooksService.emit(u.AppEvents.ORG_USER_INVITE,{invitedBy:e.req.user,user:r,count:s,ip:e.req.clientIp,req:e.req}),1===t.length&&!await this.baseUsersService.sendInviteEmail(a,i,e.req))return{invite_token:i,email:a};this.baseUsersService.sendInviteEmail(a,i,e.req)}catch(e){if(console.log(e),1===t.length)throw e;s.push({email:a,error:e.message})}}return 1===t.length?{msg:"success"}:{invite_token:i,emails:t,error:s}}async userSettings(e){y.NcError.notImplemented()}async userInviteResend(e){const t=await v.User.get(e.userId);t||y.NcError.userNotFound(e.userId);const a=(0,p.v4)();await v.User.update(t.id,{invite_token:a,invite_token_expires:new Date(Date.now()+864e5)});return await T.default.ncMeta.metaGet2(k.RootScopes.ROOT,k.RootScopes.ROOT,k.MetaTable.PLUGIN,{category:u.PluginCategory.EMAIL,active:!0})||y.NcError.badRequest("No Email Plugin is found. Please go to App Store to configure first or copy the invitation URL to users instead."),await this.baseUsersService.sendInviteEmail(t.email,a,e.req),this.appHooksService.emit(u.AppEvents.ORG_USER_RESEND_INVITE,{invitedBy:e.req.user,user:t,ip:e.req.clientIp,req:e.req}),!0}async generateResetUrl(e){const t=await v.User.get(e.userId);t||y.NcError.userNotFound(e.userId);const a=(0,p.v4)();return await v.User.update(t.id,{email:t.email,reset_password_token:a,reset_password_expires:new Date(Date.now()+36e5),token_version:(0,w.randomTokenString)()}),{reset_password_token:a,reset_password_url:e.siteUrl+`/dashboard/#/reset/${a}`}}async appSettingsGet(){var e;let t={};try{t=JSON.parse(null===(e=await v.Store.get(h.NC_APP_SETTINGS))||void 0===e?void 0:e.value)}catch(e){}return t}async appSettingsSet(e){return await v.Store.saveOrUpdate({value:JSON.stringify(e.settings),key:h.NC_APP_SETTINGS}),!0}};t.OrgUsersService=S,t.OrgUsersService=S=r([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==f.BaseUsersService&&f.BaseUsersService)?i:Object,"function"==typeof(s=void 0!==_.AppHooksService&&_.AppHooksService)?s:Object])],S)},77060:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginsService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=l(a(23080)),_=a(19684);let f=class PluginsService{constructor(e){this.appHooksService=e}async pluginList(){return await _.Plugin.list()}async pluginTest(e){return(0,p.validatePayload)("swagger.json#/components/schemas/PluginTestReq",e.body),this.appHooksService.emit(d.AppEvents.PLUGIN_TEST,{testBody:e.body,req:e.req}),await m.default.test(e.body)}async pluginRead(e){return await _.Plugin.get(e.pluginId)}async pluginUpdate(e){(0,p.validatePayload)("swagger.json#/components/schemas/PluginReq",e.plugin);const t=await _.Plugin.update(e.pluginId,e.plugin);return this.appHooksService.emit(t.active?d.AppEvents.PLUGIN_INSTALL:d.AppEvents.PLUGIN_UNINSTALL,{plugin:t,req:e.req}),t}async isPluginActive(e){return await _.Plugin.isPluginActive(e.pluginTitle)}async webhookPluginList(){return(await _.Plugin.list()).filter((e=>["Slack","Microsoft Teams","Discord","Mattermost"].includes(e.title)))}};t.PluginsService=f,t.PluginsService=f=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],f)},40581:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasExportService=void 0;const s=a(23324);let r=class PublicDatasExportService{};t.PublicDatasExportService=r,t.PublicDatasExportService=r=i([(0,s.Injectable)()],r)},22892:function(e,t,a){"use strict";var i,s,r,l=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasService=void 0,t.sanitizeUrlPath=function(e){return e.map((e=>e.replace(/[/.?#]+/g,"_")))};const p=a(23324),m=a(71040),_=a(62304),f=a(19684),h=a(43820),g=u(a(4456)),y=a(99572),b=a(44980),w=u(a(82096)),v=a(70240),T=a(19684),k=a(892),S=a(68144),M=a(58504);let O=class PublicDatasService{constructor(e,t,a){this.datasService=e,this.jobsService=t,this.attachmentsService=a}async dataList(e,t){const{sharedViewUuid:a,password:i,query:s={}}=t,r=await f.View.getByUUID(e,a);if(r||h.NcError.viewNotFound(a),r.type!==m.ViewTypes.GRID&&r.type!==m.ViewTypes.KANBAN&&r.type!==m.ViewTypes.GALLERY&&r.type!==m.ViewTypes.MAP&&r.type!==m.ViewTypes.CALENDAR&&h.NcError.notFound("Not found"),r.password&&r.password!==i)return h.NcError.invalidSharedViewPassword();const l=await f.Model.getByIdOrName(e,{id:null==r?void 0:r.fk_model_id}),c=await f.Source.get(e,l.source_id),d=await f.Model.getBaseModelSQL(e,{id:l.id,viewId:null==r?void 0:r.id,dbDriver:await w.default.get(c),source:c}),{ast:u,dependencyFields:p}=await(0,g.default)(e,{model:l,query:{},view:r}),b=Object.assign(Object.assign({},s),p);try{b.filterArr=JSON.parse(b.filterArrJson)}catch(e){}try{b.sortArr=JSON.parse(b.sortArrJson)}catch(e){}let v=[],T=0;try{v=await(0,_.nocoExecute)(u,await d.list(b),{},b),T=await d.count(b)}catch(e){console.log(e),h.NcError.internalServerError("Please check server log for more details")}return new y.PagedResponseImpl(v,Object.assign(Object.assign({},t.query),{count:T}))}async dataAggregate(e,t){const a=await f.View.getByUUID(e,t.sharedViewUuid);if(a||h.NcError.viewNotFound(t.sharedViewUuid),a.type!==m.ViewTypes.GRID&&h.NcError.notFound("Not found"),a.password&&a.password!==t.password)return h.NcError.invalidSharedViewPassword();const i=await f.Model.getByIdOrName(e,{id:null==a?void 0:a.fk_model_id}),s=await f.Source.get(e,i.source_id),r=await f.Model.getBaseModelSQL(e,{id:i.id,viewId:null==a?void 0:a.id,dbDriver:await w.default.get(s),source:s}),l=Object.assign({},t.query);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}try{l.aggregation=JSON.parse(l.aggregation)}catch(e){}return await r.aggregate(l,a)}async groupedDataList(e,t){const a=await f.View.getByUUID(e,t.sharedViewUuid);if(a||h.NcError.viewNotFound(t.sharedViewUuid),a.type!==m.ViewTypes.GRID&&a.type!==m.ViewTypes.KANBAN&&a.type!==m.ViewTypes.GALLERY&&h.NcError.notFound("Not found"),a.password&&a.password!==t.password)return h.NcError.invalidSharedViewPassword();const i=await f.Model.getByIdOrName(e,{id:null==a?void 0:a.fk_model_id});return await this.getGroupedDataList(e,{model:i,view:a,query:t.query,groupColumnId:t.groupColumnId})}async getGroupedDataList(e,t){const{model:a,view:i,query:s={},groupColumnId:r}=t,l=await f.Source.get(e,t.model.source_id),c=await f.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await w.default.get(l),source:l}),{ast:d}=await(0,g.default)(e,{model:a,query:t.query,view:i}),u=Object.assign({},s);try{u.filterArr=JSON.parse(u.filterArrJson)}catch(e){}try{u.sortArr=JSON.parse(u.sortArrJson)}catch(e){}try{u.options=JSON.parse(u.optionsArrJson)}catch(e){}let p=[];try{const e=await c.groupedList(Object.assign(Object.assign({},u),{groupColumnId:r}));p=await(0,_.nocoExecute)({key:1,value:d},e,{},u);const t=await c.groupedListCount(Object.assign(Object.assign({},u),{groupColumnId:r}));p=p.map((e=>{var a,i;const r=null!==(i=null===(a=t.find((t=>t.key===e.key)))||void 0===a?void 0:a.count)&&void 0!==i?i:0;return e.value=new y.PagedResponseImpl(e.value,Object.assign(Object.assign({},s),{count:r})),e}))}catch(e){console.log(e),h.NcError.internalServerError("Please check server log for more details")}return p}async dataGroupBy(e,t){const a=await f.View.getByUUID(e,t.sharedViewUuid);if(a||h.NcError.viewNotFound(t.sharedViewUuid),a.type!==m.ViewTypes.GRID&&h.NcError.notFound("Not found"),a.password&&a.password!==t.password)return h.NcError.invalidSharedViewPassword();const i=await f.Model.getByIdOrName(e,{id:null==a?void 0:a.fk_model_id});return await this.getDataGroupBy(e,{model:i,view:a,query:t.query})}async getDataGroupBy(e,t){try{const{model:a,view:i,query:s={}}=t,r=await f.Source.get(e,a.source_id),l=await f.Model.getBaseModelSQL(e,{id:a.id,viewId:null==i?void 0:i.id,dbDriver:await w.default.get(r),source:r}),c=Object.assign({},s);try{c.filterArr=JSON.parse(c.filterArrJson)}catch(e){}try{c.sortArr=JSON.parse(c.sortArrJson)}catch(e){}const d=await l.groupBy(c),u=await l.groupByCount(c);return new y.PagedResponseImpl(d,Object.assign(Object.assign({},s),{count:u}))}catch(e){console.log(e),h.NcError.internalServerError("Please check server log for more details")}}async dataInsert(e,t){const a=await f.View.getByUUID(e,t.sharedViewUuid);if(a||h.NcError.viewNotFound(t.sharedViewUuid),a.type!==m.ViewTypes.FORM&&h.NcError.notFound(),a.password&&a.password!==t.password)return h.NcError.invalidSharedViewPassword();const i=await f.Model.getByIdOrName(e,{id:null==a?void 0:a.fk_model_id}),s=await f.Source.get(e,i.source_id);(null==s?void 0:s.is_data_readonly)&&h.NcError.sourceDataReadOnly(s.alias);const r=await f.Model.getBaseModelSQL(e,{id:i.id,viewId:null==a?void 0:a.id,dbDriver:await w.default.get(s),source:s});await a.getViewWithInfo(e),await a.getColumns(e),await a.getModelWithInfo(e),await a.model.getColumns(e);const l=a.model.columns=a.columns.filter((e=>e.show)).reduce(((e,t)=>(e[a.model.columnsById[t.fk_column_id].title]=new f.Column(Object.assign(Object.assign({},t),a.model.columnsById[t.fk_column_id])),e)),{});let c=null==t?void 0:t.body;"string"==typeof c&&(c=JSON.parse(c));const d=Object.entries(c).reduce(((e,[t,a])=>(t in l&&(e[t]=a),e)),{}),u={};for(const e of t.files||[]){const t=Buffer.from((null==e?void 0:e.fieldname)||"","binary").toString("utf-8").replace(/^_|\[\d*]$/g,"");t in l&&l[t].uidt===m.UITypes.Attachment&&(u[t]=u[t]||[],u[t].push(...await this.attachmentsService.upload({files:[e]})))}const p=[];for(const[e,t]of Object.entries(d))l[e].uidt===m.UITypes.Attachment&&Array.isArray(t)&&t.forEach(((t,a)=>{(null==t?void 0:t.url)&&!(null==t?void 0:t.file)&&p.push(Object.assign(Object.assign({},t),{fieldName:e,uploadIndex:a}))}));for(const e of p)u[e.fieldName]=u[e.fieldName]||[],u[e.fieldName].unshift(...await this.attachmentsService.uploadViaURL({urls:[e.url]}));for(const[e,t]of Object.entries(u))d[e]=JSON.stringify(t);return await r.nestedInsert(d,null)}async relDataList(e,t){var a;const i=await f.View.getByUUID(e,t.sharedViewUuid);i||h.NcError.viewNotFound(t.sharedViewUuid),i.type!==m.ViewTypes.FORM&&i.type!==m.ViewTypes.GALLERY&&h.NcError.notFound("Not found"),i.password&&i.password!==t.password&&h.NcError.invalidSharedViewPassword();const s=await f.Column.get(e,{colId:t.columnId}),r=await i.getModel(e);await r.getColumns(e);const l=await s.getColOptions(e),c=await l.getRelatedTable(e),d=await f.Source.get(e,c.source_id),u=await f.Model.getBaseModelSQL(e,{id:c.id,viewId:l.fk_target_view_id,dbDriver:await w.default.get(d),source:d}),{ast:p,dependencyFields:b}=await(0,g.default)(e,{query:t.query,model:c,extractOnlyPrimaries:!0});let k=[],S=0;try{const i=await(0,v.replaceDynamicFieldWithValue)(t.rowData||{},null,r.columns,u.readByPk)(((null===(a=s.meta)||void 0===a?void 0:a.enableConditions)?await T.Filter.rootFilterListByLink(e,{columnId:t.columnId}):[])||[]);k=k=await(0,_.nocoExecute)(p,await u.list(Object.assign(Object.assign({},b),{customConditions:i})),{},b),S=await u.count(Object.assign(Object.assign({},b),{customConditions:i}))}catch(e){console.log(e),h.NcError.internalServerError("Please check server log for more details")}return new y.PagedResponseImpl(k,Object.assign(Object.assign({},t.query),{count:S}))}async publicMmList(e,t){var a;const i=await f.View.getByUUID(e,t.sharedViewUuid);i||h.NcError.viewNotFound(t.sharedViewUuid),i.type!==m.ViewTypes.GRID&&i.type!==m.ViewTypes.KANBAN&&i.type!==m.ViewTypes.GALLERY&&i.type!==m.ViewTypes.CALENDAR&&h.NcError.notFound("Not found"),i.password&&i.password!==t.password&&h.NcError.invalidSharedViewPassword();(await(0,b.getColumnByIdOrName)(e,t.columnId,await i.getModel(e))).fk_model_id!==i.fk_model_id&&h.NcError.badRequest("Column doesn't belongs to the model");const s=await f.Source.get(e,i.source_id),r=await f.Model.getBaseModelSQL(e,{id:i.fk_model_id,viewId:null==i?void 0:i.id,dbDriver:await w.default.get(s),source:s}),l="List",c={[l]:1},d=null===(a=await(0,_.nocoExecute)(c,{[l]:async e=>await r.mmList({colId:t.columnId,parentId:t.rowId},e)},{},{nested:{[l]:t.query}}))||void 0===a?void 0:a[l],u=await r.mmListCount({colId:t.columnId,parentId:t.rowId},t.query);return new y.PagedResponseImpl(d,Object.assign(Object.assign({},t.query),{count:u}))}async publicHmList(e,t){var a;const i=await f.View.getByUUID(e,t.sharedViewUuid);i||h.NcError.viewNotFound(t.sharedViewUuid),i.type!==m.ViewTypes.GRID&&i.type!==m.ViewTypes.KANBAN&&i.type!==m.ViewTypes.GALLERY&&i.type!==m.ViewTypes.CALENDAR&&h.NcError.notFound("Not found"),i.password&&i.password!==t.password&&h.NcError.invalidSharedViewPassword();(await(0,b.getColumnByIdOrName)(e,t.columnId,await i.getModel(e))).fk_model_id!==i.fk_model_id&&h.NcError.badRequest("Column doesn't belongs to the model");const s=await f.Source.get(e,i.source_id),r=await f.Model.getBaseModelSQL(e,{id:i.fk_model_id,viewId:null==i?void 0:i.id,dbDriver:await w.default.get(s),source:s}),l="List",c={[l]:1},d=null===(a=await(0,_.nocoExecute)(c,{[l]:async e=>await r.hmList({colId:t.columnId,id:t.rowId},e)},{},{nested:{[l]:t.query}}))||void 0===a?void 0:a[l],u=await r.hmListCount({colId:t.columnId,id:t.rowId},t.query);return new y.PagedResponseImpl(d,Object.assign(Object.assign({},t.query),{count:u}))}async dataRead(e,t){const{sharedViewUuid:a,rowId:i,password:s,query:r={}}=t,l=await f.View.getByUUID(e,a);if(l||h.NcError.viewNotFound(a),l.type!==m.ViewTypes.GRID&&l.type!==m.ViewTypes.KANBAN&&l.type!==m.ViewTypes.GALLERY&&l.type!==m.ViewTypes.MAP&&l.type!==m.ViewTypes.CALENDAR&&h.NcError.notFound("Not found"),l.password&&l.password!==s)return h.NcError.invalidSharedViewPassword();const c=await f.Model.getByIdOrName(e,{id:null==l?void 0:l.fk_model_id}),d=await f.Source.get(e,c.source_id),u=await f.Model.getBaseModelSQL(e,{id:c.id,viewId:null==l?void 0:l.id,dbDriver:await w.default.get(d),source:d}),p=await u.readByPk(i,!1,r);return p||h.NcError.recordNotFound(t.rowId),p}async bulkDataList(e,t){const a=await f.View.getByUUID(e,t.sharedViewUuid);if(a||h.NcError.viewNotFound(t.sharedViewUuid),a.type!==m.ViewTypes.GRID&&h.NcError.notFound("Not found"),a.password&&a.password!==t.password)return h.NcError.invalidSharedViewPassword();const i=await f.Model.getByIdOrName(e,{id:null==a?void 0:a.fk_model_id}),s=Object.assign({},t.query);let r=t.body;try{r=JSON.parse(r)}catch(e){}try{s.sortArr=JSON.parse(s.sortArrJson)}catch(e){}try{s.filterArr=JSON.parse(s.filterArrJson)}catch(e){}(null==r?void 0:r.length)||h.NcError.badRequest("Invalid bulkFilterList");return await r.reduce((async(t,s)=>{const r=await t,l=await this.datasService.dataList(e,{query:Object.assign({},s),model:i,view:a});return r[s.alias]=l,r}),Promise.resolve({}))}async bulkGroupBy(e,t){const a=await f.View.getByUUID(e,t.sharedViewUuid);if(a||h.NcError.viewNotFound(t.sharedViewUuid),a.password&&a.password!==t.password)return h.NcError.invalidSharedViewPassword();const i=await f.Model.getByIdOrName(e,{id:null==a?void 0:a.fk_model_id}),s=await f.Source.get(e,i.source_id),r=await f.Model.getBaseModelSQL(e,{id:i.id,viewId:null==a?void 0:a.id,dbDriver:await w.default.get(s),source:s}),l=Object.assign({},t.query);let c=t.body;try{c=JSON.parse(c)}catch(e){}try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}(null==c?void 0:c.length)||h.NcError.badRequest("Invalid bulkFilterList");const[d,u]=await Promise.all([r.bulkGroupBy(l,c,a),r.bulkGroupByCount(l,c,a)]);return c.forEach((e=>{let t=d[e.alias];"string"==typeof t&&(t=JSON.parse(t));let a=u[e.alias];"string"==typeof a&&(a=JSON.parse(a)),d[e.alias]=new y.PagedResponseImpl(t,Object.assign(Object.assign({},e),{count:null==a?void 0:a.count}))})),d}};t.PublicDatasService=O,t.PublicDatasService=O=l([(0,p.Injectable)(),d(1,(0,p.Inject)((0,p.forwardRef)((()=>"JobsService")))),c("design:paramtypes",["function"==typeof(i=void 0!==S.DatasService&&S.DatasService)?i:Object,"function"==typeof(s=void 0!==k.IJobsService&&k.IJobsService)?s:Object,"function"==typeof(r=void 0!==M.AttachmentsService&&M.AttachmentsService)?r:Object])],O)},10064:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicMetasService=void 0;const s=a(23324),r=a(71040),l=a(19684),c=a(43820);let d=class PublicMetasService{async viewMetaGet(e,t){const a=await l.View.getByUUID(e,t.sharedViewUuid);a||c.NcError.viewNotFound(t.sharedViewUuid),a.password&&a.password!==t.password&&c.NcError.invalidSharedViewPassword(),await a.getFilters(e),await a.getSorts(e),await a.getViewWithInfo(e),await a.getColumns(e),await a.getModelWithInfo(e),await a.model.getColumns(e);const i=await l.Source.get(e,a.model.source_id);a.client=i.type,a.password=void 0;const s=[];if(a.type===r.ViewTypes.CALENDAR)for(const e of a.view.calendar_range)e.fk_from_column_id?s.push(e.fk_from_column_id):e.fk_to_column_id&&s.push(e.fk_to_column_id);a.model.columns=a.columns.filter((e=>{const t=a.model.columnsById[e.fk_column_id];return!!s.includes(e.fk_column_id)||!!t&&(e instanceof l.GridViewColumn&&e.group_by||e.show||t.rqd&&!t.cdf&&!t.ai||t.pk||a.model.columns.some((t=>(0,r.isLinksOrLTAR)(t.uidt)&&t.colOptions.type===r.RelationTypes.BELONGS_TO&&a.columns.some((e=>e.fk_column_id===t.id&&e.show))&&t.colOptions.fk_child_column_id===e.fk_column_id)))})).map((e=>new l.Column(Object.assign(Object.assign({},e),a.model.columnsById[e.fk_column_id]))));const d={};for(const t of a.model.columns)await this.extractRelatedMetas(e,{col:t,relatedMetas:d});if(a.relatedMetas=d,a.model.columns.some((e=>e.uidt===r.UITypes.User||(0,r.isCreatedOrLastModifiedByCol)(e)))){const t=await l.BaseUser.getUsersList(e,{base_id:a.model.base_id});a.users=t.map((e=>({id:e.id,display_name:e.display_name,email:e.email})))}return a}async extractRelatedMetas(e,{col:t,relatedMetas:a={}}){(0,r.isLinksOrLTAR)(t.uidt)?await this.extractLTARRelatedMetas(e,{ltarColOption:await t.getColOptions(e),relatedMetas:a}):r.UITypes.Lookup===t.uidt&&await this.extractLookupRelatedMetas(e,{lookupColOption:await t.getColOptions(e),relatedMetas:a})}async extractLTARRelatedMetas(e,{ltarColOption:t,relatedMetas:a={}}){a[t.fk_related_model_id]=await l.Model.getWithInfo(e,{id:t.fk_related_model_id}),"mm"===t.type&&(a[t.fk_mm_model_id]=await l.Model.getWithInfo(e,{id:t.fk_mm_model_id}))}async extractLookupRelatedMetas(e,{lookupColOption:t,relatedMetas:a={}}){const i=await l.Column.get(e,{colId:t.fk_relation_column_id}),s=await l.Column.get(e,{colId:t.fk_lookup_column_id});a[i.fk_model_id]||(a[i.fk_model_id]=await l.Model.getWithInfo(e,{id:i.fk_model_id})),a[s.fk_model_id]||(a[s.fk_model_id]=await l.Model.getWithInfo(e,{id:s.fk_model_id})),await this.extractRelatedMetas(e,{col:s,relatedMetas:a})}async publicSharedBaseGet(e,t){const a=await l.Base.getByUuid(e,t.sharedBaseUuid);return a||c.NcError.baseNotFound(t.sharedBaseUuid),{base_id:a.id}}};t.PublicMetasService=d,t.PublicMetasService=d=i([(0,s.Injectable)()],d)},96844:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SharedBasesService=void 0;const c=a(23324),d=a(71040),u=a(81104),p=a(16184),m=a(52144),_=a(43468),f=a(43820),h=a(19684),g="/nc";let y=class SharedBasesService{constructor(e,t){this.appHooksService=e,this.configService=t}async createSharedBaseLink(e,t){(0,_.validatePayload)("swagger.json#/components/schemas/SharedBaseReq",t);const a=await h.Base.get(e,t.baseId);let i=null==t?void 0:t.roles;(!i||"editor"!==i&&"viewer"!==i)&&(i="viewer"),"editor"===i&&"true"===process.env.NC_CLOUD&&f.NcError.badRequest("Only viewer role is supported"),a||f.NcError.baseNotFound(t.baseId);const s={uuid:(0,u.v4)(),password:null==t?void 0:t.password,roles:i};return await h.Base.update(e,a.id,s),s.url=this.getUrl({base:a,siteUrl:t.siteUrl}),delete s.password,this.appHooksService.emit(d.AppEvents.SHARED_BASE_GENERATE_LINK,{link:s.url,base:a,req:t.req}),s}async updateSharedBaseLink(e,t){(0,_.validatePayload)("swagger.json#/components/schemas/SharedBaseReq",t);const a=await h.Base.get(e,t.baseId);let i=t.roles;(!i||"editor"!==i&&"viewer"!==i)&&(i="viewer"),a||f.NcError.baseNotFound(t.baseId),"editor"===i&&"true"===process.env.NC_CLOUD&&f.NcError.badRequest("Only viewer role is supported");const s={uuid:a.uuid||(0,u.v4)(),password:t.password,roles:i};return await h.Base.update(e,a.id,s),s.url=this.getUrl({base:a,siteUrl:t.siteUrl}),delete s.password,this.appHooksService.emit(d.AppEvents.SHARED_BASE_GENERATE_LINK,{link:s.url,base:a,req:t.req}),s}getUrl({base:e,siteUrl:t}){let a=t;const i=process.env.NC_BASE_HOST_NAME,s=this.configService.get("dashboardPath",{infer:!0});return i&&(a=`https://${e.fk_workspace_id}.${i}${s}`),`${a}${g}#/base/${e.uuid}`}async disableSharedBaseLink(e,t){const a=await h.Base.get(e,t.baseId);a||f.NcError.baseNotFound(t.baseId);return await h.Base.update(e,a.id,{uuid:null}),this.appHooksService.emit(d.AppEvents.SHARED_BASE_DELETE_LINK,{base:a,req:t.req}),{uuid:null}}async getSharedBaseLink(e,t){const a=await h.Base.get(e,t.baseId);a||f.NcError.baseNotFound(t.baseId);const i={uuid:a.uuid,roles:a.roles};return i.uuid&&(i.url=`${t.siteUrl}${g}#/base/${i.shared_base_id}`),i}};t.SharedBasesService=y,t.SharedBasesService=y=r([(0,c.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==m.AppHooksService&&m.AppHooksService)?i:Object,"function"==typeof(s=void 0!==p.ConfigService&&p.ConfigService)?s:Object])],y)},50976:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SortsService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(43820),m=a(19684);let _=class SortsService{constructor(e){this.appHooksService=e}async sortGet(e,t){return m.Sort.get(e,t.sortId)}async sortDelete(e,t){const a=await m.Sort.get(e,t.sortId);return a||p.NcError.badRequest("Sort not found"),await m.Sort.delete(e,t.sortId),this.appHooksService.emit(c.AppEvents.SORT_CREATE,{sort:a,req:t.req}),!0}async sortUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/SortReq",t.sort);const a=await m.Sort.get(e,t.sortId);a||p.NcError.badRequest("Sort not found");const i=await m.Sort.update(e,t.sortId,t.sort);return this.appHooksService.emit(c.AppEvents.SORT_UPDATE,{sort:a,req:t.req}),i}async sortCreate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/SortReq",t.sort);const a=await m.Sort.insert(e,Object.assign(Object.assign({},t.sort),{fk_view_id:t.viewId}));return this.appHooksService.emit(c.AppEvents.SORT_CREATE,{sort:a,req:t.req}),a}async sortList(e,t){return m.Sort.list(e,{viewId:t.viewId})}};t.SortsService=_,t.SortsService=_=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],_)},92900:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourcesService=void 0;const c=a(23324),d=a(71040),u=a(52144),p=a(43468),m=a(79383),_=a(47660),f=a(19684),h=a(43820),g=l(a(76584));let y=class SourcesService{constructor(e){this.appHooksService=e}async baseGetWithConfig(e,t){const a=await f.Source.get(e,t.sourceId);return a||h.NcError.sourceNotFound(t.sourceId),a.config=await a.getSourceConfig(),a}async baseUpdate(e,t){var a;(0,p.validatePayload)("swagger.json#/components/schemas/BaseReq",t.source);const i=t.source,s=await f.Source.update(e,t.sourceId,Object.assign(Object.assign({},i),{type:null===(a=i.config)||void 0===a?void 0:a.client,id:t.sourceId}));return s.config=void 0,this.appHooksService.emit(d.AppEvents.BASE_UPDATE,{source:s,req:t.req}),s}async baseList(e,t){return await f.Source.list(e,{baseId:t.baseId})}async baseDelete(e,t,a=g.default.ncMeta){try{const i=await f.Source.get(e,t.sourceId,!0,a);await i.delete(e,a),this.appHooksService.emit(d.AppEvents.BASE_DELETE,{source:i,req:t.req})}catch(e){h.NcError.badRequest(e)}return!0}async baseSoftDelete(e,t){try{const a=await f.Source.get(e,t.sourceId);await a.softDelete(e)}catch(e){h.NcError.badRequest(e)}return!0}async baseCreate(e,t){var a,i,s,r,l,c,u,g,y;(0,p.validatePayload)("swagger.json#/components/schemas/BaseReq",t.source);const b=t.source,w=await f.Base.getWithInfo(e,t.baseId);let v;if(null===(a=t.logger)||void 0===a||a.call(t,"Creating the source"),b.fk_integration_id){const t=await f.Integration.get(e,b.fk_integration_id);t||h.NcError.integrationNotFound(b.fk_integration_id),t.type===d.IntegrationsType.Database&&t.sub_type||h.NcError.badRequest("Integration type should be Database"),b.type=t.sub_type}else{const a=await f.Integration.createIntegration({title:b.alias,type:d.IntegrationsType.Database,sub_type:null===(i=b.config)||void 0===i?void 0:i.client,is_private:!!(null===(s=t.req.user)||void 0===s?void 0:s.id),config:b.config,workspaceId:e.workspace_id,created_by:null===(r=t.req.user)||void 0===r?void 0:r.id});b.fk_integration_id=a.id,b.config={client:null===(l=b.config)||void 0===l?void 0:l.client},b.type=null===(c=b.config)||void 0===c?void 0:c.client}(null===(g=null===(u=b.config)||void 0===u?void 0:u.connection)||void 0===g?void 0:g.ssl)&&(b.config.connection.ssl=(0,d.validateAndExtractSSLProp)(b.config.connection,b.config.sslUse,b.config.client));const T=await f.Source.createBase(e,Object.assign(Object.assign({},b),{baseId:w.id}));try{await(0,_.syncBaseMigration)(w,T),null===(y=t.logger)||void 0===y||y.call(t,"Populating meta");const a=await(0,p.populateMeta)(e,T,w,t.logger);await(0,m.populateRollupColumnAndHideLTAR)(e,T,w),this.appHooksService.emit(d.AppEvents.APIS_CREATED,{info:a,req:t.req}),T.config=void 0,this.appHooksService.emit(d.AppEvents.BASE_CREATE,{source:T,req:t.req})}catch(e){v=e}return{source:T,error:v}}};t.SourcesService=y,t.SourcesService=y=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],y)},73560:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43820),p=a(99572),m=a(19684);let _=class SyncService{constructor(e){this.appHooksService=e}async syncSourceList(e,t){return new p.PagedResponseImpl(await m.SyncSource.list(e,t.baseId,t.sourceId))}async syncCreate(e,t){const a=await m.Base.getWithInfo(e,t.baseId),i=await m.SyncSource.insert(e,Object.assign(Object.assign({},t.syncPayload),{fk_user_id:t.userId,source_id:t.sourceId?t.sourceId:a.sources[0].id,base_id:t.baseId}));return this.appHooksService.emit(c.AppEvents.SYNC_SOURCE_CREATE,{syncSource:i,req:t.req}),i}async syncDelete(e,t){const a=await m.SyncSource.get(e,t.syncId);a||u.NcError.badRequest("Sync source not found");const i=await m.SyncSource.delete(e,t.syncId);return this.appHooksService.emit(c.AppEvents.SYNC_SOURCE_DELETE,{syncSource:a,req:t.req}),i}async syncUpdate(e,t){const a=await m.SyncSource.get(e,t.syncId);a||u.NcError.badRequest("Sync source not found");const i=await m.SyncSource.update(e,t.syncId,t.syncPayload);return this.appHooksService.emit(c.AppEvents.SYNC_SOURCE_UPDATE,{syncSource:a,req:t.req}),i}};t.SyncService=_,t.SyncService=_=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],_)},69680:function(e,t,a){"use strict";var i,s,r,l=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&l(t,e,a);return c(t,e),t},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TablesService=void 0;const _=a(23324),f=m(a(68552)),h=a(71040),g=a(69484),y=a(74056),b=a(19684),w=a(52144),v=m(a(93260)),T=a(43820),k=m(a(66368)),S=m(a(47724)),M=u(a(57972)),O=m(a(22200)),I=m(a(76584)),C=m(a(82096)),E=a(43468),x=a(98644),L=a(64612);let R=class TablesService{constructor(e,t,a){this.metaDiffService=e,this.appHooksService=t,this.columnsService=a}async tableUpdate(e,t){var a;const i=await b.Model.get(e,t.tableId),s=await b.Base.getWithInfo(e,t.table.base_id||t.baseId),r=s.sources.find((e=>e.id===i.source_id));if(i.base_id!==s.id&&T.NcError.badRequest("Model does not belong to base"),"meta"in t.table||"description"in t.table)return await b.Model.updateMeta(e,t.tableId,t.table),!0;(null==r?void 0:r.is_schema_readonly)&&T.NcError.sourceMetaReadOnly(r.alias),t.table.table_name||T.NcError.badRequest("Missing table name `table_name` property in request body"),"databricks"===r.type&&(t.table.table_name=t.table.table_name.replace(/\s/g,"_").toLowerCase()),r.isMeta(!0)&&s.prefix&&!r.isMeta(!0,1)&&(t.table.table_name.startsWith(s.prefix)||(t.table.table_name=`${s.prefix}${t.table.table_name}`)),t.table.table_name=f.default.sanitize(t.table.table_name),/^\s+|\s+$/.test(t.table.table_name)&&T.NcError.badRequest("Leading or trailing whitespace not allowed in table names"),await b.Model.checkTitleAvailable(e,{table_name:t.table.table_name,base_id:s.id,source_id:r.id})||T.NcError.badRequest("Duplicate table name"),t.table.title||(t.table.title=(0,M.default)(t.table.table_name,s.prefix,r)),await b.Model.checkAliasAvailable(e,{title:t.table.title,base_id:s.id,source_id:r.id})||T.NcError.badRequest("Duplicate table alias");const l=await v.default.getSqlMgr(e,s);let c=255;const d=(await C.default.getSqlClient(r)).knex.clientType();return"mysql2"===d||"mysql"===d?c=64:"pg"===d?c=63:"mssql"===d&&(c=128),t.table.table_name.length>c&&T.NcError.badRequest(`Table name exceeds ${c} characters`),await l.sqlOpPlus(r,"tableRename",Object.assign(Object.assign({},t.table),{tn:t.table.table_name,tn_old:i.table_name,schema:null===(a=r.getConfig())||void 0===a?void 0:a.schema})),await b.Model.updateAliasAndTableName(e,t.tableId,t.table.title,t.table.table_name),this.appHooksService.emit(h.AppEvents.TABLE_UPDATE,{table:i,user:t.user,req:t.req}),!0}reorderTable(e,t){return b.Model.updateOrder(e,t.tableId,t.order)}async tableDelete(e,t){var a,i,s,r,l;const c=await b.Model.getByIdOrName(e,{id:t.tableId});if(await c.getColumns(e),c.mm){const t=await c.getColumns(e),l=await Promise.all(t.filter((e=>(0,h.isLinksOrLTAR)(e))).map((e=>e.colOptions.getRelatedTable()))),d=await Promise.all(l.map((t=>t.getColumns(e).then((e=>e.find((e=>(0,h.isLinksOrLTAR)(e)&&e.colOptions.type===h.RelationTypes.MANY_TO_MANY&&e.colOptions.fk_mm_model_id===c.id)))))));T.NcError.badRequest(`This is a many to many table for ${null===(a=l[0])||void 0===a?void 0:a.title} (${null===(i=d[0])||void 0===i?void 0:i.title}) & ${null===(s=l[1])||void 0===s?void 0:s.title} (${null===(r=d[1])||void 0===r?void 0:r.title}). You can disable "Show M2M tables" in base settings to avoid seeing this.`)}else{const t=await I.default.ncMeta.metaList2(c.fk_workspace_id,c.base_id,L.MetaTable.COL_RELATIONS,{condition:{fk_mm_model_id:c.id}});if(t.length){const a=await b.Column.get(e,{colId:t[0].fk_column_id}),i=await b.Model.get(e,a.fk_model_id);T.NcError.tableAssociatedWithLink(c.id,{customMessage:`This is a many to many table for '${null==i?void 0:i.title}' (${null==i?void 0:i.title}), please delete the column before deleting the table.`})}}const d=await b.Base.getWithInfo(e,c.base_id),u=d.sources.find((e=>e.id===c.source_id)),p=c.columns.filter((e=>(0,h.isLinksOrLTAR)(e))),m=u.isMeta()||t.forceDeleteRelations;if((null==p?void 0:p.length)&&!m){const t=await Promise.all(p.map((async t=>t.getColOptions(e).then((t=>t.getRelatedTable(e))).then())));T.NcError.badRequest(`Table can't be deleted since Table is being referred in following tables : ${t.join(", ")}. Delete LinkToAnotherRecord columns and try again.`)}const _=await I.default.ncMeta.startTransaction();let f;try{for(const a of p)a.system&&!c.mm||await b.Column.get(e,{colId:a.id},_)&&await this.columnsService.columnDelete(e,{req:t.req,columnId:a.id,user:t.user,forceDeleteSystem:!0},_);const a=await v.default.getSqlMgr(e,d,_);c.tn=c.table_name,c.columns=c.columns.filter((e=>!(0,h.isVirtualCol)(e))),c.columns.forEach((e=>{e.cn=e.column_name})),c.type===h.ModelTypes.TABLE?await a.sqlOpPlus(u,"tableDelete",c):c.type===h.ModelTypes.VIEW&&await a.sqlOpPlus(u,"viewDelete",Object.assign(Object.assign({},c),{view_name:c.table_name})),this.appHooksService.emit(h.AppEvents.TABLE_DELETE,{table:c,user:t.user,ip:null===(l=t.req)||void 0===l?void 0:l.clientIp,req:t.req}),f=await c.delete(e,_),await _.commit()}catch(e){throw await _.rollback(),e}return f}async getTableWithAccessibleViews(e,t){const a=await b.Model.getWithInfo(e,{id:t.tableId});a||T.NcError.tableNotFound(t.tableId);const i=await this.xcVisibilityMetaGet(e,a.base_id,[a]);return a.views=i.filter((e=>{var a;return Object.keys(null===(a=t.user)||void 0===a?void 0:a.roles).some((a=>{var i;return(null===(i=t.user)||void 0===i?void 0:i.roles[a])&&!e.disabled[a]}))})),a}async xcVisibilityMetaGet(e,t,a=null,i=!0){const s=["owner","creator","viewer","editor","commenter","guest"].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});let r=a||await b.Model.list(e,{base_id:t,source_id:void 0});r=i?r:r.filter((e=>!e.mm));const l=await r.reduce((async(t,a)=>{const i=await t,r=await a.getViews(e);for(const e of r)i[e.id]=Object.assign(Object.assign({ptn:a.table_name,_ptn:a.title,ptype:a.type,tn:e.title,_tn:e.title,table_meta:a.meta},e),{disabled:Object.assign({},s)});return i}),Promise.resolve({})),c=await b.ModelRoleVisibility.list(e,t);for(const e of c)l[e.fk_view_id]&&(l[e.fk_view_id].disabled[e.role]=!!e.disabled);return Object.values(l)}async getAccessibleTables(e,t){const a=(await this.xcVisibilityMetaGet(e,t.baseId)).reduce(((e,a)=>(e[a.fk_model_id]=e[a.fk_model_id]||0,Object.values(h.ProjectRoles).some((e=>t.roles[e]&&!a.disabled[e]))&&e[a.fk_model_id]++,e)),{}),i=(await b.Model.list(e,{base_id:t.baseId,source_id:t.sourceId})).filter((e=>a[e.id]));return t.includeM2M?i:i.filter((e=>!e.mm))}async tableCreate(e,t){var a,i,s,r,l,c,d;t.table.columns&&t.table.columns.forEach((e=>{!e.title&&e.column_name&&(e.title=e.column_name)})),!t.table.title&&t.table.table_name&&(t.table.title=t.table.table_name),(0,E.validatePayload)("swagger.json#/components/schemas/TableReq",t.table);const u=Object.assign({},t.table),p=await b.Base.getWithInfo(e,t.baseId);let m=p.sources[0];t.sourceId&&(m=p.sources.find((e=>e.id===t.sourceId)));for(const e of[h.UITypes.CreatedTime,h.UITypes.LastModifiedTime,h.UITypes.CreatedBy,h.UITypes.LastModifiedBy]){const t=u.columns.find((t=>t.uidt===e));let a,i;switch(e){case h.UITypes.CreatedTime:a="created_at",i="CreatedAt";break;case h.UITypes.LastModifiedTime:a="updated_at",i="UpdatedAt";break;case h.UITypes.CreatedBy:a="created_by",i="nc_created_by";break;case h.UITypes.LastModifiedBy:a="updated_by",i="nc_updated_by"}const s=(0,x.getUniqueColumnName)(u.columns,a),r=(0,x.getUniqueColumnAliasName)(u.columns,i);t&&t.system?(u.columns.some((a=>a.uidt!==e&&a.column_name===t.column_name))&&Object.assign(t,{column_name:s,cn:s}),u.columns.some((a=>a.uidt!==e&&a.title===t.title))&&Object.assign(t,{title:r})):u.columns.push(Object.assign(Object.assign({},await(0,k.default)({uidt:e},m)),{column_name:s,cn:s,title:r,system:!0}))}u.title||T.NcError.badRequest("Missing table `title` property in request body"),u.table_name||(u.table_name=u.title),await b.Model.checkAliasAvailable(e,{title:u.title,base_id:p.id,source_id:m.id})||T.NcError.badRequest("Duplicate table alias"),"databricks"===m.type&&(u.table_name=u.table_name.replace(/\s/g,"_").toLowerCase()),m.is_meta&&p.prefix&&(u.table_name.startsWith(p.prefix)||(u.table_name=`${p.prefix}_${u.table_name}`)),u.table_name=f.default.sanitize(u.table_name),/^\s+|\s+$/.test(u.table_name)&&T.NcError.badRequest("Leading or trailing whitespace not allowed in table names"),await b.Model.checkTitleAvailable(e,{table_name:u.table_name,base_id:p.id,source_id:m.id})||T.NcError.badRequest("Duplicate table name"),u.title||(u.title=(0,M.default)(u.table_name,p.prefix,m));const _=await v.default.getSqlMgr(e,p);let g=255;const y=(await C.default.getSqlClient(m)).knex.clientType();"mysql2"===y||"mysql"===y?g=64:"pg"===y?g=63:"mssql"===y&&(g=128),u.table_name.length>g&&T.NcError.badRequest(`Table name exceeds ${g} characters`);const w=b.Column.getMaxColumnNameLength(y),I={};(0,O.default)(t.table.columns);for(const e of t.table.columns){if(!(0,h.isVirtualCol)(e)||(0,h.isCreatedOrLastModifiedTimeCol)(e)&&e.system||(0,h.isCreatedOrLastModifiedByCol)(e)&&e.system){const t=b.Column.getMaxColumnNameLength(y);if(!e.column_name&&e.title&&(e.column_name=e.title),e.column_name=(0,E.sanitizeColumnName)(e.column_name.slice(0,t-5),m.type),I[e.column_name]){let t=1,a=`${e.column_name}_${t++}`;for(;I[a];)a=`${e.column_name}_${t++}`;e.column_name=a}I[e.column_name]=1}e.column_name.length>w&&(e.column_name=e.column_name.slice(0,w)),e.title&&e.title.length>255&&T.NcError.badRequest(`Column title ${e.title} exceeds 255 characters`)}let L;u.columns=await Promise.all(null===(a=t.table.columns)||void 0===a?void 0:a.filter((e=>!(0,h.isCreatedOrLastModifiedTimeCol)(e)||!(0,h.isCreatedOrLastModifiedByCol)(e)||e.system)).map((async e=>Object.assign(Object.assign({},await(0,k.default)(e,m)),{cn:e.column_name,column_name:e.column_name})))),await _.sqlOpPlus(m,"tableCreate",Object.assign(Object.assign({},u),{tn:u.table_name})),m.isMeta()||(L=null===(r=null===(s=await _.sqlOpPlus(m,"columnList",{tn:u.table_name,schema:null===(i=m.getConfig())||void 0===i?void 0:i.schema}))||void 0===s?void 0:s.data)||void 0===r?void 0:r.list);const R=await b.Model.list(e,{base_id:p.id,source_id:m.id}),N=await b.Model.insert(e,p.id,m.id,Object.assign(Object.assign({},u),{columns:u.columns.map(((e,t)=>{const a=null==L?void 0:L.find((t=>e.cn===t.cn));return Object.assign(Object.assign(Object.assign(Object.assign({},e),{uidt:e.uidt||(0,S.default)(m,a||e)}),a||{}),{title:e.title||(0,M.getColumnNameAlias)(e.cn,m),column_name:(null==a?void 0:a.cn)||e.cn||e.column_name,order:t+1})})),order:+(null!==(c=null===(l=null==R?void 0:R.pop())||void 0===l?void 0:l.order)&&void 0!==c?c:0)+1}));return this.appHooksService.emit(h.AppEvents.TABLE_CREATE,{table:N,user:t.user,ip:null===(d=t.req)||void 0===d?void 0:d.clientIp,req:t.req}),N}};t.TablesService=R,t.TablesService=R=d([(0,_.Injectable)(),p("design:paramtypes",["function"==typeof(i=void 0!==g.MetaDiffsService&&g.MetaDiffsService)?i:Object,"function"==typeof(s=void 0!==w.AppHooksService&&w.AppHooksService)?s:Object,"function"==typeof(r=void 0!==y.ColumnsService&&y.ColumnsService)?r:Object])],R)},87424:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryService=void 0;const l=a(23324),c=a(62304);let d=class TelemetryService{constructor(){this.defaultPayload={package_id:c.packageInfo.version}}sendEvent(e){var{evt_type:t}=e,a=r(e,["evt_type"]);"$pageview"===t?c.T.page(Object.assign(Object.assign({},a),{event:t})):c.T.event(Object.assign(Object.assign({},a),{event:t}))}};t.TelemetryService=d,t.TelemetryService=d=i([(0,l.Injectable)(),s("design:paramtypes",[])],d)},57512:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.genJwt=function(e,t){return d.sign(Object.assign(Object.assign({},e.extra||{}),{email:e.email,id:e.id,roles:e.roles,token_version:e.token_version}),t.auth.jwt.secret,Object.assign({expiresIn:"10h"},t.auth.jwt.options))},t.randomTokenString=function(){return c.default.randomBytes(40).toString("hex")},t.setTokenCookie=function(e,t){const a={httpOnly:!0,expires:new Date(Date.now()+6048e5),domain:process.env.NC_BASE_HOST_NAME||void 0};e.cookie("refresh_token",t,a)};const c=l(a(87968)),d=r(a(82480))},50628:function(e,t,a){"use strict";var i,s,r,l=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&l(t,e,a);return c(t,e),t},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersService=void 0;const _=a(50970),f=a(23324),h=a(71040),g=a(81104),y=m(a(26360)),b=u(a(58016)),w=m(a(31920)),v=a(62304),T=a(57512),k=a(12916),S=a(52144),M=a(43468),O=a(49804),I=a(64612),C=m(a(76584)),E=a(19684),x=a(36616),L=m(a(23080)),R=a(43820),N=a(40668),A=a(70220);let D=class UsersService{constructor(e,t,a){this.metaService=e,this.appHooksService=t,this.basesService=a}validateEmailPattern(e){const t=process.env.NC_AUTH_EMAIL_PATTERN;if(t){new RegExp(t).test(e)||R.NcError.forbidden("Not allowed to signup/signin with this email")}}async findOne(e){const t=e.toLowerCase();return await this.metaService.metaGet(I.RootScopes.ROOT,I.RootScopes.ROOT,I.MetaTable.USERS,{email:t})}async insert(e){var t;return this.metaService.metaInsert2(I.RootScopes.ROOT,I.RootScopes.ROOT,I.MetaTable.USERS,Object.assign(Object.assign({},e),{email:null===(t=e.email)||void 0===t?void 0:t.toLowerCase()}))}async profileUpdate({id:e,params:t}){const a=(0,A.extractProps)(t,["display_name","avatar"]);return await E.User.update(e,a)}async registerNewUserIfAllowed({email:e,salt:t,password:a,email_verification_token:i,req:s}){var r;this.validateEmailPattern(e);let l=h.OrgUserRoles.CREATOR;const c=await E.User.isFirst();if(c&&"true"!==process.env.NC_CLOUD)l=`${h.OrgUserRoles.CREATOR},${h.OrgUserRoles.SUPER_ADMIN}`,v.T.emit("evt",{evt_type:"base:invite",count:1});else{let e={};try{e=JSON.parse(null===(r=await E.Store.get(k.NC_APP_SETTINGS))||void 0===r?void 0:r.value)}catch(e){}(null==e?void 0:e.invite_only_signup)?R.NcError.badRequest("Not allowed to signup, contact super admin."):l=h.OrgUserRoles.VIEWER}const d=(0,x.randomTokenString)(),u=await E.User.insert({email:e,salt:t,password:a,email_verification_token:i,roles:l,token_version:d});return c&&"true"!==process.env.NC_CLOUD&&(u.createdProject=await this.createDefaultProject(u,s)),u}async passwordChange(e){var t;(0,M.validatePayload)("swagger.json#/components/schemas/PasswordChangeReq",e.body);const{currentPassword:a,newPassword:i}=e.body;if(!a||!i)return R.NcError.badRequest("Missing new/old password");const{valid:s,error:r}=(0,h.validatePassword)(i);s||R.NcError.badRequest(`Password : ${r}`);const l=await E.User.getByEmail(e.user.email);if(await(0,_.promisify)(w.default.hash)(a,l.salt)!==l.password)return R.NcError.badRequest("Current password is wrong");const c=await(0,_.promisify)(w.default.genSalt)(10),d=await(0,_.promisify)(w.default.hash)(i,c);return await E.User.update(l.id,{salt:c,password:d,email:l.email,token_version:(0,x.randomTokenString)()}),await E.UserRefreshToken.deleteAllUserToken(l.id),this.appHooksService.emit(h.AppEvents.USER_PASSWORD_CHANGE,{user:l,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp,req:e.req}),!0}async passwordForgot(e){var t;(0,M.validatePayload)("swagger.json#/components/schemas/PasswordForgotReq",e.body);const i=e.body.email;i||R.NcError.badRequest("Please enter your email address.");const s=i.toLowerCase(),r=await E.User.getByEmail(s);if(!r)return R.NcError.badRequest("Your email has not been registered.");{const i=(0,g.v4)();await E.User.update(r.id,{email:r.email,reset_password_token:i,reset_password_expires:new Date(Date.now()+36e5),token_version:(0,x.randomTokenString)()});try{const t=(await Promise.resolve().then((()=>u(a(88336))))).default;await L.default.emailAdapter().then((a=>a.mailSend({to:r.email,subject:"Password Reset Link",text:`Visit following link to update your password : ${e.siteUrl}/auth/password/reset/${i}.`,html:b.render(t,{resetLink:e.siteUrl+`/auth/password/reset/${i}`})})))}catch(e){return console.log(e),R.NcError.badRequest("Email Plugin is not found. Please contact administrators to configure it in App Store first.")}this.appHooksService.emit(h.AppEvents.USER_PASSWORD_FORGOT,{user:r,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp,req:e.req})}return!0}async tokenValidate(e){const t=e.token,a=await C.default.ncMeta.metaGet(I.RootScopes.ROOT,I.RootScopes.ROOT,I.MetaTable.USERS,{reset_password_token:t});return a&&a.email||R.NcError.badRequest("Invalid reset url"),new Date(a.reset_password_expires)<new Date&&R.NcError.badRequest("Password reset url expired"),!0}async passwordReset(e){var t;(0,M.validatePayload)("swagger.json#/components/schemas/PasswordResetReq",e.body);const{token:a,body:i}=e,s=await C.default.ncMeta.metaGet(I.RootScopes.ROOT,I.RootScopes.ROOT,I.MetaTable.USERS,{reset_password_token:a});s||R.NcError.badRequest("Invalid reset url"),s.reset_password_expires<new Date&&R.NcError.badRequest("Password reset url expired"),s.provider&&"local"!==s.provider&&R.NcError.badRequest("Email registered via social account");const{valid:r,error:l}=(0,h.validatePassword)(i.password);r||R.NcError.badRequest(`Password : ${l}`);const c=await(0,_.promisify)(w.default.genSalt)(10),d=await(0,_.promisify)(w.default.hash)(i.password,c);return await E.User.update(s.id,{salt:c,password:d,email:s.email,reset_password_expires:null,reset_password_token:"",token_version:(0,x.randomTokenString)()}),this.appHooksService.emit(h.AppEvents.USER_PASSWORD_RESET,{user:s,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp,req:e.req}),!0}async emailVerification(e){const{token:t,req:a}=e,i=await C.default.ncMeta.metaGet(I.RootScopes.ROOT,I.RootScopes.ROOT,I.MetaTable.USERS,{email_verification_token:t});return i||R.NcError.badRequest("Invalid verification url"),await E.User.update(i.id,{email:i.email,email_verification_token:"",email_verified:!0}),this.appHooksService.emit(h.AppEvents.USER_EMAIL_VERIFICATION,{user:i,ip:null==a?void 0:a.clientIp,req:a}),!0}async refreshToken(e){var t,a;try{(null===(a=null===(t=e.req)||void 0===t?void 0:t.cookies)||void 0===a?void 0:a.refresh_token)||R.NcError.badRequest("Missing refresh token");const i=e.req.cookies.refresh_token,s=await E.User.getByRefreshToken(i);s||R.NcError.badRequest("Invalid refresh token");const r=(0,x.randomTokenString)();try{await E.UserRefreshToken.updateOldToken(i,r)}catch(e){console.error("Failed to update old refresh token:",e),R.NcError.internalServerError("Failed to update refresh token")}return(0,T.setTokenCookie)(e.res,r),{token:(0,T.genJwt)(s,C.default.getConfig())}}catch(e){R.NcError.badRequest(e.message)}}async signup(e){var t;(0,M.validatePayload)("swagger.json#/components/schemas/SignUpReq",e.body);const{email:i,token:s,ignore_subscribe:r}=e.req.body;let{password:l}=e.req.body;const{valid:c,error:d}=(0,h.validatePassword)(l);c||R.NcError.badRequest(`Password : ${d}`),(0,y.default)(i)||R.NcError.badRequest("Invalid email");const p=i.toLowerCase();this.validateEmailPattern(p);let m=await E.User.getByEmail(p);m&&s&&(s!==m.invite_token?R.NcError.badRequest("Invalid invite url"):m.invite_token_expires<new Date&&R.NcError.badRequest("Expired invite url, Please contact super admin to get a new invite url"));const f=await(0,_.promisify)(w.default.genSalt)(10);l=await(0,_.promisify)(w.default.hash)(l,f);const k=(0,g.v4)();let S;if(r||v.T.emit("evt_subscribe",p),m)s?await E.User.update(m.id,{salt:f,password:l,email_verification_token:k,invite_token:null,invite_token_expires:null,email:m.email}):R.NcError.badRequest("User already exist");else{const{createdProject:t}=await this.registerNewUserIfAllowed({email:p,salt:f,password:l,email_verification_token:k,req:e.req});S=t}m=await E.User.getByEmail(p);try{const t=(await Promise.resolve().then((()=>u(a(67628))))).default;await(await L.default.emailAdapter()).mailSend({to:p,subject:"Verify email",html:b.render(t,{verifyLink:e.req.ncSiteUrl+`/email/validate/${m.email_verification_token}`})})}catch(e){console.log("Warning : `mailSend` failed, Please configure emailClient configuration.")}const O=(0,x.randomTokenString)();return await E.UserRefreshToken.insert({token:O,fk_user_id:m.id}),(0,T.setTokenCookie)(e.res,O),this.appHooksService.emit(h.AppEvents.USER_SIGNUP,{user:m,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp,req:e.req}),this.appHooksService.emit(h.AppEvents.WELCOME,{user:m,req:e.req}),Object.assign(Object.assign({},await this.login(m,e.req)),{createdProject:S})}async login(e,t){return this.appHooksService.emit(h.AppEvents.USER_SIGNIN,{user:e,req:t}),{token:(0,T.genJwt)(e,C.default.getConfig())}}async signOut(e){try{this.clearCookie(e);const t=e.req.user;return(null==t?void 0:t.id)&&(await E.User.update(t.id,{token_version:(0,x.randomTokenString)()}),await E.UserRefreshToken.deleteAllUserToken(t.id)),{msg:"Signed out successfully"}}catch(e){R.NcError.badRequest(e.message)}}clearCookie(e){e.res.clearCookie("refresh_token")}async createDefaultProject(e,t){return await this.basesService.createDefaultBase({user:e,req:t})}async setRefreshToken({res:e,req:t}){var a,i;const s=null===(a=t.user)||void 0===a?void 0:a.id;if(!s)return;const r=await E.User.get(s);if(!r)return;const l=(0,x.randomTokenString)();r.token_version||(r.token_version=(0,x.randomTokenString)()),await E.User.update(r.id,{token_version:r.token_version}),await E.UserRefreshToken.insert({token:l,fk_user_id:r.id,meta:null===(i=t.user)||void 0===i?void 0:i.extra}),(0,T.setTokenCookie)(e,l)}};t.UsersService=D,t.UsersService=D=d([(0,f.Injectable)(),p("design:paramtypes",["function"==typeof(i=void 0!==O.MetaService&&O.MetaService)?i:Object,"function"==typeof(s=void 0!==S.AppHooksService&&S.AppHooksService)?s:Object,"function"==typeof(r=void 0!==N.BasesService&&N.BasesService)?r:Object])],D)},37156:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UtilsService=void 0;const d=c(a(76520)),u=a(23324),p=c(a(71178)),m=a(99072),_=a(71040),f=a(16184),h=a(1384),g=c(a(44578)),y=a(12916),b=c(a(62520)),w=a(43820),v=a(19684),T=c(a(76584)),k=a(62304),S=c(a(82096)),M=c(a(68592)),O=a(64612),I=a(19448),C=a(45408),E=a(11620),x=a(39143),L=c(a(57804)),R=a(62304),N={releaseVersion:null,lastFetched:null},A={dateStrings:!0};let D=i=class UtilsService{constructor(e){this.configService=e,this.logger=new u.Logger(i.name),this.lastSyncTime=null,this.extractResultOrNull=e=>e.map((e=>"fulfilled"===e.status?e.value:null))}async versionInfo(){if(!N.lastFetched||N.lastFetched&&N.lastFetched<Date.now()-36e5){const e=await p.default.get("https://api.github.com/repos/nocodb/nocodb/tags",{timeout:5e3}).then((e=>e.data.map((e=>e.name)).filter((e=>(0,m.validate)(e)&&!e.includes("finn")&&!e.includes("beta"))).sort(((e,t)=>(0,m.compareVersions)(t,e))))).catch((()=>null));e&&e.length>0&&(N.releaseVersion=e[0]),N.lastFetched=Date.now()}return{currentVersion:C.packageVersion,releaseVersion:N.releaseVersion}}async appHealth(){return{message:"OK",timestamp:Date.now(),uptime:d.default.uptime()}}async _axiosRequestMake(e){const{apiMeta:t}=e.body;if(null==t?void 0:t.body)try{t.body=JSON.parse(t.body)}catch(e){console.log(e)}if(null==t?void 0:t.auth)try{t.auth=JSON.parse(t.auth)}catch(e){console.log(e)}t.response={};const a={params:t.parameters?t.parameters.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=t.value),e)),{}):{},url:t.url,method:t.method||"GET",data:t.body||{},headers:t.headers?t.headers.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=t.value),e)),{}):{},responseType:t.responseType||"json",withCredentials:!0,httpAgent:(0,h.useAgent)(t.url,{stopPortScanningByUrlRedirection:!0}),httpsAgent:(0,h.useAgent)(t.url,{stopPortScanningByUrlRedirection:!0})},i=await(0,p.default)(a);return null==i?void 0:i.data}async axiosRequestMake(e){const{apiMeta:{url:t}}=e.body,a=/.*\.(xls|xlsx|xlsm|ods|ots)/,i=/.*\.(csv)/;return/(10)(\.([2]([0-5][0-5]|[01234][6-9])|[1][0-9][0-9]|[1-9][0-9]|[0-9])){3}|(172)\.(1[6-9]|2[0-9]|3[0-1])(\.(2[0-4][0-9]|25[0-5]|[1][0-9][0-9]|[1-9][0-9]|[0-9])){2}|(192)\.(168)(\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){2}|(0.0.0.0)|localhost?/g.test(t)||!i.test(t)&&!a.test(t)?{}:((i||a)&&(e.body.apiMeta.responseType="arraybuffer"),await this._axiosRequestMake({body:e.body}))}async urlToDbConfig(e){const{url:t}=e.body;try{return(0,I.jdbcToXcConfig)(t)}catch(e){return w.NcError.internalServerError("Please check server log for more details")}}async aggregatedMetaInfo(){const[e,t]=await Promise.all([v.Base.list(),T.default.ncMeta.metaCount(O.RootScopes.ROOT,O.RootScopes.ROOT,O.MetaTable.USERS)]),a={baseCount:e.length,bases:[],userCount:t,sharedBaseCount:0};return a.bases.push(...this.extractResultOrNull(await Promise.allSettled(e.map((async e=>{e.uuid&&a.sharedBaseCount++;const[t,i,s,r,l,c,d,u]=this.extractResultOrNull(await Promise.allSettled([T.default.ncMeta.metaCount(e.fk_workspace_id,e.id,O.MetaTable.MODELS,{condition:{type:"table"}}),T.default.ncMeta.metaCount(e.fk_workspace_id,e.id,O.MetaTable.MODELS,{condition:{type:"view"}}),(async()=>(await T.default.ncMeta.metaList2(e.fk_workspace_id,e.id,O.MetaTable.VIEWS)).reduce(((e,t)=>{switch(e.total++,t.type){case _.ViewTypes.GRID:e.gridCount++,t.uuid&&e.sharedGridCount++;break;case _.ViewTypes.FORM:e.formCount++,t.uuid&&e.sharedFormCount++;break;case _.ViewTypes.GALLERY:e.galleryCount++,t.uuid&&e.sharedGalleryCount++;break;case _.ViewTypes.KANBAN:e.kanbanCount++,t.uuid&&e.sharedKanbanCount++}return t.uuid&&(t.password&&e.sharedLockedCount++,e.sharedTotal++),e}),{formCount:0,gridCount:0,galleryCount:0,kanbanCount:0,total:0,sharedFormCount:0,sharedGridCount:0,sharedGalleryCount:0,sharedKanbanCount:0,sharedTotal:0,sharedLockedCount:0}))(),T.default.ncMeta.metaCount(e.fk_workspace_id,e.id,O.MetaTable.HOOKS),T.default.ncMeta.metaCount(e.fk_workspace_id,e.id,O.MetaTable.FILTER_EXP),T.default.ncMeta.metaCount(e.fk_workspace_id,e.id,O.MetaTable.SORT),e.getSources().then((async e=>this.extractResultOrNull(await Promise.allSettled(e.map((async e=>{var t,a,i;return null===(i=null===(a=(t=await S.default.getSqlClient(e)).totalRecords)||void 0===a?void 0:a.call(t))||void 0===i?void 0:i.then((e=>null==e?void 0:e.data))})))))),T.default.ncMeta.metaCount(e.fk_workspace_id,e.id,O.MetaTable.PROJECT_USERS,{condition:{base_id:e.id},aggField:"*"})]));return{tableCount:{table:t,view:i},external:!e.is_meta,viewCount:s,webhookCount:r,filterCount:l,sortCount:c,rowCount:d,userCount:u}}))))),a}async testConnection(e){return await b.default.testConnection(e.body)}async appInfo(e){var t,a,i,s,r,l,c,u;const p=!await v.User.isFirst(),m=await(0,M.default)();let _={};try{_=JSON.parse(null===(t=await v.Store.get(y.NC_APP_SETTINGS,!0))||void 0===t?void 0:t.value)}catch(e){}const f=["openid","oidc"].includes(null===(a=d.default.env.NC_SSO)||void 0===a?void 0:a.toLowerCase()),h=f?null!==(i=d.default.env.NC_OIDC_PROVIDER_NAME)&&void 0!==i?i:"OpenID Connect":null;let g;m.impacted>=5&&(g=`https://w21dqb1x.nocodb.com/#/nc/form/4d2e0e4b-df97-4c5e-ad8e-f8b8cca90330?Users=${m.impacted}&Bases=${m.projectsExt+m.projectsMeta}`);const b="saml"===(null===(s=d.default.env.NC_SSO)||void 0===s?void 0:s.toLowerCase()),w=b?null!==(r=d.default.env.NC_SSO_SAML_PROVIDER_NAME)&&void 0!==r?r:"SAML":null;return{authType:"jwt",baseHasAdmin:p,firstUser:!p,type:"rest",env:d.default.env.NODE_ENV,googleAuthEnabled:!(!d.default.env.NC_GOOGLE_CLIENT_ID||!d.default.env.NC_GOOGLE_CLIENT_SECRET),githubAuthEnabled:!(!d.default.env.NC_GITHUB_CLIENT_ID||!d.default.env.NC_GITHUB_CLIENT_SECRET),oidcAuthEnabled:f,oidcProviderName:h,oneClick:!!d.default.env.NC_ONE_CLICK,connectToExternalDB:!d.default.env.NC_CONNECT_TO_EXTERNAL_DB_DISABLED,version:C.packageVersion,defaultLimit:Math.max(Math.min(E.defaultLimitConfig.limitDefault,E.defaultLimitConfig.limitMax),E.defaultLimitConfig.limitMin),defaultGroupByLimit:E.defaultGroupByLimitConfig,timezone:A.timezone,ncMin:!!d.default.env.NC_MIN,teleEnabled:"true"!==d.default.env.NC_DISABLE_TELE,errorReportingEnabled:"true"!==d.default.env.NC_DISABLE_ERR_REPORTS,sentryDSN:"true"!==d.default.env.NC_DISABLE_ERR_REPORTS?d.default.env.NC_SENTRY_DSN:null,auditEnabled:"true"!==d.default.env.NC_DISABLE_AUDIT,ncSiteUrl:e.req.ncSiteUrl,ee:T.default.isEE(),ncAttachmentFieldSize:y.NC_ATTACHMENT_FIELD_SIZE,ncMaxAttachmentsAllowed:+(d.default.env.NC_MAX_ATTACHMENTS_ALLOWED||10),isCloud:"true"===d.default.env.NC_CLOUD,automationLogLevel:d.default.env.NC_AUTOMATION_LOG_LEVEL||"OFF",baseHostName:d.default.env.NC_BASE_HOST_NAME,disableEmailAuth:this.configService.get("auth.disableEmailAuth",{infer:!0}),feedEnabled:"true"!==d.default.env.NC_DISABLE_PRODUCT_FEED,mainSubDomain:this.configService.get("mainSubDomain",{infer:!0}),dashboardPath:this.configService.get("dashboardPath",{infer:!0}),inviteOnlySignup:_.invite_only_signup,samlProviderName:w,samlAuthEnabled:b,giftUrl:g,prodReady:(null===(u=null===(c=null===(l=T.default.getConfig())||void 0===l?void 0:l.meta)||void 0===c?void 0:c.db)||void 0===u?void 0:u.client)!==x.DriverClient.SQLITE}}async reportErrors(e){var t,a,i;for(const s of null!==(a=null===(t=e.body)||void 0===t?void 0:t.errors)&&void 0!==a?a:[])k.T.emit("evt",{evt_type:"gui:error",properties:Object.assign({message:s.message,stack:null===(i=s.stack)||void 0===i?void 0:i.split("\n").slice(0,2).join("\n")},e.body.extra||{})})}async feed(e){const{type:t="all",page:a="1",per_page:i="10"}=e.query,s=Math.min(Math.max(parseInt(i,10)||10,1),100),r=Math.max(parseInt(a,10)||1,1),l=`${O.CacheScope.PRODUCT_FEED}:${t}:${r}:${s}`,c=await L.default.get(l,"json");if(c)try{return JSON.parse(c)}catch(e){this.logger.error(null==e?void 0:e.message,e),await L.default.del(l)}let u,m=null;this.lastSyncTime&&!(0,g.default)().isAfter(this.lastSyncTime.add(3,"hours"))||(m=await k.T.payload(),this.lastSyncTime=(0,g.default)());try{u=await p.default.post("https://product-feed.nocodb.com/api/v1/social/feed",m,{params:{per_page:s,page:r,type:t}})}catch(e){return this.logger.error(null==e?void 0:e.message,e),[]}return await L.default.setExpiring(l,JSON.stringify(u.data,R.getCircularReplacer),Number.isNaN(parseInt(d.default.env.NC_ATTACHMENT_EXPIRE_SECONDS))?7200:parseInt(d.default.env.NC_ATTACHMENT_EXPIRE_SECONDS)),u.data}};t.UtilsService=D,t.UtilsService=D=i=r([(0,u.Injectable)(),l("design:paramtypes",["function"==typeof(s=void 0!==f.ConfigService&&f.ConfigService)?s:Object])],D)},38900:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewColumnsService=void 0;const c=a(23324),d=a(71040),u=l(a(92760)),p=l(a(56648)),m=l(a(52284)),_=l(a(4388)),f=l(a(95240)),h=a(52144),g=a(43468),y=a(19684),b=a(43820),w=l(a(76584));let v=class ViewColumnsService{constructor(e){this.appHooksService=e}async columnList(e,t){return await y.View.getColumns(e,t.viewId,void 0)}async columnAdd(e,t){(0,g.validatePayload)("swagger.json#/components/schemas/ViewColumnReq",t.column);const a=await y.View.insertOrUpdateColumn(e,t.viewId,t.column.fk_column_id,{order:t.column.order,show:t.column.show});return this.appHooksService.emit(d.AppEvents.VIEW_COLUMN_CREATE,{viewColumn:a,req:t.req}),a}async columnUpdate(e,t){(0,g.validatePayload)("swagger.json#/components/schemas/ViewColumnUpdateReq",t.column);const a=await y.View.updateColumn(e,t.viewId,t.columnId,t.column);return this.appHooksService.emit(d.AppEvents.VIEW_COLUMN_UPDATE,{viewColumn:t.column,req:t.req}),a}async columnsUpdate(e,t){var a;const{viewId:i}=t,s=Array.isArray(t.columns)?t.columns:null===(a=t.columns)||void 0===a?void 0:a[d.APIContext.VIEW_COLUMNS];s||b.NcError.badRequest("Invalid request - fields not found");const r=await y.View.get(e,i),l=[];const c=await w.default.ncMeta.startTransaction();r||b.NcError.notFound("View not found");try{const a=y.View.extractViewColumnsTableName(r);for(const[h,b]of Object.entries(s)){const s="object"==typeof t.columns?h:b.id,w=await c.metaGet2(e.workspace_id,e.base_id,a,{fk_view_id:i,fk_column_id:s});switch(r.type){case d.ViewTypes.GRID:(0,g.validatePayload)("swagger.json#/components/schemas/GridColumnReq",b),w?l.push(u.default.update(e,w.id,b,c)):l.push(u.default.insert(e,Object.assign(Object.assign({},b),{fk_view_id:i,fk_column_id:s}),c));break;case d.ViewTypes.GALLERY:(0,g.validatePayload)("swagger.json#/components/schemas/GalleryColumnReq",b),w?l.push(p.default.update(e,w.id,b,c)):l.push(p.default.insert(e,Object.assign(Object.assign({},b),{fk_view_id:i,fk_column_id:s}),c));break;case d.ViewTypes.KANBAN:(0,g.validatePayload)("swagger.json#/components/schemas/KanbanColumnReq",b),w?l.push(m.default.update(e,w.id,b,c)):l.push(m.default.insert(e,Object.assign(Object.assign({},b),{fk_view_id:i,fk_column_id:s}),c));break;case d.ViewTypes.MAP:(0,g.validatePayload)("swagger.json#/components/schemas/MapColumn",b),w?l.push(_.default.update(e,w.id,b,c)):l.push(_.default.insert(e,Object.assign(Object.assign({},b),{fk_view_id:i,fk_column_id:s}),c));break;case d.ViewTypes.FORM:(0,g.validatePayload)("swagger.json#/components/schemas/FormColumnReq",b),w?l.push(f.default.update(e,w.id,b,c)):l.push(f.default.insert(e,Object.assign(Object.assign({},b),{fk_view_id:i,fk_column_id:s}),c));break;case d.ViewTypes.CALENDAR:(0,g.validatePayload)("swagger.json#/components/schemas/CalendarColumnReq",b),w?l.push(y.CalendarViewColumn.update(e,w.id,b,c)):l.push(y.CalendarViewColumn.insert(e,Object.assign(Object.assign({},b),{fk_view_id:i,fk_column_id:s}),c))}}return await Promise.all(l),await c.commit(),void await y.View.clearSingleQueryCache(e,r.fk_model_id,[r])}catch(e){throw await c.rollback(),e}}async viewColumnList(e,t){return(await y.View.getColumns(e,t.viewId,void 0)).reduce(((e,t)=>(e[t.fk_column_id]=t,e)),{})}};t.ViewColumnsService=v,t.ViewColumnsService=v=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==h.AppHooksService&&h.AppHooksService)?i:Object])],v)},38040:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewsService=void 0;const l=a(23324),c=a(71040),d=a(52144),u=a(43468),p=a(43820),m=a(19684);let _=class ViewsService{constructor(e){this.appHooksService=e}async viewList(e,t){const a=await m.Model.get(e,t.tableId);a||p.NcError.tableNotFound(t.tableId);const i=await async function(e,t){const{includeM2M:a=!0,baseId:i,models:s}=null!=t?t:{},r=["owner","creator","viewer","editor","commenter","guest"].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});let l=s||await m.Model.list(e,{base_id:i,source_id:void 0});l=a?l:l.filter((e=>!e.mm));const c=await l.reduce((async(t,a)=>{const i=await t,s=await a.getViews(e);for(const e of s)i[e.id]=Object.assign(Object.assign({ptn:a.table_name,_ptn:a.title,ptype:a.type,tn:e.title,_tn:e.title,table_meta:a.meta},e),{disabled:Object.assign({},r)});return i}),Promise.resolve({})),d=await m.ModelRoleVisibility.list(e,i);for(const e of d)c[e.fk_view_id]&&(c[e.fk_view_id].disabled[e.role]=!!e.disabled);return Object.values(c)}(e,{baseId:a.base_id,models:[a]}),s=i.filter((e=>Object.values(c.ProjectRoles).some((a=>{var i,s;return(null===(s=null===(i=null==t?void 0:t.user)||void 0===i?void 0:i.base_roles)||void 0===s?void 0:s[a])&&!e.disabled[a]}))));return s}async shareView(e,t){const a=await m.View.share(e,t.viewId),i=await m.View.get(e,t.viewId);return i||p.NcError.viewNotFound(t.viewId),this.appHooksService.emit(c.AppEvents.SHARED_VIEW_CREATE,{user:t.user,view:i,req:t.req}),a}async viewUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/ViewUpdateReq",t.view);const a=await m.View.get(e,t.viewId);a||p.NcError.viewNotFound(t.viewId);const i=await m.View.update(e,t.viewId,t.view);return this.appHooksService.emit(c.AppEvents.VIEW_UPDATE,{view:Object.assign(Object.assign({},a),t.view),user:t.user,req:t.req}),i}async viewDelete(e,t){const a=await m.View.get(e,t.viewId);return a||p.NcError.viewNotFound(t.viewId),await m.View.delete(e,t.viewId),this.appHooksService.emit(c.AppEvents.VIEW_DELETE,{view:a,user:t.user,req:t.req}),!0}async shareViewUpdate(e,t){(0,u.validatePayload)("swagger.json#/components/schemas/SharedViewReq",t.sharedView);const a=await m.View.get(e,t.viewId);a||p.NcError.viewNotFound(t.viewId);const i=await m.View.update(e,t.viewId,t.sharedView);return this.appHooksService.emit(c.AppEvents.SHARED_VIEW_UPDATE,{user:t.user,view:a,req:t.req}),i}async shareViewDelete(e,t){const a=await m.View.get(e,t.viewId);return a||p.NcError.viewNotFound(t.viewId),await m.View.sharedViewDelete(e,t.viewId),this.appHooksService.emit(c.AppEvents.SHARED_VIEW_DELETE,{user:t.user,view:a,req:t.req}),!0}async showAllColumns(e,t){return await m.View.showAllColumns(e,t.viewId,t.ignoreIds||[]),!0}async hideAllColumns(e,t){return await m.View.hideAllColumns(e,t.viewId,t.ignoreIds||[]),!0}async shareViewList(e,t){return await m.View.shareViewList(e,t.tableId)}};t.ViewsService=_,t.ViewsService=_=s([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksService&&d.AppHooksService)?i:Object])],_)},1148:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenStrategy=void 0;const s=a(23324),r=a(70816),l=a(71040),c=a(17440),d=a(19684),u=a(62304);let p=class AuthTokenStrategy extends((0,r.PassportStrategy)(c.Strategy,"authtoken")){async validate(e,t){try{let a;if(e.headers["xc-token"]){const i=await d.ApiToken.getByToken(e.headers["xc-token"]);if(!i)return t({msg:"Invalid token"});if(a={is_api_token:!0},!i.fk_user_id)return a.base_roles=(0,l.extractRolesObj)(l.ProjectRoles.EDITOR),t(null,a);const s=await d.User.getWithRoles(e.context,i.fk_user_id,Object.assign({baseId:e.ncBaseId},e.ncWorkspaceId?{workspaceId:e.ncWorkspaceId}:{}));if(!s)return t({msg:"User not found"});Object.assign(a,Object.assign(Object.assign({id:s.id,email:s.email,display_name:s.display_name,roles:(0,l.extractRolesObj)(s.roles),base_roles:(0,l.extractRolesObj)(s.base_roles)},s.workspace_roles?{workspace_roles:(0,l.extractRolesObj)(s.workspace_roles)}:{}),s.org_roles?{org_roles:(0,l.extractRolesObj)(s.org_roles)}:{}))}return t(null,(0,u.sanitiseUserObj)(a))}catch(e){return t(e)}}};t.AuthTokenStrategy=p,t.AuthTokenStrategy=p=i([(0,s.Injectable)()],p)},14996:function(e,t,a){"use strict";var i=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseViewStrategy=void 0;const s=a(23324),r=a(70816),l=a(17440),c=a(71040),d=a(19684);let u=class BaseViewStrategy extends((0,r.PassportStrategy)(l.Strategy,"base-view")){async validate(e,t){try{let a;if(e.headers["xc-shared-base-id"]){const i=await d.Base.getByUuid(e.context,e.headers["xc-shared-base-id"]);if(!i||e.ncBaseId!==i.id)return t(new s.UnauthorizedException);a={roles:(0,c.extractRolesObj)(null==i?void 0:i.roles),base_roles:(0,c.extractRolesObj)(null==i?void 0:i.roles)}}t(null,a)}catch(e){t(e)}}};t.BaseViewStrategy=u,t.BaseViewStrategy=u=i([(0,s.Injectable)()],u)},20444:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BasicStrategy=void 0;const l=a(57682),c=a(23324),d=a(70816),u=a(16184);let p=class BasicStrategy extends((0,d.PassportStrategy)(l.BasicStrategy)){constructor(e){super({passReqToCallback:!0}),this.configService=e,this.validate=async(e,t,a)=>{const i=this.configService.get("basicAuth",{infer:!0});if(i.username===t&&i.password===a)return!0;throw new c.UnauthorizedException}}};t.BasicStrategy=p,t.BasicStrategy=p=s([(0,c.Injectable)(),r("design:paramtypes",["function"==typeof(i=void 0!==u.ConfigService&&u.ConfigService)?i:Object])],p)},38796:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleStrategyProvider=t.GoogleStrategy=void 0;const d=a(50970),u=a(23324),p=a(70816),m=a(2736),_=c(a(31920)),f=c(a(76584)),h=a(50628),g=a(19684),y=a(62304);let b=class GoogleStrategy extends((0,p.PassportStrategy)(m.Strategy,"google")){constructor(e,t){super(e),this.usersService=t}async validate(e,t,a,i,s){const r=i.emails[0].value;try{const t=await g.User.getByEmail(r);if(!t){const t=await(0,d.promisify)(_.default.genSalt)(10),a=await this.usersService.registerNewUserIfAllowed({email_verification_token:null,email:i.emails[0].value,password:"",salt:t,req:e});return s(null,(0,y.sanitiseUserObj)(a))}if(!e.ncBaseId)return s(null,(0,y.sanitiseUserObj)(t));g.BaseUser.get(e.context,e.ncBaseId,t.id).then((async e=>{t.roles=(null==e?void 0:e.roles)||t.roles,s(null,(0,y.sanitiseUserObj)(t))})).catch((e=>s(e)))}catch(e){return s(e)}}authorizationParams(e){const t=super.authorizationParams(e);return e.state&&(t.state=e.state),t}async authenticate(e,t){var a,i;const s=await g.Plugin.getPluginByTitle("Google");if(s&&s.input){const e=JSON.parse(s.input);process.env.NC_GOOGLE_CLIENT_ID=e.client_id,process.env.NC_GOOGLE_CLIENT_SECRET=e.client_secret}return process.env.NC_GOOGLE_CLIENT_ID&&process.env.NC_GOOGLE_CLIENT_SECRET?super.authenticate(e,Object.assign(Object.assign({},t),{clientID:null!==(a=process.env.NC_GOOGLE_CLIENT_ID)&&void 0!==a?a:"",clientSecret:null!==(i=process.env.NC_GOOGLE_CLIENT_SECRET)&&void 0!==i?i:"",callbackURL:e.ncSiteUrl+f.default.getConfig().dashboardPath,passReqToCallback:!0,scope:["profile","email"],state:e.query.state})):this.error({message:"Google client id or secret not found. Please add it in plugin settings or define env variables."})}};t.GoogleStrategy=b,t.GoogleStrategy=b=s([(0,u.Injectable)(),l(0,(0,u.Optional)()),r("design:paramtypes",[Object,"function"==typeof(i=void 0!==h.UsersService&&h.UsersService)?i:Object])],b),t.GoogleStrategyProvider={provide:b,inject:[h.UsersService],useFactory:async e=>{var t,a;const i={clientID:null!==(t=process.env.NC_GOOGLE_CLIENT_ID)&&void 0!==t?t:"dummy-id",clientSecret:null!==(a=process.env.NC_GOOGLE_CLIENT_SECRET)&&void 0!==a?a:"dummy-secret",callbackURL:"http://localhost:8080/dahsboard",passReqToCallback:!0,scope:["profile","email"]};return new b(i,e)}}},99236:function(e,t,a){"use strict";var i,s=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtStrategy=void 0;const l=a(23324),c=a(70816),d=a(65528),u=a(19684),p=a(50628);let m=class JwtStrategy extends((0,c.PassportStrategy)(d.Strategy)){constructor(e,t){super(Object.assign({expiresIn:"10h"},e)),this.userService=t}async validate(e,t){if(!(null==t?void 0:t.email)||(null==t?void 0:t.is_api_token))return t;const a=await u.User.getByEmail(null==t?void 0:t.email);if(!a.token_version||!t.token_version||a.token_version!==t.token_version)throw new Error("Token Expired. Please login again.");const i=await u.User.getWithRoles(e.context,a.id,{user:a,baseId:e.ncBaseId});return i&&Object.assign(Object.assign({},i),{isAuthorized:!0})}};t.JwtStrategy=m,t.JwtStrategy=m=s([(0,l.Injectable)(),r("design:paramtypes",[Object,"function"==typeof(i=void 0!==p.UsersService&&p.UsersService)?i:Object])],m)},97268:function(e,t,a){"use strict";var i,s,r=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(l=(r<3?s(l):r>3?s(t,a,l):s(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStrategy=void 0;const c=a(77682),d=a(70816),u=a(23324),p=a(16184),m=a(71040),_=a(93460),f=a(43820);let h=class LocalStrategy extends((0,d.PassportStrategy)(c.Strategy)){constructor(e,t){super({usernameField:"email",passwordField:"password"}),this.authService=e,this.config=t}async validate(e,t){this.config.get("auth.disableEmailAuth",{infer:!0})&&f.NcError.forbidden("Not available");const a=await this.authService.validateUser(e,t);return a||f.NcError.badRequest("Invalid credentials"),a.roles=(0,m.extractRolesObj)(a.roles),a}};t.LocalStrategy=h,t.LocalStrategy=h=r([(0,u.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==_.AuthService&&_.AuthService)?i:Object,"function"==typeof(s=void 0!==p.ConfigService&&p.ConfigService)?s:Object])],h)},48516:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},24212:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XcActionType=t.XcType=void 0},80856:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IStorageAdapterV2=t.XcWebhookNotificationPlugin=t.IWebhookNotificationAdapter=t.XcEmail=t.XcFile=t.IStorageAdapter=t.IEmailAdapter=t.XcEmailPlugin=t.XcStoragePlugin=t.XcPluginMigration=t.XcPlugin=t.XcPluginConfig=t.XcPluginHooks=void 0;const d=r(a(69636));t.IEmailAdapter=d.default,Object.defineProperty(t,"XcEmail",{enumerable:!0,get:function(){return d.XcEmail}});const u=r(a(27728));t.IStorageAdapter=u.default,Object.defineProperty(t,"XcFile",{enumerable:!0,get:function(){return u.XcFile}});const p=c(a(77084));t.IStorageAdapterV2=p.default;const m=c(a(15964));t.IWebhookNotificationAdapter=m.default;const _=c(a(11452));t.XcEmailPlugin=_.default;const f=c(a(51088));t.XcPlugin=f.default;const h=c(a(91540));t.XcPluginConfig=h.default;const g=c(a(9396));t.XcPluginHooks=g.default;const y=c(a(89612));t.XcPluginMigration=y.default;const b=c(a(83620));t.XcStoragePlugin=b.default;const w=c(a(94240));t.XcWebhookNotificationPlugin=w.default,l(a(24212),t),l(a(48516),t)},69636:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},27728:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},77084:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},15964:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},11452:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(51088));class XcEmailPlugin extends s.default{}t.default=XcEmailPlugin},51088:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(9396));class XcPlugin extends s.default{constructor(e,t){super(),this.app=e,this.config=t}}t.default=XcPlugin},91540:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9396:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class XcPluginHooks{async appStart(){}async projectStart(){}async projectStop(){}async projectDelete(){}async syncMigrations(){}}},89612:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class XcPluginMigration{}},83620:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(51088));class XcStoragePlugin extends s.default{}t.default=XcStoragePlugin},94240:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(51088));class XcStoragePlugin extends s.default{}t.default=XcStoragePlugin},50984:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(89576)),r=i(a(27216)),l=a(23324),c=parseInt(process.env.NC_EXECUTE_OPERATIONS_CONCURRENCY)||5;class NcHelp{static async executeOperations(e,t){const a=new r.default({concurrency:"oracledb"===t||"mssql"===t?1:c}),i=[];for(const t of e)a.add((async()=>{if(!i.length)try{await t()}catch(e){this.logger.error(e),i.push(e)}}));if(await a.onIdle(),i.length)throw i[0]}static enableOrDisableDebugLog(e){const t=s.default.disable().split(",").filter((e=>e.trim()));for(const[a,i]of Object.entries(e))if(i)t.includes(a)||t.push(a);else{const e=t.indexOf(a);e>-1&&t.splice(e,1)}s.default.enable(t.join(","))}}NcHelp.logger=new l.Logger("NcHelp"),t.default=NcHelp},45840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class RequestQueue{constructor(e=10){this.maxParallelRequests=e,this.queue=[],this.runningCount=0}async enqueue(e){return new Promise(((t,a)=>{const i=async()=>{this.runningCount++;try{const a=await e();t(a)}catch(e){a(e)}finally{this.runningCount--,this.processQueue()}};this.runningCount<this.maxParallelRequests?i():this.queue.push(i)}))}processQueue(){if(this.runningCount<this.maxParallelRequests&&this.queue.length>0){this.queue.shift()()}}}},22992:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(71178));t.default=class TeleBatchProcessor{constructor({flushAt:e=100,flushInterval:t=1e4}={}){this.batch=[],this.flushAt=e,this.flushInterval=t}capture(e){this.batch.push(e),this.batch.length>=this.flushAt&&this.flushBackground(),this.flushInterval&&(this.timeoutRef=setTimeout((()=>{this.flushBackground()}),this.flushInterval))}flushBackground(){this.timeoutRef&&(clearTimeout(this.timeoutRef),this.timeoutRef=null),this.flush().catch((()=>{}))}async flush(){const e=this.batch.splice(0,this.batch.length);e.length&&await s.default.post("https://telemetry.nocodb.com/api/v1/telemetry",e)}}},16736:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sourceRestrictions=void 0,t.generateReadablePermissionErr=function(e,t,a){const i=Object.keys(t).filter((e=>t[e])).map((e=>d[e])).join(", ");return`You do not have permission to ${c[e]||`perform the action "${e}"`} with the roles: ${i}.`};const i=a(71040),s={org:[i.OrgUserRoles.VIEWER,i.OrgUserRoles.CREATOR],base:[i.ProjectRoles.VIEWER,i.ProjectRoles.COMMENTER,i.ProjectRoles.EDITOR,i.ProjectRoles.CREATOR,i.ProjectRoles.OWNER]},r={org:["apiTokenList","apiTokenCreate","apiTokenDelete","baseList","baseCreate","userList","userAdd","userUpdate","userDelete","passwordChange","userInviteResend","generateResetUrl","isPluginActive","pluginList","pluginTest","pluginRead","pluginUpdate","commandPalette","testConnection","genericGPT","duplicateSharedBase","cacheGet","cacheDelete","upload","uploadViaURL","notification","integrationGet","integrationCreate","integrationDelete","integrationUpdate","integrationList"],base:["formViewGet","baseGet","tableGet","dataList","dataRead","dataExist","dataFindOne","dataGroupBy","exportCsv","exportExcel","sortList","filterList","baseInfoGet","baseUserMetaUpdate","galleryViewGet","kanbanViewGet","gridViewUpdate","formViewUpdate","calendarViewGet","groupedDataList","mmList","hmList","commentRow","baseCost","tableList","viewList","functionList","sequenceList","procedureList","columnList","triggerList","relationList","relationListAll","indexList","list","dataCount","dataAggregate","swaggerJson","commentList","commentsCount","commentDelete","commentUpdate","hideAllColumns","showAllColumns","auditListRow","auditRowUpdate","dataUpdate","dataDelete","dataInsert","viewColumnUpdate","sortCreate","sortUpdate","sortDelete","filterCreate","filterUpdate","filterDelete","filterGet","filterChildrenRead","mmExcludedList","hmExcludedList","btExcludedList","ooExcludedList","gridColumnUpdate","bulkDataInsert","bulkDataUpdate","bulkDataUpdateAll","bulkDataDelete","bulkDataDeleteAll","relationDataRemove","relationDataAdd","duplicateColumn","nestedDataList","nestedDataLink","nestedDataUnlink","nestedListCopyPasteOrDeleteAll","baseUserList","sourceCreate","baseApiTokenList","baseApiTokenCreate","baseApiTokenDelete","extensionList","extensionRead","extensionCreate","extensionUpdate","extensionDelete","jobList","org_integrationList","hookTrigger","userInvite"]},l={guest:{},[i.OrgUserRoles.SUPER_ADMIN]:"*",[i.ProjectRoles.VIEWER]:{include:{formViewGet:!0,baseGet:!0,tableGet:!0,dataList:!0,dataRead:!0,dataExist:!0,dataFindOne:!0,dataGroupBy:!0,exportCsv:!0,exportExcel:!0,sortList:!0,filterList:!0,baseInfoGet:!0,baseUserMetaUpdate:!0,galleryViewGet:!0,kanbanViewGet:!0,groupedDataList:!0,calendarViewGet:!0,mmList:!0,hmList:!0,baseCost:!0,tableList:!0,viewList:!0,functionList:!0,sequenceList:!0,procedureList:!0,columnList:!0,triggerList:!0,relationList:!0,relationListAll:!0,indexList:!0,list:!0,dataCount:!0,dataAggregate:!0,swaggerJson:!0,nestedDataList:!0,baseUserList:!0,extensionList:!0,extensionRead:!0,jobList:!0,commentList:!0,commentsCount:!0,auditListRow:!0,userInvite:!0}},[i.ProjectRoles.COMMENTER]:{include:{commentRow:!0,commentUpdate:!0,commentDelete:!0}},[i.ProjectRoles.EDITOR]:{include:{hideAllColumns:!0,showAllColumns:!0,auditRowUpdate:!0,dataUpdate:!0,dataDelete:!0,dataInsert:!0,viewColumnUpdate:!0,gridViewUpdate:!0,formViewUpdate:!0,sortCreate:!0,sortUpdate:!0,sortDelete:!0,filterCreate:!0,filterUpdate:!0,filterDelete:!0,filterGet:!0,filterChildrenRead:!0,mmExcludedList:!0,hmExcludedList:!0,btExcludedList:!0,ooExcludedList:!0,gridColumnUpdate:!0,bulkDataInsert:!0,bulkDataUpdate:!0,bulkDataUpdateAll:!0,bulkDataDelete:!0,bulkDataDeleteAll:!0,relationDataRemove:!0,relationDataAdd:!0,nestedDataLink:!0,nestedDataUnlink:!0,nestedListCopyPasteOrDeleteAll:!0,hookTrigger:!0}},[i.ProjectRoles.CREATOR]:{exclude:{baseDelete:!0}},[i.ProjectRoles.OWNER]:{exclude:{pluginList:!0,pluginTest:!0,pluginRead:!0,pluginUpdate:!0,isPluginActive:!0,createBase:!0}},[i.OrgUserRoles.VIEWER]:{include:{apiTokenList:!0,apiTokenCreate:!0,apiTokenDelete:!0,passwordChange:!0,baseList:!0,testConnection:!0,isPluginActive:!0,commandPalette:!0,notification:!0}},[i.OrgUserRoles.CREATOR]:{include:{userList:!0,userAdd:!0,userUpdate:!0,userDelete:!0,generateResetUrl:!0,userInviteResend:!0,upload:!0,uploadViaURL:!0,baseCreate:!0,duplicateSharedBase:!0,integrationGet:!0,integrationCreate:!0,integrationDelete:!0,integrationUpdate:!0,integrationList:!0}}};{const e={},t=[];Object.keys(r).forEach((a=>{if(r[a].forEach((a=>{e[a]?t.push(a):e[a]=!0})),t.length)throw new Error(`Duplicate permissions found in scope ${a}. Please remove duplicate permissions: ${t.join(", ")}`)}))}Object.values(s).forEach((e=>{const t={},a=[];if(e.forEach((e=>{const i=l[e].include||l[e].exclude||{};Object.keys(i).forEach((e=>{t[e]&&a.push(e),t[e]=!0}))})),a.length)throw new Error(`Duplicate permissions found in roles ${e.join(", ")}. Please remove duplicate permissions: ${a.join(", ")}`)})),Object.entries(l).forEach((([e,t])=>{if("*"===t)return;if("guest"===e)return;let a=null;if(Object.entries(s).forEach((([t,i])=>{i.includes(e)&&(a=t)})),!a)throw new Error(`Role ${e} does not belong to any scope, please assign it to a scope`);const i=r[a];if(!i)throw new Error(`Scope ${a} does not exist, please create it in permissionScopes`);const l=[];if(Object.keys(t.include||{}).forEach((e=>{i.includes(e)||l.push(e)})),l.length)throw new Error(`Role ${e} has permissions that do not belong to its scope ${a}. Please remove or add these permissions: ${l.join(", ")}`)})),Object.values(s).forEach((e=>{let t=0;for(const a of e)0!==t?"*"!==l[a]&&(l[a].include&&Object.assign(l[a].include,l[e[t-1]].include),t++):t++})),Object.values(s).forEach((e=>{const t=[...e].reverse();let a=0;for(const i of t)0!==a?"*"!==l[i]&&(l[i].exclude&&Object.assign(l[i].exclude,l[e[a-1]].exclude),a++):a++})),Object.values(l).forEach((e=>{if("*"!==e&&e.include&&e.exclude)throw new Error(`Role ${e} has both include and exclude permissions. Please remove one of them`)})),t.sourceRestrictions={[i.SourceRestriction.SCHEMA_READONLY]:{tableCreate:!0,tableDelete:!0},[i.SourceRestriction.DATA_READONLY]:{dataUpdate:!0,dataDelete:!0,dataInsert:!0,bulkDataInsert:!0,bulkDataUpdate:!0,bulkDataUpdateAll:!0,bulkDataDelete:!0,bulkDataDeleteAll:!0,relationDataRemove:!0,relationDataAdd:!0,nestedDataListCopyPasteOrDeleteAll:!0,nestedDataUnlink:!0,nestedDataLink:!0}},t.default=l;const c={orgUserAdd:"add users to the organization",orgUserRemove:"remove users from the organization",orgUserRoleUpdate:"update user roles in the organization",orgUpdate:"update organization details",orgDomainList:"view organization domains",orgDomainAdd:"add a new domain to the organization",orgDomainVerify:"verify a domain in the organization",orgDomainUpdate:"update domain details in the organization",orgDomainDelete:"remove a domain from the organization",orgSsoClientCreate:"create a new SSO client",orgSsoClientUpdate:"update SSO client details",orgSsoClientDelete:"delete an SSO client",orgWorkspaceUpdate:"update workspace details",orgWorkspaceAdd:"add a new workspace",orgGet:"view organization details",orgWorkspaceList:"view list of workspaces in the organization",orgUserList:"view list of users in the organization",orgBaseList:"view list of bases in the organization",orgSsoClientList:"view list of SSO clients in the organization",ssoClientList:"view list of SSO clients",ssoClientCreate:"create a new SSO client",ssoClientUpdate:"update SSO client details",ssoClientDelete:"delete an SSO client",ssoClientGet:"view SSO client details",ssoClientTest:"test an SSO client",apiTokenList:"view list of API tokens",apiTokenCreate:"create a new API token",apiTokenDelete:"delete an API token",passwordChange:"change your password",workspaceList:"view list of workspaces",workspaceCreate:"create a new workspace",isPluginActive:"check if a plugin is active",pluginList:"view list of plugins",pluginTest:"test a plugin",pluginRead:"read plugin configuration",pluginUpdate:"update plugin configuration",commandPalette:"access the command palette",testConnection:"test connection to a service",genericGPT:"use generic GPT functionality",upload:"upload files",uploadViaURL:"upload files via URL",notification:"send notifications",integrationCreate:"create a new integration",integrationDelete:"delete an integration",integrationUpdate:"update integration details",integrationList:"view list of integrations",formViewGet:"view forms",baseGet:"view base details",tableGet:"view table details",dataList:"view data",dataRead:"read data",dataExist:"check if data exists",dataFindOne:"find a single data record",dataGroupBy:"group data by a specific field",exportCsv:"export data to CSV",exportExcel:"export data to Excel",sortList:"view list of sorts",filterList:"view list of filters",baseInfoGet:"view base information",baseUserMetaUpdate:"update user metadata for the base",galleryViewGet:"view gallery",kanbanViewGet:"view Kanban board",calendarViewGet:"view calendar",gridViewUpdate:"update grid view",formViewUpdate:"update form view",groupedDataList:"view grouped data",mmList:"view many-to-many relationships",hmList:"view hierarchical relationships",commentRow:"comment on a row",baseList:"view list of bases",baseCost:"view base cost",tableList:"view list of tables",viewList:"view list of views",functionList:"view list of functions",sequenceList:"view list of sequences",procedureList:"view list of procedures",columnList:"view list of columns",triggerList:"view list of triggers",relationList:"view list of relations",relationListAll:"view all relations",indexList:"view list of indexes",list:"view list of items",dataCount:"view data count",dataAggregate:"view data aggregates",swaggerJson:"view Swagger JSON",commentList:"view list of comments",commentsCount:"view comment count",commentDelete:"delete comments",commentUpdate:"update comments",hideAllColumns:"hide all columns",showAllColumns:"show all columns",auditListRow:"view audit log for a row",auditRowUpdate:"update audit log for a row",dataUpdate:"update data",dataDelete:"delete data",dataInsert:"insert new data",viewColumnUpdate:"update view columns",sortCreate:"create a new sort",sortUpdate:"update an existing sort",sortDelete:"delete a sort",filterCreate:"create a new filter",filterUpdate:"update an existing filter",filterDelete:"delete a filter",filterGet:"view filter details",filterChildrenRead:"view child filters",mmExcludedList:"view excluded many-to-many relationships",hmExcludedList:"view excluded hierarchical relationships",btExcludedList:"view excluded relationships",ooExcludedList:"view excluded one-to-one relationships",gridColumnUpdate:"update grid columns",bulkDataInsert:"bulk insert data",bulkDataUpdate:"bulk update data",bulkDataUpdateAll:"bulk update all data",bulkDataDelete:"bulk delete data",bulkDataDeleteAll:"bulk delete all data",relationDataRemove:"remove related data",relationDataAdd:"add related data",baseUserList:"view list of users in the base",baseApiTokenList:"view list of base API tokens",baseApiTokenCreate:"create a new base API token",baseApiTokenDelete:"delete a base API token",createBase:"create a new base",baseDelete:"delete a base",sourceCreate:"create a new source",pageGet:"view page details",pageList:"view list of pages",pageSearch:"search pages",pageParents:"view parent pages",pageCreate:"create a new page",pageUpdate:"update a page",pageDelete:"delete a page",pageGpt:"use GPT to assist with pages",docsMagicCreatePages:"use Docs Magic to create pages",pagePaginate:"paginate pages",pageDirectoryImport:"import a page directory",layoutGet:"view layout details",layoutList:"view list of layouts",layoutCreate:"create a new layout",widgetsList:"view list of widgets",widgetGet:"view widget details",widgetCreate:"create a new widget",widgetUpdate:"update a widget",widgetDelete:"delete a widget",widgetFilterList:"view list of widget filters",widgetFilterCreate:"create a new widget filter",userInvite:"invite a user",jobList:"view list of jobs",hookTrigger:"trigger a webhook"},d={[i.ProjectRoles.VIEWER]:"Viewer",[i.ProjectRoles.COMMENTER]:"Commenter",[i.ProjectRoles.EDITOR]:"Editor",[i.ProjectRoles.CREATOR]:"Creator",[i.ProjectRoles.OWNER]:"Owner"}},37308:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCircularReplacer=void 0;t.getCircularReplacer=()=>{const e=new WeakSet;return(t,a)=>{if("object"==typeof a&&null!==a){if(e.has(a))return;e.add(a)}return a}}},40444:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.populatePluginsForCloud=void 0;const s=i(a(63252)),r=i(a(8024)),l=a(64612),c=i(a(76584));t.populatePluginsForCloud=async({ncMeta:e=c.default.ncMeta})=>{if(!(process.env.NC_CLOUD_S3_ACCESS_KEY&&process.env.NC_CLOUD_S3_ACCESS_SECRET&&process.env.NC_CLOUD_S3_BUCKET_NAME&&process.env.NC_CLOUD_S3_REGION&&process.env.NC_CLOUD_S3_ACL))throw new Error("S3 env variables not found");const t=await e.metaGet2(null,null,l.MetaTable.PLUGIN,{title:s.default.title});if(!t)throw new Error("S3 plugin not found");const a=t.input?JSON.parse(t.input):{},i={access_key:process.env.NC_CLOUD_S3_ACCESS_KEY,access_secret:process.env.NC_CLOUD_S3_ACCESS_SECRET,bucket:process.env.NC_CLOUD_S3_BUCKET_NAME,region:process.env.NC_CLOUD_S3_REGION,acl:process.env.NC_CLOUD_S3_ACL};Object.keys(i).some((e=>a[e]!==i[e]))&&await e.metaUpdate(null,null,l.MetaTable.PLUGIN,{input:JSON.stringify(i),active:!0},t.id);const d=await e.metaGet2(null,null,l.MetaTable.PLUGIN,{title:r.default.title});if(!d)throw new Error("SES plugin not found");const u=d.input?JSON.parse(d.input):{},p={access_key:process.env.NC_CLOUD_SES_ACCESS_KEY,access_secret:process.env.NC_CLOUD_SES_ACCESS_SECRET,region:process.env.NC_CLOUD_SES_REGION,from:process.env.NC_CLOUD_SES_FROM};Object.keys(p).some((e=>u[e]!==p[e]))&&await e.metaUpdate(null,null,l.MetaTable.PLUGIN,{input:JSON.stringify(p),active:!0},d.id)}},82096:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(23324),r=a(39143),l=i(a(71068)),c=a(25244),d=i(a(76584));class NcConnectionMgrv2{static async destroyAll(){for(const e in this.connectionRefs)for(const t in this.connectionRefs[e])await this.connectionRefs[e][t].destroy()}static async deleteAwait(e){var t,a,i,s,r;if(null===(a=null===(t=this.connectionRefs)||void 0===t?void 0:t[e.base_id])||void 0===a?void 0:a[e.id])try{const t=null===(s=null===(i=this.connectionRefs)||void 0===i?void 0:i[e.base_id])||void 0===s?void 0:s[e.id];await t.destroy(),null===(r=this.connectionRefs)||void 0===r||delete r[e.base_id][e.id]}catch(e){this.logger.error({error:e,details:"Error deleting connection ref"})}}static async deleteConnectionRef(e){let t=!1;for(const a in this.connectionRefs)try{this.connectionRefs[a][e]&&(await this.connectionRefs[a][e].destroy(),delete this.connectionRefs[a][e],t=!0)}catch(e){this.logger.error({error:e,details:"Error deleting connection ref"})}return t}static async get(e){var t,a,i,s,l;if(e.isMeta())return d.default.ncMeta.knex;if(null===(a=null===(t=this.connectionRefs)||void 0===t?void 0:t[e.base_id])||void 0===a?void 0:a[e.id])return null===(s=null===(i=this.connectionRefs)||void 0===i?void 0:i[e.base_id])||void 0===s?void 0:s[e.id];this.connectionRefs[e.base_id]=(null===(l=this.connectionRefs)||void 0===l?void 0:l[e.base_id])||{};const u=await e.getConnectionConfig();return this.connectionRefs[e.base_id][e.id]=(0,c.XKnex)(Object.assign(Object.assign(Object.assign({},r.defaultConnectionOptions),u),{connection:Object.assign(Object.assign(Object.assign({},r.defaultConnectionConfig),u.connection),{typeCast(e,t){const a=t();if(a&&a instanceof Buffer){const t=[...a].map((e=>("00"+e.toString(16)).slice(-2))).join("");return"BIT"==e.type?parseInt(t,16):t}return"NEWDECIMAL"==e.type?a&&parseFloat(a):a}})})),this.connectionRefs[e.base_id][e.id]}static async getSqlClient(e,t=null){const a=t||await this.get(e);return l.default.create(Object.assign({knex:a},await e.getConnectionConfig()))}static async getDataConfig(){var e,t;return null===(t=null===(e=d.default.getConfig())||void 0===e?void 0:e.meta)||void 0===t?void 0:t.db}}NcConnectionMgrv2.logger=new s.Logger("NcConnectionMgrv2"),NcConnectionMgrv2.connectionRefs={},t.default=NcConnectionMgrv2},27108:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n    <meta name="viewport" content="width=device-width">\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n    <title>NocoDB forms: someone has responded to Form</title>\n    <style>\n        @media only screen and (max-width: 620px) {\n            table[class=body] h1 {\n                font-size: 28px !important;\n                margin-bottom: 10px !important;\n            }\n\n            table[class=body] p,\n            table[class=body] ul,\n            table[class=body] ol,\n            table[class=body] td,\n            table[class=body] span,\n            table[class=body] a {\n                font-size: 16px !important;\n            }\n\n            table[class=body] .wrapper,\n            table[class=body] .article {\n                padding: 10px !important;\n            }\n\n            table[class=body] .content {\n                padding: 0 !important;\n            }\n\n            table[class=body] .container {\n                padding: 0 !important;\n                width: 100% !important;\n            }\n\n            table[class=body] .main {\n                border-left-width: 0 !important;\n                border-radius: 0 !important;\n                border-right-width: 0 !important;\n            }\n\n            table[class=body] .btn table {\n                width: 100% !important;\n            }\n\n            table[class=body] .btn a {\n                width: 100% !important;\n            }\n\n            table[class=body] .img-responsive {\n                height: auto !important;\n                max-width: 100% !important;\n                width: auto !important;\n            }\n        }\n\n        @media all {\n            .ExternalClass {\n                width: 100%;\n            }\n\n            .ExternalClass,\n            .ExternalClass p,\n            .ExternalClass span,\n            .ExternalClass font,\n            .ExternalClass td,\n            .ExternalClass div {\n                line-height: 100%;\n            }\n\n            .apple-link a {\n                color: inherit !important;\n                font-family: inherit !important;\n                font-size: inherit !important;\n                font-weight: inherit !important;\n                line-height: inherit !important;\n                text-decoration: none !important;\n            }\n\n            #MessageViewBody a {\n                color: inherit;\n                text-decoration: none;\n                font-size: inherit;\n                font-family: inherit;\n                font-weight: inherit;\n                line-height: inherit;\n            }\n\n            .btn-primary table td:hover {\n                background-color: #34495e !important;\n            }\n\n            .btn-primary a:hover {\n                background-color: #34495e !important;\n                border-color: #34495e !important;\n            }\n        }\n    </style>\n</head>\n<body class=""\n      style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader"\n      style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">NocoDB forms: someone has responded to Form</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body"\n       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;"\n       width="100%" bgcolor="#f6f6f6">\n    <tr>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n        <td class="container"\n            style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;"\n            width="580" valign="top">\n            <div class="content"\n                 style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n                \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n                <table role="presentation" class="main"\n                       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;"\n                       width="100%">\n\n                    \x3c!-- START MAIN CONTENT AREA --\x3e\n                    <tr>\n                        <td class="wrapper"\n                            style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;"\n                            valign="top">\n                            <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                   style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                                   width="100%">\n                                   \n                                   <tr>\n                                   <td style="font-family: sans-serif; font-size: 14px;padding: 20px 5px 10px 5px; " colspan="2">\n                                     <a href="https://github.com/nocodb/nocodb" target="_blank">\n                                        <img src="https://cdn.nocodb.com/email/logo.png" alt="NocoDB" width="150" style=" vertical-align: middle">\n                                     </a>\n                                   </td>\n                                   </tr>\n                                   <tr>\n                                   <td style="font-family: sans-serif; font-size: 14px;line-height: 20px; vertical-align: top;padding: 10px 5px 40px 5px; " colspan="2">\n                                     Someone has responded to Form. A record has been added to the subscriptions table in <span style="font-weight: bold"><%= _tn %></span>.\n                                   </td>\n                                   </tr>\n                                   \n                                <% Object.keys(data).forEach(function(prop) { \n                                if(data[prop] !== null && data[prop] !== undefined && data[prop] !== \'\'){\n                                %>\n                                  <tr>\n                                      <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;padding: 20px 5px 20px 5px;text-transform: capitalize "\n                                          valign="top">\n                                            <%= prop %>\n                                      </td>\n                                      <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;padding: 20px 5px 20px 5px;"\n                                          valign="top">\n                                            <%= data[prop] %>\n                                      </td>\n                                  </tr>\n                                <% }\n                                }); %>\n                            </table>\n                        </td>\n                    </tr>\n\n                    \x3c!-- END MAIN CONTENT AREA --\x3e\n                </table>\n                \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n                \x3c!-- START FOOTER --\x3e\n                <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                           width="100%">\n                        <tr>\n                            <td class="content-block"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <span class="apple-link"\n                                      style="color: #999999; font-size: 12px; text-align: center;"></span>\n                                \x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="content-block powered-by"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <a href="https://github.com/nocodb/nocodb">NocoDB</a>\n                                \x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                \x3c!-- END FOOTER --\x3e\n\n            </div>\n        </td>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    </tr>\n</table>\n</body>\n</html>\n'},68176:(e,t)=>{"use strict";function a(e,t,a){let i,s,r=void 0===a?2166136261:a;for(i=0,s=e.length;i<s;i++)r^=e.charCodeAt(i),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return t?("0000000"+(r>>>0).toString(16)).substr(-8):r>>>0}function i(e){const t=a(e,!0);return t+a(t+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.partialExtract=t.deepMerge=t.getParamsHash=t.ROOT_ALIAS=void 0,t.getAliasGenerator=function(e="__nc_"){let t=0;return()=>`${e}${t++}`},t.hash64=i,t.ROOT_ALIAS="__nc_root";t.getParamsHash=e=>{let t="";for(const[a,i]of Object.entries(e).sort())["limit","offset"].includes(a)||(t+=`${a}:${i}`);return i(t)};const s=e=>e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e);t.deepMerge=(e,...a)=>{if(!a.length)return e;const i=a.shift();return void 0===i?e:(s(e)&&s(i)&&Object.keys(i).forEach((a=>{s(i[a])?(e[a]||(e[a]={}),(0,t.deepMerge)(e[a],i[a])):e[a]=i[a]})),(0,t.deepMerge)(e,...a))};t.partialExtract=(e,a)=>{if("object"!=typeof e||null===e)return e;const i={};for(const s of a)if(Array.isArray(s)){const[a,...r]=s;r.length?i[a]=Object.assign(i[a]||{},(0,t.partialExtract)(e[a],r)):i[a]=e[a]}else i[s]=e[s];return i}},59516:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sanitiseEmailContent=void 0;const a=e=>null==e?void 0:e.split("").map((e=>`&#${e.charCodeAt(0)};`)).join("");t.sanitiseEmailContent=e=>{var t;return null===(t=null==e?void 0:e.replace(/[<>&;?#,'"$]+/g,a))||void 0===t?void 0:t.replace(/\.|\/\/:/g,"<span>$&</span>")}},54900:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decryptPropIfRequired=t.encryptPropIfRequired=t.isEncryptionRequired=t.getCredentialEncryptSecret=void 0;const s=i(a(8608));t.getCredentialEncryptSecret=()=>process.env.NC_CONNECTION_ENCRYPT_KEY;t.isEncryptionRequired=(e=(0,t.getCredentialEncryptSecret)())=>!!e;t.encryptPropIfRequired=({data:e,prop:a="config",secret:i=(0,t.getCredentialEncryptSecret)()})=>{if(!e||null===e[a]||void 0===e[a])return;const r="string"==typeof e[a]?e[a]:JSON.stringify(e[a]);return i?s.default.AES.encrypt(r,i).toString():r};t.decryptPropIfRequired=({data:e,prop:a="config",secret:i=(0,t.getCredentialEncryptSecret)()})=>{if(!e||null===e[a]||void 0===e[a])return;let r=e[a];if(i)try{r=s.default.AES.decrypt(e[a],i).toString(s.default.enc.Utf8)}catch(e){throw new Error("Config decryption failed")}return"string"==typeof r?JSON.parse(r):r}},68592:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e=!1,t=r.default.ncMeta){var a,i,c;try{let d=await l.default.get(s.CacheScope.INSTANCE_META,s.CacheGetType.TYPE_OBJECT);if(!d||e){const e=await t.knex(s.MetaTable.PROJECT).count("id as count").first().where("deleted",!1).where("is_meta",!0).then((e=>e.count)),u=await t.knex(s.MetaTable.PROJECT).count("id as count").first().where("deleted",!1).where("is_meta",!1).then((e=>e.count)),p=await t.knex(s.MetaTable.USERS).count("id as count").first().then((e=>e.count)),m=await t.knex(s.MetaTable.STORE).select("created_at").where("key","nc_server_id").first().then((e=>e.created_at)),_=await t.knex(s.MetaTable.FILE_REFERENCES).count("storage as count").first().then((e=>e.count)),f=await t.knex(s.MetaTable.MODELS).count("id as count").first().then((e=>e.count)),h=await t.knex(s.MetaTable.VIEWS).count("id as count").first().then((e=>e.count));d={projectsMeta:e,projectsExt:u,impacted:p,nc_db_type:null===(c=null===(i=null===(a=r.default.getConfig())||void 0===a?void 0:a.meta)||void 0===i?void 0:i.db)||void 0===c?void 0:c.client,created:m,files:_,tables:f,views:h},await l.default.set(s.CacheScope.INSTANCE_META,d)}return d}catch(e){return{}}};const s=a(64612),r=i(a(76584)),l=i(a(57804))},64612:(e,t)=>{"use strict";var a,i,s,r,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.RootScopeTables=t.RootScopes=t.DB_TYPES=t.COMPARISON_SUB_OPS=t.IS_WITHIN_COMPARISON_SUB_OPS=t.COMPARISON_OPS=t.GROUPBY_COMPARISON_OPS=t.CacheDelDirection=t.CacheGetType=t.CacheScope=t.sakilaTableNames=t.orderedMetaTables=t.MetaTableOldV2=t.MetaTable=void 0,function(e){e.PROJECT="nc_bases_v2",e.SOURCES="nc_sources_v2",e.MODELS="nc_models_v2",e.COLUMNS="nc_columns_v2",e.COLUMN_VALIDATIONS="nc_columns_validations_v2",e.COL_PROPS="nc_col_props_v2",e.COL_RELATIONS="nc_col_relations_v2",e.COL_SELECT_OPTIONS="nc_col_select_options_v2",e.COL_LOOKUP="nc_col_lookup_v2",e.COL_ROLLUP="nc_col_rollup_v2",e.COL_FORMULA="nc_col_formula_v2",e.COL_QRCODE="nc_col_qrcode_v2",e.COL_BARCODE="nc_col_barcode_v2",e.FILTER_EXP="nc_filter_exp_v2",e.SORT="nc_sort_v2",e.SHARED_VIEWS="nc_shared_views_v2",e.ACL="nc_acl_v2",e.FORM_VIEW="nc_form_view_v2",e.FORM_VIEW_COLUMNS="nc_form_view_columns_v2",e.GALLERY_VIEW="nc_gallery_view_v2",e.GALLERY_VIEW_COLUMNS="nc_gallery_view_columns_v2",e.CALENDAR_VIEW="nc_calendar_view_v2",e.CALENDAR_VIEW_COLUMNS="nc_calendar_view_columns_v2",e.CALENDAR_VIEW_RANGE="nc_calendar_view_range_v2",e.GRID_VIEW="nc_grid_view_v2",e.GRID_VIEW_COLUMNS="nc_grid_view_columns_v2",e.KANBAN_VIEW="nc_kanban_view_v2",e.KANBAN_VIEW_COLUMNS="nc_kanban_view_columns_v2",e.USERS="nc_users_v2",e.ORGS_OLD="nc_orgs_v2",e.TEAMS="nc_teams_v2",e.TEAM_USERS="nc_team_users_v2",e.VIEWS="nc_views_v2",e.AUDIT="nc_audit_v2",e.HOOKS="nc_hooks_v2",e.HOOK_LOGS="nc_hook_logs_v2",e.PLUGIN="nc_plugins_v2",e.PROJECT_USERS="nc_base_users_v2",e.MODEL_ROLE_VISIBILITY="nc_disabled_models_for_role_v2",e.API_TOKENS="nc_api_tokens",e.SYNC_SOURCE="nc_sync_source_v2",e.SYNC_LOGS="nc_sync_logs_v2",e.MAP_VIEW="nc_map_view_v2",e.MAP_VIEW_COLUMNS="nc_map_view_columns_v2",e.STORE="nc_store",e.NOTIFICATION="notification",e.USER_REFRESH_TOKENS="nc_user_refresh_tokens",e.EXTENSIONS="nc_extensions",e.COMMENTS="nc_comments",e.USER_COMMENTS_NOTIFICATIONS_PREFERENCE="nc_user_comment_notifications_preference",e.COMMENTS_REACTIONS="nc_comment_reactions",e.JOBS="nc_jobs",e.INTEGRATIONS="nc_integrations_v2",e.INTEGRATIONS_STORE="nc_integrations_store_v2",e.FILE_REFERENCES="nc_file_references",e.COL_BUTTON="nc_col_button_v2"}(a||(t.MetaTable=a={})),function(e){e.PROJECT="nc_projects_v2",e.PROJECT_USERS="nc_project_users_v2",e.BASES="nc_bases_v2"}(i||(t.MetaTableOldV2=i={})),t.orderedMetaTables=[a.MODEL_ROLE_VISIBILITY,a.PLUGIN,a.AUDIT,a.TEAM_USERS,a.TEAMS,a.ORGS_OLD,a.PROJECT_USERS,a.USERS,a.MAP_VIEW,a.MAP_VIEW_COLUMNS,a.KANBAN_VIEW_COLUMNS,a.KANBAN_VIEW,a.CALENDAR_VIEW,a.CALENDAR_VIEW_COLUMNS,a.CALENDAR_VIEW_RANGE,a.GRID_VIEW_COLUMNS,a.GRID_VIEW,a.GALLERY_VIEW_COLUMNS,a.GALLERY_VIEW,a.FORM_VIEW_COLUMNS,a.FORM_VIEW,a.SHARED_VIEWS,a.SORT,a.FILTER_EXP,a.HOOK_LOGS,a.HOOKS,a.VIEWS,a.COL_FORMULA,a.COL_ROLLUP,a.COL_LOOKUP,a.COL_SELECT_OPTIONS,a.COL_RELATIONS,a.COLUMN_VALIDATIONS,a.COLUMNS,a.MODELS,a.SOURCES,a.PROJECT],t.sakilaTableNames=["actor","address","category","city","country","customer","film","film_actor","film_category","film_text","inventory","language","payment","rental","staff","store","actor_info","customer_list","film_list","nicer_but_slower_film_list","sales_by_film_category","sales_by_store","staff_list"],function(e){e.PROJECT="base",e.SOURCE="source",e.MODEL="model",e.COLUMN="column",e.COL_PROP="colProp",e.COL_RELATION="colRelation",e.COL_SELECT_OPTION="colSelectOption",e.COL_LOOKUP="colLookup",e.COL_ROLLUP="colRollup",e.COL_FORMULA="colFormula",e.COL_QRCODE="colQRCode",e.COL_BARCODE="colBarcode",e.FILTER_EXP="filterExp",e.SORT="sort",e.SHARED_VIEW="sharedView",e.ACL="acl",e.FORM_VIEW="formView",e.FORM_VIEW_COLUMN="formViewColumn",e.GALLERY_VIEW="galleryView",e.GALLERY_VIEW_COLUMN="galleryViewColumn",e.GRID_VIEW="gridView",e.GRID_VIEW_COLUMN="gridViewColumn",e.KANBAN_VIEW="kanbanView",e.CALENDAR_VIEW="calendarView",e.CALENDAR_VIEW_COLUMN="calendarViewColumn",e.CALENDAR_VIEW_RANGE="calendarViewRange",e.MAP_VIEW="mapView",e.MAP_VIEW_COLUMN="mapViewColumn",e.KANBAN_VIEW_COLUMN="kanbanViewColumn",e.USER="user",e.ORGS_OLD="orgs",e.TEAM="team",e.TEAM_USER="teamUser",e.VIEW="view",e.AUDIT="audit",e.HOOK="hook",e.PLUGIN="plugin",e.BASE_USER="baseUser",e.MODEL_ROLE_VISIBILITY="modelRoleVisibility",e.API_TOKEN="apiToken",e.INSTANCE_META="instanceMeta",e.USER_BASE="userBase",e.DASHBOARD_PROJECT_DB_PROJECT_LINKING="dashboardProjectDBProjectLinking",e.SINGLE_QUERY="singleQuery",e.JOBS="nc_jobs",e.JOBS_POLLING="nc_jobs_polling",e.PRESIGNED_URL="presignedUrl",e.STORE="store",e.PROJECT_ALIAS="baseAlias",e.MODEL_ALIAS="modelAlias",e.VIEW_ALIAS="viewAlias",e.SSO_CLIENT="ssoClient",e.EXTENSION="uiExtension",e.INTEGRATION="integration",e.COL_BUTTON="colButton",e.CMD_PALETTE="cmdPalette",e.PRODUCT_FEED="productFeed"}(s||(t.CacheScope=s={})),function(e){e.TYPE_ARRAY="TYPE_ARRAY",e.TYPE_OBJECT="TYPE_OBJECT",e.TYPE_STRING="TYPE_STRING"}(r||(t.CacheGetType=r={})),function(e){e.PARENT_TO_CHILD="PARENT_TO_CHILD",e.CHILD_TO_PARENT="CHILD_TO_PARENT"}(l||(t.CacheDelDirection=l={})),t.GROUPBY_COMPARISON_OPS=["gb_eq","gb_null"],t.COMPARISON_OPS=["eq","neq","not","like","nlike","empty","notempty","null","notnull","checked","notchecked","blank","notblank","allof","anyof","nallof","nanyof","gt","lt","gte","lte","ge","le","in","isnot","is","isWithin","btw","nbtw"],t.IS_WITHIN_COMPARISON_SUB_OPS=["pastWeek","pastMonth","pastYear","nextWeek","nextMonth","nextYear","pastNumberOfDays","nextNumberOfDays"],t.COMPARISON_SUB_OPS=["today","tomorrow","yesterday","oneWeekAgo","oneWeekFromNow","oneMonthAgo","oneMonthFromNow","daysAgo","daysFromNow","exactDate",...t.IS_WITHIN_COMPARISON_SUB_OPS],t.DB_TYPES=["mysql2","sqlite3","mysql","mssql","snowflake","oracledb","pg","databricks"],function(e){e.ROOT="root",e.ORG="org",e.WORKSPACE="workspace",e.BASE="base",e.BYPASS="bypass"}(c||(t.RootScopes=c={})),t.RootScopeTables={[c.ROOT]:[a.USERS,a.USER_REFRESH_TOKENS,a.API_TOKENS,a.PLUGIN,a.STORE,a.NOTIFICATION,a.JOBS,a.FILE_REFERENCES,a.AUDIT],[c.BASE]:[a.PROJECT],[c.WORKSPACE]:[a.INTEGRATIONS]}},62304:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.isEE=t.T=void 0,s(a(68176),t),s(a(47972),t),s(a(59516),t),s(a(37308),t),s(a(50500),t);var r=a(39080);Object.defineProperty(t,"T",{enumerable:!0,get:function(){return r.Tele}}),s(a(45408),t),s(a(54900),t),t.isEE=!1},55420:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mimeIcons=void 0,t.default={123:"application/vnd.lotus-1-2-3",x3d:"application/vnd.hzn-3d-crossword","3gp":"video/3gpp","3g2":"video/3gpp2",mseq:"application/vnd.mseq",pwn:"application/vnd.3m.post-it-notes",plb:"application/vnd.3gpp.pic-bw-large",psb:"application/vnd.3gpp.pic-bw-small",pvb:"application/vnd.3gpp.pic-bw-var",tcap:"application/vnd.3gpp2.tcap","7z":"application/x-7z-compressed",abw:"application/x-abiword",ace:"application/x-ace-compressed",acc:"application/vnd.americandynamics.acc",acu:"application/vnd.acucobol",atc:"application/vnd.acucorp",adp:"audio/adpcm",aab:"application/x-authorware-bin",aam:"application/x-authorware-map",aas:"application/x-authorware-seg",air:"application/vnd.adobe.air-application-installer-package+zip",swf:"application/x-shockwave-flash",fxp:"application/vnd.adobe.fxp",pdf:"application/pdf",ppd:"application/vnd.cups-ppd",dir:"application/x-director",xdp:"application/vnd.adobe.xdp+xml",xfdf:"application/vnd.adobe.xfdf",aac:"audio/x-aac",ahead:"application/vnd.ahead.space",azf:"application/vnd.airzip.filesecure.azf",azs:"application/vnd.airzip.filesecure.azs",azw:"application/vnd.amazon.ebook",ami:"application/vnd.amiga.ami","/A":"application/andrew-inset",apk:"application/vnd.android.package-archive",cii:"application/vnd.anser-web-certificate-issue-initiation",fti:"application/vnd.anser-web-funds-transfer-initiation",atx:"application/vnd.antix.game-component",dmg:"application/x-apple-diskimage",mpkg:"application/vnd.apple.installer+xml",aw:"application/applixware",les:"application/vnd.hhe.lesson-player",swi:"application/vnd.aristanetworks.swi",s:"text/x-asm",atomcat:"application/atomcat+xml",atomsvc:"application/atomsvc+xml","atom, .xml":"application/atom+xml",ac:"application/pkix-attr-cert",aif:"audio/x-aiff",avi:"video/x-msvideo",aep:"application/vnd.audiograph",dxf:"image/vnd.dxf",dwf:"model/vnd.dwf",par:"text/plain-bas",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",torrent:"application/x-bittorrent",cod:"application/vnd.rim.cod",mpm:"application/vnd.blueice.multipass",bmi:"application/vnd.bmi",sh:"application/x-sh",btif:"image/prs.btif",rep:"application/vnd.businessobjects",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",c:"text/x-c",cdxml:"application/vnd.chemdraw+xml",css:"text/css",cdx:"chemical/x-cdx",cml:"chemical/x-cml",csml:"chemical/x-csml",cdbcmsg:"application/vnd.contact.cmsg",cla:"application/vnd.claymore",c4g:"application/vnd.clonk.c4group",sub:"image/vnd.dvb.subtitle",cdmia:"application/cdmi-capability",cdmic:"application/cdmi-container",cdmid:"application/cdmi-domain",cdmio:"application/cdmi-object",cdmiq:"application/cdmi-queue",c11amc:"application/vnd.cluetrust.cartomobile-config",c11amz:"application/vnd.cluetrust.cartomobile-config-pkg",ras:"image/x-cmu-raster",dae:"model/vnd.collada+xml",csv:"text/csv",cpt:"application/mac-compactpro",wmlc:"application/vnd.wap.wmlc",cgm:"image/cgm",ice:"x-conference/x-cooltalk",cmx:"image/x-cmx",xar:"application/vnd.xara",cmc:"application/vnd.cosmocaller",cpio:"application/x-cpio",clkx:"application/vnd.crick.clicker",clkk:"application/vnd.crick.clicker.keyboard",clkp:"application/vnd.crick.clicker.palette",clkt:"application/vnd.crick.clicker.template",clkw:"application/vnd.crick.clicker.wordbank",wbs:"application/vnd.criticaltools.wbs+xml",cryptonote:"application/vnd.rig.cryptonote",cif:"chemical/x-cif",cmdf:"chemical/x-cmdf",cu:"application/cu-seeme",cww:"application/prs.cww",curl:"text/vnd.curl",dcurl:"text/vnd.curl.dcurl",mcurl:"text/vnd.curl.mcurl",scurl:"text/vnd.curl.scurl",car:"application/vnd.curl.car",pcurl:"application/vnd.curl.pcurl",cmp:"application/vnd.yellowriver-custom-menu",dssc:"application/dssc+der",xdssc:"application/dssc+xml",deb:"application/x-debian-package",uva:"audio/vnd.dece.audio",uvi:"image/vnd.dece.graphic",uvh:"video/vnd.dece.hd",uvm:"video/vnd.dece.mobile",uvu:"video/vnd.uvvu.mp4",uvp:"video/vnd.dece.pd",uvs:"video/vnd.dece.sd",uvv:"video/vnd.dece.video",dvi:"application/x-dvi",seed:"application/vnd.fdsn.seed",dtb:"application/x-dtbook+xml",res:"application/x-dtbresource+xml",ait:"application/vnd.dvb.ait",svc:"application/vnd.dvb.service",eol:"audio/vnd.digital-winds",djvu:"image/vnd.djvu",dtd:"application/xml-dtd",mlp:"application/vnd.dolby.mlp",wad:"application/x-doom",dpg:"application/vnd.dpgraph",dra:"audio/vnd.dra",dfac:"application/vnd.dreamfactory",dts:"audio/vnd.dts",dtshd:"audio/vnd.dts.hd",dwg:"image/vnd.dwg",geo:"application/vnd.dynageo",es:"application/ecmascript",mag:"application/vnd.ecowin.chart",mmr:"image/vnd.fujixerox.edmics-mmr",rlc:"image/vnd.fujixerox.edmics-rlc",exi:"application/exi",mgz:"application/vnd.proteus.magazine",epub:"application/epub+zip",eml:"message/rfc822",nml:"application/vnd.enliven",xpr:"application/vnd.is-xpr",xif:"image/vnd.xiff",xfdl:"application/vnd.xfdl",emma:"application/emma+xml",ez2:"application/vnd.ezpix-album",ez3:"application/vnd.ezpix-package",fst:"image/vnd.fst",fvt:"video/vnd.fvt",fbs:"image/vnd.fastbidsheet",fe_launch:"application/vnd.denovo.fcselayout-link",f4v:"video/x-f4v",flv:"video/x-flv",fpx:"image/vnd.fpx",npx:"image/vnd.net-fpx",flx:"text/vnd.fmi.flexstor",fli:"video/x-fli",ftc:"application/vnd.fluxtime.clip",fdf:"application/vnd.fdf",f:"text/x-fortran",mif:"application/vnd.mif",fm:"application/vnd.framemaker",fh:"image/x-freehand",fsc:"application/vnd.fsc.weblaunch",fnc:"application/vnd.frogans.fnc",ltf:"application/vnd.frogans.ltf",ddd:"application/vnd.fujixerox.ddd",xdw:"application/vnd.fujixerox.docuworks",xbd:"application/vnd.fujixerox.docuworks.binder",oas:"application/vnd.fujitsu.oasys",oa2:"application/vnd.fujitsu.oasys2",oa3:"application/vnd.fujitsu.oasys3",fg5:"application/vnd.fujitsu.oasysgp",bh2:"application/vnd.fujitsu.oasysprs",spl:"application/x-futuresplash",fzs:"application/vnd.fuzzysheet",g3:"image/g3fax",gmx:"application/vnd.gmx",gtw:"model/vnd.gtw",txd:"application/vnd.genomatix.tuxedo",ggb:"application/vnd.geogebra.file",ggt:"application/vnd.geogebra.tool",gdl:"model/vnd.gdl",gex:"application/vnd.geometry-explorer",gxt:"application/vnd.geonext",g2w:"application/vnd.geoplan",g3w:"application/vnd.geospace",gsf:"application/x-font-ghostscript",bdf:"application/x-font-bdf",gtar:"application/x-gtar",texinfo:"application/x-texinfo",gnumeric:"application/x-gnumeric",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz",gpx:"application/gpx+xml",gqf:"application/vnd.grafeq",gif:"image/gif",gv:"text/vnd.graphviz",gac:"application/vnd.groove-account",ghf:"application/vnd.groove-help",gim:"application/vnd.groove-identity-message",grv:"application/vnd.groove-injector",gtm:"application/vnd.groove-tool-message",tpl:"application/vnd.groove-tool-template",vcg:"application/vnd.groove-vcard",h261:"video/h261",h263:"video/h263",h264:"video/h264",hpid:"application/vnd.hp-hpid",hps:"application/vnd.hp-hps",hdf:"application/x-hdf",rip:"audio/vnd.rip",hbci:"application/vnd.hbci",jlt:"application/vnd.hp-jlyt",pcl:"application/vnd.hp-pcl",hpgl:"application/vnd.hp-hpgl",hvs:"application/vnd.yamaha.hv-script",hvd:"application/vnd.yamaha.hv-dic",hvp:"application/vnd.yamaha.hv-voice","sfd-hdstx":"application/vnd.hydrostatix.sof-data",stk:"application/hyperstudio",hal:"application/vnd.hal+xml",html:"text/html",irm:"application/vnd.ibm.rights-management",sc:"application/vnd.ibm.secure-container",ics:"text/calendar",icc:"application/vnd.iccprofile",ico:"image/x-icon",igl:"application/vnd.igloader",ief:"image/ief",ivp:"application/vnd.immervision-ivp",ivu:"application/vnd.immervision-ivu",rif:"application/reginfo+xml","3dml":"text/vnd.in3d.3dml",spot:"text/vnd.in3d.spot",igs:"model/iges",i2g:"application/vnd.intergeo",cdy:"application/vnd.cinderella",xpw:"application/vnd.intercon.formnet",fcs:"application/vnd.isac.fcs",ipfix:"application/ipfix",cer:"application/pkix-cert",pki:"application/pkixcmp",crl:"application/pkix-crl",pkipath:"application/pkix-pkipath",igm:"application/vnd.insors.igm",rcprofile:"application/vnd.ipunplugged.rcprofile",irp:"application/vnd.irepository.package+xml",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",class:"application/java-vm",jnlp:"application/x-java-jnlp-file",ser:"application/java-serialized-object",java:"text/x-java-source,java",js:"application/javascript",json:"application/json",joda:"application/vnd.joost.joda-archive",jpm:"video/jpm",jpeg:"image/x-citrix-jpeg",jpg:"image/x-citrix-jpeg",pjpeg:"image/pjpeg",jpgv:"video/jpeg",ktz:"application/vnd.kahootz",mmd:"application/vnd.chipnuts.karaoke-mmd",karbon:"application/vnd.kde.karbon",chrt:"application/vnd.kde.kchart",kfo:"application/vnd.kde.kformula",flw:"application/vnd.kde.kivio",kon:"application/vnd.kde.kontour",kpr:"application/vnd.kde.kpresenter",ksp:"application/vnd.kde.kspread",kwd:"application/vnd.kde.kword",htke:"application/vnd.kenameaapp",kia:"application/vnd.kidspiration",kne:"application/vnd.kinar",sse:"application/vnd.kodak-descriptor",lasxml:"application/vnd.las.las+xml",latex:"application/x-latex",lbd:"application/vnd.llamagraphics.life-balance.desktop",lbe:"application/vnd.llamagraphics.life-balance.exchange+xml",jam:"application/vnd.jam",apr:"application/vnd.lotus-approach",pre:"application/vnd.lotus-freelance",nsf:"application/vnd.lotus-notes",org:"application/vnd.lotus-organizer",scm:"application/vnd.lotus-screencam",lwp:"application/vnd.lotus-wordpro",lvp:"audio/vnd.lucent.voice",m3u:"audio/x-mpegurl",m4v:"video/x-m4v",hqx:"application/mac-binhex40",portpkg:"application/vnd.macports.portpkg",mgp:"application/vnd.osgeo.mapguide.package",mrc:"application/marc",mrcx:"application/marcxml+xml",mxf:"application/mxf",nbp:"application/vnd.wolfram.player",ma:"application/mathematica",mathml:"application/mathml+xml",mbox:"application/mbox",mc1:"application/vnd.medcalcdata",mscml:"application/mediaservercontrol+xml",cdkey:"application/vnd.mediastation.cdkey",mwf:"application/vnd.mfer",mfm:"application/vnd.mfmp",msh:"model/mesh",mads:"application/mads+xml",mets:"application/mets+xml",mods:"application/mods+xml",meta4:"application/metalink4+xml",mcd:"application/vnd.mcd",flo:"application/vnd.micrografx.flo",igx:"application/vnd.micrografx.igx",es3:"application/vnd.eszigno3+xml",mdb:"application/x-msaccess",asf:"video/x-ms-asf",exe:"application/x-msdownload",cil:"application/vnd.ms-artgalry",cab:"application/vnd.ms-cab-compressed",ims:"application/vnd.ms-ims",application:"application/x-ms-application",clp:"application/x-msclip",mdi:"image/vnd.ms-modi",eot:"application/vnd.ms-fontobject",xls:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",chm:"application/vnd.ms-htmlhelp",crd:"application/x-mscardfile",lrm:"application/vnd.ms-lrm",mvb:"application/x-msmediaview",mny:"application/x-msmoney",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",obd:"application/x-msbinder",thmx:"application/vnd.ms-officetheme",onetoc:"application/onenote",pya:"audio/vnd.ms-playready.media.pya",pyv:"video/vnd.ms-playready.media.pyv",ppt:"application/vnd.ms-powerpoint",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldm:"application/vnd.ms-powerpoint.slide.macroenabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",mpp:"application/vnd.ms-project",pub:"application/x-mspublisher",scd:"application/x-msschedule",xap:"application/x-silverlight-app",stl:"application/vnd.ms-pki.stl",cat:"application/vnd.ms-pki.seccat",vsd:"application/vnd.visio",vsdx:"application/vnd.visio2013",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",wmx:"video/x-ms-wmx",wmd:"application/x-ms-wmd",wpl:"application/vnd.ms-wpl",wmz:"application/x-ms-wmz",wmv:"video/x-ms-wmv",wvx:"video/x-ms-wvx",wmf:"application/x-msmetafile",trm:"application/x-msterminal",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",dotm:"application/vnd.ms-word.template.macroenabled.12",wri:"application/x-mswrite",wps:"application/vnd.ms-works",xbap:"application/x-ms-xbap",xps:"application/vnd.ms-xpsdocument",mid:"audio/midi",mpy:"application/vnd.ibm.minipay",afp:"application/vnd.ibm.modcap",rms:"application/vnd.jcp.javame.midlet-rms",tmo:"application/vnd.tmobile-livetv",prc:"application/x-mobipocket-ebook",mbk:"application/vnd.mobius.mbk",dis:"application/vnd.mobius.dis",plc:"application/vnd.mobius.plc",mqy:"application/vnd.mobius.mqy",msl:"application/vnd.mobius.msl",txf:"application/vnd.mobius.txf",daf:"application/vnd.mobius.daf",fly:"text/vnd.fly",mpc:"application/vnd.mophun.certificate",mpn:"application/vnd.mophun.application",mj2:"video/mj2",mpga:"audio/mpeg",mxu:"video/vnd.mpegurl",mpeg:"video/mpeg",m21:"application/mp21",mp4a:"audio/mp4",mp4:"application/mp4",m3u8:"application/vnd.apple.mpegurl",mus:"application/vnd.musician",msty:"application/vnd.muvee.style",mxml:"application/xv+xml",ngdat:"application/vnd.nokia.n-gage.data","n-gage":"application/vnd.nokia.n-gage.symbian.install",ncx:"application/x-dtbncx+xml",nc:"application/x-netcdf",nlu:"application/vnd.neurolanguage.nlu",dna:"application/vnd.dna",nnd:"application/vnd.noblenet-directory",nns:"application/vnd.noblenet-sealer",nnw:"application/vnd.noblenet-web",rpst:"application/vnd.nokia.radio-preset",rpss:"application/vnd.nokia.radio-presets",n3:"text/n3",edm:"application/vnd.novadigm.edm",edx:"application/vnd.novadigm.edx",ext:"application/vnd.novadigm.ext",gph:"application/vnd.flographit",ecelp4800:"audio/vnd.nuera.ecelp4800",ecelp7470:"audio/vnd.nuera.ecelp7470",ecelp9600:"audio/vnd.nuera.ecelp9600",oda:"application/oda",ogx:"application/ogg",oga:"audio/ogg",ogv:"video/ogg",dd2:"application/vnd.oma.dd2+xml",oth:"application/vnd.oasis.opendocument.text-web",opf:"application/oebps-package+xml",qbo:"application/vnd.intu.qbo",oxt:"application/vnd.openofficeorg.extension",osf:"application/vnd.yamaha.openscoreformat",weba:"audio/webm",webm:"video/webm",odc:"application/vnd.oasis.opendocument.chart",otc:"application/vnd.oasis.opendocument.chart-template",odb:"application/vnd.oasis.opendocument.database",odf:"application/vnd.oasis.opendocument.formula",odft:"application/vnd.oasis.opendocument.formula-template",odg:"application/vnd.oasis.opendocument.graphics",otg:"application/vnd.oasis.opendocument.graphics-template",odi:"application/vnd.oasis.opendocument.image",oti:"application/vnd.oasis.opendocument.image-template",odp:"application/vnd.oasis.opendocument.presentation",otp:"application/vnd.oasis.opendocument.presentation-template",ods:"application/vnd.oasis.opendocument.spreadsheet",ots:"application/vnd.oasis.opendocument.spreadsheet-template",odt:"application/vnd.oasis.opendocument.text",odm:"application/vnd.oasis.opendocument.text-master",ott:"application/vnd.oasis.opendocument.text-template",ktx:"image/ktx",sxc:"application/vnd.sun.xml.calc",stc:"application/vnd.sun.xml.calc.template",sxd:"application/vnd.sun.xml.draw",std:"application/vnd.sun.xml.draw.template",sxi:"application/vnd.sun.xml.impress",sti:"application/vnd.sun.xml.impress.template",sxm:"application/vnd.sun.xml.math",sxw:"application/vnd.sun.xml.writer",sxg:"application/vnd.sun.xml.writer.global",stw:"application/vnd.sun.xml.writer.template",otf:"application/x-font-otf",osfpvg:"application/vnd.yamaha.openscoreformat.osfpvg+xml",dp:"application/vnd.osgi.dp",pdb:"application/vnd.palm",p:"text/x-pascal",paw:"application/vnd.pawaafile",pclxl:"application/vnd.hp-pclxl",efif:"application/vnd.picsel",pcx:"image/x-pcx",psd:"image/vnd.adobe.photoshop",prf:"application/pics-rules",pic:"image/x-pict",chat:"application/x-chat",p10:"application/pkcs10",p12:"application/x-pkcs12",p7m:"application/pkcs7-mime",p7s:"application/pkcs7-signature",p7r:"application/x-pkcs7-certreqresp",p7b:"application/x-pkcs7-certificates",p8:"application/pkcs8",plf:"application/vnd.pocketlearn",pnm:"image/x-portable-anymap",pbm:"image/x-portable-bitmap",pcf:"application/x-font-pcf",pfr:"application/font-tdpfr",pgn:"application/x-chess-pgn",pgm:"image/x-portable-graymap",png:"image/x-png",ppm:"image/x-portable-pixmap",pskcxml:"application/pskc+xml",pml:"application/vnd.ctc-posml",ai:"application/postscript",pfa:"application/x-font-type1",pbd:"application/vnd.powerbuilder6",pgp:"application/pgp-signature",box:"application/vnd.previewsystems.box",ptid:"application/vnd.pvi.ptid1",pls:"application/pls+xml",str:"application/vnd.pg.format",ei6:"application/vnd.pg.osasli",dsc:"text/prs.lines.tag",psf:"application/x-font-linux-psf",qps:"application/vnd.publishare-delta-tree",wg:"application/vnd.pmi.widget",qxd:"application/vnd.quark.quarkxpress",esf:"application/vnd.epson.esf",msf:"application/vnd.epson.msf",ssf:"application/vnd.epson.ssf",qam:"application/vnd.epson.quickanime",qfx:"application/vnd.intu.qfx",qt:"video/quicktime",rar:"application/x-rar-compressed",ram:"audio/x-pn-realaudio",rmp:"audio/x-pn-realaudio-plugin",rsd:"application/rsd+xml",rm:"application/vnd.rn-realmedia",bed:"application/vnd.realvnc.bed",mxl:"application/vnd.recordare.musicxml",musicxml:"application/vnd.recordare.musicxml+xml",rnc:"application/relax-ng-compact-syntax",rdz:"application/vnd.data-vision.rdz",rdf:"application/rdf+xml",rp9:"application/vnd.cloanto.rp9",jisp:"application/vnd.jisp",rtf:"application/rtf",rtx:"text/richtext",link66:"application/vnd.route66.link66+xml","rss, .xml":"application/rss+xml",shf:"application/shf+xml",st:"application/vnd.sailingtracker.track",svg:"image/svg+xml",sus:"application/vnd.sus-calendar",sru:"application/sru+xml",setpay:"application/set-payment-initiation",setreg:"application/set-registration-initiation",sema:"application/vnd.sema",semd:"application/vnd.semd",semf:"application/vnd.semf",see:"application/vnd.seemail",snf:"application/x-font-snf",spq:"application/scvp-vp-request",spp:"application/scvp-vp-response",scq:"application/scvp-cv-request",scs:"application/scvp-cv-response",sdp:"application/sdp",etx:"text/x-setext",movie:"video/x-sgi-movie",ifm:"application/vnd.shana.informed.formdata",itp:"application/vnd.shana.informed.formtemplate",iif:"application/vnd.shana.informed.interchange",ipk:"application/vnd.shana.informed.package",tfi:"application/thraud+xml",shar:"application/x-shar",rgb:"image/x-rgb",slt:"application/vnd.epson.salt",aso:"application/vnd.accpac.simply.aso",imp:"application/vnd.accpac.simply.imp",twd:"application/vnd.simtech-mindmapper",csp:"application/vnd.commonspace",saf:"application/vnd.yamaha.smaf-audio",mmf:"application/vnd.smaf",spf:"application/vnd.yamaha.smaf-phrase",teacher:"application/vnd.smart.teacher",svd:"application/vnd.svd",rq:"application/sparql-query",srx:"application/sparql-results+xml",gram:"application/srgs",grxml:"application/srgs+xml",ssml:"application/ssml+xml",skp:"application/vnd.koan",sgml:"text/sgml",sdc:"application/vnd.stardivision.calc",sda:"application/vnd.stardivision.draw",sdd:"application/vnd.stardivision.impress",smf:"application/vnd.stardivision.math",sdw:"application/vnd.stardivision.writer",sgl:"application/vnd.stardivision.writer-global",sm:"application/vnd.stepmania.stepchart",sit:"application/x-stuffit",sitx:"application/x-stuffitx",sdkm:"application/vnd.solent.sdkm+xml",xo:"application/vnd.olpc-sugar",au:"audio/basic",wqd:"application/vnd.wqd",sis:"application/vnd.symbian.install",smi:"application/smil+xml",xsm:"application/vnd.syncml+xml",bdm:"application/vnd.syncml.dm+wbxml",xdm:"application/vnd.syncml.dm+xml",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",sbml:"application/sbml+xml",tsv:"text/tab-separated-values",tiff:"image/tiff",tao:"application/vnd.tao.intent-module-archive",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",tfm:"application/x-tex-tfm",tei:"application/tei+xml",txt:"text/plain",dxp:"application/vnd.spotfire.dxp",sfs:"application/vnd.spotfire.sfs",tsd:"application/timestamped-data",tpt:"application/vnd.trid.tpt",mxs:"application/vnd.triscape.mxs",t:"text/troff",tra:"application/vnd.trueapp",ttf:"application/x-font-ttf",ttl:"text/turtle",umj:"application/vnd.umajin",uoml:"application/vnd.uoml+xml",unityweb:"application/vnd.unity",ufd:"application/vnd.ufdl",uri:"text/uri-list",utz:"application/vnd.uiq.theme",ustar:"application/x-ustar",uu:"text/x-uuencode",vcs:"text/x-vcalendar",vcf:"text/x-vcard",vcd:"application/x-cdlink",vsf:"application/vnd.vsf",wrl:"model/vrml",vcx:"application/vnd.vcx",mts:"model/vnd.mts",vtu:"model/vnd.vtu",vis:"application/vnd.visionary",viv:"video/vnd.vivo",ccxml:"application/ccxml+xml,",vxml:"application/voicexml+xml",src:"application/x-wais-source",wbxml:"application/vnd.wap.wbxml",wbmp:"image/vnd.wap.wbmp",wav:"audio/x-wav",davmount:"application/davmount+xml",woff:"application/x-font-woff",wspolicy:"application/wspolicy+xml",webp:"image/webp",wtb:"application/vnd.webturbo",wgt:"application/widget",hlp:"application/winhlp",wml:"text/vnd.wap.wml",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wpd:"application/vnd.wordperfect",stf:"application/vnd.wt.stf",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xpm:"image/x-xpixmap",xwd:"image/x-xwindowdump",der:"application/x-x509-ca-cert",fig:"application/x-xfig",xhtml:"application/xhtml+xml",xml:"application/xml",xdf:"application/xcap-diff+xml",xenc:"application/xenc+xml",xer:"application/patch-ops-error+xml",rl:"application/resource-lists+xml",rs:"application/rls-services+xml",rld:"application/resource-lists-diff+xml",xslt:"application/xslt+xml",xop:"application/xop+xml",xpi:"application/x-xpinstall",xspf:"application/xspf+xml",xul:"application/vnd.mozilla.xul+xml",xyz:"chemical/x-xyz",yaml:"text/yaml",yang:"application/yang",yin:"application/yin+xml",zir:"application/vnd.zul",zip:"application/zip",zmm:"application/vnd.handheld-entertainment+xml",zaz:"application/vnd.zzazz.deck+xml"};t.mimeIcons={pdf:"mdi-pdf-box",docx:"mdi-file-word-outline",dotx:"mdi-file-word-outline",odt:"mdi-file-word-outline",odm:"mdi-file-word-outline",ott:"mdi-file-word-outline",ppt:"mdi-file-powerpoint-box",pptx:"mdi-file-powerpoint-box",sldx:"mdi-file-powerpoint-box",ppsx:"mdi-file-powerpoint-box",potx:"mdi-file-powerpoint-box",xls:"mdi-file-excel-outline",xlam:"mdi-file-excel-outline",xlsb:"mdi-file-excel-outline",xltm:"mdi-file-excel-outline",xlsm:"mdi-file-excel-outline"}},26944:(e,t)=>{"use strict";function a(e,t="meta"){if(e)try{return"string"==typeof e[t]?JSON.parse(e[t]):e[t]}catch(e){return{}}}function i(e,t="meta"){if(!e)return null;try{return"string"==typeof e[t]||null===e[t]?e[t]:JSON.stringify(e[t])}catch(e){return"{}"}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseMetaProp=a,t.stringifyMetaProp=i,t.prepareForDb=function(e,t="meta"){if(!e)return e;"string"==typeof t&&(t=[t]);return t.forEach((t=>{t in e&&(e[t]=i(e,t))})),e},t.prepareForResponse=function(e,t="meta"){if(!e)return e;"string"==typeof t&&(t=[t]);return t.forEach((t=>{t in e&&(e[t]=a(e,t))})),e}},37148:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NcConfig=void 0;const c=r(a(67072)),d=l(a(2058)),u=a(50970),p=a(19448),m=a(2828),_=a(71068);class NcConfig{constructor(){this.meta={db:{client:m.DriverClient.SQLITE,connection:{filename:"noco.db"}}}}static async create(e){var t,a,i;const{meta:s,secret:r,port:l,worker:_,tryMode:f,publicUrl:h,dashboardPath:g}=e,y=new NcConfig;if(y.auth={jwt:{secret:r}},y.port=+(null!=l?l:8080),y.toolDir=(0,p.getToolDir)(),y.worker=null!=_&&_,y.env="_noco",y.workingEnv="_noco",y.baseType="rest",(null===(i=null===(a=null===(t=y.meta)||void 0===t?void 0:t.db)||void 0===a?void 0:a.connection)||void 0===i?void 0:i.filename)&&(y.meta.db.connection.filename=c.join(y.toolDir,y.meta.db.connection.filename)),f)y.try=!0,y.meta.db={client:m.DriverClient.SQLITE,connection:":memory:",pool:{min:1,max:1,idleTimeoutMillis:36e7}};else if(null==s?void 0:s.metaUrl)y.meta.db=await(0,p.metaUrlToDbConfig)(s.metaUrl);else if(null==s?void 0:s.metaJson)y.meta.db=JSON.parse(s.metaJson);else if(null==s?void 0:s.metaJsonFile){if(!await(0,u.promisify)(d.default.exists)(s.metaJsonFile))throw new Error(`NC_DB_JSON_FILE not found: ${s.metaJsonFile}`);const e=await(0,u.promisify)(d.default.readFile)(s.metaJsonFile,{encoding:"utf8"});y.meta.db=JSON.parse(e)}h&&(y.publicUrl=h),y.dashboardPath=g||"/dashboard";try{await y.metaDbCreateIfNotExist()}catch(e){throw new Error(e)}return y}static async createByEnv(){var e;return NcConfig.create({meta:{metaUrl:process.env.NC_DB,metaJson:process.env.NC_DB_JSON,metaJsonFile:process.env.NC_DB_JSON_FILE},secret:process.env.NC_AUTH_JWT_SECRET,port:process.env.NC_PORT,tryMode:!!process.env.NC_TRY,worker:!!process.env.NC_WORKER,dashboardPath:null!==(e=process.env.NC_DASHBOARD_URL)&&void 0!==e?e:"/dashboard",publicUrl:process.env.NC_PUBLIC_URL})}async metaDbCreateIfNotExist(){var e,t,a,i,s,r,l,c;if("sqlite3"===(null===(t=null===(e=this.meta)||void 0===e?void 0:e.db)||void 0===t?void 0:t.client)){const e=await _.SqlClientFactory.create(Object.assign(Object.assign({},this.meta.db),{connection:this.meta.db}));if(!(null===(i=null===(a=this.meta.db)||void 0===a?void 0:a.connection)||void 0===i?void 0:i.filename))throw new Error("Meta database configuration missing SQLite file name");await e.createDatabaseIfNotExists({database:null===(r=null===(s=this.meta.db)||void 0===s?void 0:s.connection)||void 0===r?void 0:r.filename}),await e.knex.destroy()}else{const e=await _.SqlClientFactory.create(this.meta.db);if(!(null===(c=null===(l=this.meta.db)||void 0===l?void 0:l.connection)||void 0===c?void 0:c.database))throw new Error("Meta database configuration missing database name");await e.createDatabaseIfNotExists(this.meta.db.connection),await e.knex.destroy()}}}t.NcConfig=NcConfig},76160:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.DriverClient=t.knownQueryParams=t.avoidSSL=t.defaultConnectionOptions=t.defaultConnectionConfig=t.defaultClientPortMapping=t.driverClientMapping=void 0,t.driverClientMapping={mysql:"mysql2",mariadb:"mysql2",postgres:"pg",postgresql:"pg",sqlite:"sqlite3",mssql:"mssql"},t.defaultClientPortMapping={mysql:3306,mysql2:3306,postgres:5432,pg:5432,mssql:1433},t.defaultConnectionConfig={dateStrings:!0},t.defaultConnectionOptions={pool:{min:0,max:10}},t.avoidSSL=["localhost","127.0.0.1","host.docker.internal","172.17.0.1"],t.knownQueryParams=[{parameter:"database",aliases:["d","db"]},{parameter:"password",aliases:["p"]},{parameter:"user",aliases:["u"]},{parameter:"title",aliases:["t"]},{parameter:"keyFilePath",aliases:[]},{parameter:"certFilePath",aliases:[]},{parameter:"caFilePath",aliases:[]},{parameter:"ssl",aliases:[]},{parameter:"options",aliases:["opt","opts"]}],function(e){e.MYSQL="mysql2",e.MYSQL_LEGACY="mysql",e.MSSQL="mssql",e.PG="pg",e.SQLITE="sqlite3",e.SNOWFLAKE="snowflake",e.DATABRICKS="databricks"}(a||(t.DriverClient=a={}))},19448:function(e,t,a){"use strict";var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.prepareEnv=async function({databaseUrlFile:e=process.env.NC_DATABASE_URL_FILE||process.env.DATABASE_URL_FILE,databaseUrl:t=process.env.NC_DATABASE_URL||process.env.DATABASE_URL}={}){if(e){const t=await(0,c.promisify)(r.default.readFile)(e,"utf-8");process.env.NC_DB=m(t)}else t&&(process.env.NC_DB=m(t))},t.getToolDir=function(){return process.env.NC_TOOL_DIR||process.cwd()},t.jdbcToXcConfig=function(e){e.replace(/^jdbc:/,"");const t=(0,d.default)(e),a={};for(const[e,i]of Object.entries(t)){const t=u.knownQueryParams.find((t=>t.parameter===e||t.aliases.includes(e)));t?a[t.parameter]=i:a[e]=i}(null==a?void 0:a.port)||(a.port=u.defaultClientPortMapping[u.driverClientMapping[a.driver]||a.driver]);const{driver:s}=a,r=i(a,["driver"]),l=u.driverClientMapping[s]||s;"pg"!==l||(null==r?void 0:r.ssl)||u.avoidSSL.includes(r.host)||(r.ssl=!0);return{client:l,connection:Object.assign({},r)}},t.jdbcToXcUrl=m,t.xcUrlToDbConfig=function(e,t="",a){const i=new l.URL(e);let s;if(i.protocol.startsWith("sqlite3"))s={client:"sqlite3",connection:{client:"sqlite3",connection:{filename:i.searchParams.get("d")||i.searchParams.get("database")},database:i.searchParams.get("d")||i.searchParams.get("database")}};else{const e={};for(const[t,a]of i.searchParams.entries()){const i=u.knownQueryParams.find((e=>e.parameter===t||e.aliases.includes(t)));i?e[i.parameter]=a:e[t]=a}s={client:i.protocol.replace(":",""),connection:Object.assign(Object.assign({},e),{host:i.hostname,port:+i.port}),acquireConnectionTimeout:6e5},process.env.NODE_TLS_REJECT_UNAUTHORIZED&&(s.connection.ssl=!0),i.searchParams.get("keyFilePath")&&i.searchParams.get("certFilePath")&&i.searchParams.get("caFilePath")&&(s.connection.ssl={keyFilePath:i.searchParams.get("keyFilePath"),certFilePath:i.searchParams.get("certFilePath"),caFilePath:i.searchParams.get("caFilePath")})}return Object.assign(s,{meta:{tn:"nc_evolutions",allSchemas:!!i.searchParams.get("allSchemas")||!(i.searchParams.get("d")||i.searchParams.get("database")),api:{prefix:i.searchParams.get("apiPrefix")||"",swagger:!0,type:a||i.searchParams.get("api")||i.searchParams.get("a")||"rest"},dbAlias:i.searchParams.get("dbAlias")||`db${t}`,metaTables:"db",migrations:{disabled:!1,name:"nc_evolutions"}}}),s},t.metaUrlToDbConfig=async function(e){var t,a;const i=new l.URL(e);let s;if(i.protocol.startsWith("sqlite3")){const e=i.searchParams.get("d")||i.searchParams.get("database");s=Object.assign({client:p.DriverClient.SQLITE,connection:{filename:e}},":memory:"===e?{pool:{min:1,max:1,idleTimeoutMillis:36e7}}:{})}else{const e={};for(const[t,a]of i.searchParams.entries()){const i=u.knownQueryParams.find((e=>e.parameter===t||e.aliases.includes(t)));i?e[i.parameter]=a:e[t]=a}s=Object.assign(Object.assign({client:i.protocol.replace(":",""),connection:Object.assign(Object.assign(Object.assign({},u.defaultConnectionConfig),e),{host:i.hostname,port:+i.port}),acquireConnectionTimeout:6e5},u.defaultConnectionOptions),i.searchParams.has("search_path")?{searchPath:i.searchParams.get("search_path").split(",")}:{}),process.env.NODE_TLS_REJECT_UNAUTHORIZED&&(s.connection.ssl=!0)}i.searchParams.forEach(((e,t)=>{let a=e;"true"===a?a=!0:"false"===a?a=!1:/^\d+$/.test(a)&&(a=+a),["password","p","database","d","user","u","search_path"].includes(t)||t.split(".").reduce(((e,t,i,s)=>e[t]=i===s.length-1?a:e[t]||{}),s)})),(null===(t=null==s?void 0:s.connection)||void 0===t?void 0:t.ssl)&&"object"==typeof(null===(a=null==s?void 0:s.connection)||void 0===a?void 0:a.ssl)&&(s.connection.ssl.caFilePath&&!s.connection.ssl.ca&&(s.connection.ssl.ca=(await(0,c.promisify)(r.default.readFile)(s.connection.ssl.caFilePath)).toString(),delete s.connection.ssl.caFilePath),s.connection.ssl.keyFilePath&&!s.connection.ssl.key&&(s.connection.ssl.key=(await(0,c.promisify)(r.default.readFile)(s.connection.ssl.keyFilePath)).toString(),delete s.connection.ssl.keyFilePath),s.connection.ssl.certFilePath&&!s.connection.ssl.cert&&(s.connection.ssl.cert=(await(0,c.promisify)(r.default.readFile)(s.connection.ssl.certFilePath)).toString(),delete s.connection.ssl.certFilePath));return s};const r=s(a(2058)),l=a(78716),c=a(50970),d=s(a(12320)),u=a(76160),p=a(2828);function m(e){e.replace(/^jdbc:/,"");const t=(0,d.default)(e),a={};for(const[e,i]of Object.entries(t)){const t=u.knownQueryParams.find((t=>t.parameter===e||t.aliases.includes(e)));t?a[t.parameter]=i:a[e]=i}(null==a?void 0:a.port)||(a.port=u.defaultClientPortMapping[u.driverClientMapping[a.driver]||a.driver]);const{driver:s,host:r,port:l,database:c,user:p,password:m}=a,_=i(a,["driver","host","port","database","user","password"]),f=[];for(const[e,t]of Object.entries(_))f.push(`${e}=${encodeURIComponent(t+"")}`);return`${u.driverClientMapping[s]||s}://${r}${l?`:${l}`:""}?${p?`u=${encodeURIComponent(p)}&`:""}${m?`p=${encodeURIComponent(m)}&`:""}${c?`d=${encodeURIComponent(c)}&`:""}${f.join("&")}`}},39143:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,s)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),s(a(19448),t),s(a(2828),t),s(a(76160),t),s(a(37148),t)},2828:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DriverClient=void 0;const i=a(76160);Object.defineProperty(t,"DriverClient",{enumerable:!0,get:function(){return i.DriverClient}})},50500:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nocoExecute=void 0;const i=new(a(23324).Logger)("nocoExecute"),s=e=>Array.isArray(e)?e.flatMap((e=>s(e))):e,r=async(e,t,a={},l=null)=>{var c;if(Array.isArray(t))return Promise.all(t.map(((t,i)=>r(e,t,a[i]=a[i]||{},l))));const d={},u=(e,t,a={},i={})=>{var s,r,l,c,d;if(e.length){const p=e[0];return void 0===t[p]||null===t[p]?"function"==typeof a[p]?t[e[0]]=a[p](i):"object"==typeof a[p]?t[e[0]]=Promise.resolve(a[p]):(null===(r=null===(s=null==t?void 0:t.__proto__)||void 0===s?void 0:s.__columnAliases)||void 0===r?void 0:r[e[0]])?t[e[0]]=u(null===(d=null===(c=null===(l=null==t?void 0:t.__proto__)||void 0===l?void 0:l.__columnAliases)||void 0===c?void 0:c[e[0]])||void 0===d?void 0:d.path,t,{},i):"object"==typeof t&&(t[e[0]]=Promise.resolve(a[p])):"function"==typeof t[p]&&(t.__proto__=Object.assign(Object.assign({},t.__proto__),{[p]:t[p](i)})),(t[e[0]]instanceof Promise?t[e[0]]:Promise.resolve(t[e[0]])).then((t=>Array.isArray(t)?Promise.all(t.map((t=>u(e.slice(1),t,{},i)))):null!=t?u(e.slice(1),t,{},i):Promise.resolve(null)))}return Promise.resolve(t)};function p(e,r){var l,c,p,m,_,f;if(null===(c=null===(l=null==t?void 0:t.__proto__)||void 0===l?void 0:l.__columnAliases)||void 0===c?void 0:c[e])d[e]=u(null===(_=null===(m=null===(p=null==t?void 0:t.__proto__)||void 0===p?void 0:p.__columnAliases)||void 0===m?void 0:m[e])||void 0===_?void 0:_.path,a,t,null===(f=null==r?void 0:r.nested)||void 0===f?void 0:f[e]).then((e=>Promise.resolve(Array.isArray(e)?s(e):e)));else{if(t)if("function"==typeof t[e])d[e]=t[e](r);else if("object"==typeof t[e])d[e]=Promise.resolve(t[e]);else try{d[e]=Promise.resolve(t[e])}catch(e){i.error(e)}a[e]=d[e]}}const m=e&&"object"==typeof e?Object.keys(e).filter((t=>e[t])):Object.keys(t),_={},f=[];for(const t of m)p(t,null===(c=null==l?void 0:l.nested)||void 0===c?void 0:c[t]),e[t]&&"object"==typeof e[t]&&(d[t]=d[t].then((i=>{var s;return Array.isArray(i)?a[t]=Promise.all(i.map(((i,s)=>{var c,d;return r(e[t],i,null===(c=null==a?void 0:a[t])||void 0===c?void 0:c[s],null===(d=null==l?void 0:l.nested)||void 0===d?void 0:d[t])}))):i?a[t]=r(e[t],i,a[t],null===(s=null==l?void 0:l.nested)||void 0===s?void 0:s[t]):i}))),d[t]&&f.push((async()=>{_[t]=await d[t]})());return await Promise.all(f),_};t.nocoExecute=r},45408:function(e,t,a){"use strict";var i,s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.packageInfo=t.packageVersion=void 0;const r=s(a(2058)),l=s(a(67072));let c={};t.packageInfo=c;try{t.packageInfo=c=JSON.parse(r.default.readFileSync(l.default.join(process.cwd(),"node_modules","nocodb","package.json"),"utf8"))}catch(e){try{t.packageInfo=c=JSON.parse(r.default.readFileSync(l.default.join(l.default.dirname(null===(i=process.pkg)||void 0===i?void 0:i.defaultEntrypoint),"node_modules","nocodb","package.json"),"utf8"))}catch(e){try{t.packageInfo=c=JSON.parse(r.default.readFileSync(l.default.join(process.cwd(),"package.json"),"utf8"))}catch(e){}}}const d=null==c?void 0:c.version;t.packageVersion=d},84988:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateTempFilePath=function(){return s.default.join(r.default.tmpdir(),"temp.txt")},t.waitForStreamClose=async function(e){return new Promise(((t,a)=>{e.once("finish",(()=>{t()})).once("error",(e=>{a(e)})),e.end()}))};const s=i(a(67072)),r=i(a(88558))},78599:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProjectRolePower=function(e){const t=[...i.OrderedProjectRoles].reverse();if(!e.base_roles)return-1;let a=null,r=-1;for(const i of Object.keys(e.base_roles)){const e=t.indexOf(i);e>r&&(a=i,r=e)}const l=t.indexOf(a);-1===l&&s.NcError.badRequest("Forbidden");return l};const i=a(71040),s=a(43820)},47972:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sanitiseUserObj=function(e){return Object.entries(e).reduce(((e,[t,i])=>(a.has(t)||(e[t]=i),e)),{})};const a=new Set(["password","salt","invite_token","invite_token_expires","reset_password_expires","reset_password_token","email_verification_token","created_at","updated_at"])},71956:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeJSON=t.serializeJSON=void 0;t.serializeJSON=e=>"string"==typeof e?e:JSON.stringify(e);t.deserializeJSON=e=>{var t;if("object"==typeof e)return null!=e?e:{};try{return null!==(t=JSON.parse(e))&&void 0!==t?t:{}}catch(e){return{}}}},39080:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tele=void 0;const s=i(a(88558)),r=i(a(28010)),l=a(93764),c=i(a(71178)),d=i(a(54048)),u=a(45408),p=i(a(22992)),m=a(62304),_=!!process.env.NC_DISABLE_TELE,f=!!process.env.NC_REDIS_URL,h=!!process.env.NC_BINARY_BUILD,g=!!(process.env.LITESTREAM_S3_BUCKET&&process.env.LITESTREAM_S3_SECRET_ACCESS_KEY&&process.env.LITESTREAM_S3_ACCESS_KEY_ID),y=()=>{try{const e=Math.round(process.uptime()/3600);Tele.emit("evt",{evt_type:"alive",count:global.NC_COUNT,upTime:e,cache:f,litestream:g,executable:h})}catch(e){}};setInterval(y,288e5);class Tele{static emit(e,t){try{this._init(),Tele.emitter.emit(e,t)}catch(e){}}static init(e){Tele.config=e,Tele._init()}static page(e){this.emit("page",e)}static event(e){this.emit("ph_event",e)}static _init(){try{if(!Tele.emitter){Tele.emitter=new r.default,Tele.machineId=(0,l.machineIdSync)();let e="",t="";t=process.env.NC_SERVER_UUID,e=u.packageVersion;const a={package_id:e,os_type:s.default.type(),os_platform:s.default.platform(),os_release:s.default.release(),node_version:process.version,docker:(0,d.default)(),xc_version:t,env:process.env.NODE_ENV||"production",oneClick:!!process.env.NC_ONE_CLICK};a.machine_id=`${(0,l.machineIdSync)()},,`,Tele.emitter.on("evt_app_started",(async e=>{try{if(await b(a),_)return;e&&void 0!==e.count&&(global.NC_COUNT=e.count),await c.default.post("https://telemetry.nocodb.com/api/v1/telemetry",Object.assign(Object.assign({},a),{evt_type:"started",payload:{count:global.NC_COUNT}}))}catch(e){}finally{y()}})),Tele.emitter.on("evt",(async e=>{try{const t=await Tele.getInstanceMeta()||{};if(await b(a),e.check&&(a.machine_id=`${(0,l.machineIdSync)()},,`),_&&(!e.evt_type||!e.evt_type.startsWith("a:sync-request:")))return;"project:invite"===e.evt_type&&(global.NC_COUNT=e.count||global.NC_COUNT),"user:first_signup"===e.evt_type&&(global.NC_COUNT=+global.NC_COUNT||1),await c.default.post("https://telemetry.nocodb.com/api/v1/telemetry",Object.assign(Object.assign({},a),{evt_type:e.evt_type,payload:Object.assign(Object.assign({},t),e||{})}))}catch(e){}})),Tele.emitter.on("evt_api_created",(async e=>{try{await b(a);const t=Object.assign(Object.assign({},a),{table_count:e.tablesCount||0,relation_count:e.relationsCount||0,view_count:e.viewsCount||0,api_count:e.apiCount||0,function_count:e.functionsCount||0,procedure_count:e.proceduresCount||0,mysql:"mysql2"===e.dbType?1:0,pg:"pg"===e.dbType?1:0,mssql:"mssql"===e.dbType?1:0,sqlite3:"sqlite3"===e.dbType?1:0,oracledb:"oracledb"===e.dbType?1:0,rest:"rest"===e.type?1:0,graphql:"graphql"===e.type?1:0,grpc:"grpc"===e.type?1:0,time_taken:e.timeTaken});if(_)return;await c.default.post("https://telemetry.nocodb.com/api/v1/telemetry/apis_created",t)}catch(e){}})),Tele.emitter.on("evt_subscribe",(async e=>{try{if(_)return;await c.default.post("https://telemetry.nocodb.com/api/v1/newsletter/sdhjh34u3yuy34bj343jhj4iwolaAdsdj3434uiut4nn",{email:e})}catch(e){}})),Tele.emitter.on("page",(async e=>{try{if(_)return;const t=await Tele.getInstanceMeta();await this.client.capture({distinctId:e.id||`${this.machineId}:public`,event:"$pageview",properties:Object.assign(Object.assign(Object.assign({},a),t),{$current_url:e.path})})}catch(e){}})),Tele.emitter.on("ph_event",(async e=>{try{if(_&&(!e.evt_type||!e.evt_type.startsWith("a:sync-request:")))return;const t=await this.getInstanceMeta();let i=e.id;i||(i=e.event&&e.event.startsWith("a:api:")?this.machineId:`${this.machineId}:public`),await this.client.capture({distinctId:i,event:e.event,properties:Object.assign(Object.assign(Object.assign({},a),t),e.data||{})})}catch(e){}}))}}catch(e){}try{this.client||(this.client=new p.default)}catch(e){}}static async getInstanceMeta(){try{return Tele.config&&Tele.config.instance&&await Tele.config.instance()||{}}catch(e){return{}}}static get id(){return this.machineId||(0,l.machineIdSync)()}static async payload(){if("test"===process.env.NODE_ENV||"development"===process.env.NODE_ENV||m.isEE)return null;const e={package_id:u.packageVersion,node_version:process.version,xc_version:process.env.NC_SERVER_UUID,env:process.env.NODE_ENV||"production",oneClick:!!process.env.NC_ONE_CLICK,disabled:_};try{e.os_type=s.default.type(),e.os_platform=s.default.platform(),e.os_release=s.default.release(),e.docker=(0,d.default)(),e.machine_id=`${this.id},,`,e.payload=Object.assign(Object.assign({},await Tele.getInstanceMeta()||{}),{count:global.NC_COUNT,upTime:Math.round(process.uptime()/3600),cache:f,litestream:g,executable:h})}catch(e){}return e}}async function b(e){let t=5;for(;t--&&!e.machine_id;)await new Promise((e=>setTimeout((()=>e(null)),500)))}if(t.Tele=Tele,process.env.NC_PUBLIC_URL&&setInterval((()=>{(0,c.default)({method:"get",url:process.env.NC_PUBLIC_URL}).then((()=>{})).catch((()=>{}))}),72e5),process.env.NC_ONE_CLICK)try{Tele.emit("evt",{evt_type:"ONE_CLICK"})}catch(e){}},45500:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(89576)),r=i(a(16512)),l=i(a(55972)),c=i(a(88556)),d=i(a(7128)),u=i(a(53748)),p=i(a(22389)),m=i(a(50588)),_=i(a(73996)),f=i(a(77172)),h=i(a(23100)),g=i(a(60860)),y=i(a(27008)),b=i(a(61632)),w=a(62304),v=a(64612),T=(0,s.default)("nc:version-upgrader");class NcUpgrader{static async upgrade(e){var t,a,i,s,l,c,d;let u;this.log("upgrade :");try{if(e.ncMeta=await e.ncMeta.startTransaction(),!await(null===(i=null===(a=null===(t=e.ncMeta.knexConnection)||void 0===t?void 0:t.schema)||void 0===a?void 0:a.hasTable)||void 0===i?void 0:i.call(a,v.MetaTable.STORE)))return;this.log("upgrade : Getting configuration from meta database");const r=await e.ncMeta.metaGet(v.RootScopes.ROOT,v.RootScopes.ROOT,v.MetaTable.STORE,{key:this.STORE_KEY}),c=this.getUpgraderList();if(r){const t=JSON.parse(r.value);if(t.version!==process.env.NC_VERSION){u=t.version;for(const a of c)if(a.name>t.version&&(this.log("upgrade : Upgrading '%s' => '%s'",t.version,a.name),await(null===(s=null==a?void 0:a.handler)||void 0===s?void 0:s.call(a,e)),r.version=a.name,await e.ncMeta.metaUpdate(v.RootScopes.ROOT,v.RootScopes.ROOT,v.MetaTable.STORE,{value:JSON.stringify({version:r.version})},{key:NcUpgrader.STORE_KEY})),a.name===process.env.NC_VERSION)break;r.version=process.env.NC_VERSION}}else{this.log("upgrade : Inserting config to meta database");const t={},a="true"!==process.env.NC_CLOUD&&(null===(l=await e.ncMeta.baseList())||void 0===l?void 0:l.length);t.version=a?"0009000":process.env.NC_VERSION,await e.ncMeta.metaInsert2(v.RootScopes.ROOT,v.RootScopes.ROOT,v.MetaTable.STORE,{key:NcUpgrader.STORE_KEY,value:JSON.stringify(t)},!0),a&&await this.upgrade(e)}await e.ncMeta.commit(),w.T.emit("evt",{evt_type:"appMigration:upgraded",from:u,to:process.env.NC_VERSION})}catch(t){throw await e.ncMeta.rollback(t),w.T.emit("evt",{evt_type:"appMigration:failed",from:u,to:process.env.NC_VERSION,msg:t.message,err:null===(d=null===(c=null==t?void 0:t.stack)||void 0===c?void 0:c.split)||void 0===d?void 0:d.call(c,"\n").slice(0,2).join("\n")}),console.log(function(e,t,a){const i=`Migration from ${t} to ${a} failed`;return(0,r.default)(`Error\n-----\n${e.stack}\n\n\nPlease raise an issue in our github by using following link : \nhttps://github.com/nocodb/nocodb/issues/new?labels=Type%3A%20Bug&template=bug_report.md\n\nOr contact us in our Discord community by following link :\nhttps://discord.gg/5RgZmkW ( message @o1lab, @pranavxc or @wingkwong )`,{title:i,padding:1,borderColor:"yellow"})}(t,u,process.env.NC_VERSION)),t}}static log(e,...t){T(`${e}`,...t)}static getUpgraderList(){return[{name:"0100002",handler:m.default},{name:"0101002",handler:l.default},{name:"0104002",handler:c.default},{name:"0104004",handler:u.default},{name:"0105002",handler:d.default},{name:"0105003",handler:p.default},{name:"0105004",handler:_.default},{name:"0107004",handler:f.default},{name:"0108002",handler:h.default},{name:"0111002",handler:g.default},{name:"0111005",handler:y.default},{name:"0225002",handler:b.default}]}}NcUpgrader.STORE_KEY="NC_CONFIG_MAIN",t.default=NcUpgrader},43124:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throwTimeoutError=function(e,t){if(["EHOSTDOWN","ETIMEDOUT","EHOSTUNREACH","ENOTFOUND","ECONNREFUSED"].includes(e.code)){let e="";throw t.connection.filename?e=t.connection.filename:t.connection.database&&t.connection.host&&t.connection.port&&(e=`${t.connection.database} (${t.connection.host}:${t.connection.port})`),new Error(`Failed to connect the database ${e} for Base ${t.baseTitle}.\n       Please fix the connection issue or remove the base before trying to upgrade.`)}}},50588:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=await e.knexConnection(s.MetaTable.FILTER_EXP);for(const a of t){const t={workspace_id:a.fk_workspace_id,base_id:a.fk_base_id};let i;if(a.fk_view_id)i=await r.default.get(t,a.fk_view_id,e);else if(a.fk_hook_id)i=await l.default.get(t,a.fk_hook_id,e);else{if(!a.fk_column_id)continue;i=await c.default.get(t,{colId:a.fk_column_id},e)}i&&(a.base_id!==i.base_id&&await e.metaUpdate(t.workspace_id,t.base_id,s.MetaTable.FILTER_EXP,{source_id:i.source_id,base_id:i.base_id},a.id))}};const s=a(64612),r=i(a(70176)),l=i(a(82568)),c=i(a(57596))},55972:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=await e.knexConnection(u.MetaTable.SOURCES);for(const a of t){const t=new d.default(a);if(!t.base_id)continue;const i={workspace_id:t.fk_workspace_id,base_id:t.base_id},m=await e.metaGet2(i.workspace_id,i.base_id,u.MetaTable.PROJECT,{id:t.base_id});if(!m)continue;const _=m.deleted,f=t.is_meta?e.knexConnection:await l.default.get(t),h=await t.getModels(i,e),g={baseTitle:m.title,connection:f.client.config.connection};for(const t of h)try{if(!await f.schema.hasTable(p(f,t)))continue;const a=[],r=await(await c.default.get(i,t.id,e)).getColumns(i,e).then((async e=>{const a=[];for(const i of e)(i.uidt===s.UITypes.Attachment||i.pk)&&await f.schema.hasColumn(p(f,t),i.column_name)&&a.push(i);return a})),l=r.filter((e=>e.uidt===s.UITypes.Attachment)).map((e=>e.column_name));if(0===l.length)continue;const d=r.filter((e=>e.pk)).map((e=>e.column_name)),u=await f(p(f,t)).select();for(const e of u)for(const i of l){let s;try{s="string"==typeof e[i]?JSON.parse(e[i]):e[i]}catch(e){}if(Array.isArray(s)&&s){const r=[];for(const e of s)if("url"in e&&"string"==typeof e.url){const t=e.url.match(/^(.*)\/download\/(.*)$/);if(t){const a=`download/${t[2]}`;r.push(Object.assign(Object.assign({},e),{path:a}))}else r.push(e)}const l=d.map((t=>({[t]:e[t]}))).reduce(((e,t)=>Object.assign(e,t)),{});a.push(await f(p(f,t)).update({[i]:JSON.stringify(r)}).where(l))}}await Promise.all(a)}catch(e){if(!_)throw(0,r.throwTimeoutError)(e,g),e}}};const s=a(71040),r=a(43124),l=i(a(82096)),c=i(a(84072)),d=i(a(16708)),u=a(64612);function p(e,t){var a,i;const s=null===(i=(a=e).searchPath)||void 0===i?void 0:i.call(a),r=e.clientType();return"mssql"===r&&s?e.raw("??.??",[s,t.table_name]).toQuery():"snowflake"===r?[e.client.config.connection.database,e.client.config.connection.schema,t.table_name].join("."):t.table_name}},88556:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=await e.knexConnection(u.MetaTable.SOURCES);for(const a of t){const t=new d.default(a);if(!t.base_id)continue;const i={workspace_id:t.fk_workspace_id,base_id:t.base_id},m=await e.metaGet2(i.workspace_id,i.base_id,u.MetaTable.PROJECT,{id:t.base_id});if(!m)continue;const _=m.deleted,f=t.is_meta?e.knexConnection:await l.default.get(t),h=await t.getModels(i,e),g={baseTitle:m.title,connection:f.client.config.connection};for(const t of h)try{if(!await f.schema.hasTable(p(f,t)))continue;const a=[],r=await(await c.default.get(i,t.id,e)).getColumns(i,e).then((async e=>{const a=[];for(const i of e)(i.uidt===s.UITypes.Attachment||i.pk)&&await f.schema.hasColumn(p(f,t),i.column_name)&&a.push(i);return a})),l=r.filter((e=>e.uidt===s.UITypes.Attachment)).map((e=>e.column_name));if(0===l.length)continue;const d=r.filter((e=>e.pk)).map((e=>e.column_name)),u=await f(p(f,t)).select();for(const e of u){const i=d.map((t=>({[t]:e[t]}))).reduce(((e,t)=>Object.assign(e,t)),{});for(const s of l)if("string"==typeof e[s])try{JSON.parse(e[s]);continue}catch(r){try{let r=e[s];r=JSON.parse(`[${r.slice(1,r.length-1)}]`);const l=[];for(const e of r)l.push(JSON.parse(e));a.push(await f(p(f,t)).update({[s]:JSON.stringify(l)}).where(i))}catch(e){continue}}}await Promise.all(a)}catch(e){if(!_)throw(0,r.throwTimeoutError)(e,g),e}}};const s=a(71040),r=a(43124),l=i(a(82096)),c=i(a(84072)),d=i(a(16708)),u=a(64612);function p(e,t){var a,i;const s=null===(i=(a=e).searchPath)||void 0===i?void 0:i.call(a),r=e.clientType();return"mssql"===r&&s?e.raw("??.??",[s,t.table_name]).toQuery():"snowflake"===r?[e.client.config.connection.database,e.client.config.connection.schema,t.table_name].join("."):t.table_name}},53748:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){await async function(e){const t=await e.knexConnection(r.MetaTable.FILTER_EXP);for(const a of t){if(!a.fk_column_id||a.is_group)continue;const t={workspace_id:a.fk_workspace_id,base_id:a.fk_base_id},i=await l.default.get(t,{colId:a.fk_column_id},e);[s.UITypes.SingleLineText,s.UITypes.LongText,s.UITypes.PhoneNumber,s.UITypes.Email,s.UITypes.URL].includes(i.uidt)?await Promise.all(p(a,e)):[s.UITypes.Duration,s.UITypes.Currency,s.UITypes.Percent,s.UITypes.Number,s.UITypes.Decimal,s.UITypes.Rating,s.UITypes.Rollup,s.UITypes.SingleSelect].includes(i.uidt)?await Promise.all([...m(a,e),..._(a,e)]):i.uidt===s.UITypes.Checkbox?await Promise.all(h(a,e)):i.uidt===s.UITypes.MultiSelect?(await Promise.all([...m(a,e),..._(a,e)]),await f(t,a,i,e)):i.uidt===s.UITypes.Attachment?await Promise.all([...p(a,e),...u(a,e),..._(a,e)]):i.uidt===s.UITypes.LinkToAnotherRecord||i.uidt===s.UITypes.Lookup?await Promise.all([...p(a,e),..._(a,e)]):i.uidt===s.UITypes.Duration&&await Promise.all([...m(a,e),..._(a,e)])}}(e),await async function(e){var t,a;const i={},s=await e.knexConnection(r.MetaTable.FILTER_EXP),l=[];for(const e of s)["notempty","notnull","empty","null"].includes(e.comparison_op)&&(i[e.base_id]=!0);const c=await e.knexConnection(r.MetaTable.PROJECT),u={showNullAndEmptyInFilter:!1};for(const s of c){const r=s.meta;let c=u;try{c=null!==(t="string"==typeof r?JSON.parse(r):r)&&void 0!==t?t:u}catch(e){}c=Object.assign(Object.assign({},c),{showNullAndEmptyInFilter:null!==(a=i[s.id])&&void 0!==a&&a}),l.push(d.default.update({workspace_id:s.fk_workspace_id,base_id:s.id},s.id,{meta:JSON.stringify(c)},e))}await Promise.all(l)}(e)};const s=a(71040),r=a(64612),l=i(a(57596)),c=i(a(22996)),d=i(a(30136)),u=(e,t)=>{const a=[];return["eq","neq"].includes(e.comparison_op)&&a.push(c.default.delete(e.id,t)),a},p=(e,t)=>{const a=[];return["gt","lt","gte","lte"].includes(e.comparison_op)&&a.push(c.default.delete(e.id,t)),a},m=(e,t)=>{const a=[];return["like","nlike"].includes(e.comparison_op)&&a.push(c.default.delete(e.id,t)),a},_=(e,t)=>{const a=[];return["empty","null"].includes(e.comparison_op)?a.push(c.default.update(e.id,{comparison_op:"blank"},t)):["notempty","notnull"].includes(e.comparison_op)&&a.push(c.default.update(e.id,{comparison_op:"notblank"},t)),a},f=async(e,t,a,i)=>{if(!["eq","neq"].includes(t.comparison_op))return;if(!t.value)return await c.default.delete(t.id,i);const s=t.value.split(","),r=await a.getColOptions(e),l=[];for(const e of s)r.options.includes(e)&&l.push(e);const d=l.join(",");if(!d)return await c.default.delete(t.id,i);const u=[];return"eq"===t.comparison_op?u.push(c.default.update(t.id,{comparison_op:"anyof",value:d},i)):"neq"===t.comparison_op&&u.push(c.default.update(t.id,{comparison_op:"nanyof",value:d},i)),await Promise.all(u)},h=(e,t)=>{const a=[],i=["true","True","1","T","Y"],s=["false","False","0","F","N"];return["empty","null"].includes(e.comparison_op)?a.push(c.default.update(e.id,{comparison_op:"notchecked"},t)):["notempty","notnull"].includes(e.comparison_op)?a.push(c.default.update(e.id,{comparison_op:"checked"},t)):"eq"===e.comparison_op?i.includes(e.value)?a.push(c.default.update(e.id,{comparison_op:"checked",value:""},t)):s.includes(e.value)?a.push(c.default.update(e.id,{comparison_op:"notchecked",value:""},t)):a.push(c.default.delete(e.id,t)):"neq"===e.comparison_op&&(s.includes(e.value)?a.push(c.default.update(e.id,{comparison_op:"checked",value:""},t)):i.includes(e.value)?a.push(c.default.update(e.id,{comparison_op:"notchecked",value:""},t)):a.push(c.default.delete(e.id,t))),a}},7128:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=await e.knexConnection(i.MetaTable.GRID_VIEW_COLUMNS),a=[...new Set(t.map((e=>e.fk_view_id)))],s=a.reduce(((e,a)=>{const i=t.find((e=>e.fk_view_id===a));return Object.assign(Object.assign({},e),{[a]:{base_id:i.base_id,workspace_id:i.fk_workspace_id}})}),{});for(const t of a){const a=s[t].base_id,r=s[t].workspace_id,l=await e.metaList2(r,a,i.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),c=[];for(const t of l){const s=await e.metaGet(r,a,i.MetaTable.COLUMNS,{id:t.fk_column_id});c.push(s)}if(!c.some((e=>e.pv))){const t=c.findIndex((e=>e.pk));t===c.length-1?t>0?await e.metaUpdate(r,a,i.MetaTable.COLUMNS,{pv:!0},c[t-1].id):c.length>0&&await e.metaUpdate(r,a,i.MetaTable.COLUMNS,{pv:!0},c[0].id):t>-1?await e.metaUpdate(r,a,i.MetaTable.COLUMNS,{pv:!0},c[t+1].id):c.length>0&&await e.metaUpdate(r,a,i.MetaTable.COLUMNS,{pv:!0},c[0].id)}const d=c.find((e=>e.pv));if(d){const t=l.find((e=>e.fk_column_id===d.id)),s=l.findIndex((e=>e.fk_column_id===d.id)),c=l.map((e=>e.order)),u=Math.min(...c);if(t.show||await e.metaUpdate(r,a,i.MetaTable.GRID_VIEW_COLUMNS,{show:!0},t.id),t.order===u&&1===c.filter((e=>e===u)).length)continue;if(0!==s){const e=l.splice(s,1);l.unshift(...e)}for(let t=0;t<l.length;t++)await e.metaUpdate(r,a,i.MetaTable.GRID_VIEW_COLUMNS,{order:t+1},l[t].id)}}};const i=a(64612)},22389:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=await e.knexConnection(r.MetaTable.FILTER_EXP);for(const a of t){if(!a.fk_column_id||a.is_group)continue;const t={workspace_id:a.fk_workspace_id,base_id:a.fk_base_id},i=await l.default.get(t,{colId:a.fk_column_id},e);[s.UITypes.Date,s.UITypes.DateTime].includes(i.uidt)?await Promise.all([...d(t,a,e),...p(t,a,e),...u(t,a,e)]):[s.UITypes.Time,s.UITypes.Year].includes(i.uidt)&&await Promise.all([...d(t,a,e),...p(t,a,e)])}};const s=a(71040),r=a(64612),l=i(a(57596)),c=i(a(22996));function d(e,t,a){const i=[];return["like","nlike"].includes(t.comparison_op)&&i.push(c.default.delete(e,t.id,a)),i}function u(e,t,a){const i=[];return["eq","neq"].includes(t.comparison_op)&&i.push(c.default.update(e,t.id,{comparison_sub_op:"exactDate"},a)),i}function p(e,t,a){const i=[];return["empty","null"].includes(t.comparison_op)?i.push(c.default.update(e,t.id,{comparison_op:"blank"},a)):["notempty","notnull"].includes(t.comparison_op)&&i.push(c.default.update(e,t.id,{comparison_op:"notblank"},a)),i}},73996:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=[],a=await e.knexConnection(i.MetaTable.HOOKS);for(const s of a)t.push(e.metaUpdate(s.fk_workspace_id,s.base_id,i.MetaTable.HOOKS,{version:"v1"},s.id));await Promise.all(t)};const i=a(64612)},77172:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=[],a=await e.knexConnection(l.MetaTable.SOURCES);for(const i of a){let a;const l={workspace_id:i.fk_workspace_id,base_id:i.id};try{a=JSON.parse(s.default.AES.decrypt(i.config,c).toString(s.default.enc.Utf8)),t.push(r.Source.update(l,i.id,{id:i.id,config:a},e))}catch(e){}}await Promise.all(t)};const s=i(a(8608)),r=a(19684),l=a(64612),c="temporary-key"},23100:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){var t,a;const i=await e.knexConnection(r.MetaTable.SOURCES).where({is_meta:1});if(!i.length)return;const s=await d.default.getSqlClient(new c.Source(i[0]),e.knex),l=null===(a=null===(t=await s.relationListAll())||void 0===t?void 0:t.data)||void 0===a?void 0:a.list;for(const t of i){const a={workspace_id:t.fk_workspace_id,base_id:t.id};await _(a,{ncMeta:e,source:new c.Source(t),relations:l})}};const s=a(71040),r=a(64612),l=i(a(57804)),c=a(19684),d=i(a(82096)),u=a(64612),p=a(19684);async function m(e,{model:t,relations:a,ncMeta:i,sqlClient:c}){for(const d of await t.getColumns(e,i)){if(d.uidt!==s.UITypes.LinkToAnotherRecord)continue;const t=await d.getColOptions(e,i);if(!t)continue;switch(t.type){case s.RelationTypes.HAS_MANY:{if(t.virtual)break;const s=await t.getParentColumn(e,i),r=await t.getChildColumn(e,i),l=await s.getModel(e,i),d=await r.getModel(e,i),u=a.find((e=>s.column_name===e.rcn&&r.column_name===e.cn&&l.table_name===e.rtn&&d.table_name===e.tn));if(u&&(await c.relationDelete({parentColumn:u.rcn,childColumn:u.cn,parentTable:u.rtn,childTable:u.tn,foreignKeyName:u.cstn}),"pg"!==i.knex.clientType())){const e={columns:[u.cn],tn:u.tn,non_unique:!0};await c.indexCreate(e)}}}await i.metaUpdate(e.workspace_id,e.base_id,r.MetaTable.COL_RELATIONS,{virtual:!0},t.id);const p=await l.default.get(`${u.CacheScope.COL_RELATION}:${t.fk_column_id}`,u.CacheGetType.TYPE_OBJECT);p&&(p.virtual=!0,await l.default.set(`${u.CacheScope.COL_RELATION}:${t.fk_column_id}`,p))}}async function _(e,{ncMeta:t,source:a,relations:i}){const s=await d.default.getSqlClient(a,t.knex),l=await t.metaList2(e.workspace_id,e.base_id,r.MetaTable.MODELS);for(const a of l)await m(e,{ncMeta:t,model:new p.Model(a),sqlClient:s,relations:i})}},60860:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){p.log("Starting upgrade for LTAR relations in XCDB sources to add missing index");const t=await e.knexConnection(l.MetaTable.SOURCES).where({is_meta:1});if(!t.length)return;for(const a of t){const t=new c.Source(a),i={workspace_id:t.fk_workspace_id,base_id:t.id};if("pg"!==e.knex.clientType())continue;const s=await t.getProject(i,e);s&&!s.deleted&&(p.log(`Upgrading source '${t.alias}'(${s.title})`),await _(i,{ncMeta:e,source:t}),p.log(`Upgraded source '${t.alias}'(${s.title})`))}p.log("Finished upgrade for LTAR relations in XCDB sources to add missing index")};const s=a(23324),r=a(71040),l=a(64612),c=a(19684),d=i(a(82096)),u=a(19684),p=new s.Logger("LTARIndexUpgrader");async function m(e,{model:t,indexes:a,ncMeta:i,sqlClient:s}){for(const l of await t.getColumns(e,i)){if(l.uidt!==r.UITypes.LinkToAnotherRecord)continue;const t=await l.getColOptions(e,i);if(t&&t.type===r.RelationTypes.BELONGS_TO){const r=await t.getChildColumn(e,i),l=await r.getModel(e,i);if(a.find((e=>e.cn===r.column_name)))continue;p.log(`Creating index for column '${r.column_name}'`);const c={columns:[r.column_name],tn:l.table_name,non_unique:!0};try{await s.indexCreate(c)}catch(e){if(!/relation "?.+"? already exists/i.test(e.message))throw e}}}}async function _(e,{ncMeta:t,source:a}){var i,s;const r=await d.default.getSqlClient(a,t.knex),c=await t.metaList2(e.workspace_id,e.base_id,l.MetaTable.MODELS);for(const a of c){p.log(`Upgrading model '${a.title}'`),p.log(`Fetching index list of model '${a.title}'`);const l=null!==(s=null===(i=(await r.indexList({tn:a.table_name})).data)||void 0===i?void 0:i.list)&&void 0!==s?s:[],c=l.filter(((e,t)=>l.every(((a,i)=>t===i||a.key_name!==e.key_name))));await m(e,{ncMeta:t,model:new u.Model(a),sqlClient:r,indexes:c}),p.log(`Upgraded model '${a.title}'`)}}},27008:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){const t=await e.knexConnection(l.MetaTable.SOURCES).condition({_or:[{is_meta:{eq:1}},...r.default.isEE()?[{is_local:{eq:1}}]:[]]}),a=new h.default;await Promise.all(t.map((async(i,r)=>{const l=new c.Source(i),h={workspace_id:l.fk_workspace_id,base_id:l.base_id},y=await l.getProject(h,e);return!y||y.deleted?(g.log(`Skipped deleted base source '${l.alias||l.id}' - ${null==y?void 0:y.id}`),Promise.resolve()):a.enqueue((async()=>{const a=await c.Model.list(h,{base_id:l.base_id,source_id:l.id},e);for(const t of a)await t.getColumns(h,e);g.log(`Upgrading base ${y.title}(${y.id},${l.id}) (${r+1}/${t.length})`),await async function({ncMeta:e,source:t,base:a,models:i}){const r={workspace_id:a.fk_workspace_id,base_id:a.id},l=await _.default.getSqlClient(t,e.knex),h=p.default.getSqlMgr(r,{id:t.base_id},e);await Promise.all(i.map((async i=>{var p,_,y,b;if(!i.mm)try{const w=i.columns,v=w.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name})));let T=!1,k=!1,S=!1,M=!1;for(const t of w)[s.UITypes.DateTime,s.UITypes.CreatedTime,s.UITypes.LastModifiedTime,s.UITypes.CreatedBy,s.UITypes.LastModifiedBy].includes(t.uidt)&&(t.uidt===s.UITypes.CreatedBy&&t.system?S=!0:t.uidt===s.UITypes.LastModifiedBy&&t.system?M=!0:[s.UITypes.CreatedBy,s.UITypes.LastModifiedBy].includes(t.uidt)||(t.uidt===s.UITypes.CreatedTime&&t.system?T=!0:t.uidt===s.UITypes.LastModifiedTime&&t.system?k=!0:("created_at"===t.column_name&&(T=!0,t.uidt===s.UITypes.CreatedTime&&t.system||await c.Column.update(r,t.id,Object.assign(Object.assign({},t),{uidt:s.UITypes.CreatedTime,system:!0}),e,!0)),"updated_at"===t.column_name&&(k=!0,t.uidt===s.UITypes.LastModifiedTime&&t.system||await c.Column.update(r,t.id,Object.assign(Object.assign({},t),{uidt:s.UITypes.LastModifiedTime,system:!0}),e,!0)))));if(T&&k&&S&&M)return;const O=(null===(b=null===(y=null===(_=await l.columnList({tn:i.table_name,schema:null===(p=t.getConfig())||void 0===p?void 0:p.schema}))||void 0===_?void 0:_.data)||void 0===y?void 0:y.list)||void 0===b?void 0:b.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn}))))||[];if(!O.length)return void g.log(`Skipping upgrade of model '${i.title}'(${i.id}) from base '${a.title}'(${a.id}}) since columns not found`);const I=[],C=[];if(!T){const e=(0,d.getUniqueColumnName)(w,"created_at"),a=O.find((t=>t.cn===e));a&&(0,f.default)(t,a)===s.UITypes.DateTime?C.push(Object.assign(Object.assign({},a),{uidt:s.UITypes.CreatedTime,column_name:e,title:(0,d.getUniqueColumnAliasName)(w,"CreatedAt"),system:!0})):I.push(Object.assign(Object.assign({},await(0,u.default)({uidt:s.UITypes.CreatedTime,column_name:(0,d.getUniqueColumnName)([...w,...O],"created_at"),title:(0,d.getUniqueColumnAliasName)(w,"CreatedAt")},t)),{cdf:null,system:!0,altered:m.Altered.NEW_COLUMN}))}if(!k){const e=(0,d.getUniqueColumnName)(w,"created_at"),a=O.find((t=>t.cn===e));a&&(0,f.default)(t,a)===s.UITypes.DateTime?C.push(Object.assign(Object.assign({uidt:s.UITypes.LastModifiedTime},a),{column_name:e,title:(0,d.getUniqueColumnAliasName)(w,"UpdatedAt"),system:!0})):I.push(Object.assign(Object.assign({},await(0,u.default)({uidt:s.UITypes.LastModifiedTime,column_name:(0,d.getUniqueColumnName)([...w,...O],"updated_at"),title:(0,d.getUniqueColumnAliasName)(w,"UpdatedAt")},t)),{cdf:null,system:!0,altered:m.Altered.NEW_COLUMN}))}if(!S){const e=(0,d.getUniqueColumnName)(w,"created_by"),a=O.find((t=>t.cn===e));a?C.push(Object.assign(Object.assign({uidt:s.UITypes.CreatedBy},a),{column_name:e,title:(0,d.getUniqueColumnAliasName)(w,"nc_created_by"),system:!0})):I.push(Object.assign(Object.assign({},await(0,u.default)({uidt:s.UITypes.CreatedBy,column_name:(0,d.getUniqueColumnName)([...w,...O],"created_by"),title:(0,d.getUniqueColumnAliasName)(w,"nc_created_by")},t)),{cdf:null,system:!0,altered:m.Altered.NEW_COLUMN}))}if(!M){const e=(0,d.getUniqueColumnName)(w,"updated_by"),a=O.find((t=>t.cn===e));a?C.push(Object.assign(Object.assign({uidt:s.UITypes.LastModifiedBy},a),{column_name:e,title:(0,d.getUniqueColumnAliasName)(w,"nc_updated_by"),system:!0})):I.push(Object.assign(Object.assign({},await(0,u.default)({uidt:s.UITypes.LastModifiedBy,column_name:(0,d.getUniqueColumnName)([...w,...O],"updated_by"),title:(0,d.getUniqueColumnAliasName)(w,"nc_updated_by")},t)),{cdf:null,system:!0,altered:m.Altered.NEW_COLUMN}))}if(I.length){const e=Object.assign(Object.assign({},i),{tn:i.table_name,originalColumns:v,columns:[...w,...I].map((e=>Object.assign(Object.assign({},e),{cn:e.column_name})))});await h.sqlOpPlus(t,"tableUpdate",e)}for(const t of[...C,...I])await c.Column.insert(r,Object.assign(Object.assign({},t),{system:!0,fk_model_id:i.id}),e)}catch(e){throw g.error(`Upgrading model '${i.title}'(${i.id}) from base '${a.title}'(${a.id}}) failed`),e}})))}({ncMeta:e,source:l,models:a,base:y}).then((()=>{g.log(`Upgraded base '${y.title}'(${y.id},${l.id}) (${r+1}/${t.length})`)}))}))})))};const s=a(71040),r=i(a(76584)),l=a(64612),c=a(19684),d=a(98644),u=i(a(66368)),p=i(a(93260)),m=a(74056),_=i(a(82096)),f=i(a(47724)),h=i(a(45840)),g={log:e=>{console.log(`[ncXcdbCreatedAndUpdatedSystemFieldsUpgrader ${Date.now()}] `+e)},error:e=>{console.error(`[ncXcdbCreatedAndUpdatedSystemFieldsUpgrader ${Date.now()}] `+e)}}},61632:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({ncMeta:e}){var t;l.log("Starting decryption of sources and integrations");let a=process.env.NC_AUTH_JWT_SECRET,i=null;const s=null===(t=await e.metaGet(r.RootScopes.ROOT,r.RootScopes.ROOT,r.MetaTable.STORE,{key:"nc_auth_jwt_secret"}))||void 0===t?void 0:t.value;a?i=s:a=s;if(process.env.NC_CONNECTION_ENCRYPT_KEY&&process.env.NC_CONNECTION_ENCRYPT_KEY===a)return l.log("Encryption key is same as previous. Skipping decryption"),await e.knexConnection(r.MetaTable.SOURCES).update({is_encrypted:!0}),void await e.knexConnection(r.MetaTable.INTEGRATIONS).update({is_encrypted:!0});if(!a)throw Error("Encryption key not found");const d=await e.knexConnection(r.MetaTable.SOURCES),u=[];for(const t of d)if(null==t?void 0:t.config)try{const s=await c({encryptedConfig:t.config,secret:a,fallbackSecret:i,fallbackToNullIfFailed:t.is_meta});await e.knexConnection(r.MetaTable.SOURCES).update({config:s}).where("id",t.id),l.log(`Decrypted source ${t.id}`),t.is_meta||u.push(!0)}catch(e){l.error(`Failed to decrypt source ${t.id}`),u.push(!1)}const p=await e.knexConnection(r.MetaTable.INTEGRATIONS);for(const t of p)if(null==t?void 0:t.config)try{const s=await c({encryptedConfig:t.config,secret:a,fallbackSecret:i});await e.knexConnection(r.MetaTable.INTEGRATIONS).update({config:s}).where("id",t.id),l.log(`Decrypted integration ${t.id}`),u.push(!0)}catch(e){l.error(`Failed to decrypt integration ${t.id}`),u.push(!1)}if(u.length>0&&u.every((e=>!e)))throw new Error("Failed to decrypt any source or integration. Please configure correct encryption key.");l.log(`Decrypted ${u.length} sources and integrations`)};const s=i(a(8608)),r=a(64612),l={log:e=>{console.log(`[0225002_ncDatasourceDecrypt ${Date.now()}] `+e)},error:e=>{console.error(`[0225002_ncDatasourceDecrypt ${Date.now()}] `+e)}},c=async({encryptedConfig:e,secret:t,fallbackSecret:a,fallbackToNullIfFailed:i=!1})=>{if(!e)return e;try{const a=s.default.AES.decrypt(e,t).toString(s.default.enc.Utf8);let i;try{i=JSON.parse(a)}catch(e){throw new Error(`JSON parse failed: ${e.message}`)}return null===i?null:a}catch(t){if(a)return l.log("Retrying decryption with a fallback mechanism"),c({encryptedConfig:e,secret:a});if(i)return null;throw t}}},94760:e=>{"use strict";e.exports=require("@aws-sdk/client-s3")},2208:e=>{"use strict";e.exports=require("@aws-sdk/client-ses")},21816:e=>{"use strict";e.exports=require("@aws-sdk/lib-storage")},20500:e=>{"use strict";e.exports=require("@aws-sdk/s3-request-presigner")},31808:e=>{"use strict";e.exports=require("@google-cloud/storage")},42736:e=>{"use strict";e.exports=require("@nestjs/bull")},23324:e=>{"use strict";e.exports=require("@nestjs/common")},16184:e=>{"use strict";e.exports=require("@nestjs/config")},98496:e=>{"use strict";e.exports=require("@nestjs/core")},87412:e=>{"use strict";e.exports=require("@nestjs/core/helpers/execution-context-host")},40628:e=>{"use strict";e.exports=require("@nestjs/event-emitter")},70816:e=>{"use strict";e.exports=require("@nestjs/passport")},17376:e=>{"use strict";e.exports=require("@nestjs/platform-express")},34816:e=>{"use strict";e.exports=require("@nestjs/platform-socket.io")},74272:e=>{"use strict";e.exports=require("@nestjs/throttler")},58208:e=>{"use strict";e.exports=require("@nestjs/websockets")},62192:e=>{"use strict";e.exports=require("@ntegral/nestjs-sentry")},86814:e=>{"use strict";e.exports=require("airtable")},57072:e=>{"use strict";e.exports=require("ajv")},32904:e=>{"use strict";e.exports=require("ajv-formats")},14940:e=>{"use strict";e.exports=require("auto-bind")},71178:e=>{"use strict";e.exports=require("axios")},31920:e=>{"use strict";e.exports=require("bcryptjs")},16512:e=>{"use strict";e.exports=require("boxen")},80344:e=>{"use strict";e.exports=require("bull")},40274:e=>{"use strict";e.exports=require("clear")},98904:e=>{"use strict";e.exports=require("colors")},99072:e=>{"use strict";e.exports=require("compare-versions")},20112:e=>{"use strict";e.exports=require("content-disposition")},11068:e=>{"use strict";e.exports=require("cookie-parser")},8608:e=>{"use strict";e.exports=require("crypto-js")},86682:e=>{"use strict";e.exports=require("dataloader")},44578:e=>{"use strict";e.exports=require("dayjs")},69696:e=>{"use strict";e.exports=require("dayjs/plugin/isBetween")},33976:e=>{"use strict";e.exports=require("dayjs/plugin/isSameOrAfter")},41624:e=>{"use strict";e.exports=require("dayjs/plugin/isSameOrBefore")},76070:e=>{"use strict";e.exports=require("dayjs/plugin/timezone")},51718:e=>{"use strict";e.exports=require("dayjs/plugin/utc")},91198:e=>{"use strict";e.exports=require("dayjs/plugin/utc.js")},89576:e=>{"use strict";e.exports=require("debug")},46520:e=>{"use strict";e.exports=require("dotenv")},58016:e=>{"use strict";e.exports=require("ejs")},28010:e=>{"use strict";e.exports=require("emittery")},79224:e=>{"use strict";e.exports=require("express")},68920:e=>{"use strict";e.exports=require("fast-levenshtein")},5114:e=>{"use strict";e.exports=require("glob")},59146:e=>{"use strict";e.exports=require("handlebars")},42496:e=>{"use strict";e.exports=require("inflection")},44696:e=>{"use strict";e.exports=require("ioredis")},22840:e=>{"use strict";e.exports=require("ioredis-mock")},54048:e=>{"use strict";e.exports=require("is-docker")},68552:e=>{"use strict";e.exports=require("isomorphic-dompurify")},91856:e=>{"use strict";e.exports=require("jsep")},50162:e=>{"use strict";e.exports=require("jsonfile")},82480:e=>{"use strict";e.exports=require("jsonwebtoken")},50536:e=>{"use strict";e.exports=require("knex")},72208:e=>{"use strict";e.exports=require("lodash/find")},11982:e=>{"use strict";e.exports=require("lodash/findIndex")},62036:e=>{"use strict";e.exports=require("lodash/groupBy")},90922:e=>{"use strict";e.exports=require("lodash/isEmpty")},96964:e=>{"use strict";e.exports=require("lodash/mapKeys")},49718:e=>{"use strict";e.exports=require("mailersend")},13294:e=>{"use strict";e.exports=require("mime/lite")},60960:e=>{"use strict";e.exports=require("minio")},75058:e=>{"use strict";e.exports=require("mkdirp")},34552:e=>{"use strict";e.exports=require("multer")},92080:e=>{"use strict";e.exports=require("nanoid")},30130:e=>{"use strict";e.exports=require("nc-lib-gui")},71040:e=>{"use strict";e.exports=require("nocodb-sdk")},66808:e=>{"use strict";e.exports=require("nodemailer")},54784:e=>{"use strict";e.exports=require("object-hash")},19776:e=>{"use strict";e.exports=require("object-sizeof")},27216:e=>{"use strict";e.exports=require("p-queue")},5520:e=>{"use strict";e.exports=require("papaparse")},12320:e=>{"use strict";e.exports=require("parse-database-url")},17440:e=>{"use strict";e.exports=require("passport-custom")},2736:e=>{"use strict";e.exports=require("passport-google-oauth20")},57682:e=>{"use strict";e.exports=require("passport-http")},65528:e=>{"use strict";e.exports=require("passport-jwt")},77682:e=>{"use strict";e.exports=require("passport-local")},36560:e=>{"use strict";e.exports=require("pg")},1384:e=>{"use strict";e.exports=require("request-filtering-agent")},95396:e=>{"use strict";e.exports=require("request-ip")},40224:e=>{"use strict";e.exports=require("rxjs")},26516:e=>{"use strict";e.exports=require("sharp")},92696:e=>{"use strict";e.exports=require("slash")},82160:e=>{"use strict";e.exports=require("socket.io")},69176:e=>{"use strict";e.exports=require("sqlite3")},48616:e=>{"use strict";e.exports=require("tinycolor2")},50280:e=>{"use strict";e.exports=require("twilio")},81104:e=>{"use strict";e.exports=require("uuid")},33848:e=>{"use strict";e.exports=require("validator")},26360:e=>{"use strict";e.exports=require("validator/lib/isEmail")},42056:e=>{"use strict";e.exports=require("xlsx")},84368:e=>{"use strict";e.exports=require("child_process")},87968:e=>{"use strict";e.exports=require("crypto")},90467:e=>{"use strict";e.exports=require("events")},2058:e=>{"use strict";e.exports=require("fs")},88558:e=>{"use strict";e.exports=require("os")},67072:e=>{"use strict";e.exports=require("path")},76520:e=>{"use strict";e.exports=require("process")},48378:e=>{"use strict";e.exports=require("stream")},98680:e=>{"use strict";e.exports=require("string_decoder")},78716:e=>{"use strict";e.exports=require("url")},50970:e=>{"use strict";e.exports=require("util")},73132:e=>{"use strict";e.exports=JSON.parse('{"openapi":"3.1.0","x-stoplight":{"id":"qiz1rcfqd2jy6"},"info":{"title":"nocodb","version":"1.0","description":"NocoDB API Documentation"},"x-tagGroups":[{"name":"Auth APIs","tags":["Auth","API Token"]},{"name":"Public APIs","tags":["Public"]},{"name":"Data APIs","tags":["DB Table Row","DB View Row","Storage"]},{"name":"Meta APIs","tags":["Source","DB Table","DB Table Column","DB Table Filter","DB Table Sort","DB Table Webhook","DB Table Webhook Filter","DB View","DB View Column","DB View Share","Plugin","Base","Utils"]},{"name":"Organisation APIs","tags":["Org App Settings","Org License","Org Tokens","Org Users"]}],"servers":[{"url":"http://localhost:8080"}],"paths":{"/api/v1/user/profile":{"patch":{"summary":"Update User Profile","operationId":"user-profile-update","responses":{"200":{"$ref":"#/components/schemas/User"}},"tags":["User profile"],"description":"Update User Profile","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}}},"/api/v1/auth/user/signup":{"post":{"summary":"Signup","operationId":"auth-signup","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","description":"The signed JWT token for information exchange","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}},"examples":{"Example 1":{"value":{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}}}}},"400":{"description":"Bad Request","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string"}}},"examples":{"Invalid email":{"value":{"msg":"Invalid email"}},"Invalid invite url":{"value":{"msg":"Invalid invite url"}},"Expired invite url":{"value":{"msg":"Expired invite url, Please contact super admin to get a new invite url"}},"User already exist":{"value":{"msg":"User already exist"}},"Invite only signup":{"value":{"msg":"Not allowed to signup, contact super admin"}}}}}}},"tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignUpReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","password":"password123456789","firstname":"Alice","lastname":"Smith","token":null,"ignore_subscribe":0}}}}}},"description":"Create a new user with provided email and password and first user is marked as super admin. "}},"/api/v1/auth/user/signout":{"post":{"summary":"Signout","operationId":"auth-signout","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","description":"Success Message","example":"Signed out successfully"}}},"examples":{"Example 1":{"value":{"msg":"Signed out successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Clear refresh token from the database and cookie."},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/user/signin":{"post":{"summary":"Signin","operationId":"auth-signin","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","description":"The signed JWT token for information exchange","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}},"examples":{"Example 1":{"value":{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignInReq"},"examples":{"example-1":{"value":{"email":"user@example.com","password":"Password"}}}}}},"description":"Authenticate existing user with their email and password. Successful login will return a JWT access-token. "},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/user/me":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get User Info","operationId":"auth-me","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserInfo"},"examples":{"example-1":{"value":{"id":"us_8kugj628ebjngs","email":"user@example.com","email_verified":true,"firstname":"Alice","lastname":"Smith","roles":"org-level-viewer"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Returns authenticated user info","parameters":[{"schema":{"$ref":"#/components/schemas/Id"},"in":"query","name":"base_id","description":"Pass base id to get base specific roles along with user info"}]}},"/api/v1/auth/password/forgot":{"post":{"summary":"Forget Password","operationId":"auth-password-forgot","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"q9s5vh2i34x6c"},"example":"Please check your email to reset the password","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"Please check your email to reset the password"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Emails user with a reset url.","tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordForgotReq"},"examples":{"Example 1":{"value":{"email":"user@example.com"}}}}},"description":"Pass registered user email id in request body"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/password/change":{"post":{"summary":"Change Password","operationId":"auth-password-change","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","description":"Success Message"}}},"examples":{"Success response":{"value":{"msg":"Password has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Change password of authenticated user with a new one.","tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordChangeReq"},"examples":{"example-1":{"value":{"currentPassword":"currentPassword","newPassword":"newPassword"}}}}},"description":"Old password need to be passed along with new password for changing password."}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/token/validate/{token}":{"post":{"summary":"Verify Reset Token","operationId":"auth-password-reset-token-validate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"unxdsok22kg1y"},"example":"Token has been validated successfully","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"Token has been validated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Validate password reset url token.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"name":"token","in":"path","required":true,"description":"Reset Token"}]},"/api/v1/auth/email/validate/{token}":{"post":{"summary":"Verify Email","operationId":"auth-email-validate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"u49sbr20s9rgf"},"description":"Success Message","example":"Email has been verified successfully"}}},"examples":{"Example 1":{"value":{"msg":"Email has been verified successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Api for verifying email where token need to be passed which is shared to user email.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"name":"token","in":"path","required":true,"description":"Validation Token"}]},"/api/v1/auth/password/reset/{token}":{"post":{"summary":"Reset Password","operationId":"auth-password-reset","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"2to6ro4121rfx"},"description":"Success Message","example":"Password has been reset successfully"}}},"examples":{"Example 1":{"value":{"msg":"Password has been reset successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Update user password to new by using reset token.","tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordResetReq"},"examples":{"Example 1":{"value":{"password":"newpassword"}}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"name":"token","in":"path","required":true,"description":"Reset Password Token"}]},"/api/v1/auth/token/refresh":{"post":{"summary":"Refresh Token","operationId":"auth-token-refresh","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","description":"New JWT auth token for user","example":"96751db2d53fb834382b682268874a2ea9ee610e4d904e688d1513f11d3c30d62d36d9e05dec0d63"}}},"examples":{"Example 1":{"value":{"token":"96751db2d53fb834382b682268874a2ea9ee610e4d904e688d1513f11d3c30d62d36d9e05dec0d63"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Creates a new refresh token and JWT auth token for the user. The refresh token is sent as a cookie, while the JWT auth token is included in the response body.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/tokens":{"get":{"summary":"List Organisation API Tokens","operationId":"org-tokens-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenList"},"examples":{"Example 1":{"value":{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all organisation API tokens.  Access with API tokens will be blocked.","tags":["Org Tokens"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create Organisation API Token","operationId":"org-tokens-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiToken"},"examples":{"Example 1":{"value":{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenReq"},"examples":{"Example 1":{"value":{"description":"This API token is for ABC application"}}}}}},"tags":["Org Tokens"],"description":"Creat an organisation API token. Access with API tokens will be blocked."}},"/api/v1/tokens/{tokenId}":{"parameters":[{"schema":{"type":"string"},"name":"tokenId","in":"path","required":true,"description":"API Token ID"}],"delete":{"summary":"Delete Organisation API Tokens","operationId":"org-tokens-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Tokens"],"description":"Delete an organisation API token. Access with API tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/license":{"get":{"summary":"Get App License","operationId":"org-license-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"key":{"type":"string","description":"Application license key"}}},"examples":{"Example 1":{"value":{"key":"195f7bcc-c3e1-43c5-b23c-8d8127280e7d"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the application license key. Exclusive for super admin.","tags":["Org License"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create App License","operationId":"org-license-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"wsiywigeb9hjl"},"example":"The license key has been saved"}}},"examples":{"Example 1":{"value":{"msg":"The license key has been saved"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LicenseReq"},"examples":{"Example 1":{"value":{"key":"1234567890"}}}}}},"tags":["Org License"],"description":"Set the application license key. Exclusive for super admin.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/app-settings":{"get":{"summary":"Get App Settings","operationId":"org-app-settings-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"invite_only_signup":{"type":"boolean","description":"Status of invite only signup","example":true}}},"examples":{"Example 1":{"value":{"invite_only_signup":true}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the application settings. Exclusive for super admin.","tags":["Org App Settings"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create App Settings","operationId":"org-app-settings-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"6qbh8ijtc4tva"},"example":"The app settings have been saved"}}},"examples":{"Example 1":{"value":{"msg":"The app settings have been saved"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"invite_only_signup":{"type":"boolean","description":"Status of invite only signup","example":true}}},"examples":{"Example 1":{"value":{"invite_only_signup":true}}}}}},"tags":["Org App Settings"],"description":"Update the application settings. Exclusive for super admin.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/users":{"get":{"summary":"List Organisation Users","operationId":"org-users-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserList"},"examples":{"Example 1":{"value":{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all organisation users. Exclusive for Super Admin. Access with API Tokens will be blocked.","tags":["Org Users"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create Organisation User","operationId":"org-users-add","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"invite_token":"c22c129f-d947-4030-a838-1b498fce21bb","email":"w123@nocodb.com"}},"properties":{"invite_token":{"type":"string","description":"Invite Token"},"email":{"type":"string","description":"User email","example":"user@example.com"}}},"examples":{"Example 1":{"value":{"invite_token":"c22c129f-d947-4030-a838-1b498fce21bb","email":"user@example.com"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrgUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"org-level-creator"}}}}}},"tags":["Org Users"],"description":"Create an organisation user. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/users/{userId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"patch":{"summary":"Update Organisation User","operationId":"org-users-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"6oa45bkw7j57j"},"example":"The user has been updated successfully"}}},"examples":{"Example 1":{"value":{"msg":"The user has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Users"],"description":"Update an organisation user by User ID. Exclusive for Super Admin. Access with API Tokens will be blocked.","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrgUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"org-level-creator"}}}}},"description":""}},"delete":{"summary":"Delete Organisation User","operationId":"org-users-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"buvrqjvv255tf"},"example":"The user has been deleted successfully","description":"Sucess Message"}}},"examples":{"Example 1":{"value":{"msg":"The user has been deleted successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Users"],"description":"Delete an organisation user by User ID. Exclusive for Super Admin. Access with API Tokens will be blocked."}},"/api/v1/users/{username}":{"parameters":[{"schema":{"type":"string"},"name":"username","in":"path","required":true}],"get":{"summary":"Organisation User GetByUsername","operationId":"org-users-get-by-username","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}},"tags":["Org users"],"description":"Organisation User GetByUsername"}},"/api/v1/users/{userId}/resend-invite":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"post":{"summary":"Invite Organisation User","operationId":"org-users-resend-invite","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"aixfqd9jfh5pq"},"example":"The invitation has been sent to the target user","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"The invitation has been sent to the target user"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Users"],"description":"Resend Invitation to a specific user. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/users/{userId}/profile":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true}],"post":{"summary":"Organisation User Profile - Create","operationId":"org-users-profile-create","responses":{"200":{"description":"OK"}},"tags":["Org users"],"description":"Create Organisation User Profile","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}},"get":{"summary":"Organisation User Profile - Get","operationId":"org-users-profile-get","responses":{"200":{"description":"OK"}},"description":"Get Organisation User Profile","tags":["Org users"]},"patch":{"summary":"","operationId":"org-users-profile-update","responses":{"200":{"description":"OK"}},"description":"Update Organisation User Profile\\n","tags":["Org users"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}}},"/api/v1/users/{userId}/follower":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true}],"post":{"summary":"Organisation User Follower - Create","operationId":"org-users-follower-create","responses":{"200":{"description":"OK"}},"tags":["Org users"],"description":"Create Organisation User Follower Relationship (Follow)","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Follower"}}}}},"get":{"summary":"Organisation User Follower - List","operationId":"org-users-follower-list","responses":{"200":{"description":"OK"}},"description":"List Organisation User Followers","tags":["Org users"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Follower"}}}}},"delete":{"summary":"Organisation User Follower - Delete","operationId":"org-users-follower-delete","responses":{"200":{"description":"OK"}},"tags":["Org users"],"description":"Delete Organisation User Follower Relationship (Unfollow)","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Follower"}}},"description":""}}},"/api/v1/users/{userId}/following":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true}],"get":{"summary":"Organisation User Following - List","operationId":"org-users-following-list","responses":{"200":{"description":"OK"}},"description":"List Organisation User Following","tags":["Org users"]}},"/api/v1/users/{userId}/isFollowing/{followerId}":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true},{"schema":{"type":"string"},"name":"followerId","in":"path","required":true}],"get":{"summary":"Organisation User IsFollowing","operationId":"org-users-is-following","responses":{"200":{"description":"OK"}},"description":"Check if Organisation User is following someone","tags":["Org users"]}},"/api/v1/users/{userId}/generate-reset-url":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"post":{"summary":"Generate Organisation User Password Reset Token","operationId":"org-users-generate-password-reset-token","tags":["Org Users"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"reset_password_token":{"type":"string","description":"Password Reset Token for the user"},"reset_password_url":{"type":"string","description":"Password Reset URL for the user"}}},"examples":{"Example 1":{"value":{"reset_password_token":"string","reset_password_url":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Generate Password Reset Token for Organisation User. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/users":{"get":{"summary":"List Base Users","operationId":"auth-base-user-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"users":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/User"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]}}},"examples":{"Example 1":{"value":{"users":{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all users in the given base.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"post":{"summary":"Create Base User","operationId":"auth-base-user-add","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"waau9tvy75zsd"},"description":"Success Message for inviting single email","example":"The user has been invited successfully"},"invite_token":{"type":"string","x-stoplight":{"id":"yx0s35u8ds3p7"},"example":"8354ddba-a769-4d64-8397-eccb2e2b3c06"},"error":{"type":"array","x-stoplight":{"id":"yhfi6wzhr6zr1"},"items":{"x-stoplight":{"id":"ce0hlv3d0f96j"},"type":"object","properties":{"email":{"type":"string","x-stoplight":{"id":"dgnh01j4lxvl1"},"example":"w@nocodb.com"},"error":{"type":"string","x-stoplight":{"id":"7dgttqiijg8no"},"example":"<ERROR_MESSAGE>"}}}},"email":{"type":"string","x-stoplight":{"id":"08pqst2q30vot"},"example":"w@nocodb.com"}}},"examples":{"Inviting a user without any errors":{"value":{"msg":"The user has been invited successfully"}},"Inviting a user but invitation email failed to send":{"value":{"invite_token":"8354ddba-a769-4d64-8397-eccb2e2b3c06","email":"w@nocodb.com"}},"Inviting multiple users":{"value":{"invite_token":"8354ddba-a769-4d64-8397-eccb2e2b3c06","error":[{"email":"w@nocodb.com","error":"<ERROR MESSAGE>"}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"owner"}}}}}},"tags":["Auth"],"description":"Create a user and add it to the given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/info":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"Get Base info","operationId":"base-meta-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"Node":{"type":"string","description":"Node version","example":"v12.16.1"},"Arch":{"type":"string","description":"Architecture type","example":"x64"},"Platform":{"type":"string","description":"Platform type","example":"linux"},"Docker":{"type":"boolean","description":"Is docker","example":false},"Database":{"type":"string","description":"Database type","example":"postgres"},"ProjectOnRootDB":{"type":"boolean","description":"Is base on rootdb","example":false},"RootDB":{"type":"string","description":"Root database type","example":"postgres"},"PackageVersion":{"type":"string","description":"Package version","example":"1.0.0"}}},"examples":{"Example 1":{"value":{"Node":"v12.16.1","Arch":"x64","Platform":"linux","Docker":false,"Database":"postgres","ProjectOnRootDB":false,"RootDB":"postgres","PackageVersion":"1.0.0"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"description":"Get info such as node version, arch, platform, is docker, rootdb and package version of a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/users/{userId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"patch":{"summary":"Update Base User","operationId":"auth-base-user-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"5a2q8as60daly"},"description":"Success Message","example":"The user has been updated successfully"}}},"examples":{"Example 1":{"value":{"msg":"The user has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"owner"}}}}}},"tags":["Auth"],"description":"Update a given user in a given base. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Base User","operationId":"auth-base-user-remove","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"5h7c9lqh5ynve"},"example":"The user has been updated successfully","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"The user has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Delete a given user in a given base. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/visibility-rules":{"get":{"summary":"Get UI ACL","operationId":"base-model-visibility-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{}},"examples":{"Example 1":{"value":[{"ptn":"nc_09gt___Sheet-1","_ptn":"Sheet-1","ptype":"table","tn":"Sheet-1","_tn":"Sheet-1","table_meta":null,"id":"vw_75neroyqdye94k","source_id":"ds_eol59jg2l4zwev","base_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","title":"Sheet-1","type":3,"is_default":true,"show_system_fields":null,"lock_type":"collaborative","uuid":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f","password":null,"show":true,"order":1,"created_at":"2023-03-08T10:44:55.253Z","updated_at":"2023-03-10T07:18:44.908Z","meta":{"allowCSVDownload":true},"view":{"fk_view_id":"vw_75neroyqdye94k","source_id":"ds_eol59jg2l4zwev","base_id":"p_63b4q0qengen1x","uuid":null,"created_at":"2023-03-08T10:44:55.288Z","updated_at":"2023-03-08T10:44:55.288Z","meta":null,"row_height":null},"disabled":{"owner":false,"creator":false,"viewer":false,"editor":false,"commenter":false,"guest":false}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Hide / show views based on user role","tags":["Base"],"parameters":[{"schema":{"type":"boolean"},"in":"query","name":"includeM2M"},{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"post":{"summary":"Create UI ACL","operationId":"base-model-visibility-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"2txh071wsodys"},"example":"UI ACL has been created successfully"}}},"examples":{"Example 1":{"value":{"msg":"UI ACL has been created successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VisibilityRuleReq"}}}},"tags":["Base"],"description":"Hide / show views based on user role","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Projects","operationId":"base-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectList"},"examples":{"Example 1":{"value":{"list":[{"sources":[{"alias":"string","config":null,"created_at":"2023-03-01 14:27:36","enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"base_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my base description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-base","updated_at":"2023-03-01 14:27:36"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all base meta data","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"]},"post":{"summary":"Create Base","operationId":"base-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Base"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/ProjectReq"},{"type":"object","properties":{"external":{"type":"boolean","default":false,"description":"If true, the base will us an external database else it will use the root database"}}}]},"examples":{"Example 1":{"value":{"sources":[{"alias":"string","config":null,"enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"base_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my base description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-base","external":false}}}}}},"tags":["Base"],"description":"Create a new base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/duplicate/{baseId}/{sourceId}":{"post":{"summary":"Duplicate Base Source","operationId":"base-source-duplicate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"},"base_id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false},"excludeViews":{"type":"boolean","required":false},"excludeHooks":{"type":"boolean","required":false}}},"base":{"type":"object","required":false}}},"examples":{"Example 1":{"value":{"excludeData":true,"excludeViews":true,"excludeHooks":true}}}}}},"tags":["Base"],"description":"Duplicate a base","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"ds_124hhlkbeasewh","type":"string"},"name":"sourceId","in":"path","required":false,"description":"Unique Source ID"}]}},"/api/v1/db/meta/duplicate/{baseId}":{"post":{"summary":"Duplicate Base","operationId":"base-duplicate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false},"excludeViews":{"type":"boolean","required":false},"excludeHooks":{"type":"boolean","required":false}}},"base":{"type":"object","required":false}}},"examples":{"Example 1":{"value":{"excludeData":true,"excludeViews":true,"excludeHooks":true}}}}}},"tags":["Base"],"description":"Duplicate a base","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}]}},"/api/v1/db/meta/projects/{baseId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"Get Base","operationId":"base-read","description":"Get the info of a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Base"},"examples":{"Example 1":{"value":{"sources":[{"alias":"string","config":null,"enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"base_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my base description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-base"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"delete":{"summary":"Delete Base","operationId":"base-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"description":"Delete the given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Base","operationId":"base-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUpdateReq"},"examples":{"Example 1":{"value":{"color":"#24716E","meta":null,"title":"My Base","order":1}}}}}},"description":"Update the given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/user":{"parameters":[{"schema":{"type":"string"},"name":"baseId","in":"path","required":true}],"patch":{"summary":"Base user meta update","operationId":"base-user-meta-update","responses":{"200":{"description":"OK"}},"tags":["Base"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUserMetaReq"}}}}}},"/api/v1/db/meta/projects/{baseId}/bases/{sourceId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"type":"string","pattern":"ds_j04jmxh5xg10lu"},"name":"sourceId","in":"path","required":true,"description":"Unique Source ID"}],"get":{"summary":"Get Source","operationId":"source-read","description":"Get the source details of a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Source"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Source"},"examples":{"Example 1":{"value":{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"base_id":"p_01clqvzik3izk6","type":"mysql2"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"delete":{"summary":"Delete Source","operationId":"source-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Source"],"description":"Delete the source details of a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Source","operationId":"source-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"Example 1":{"value":{"id":"ds_rrplkgy0pq1f3c","base_id":"p_63b4q0qengen1x","alias":"sakila","meta":null,"is_meta":null,"type":"mysql2","inflection_column":"camelize","inflection_table":"camelize","created_at":"2023-03-11T10:31:15.341Z","updated_at":"2023-03-11T10:32:25.763Z","enabled":true,"order":2}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Source"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"alias":"sakila","type":"mysql2","config":{"client":"mysql2","connection":{"host":"localhost","port":"3306","user":"root","password":"password","database":"sakila"}},"inflection_column":"camelize","inflection_table":"camelize"}}}}}},"description":"Update the source details of a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/bases/":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"List Sources","operationId":"source-list","description":"Get base source list","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Source"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SourceList"},"examples":{"Example 1":{"value":{"list":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"base_id":"p_01clqvzik3izk6","type":"mysql2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Source","operationId":"source-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Source"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/Source"},{"type":"object","properties":{"external":{"type":"boolean","default":false}}}]},"examples":{"Example 1":{"value":{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"base_id":"p_01clqvzik3izk6","type":"mysql2","external":false}}}}}},"tags":["Source"],"description":"Create a new source on a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/bases/{sourceId}/share/erd":{"parameters":[{"schema":{"type":"string"},"name":"baseId","in":"path","required":true},{"schema":{"type":"string"},"name":"sourceId","in":"path","required":true}],"post":{"summary":"share ERD view","operationId":"source-share-erd","tags":["Source"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Source"}}}}}},"delete":{"summary":"","operationId":"source-disable-share-erd","responses":{"200":{"description":"OK"}},"tags":["Source"]}},"/api/v1/db/meta/projects/{baseId}/shared":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"Get Base Shared Base","operationId":"base-shared-base-get","description":"Get Base Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"uuid":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"url":{"type":"string","format":"uri"},"roles":{"type":"string","example":"viewer"}}},"examples":{"Example 1":{"value":{"uuid":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11","url":"http://example.com","roles":"viewer"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"delete":{"summary":"Delete Base Shared Base","operationId":"base-shared-base-disable","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"description":"Delete Base Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Base Shared Base","operationId":"base-shared-base-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"uuid":{"$ref":"#/components/schemas/StringOrNull"},"roles":{"$ref":"#/components/schemas/StringOrNull"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedBaseReq"},"examples":{"Example 1":{"value":{"roles":"editor","password":"password123"}}}}}},"description":"Create Base Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Base Shared Base","operationId":"base-shared-base-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"uuid":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"url":{"type":"string","format":"uri"},"roles":{"type":"string","example":"viewer"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedBaseReq"},"examples":{"Example 1":{"value":{"password":"password123","roles":"editor"}}}}}},"tags":["Base"],"description":"Update Base Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/cost":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"Base Cost","operationId":"base-cost","description":"Calculate the Base Cost","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"x-internal":true}},"/api/v1/db/meta/projects/{baseId}/tables":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"post":{"summary":"Create Table","operationId":"db-table-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Table"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","columns":[{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":1,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}],"columnsById":{"cl_c5knoi4xs4sfpt":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_jpl0qu4gj4rexq":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_m4wkaqgqqjzoeh":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_phvuuwjrzcdo0g":{"ai":1,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}},"created_at":"2023-03-02 17:04:06","deleted":null,"enabled":1,"id":"md_rsu68aqjsbyqtl","meta":null,"mm":0,"order":1,"pinned":null,"base_id":"p_xm3thidrblw4n7","schema":null,"table_name":"nc_vm5q___Table1","tags":null,"title":"Table1","type":"table","updated_at":"2023-03-02 17:04:08","views":[{"_ptn":"Table1","_tn":"Table1","source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","disabled":{"commenter":false,"creator":false,"editor":false,"guest":false,"owner":false,"viewer":false},"fk_model_id":"md_rsu68aqjsbyqtl","id":"vw_p2jcatxz4mvcfw","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","ptn":"nc_vm5q___Table1","ptype":"table","show":1,"show_system_fields":null,"table_meta":null,"title":"Table1","tn":"Table1","type":3,"updated_at":"2023-03-02 17:04:06","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","fk_view_id":"vw_p2jcatxz4mvcfw","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:04:06","uuid":null}}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TableReq"}}}},"tags":["DB Table"],"description":"Create a new table in a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"List Tables","operationId":"db-table-list","responses":{"200":{"$ref":"#/components/responses/TableList"},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"type":"number"},"in":"query","name":"page"},{"schema":{"type":"number"},"in":"query","name":"pageSize"},{"schema":{"type":"string"},"in":"query","name":"sort"},{"schema":{"type":"boolean"},"in":"query","name":"includeM2M"}],"tags":["DB Table"],"description":"List all tables in a given base"}},"/api/v1/db/meta/tables/{tableId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"Read Table","operationId":"db-table-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Table"},"examples":{"Example 1":{"value":{"id":"md_rsu68aqjsbyqtl","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","table_name":"nc_vm5q___Table1","title":"Table1","type":"table","meta":null,"schema":null,"enabled":1,"mm":0,"tags":null,"pinned":null,"deleted":null,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:08","columns":[{"id":"cl_phvuuwjrzcdo0g","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},{"id":"cl_c5knoi4xs4sfpt","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Title","column_name":"title","uidt":"SingleLineText","dt":"varchar","np":null,"ns":null,"clen":"45","cop":"2","pk":0,"pv":1,"rqd":0,"un":0,"ct":"varchar(45)","ai":0,"unique":0,"cdf":null,"cc":"","csn":"utf8mb4","dtx":"specificType","dtxp":"45","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":2,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},{"id":"cl_jpl0qu4gj4rexq","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"CreatedAt","column_name":"created_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"3","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":3,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},{"id":"cl_m4wkaqgqqjzoeh","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"UpdatedAt","column_name":"updated_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"4","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":4,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}],"views":[{"ptn":"nc_vm5q___Table1","_ptn":"Table1","ptype":"table","tn":"Table1","_tn":"Table1","table_meta":null,"id":"vw_p2jcatxz4mvcfw","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Table1","type":3,"is_default":1,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":1,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":{},"view":{"fk_view_id":"vw_p2jcatxz4mvcfw","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","uuid":null,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null,"row_height":null},"disabled":{"owner":false,"creator":false,"viewer":false,"editor":false,"commenter":false,"guest":false}}],"columnsById":{"cl_phvuuwjrzcdo0g":{"id":"cl_phvuuwjrzcdo0g","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},"cl_c5knoi4xs4sfpt":{"id":"cl_c5knoi4xs4sfpt","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Title","column_name":"title","uidt":"SingleLineText","dt":"varchar","np":null,"ns":null,"clen":"45","cop":"2","pk":0,"pv":1,"rqd":0,"un":0,"ct":"varchar(45)","ai":0,"unique":0,"cdf":null,"cc":"","csn":"utf8mb4","dtx":"specificType","dtxp":"45","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":2,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},"cl_jpl0qu4gj4rexq":{"id":"cl_jpl0qu4gj4rexq","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"CreatedAt","column_name":"created_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"3","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":3,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},"cl_m4wkaqgqqjzoeh":{"id":"cl_m4wkaqgqqjzoeh","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"UpdatedAt","column_name":"updated_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"4","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":4,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table"],"description":"Read the table meta data by the given table ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table","operationId":"db-table-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"5a0g9yvs4e678"},"example":"The table has been updated successfully"}}},"examples":{"Example 1":{"value":{"msg":"The table has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"table_name":{"type":"string","description":"Table name","example":"users"},"title":{"type":"string","description":"Table title","example":"Users"},"description":{"$ref":"#/components/schemas/TextOrNull","description":"Table description","example":"Table for storing User Information"},"base_id":{"type":"string","description":"Base ID","example":"p_124hhlkbeasewh"},"meta":{"$ref":"#/components/schemas/Meta"}}},"examples":{"Example 1":{"value":{"table_name":"users","title":"Users","base_id":"p_124hhlkbeasewh","meta":null}}}}}},"description":"Update the table meta data by the given table ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table","operationId":"db-table-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table"],"description":"Delete the table meta data by the given table ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/duplicate/{baseId}/table/{tableId}":{"post":{"summary":"Duplicate Table","operationId":"db-table-duplicate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false},"excludeViews":{"type":"boolean","required":false},"excludeHooks":{"type":"boolean","required":false},"title":{"type":"string","required":false,"description":"New table title"}}}}},"examples":{"Example 1":{"value":{"excludeData":true,"excludeViews":true}}}}}},"tags":["DB Table"],"description":"Duplicate a table","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_124hhlkbeasewh","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}]}},"/api/v1/db/meta/duplicate/{baseId}/column/{columnId}":{"post":{"summary":"Duplicate Column","operationId":"duplicate-column","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false}}},"extra":{"type":"object"}}},"examples":{"Example 1":{"value":{"excludeData":true}}}}}},"tags":["DB Table"],"description":"Duplicate a column","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_124hhlkbeasewh","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}]}},"/api/v1/db/meta/projects/{baseId}/{sourceId}/tables":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"type":"string","pattern":"ds_j04jmxh5xg10lu"},"name":"sourceId","in":"path","required":true,"description":"Unique Source ID"}],"get":{"summary":"List Tables","operationId":"table-list","responses":{"200":{"$ref":"#/components/responses/TableList"},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"type":"number"},"in":"query","name":"page"},{"schema":{"type":"number"},"in":"query","name":"pageSize"},{"schema":{"type":"string"},"in":"query","name":"sort"},{"schema":{"type":"boolean"},"in":"query","name":"includeM2M"}],"tags":["Source"],"description":"List all tables in a given Base and Source"},"post":{"summary":"Create Table","operationId":"table-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Table"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","columns":[{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":1,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}],"columnsById":{"cl_c5knoi4xs4sfpt":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_jpl0qu4gj4rexq":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_m4wkaqgqqjzoeh":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_phvuuwjrzcdo0g":{"ai":1,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}},"created_at":"2023-03-02 17:04:06","deleted":null,"enabled":1,"id":"md_rsu68aqjsbyqtl","meta":null,"mm":0,"order":1,"pinned":null,"base_id":"p_xm3thidrblw4n7","schema":null,"table_name":"nc_vm5q___Table1","tags":null,"title":"Table1","type":"table","updated_at":"2023-03-02 17:04:08","views":[{"_ptn":"Table1","_tn":"Table1","source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","disabled":{"commenter":false,"creator":false,"editor":false,"guest":false,"owner":false,"viewer":false},"fk_model_id":"md_rsu68aqjsbyqtl","id":"vw_p2jcatxz4mvcfw","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","ptn":"nc_vm5q___Table1","ptype":"table","show":1,"show_system_fields":null,"table_meta":null,"title":"Table1","tn":"Table1","type":3,"updated_at":"2023-03-02 17:04:06","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","fk_view_id":"vw_p2jcatxz4mvcfw","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:04:06","uuid":null}}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TableReq"},"examples":{"Example 1":{"value":{"columns":[{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"updated_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"UpdatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"created_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"CreatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":null,"ck":false,"clen":45,"column_name":"title","ct":"varchar(45)","dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"Title","uicn":"","uidt":"SingleLineText","uip":"","un":false},{"ai":true,"altered":1,"cdf":null,"ck":false,"clen":null,"column_name":"id","ct":"int(11)","dt":"int","dtx":"integer","dtxp":"11","dtxs":"","np":11,"nrqd":false,"ns":0,"pk":true,"rqd":true,"title":"Id","uicn":"","uidt":"ID","uip":"","un":true}],"table_name":"Sheet-1","title":"Sheet-1"}}}}}},"tags":["Source"],"description":"Create a new table in a given Base and Source","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/reorder":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Reorder Table","operationId":"db-table-reorder","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"order":{"type":"number"}}},"examples":{"Example 1":{"value":{"order":0}}}}}},"tags":["DB Table"],"description":"Update the order of the given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/columns":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Column","operationId":"db-table-column-create","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnReq"},"examples":{"Example 1":{"value":{"ai":0,"au":0,"source_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"validate":null,"virtual":null}}}}}},"tags":["DB Table Column"],"description":"Create a new column in a given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/columns/{columnId}":{"parameters":[{"schema":{"type":"string"},"name":"columnId","in":"path","required":true}],"patch":{"summary":"Update Column","operationId":"db-table-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Column"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnReq"}}}},"tags":["DB Table Column"],"description":"Update the existing column by the given column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Column","operationId":"db-table-column-delete","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Column"],"description":"Delete the existing column by the given column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Column","operationId":"db-table-column-get","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Column"],"description":"Get the existing column by the given column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/columns/{columnId}/primary":{"parameters":[{"schema":{"type":"string"},"name":"columnId","in":"path","required":true}],"post":{"summary":"Create Primary Value","operationId":"db-table-column-primary-column-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Column"],"description":"Set a primary value on a given column","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/views":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"List Views","operationId":"db-view-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewList"},"examples":{"Example 1":{"value":{"list":[{"alias":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"source_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"fk_base_id":"string","fk_project_id":"string","id":"string","order":0,"parent_id":"string","pinned":true,"show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"List all views in a given Table.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"patch":{"summary":"Update View","operationId":"db-view-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":"{\\"allowCSVDownload\\":true}","order":1,"password":"password123","base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Grid View 1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewUpdateReq"},"examples":{"Example 1":{"value":{"title":"Grid View 1","uuid":"e2457bbf-e29c-4fec-866e-fe3b01dba57f","password":"password123","lock_type":"collaborative","meta":"{\\"allowCSVDownload\\":true}","order":1,"show_system_fields":0}}}}}},"tags":["DB View"],"description":"Update the view with the given view Id.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete View","operationId":"db-view-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Delete the view with the given view Id.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/show-all":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"post":{"summary":"Show All Columns In View","operationId":"db-view-show-all-column","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Show All Columns in a given View","parameters":[{"schema":{"type":"array"},"in":"query","name":"ignoreIds"},{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/hide-all":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"post":{"summary":"Hide All Columns In View","operationId":"db-view-hide-all-column","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"ignoreIds"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Hide All Columns in a given View"}},"/api/v1/db/meta/tables/{tableId}/share":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"List Shared Views","operationId":"db-view-share-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all shared views in a given Table","tags":["DB View Share"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/share":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"post":{"summary":"Create Shared View","operationId":"db-view-share-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewReq"},"examples":{"Example 1":{"value":{"meta":{},"password":"123456789"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Share"],"description":"Create a shared view in a given View..","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Shared View","operationId":"db-view-share-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedView"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewReq"}}},"description":""},"tags":["DB View Share"],"description":"Update a shared view in a given View..","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Shared View","operationId":"db-view-share-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Delete a shared view in a given View.","tags":["DB View Share"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/columns":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"get":{"summary":"List Columns In View","operationId":"db-view-column-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnList"},"examples":{"Example 1":{"value":{"list":[{"ai":0,"au":0,"source_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Column"],"description":"List all columns by ViewID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Column in View","operationId":"db-view-column-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Column"},"examples":{"Example 1":{"value":{"ai":0,"au":0,"source_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Column"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewColumnReq"},"examples":{"Example 1":{"value":{"fk_column_id":"cl_m4wkaqgqqjzoeh","show":0,"order":1}}}}}},"description":"Create a new column in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/columns/{columnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"patch":{"summary":"Update View Column","operationId":"db-view-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Column"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewColumnUpdateReq"},"examples":{"Example 1":{"value":{"show":0,"order":1}}}}}},"description":"Update a column in a View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/sorts":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"get":{"summary":"List View Sorts","operationId":"db-table-sort-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SortList"},"examples":{"Example 1":{"value":{"list":[{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","source_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"base_id":"p_9sx43moxhqtjm3"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"description":"List all the sort data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Update View Sort","operationId":"db-table-sort-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"requestBody":{"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/SortReq"},{"type":"object","properties":{"push_to_top":{"type":"boolean","example":true,"description":"Push the sort to the top of the list"}}}]}}}},"description":"Update the sort data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/sorts/{sortId}":{"parameters":[{"schema":{"type":"string","example":"so_xd4t51uv60ghzl"},"name":"sortId","in":"path","description":"Unique Sort ID","required":true}],"get":{"summary":"Get Sort","operationId":"db-table-sort-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Sort"},"examples":{"Example 1":{"value":{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","source_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"base_id":"p_9sx43moxhqtjm3"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"description":"Get the sort data by Sort ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Sort","operationId":"db-table-sort-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SortReq"},"examples":{"Example 1":{"value":{"direction":"asc","fk_column_id":"cl_l11b769pe2j1ce"}}}}}},"description":"Update the sort data by Sort ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Sort","operationId":"db-table-sort-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"description":"Delete the sort data by Sort ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/filters":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"get":{"summary":"Get View Filter","operationId":"db-table-filter-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Get the filter data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"type":"boolean"},"name":"includeAllFilters","in":"query"}]},"post":{"summary":"Create View Filter","operationId":"db-table-filter-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Filter"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterReq"},"examples":{"Example 1":{"value":{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}}}}}},"description":"Update the filter data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/hooks/{hookId}/filters":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"hk_0063k4o1frnxbr"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"}],"get":{"summary":"Get Hook Filter","operationId":"db-table-webhook-filter-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook Filter"],"description":"Get the filter data in a given Hook","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Hook Filter","operationId":"db-table-webhook-filter-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Filter"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook Filter"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterReq"},"examples":{"Example 1":{"value":{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}}}}}},"description":"Create filter(s) in a given Hook","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/hooks/{hookId}/logs":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"hk_0063k4o1frnxbr"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"}],"get":{"summary":"List Hook Logs","operationId":"db-table-webhook-logs-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookLogList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_jxuewivwbxeum2","event":"after","execution_time":"98","fk_hook_id":"hk_035ijv5qdi97y5","id":"string","notifications":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}}","operation":"insert","payload":"{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}","base_id":"p_tbhl1hnycvhe5l","response":"{\\"status\\":200,\\"statusText\\":\\"OK\\",\\"headers\\":{\\"server\\":\\"nginx\\",\\"content-type\\":\\"text/plain; charset=UTF-8\\",\\"transfer-encoding\\":\\"chunked\\",\\"connection\\":\\"close\\",\\"vary\\":\\"Accept-Encoding\\",\\"x-request-id\\":\\"53844a7d-ede8-4798-adf7-8af441908a72\\",\\"x-token-id\\":\\"6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"cache-control\\":\\"no-cache, private\\",\\"date\\":\\"Fri, 24 Mar 2023 10:50:10 GMT\\"},\\"config\\":{\\"url\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"method\\":\\"post\\",\\"data\\":\\"{\\\\\\"type\\\\\\":\\\\\\"records.after.insert\\\\\\",\\\\\\"id\\\\\\":\\\\\\"a77d97dc-a3e4-4719-9b46-45f93e0cc99a\\\\\\",\\\\\\"data\\\\\\":{\\\\\\"table_id\\\\\\":\\\\\\"md_d8v403o74mf5lf\\\\\\",\\\\\\"table_name\\\\\\":\\\\\\"Sheet-2\\\\\\"}}\\",\\"headers\\":{\\"Accept\\":\\"application/json, text/plain, */*\\",\\"Content-Type\\":\\"application/x-www-form-urlencoded\\",\\"User-Agent\\":\\"axios/0.21.4\\",\\"Content-Length\\":138},\\"params\\":{}}}","test_call":0,"triggered_by":"w@nocodb.com","type":"URL"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook Logs"],"description":"List the log data in a given Hook","parameters":[{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/filters/{filterId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","pattern":"fi_pgfuo11uhn2xeo"},"name":"filterId","in":"path","required":true,"description":"Unique Filter ID"}],"get":{"summary":"Get Filter","operationId":"db-table-filter-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Filter"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Get the filter data with a given Filter ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Filter","operationId":"db-table-filter-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterReq"},"examples":{"Example 1":{"value":{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}}}}}},"description":"Update the filter data with a given Filter ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Filter","operationId":"db-table-filter-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Delete the filter data with a given Filter ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/filters/{filterGroupId}/children":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"fi_pgfuo11uhn2xeo","description":"Filter Group ID"},"name":"filterGroupId","in":"path","required":true}],"get":{"summary":"Get Filter Group Children","operationId":"db-table-filter-children-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Get Filter Group Children of a given group ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/grids":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Grid View","operationId":"db-view-grid-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_o50jiw9v2txktv","source_id":"ds_a95vextjl510z7","base_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Grid-1","type":3,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":2,"created_at":"2023-03-13T07:29:16.610Z","updated_at":"2023-03-13T07:29:16.610Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Grid View","type":3,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null}}}}}},"description":"Create a new grid view in a given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/forms":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Form View","operationId":"db-view-form-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_a830n4bmwk8wlp","source_id":"ds_a95vextjl510z7","base_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Form-1","type":1,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":4,"created_at":"2023-03-13T07:29:19.957Z","updated_at":"2023-03-13T07:29:19.957Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Create a new form view in a given Table","tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Form View","type":1,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null}}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/forms/{formViewId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_6fqln9vdytdv8q"},"name":"formViewId","in":"path","required":true,"description":"Unique Form View ID"}],"patch":{"summary":"Update Form View","operationId":"db-view-form-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FormUpdateReq"},"examples":{"Example 1":{"value":{"banner_image_url":{"mimetype":"image/jpg","size":32903,"title":"Random-Pictures-of-Conceptual-and-Creative-Ideas-02.jpg","path":"download/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg"},"email":"user@example.com","heading":"My Form","lock_type":"collaborative","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission.","title":"Form View 1"}}}}}},"description":"Update the form data by Form ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Form","operationId":"db-view-form-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Form"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","banner_image_url":{"mimetype":"image/jpg","size":32903,"title":"Random-Pictures-of-Conceptual-and-Creative-Ideas-02.jpg","path":"download/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg","signedPath":"dltemp/lNoLbqB62Jdo5Rmp/1709308800000/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg"},"columns":[{"id":"fvc_ugj9zo5bzocxtl","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_view_id":"vw_kdf5cr7qmhksek","fk_column_id":"cl_phvuuwjrzcdo0g","uuid":null,"label":null,"help":null,"description":null,"required":null,"show":0,"order":1,"created_at":"2023-03-04 16:40:47","updated_at":"2023-03-04 16:40:47","meta":{}}],"email":"user@example.com","fk_model_id":"md_rsu68aqjsbyqtl","heading":"My Form","lock_type":"collaborative","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission.","title":"Form View 1"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the form data by Form ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/form-columns/{formViewColumnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"fvc_1m9b0aub791d4m","type":"string"},"name":"formViewColumnId","in":"path","required":true,"description":"Unique Form View Column ID"}],"patch":{"summary":"Update Form Column","operationId":"db-view-form-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FormColumnReq"},"examples":{"Example 1":{"value":{"description":null,"help":"This is a help text","label":"Form Label","meta":null,"order":1,"required":0,"show":0}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FormColumnReq"}}}},"description":"Update the form column(s) by Form View Column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/grids/{viewId}":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"patch":{"summary":"Update Grid View","operationId":"db-view-grid-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GridUpdateReq"},"examples":{"Example 1":{"value":{"row_height":1,"meta":null}}}}}},"description":"Update Grid View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/grids/{gridId}/grid-columns":{"parameters":[{"schema":{"type":"string","example":"vw_q6k13mmygdi3yz"},"name":"gridId","in":"path","required":true,"description":"Grid View ID"}],"get":{"summary":"List Grid Columns","operationId":"db-view-grid-columns-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/GridColumn"}},"examples":{"Example 1":{"value":[{"id":"nc_c8jz4kxe6xvh11","fk_view_id":"vw_p2jcatxz4mvcfw","fk_column_id":"cl_c5knoi4xs4sfpt","base_id":"p_xm3thidrblw4n7","source_id":"ds_g4ccx6e77h1dmi","show":0,"order":1,"width":"200px","help":null}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"List all columns in the given Grid","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/grid-columns/{columnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"patch":{"summary":"Update Grid Column","operationId":"db-view-grid-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GridColumnReq"},"examples":{"Example 1":{"value":{"fk_column_id":"cl_c5knoi4xs4sfpt","label":"My Column","width":"200px"}}}}}},"description":"Update grid column(s) in the given Grid","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/galleries":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Gallery View","operationId":"db-view-gallery-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_qp94qfnvffgk5f","source_id":"ds_a95vextjl510z7","base_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Gallery-1","type":2,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":3,"created_at":"2023-03-13T07:29:18.707Z","updated_at":"2023-03-13T07:29:18.707Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Gallery View","type":2,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null}}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/galleries/{galleryViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"galleryViewId","in":"path","required":true,"description":"Unique Gallery View ID"}],"patch":{"summary":"Update Gallery View","operationId":"db-view-gallery-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GalleryUpdateReq"},"examples":{"Example 1":{"value":{"fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":null}}}}}},"description":"Update the Gallery View data with Gallery ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Gallery View","operationId":"db-view-gallery-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Gallery"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Gallery View data with Gallery ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/kanbans":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Kanban View","operationId":"db-view-kanban-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_569sqsrp2vuff4","source_id":"ds_a95vextjl510z7","base_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Kanban-1","type":4,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":5,"created_at":"2023-03-13T07:29:21.387Z","updated_at":"2023-03-13T07:29:21.387Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Kanban View","type":4,"copy_from_id":null,"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_geo_data_col_id":null}}}}}},"description":"Create a new Kanban View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/kanbans/{kanbanViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"kanbanViewId","in":"path","required":true,"description":"Unique Kanban View ID"}],"patch":{"summary":"Update Kanban View","operationId":"db-view-kanban-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/KanbanUpdateReq"},"examples":{"Example 1":{"value":{"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":{"cl_g0a89q9xdry3lu":[{"id":"uncategorized","title":null,"order":0,"color":"#c2f5e8","collapsed":false},{"id":"sl_ihyva6jx6dg0fc","fk_column_id":"cl_g0a89q9xdry3lu","title":"a","color":"#cfdffe","order":1,"collapsed":false},{"id":"sl_gqdm5v6t8aetoa","fk_column_id":"cl_g0a89q9xdry3lu","title":"b","color":"#d0f1fd","order":2,"collapsed":false},{"id":"sl_eipnl0kn7a9d3c","fk_column_id":"cl_g0a89q9xdry3lu","title":"cc","color":"#c2f5e8","order":3,"collapsed":false},{"id":"sl_dei8p2jq0cnlv0","fk_column_id":"cl_g0a89q9xdry3lu","title":"d","color":"#ffdaf6","order":4,"collapsed":false}]}}}}}}},"description":"Update the Kanban View data with Kanban ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Kanban View","operationId":"db-view-kanban-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Kanban"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Kanban View data by Kanban ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/maps":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Map View","operationId":"db-view-map-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Map View","type":5,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":"cl_uu1meolj00tlrq"}}}}},"description":""},"description":"Create a new Map View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/maps/{mapViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"mapViewId","in":"path","required":true,"description":"Unique Map View ID"}],"patch":{"summary":"Update Map View","operationId":"db-view-map-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MapUpdateReq"},"examples":{"Example 1":{"value":{"fk_geo_data_col_id":"cl_8iw2o4ejzvdyna","meta":null}}}}}},"description":"Update the Map View data by Map ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Map View","operationId":"db-view-map-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Map"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Map View data by Map ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/calendars":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Calendar View","operationId":"db-view-calendar-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_569sqsrp2vuff4","source_id":"ds_a95vextjl510z7","base_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Calendar-1","type":6,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":5,"created_at":"2023-03-13T07:29:21.387Z","updated_at":"2023-03-13T07:29:21.387Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Calendar View","type":4,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null,"calendar_range":[{"fk_from_column_id":"cl_g0a89q9xdry3lu","fk_to_column_id":"cl_g0a89q9xdry3lu"}]}}}}}},"description":"Create a new Calendar View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/calendars/{calendarViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"calendarViewId","in":"path","required":true,"description":"Unique Calendar View ID"}],"patch":{"summary":"Update Calendar View","operationId":"db-view-calendar-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CalendarUpdateReq"},"examples":{"Example 1":{"value":{"fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","title":"Calendar - 2","calendar_range":[{"id":"cl_gpoc4d1dfef","fk_from_column_id":"cl_g0a89q9xdry3lu","fk_to_column_id":"cl_g0a89q9xdry3lu"}]}}}}}},"description":"Update the Calendar View data with Calendar ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Calendar View","operationId":"db-view-calendar-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Calendar"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Calendar View data by Calendar ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{baseId}/meta-diff":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"post":{"summary":"Sync Meta","operationId":"base-meta-diff-sync","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"la6fd99uw6eao"},"example":"The meta has been synchronized successfully"}}},"examples":{"Example 1":{"value":{"msg":"The meta has been synchronized successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"description":"Synchronise the meta data difference between NC_DB and external data sources ","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Meta Diff","operationId":"base-meta-diff-get","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"awdkjwr7uultr"},"type":"object","properties":{"table_name":{"type":"string","x-stoplight":{"id":"jjj8ufafq1sd2"},"description":"Table Name","example":"Table 1"},"source_id":{"type":"string","x-stoplight":{"id":"smx2or6bv1xym"},"description":"Source ID","example":"ds_rrplkgy0pq1f3c"},"type":{"type":"string","x-stoplight":{"id":"zr19ahh1s6d13"},"description":"Change Type","example":"table"},"detectedChanges":{"type":"array","x-stoplight":{"id":"bptxla2y27aq6"},"description":"Detected Changes","items":{"x-stoplight":{"id":"ob16o1ln7xy8o"},"type":"object"}}}}},"examples":{"Example 1":{"value":[{"table_name":"_nc_m2m_uuv_xzru3m","source_id":"ds_rrplkgy0pq1f3c","type":"table","detectedChanges":[{"type":"TABLE_NEW","msg":"New table"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"Sheet-1","cn":"table1_id","rcn":"id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table1_id_foreign"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"address","cn":"table2_id","rcn":"address_id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table2_id_foreign"}]}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the meta data difference between NC_DB and external data sources "}},"/api/v1/db/meta/projects/{baseId}/meta-diff/{sourceId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"type":"string","pattern":"ds_j04jmxh5xg10lu"},"name":"sourceId","in":"path","required":true,"description":"Unique Source ID"}],"post":{"summary":"Synchronise Source Meta","operationId":"source-meta-diff-sync","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"acy7tx4rounqw"},"example":"The source meta has been synchronized successfully"}}},"examples":{"Example 1":{"value":{"msg":"The source meta has been synchronized successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Source"],"description":"Synchronise the meta data difference between NC_DB and external data sources in a given Source","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Source Meta Diff","operationId":"source-meta-diff-get","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Source"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"pav4jmel1ebeu"},"type":"object","properties":{"table_name":{"type":"string","x-stoplight":{"id":"xjw4k4httzmaf"},"description":"Table Name","example":"Table 1"},"source_id":{"type":"string","x-stoplight":{"id":"l1o3qhkgagsdl"},"example":"ds_rrplkgy0pq1f3c","description":"Source ID"},"type":{"type":"string","x-stoplight":{"id":"v5ciaygrj64uh"},"description":"Change Type","example":"table"},"detectedChanges":{"type":"array","x-stoplight":{"id":"wqn5noi0e46q8"},"description":"Detected Changes","items":{"x-stoplight":{"id":"r2roo274wquvf"},"type":"object"}}}}},"examples":{"Example 1":{"value":[{"table_name":"_nc_m2m_uuv_xzru3m","source_id":"ds_rrplkgy0pq1f3c","type":"table","detectedChanges":[{"type":"TABLE_NEW","msg":"New table"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"Sheet-1","cn":"table1_id","rcn":"id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table1_id_foreign"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"address","cn":"table2_id","rcn":"address_id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table2_id_foreign"}]}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the meta data difference between NC_DB and external data sources in a given Source"}},"/api/v1/db/meta/projects/{baseId}/has-empty-or-null-filters":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"List Empty & Null Filter","operationId":"base-has-empty-or-null-filters","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Check if a base contains empty and null filters. Used in `Show NULL and EMPTY in Filter` in Base Setting.","x-internal":true}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"}],"get":{"summary":"List Table Rows","operationId":"db-table-row-list","description":"List all table rows in a given table and base","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"schema":{"type":"string"},"in":"query","name":"pks","description":"Comma separated list of pks"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"g92aqxk869a7o"},"description":"List of data objects","items":{"x-stoplight":{"id":"rnbt8ubciknfd"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"7f38yyzdg03x5"},"description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Table Row","operationId":"db-table-row-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"description":"Create a new row in a given table and base.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/find-one":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"}],"get":{"summary":"Find One Table Row","operationId":"db-table-row-find-one","description":"Return the first result of the target Table Row","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/groupby":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"in":"query","name":"column_name","description":"Column name of the column you want to group by, eg. `column_name=column1`"}],"get":{"summary":"Group By Table Row","operationId":"db-table-row-group-by","description":"Get the result grouped by the given query","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}}}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/group/{columnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string","example":"p_tbhl1hnycvhe5l"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string","example":"md_5hua2iqloqirhd"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","example":"vw_mldv0a5mtwh1la"},"name":"viewName","in":"path","required":true,"description":"View Name"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"get":{"summary":"Table Group by Column","operationId":"db-view-row-grouped-data-list","description":"Get the grouped data By Column ID. Used in Kanban View.","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{}},"examples":{"Example 1":{"value":[{"key":"a","value":{"list":[{"Id":2,"Title":"foo","SingleSelect":"a"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":"b","value":{"list":[{"Id":3,"Title":"bar","SingleSelect":"b"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":null,"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null},{"Id":5,"Title":"xyz","SingleSelect":null}],"pageInfo":{"totalRows":2,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/group/{columnId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string","example":"p_tbhl1hnycvhe5l"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string","example":"md_5hua2iqloqirhd"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"get":{"summary":"Table Group by Column","operationId":"db-table-row-grouped-data-list","description":"Get the grouped data By Column ID. Used in Kanban View.","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{}},"examples":{"Example 1":{"value":[{"key":"a","value":{"list":[{"Id":2,"Title":"foo","SingleSelect":"a"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":"b","value":{"list":[{"Id":3,"Title":"bar","SingleSelect":"b"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":null,"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null},{"Id":5,"Title":"xyz","SingleSelect":null}],"pageInfo":{"totalRows":2,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/calendar-data/{orgs}/{baseName}/{tableName}/views/{viewName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true}],"get":{"summary":"List rows in Calendar View of a Table","operationId":"db-calendar-view-row-list","description":"List all rows in Calendar View of a Table","tags":["DB Calendar View Row"],"parameters":[{"schema":{"type":"string"},"name":"from_date","in":"query","required":true},{"schema":{"type":"string"},"name":"to_date","in":"query","required":true},{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"schema":{"type":"number"},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}]},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"okd8utzm9xqet"},"description":"List of calendar view rows","items":{"x-stoplight":{"id":"j758lsjv53o4q"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"hylgqzgm8yhye"},"description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"/api/v1/db/calendar-data/{orgs}/{baseName}/{tableName}/views/{viewName}/countByDate/":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true}],"get":{"summary":"Count of Records in Dates in Calendar View","operationId":"db-calendar-view-row-count","description":"Get the count of table view rows grouped by the dates","tags":["DB Calendar View Row Count"],"parameters":[{"schema":{"type":"string"},"name":"from_date","in":"query","required":true},{"schema":{"type":"string"},"name":"to_date","in":"query","required":true},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/public/calendar-view/{sharedViewUuid}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List rows in Calendar View of a Table","operationId":"public-data-calendar-row-list","description":"List all rows in Calendar View of a Table","tags":["DB Calendar View Row"],"parameters":[{"schema":{"type":"string"},"name":"from_date","in":"query","required":true},{"schema":{"type":"string"},"name":"to_date","in":"query","required":true},{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"schema":{"type":"number"},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}]},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"okd8utzm9xqet"},"description":"List of calendar view rows","items":{"x-stoplight":{"id":"j758lsjv53o4q"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"hylgqzgm8yhye"},"description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"/api/v1/db/public/calendar-view/{sharedViewUuid}/countByDate":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"Count of Records in Dates in Calendar View","operationId":"public-data-calendar-row-count","parameters":[{"schema":{"type":"string"},"name":"from_date","in":"query","required":true},{"schema":{"type":"string"},"name":"to_date","in":"query","required":true},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true}],"get":{"summary":"List Table View Rows","operationId":"db-view-row-list","description":"List all table view rows","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"schema":{"type":"number"},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"okd8utzm9xqet"},"description":"List of table view rows","items":{"x-stoplight":{"id":"j758lsjv53o4q"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"hylgqzgm8yhye"},"description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Table View Row","operationId":"db-view-row-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"col1":"foo","col2":"bar","CreatedAt":"2023-03-11T08:48:25.598Z","UpdatedAt":"2023-03-11T08:48:25.598Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"col1":"foo","col2":"bar"}}}}}},"description":"Create a new row in the given Table View"}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/find-one":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true}],"get":{"summary":"Find One Table View Row","operationId":"db-view-row-find-one","description":"Return the first result of table view rows with the given query","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/groupby":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true},{"schema":{"type":"string"},"in":"query","name":"column_name","description":"Column name of the column you want to group by, eg. `column_name=column1`"}],"get":{"summary":"Group By Table View Row","operationId":"db-view-row-group-by","description":"Get the table view rows grouped by the given query","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/count":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","example":"vw_75neroyqdye94k"},"name":"viewName","in":"path","required":true,"description":"View Name"}],"get":{"summary":"Count Table View Rows","operationId":"db-view-row-count","description":"Count how many rows in the given Table View","tags":["DB View Row"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"number","x-stoplight":{"id":"hwq29x70rcipi"}}}},"examples":{"Example 1":{"value":{"count":25}}}}}}}}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","example":"vw_75neroyqdye94k"},"name":"viewName","in":"path","required":true,"description":"View Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"get":{"summary":"Get Table View Row","operationId":"db-view-row-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:11:47.784Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the target Table View Row","tags":["DB View Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table View Row","operationId":"db-view-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"bar","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:20:21.133Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"bar"}}}}}},"description":"Update the target Table View Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table View Row","operationId":"db-view-row-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Row"],"description":"Delete the target Table View Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/{rowId}/exist":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"get":{"summary":"Does Table View Row Exist","operationId":"db-view-row-exist","responses":{"201":{"description":"Created","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Check row with provided primary key exists or not","tags":["DB View Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"name":"getHiddenColumn","in":"query","description":"To get Hidden Columns","required":false,"schema":{"type":"boolean"}}],"get":{"summary":"Get Table Row","operationId":"db-table-row-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:11:47.784Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the Table Row by Row ID","tags":["DB Table Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table Row","operationId":"db-table-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"bar","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:20:21.133Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"bar"}}}}}},"description":"Update the Table Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table Row","operationId":"db-table-row-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"description":"Delete the Table Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/{rowId}/exist":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"get":{"summary":"Does Table Row Exist","operationId":"db-table-row-exist","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"check row with provided primary key exists or not","tags":["DB Table Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/tables/{tableId}/bulk/dataList":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"required":true,"name":"viewId","in":"query","description":"View ID is required"}],"post":{"summary":"Read Bulk Data","operationId":"db-data-table-bulk-list","description":"Read bulk data from a given table with given filters","tags":["DB Data Table Bulk List"],"parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"type":"object"}}}}}}},"/api/v2/tables/{tableId}/bulk/group":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"required":true,"name":"viewId","in":"query","description":"View ID is required"}],"post":{"summary":"Read Bulk Group Data","operationId":"db-data-table-bulk-group-list","description":"Read bulk group data from a given table with given filters","tags":["DB Data Table Bulk Group List"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"type":"object"}}}}}}},"/api/v1/db/data/bulk/{orgs}/{baseName}/{tableName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"}],"post":{"summary":"Bulk Insert Table Rows","operationId":"db-table-row-bulk-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","description":"List of returned IDs","items":{"x-stoplight":{"id":"dbkhyd3mnajax"},"type":"object","properties":{"id":{"type":"string","x-stoplight":{"id":"lnwqjl14f287f"}}}}},"examples":{"Example 1":{"value":[{"id":1},{"id":2}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","description":"List of data objects","items":{"x-stoplight":{"id":"7u0mp8nzlvysz"},"type":"object"}},"examples":{"Example 1":{"value":[{"Title":"abc"},{"Title":"def"}]}}}},"description":""},"description":"Bulk insert table rows in one go.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Bulk Update Table Rows by IDs","operationId":"db-table-row-bulk-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","description":"List of returned values. 1 means successful. 0 means failed.","items":{"x-stoplight":{"id":"ga0xhsahovdt7"},"type":"number"}},"examples":{"Example 1":{"value":[1,1]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","description":"List of data objects","items":{"x-stoplight":{"id":"q2xtbf29i1s5n"},"type":"object"}},"examples":{"Example 1":{"value":[{"Id":"1","Title":"123"},{"Id":"2","Title":"456"}]}}}}},"description":"Bulk Update Table Rows by given IDs","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Bulk Delete Table Rows by IDs","operationId":"db-table-row-bulk-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"b9o9o2r6ipho9"},"type":"number"}},"examples":{"Example 1":{"value":[1,1]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"sd8udhhjnqiay"},"type":"object"}},"examples":{"Example 1":{"value":[{"Id":"1"},{"Id":"2"}]}}}},"description":""},"description":"Bulk Delete Table Rows by given IDs","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/bulk/{orgs}/{baseName}/{tableName}/all":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"string"},"in":"query","name":"viewId"}],"patch":{"summary":"Bulk Update Table Rows with Conditions","operationId":"db-table-row-bulk-update-all","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{},"examples":{"Example 1":{"value":[{"Id":"1"},{"Id":"2"}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"foo"}}}}}},"description":"Bulk Update all Table Rows if the condition is true","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Bulk Delete Table Rows with Conditions","operationId":"db-table-row-bulk-delete-all","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"9gcl3ok7is3y0"},"type":"object"}},"examples":{"Example 1":{"value":[1,1]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"foo"}}}}}},"description":"Bulk Delete all Table Rows if the condition is true","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/views/{viewName}/export/{type}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true},{"schema":{"type":"string","enum":["csv","excel"]},"name":"type","in":"path","required":true}],"get":{"summary":"Export Table View Rows","operationId":"db-view-row-export","description":"Export Table View Rows by CSV or Excel","tags":["DB View Row"],"wrapped":true,"responses":{"200":{"description":"OK","content":{"application/octet-stream":{"schema":{}}},"headers":{"nc-export-offset":{"schema":{"type":"integer"},"description":"The starting offset of the next set of rows"}}},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/export/{type}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","enum":["csv","excel"]},"name":"type","in":"path","required":true}],"get":{"summary":"Export Table View Rows","operationId":"db-table-row-csv-export","description":"Export Table View Rows by CSV or Excel","tags":["DB Table Row"],"wrapped":true,"responses":{"200":{"description":"OK","content":{"application/octet-stream":{"schema":{}}},"headers":{"nc-export-offset":{"schema":{"type":"integer"},"description":"The starting offset of the next set of rows"}}},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/{rowId}/{relationType}/{columnName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt","oo"]},"name":"relationType","in":"path","required":true,"description":"Relation Type"},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true,"description":"Column Name"}],"get":{"summary":"List Nested Relations Rows","operationId":"db-table-row-nested-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"parameters":[{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"string"},"in":"query","name":"where"},{"$ref":"#/components/parameters/xc-auth"}],"description":"List all nested relations rows"}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/{rowId}/{relationType}/{columnName}/{refRowId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt","oo"]},"name":"relationType","in":"path","required":true},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true},{"schema":{"type":"string"},"name":"refRowId","in":"path","required":true}],"post":{"summary":"Create Nested Relations Row","operationId":"db-table-row-nested-add","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"m6jox00hxgd6s"},"example":"The relation data has been created successfully"}}},"examples":{"Example 1":{"value":{"msg":"The relation data has been created successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Create a new nested relations row"},"delete":{"summary":"Delete Nested Relations Row","operationId":"db-table-row-nested-remove","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"vo3x8xf3j2xlb"},"example":"The relation data has been deleted successfully"}}},"examples":{"Example 1":{"value":{"msg":"The relation data has been deleted successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"description":"Delete a new nested relations row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{baseName}/{tableName}/{rowId}/{relationType}/{columnName}/exclude":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"baseName","in":"path","required":true,"description":"Base Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt","oo"]},"name":"relationType","in":"path","required":true},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true}],"get":{"summary":"Referenced Table Rows Excluding Current Record\'s Children / Parent","operationId":"db-table-row-nested-children-excluded-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"parameters":[{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"string"},"in":"query","name":"where"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Get the table rows but exculding the current record\'s children and parent"}},"/api/v2/public/shared-view/{sharedViewUuid}/bulk/dataList":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"post":{"summary":"Read Shared View Bulk Data List","operationId":"public-data-table-bulk-data-list","description":"Read bulk data from a given table with provided filters","tags":["Public"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"}],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"type":"object"}}}}},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"alias":{"Id":1,"Title":"90","SingleSelect":"50"},"alias2":{"Id":2,"Title":"50","SingleSelect":"30"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v2/public/shared-view/{sharedViewUuid}/bulk/group":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"post":{"summary":"Read Shared View Bulk Group Data","operationId":"public-data-table-bulk-group","description":"Read bulk group data from a given table with provided filters","tags":["Public"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"}],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"type":"object"}}}}},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"alias":{"Id":1,"Title":"90","SingleSelect":"50"},"alias2":{"Id":2,"Title":"50","SingleSelect":"30"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v2/public/shared-view/{sharedViewUuid}/aggregate":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"Read Shared View Aggregated Data","operationId":"public-data-table-aggregate","description":"Read aggregated data from a given table","tags":["Public"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"schema":{"type":"array","description":"List of fields to be aggregated","items":{"type":"object"}},"in":"query","name":"aggregation","description":"Used for selective aggregation"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"90","SingleSelect":"50"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v2/public/shared-view/{sharedViewUuid}/downloadAttachment/{columnId}/{rowId}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"Get Shared View Attachment","operationId":"public-data-attachment-download","description":"Download attachment from a shared view","tags":["Public"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"urlOrPath","description":"URL or Path of the attachment"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"url":{"type":"string","description":"URL to download the attachment"},"path":{"type":"string","description":"Path to download the attachment"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/public/shared-view/{sharedViewUuid}/group/{columnId}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Shared View Grouped Data","operationId":"public-grouped-data-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"bldcv1pwuri5s"},"type":"object","properties":{"key":{"type":"string","x-stoplight":{"id":"n0ujmkbyhgsxo"},"description":"The Grouped Key"},"value":{"type":"object","x-stoplight":{"id":"0xsi3jvwn7duo"},"description":"the paginated result of the given key","required":["list","pageInfo"],"properties":{"list":{"type":"array","x-stoplight":{"id":"jw8dmo16txbjv"},"description":"List of the target data","items":{"x-stoplight":{"id":"xcu8vxmf5ygyi"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"1gsbgwi9bg8s5"},"description":"Paginated Info"}}}},"required":["key","value"]}},"examples":{"Example 1":{"value":[{"key":"a","value":{"list":[{"Id":2,"Title":"foo","s":"a"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":"b","value":{"list":[{"Id":3,"Title":"bar","s":"b"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":null,"value":{"list":[{"Id":1,"Title":"baz","s":null}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"description":"List Shared View Grouped Data"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/rows":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Shared View Rows","operationId":"public-data-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"schema":{"type":"string"},"in":"query","name":"pks","description":"Comma separated list of pks"}],"description":"List all shared view rows"},"post":{"summary":"Create Share View Row","operationId":"public-data-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"col1":"foo","col2":"bar","CreatedAt":"2023-03-11T08:48:25.598Z","UpdatedAt":"2023-03-11T08:48:25.598Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"multipart/form-data":{}},"description":""},"tags":["Public"],"parameters":[{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"description":"Create a new row for the target shared view"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/groupby":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Shared View Rows","operationId":"public-data-group-by","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"schema":{"type":"string"},"in":"query","name":"column_name","description":"Columns to group by"}],"description":"List all shared view rows grouped by a column"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/rows/{rowId}/{relationType}/{columnName}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt","oo"]},"name":"relationType","in":"path","required":true,"description":"Relation Type"},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true,"description":"Column Name"}],"get":{"summary":"List Nested List Data","operationId":"public-data-nested-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"gvblksjzjfyg7"},"description":"List of data objects","items":{"x-stoplight":{"id":"8assgoc1vtcs9"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"if546w1yuo6fw"},"description":"Paginated info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T08:41:41.356Z","UpdatedAt":"2023-03-11T08:41:41.356Z"},{"Id":2,"Title":"bar","CreatedAt":"2023-03-11T08:41:45.330Z","UpdatedAt":"2023-03-11T08:41:45.330Z"},{"Id":3,"Title":"baz","CreatedAt":"2023-03-11T08:48:25.598Z","UpdatedAt":"2023-03-11T08:48:25.598Z"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":1,"sort":"string","totalRows":3}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"description":"List all nested list data in a given shared view"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/rows/export/{type}":{"parameters":[{"schema":{"type":"string","example":"76d44b86-bc65-4500-8956-ab512c80ab25"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string","enum":["csv","excel"],"example":"csv"},"name":"type","in":"path","required":true,"description":"Export Type"}],"get":{"summary":"Export Rows in Share View","operationId":"public-csv-export","description":"Export all rows in Share View in a CSV / Excel Format","wrapped":true,"responses":{"200":{"description":"OK","content":{"application/octet-stream":{"schema":{}}},"headers":{"nc-export-offset":{"schema":{"type":"integer"},"description":"The starting offset of the next set of rows"}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"]}},"/api/v1/db/public/shared-view/{sharedViewUuid}/nested/{columnName}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true,"description":"Column Name"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Nested Data Relation","operationId":"public-data-relation-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"tags":["Public"],"description":"List Nested Data Relation"}},"/api/v1/db/public/shared-base/{sharedBaseUuid}/meta":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedBaseUuid","in":"path","required":true,"description":"Shared Base UUID"}],"get":{"summary":"Get Share Source Meta","operationId":"public-shared-base-get","description":"Get Share Source Meta","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"base_id":{"type":"string","description":"Base ID"}}},"examples":{"Example 1":{"value":{"base_id":"p_63b4q0qengen1x"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"]}},"/api/v1/db/public/shared-view/{sharedViewUuid}/meta":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"Get Share View Meta","operationId":"public-shared-view-meta-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/View"},{"type":"object","properties":{"relatedMetas":{},"client":{"type":"string"},"source_id":{"type":"string"},"columns":{"allOf":[{"anyOf":[{"$ref":"#/components/schemas/GridColumn"},{"$ref":"#/components/schemas/FormColumn"},{"$ref":"#/components/schemas/GalleryColumn"}]},{"$ref":"#/components/schemas/Column"}]},"model":{"$ref":"#/components/schemas/Table"}}},{"type":"object","properties":{"view":{"anyOf":[{"$ref":"#/components/schemas/Form"},{"$ref":"#/components/schemas/Grid"},{"$ref":"#/components/schemas/Gallery"}]}}}]}},"application/xml":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"description":"Get Share View Meta"}},"/api/v1/db/public/shared-erd/{sharedErdUuid}/meta":{"parameters":[{"schema":{"type":"string"},"name":"sharedErdUuid","in":"path","required":true}],"get":{"summary":"","operationId":"public-shared-erd-meta-get","tags":["Public"],"description":"","parameters":[]}},"/api/v1/db/meta/audits":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Audits","operationId":"utils-audit-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"x-stoplight":{"id":"5zto1xohsngbu"},"type":"array","items":{"$ref":"#/components/schemas/Audit","x-stoplight":{"id":"d22zkup0c0l80"}}}},"required":["list"]},"examples":{"Example 1":{"value":{"list":[{"id":"adt_3sii7erfwrlegb","user":"w@nocodb.com","display_name":"NocoDB","ip":null,"source_id":null,"base_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","op_type":"COMMENT","op_sub_type":null,"status":null,"description":"bar","details":null,"created_at":"2023-03-13T09:39:14.225Z","updated_at":"2023-03-13T09:39:14.225Z"},{"id":"adt_fezs668qbxj8gc","user":"w@nocodb.com","display_name":"NocoDB","ip":null,"source_id":null,"base_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","op_type":"COMMENT","op_sub_type":null,"status":null,"description":"foo","details":null,"created_at":"2023-03-13T09:39:13.321Z","updated_at":"2023-03-13T09:39:13.321Z"}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all audits","parameters":[{"schema":{"type":"string","example":"10"},"in":"query","name":"row_id","required":true,"description":"Row ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_c6csq89tl37jm5"},"in":"query","name":"fk_model_id","required":true,"description":"Foreign Key to Model"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Utils"]}},"/api/v1/db/meta/comments":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Comments","operationId":"utils-comment-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"x-stoplight":{"id":"5zto1xohsngbu"},"type":"array","items":{"$ref":"#/components/schemas/Comment","x-stoplight":{"id":"d22zkup0c0l80"}}}},"required":["list"]},"examples":{"Example 1":{"value":{"list":[{"id":"adt_3sii7erfwrlegb","source_id":null,"base_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","created_by":"","resolved_by":"","parent_comment_id":null,"status":null,"comment":"bar","created_at":"2023-03-13T09:39:14.225Z","updated_at":"2023-03-13T09:39:14.225Z"},{"id":"adt_3sii7erfwrlegb","source_id":null,"base_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","created_by":"","resolved_by":"","parent_comment_id":null,"status":null,"comment":"bar","created_at":"2023-03-13T09:39:14.225Z","updated_at":"2023-03-13T09:39:14.225Z"}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all comments","parameters":[{"schema":{"type":"string","example":"10"},"in":"query","name":"row_id","required":true,"description":"Row ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_c6csq89tl37jm5"},"in":"query","name":"fk_model_id","required":true,"description":"Foreign Key to Model"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Utils"]},"post":{"summary":"Comment Rows","operationId":"utils-comment-row","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Comment"},"examples":{"Example 1":{"value":{"id":"adt_3sii7erfwrlegb","source_id":null,"base_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","created_by":"","resolved_by":"","parent_comment_id":null,"status":null,"comment":"bar","created_at":"2023-03-13T09:39:14.225Z","updated_at":"2023-03-13T09:39:14.225Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentReq"},"examples":{"Example 1":{"value":{"description":"This is the comment for the row","fk_model_id":"md_ehn5izr99m7d45","row_id":"3"}}}}}},"tags":["Utils"],"description":"Create a new comment in a row.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/comment/{commentId}/":{"parameters":[{"schema":{"type":"string","example":"adt_zlskd6rlf3liay"},"name":"commentId","in":"path","required":true,"description":"Comment ID"},{"name":"xc-auth","in":"header","required":false,"schema":{"type":"string"},"description":"Auth Token is a JWT Token generated based on the logged-in user. By default, the token is only valid for 10 hours. However, you can change the value by defining it using environment variable NC_JWT_EXPIRES_IN."}],"patch":{"summary":"Update Comment","operationId":"utils-comment-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}}},"tags":["Utils"],"description":"Update comment","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentUpdateReq"},"examples":{"Example 1":{"value":{"comment":"This is the comment for the row"}}}}}}},"delete":{"summary":"Delete Comment","operationId":"utils-comment-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}}},"tags":["Utils"],"description":"Delete comment","requestBody":{"content":{}}}},"/api/v1/db/meta/comments/count":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Count Comments","operationId":"utils-comment-count","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"ziwcy4va5r1ao"},"type":"object","properties":{"count":{"type":"string","x-stoplight":{"id":"5r91gkxmaiyv4"},"description":"The number of comments","example":"4"},"row_id":{"type":"string","x-stoplight":{"id":"08sgorhq172sm"},"description":"Row ID","example":"1"}},"required":["count","row_id"]}},"examples":{"Example 1":{"value":[{"count":"4","row_id":"1"}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Return the number of comments in the given query.","parameters":[{"in":"query","name":"ids","required":true,"description":"Comment IDs"},{"schema":{"$ref":"#/components/schemas/Id"},"in":"query","name":"fk_model_id","required":true,"description":"Foreign Key to Model"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Utils"]}},"/api/v1/db/meta/projects/audits":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Audits in Project","operationId":"project-audit-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"items":{"$ref":"#/components/schemas/Audit"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all audit data in the given project","parameters":[{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"properties":{"created_at":{"type":"string","description":"Sort direction","enum":["asc","desc"],"example":"desc"},"user":{"type":"string","description":"Sort direction","enum":["asc","desc"],"example":"desc"}},"type":"object"},"in":"query","name":"orderBy"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Utils"]}},"/api/v1/db/meta/projects/{baseId}/audits":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"List Audits in Base","operationId":"base-audit-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"items":{"$ref":"#/components/schemas/Audit"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all audit data in the given base","parameters":[{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"string"},"in":"query","name":"sourceId"},{"schema":{"properties":{"created_at":{"type":"string","description":"Sort direction","enum":["asc","desc"],"example":"desc"},"user":{"type":"string","description":"Sort direction","enum":["asc","desc"],"example":"desc"}},"type":"object"},"in":"query","name":"orderBy"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"]}},"/api/v1/db/meta/audits/rows/{rowId}/update":{"parameters":[{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"post":{"summary":"Update Audit Row","operationId":"utils-audit-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Audit"},"examples":{"Example 1":{"value":{"user":"w@nocodb.com","row_id":"1","fk_model_id":"md_5mipbdg6ketmv8","op_type":"COMMENT","description":"Table Sheet-1 : field Column A got changed from foo to bar","base_id":"p_63b4q0qengen1x","id":"adt_vx58jpp0loo8qy"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditRowUpdateReq"},"examples":{"Example 1":{"value":{"column_name":"baz","fk_model_id":"md_ehn5izr99m7d45","row_id":"1","prev_value":"foo","value":"bar"}}}}}},"description":"Update Audit Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/hooks":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"List Table Hooks","operationId":"db-table-webhook-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookList"},"examples":{"Example 1":{"value":{"list":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all hook records in the given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["DB Table Webhook"]},"post":{"summary":"Create Table Hook","operationId":"db-table-webhook-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Hook"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Create a hook in the given table","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookReq"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook","condition":false}}}}}},"tags":["DB Table Webhook"]}},"/api/v1/db/meta/tables/{tableId}/hooks/test":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Test Hook","operationId":"db-table-webhook-test","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"l5k90tzuvvv1g"},"example":"The hook has been tested successfully"}}},"examples":{"Example 1":{"value":{"msg":"The hook has been tested successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookTestReq"},"examples":{"Example 1":{"value":{"hook":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"},"payload":{"data":{"Id":1,"Title":"Sample Text","CreatedAt":"2023-03-03T10:03:06.484Z","UpdatedAt":"2023-03-03T10:03:06.484Z","attachment":[{"url":"https://nocodb.com/dummy.png","title":"image.png","mimetype":"image/png","size":0}],"f":"Sample Output"}}}}}}}},"description":"Test the hook in the given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/hooks/samplePayload/{operation}/{version}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"},{"schema":{"type":"string","enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete"]},"name":"operation","in":"path","required":true,"description":"Hook Operation"},{"schema":{"type":"string","enum":["v1","v2"]},"name":"version","in":"path","required":true,"description":"Hook Version"}],"get":{"summary":"Get Sample Hook Payload","operationId":"db-table-webhook-sample-payload-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"object","x-stoplight":{"id":"qifsikf69hqbl"},"description":"Sample Payload Data"}}},"examples":{"Example 1":{"value":{"data":{"Id":1,"Title":"Sample Text","CreatedAt":"2023-03-13T04:59:49.363Z","UpdatedAt":"2023-03-13T04:59:49.363Z"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the sample hook payload","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["DB Table Webhook"]}},"/api/v1/db/meta/hooks/{hookId}":{"parameters":[{"schema":{"type":"string","example":"hk_0063k4o1frnxbr"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"}],"patch":{"summary":"Update Hook","operationId":"db-table-webhook-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Hook"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Hook"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}}}}}},"description":"Update the exsiting hook by its ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Hook","operationId":"db-table-webhook-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"description":"Delete the exsiting hook by its ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/plugins":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Plugins","operationId":"plugin-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/Plugin"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all plugins","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"]}},"/api/v1/db/meta/plugins/webhook":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Webhook List Plugins","operationId":"plugin-webhook-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/Plugin"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all webhook plugins","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"]}},"/api/v1/db/meta/plugins/{pluginTitle}/status":{"parameters":[{"schema":{"type":"string"},"name":"pluginTitle","in":"path","required":true,"description":"Plugin Title"}],"get":{"summary":"Get Plugin Status","operationId":"plugin-status","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Check plugin is active or not","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"],"x-internal":false}},"/api/v1/db/meta/plugins/test":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Test Plugin","operationId":"plugin-test","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Test if the plugin is working with the given configurations","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PluginTestReq"},"examples":{"Example 1":{"value":{"title":"Plugin Foo","input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}","category":"Email"}}}}}}}},"/api/v1/db/meta/plugins/{pluginId}":{"parameters":[{"schema":{"type":"string"},"name":"pluginId","in":"path","required":true,"description":"Plugin ID"}],"patch":{"summary":"Update Plugin","operationId":"plugin-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Plugin"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PluginReq"}}}},"description":"Update the plugin data by ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"x-internal":false},"get":{"summary":"Get Plugin","operationId":"plugin-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Plugin"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Plugin"],"description":"Get the plugin data by ID","x-internal":false}},"/api/v1/db/meta/connection/test":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Test DB Connection","operationId":"utils-test-connection","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"number"},"message":{"type":"string"},"data":{"type":"object","x-stoplight":{"id":"6orbk04w97ien"}}}},"examples":{"Example 1":{"value":{"code":0,"message":"","data":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"client":"mysql2","connection":{"host":"localhost","port":"3306","user":"root","password":"password","database":null}}},"properties":{"client":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3","databricks"],"example":"mysql2","type":"string"},"connection":{"type":"object","properties":{"host":{"type":"string"},"port":{"type":"string"},"user":{"type":"string"},"password":{"type":"string"},"database":{"$ref":"#/components/schemas/StringOrNull"}}}}},"examples":{"Example 1":{"value":{"client":"mysql2","connection":{"host":"localhost","port":"3306","user":"root","password":"password","database":null}}}}}}},"description":"Test the DB Connection","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/url_to_config":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Convert JDBC URL to Config","operationId":"utils-url-to-config","tags":["Utils"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"url":{"type":"string","x-stoplight":{"id":"fgdbmcjjtkky5"},"description":"JDBC URL","example":"jdbc:mysql://username:password@localhost:3306/sakila"}}},"examples":{"Example 1":{"value":{"url":"jdbc:mysql://username:password@localhost:3306/sakila"}}}}}},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"client":"mysql2","connection":{"user":"username","password":"password","database":"sakila","host":"localhost","port":"3306"}}},"properties":{"client":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3","databricks"],"example":"mysql2","type":"string"},"connection":{"type":"object","description":"Connection Config","properties":{"user":{"type":"string","description":"DB User"},"password":{"type":"string","description":"DB Password"},"database":{"type":"string","description":"DB Name"},"host":{"type":"string","description":"DB Host"},"port":{"type":"string","description":"DB Host"}}}}},"examples":{"Example 1":{"value":{"client":"mysql2","connection":{"user":"username","password":"password","database":"sakila","host":"localhost","port":"3306"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Extract XC URL From JDBC and parse to connection config","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/nocodb/info":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get App Info","operationId":"utils-app-info","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"authType":"jwt","baseHasAdmin":true,"firstUser":false,"type":"rest","googleAuthEnabled":false,"githubAuthEnabled":false,"oneClick":false,"connectToExternalDB":true,"version":"0.105.3","defaultLimit":25,"ncMin":false,"teleEnabled":false,"errorReportingEnabled":true,"auditEnabled":true,"ncSiteUrl":"http://localhost:8080","ee":false,"ncAttachmentFieldSize":20971520,"ncMaxAttachmentsAllowed":10}},"properties":{"authType":{"type":"string"},"baseHasAdmin":{"type":"boolean"},"firstUser":{"type":"boolean"},"type":{"type":"string"},"googleAuthEnabled":{"type":"boolean"},"githubAuthEnabled":{"type":"boolean"},"oneClick":{"type":"boolean"},"connectToExternalDB":{"type":"boolean"},"version":{"type":"string"},"defaultLimit":{"type":"number"},"ncMin":{"type":"boolean"},"teleEnabled":{"type":"boolean"},"errorReportingEnabled":{"type":"boolean"},"auditEnabled":{"type":"boolean"},"ncSiteUrl":{"type":"string"},"ee":{"type":"boolean"},"ncAttachmentFieldSize":{"type":"number"},"ncMaxAttachmentsAllowed":{"type":"number"},"isCloud":{"type":"boolean","x-stoplight":{"id":"bstdkpky2131f"}},"automationLogLevel":{"type":"string","x-stoplight":{"id":"uc3vaotye2eu8"},"enum":["OFF","ERROR","ALL"],"example":"OFF"}}},"examples":{"Example 1":{"value":{"authType":"jwt","baseHasAdmin":true,"firstUser":false,"type":"rest","googleAuthEnabled":false,"githubAuthEnabled":false,"oneClick":false,"connectToExternalDB":true,"version":"0.105.3","defaultLimit":25,"ncMin":false,"teleEnabled":false,"errorReportingEnabled":true,"auditEnabled":true,"ncSiteUrl":"http://localhost:8080","ee":false,"ncAttachmentFieldSize":20971520,"ncMaxAttachmentsAllowed":10,"isCloud":false,"automationLogLevel":"OFF"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get the application info such as authType, defaultLimit, version and etc.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/error-reporting":{"post":{"summary":"Error Reporting","operationId":"utils-error-report","responses":{},"description":"Error Reporting","tags":["Utils","Internal"],"requestBody":{"content":{"application/json":{"$ref":"#/components/schemas/ErrorReportReq"}}}}},"/api/v1/db/meta/axiosRequestMake":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Axios Request","operationId":"utils-axios-request-make","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Generic Axios Call","requestBody":{"content":{"application/json":{"schema":{"type":"object"}}}},"tags":["Utils"],"x-internal":true,"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/version":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get App Version","operationId":"utils-app-version","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"currentVersion":"0.105.3","releaseVersion":"0.105.3"}},"properties":{"currentVersion":{"type":"string","description":"Current NocoDB Version","example":"0.104.0"},"releaseVersion":{"type":"string","description":"Latest Release Version","example":"0.105.3"}}},"examples":{"Example 1":{"value":{"currentVersion":"0.104.0","releaseVersion":"0.105.3"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get the application version","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/health":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get Application Health Status","operationId":"utils-app-health","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"message":"OK","timestamp":1678702175755,"uptime":1618.996877834}},"properties":{"message":{"type":"string","example":"OK"},"timestamp":{"type":"string","example":"1678702175755"},"uptime":{"type":"string","example":"1618.996877834"}}},"examples":{"Example 1":{"value":{"message":"OK","timestamp":1678702175755,"uptime":1618.996877834}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get Application Health Status","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/feed":{"get":{"summary":"Get Feed","operationId":"utils-feed","parameters":[{"schema":{"type":"string","enum":["all","github","youtube","cloud"]},"name":"type","in":"query","required":false},{"schema":{"type":"number"},"name":"per_page","in":"query","required":false},{"schema":{"type":"number"},"name":"page","in":"query","required":false}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"Id":{"type":"string"},"Description":{"type":"string"},"Tags":{"type":"string"},"Images":{"type":"array","items":{"type":"object"}},"Url":{"type":"string"},"Published Time":{"type":"string"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"]}},"/api/v1/aggregated-meta-info":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get Aggregated Meta Info","operationId":"utils-aggregated-meta-info","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"baseCount":{"type":"integer"},"bases":{"type":"array","items":{"type":"object","properties":{"tableCount":{"type":"object","properties":{"table":{"type":"integer","description":"Table Count"},"view":{"type":"integer","description":"View Count"}}},"external":{"type":"boolean","description":"External Base","default":false},"viewCount":{"type":"object","properties":{"formCount":{"type":"integer","description":"Form Count"},"gridCount":{"type":"integer","description":"Grid Count"},"galleryCount":{"type":"integer","description":"Gallery Count"},"kanbanCount":{"type":"integer","description":"Kanban Count"},"calendarCount":{"type":"integer","description":"Calendar Count"},"total":{"type":"integer","description":"Total View Count"},"sharedFormCount":{"type":"integer","description":"Shared Form Count"},"sharedGridCount":{"type":"integer","description":"Shared Grid Count"},"sharedGalleryCount":{"type":"integer","description":"Shared Gallery Count"},"sharedKanbanCount":{"type":"integer","description":"Shared Kanban Count"},"sharedCalendarCount":{"type":"integer","description":"Shared Calendar Count"},"sharedTotal":{"type":"integer","description":"Shared Total View Count"},"sharedLockedCount":{"type":"integer","description":"Shared Locked View Count"}}},"webhookCount":{"type":"integer","description":"Webhook Count"},"filterCount":{"type":"integer","description":"Filter Count"},"sortCount":{"type":"integer","description":"Sort Count"},"rowCount":{"type":"array","items":{"type":"object","properties":{"TotalRecords":{"type":"string"}}},"description":"Row Count"},"userCount":{"type":"integer","description":"Total base user Count"}}}},"userCount":{"type":"integer","description":"Total user Count"},"sharedBaseCount":{"type":"integer","description":"Total shared base Count"}},"x-examples":{"Example 1":{"baseCount":1,"bases":[{"tableCount":{"table":3,"view":0},"external":false,"viewCount":{"formCount":0,"gridCount":3,"galleryCount":0,"kanbanCount":0,"calendarCount":0,"total":3,"sharedFormCount":0,"sharedGridCount":0,"sharedGalleryCount":0,"sharedKanbanCount":0,"sharedCalendarCount":0,"sharedTotal":0,"sharedLockedCount":0},"webhookCount":0,"filterCount":0,"sortCount":0,"rowCount":[{"TotalRecords":"76"}],"userCount":1}],"userCount":1,"sharedBaseCount":0}}},"examples":{"example-1":{"value":{"baseCount":1,"bases":[{"tableCount":{"table":3,"view":0},"external":false,"viewCount":{"formCount":0,"gridCount":3,"galleryCount":0,"kanbanCount":0,"calendarCount":0,"total":3,"sharedFormCount":0,"sharedGridCount":0,"sharedGalleryCount":0,"sharedKanbanCount":0,"sharedCalendarCount":0,"sharedTotal":0,"sharedLockedCount":0},"webhookCount":0,"filterCount":0,"sortCount":0,"rowCount":[{"TotalRecords":"76"}],"userCount":1}],"userCount":1,"sharedBaseCount":0}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get Aggregated Meta Info such as tableCount, dbViewCount, viewCount and etc.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/cache":{"get":{"summary":"Get Cache","tags":["Utils"],"responses":{},"operationId":"utils-cache-get","description":"Get All K/V pairs in NocoCache","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Cache","operationId":"utils-cache-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Delete All K/V pairs in NocoCache","tags":["Utils"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/db/meta/projects/{baseId}/api-tokens":{"get":{"summary":"List API Tokens in Base","tags":["API Token"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenList"},"examples":{"Example 1":{"value":{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"operationId":"api-token-list","description":"List API Tokens in the given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create API Token","operationId":"api-token-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiToken"},"examples":{"Example 1":{"value":{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenReq"},"examples":{"Example 1":{"value":{"description":"This API token is for ABC application"}}}}},"description":""},"tags":["API Token"],"description":"Create API Token in a base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}]},"/api/v1/db/meta/projects/{baseId}/api-tokens/{tokenId}":{"delete":{"summary":"Delete API Token","operationId":"api-token-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["API Token"],"description":"Delete the given API Token in base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"type":"string","example":"DYh540o8hbWpU"},"name":"tokenId","in":"path","required":true,"description":"API Token ID"}]},"/api/v1/db/storage/upload":{"post":{"summary":"Attachment Upload","operationId":"storage-upload","responses":{},"tags":["Storage"],"requestBody":{"content":{"multipart/form-data":{"schema":{"type":"object","properties":{"files":{"type":"array","required":true,"items":{"$ref":"#/components/schemas/FileReq"}}}},"examples":{"Example 1":{"value":{"files":[{"mimetype":"image/jpeg","fieldname":"files","originalname":"22bc-kavypmq4869759 (1).jpg","encoding":"7bit","size":13052,"buffer":"<Buffer 89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00 03 20 00 00 02 58 08 02 00 00 00 15 14 15 27 00 00 00 09 70 48 59 73 00 00 0b 13 00 00 0b 13 01 >"}]}}}}},"description":""},"parameters":[{"schema":{"type":"string","example":"download/noco/jango_fett/Table1/attachment/uVbjPVQxC_SSfs8Ctx.jpg"},"name":"path","in":"query","required":true,"description":"Target File Path"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Upload attachment"}},"/api/v1/db/storage/upload-by-url":{"post":{"summary":"Attachment Upload by URL","operationId":"storage-upload-by-url","responses":{},"tags":["Storage"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/AttachmentReq"}},"examples":{}}}},"parameters":[{"schema":{"type":"string","example":"download/noco/jango_fett/Table1/attachment/c7z_UF8sZBgJUxMjpN.jpg"},"name":"path","in":"query","description":"Target File Path","required":true},{"$ref":"#/components/parameters/xc-auth"}],"description":"Upload attachment by URL. Used in Airtable Migration."}},"/api/v1/db/meta/projects/{baseId}/users/{userId}/resend-invite":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"post":{"summary":"Resend User Invitation","operationId":"auth-base-user-resend-invite","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"m570oh5j3afjt"},"description":"Success Message","example":"The invitation has been sent to the user"}}},"examples":{"Example 1":{"value":{"msg":"The invitation has been sent to the user"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Resend Invitation to a specific user","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/notifications/poll":{"get":{"summary":"Notification Poll","operationId":"notification-poll","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["Notification"],"description":"Poll notifications"}},"/api/v1/notifications":{"get":{"summary":"Notification list","operationId":"notification-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationList"}}}}},"tags":["Notification"],"description":"List notifications","parameters":[{"schema":{"type":"boolean"},"name":"is_read","in":"query","required":false},{"schema":{"type":"number"},"name":"limit","in":"query","required":false},{"schema":{"type":"number"},"name":"offset","in":"query","required":false}]}},"/api/v1/notifications/{notificationId}":{"patch":{"summary":"Notification update","operationId":"notification-update","responses":{"200":{"description":"OK"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationUpdate"}}}},"tags":["Notification"],"description":"Notificattion update"},"delete":{"summary":"Delete notification","operationId":"notification-delete","responses":{"200":{"description":"OK"}},"tags":["Notification"],"description":"Delete notification"},"parameters":[{"schema":{"type":"string"},"name":"notificationId","in":"path","required":true}]},"/api/v1/notifications/mark-all-read":{"post":{"summary":"Mark all notifications as read","operationId":"notification-mark-all-as-read","responses":{"200":{"description":"OK"}},"tags":["Notification"],"description":"Mark all notifications as read"}},"/api/v1/db/meta/tables/{tableId}/columns/hash":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"Get columns hash for table","operationId":"db-table-column-hash","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"hash":{"type":"string","description":"Columns hash"}}}}}}},"tags":["DB Table Column"],"description":"Get columns hash for table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/columns/bulk":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Bulk create-update-delete columns","operationId":"db-table-column-bulk","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"failedOps":{"type":"array","items":{"schema":{"type":"object","properties":{"op":{"type":"string","enum":["add","update","delete"],"required":true},"column":{"$ref":"#/components/schemas/Column","required":true},"error":{}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"hash":{"type":"string","description":"Columns hash"},"ops":{"type":"array","items":{"schema":{"type":"object","properties":{"op":{"type":"string"},"column":{"type":"object"}}}}}}}}}},"tags":["DB Table Column"],"description":"Bulk create-update-delete columns","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/tables/{tableId}/aggregate":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"required":true,"name":"viewId","in":"query","description":"View ID is required"},{"schema":{"type":"array","description":"List of fields to be aggregated","items":{"type":"object"}},"in":"query","name":"aggregation","description":"Used for selective aggregation"}],"get":{"summary":"Read Aggregated Data","operationId":"db-data-table-aggregate","description":"Read aggregated data from a given table","tags":["DB Data Table Aggregate"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"90","SingleSelect":"50"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v2/tables/{tableId}/records":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"name":"viewId","in":"query","description":"View ID"}],"get":{"summary":"List Table Rows","operationId":"db-data-table-row-list","description":"List all table rows in a given table","tags":["DB Data Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"schema":{"type":"string"},"in":"query","name":"pks","description":"Comma separated list of pks"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","description":"List of data objects","items":{"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Table Rows","operationId":"db-data-table-row-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Data Table Row"],"requestBody":{"content":{"application/json":{"schema":{"oneOf":[{"type":"object"},{"type":"array","items":{"type":"object"}}]},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"description":"Create a new row in a given table and base.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table Rows","operationId":"db-data-table-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Data Table Row"],"requestBody":{"content":{"application/json":{"schema":{"oneOf":[{"type":"object"},{"type":"array","items":{"type":"object"}}]},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"description":"Create a new row in a given table and base.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table Rows","operationId":"db-data-table-row-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Data Table Row"],"requestBody":{"content":{"application/json":{"schema":{"oneOf":[{"type":"object"},{"type":"array","items":{"type":"object"}}]},"examples":{"Example 1":{"value":[{"Id":1}]}}}}},"description":"Create a new row in a given table and base.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/tables/{tableId}/records/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"name":"rowId","in":"path","required":true,"description":"Row ID"},{"schema":{"type":"string"},"name":"viewId","in":"query","description":"View ID"}],"get":{"summary":"Read Table Row","operationId":"db-data-table-row-read","description":"Get table row in a given table","tags":["DB Data Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v2/tables/{tableId}/records/count":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"name":"viewId","in":"query","description":"View ID"}],"get":{"summary":"Table Rows Count","operationId":"db-data-table-row-count","description":"Count of rows in a given table","tags":["DB Data Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"number"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v2/tables/{tableId}/links/{columnId}/records/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"name":"viewId","in":"query","description":"View ID"}],"get":{"summary":"Get Nested Relations Rows","operationId":"db-data-table-row-nested-list","description":"Linked rows in a given Links/LinkToAnotherRecord column","tags":["DB Data Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","description":"List of data objects","items":{"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Nested Relations Rows","operationId":"db-data-table-row-nested-link","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Data Table Row"],"requestBody":{"content":{"application/json":{"schema":{"oneOf":[{"type":"object"},{"type":"array","items":{"type":"object"}}]},"examples":{"Example 1":{"value":[{"Id":1}]}}}}},"description":"Create a link with the row.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Nested Relations Rows","operationId":"db-data-table-row-nested-unlink","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Data Table Row"],"requestBody":{"content":{"application/json":{"schema":{"oneOf":[{"type":"object"},{"type":"array","items":{"type":"object"}}]},"examples":{"Example 1":{"value":[{"Id":1}]}}}}},"description":"Create a new row in a given table and base.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/downloadAttachment/{modelId}/{columnId}/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"modelId","in":"path","required":true,"description":"Model ID"},{"schema":{"type":"string"},"name":"columnId","in":"path","required":true,"description":"Column ID"},{"schema":{"type":"string"},"name":"rowId","in":"path","required":true,"description":"Row ID"},{"schema":{"type":"string"},"name":"urlOrPath","in":"query","description":"URL or Path of the attachment"}],"get":{"summary":"Download Attachment","operationId":"db-data-table-row-attachment-download","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"url":{"type":"string","description":"URL to download attachment"},"path":{"type":"string","description":"Path to download attachment"}}}}}}},"tags":["DB Data Table Row"],"description":"Download attachment from a given row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/tables/{tableId}/links/{columnId}/records":{"parameters":[{"schema":{"type":"string"},"name":"tableId","in":"path","required":true,"description":"Table ID"},{"schema":{"type":"string"},"name":"viewId","in":"query","description":"View ID"}],"post":{"summary":"Copy paste or deleteAll nested link","operationId":"db-data-table-row-nested-list-copy-paste-or-deleteAll","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}},"examples":{"Example 1":{"value":{"link":[{"Id":1},{"Id":2},{"Id":3},{"Id":5},{"Id":6}],"unlink":[{"Id":4}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Data Table Row"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/nestedListCopyPasteOrDeleteAllReq"},"examples":{"Example 1":{"value":[{"operation":"copy","rowId":"1","columnId":"ca2ppiy8raidc09","fk_related_model_id":"m797s6vbrqvo2pv"},{"operation":"paste","rowId":"2","columnId":"ca2ppiy8raidc09","fk_related_model_id":"m797s6vbrqvo2pv"}]},"Example 2":{"value":[{"operation":"deleteAll","rowId":"1","columnId":"ca2ppiy8raidc09","fk_related_model_id":"m797s6vbrqvo2pv"}]}}}}},"description":"Copy links from the one cell and paste them into another cell or delete all records from cell","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/command_palette":{"parameters":[],"post":{"summary":"Get command palette suggestions","operationId":"utils-command-palette","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}},"tags":["Utils"],"requestBody":{"content":{"application/json":{}}},"description":"Get dynamic command palette suggestions based on scope"}},"/api/v2/extensions/{baseId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"Get Extensions","operationId":"extensions-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","items":{"type":"object"}}}}}}}},"tags":["Extensions"],"description":"Get all extensions for a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Extension","operationId":"extensions-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}},"tags":["Extensions"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"}}}},"description":"Create a new extension for a given base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/extensions/{extensionId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"ext124dflkcvasewh","type":"string"},"name":"extensionId","in":"path","required":true,"description":"Unique Extension ID"}],"get":{"summary":"Get Extension","operationId":"extensions-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["Extensions"],"description":"Get extension details","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Extension","operationId":"extensions-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}},"tags":["Extensions"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"}}}},"description":"Update extension details","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Extension","operationId":"extensions-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}},"tags":["Extensions"],"description":"Delete extension","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/jobs/listen":{"post":{"summary":"Jobs Listen","operationId":"jobs-listen","description":"Listen for job events","tags":["Jobs"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v2/jobs/{baseId}":{"post":{"summary":"Get Jobs","operationId":"jobs-list","description":"Get list of jobs for a given base for the user","tags":["Jobs"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"job":{"type":"string"},"status":{"type":"string"}}}}}}},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p124dflkcvasewh","type":"string"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"},{"$ref":"#/components/parameters/xc-auth"}]},"/api/v2/export/{viewId}/{exportAs}":{"post":{"summary":"Trigger export as job","operationId":"export-data","description":"Trigger export as job","tags":["Export"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"}}}}},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw124dflkcvasewh","type":"string"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"},{"schema":{"type":"string","enum":["csv"]},"name":"exportAs","in":"path","required":true,"description":"Export as format"},{"$ref":"#/components/parameters/xc-auth"}]},"/api/v2/meta/hooks/{hookId}/trigger/{rowId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"post":{"summary":"Trigger Manual Hook","operationId":"db-table-webhook-trigger","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"description":"Trigger the manual WebHook","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v2/meta/integrations":{"get":{"summary":"List integrations","operationId":"integration-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IntegrationList"}}}}},"tags":["Integration"],"description":"List integrations","parameters":[{"schema":{"$ref":"#/components/schemas/Integrations"},"name":"type","in":"query"},{"schema":{"type":"boolean"},"name":"includeDatabaseInfo","in":"query"},{"schema":{"type":"number"},"name":"limit","in":"query"},{"schema":{"type":"number"},"name":"offset","in":"query"},{"schema":{"type":"string"},"name":"baseId","in":"query"},{"schema":{"type":"string"},"name":"query","in":"query"}]},"post":{"summary":"Create integration","operationId":"integration-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Integration"}}}}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IntegrationReq"}}}},"tags":["Integration"],"description":"Create integration"}},"/api/v2/meta/integrations/{integrationId}":{"get":{"summary":"Read integration","operationId":"integration-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Integration"}}}}},"tags":["Integration"],"description":"Read integration","parameters":[{"schema":{"type":"boolean"},"name":"includeConfig","in":"query"},{"schema":{"type":"boolean"},"name":"includeSources","in":"query"}]},"patch":{"summary":"Update integration","operationId":"integration-update","responses":{"200":{"description":"OK"}},"tags":["Integration"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IntegrationReq"}}}},"description":"Update integration"},"delete":{"summary":"Delete integration","operationId":"integration-delete","responses":{"200":{"description":"OK"}},"tags":["Integration"],"description":"Delete integration"},"parameters":[{"schema":{"type":"string"},"name":"integrationId","in":"path","required":true}]}},"components":{"schemas":{"ApiToken":{"description":"Model for API Token","examples":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"title":"API Token Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique API Token ID"},"fk_user_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to User"},"description":{"type":"string","description":"API Token Description","example":"This API Token is for ABC application"},"token":{"type":"string","description":"API Token","example":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}},"x-stoplight":{"id":"c7i7cfci4kobt"}},"ApiTokenReq":{"description":"Model for API Token Request","examples":[{"description":"This API token is for ABC application"}],"title":"API Token Request Model","type":"object","properties":{"description":{"description":"Description of the API token","maxLength":255,"type":"string","example":"This API Token is for ABC application"}},"x-stoplight":{"id":"53ux6deypkuwb"}},"ApiTokenList":{"description":"Model for API Token List","x-stoplight":{"id":"t24xmch4x2o30"},"examples":[{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"API Token List Model","type":"object","properties":{"list":{"type":"array","example":[{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"x-stoplight":{"id":"c7xu43yjgyjww"},"description":"List of api token objects","items":{"$ref":"#/components/schemas/ApiToken","x-stoplight":{"id":"5ih4l0ix2tr5q"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"0w8ktfnx3pusz"},"description":"Model for Paginated"}},"required":["list","pageInfo"]},"Attachment":{"description":"Model for Attachment","examples":[{"data":null,"mimetype":"image/jpeg","path":"download/noco/jango_fett/Table1/attachment/c7z_UF8sZBgJUxMjpN.jpg","size":12345,"title":"kavypmq4869759.jpg"}],"title":"Attachment Model","type":"object","properties":{"data":{"description":"Data for uploading"},"mimetype":{"type":"string","description":"The mimetype of the attachment"},"path":{"type":"string","description":"File Path"},"size":{"type":"number","description":"Attachment Size"},"title":{"type":"string","description":"The title of the attachment. Used in UI."},"url":{"type":"string","description":"Attachment URL"}},"x-stoplight":{"id":"mjewsbpmazrwe"}},"AttachmentReq":{"description":"Model for Attachment Request","type":"object","x-examples":{"Example 1":{"mimetype":"image/jpeg","path":"download/noco/jango_fett/Table1/attachment/uVbjPVQxC_SSfs8Ctx.jpg","size":13052,"title":"22bc-kavypmq4869759 (1).jpg"}},"title":"Attachment Request Model","properties":{"mimetype":{"type":"string","description":"The mimetype of the attachment"},"path":{"type":"string","description":"The file path of the attachment"},"size":{"type":"number","description":"The size of the attachment"},"title":{"type":"string","description":"The title of the attachment used in UI"},"url":{"type":"string","description":"Attachment URL to be uploaded via upload-by-url"},"fileName":{"type":"string","description":"The name of the attachment file name"}},"x-stoplight":{"id":"6cr1iwhbyxncd"}},"AttachmentRes":{"description":"Model for Attachment Response","oneOf":[{"type":"object","x-examples":{"Example 1":{"mimetype":"image/jpg","size":32903,"title":"Random-Pictures-of-Conceptual-and-Creative-Ideas-02.jpg","path":"download/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg","signedPath":"dltemp/lNoLbqB62Jdo5Rmp/1709308800000/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg"},"Example 2":{"mimetype":"image/jpeg","size":146143,"title":"2 be loved.jpeg","url":"https://some-s3-server.com/nc/uploads/2023/10/16/some-key/3niqHLngUKiU2Hupe8.jpeg","signedUrl":"https://some-s3-server.com/nc/uploads/2023/10/16/signed-url-misc-info"}},"properties":{"mimetype":{"type":"string","description":"The mimetype of the attachment"},"path":{"type":"string","description":"The attachment stored path"},"size":{"type":"number","description":"The size of the attachment"},"title":{"type":"string","description":"The title of the attachment used in UI"},"url":{"type":"string","description":"The attachment stored url"},"signedPath":{"type":"string","description":"Attachment signedPath will allow to access attachment directly"},"signedUrl":{"type":"string","description":"Attachment signedUrl will allow to access attachment directly"}}},{"type":"null"}],"title":"Attachment Response Model"},"FileReq":{"description":"Model for File Request","type":"object","x-examples":{"Example 1":{"mimetype":"image/jpeg","fieldname":"files","originalname":"22bc-kavypmq4869759 (1).jpg","encoding":"7bit","size":13052,"buffer":"<Buffer 89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00 03 20 00 00 02 58 08 02 00 00 00 15 14 15 27 00 00 00 09 70 48 59 73 00 00 0b 13 00 00 0b 13 01 >"}},"title":"File Request Model","properties":{"mimetype":{"type":"string","description":"The mimetype of the file"},"fieldname":{"type":"string","description":"The name of the input used to upload the file"},"originalname":{"type":"string","description":"The original name of the file"},"size":{"type":"number","description":"The size of the file"},"encoding":{"type":"string","description":"The encoding of the file"},"buffer":{"description":"An buffer array containing the file content"}},"x-stoplight":{"id":null}},"Audit":{"description":"Model for Audit","examples":[{"id":"adt_l5we7pkx70vaao","user":"w@nocodb.com","display_name":"NocoDB","ip":"::ffff:127.0.0.1","source_id":"ds_3l9qx8xqksenrl","base_id":"p_9sx43moxhqtjm3","fk_model_id":"md_ehn5izr99m7d45","row_id":"rec0Adp9PMG9o7uJy","op_type":"AUTHENTICATION","op_sub_type":"UPDATE","status":"string","description":"Table nc_snms___Table_1 : field Date got changed from  2023-03-12 to ","details":"<span class=\\"\\">Date</span>   : <span class=\\"text-decoration-line-through red px-2 lighten-4 black--text\\">2023-03-12</span>   <span class=\\"black--text green lighten-4 px-2\\"></span>"}],"title":"Audit Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"user":{"type":"string","description":"The user name performing the action","example":"w@nocodb.com"},"display_name":{"type":"string","description":"The display name of user performing the action","example":"NocoDB"},"ip":{"type":"string","example":"::ffff:127.0.0.1","description":"IP address from the user"},"source_id":{"type":"string","description":"Source ID in where action is performed","example":"ds_3l9qx8xqksenrl"},"base_id":{"type":"string","description":"Base ID in where action is performed","example":"p_9sx43moxhqtjm3"},"fk_model_id":{"type":"string","description":"Model ID in where action is performed","example":"md_ehn5izr99m7d45"},"row_id":{"type":"string","description":"Row ID","example":"rec0Adp9PMG9o7uJy"},"op_type":{"type":"string","description":"Operation Type","example":"AUTHENTICATION","enum":["COMMENT","DATA","PROJECT","VIRTUAL_RELATION","RELATION","TABLE_VIEW","TABLE","VIEW","META","WEBHOOKS","AUTHENTICATION","TABLE_COLUMN","ORG_USER"]},"op_sub_type":{"type":"string","description":"Operation Sub Type","example":"UPDATE","enum":["UPDATE","INSERT","BULK_INSERT","BULK_UPDATE","BULK_DELETE","LINK_RECORD","UNLINK_RECORD","DELETE","CREATE","RENAME","IMPORT_FROM_ZIP","EXPORT_TO_FS","EXPORT_TO_ZIP","SIGNIN","SIGNUP","PASSWORD_RESET","PASSWORD_FORGOT","PASSWORD_CHANGE","EMAIL_VERIFICATION","ROLES_MANAGEMENT","INVITE","RESEND_INVITE"]},"status":{"type":"string","description":"Audit Status"},"description":{"type":"string","description":"Description of the action","example":"Table nc_snms___Table_1 : field Date got changed from  2023-03-12 to "},"details":{"type":"string","description":"Detail","example":"<span class=\\"\\">Date</span>   : <span class=\\"text-decoration-line-through red px-2 lighten-4 black--text\\">2023-03-12</span>   <span class=\\"black--text green lighten-4 px-2\\"></span>"}},"x-stoplight":{"id":"n44nqsmhm56c7"}},"AuditRowUpdateReq":{"description":"Model for Audit Row Update Request","examples":[{"column_name":"baz","fk_model_id":"md_ehn5izr99m7d45","row_id":"rec0Adp9PMG9o7uJy","prev_value":"foo","value":"bar"}],"title":"Audit Row Update Request Model","type":"object","properties":{"column_name":{"type":"string","description":"Column Name","example":"baz"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_ehn5izr99m7d45"},"row_id":{"type":"string","example":"rec0Adp9PMG9o7uJy","description":"Row ID"},"prev_value":{"description":"The previous value before the action"},"value":{"description":"The current value after the action"}},"x-stoplight":{"id":"2fzwvc4m1k5or"}},"Source":{"description":"Model for Source","examples":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"base_id":"p_01clqvzik3izk6","type":"mysql2"}],"title":"Source Model","type":"object","properties":{"alias":{"$ref":"#/components/schemas/StringOrNull","description":"Source Name"},"integration_title":{"$ref":"#/components/schemas/StringOrNull","description":"Integration Name"},"fk_integration_id":{"$ref":"#/components/schemas/StringOrNull","description":"Integration Id"},"config":{"description":"Source Configuration"},"enabled":{"$ref":"#/components/schemas/Bool","description":"Is this source enabled"},"id":{"description":"Unique Source ID","type":"string"},"inflection_column":{"description":"Inflection for columns","example":"camelize","type":"string"},"inflection_table":{"description":"Inflection for tables","example":"camelize","type":"string"},"is_meta":{"$ref":"#/components/schemas/Bool","description":"Is the data source connected externally"},"is_local":{"$ref":"#/components/schemas/Bool","description":"Is the data source minimal db"},"is_schema_readonly":{"$ref":"#/components/schemas/Bool","description":"Is the data source schema readonly"},"is_data_readonly":{"$ref":"#/components/schemas/Bool","description":"Is the data source data readonly"},"order":{"description":"The order of the list of sources","example":1,"type":"number"},"base_id":{"description":"The base ID that this source belongs to","type":"string"},"type":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3","databricks"],"example":"mysql2","type":"string"}},"x-stoplight":{"id":"qyzsky82ovjiv"}},"Integration":{"description":"Model for Integration","examples":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","meta":null,"order":1,"type":"mysql2"}],"title":"Source Model","type":"object","properties":{"title":{"$ref":"#/components/schemas/StringOrNull","description":"Source Name - Default BASE will be null by default"},"config":{"description":"Source Configuration"},"enabled":{"$ref":"#/components/schemas/Bool","description":"Is this Intgration enabled"},"id":{"description":"Unique Integration ID","type":"string"},"fk_workspace_id":{"description":"Unique Workspace ID","type":"string"},"order":{"description":"The order of the list of sources","example":1,"type":"number"},"base_id":{"description":"The base ID that this source belongs to","type":"string"},"is_private":{"$ref":"#/components/schemas/Bool"},"type":{"$ref":"#/components/schemas/Integrations"},"sub_type":{"description":"DB Type","example":"mysql2","type":"string"},"created_by":{"description":"DB Type","example":"mysql2","type":"string"}},"x-stoplight":{"id":"qyzsky82ovjiv"}},"BaseList":{"description":"Model for Source List","examples":[{"list":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"base_id":"p_01clqvzik3izk6","type":"mysql2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Source List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"sakila","config":"<ENCRYPTED>","created_at":"2023-03-02 11:28:17","enabled":1,"id":"ds_btbdt19zde0gj9","inflection_column":"camelize","inflection_table":"camelize","is_meta":null,"meta":null,"order":2,"base_id":"p_01clqvzik3izk6","type":"mysql2","updated_at":"2023-03-02 11:28:17"},{"alias":null,"config":"<ENCRYPTED>","created_at":"2023-03-01 16:31:49","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"base_id":"p_01clqvzik3izk6","type":"mysql2","updated_at":"2023-03-02 11:28:17"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":2,"totalRows":2}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"1q3ny60j1g4z2"},"description":"List of source objects","items":{"$ref":"#/components/schemas/Source","x-stoplight":{"id":"udd0nrcv6pq8d"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"xqwcniocq37hk"},"description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"tty21vb01bfr0"}},"BaseReq":{"description":"Model for Source Request","examples":[{"alias":"My Source","config":null,"inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"type":"mysql"}],"properties":{"alias":{"description":"Source Name - Default BASE will be null by default","example":"My Source","maxLength":128,"type":"string"},"config":{"description":"Source Configuration"},"inflection_column":{"description":"Inflection for columns","example":"camelize","type":"string"},"inflection_table":{"description":"Inflection for tables","example":"camelize","type":"string"},"is_meta":{"description":"Is the data source connected externally","type":"boolean"},"is_local":{"description":"Is the data source minimal db","type":"boolean"},"is_schema_readonly":{"$ref":"#/components/schemas/Bool","description":"Is the data source schema readonly"},"is_data_readonly":{"$ref":"#/components/schemas/Bool","description":"Is the data source data readonly"},"type":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3","databricks"],"type":"string"},"fk_integration_id":{"type":"string"}},"title":"Source Request","type":"object","x-stoplight":{"id":"ky2ak9xsyl3b5"}},"Integrations":{"type":"string","description":"Integration Type","enum":["database"]},"IntegrationReq":{"description":"Model for Integration Request","examples":[{"title":"My Source","config":{},"type":"db"}],"properties":{"title":{"description":"Integration Name - Default BASE will be null by default","example":"Integration","maxLength":128,"type":"string"},"config":{"description":"Source Configuration"},"meta":{"description":"Integration metas"},"type":{"$ref":"#/components/schemas/Integrations"},"sub_type":{"description":"Sub Type","type":"string"},"copy_from_id":{"$ref":"#/components/schemas/StringOrNull","description":"ID of integration to be copied from. Used in Copy Integration."}},"title":"Source Request","type":"object","x-stoplight":{"id":"ky2ak9xsyl3b5"},"required":["title","config","type"]},"Bool":{"description":"Model for Bool","examples":[true],"oneOf":[{"description":"0 or 1","example":0,"type":"integer"},{"description":"true or false","type":"boolean"},{"type":"null"}],"title":"Bool Model","x-stoplight":{"id":"y0m76u8t9x2tn"}},"Column":{"description":"Model for Column","examples":[{"ai":0,"au":0,"source_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"title":"Column Model","type":"object","properties":{"ai":{"$ref":"#/components/schemas/Bool","description":"Is Auto-Increment?"},"au":{"$ref":"#/components/schemas/Bool","description":"Auto Update Timestamp"},"description":{"$ref":"#/components/schemas/TextOrNull","description":"Column Description"},"source_id":{"description":"Source ID that this column belongs to","example":"ds_krsappzu9f8vmo","type":"string"},"cc":{"description":"Column Comment","type":"string"},"cdf":{"$ref":"#/components/schemas/StringOrNullOrBooleanOrNumber","description":"Column Default"},"clen":{"description":"Character Maximum Length","oneOf":[{"type":"integer"},{"type":"null"},{"type":"string"}]},"colOptions":{"anyOf":[{"$ref":"#/components/schemas/Formula"},{"$ref":"#/components/schemas/LinkToAnotherRecord"},{"$ref":"#/components/schemas/Lookup"},{"$ref":"#/components/schemas/Rollup"},{"$ref":"#/components/schemas/SelectOptions"},{"type":"object"}],"description":"Column Options"},"column_name":{"description":"Column Name","example":"title","type":"string"},"cop":{"description":"Column Ordinal Position","type":"string"},"csn":{"$ref":"#/components/schemas/StringOrNull","description":"Character Set Name"},"ct":{"description":"Column Type","example":"varchar(45)","type":"string"},"deleted":{"$ref":"#/components/schemas/Bool","description":"Is Deleted?"},"dt":{"description":"Data Type in DB","example":"varchar","type":"string"},"dtx":{"description":"Data Type X","example":"specificType","type":"string"},"dtxp":{"description":"Data Type X Precision","oneOf":[{"type":"null"},{"type":"number"},{"type":"string"}]},"dtxs":{"description":"Data Type X Scale","oneOf":[{"type":"null"},{"type":"number"},{"type":"string"}]},"fk_model_id":{"description":"Model ID that this column belongs to","example":"md_yvwvbt2i78rgcm","type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info"},"np":{"description":"Numeric Precision","oneOf":[{"type":"integer"},{"type":"null"},{"type":"string"}]},"ns":{"description":"Numeric Scale","oneOf":[{"type":"integer"},{"type":"null"},{"type":"string"}]},"order":{"description":"The order of the list of columns","type":"number"},"pk":{"$ref":"#/components/schemas/Bool","description":"Is Primary Key?"},"pv":{"$ref":"#/components/schemas/Bool","description":"Is Primary Value?"},"rqd":{"$ref":"#/components/schemas/Bool","description":"Is Required?"},"system":{"$ref":"#/components/schemas/Bool","description":"Is System Column?"},"title":{"description":"Column Title","example":"Title","type":"string"},"uidt":{"description":"The data type in UI","example":"SingleLineText","enum":["Attachment","AutoNumber","Barcode","Button","Checkbox","Collaborator","Count","CreatedTime","Currency","Date","DateTime","Decimal","Duration","Email","Formula","ForeignKey","GeoData","Geometry","ID","JSON","LastModifiedTime","LongText","LinkToAnotherRecord","Lookup","MultiSelect","Number","Percent","PhoneNumber","Rating","Rollup","SingleLineText","SingleSelect","SpecificDBType","Time","URL","Year","QrCode","Links","User","CreatedBy","LastModifiedBy"],"type":"string"},"un":{"$ref":"#/components/schemas/Bool","description":"Is Unsigned?"},"unique":{"$ref":"#/components/schemas/Bool","description":"Is unique?"},"visible":{"$ref":"#/components/schemas/Bool","description":"Is Visible?"}},"x-stoplight":{"id":"y9jx9r6o6x0h6"}},"ColumnList":{"description":"Model for Column List","examples":[{"list":[{"ai":0,"au":0,"source_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Column List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"c6lpw8px25356"},"description":"List of column objects","items":{"$ref":"#/components/schemas/Column","x-stoplight":{"id":"zbm89i86dr73y"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"ko0s0z13h4hsw"}}},"required":["list","pageInfo"],"x-stoplight":{"id":"rsk9o5cs00wh5"}},"ColumnReq":{"allOf":[{"anyOf":[{"$ref":"#/components/schemas/ButtonColumnReq"},{"$ref":"#/components/schemas/FormulaColumnReq"},{"$ref":"#/components/schemas/LinkToAnotherColumnReq"},{"$ref":"#/components/schemas/LookupColumnReq"},{"$ref":"#/components/schemas/NormalColumnRequest"},{"$ref":"#/components/schemas/RollupColumnReq"}]},{"properties":{"column_name":{"type":"string"},"description":{"$ref":"#/components/schemas/TextOrNull"},"column_order":{"description":"Column order in a specific view","properties":{"order":{"type":"number"},"view_id":{"type":"string"}},"type":"object"},"title":{"maxLength":255,"minLength":1,"type":"string"},"view_id":{"type":"string"}},"required":["title"]}],"description":"Model for Column Request","examples":[{"ai":0,"au":0,"source_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"title":"Column Request Model","type":"object","x-stoplight":{"id":"aipiq4098ocg3"}},"CommentReq":{"description":"Model for Comment Request","examples":[{"comment":"This is the comment for the row","fk_model_id":"md_ehn5izr99m7d45","row_id":"3"}],"title":"Comment Request Model","type":"object","properties":{"comment":{"type":"string","description":"Description for the target row","example":"This is the comment for the row","maxLength":3000},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_ehn5izr99m7d45"},"row_id":{"type":"string","description":"Row ID","example":"3"}},"required":["fk_model_id","row_id"],"x-stoplight":{"id":"ohotsd0vq6d8w"}},"CommentUpdateReq":{"description":"Model for Comment Update Request","x-stoplight":{"id":"5shp04hfghm3a"},"examples":[{"comment":"This is the comment for the row","fk_model_id":"md_ehn5izr99m7d45"}],"title":"Comment Update Request Model","type":"object","properties":{"comment":{"type":"string","description":"Description for the target row","example":"This is the comment for the row","maxLength":3000},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_ehn5izr99m7d45"}}},"Filter":{"description":"Model for Filter","examples":[{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_parent_column_id":"cd_d7ah9n2qfupgys","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"properties":{"source_id":{"description":"Unqiue Source ID","readOnly":true,"type":"string"},"children":{"description":"Children filters. Available when the filter is grouped.","items":{"$ref":"#/components/schemas/Filter"},"type":"array"},"comparison_op":{"description":"Comparison Operator","anyOf":[{"enum":["allof","anyof","blank","btw","checked","empty","eq","ge","gt","gte","in","is","isWithin","isnot","le","like","lt","lte","nallof","nanyof","nbtw","neq","nlike","not","notblank","notchecked","notempty","notnull","null"],"type":"string"},{"type":"null"}]},"comparison_sub_op":{"anyOf":[{"enum":["daysAgo","daysFromNow","exactDate","nextMonth","nextNumberOfDays","nextWeek","nextYear","oneMonthAgo","oneMonthFromNow","oneWeekAgo","oneWeekFromNow","pastMonth","pastNumberOfDays","pastWeek","pastYear","today","tomorrow","yesterday"],"type":"string"},{"type":"null"}],"description":"Comparison Sub-Operator"},"fk_parent_column_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to parent column"},"fk_column_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Column"},"fk_hook_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Hook"},"fk_model_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Model"},"fk_parent_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to parent group."},"fk_view_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to View"},"fk_value_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to dynamic value Column"},"fk_link_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Link Column"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"is_group":{"description":"Is this filter grouped?","oneOf":[{"type":"boolean"},{"type":"integer"},{"type":"null"}]},"logical_op":{"description":"Logical Operator","enum":["and","not","or"],"type":"string"},"base_id":{"description":"Unique Base ID","readOnly":true,"type":"string"},"value":{"description":"The filter value. Can be NULL for some operators."},"order":{"type":"number","description":"The order of the filter","example":1}},"readOnly":true,"title":"Filter Model","type":"object","x-stoplight":{"id":"txz3lsqh1rbsu"}},"FilterList":{"description":"Model for Filter List","examples":[{"list":[{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Filter List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"22sgv37ve9kxo"},"description":"List of filter objects","items":{"$ref":"#/components/schemas/Filter","x-stoplight":{"id":"ttw5rxhy83k8p"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"7cyrb1770mrzz"}}},"required":["list","pageInfo"],"x-stoplight":{"id":"wbc42cyev1qzt"}},"FilterLogList":{"description":"Model for Filter Log List","x-stoplight":{"id":"jbgae8q40szhc"},"examples":[{"list":[{"source_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"base_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Filter Log List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"22sgv37ve9kxo"},"description":"List of filter objects","items":{"$ref":"#/components/schemas/Filter","x-stoplight":{"id":"ttw5rxhy83k8p"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"7cyrb1770mrzz"}}},"required":["list","pageInfo"]},"FilterReq":{"description":"Model for Filter Request","examples":[{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}],"title":"Filter Request Model","type":"object","x-stoplight":{"id":"f95qy45zzlhei"},"properties":{"comparison_op":{"description":"Comparison Operator","anyOf":[{"enum":["allof","anyof","blank","btw","checked","empty","eq","ge","gt","gte","in","is","isWithin","isnot","le","like","lt","lte","nallof","nanyof","nbtw","neq","nlike","not","notblank","notchecked","notempty","notnull","null"],"type":"string"},{"type":"null"}]},"comparison_sub_op":{"anyOf":[{"enum":["daysAgo","daysFromNow","exactDate","nextMonth","nextNumberOfDays","nextWeek","nextYear","oneMonthAgo","oneMonthFromNow","oneWeekAgo","oneWeekFromNow","pastMonth","pastNumberOfDays","pastWeek","pastYear","today","tomorrow","yesterday"],"type":"string"},{"type":"null"}],"description":"Comparison Sub-Operator"},"fk_column_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Column"},"fk_parent_id":{"$ref":"#/components/schemas/StringOrNull","description":"Belong to which filter ID"},"is_group":{"$ref":"#/components/schemas/Bool","description":"Is this filter grouped?"},"logical_op":{"description":"Logical Operator","enum":["and","not","or"],"type":"string"},"value":{"description":"The filter value. Can be NULL for some operators."}},"readOnly":true},"Follower":{"properties":{"fk_follower_id":{"type":"string"}},"title":"Follower","type":"object","x-stoplight":{"id":"a3aza5b3wavkv"}},"Form":{"description":"Model for Form","examples":[{"source_id":"ds_g4ccx6e77h1dmi","banner_image_url":{"mimetype":"image/jpg","size":32903,"title":"Random-Pictures-of-Conceptual-and-Creative-Ideas-02.jpg","path":"download/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg","signedPath":"dltemp/lNoLbqB62Jdo5Rmp/1709308800000/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg"},"columns":[{"id":"fvc_ugj9zo5bzocxtl","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_view_id":"vw_kdf5cr7qmhksek","fk_column_id":"cl_phvuuwjrzcdo0g","uuid":null,"label":null,"help":null,"description":null,"required":null,"show":0,"order":1,"created_at":"2023-03-04 16:40:47","updated_at":"2023-03-04 16:40:47","meta":{}}],"email":"user@example.com","fk_model_id":"md_rsu68aqjsbyqtl","heading":"My Form","lock_type":"collaborative","logo_url":{"mimetype":"image/jpg","size":32903,"title":"Random-Pictures-of-Conceptual-and-Creative-Ideas-02.jpg","path":"download/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg","signedPath":"dltemp/lNoLbqB62Jdo5Rmp/1709308800000/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg"},"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission.","title":"Form View 1"}],"title":"Form Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"z6wjvs00d3qfk"}},"banner_image_url":{"$ref":"#/components/schemas/AttachmentRes","description":"Banner Image URL"},"columns":{"type":"array","description":"Form Columns","items":{"$ref":"#/components/schemas/FormColumn"}},"email":{"$ref":"#/components/schemas/StringOrNull","description":"Email to sned after form is submitted"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_rsu68aqjsbyqtl"},"source_id":{"type":"string","description":"Source ID","example":"md_rsu68aqjsbyqtl","x-stoplight":{"id":"kfz7tve8nzj6f"}},"heading":{"type":"string","description":"The heading of the form","example":"My Form"},"lock_type":{"enum":["collaborative","locked","personal"],"type":"string","description":"Lock Type of this view","example":"collaborative"},"logo_url":{"$ref":"#/components/schemas/AttachmentRes","description":"Logo URL"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for this view"},"redirect_after_secs":{"$ref":"#/components/schemas/StringOrNull","description":"The numbers of seconds to redirect after form submission"},"redirect_url":{"$ref":"#/components/schemas/TextOrNull","description":"URL to redirect after submission"},"show_blank_form":{"$ref":"#/components/schemas/Bool","description":"Show `Blank Form` after 5 seconds"},"subheading":{"$ref":"#/components/schemas/TextOrNull","description":"The subheading of the form","example":"My Form Subheading"},"submit_another_form":{"$ref":"#/components/schemas/Bool","description":"Show `Submit Another Form` button"},"success_msg":{"$ref":"#/components/schemas/TextOrNull","description":"Custom message after the form is successfully submitted"},"title":{"type":"string","description":"Form View Title","example":"Form View 1"}},"x-stoplight":{"id":"szw7mwcmvrj90"}},"FormUpdateReq":{"description":"Model for Form Update Request","examples":[{"banner_image_url":{"mimetype":"image/jpg","size":32903,"title":"Random-Pictures-of-Conceptual-and-Creative-Ideas-02.jpg","path":"download/noco/pm0umqsip16i1u5/m8yn03dncqal6ri//iDL5ednaHz2j2Sa3Cl.jpg"},"email":"user@example.com","heading":"My Form","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission."}],"title":"Form Update Request Model","type":"object","properties":{"banner_image_url":{"oneOf":[{"$ref":"#/components/schemas/AttachmentReq"},{"type":"null"}],"description":"Banner Image URL"},"email":{"$ref":"#/components/schemas/StringOrNull","description":"Email to sned after form is submitted"},"heading":{"description":"The heading of the form","example":"My Form","maxLength":255,"type":"string"},"logo_url":{"oneOf":[{"$ref":"#/components/schemas/AttachmentReq"},{"type":"null"}],"description":"Logo URL"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for this view"},"redirect_after_secs":{"$ref":"#/components/schemas/StringOrNull","description":"The numbers of seconds to redirect after form submission"},"redirect_url":{"$ref":"#/components/schemas/TextOrNull","description":"URL to redirect after submission"},"show_blank_form":{"$ref":"#/components/schemas/Bool","description":"Show `Blank Form` after 5 seconds"},"subheading":{"$ref":"#/components/schemas/TextOrNull","description":"The subheading of the form","example":"My Form Subheading"},"submit_another_form":{"$ref":"#/components/schemas/Bool","description":"Show `Submit Another Form` button"},"success_msg":{"$ref":"#/components/schemas/TextOrNull","description":"Custom message after the form is successfully submitted"}},"x-stoplight":{"id":"gqdmtil2ni0ln"}},"FormColumn":{"description":"Model for Form Column","examples":[{"id":"fvc_1m9b0aub791d4m","description":null,"fk_column_id":"cl_ah9zavkn25ihyd","fk_view_id":"vw_6fqln9vdytdv8q","help":"This is a help text","label":"Form Label","meta":null,"order":1,"required":0,"show":0,"uuid":null}],"title":"Form Column Model","type":"object","x-examples":{"example-1":{"_cn":"first_name","alias":"first_name","created_at":"2022-02-15 12:39:04","description":"dsdsdsdsd","fk_column_id":"cl_yvyhsl9u81tokc","fk_view_id":"vw_s1pf4umdnikoyn","help":null,"id":"fvc_8z1i7t8aswkqxx","label":"dsdsds","order":1,"required":false,"show":1,"enable_scanner":true,"updated_at":"2022-02-15 12:39:16","uuid":null}},"properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"description":{"$ref":"#/components/schemas/TextOrNull","description":"Form Column Description"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View"},"help":{"$ref":"#/components/schemas/TextOrNull","description":"Form Column Help Text (Not in use)"},"label":{"$ref":"#/components/schemas/TextOrNull","description":"Form Column Label"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info"},"order":{"type":"number","description":"The order among all the columns in the form","example":1},"required":{"$ref":"#/components/schemas/Bool","description":"Is this form column required in submission?"},"show":{"$ref":"#/components/schemas/Bool","description":"Is this column shown in Form?"},"enable_scanner":{"$ref":"#/components/schemas/Bool","description":"Indicates whether the \'Fill by scan\' button is visible for this column or not.","example":true},"uuid":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column UUID (Not in use)"}},"x-stoplight":{"id":"rs2uh5opf10q6"}},"FormColumnReq":{"description":"Model for Form Column Request","examples":[{"description":null,"help":"This is a help text","label":"Form Label","meta":null,"order":1,"required":0,"show":0}],"title":"Form Column Request Model","type":"object","x-examples":{"example-1":{"_cn":"first_name","alias":"first_name","created_at":"2022-02-15 12:39:04","description":"dsdsdsdsd","fk_column_id":"cl_yvyhsl9u81tokc","fk_view_id":"vw_s1pf4umdnikoyn","help":null,"id":"fvc_8z1i7t8aswkqxx","label":"dsdsds","order":1,"required":false,"show":1,"updated_at":"2022-02-15 12:39:16","uuid":null}},"properties":{"description":{"$ref":"#/components/schemas/TextOrNull","description":"Form Column Description"},"help":{"$ref":"#/components/schemas/TextOrNull","description":"Form Column Help Text (Not in use)"},"label":{"$ref":"#/components/schemas/TextOrNull","description":"Form Column Label"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info"},"order":{"type":"number","description":"The order among all the columns in the form"},"required":{"$ref":"#/components/schemas/Bool","description":"Is this form column required in submission?"},"show":{"$ref":"#/components/schemas/Bool","description":"Is this column shown in Form?"}},"x-stoplight":{"id":"a1vgymjna1ose"}},"Formula":{"description":"Model for Formula","examples":[{"error":"Error Message shows here","fk_column_id":"cl_h2micb4jdnmsh1","formula":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","formula_raw":"CONCAT(\\"FOO\\", {Title})","id":"fm_1lo8wqtvvipdns"}],"title":"Formula Model","type":"object","properties":{"error":{"description":"Error Message","type":"string"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"formula":{"description":"Formula with column ID replaced","example":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","type":"string"},"formula_raw":{"description":"Original Formula inputted in UI","example":"CONCAT(\\"FOO\\", {Title})","type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"}},"x-stoplight":{"id":"syn5ameyiipp7"}},"Button":{"description":"Model for Button","examples":[{"error":"Error Message shows here","fk_column_id":"cl_h2micb4jdnmsh1","formula":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","formula_raw":"CONCAT(\\"FOO\\", {Title})","id":"fm_1lo8wqtvvipdns","base_id":"pj34mdkvjfdnkf","label":"Click Me","theme":"solid","color":"green","icon":"plus"}],"title":"Button Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"type":{"description":"Whether button is webhook or url","enum":["webhook","url"]},"label":{"description":"Label of Button","maxLength":255,"minLength":1,"type":"string"},"theme":{"description":"Button Theme","enum":["solid","text","light"]},"color":{"description":"Button color","enum":["brand","red","green","maroon","blue","orange","pink","purple","yellow","gray"]},"icon":{"description":"Button Icon","type":"string"},"formula":{"description":"Formula with column ID replaced","example":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","type":"string"},"formula_raw":{"description":"Original Formula inputted in UI","example":"CONCAT(\\"FOO\\", {Title})","type":"string"},"error":{"description":"Error Message","type":"string"},"parsed_tree":{"description":"Parsed Formula Tree","type":"object"},"fk_webhook_id":{"$ref":"#/components/schemas/Id","description":"Webhook ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"}},"x-stoplight":{"id":"syn5ameyiipp7"}},"ButtonColumnReq":{"description":"Model for Button Column Request","examples":[{"formula":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","formula_raw":"CONCAT(\\"FOO\\", {Title})","title":"Formula","uidt":"Formula"}],"title":"Button Column Request Model","type":"object","properties":{"title":{"description":"Formula Title","maxLength":255,"minLength":1,"type":"string"},"uidt":{"description":"UI Data Type","enum":["Formula"],"type":"string"},"type":{"description":"Whether button is webhook or url","enum":["webhook","url"]},"theme":{"description":"Button Theme","enum":["solid","text","light"]},"color":{"description":"Button color","enum":["brand","red","green","maroon","blue","orange","pink","purple","yellow","gray"]},"label":{"description":"Label of Button","maxLength":255,"minLength":1,"type":"string"},"icon":{"description":"Button Icon","type":"string"},"fk_webhook_id":{"$ref":"#/components/schemas/Id","description":"Webhook ID"},"formula":{"description":"Formula with column ID replaced","type":"string"},"formula_raw":{"description":"Original Formula inputted in UI","type":"string"}},"x-stoplight":{"id":"tvczns7x7nj73"}},"FormulaColumnReq":{"description":"Model for Formula Column Request","examples":[{"formula":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","formula_raw":"CONCAT(\\"FOO\\", {Title})","title":"Formula","uidt":"Formula"}],"title":"Formula Column Request Model","type":"object","properties":{"formula":{"description":"Formula with column ID replaced","type":"string"},"formula_raw":{"description":"Original Formula inputted in UI","type":"string"},"title":{"description":"Formula Title","maxLength":255,"minLength":1,"type":"string"},"uidt":{"description":"UI Data Type","enum":["Formula"],"type":"string"}},"x-stoplight":{"id":"tvczns7x7nj73"}},"Gallery":{"description":"Model for Gallery","examples":[{"alias":"string","columns":[{"fk_col_id":"string","fk_gallery_id":"string","help":"string","id":"string","label":"string"}],"cover_image":"string","cover_image_idx":0,"deleted":true,"fk_cover_image_col_id":"string","fk_model_id":"string","fk_view_id":"string","lock_type":"collaborative","next_enabled":true,"order":0,"prev_enabled":true,"restrict_number":"string","restrict_size":"string","restrict_types":"string","title":"string"}],"properties":{"alias":{"type":"string"},"columns":{"items":{"$ref":"#/components/schemas/GalleryColumn"},"type":"array"},"cover_image":{"type":"string"},"cover_image_idx":{"type":"integer"},"deleted":{"$ref":"#/components/schemas/Bool"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Cover Image Column"},"fk_model_id":{"type":"string","description":"Foreign Key to Model"},"fk_view_id":{"type":"string","description":"Foreign Key to View"},"lock_type":{"enum":["collaborative","locked","personal"],"type":"string"},"next_enabled":{"$ref":"#/components/schemas/Bool"},"order":{"type":"number","description":"Order of Gallery"},"prev_enabled":{"$ref":"#/components/schemas/Bool"},"restrict_number":{"type":"string"},"restrict_size":{"type":"string"},"restrict_types":{"type":"string"},"title":{"type":"string"}},"title":"Gallery Model","type":"object","x-stoplight":{"id":"brih3mxjli606"}},"GalleryColumn":{"description":"Model for Gallery Column","examples":[{"fk_col_id":"string","fk_gallery_id":"string","help":"string","id":"string","label":"string"}],"properties":{"fk_col_id":{"type":"string"},"fk_gallery_id":{"type":"string"},"help":{"type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"label":{"type":"string"}},"title":"Gallery Column Model","type":"object","x-stoplight":{"id":"auloy6128iwh9"}},"GalleryUpdateReq":{"description":"Model for Gallery View Update Request","x-stoplight":{"id":"8o7b279bp9wmg"},"examples":[{"fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":null}],"title":"Gallery View Update Request Model","type":"object","properties":{"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"The id of the column that contains the cover image"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"zhp6jkrr54wuf"},"description":"Meta Info"}}},"GeoLocation":{"description":"Model for Geo Location","examples":[{"latitude":18.52139,"longitude":179.87295}],"properties":{"latitude":{"description":"The latitude of the location","example":18.52139,"exclusiveMaximum":90,"exclusiveMinimum":-90,"format":"double","type":"number"},"longitude":{"description":"The longitude of the location","example":179.87295,"exclusiveMaximum":180,"exclusiveMinimum":-180,"format":"double","type":"number"}},"title":"Geo Location Model","type":"object","x-stoplight":{"id":"jv0zkileq99er"}},"Grid":{"description":"Model for Grid","examples":[{"base_id":"p_xm3thidrblw4n7","source_id":"ds_g4ccx6e77h1dmi","fk_view_id":"vw_p2jcatxz4mvcfw","row_height":1,"meta":null,"columns":[{"id":"cl_phvuuwjrzcdo0g","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}]}],"title":"Grid Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"base_id":{"$ref":"#/components/schemas/Id","description":"Base ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"source_id":{"$ref":"#/components/schemas/Id","description":"Source ID","x-stoplight":{"id":"m8v3iyf1tidy9"}},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View","x-stoplight":{"id":"m8v3iyf1tidy9"}},"row_height":{"type":"number","example":1,"description":"Row Height"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"n8cud3jyqw5yv"},"description":"Meta info for Grid Model"},"columns":{"type":"array","x-stoplight":{"id":"22y0gipx2jdf8"},"description":"Grid View Columns","items":{"$ref":"#/components/schemas/GridColumn","x-stoplight":{"id":"nmzp6w3o6b24u"}}}},"x-stoplight":{"id":"wlj101286bua3"}},"Grid - copy":{"description":"Model for Grid","x-stoplight":{"id":"9hiq0xt18jao0"},"examples":[{"base_id":"p_xm3thidrblw4n7","source_id":"ds_g4ccx6e77h1dmi","fk_view_id":"vw_p2jcatxz4mvcfw","row_height":1,"meta":null,"columns":[{"id":"cl_phvuuwjrzcdo0g","source_id":"ds_g4ccx6e77h1dmi","base_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}]}],"title":"Grid Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"base_id":{"$ref":"#/components/schemas/Id","description":"Base ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"source_id":{"$ref":"#/components/schemas/Id","description":"Source ID","x-stoplight":{"id":"m8v3iyf1tidy9"}},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View","x-stoplight":{"id":"m8v3iyf1tidy9"}},"row_height":{"type":"number","example":1,"description":"Row Height"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"n8cud3jyqw5yv"},"description":"Meta info for Grid Model"},"columns":{"type":"array","x-stoplight":{"id":"22y0gipx2jdf8"},"description":"Grid View Columns","items":{"$ref":"#/components/schemas/GridColumn","x-stoplight":{"id":"nmzp6w3o6b24u"}}}}},"GridColumn":{"description":"Model for Grid Column","examples":[{"id":"nc_c8jz4kxe6xvh11","fk_view_id":"vw_p2jcatxz4mvcfw","fk_column_id":"cl_c5knoi4xs4sfpt","base_id":"p_xm3thidrblw4n7","source_id":"ds_g4ccx6e77h1dmi","show":0,"order":1,"width":"200px","help":null,"group_by":0,"group_by_order":null,"group_by_sort":null,"aggregation":null}],"title":"Grid Column Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"jc14yojp52rqj"}},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View","x-stoplight":{"id":"vl18dbt5c2r8r"}},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column","x-stoplight":{"id":"2drg88fmodf3v"}},"base_id":{"$ref":"#/components/schemas/Id","description":"Base ID","x-stoplight":{"id":"2drg88fmodf3v"}},"source_id":{"$ref":"#/components/schemas/Id","description":"Source ID","x-stoplight":{"id":"2drg88fmodf3v"}},"show":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"d47eer13oa8yr"}},"order":{"type":"number","x-stoplight":{"id":"d47eer13oa8yr"},"example":1,"description":"Grid Column Order"},"width":{"type":"string","description":"Column Width","example":"200px"},"help":{"$ref":"#/components/schemas/StringOrNull","description":"Column Help Text","x-stoplight":{"id":"azwh6zn37qzkc"}},"group_by":{"$ref":"#/components/schemas/Bool","description":"Group By"},"group_by_order":{"type":"number","description":"Group By Order","example":1},"group_by_sort":{"$ref":"#/components/schemas/StringOrNull","description":"Group By Sort","example":"asc"},"aggregation":{"$ref":"#/components/schemas/StringOrNull","description":"Aggregation Type","example":"sum"}},"x-stoplight":{"id":"195gzd7s6p7nv"}},"GridColumnReq":{"description":"Model for Grid Column Request","examples":[{"fk_column_id":"cl_c5knoi4xs4sfpt","label":"My Column","width":"200px"}],"properties":{"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"help":{"maxLength":255,"type":"string"},"label":{"description":"The label of the column","example":"My Column","maxLength":255,"type":"string"},"width":{"description":"The width of the column","example":"200px","maxLength":255,"pattern":"^[0-9]+(px|%)$","type":"string"},"group_by":{"$ref":"#/components/schemas/Bool","description":"Group By"},"group_by_order":{"type":"number","description":"Group By Order","example":1},"group_by_sort":{"$ref":"#/components/schemas/StringOrNull","description":"Group By Sort","example":"asc"},"aggregation":{"$ref":"#/components/schemas/StringOrNull","description":"Aggregation","example":"sum"}},"title":"Grid Column Request Model","type":"object","x-stoplight":{"id":"9yhalgmix6d0m"}},"GridUpdateReq":{"description":"Model for Grid View Update","x-stoplight":{"id":"v0hz01gynll1t"},"examples":[{"row_height":"1","meta":null}],"title":"Grid View Update Model","type":"object","properties":{"row_height":{"type":"number","x-stoplight":{"id":"m5976ax1q13cr"},"description":"Row Height","example":1},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"dugbkhe9iupqu"},"description":"Meta Info for grid view"}}},"Hook":{"description":"Model for Hook","examples":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}],"title":"Hook Model","type":"object","x-stoplight":{"id":"5jvfnece2nu6w"},"properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is the hook active?"},"async":{"$ref":"#/components/schemas/Bool","description":"Is the hook aysnc?"},"description":{"type":"string","description":"Hook Description","example":"This is my hook description"},"env":{"type":"string","example":"all","description":"Environment for the hook"},"event":{"enum":["after","before","manual"],"type":"string","description":"Event Type for the operation","example":"after"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_rsu68aqjsbyqtl"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"notification":{"description":"Hook Notification including info such as type, payload, method, body, and etc","type":["object","string"]},"operation":{"enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete","trigger"],"type":"string","description":"Hook Operation","example":"insert"},"retries":{"type":"number","description":"Retry Count","example":10},"retry_interval":{"type":"number","description":"Retry Interval","example":60000},"timeout":{"type":"number","example":60000,"description":"Timeout"},"title":{"type":"string","description":"Hook Title","example":"My Webhook"},"type":{"type":"string","description":"Hook Type"},"version":{"type":"string","x-stoplight":{"id":"socewqvadj91n"},"example":"v2","description":"Hook Version","enum":["v1","v2"]}}},"HookReq":{"description":"Model for Hook","x-stoplight":{"id":"btj9o665l08xj"},"examples":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook","condition":false}],"title":"Hook Request Model","type":"object","properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is the hook active?"},"async":{"$ref":"#/components/schemas/Bool","description":"Is the hook aysnc?"},"description":{"$ref":"#/components/schemas/StringOrNull","description":"Hook Description"},"env":{"type":"string","example":"all","description":"Environment for the hook"},"event":{"enum":["after","before","manual"],"type":"string","description":"Event Type for the operation","example":"after"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_rsu68aqjsbyqtl"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"notification":{"description":"Hook Notification including info such as type, payload, method, body, and etc","type":["object","string"]},"operation":{"enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete","trigger"],"type":"string","description":"Hook Operation","example":"insert"},"retries":{"type":"number","description":"Retry Count","example":10},"retry_interval":{"type":"number","description":"Retry Interval","example":60000},"timeout":{"type":"number","example":60000,"description":"Timeout"},"title":{"type":"string","description":"Hook Title","example":"My Webhook"},"type":{"type":["string","null"],"description":"Hook Type"},"condition":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"wwzoum7rrlwun"},"description":"Is this hook assoicated with some filters"}},"required":["event","notification","operation","title"]},"HookList":{"description":"Model for Hook List","examples":[{"list":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Hook List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of hook objects","items":{"$ref":"#/components/schemas/Hook"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"],"x-stoplight":{"id":"oza9z6dpygn29"}},"HookLog":{"description":"Model for Hook Log","examples":[{"source_id":"ds_jxuewivwbxeum2","event":"after","execution_time":"98","fk_hook_id":"hk_035ijv5qdi97y5","id":"string","notifications":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}}","operation":"insert","payload":"{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}","base_id":"p_tbhl1hnycvhe5l","response":"{\\"status\\":200,\\"statusText\\":\\"OK\\",\\"headers\\":{\\"server\\":\\"nginx\\",\\"content-type\\":\\"text/plain; charset=UTF-8\\",\\"transfer-encoding\\":\\"chunked\\",\\"connection\\":\\"close\\",\\"vary\\":\\"Accept-Encoding\\",\\"x-request-id\\":\\"53844a7d-ede8-4798-adf7-8af441908a72\\",\\"x-token-id\\":\\"6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"cache-control\\":\\"no-cache, private\\",\\"date\\":\\"Fri, 24 Mar 2023 10:50:10 GMT\\"},\\"config\\":{\\"url\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"method\\":\\"post\\",\\"data\\":\\"{\\\\\\"type\\\\\\":\\\\\\"records.after.insert\\\\\\",\\\\\\"id\\\\\\":\\\\\\"a77d97dc-a3e4-4719-9b46-45f93e0cc99a\\\\\\",\\\\\\"data\\\\\\":{\\\\\\"table_id\\\\\\":\\\\\\"md_d8v403o74mf5lf\\\\\\",\\\\\\"table_name\\\\\\":\\\\\\"Sheet-2\\\\\\"}}\\",\\"headers\\":{\\"Accept\\":\\"application/json, text/plain, */*\\",\\"Content-Type\\":\\"application/x-www-form-urlencoded\\",\\"User-Agent\\":\\"axios/0.21.4\\",\\"Content-Length\\":138},\\"params\\":{}}}","test_call":0,"triggered_by":"w@nocodb.com","type":"URL"}],"title":"Hook Log Model","type":"object","x-stoplight":{"id":"alkb2a68ewbpz"},"properties":{"source_id":{"type":"string","description":"Unique Source ID","example":"ds_jxuewivwbxeum2"},"conditions":{"type":"string","description":"Hook Conditions"},"error":{"$ref":"#/components/schemas/StringOrNull","description":"Error"},"error_code":{"$ref":"#/components/schemas/StringOrNull","description":"Error Code"},"error_message":{"$ref":"#/components/schemas/StringOrNull","description":"Error Message"},"event":{"type":"string","description":"Hook Event","example":"after","enum":["after","before","manual"]},"execution_time":{"type":"string","description":"Execution Time in milliseconds","example":"98"},"fk_hook_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Hook"},"id":{"$ref":"#/components/schemas/StringOrNull","description":"Unique ID"},"notifications":{"type":"string","description":"Hook Notification"},"operation":{"type":"string","description":"Hook Operation","enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete","trigger"],"example":"insert"},"payload":{"type":"string","description":"Hook Payload","example":"{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}"},"base_id":{"type":"string","description":"Base ID","example":"p_tbhl1hnycvhe5l"},"response":{"$ref":"#/components/schemas/StringOrNull","description":"Hook Response"},"test_call":{"$ref":"#/components/schemas/Bool","description":"Is this testing hook call?"},"triggered_by":{"$ref":"#/components/schemas/StringOrNull","description":"Who triggered the hook?"},"type":{"type":"string","example":"URL","description":"Hook Type"}}},"HookLogList":{"description":"Model for Hook Log List","x-stoplight":{"id":"ck3ymtqepbl7e"},"examples":[],"title":"Hook Log List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of hook objects","items":{"$ref":"#/components/schemas/HookLog"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]},"HookTestReq":{"description":"Model for Hook Test Request","examples":[{"hook":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"},"payload":{"data":{"Id":1,"Title":"Sample Text","CreatedAt":"2023-03-03T10:03:06.484Z","UpdatedAt":"2023-03-03T10:03:06.484Z","attachment":[{"url":"https://nocodb.com/dummy.png","title":"image.png","mimetype":"image/png","size":0}],"f":"Sample Output"}}}],"title":"Hook Test Request Model","type":"object","properties":{"hook":{"$ref":"#/components/schemas/HookReq"},"payload":{"description":"Payload to be sent"}},"required":["hook","payload"],"x-stoplight":{"id":"fmxwekzyi46za"}},"Id":{"description":"Model for ID","examples":["string"],"maxLength":20,"minLength":0,"title":"ID Model","type":"string","x-stoplight":{"id":"upw7it13u2dkn"}},"Kanban":{"description":"Model for Kanban","examples":[{"id":"vw_wqs4zheuo5lgdy","fk_grp_col_id":"cl_3704cxcbqt7sj7","fk_view_id":"vw_wqs4zheuo5lgdy","fk_cover_image_col_id":null,"columns":[{"id":"kvc_2skkg5mi1eb37f","fk_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","source_id":"ds_hd4ojj0xpquaam","base_id":"p_kzfl5lb0t3tcok","title":"string","show":0,"order":"1"}],"meta":null,"title":"My Kanban"}],"title":"Kanban Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_grp_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Grouping Field Column ID"},"fk_view_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"1kgw1w06b97nl"},"description":"View ID"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Cover Image Column ID"},"columns":{"type":"array","description":"Kanban Columns","items":{"$ref":"#/components/schemas/KanbanColumn"}},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for Kanban"},"title":{"type":"string","description":"Kanban Title","example":"My Kanban"}},"x-stoplight":{"id":"gu721t0zw7jqq"}},"KanbanColumn":{"description":"Model for Kanban Column","examples":[{"id":"kvc_2skkg5mi1eb37f","fk_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","source_id":"ds_hd4ojj0xpquaam","base_id":"p_kzfl5lb0t3tcok","title":"string","show":0,"order":"1"}],"title":"Kanban Column Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_view_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"t1fy4zy561ih8"},"description":"Foreign Key to View"},"source_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Baes ID\\n"},"base_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Base ID"},"title":{"x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Base ID","type":"string"},"show":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown?"},"order":{"type":"number","x-stoplight":{"id":"pbnchzgci5dwa"},"example":1,"description":"Column Order"}},"x-stoplight":{"id":"psbv6c6y9qvbu"}},"KanbanUpdateReq":{"description":"Model for Kanban Update Request","examples":[{"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":{"cl_g0a89q9xdry3lu":[{"id":"uncategorized","title":null,"order":0,"color":"#c2f5e8","collapsed":false},{"id":"sl_ihyva6jx6dg0fc","fk_column_id":"cl_g0a89q9xdry3lu","title":"a","color":"#cfdffe","order":1,"collapsed":false},{"id":"sl_gqdm5v6t8aetoa","fk_column_id":"cl_g0a89q9xdry3lu","title":"b","color":"#d0f1fd","order":2,"collapsed":false},{"id":"sl_eipnl0kn7a9d3c","fk_column_id":"cl_g0a89q9xdry3lu","title":"cc","color":"#c2f5e8","order":3,"collapsed":false},{"id":"sl_dei8p2jq0cnlv0","fk_column_id":"cl_g0a89q9xdry3lu","title":"d","color":"#ffdaf6","order":4,"collapsed":false}]}}],"title":"Kanban Update Request Model","type":"object","properties":{"fk_grp_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Grouping Field Column"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"81wn4hzj76wod"},"description":"Foreign Key to Cover Image Column"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"stsvdmkli1b0r"},"description":"Meta Info"}},"x-stoplight":{"id":"9zirjgj9k1gqa"}},"Calendar":{"description":"Model for Calendar","examples":[{"id":"vw_wqs4zheuo5lgdy","fk_view_id":"vw_wqs4zheuo5lgdy","fk_cover_image_col_id":null,"columns":[{"id":"kvc_2skkg5mi1eb37f","fk_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","source_id":"ds_hd4ojj0xpquaam","base_id":"p_kzfl5lb0t3tcok","title":"string","show":1,"bold":0,"italic":0,"underline":0,"order":"1"}],"calendar_range":[{"id":"kvc_2skkg5mi1eb37f","fk_view_id":"vw_wqs4zheuo5lgdy","fk_from_column_id":"cl_hzos4ghyncqi4k","fk_to_column_id":"cl_hzos4ghyncqi4k"}],"meta":null,"title":"My Calendar"}],"title":"Calendar Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_view_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"1kgw1w06b97nl"},"description":"View ID"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Cover Image Column ID"},"columns":{"type":"array","description":"Calendar Columns","items":{"$ref":"#/components/schemas/CalendarColumn"}},"calendar_range":{"type":"array","description":"Calendar Date Range","items":{"$ref":"#/components/schemas/CalendarRange"}},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for Kanban"},"title":{"type":"string","description":"Kanban Title","example":"My Kanban"}},"x-stoplight":{"id":"gu721t0zw7jqq"}},"CalendarColumn":{"description":"Model for Calendar Column","examples":[{"id":"kvc_2skkg5mi1eb37f","fk_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","source_id":"ds_hd4ojj0xpquaam","base_id":"p_kzfl5lb0t3tcok","title":"string","show":0,"bold":0,"italic":0,"underline":0,"order":"1"}],"title":"Calendar Column Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_view_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"t1fy4zy561ih8"},"description":"Foreign Key to View"},"source_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Baes ID\\n"},"base_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Base ID"},"title":{"x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Base ID","type":"string"},"show":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown?"},"bold":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown as bold?"},"italic":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown as italic?"},"underline":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown underlines?"},"order":{"type":"number","x-stoplight":{"id":"pbnchzgci5dwa"},"example":1,"description":"Column Order"}},"x-stoplight":{"id":"psbv6c6y9qvbu"}},"CalendarRange":{"description":"Model for Calendar Date Range","examples":[{"id":"kvc_2skkg5mi1eb37f","fk_from_column_id":"cl_hzos4ghyncqi4k","fk_to_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","label":"string"}],"title":"Calendar Date Range Model","type":"object","properties":{"fk_from_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_view_id":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"t1fy4zy561ih8"},"description":"Foreign Key to View"},"label":{"x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Base ID","type":"string"}},"x-stoplight":{"id":"psbv6c6y9qvbu"}},"CalendarUpdateReq":{"description":"Model for Calendar Update Request","examples":[{"fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","title":"Calendar 2","calendar_range":[{"id":"kvc_2skkg5mi1eb37f","fk_view_id":"vw_wqs4zheuo5lgdy","fk_from_column_id":"cl_hzos4ghyncqi4k","fk_to_column_id":"cl_hzos4ghyncqi4k"}]}],"title":"Calendar Update Request Model","type":"object","properties":{"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"81wn4hzj76wod"},"description":"Foreign Key to Cover Image Column"},"title":{"type":"string","description":"Calendar Title","example":"Calendar 01"},"calendar_range":{"type":"array","description":"Calendar Columns","items":{"$ref":"#/components/schemas/CalendarRange"}},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"stsvdmkli1b0r"},"description":"Meta Info"}},"x-stoplight":{"id":"9zirjgj9k1gqa"}},"LicenseReq":{"description":"Model for Kanban Request","examples":[{"key":"1234567890"}],"properties":{"key":{"description":"The license key","example":"1234567890","maxLength":255,"type":"string"}},"title":"License Key Request Model","type":"object","x-stoplight":{"id":"4vo9hms4s6uie"}},"LinkToAnotherColumnReq":{"description":"Model for LinkToAnotherColumn Request","examples":[{"childId":"string","parentId":"string","title":"string","type":"hm","uidt":"LinkToAnotherRecord","virtual":true}],"properties":{"childViewId":{"$ref":"#/components/schemas/IdOrNull","description":"Foreign Key to child view"},"childId":{"$ref":"#/components/schemas/Id","description":"Foreign Key to chhild column"},"parentId":{"$ref":"#/components/schemas/Id","description":"Foreign Key to parent column"},"title":{"maxLength":255,"minLength":1,"type":"string","description":"The title of the virtual column"},"type":{"enum":["bt","hm","mm","oo"],"type":"string","description":"The type of the relationship"},"uidt":{"enum":["LinkToAnotherRecord","Links"],"type":"string","description":"Abstract type of the relationship"},"virtual":{"$ref":"#/components/schemas/Bool","description":"Is this relationship virtual?"}},"required":["childId","parentId","title","type","uidt"],"title":"LinkToAnotherColumn Request Model","type":"object","x-stoplight":{"id":"ke4urwgcmt83x"}},"LinkToAnotherRecord":{"description":"Model for LinkToAnotherRecord","examples":[{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","fk_related_model_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true}],"properties":{"deleted":{"type":"string"},"dr":{"type":"string"},"fk_child_column_id":{"type":"string"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_index_name":{"type":"string"},"fk_relation_view_id":{"type":"string"},"fk_mm_child_column_id":{"type":"string"},"fk_mm_model_id":{"type":"string"},"fk_mm_parent_column_id":{"type":"string"},"fk_parent_column_id":{"type":"string"},"fk_related_model_id":{"type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"order":{"type":"string"},"type":{"type":"string"},"ur":{"type":"string"},"virtual":{"$ref":"#/components/schemas/Bool"}},"title":"LinkToAnotherRecord Model","type":"object","x-stoplight":{"id":"tcn1muyj67810"}},"Lookup":{"description":"Model for Lookup","examples":[{"id":"lk_mngsu0e45njbxr","fk_column_id":"cl_vdiy9bz7h11kdm","fk_relation_column_id":"cl_5jestblzneb649","fk_lookup_column_id":"cl_4cm47dtjphgqkv","order":1}],"title":"Lookup Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_lookup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Lookup Column"},"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Relation Column"},"order":{"type":"number","description":"The order among the list","example":1}},"x-stoplight":{"id":"53ff6kxwlgjrb"}},"LookupColumnReq":{"description":"Model for Lookup Column Request","examples":[{"fk_relation_column_id":"cl_5jestblzneb649","fk_lookup_column_id":"cl_4cm47dtjphgqkv","title":"My Lookup","uidt":"Lookup"}],"title":"Lookup Column Request Model","type":"object","properties":{"fk_lookup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Lookup Column"},"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Relation Column"},"title":{"maxLength":255,"type":"string","description":"Lookup Title","example":"My Lookup"},"uidt":{"enum":["Lookup"],"type":"string","description":"UI DataType"}},"x-stoplight":{"id":"rmmtwpsofeqo5"}},"Map":{"description":"Model for Map","examples":[{"source_id":"ds_g4ccx6e77h1dmi","columns":[{"source_id":"ds_g4ccx6e77h1dmi","fk_column_id":"cl_8iw2o4ejzvdyna","fk_view_id":"vw_qjt7klod1p9kyv","id":"nc_46xcacqn4rc9xf","order":1,"base_id":"p_xm3thidrblw4n7","show":1}],"fk_geo_data_col_id":"cl_8iw2o4ejzvdyna","fk_view_id":"vw_qjt7klod1p9kyv","meta":{},"order":0,"base_id":"p_xm3thidrblw4n7","show":true,"title":"My Map"}],"properties":{"source_id":{"description":"The ID of the source that this view belongs to","example":"ds_g4ccx6e77h1dmi","type":"string"},"columns":{"description":"Columns in this view","items":{"$ref":"#/components/schemas/MapColumn"},"type":"array"},"fk_geo_data_col_id":{"description":"Foreign Key to GeoData Column","example":"cl_8iw2o4ejzvdyna","type":"string"},"fk_view_id":{"description":"Unique ID for Map","example":"vw_qjt7klod1p9kyv","type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for this view"},"order":{"description":"The order of the map list","type":"number"},"base_id":{"description":"The ID of the base that this view belongs to","example":"p_xm3thidrblw4n7","type":"string"},"show":{"description":"To show this Map or not","type":"boolean"},"title":{"description":"Title of Map View","example":"My Map","type":"string"}},"title":"Map Model","type":"object","x-stoplight":{"id":"bg6hvpyk90f0p"}},"MapUpdateReq":{"description":"Model for Map","x-stoplight":{"id":"2me98w8ot1e6o"},"examples":[{"fk_geo_data_col_id":"cl_8iw2o4ejzvdyna","meta":null}],"title":"Map View Update Request Model","type":"object","properties":{"fk_geo_data_col_id":{"description":"Foreign Key to GeoData Column","example":"cl_8iw2o4ejzvdyna","type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for this view"}}},"MapColumn":{"description":"Model for Map Column","examples":[{"source_id":"ds_g4ccx6e77h1dmi","fk_column_id":"cl_8iw2o4ejzvdyna","fk_view_id":"vw_qjt7klod1p9kyv","id":"nc_46xcacqn4rc9xf","order":1,"base_id":"p_xm3thidrblw4n7","show":1}],"properties":{"source_id":{"description":"The ID of the source that this map column belongs to","example":"ds_g4ccx6e77h1dmi","type":"string"},"fk_column_id":{"description":"Foreign Key to Column","example":"cl_8iw2o4ejzvdyna","type":"string"},"fk_view_id":{"description":"Foreign Key to View","example":"vw_qjt7klod1p9kyv","type":"string"},"id":{"description":"Unique ID of Map Column","example":"nc_46xcacqn4rc9xf","type":"string"},"order":{"description":"the order in the list of map columns","example":1,"type":"number"},"base_id":{"description":"The ID of the base that this map column belongs to","example":"p_xm3thidrblw4n7","type":"string"},"show":{"description":"Whether to show this column or not","example":1,"type":"number"}},"title":"Map Column Model","type":"object","x-stoplight":{"id":"01nfqgzhqlqoe"}},"Meta":{"description":"Model for Meta","examples":[{}],"oneOf":[{"type":"null"},{"type":"object"},{"type":"string"}],"title":"Meta Model","x-stoplight":{"id":"daskjldw4zldd"}},"ModelRoleVisibility":{"description":"Model for ModelRoleVisibility","examples":[{"source_id":"string","disabled":true,"fk_model_id":"string","fk_view_id":"string","id":"string","base_id":"string","role":"string"}],"properties":{"source_id":{"type":"string"},"disabled":{"$ref":"#/components/schemas/Bool"},"fk_model_id":{"type":"string"},"fk_view_id":{"type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"base_id":{"type":"string"},"role":{"type":"string"}},"title":"ModelRoleVisibility Model","type":"object","x-stoplight":{"id":"cxh7walcnpkn0"}},"NormalColumnRequest":{"description":"Model for Normal Column Request","examples":[{"ai":true,"au":true,"cc":"string","cdf":"string","column_name":"string","csn":"string","dt":"string","dtx":"string","dtxp":0,"dtxs":0,"np":0,"ns":0,"pk":true,"pv":true,"rqd":true,"title":"string","uidt":"ID","un":true,"unique":true}],"properties":{"ai":{"$ref":"#/components/schemas/Bool","description":"Is this column auto-incremented?"},"au":{"$ref":"#/components/schemas/Bool","description":"Is this column auto-updated datetime field?"},"cc":{"$ref":"#/components/schemas/StringOrNull","description":"Column Comment"},"cdf":{"$ref":"#/components/schemas/StringOrNullOrBooleanOrNumber","description":"Column Default Value"},"column_name":{"maxLength":255,"minLength":1,"type":"string","description":"Column Name"},"csn":{"$ref":"#/components/schemas/StringOrNull"},"dt":{"type":"string","description":"Data Type"},"dtx":{"$ref":"#/components/schemas/StringOrNull","description":"Data Type Extra"},"dtxp":{"oneOf":[{"type":"string"},{"type":"number"},{"type":"null"}],"description":"Data Type Extra Precision"},"dtxs":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"number"}],"description":"Data Type Extra Scale"},"np":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"integer"}],"description":"Numeric Precision"},"ns":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"integer"}],"description":"Numeric Scale"},"pk":{"$ref":"#/components/schemas/Bool","description":"Is this column a primary key?"},"pv":{"$ref":"#/components/schemas/Bool","description":"Is this column a primary value?"},"rqd":{"$ref":"#/components/schemas/Bool","description":"Is this column required?"},"title":{"maxLength":255,"type":"string","description":"Column Title"},"uidt":{"enum":["Attachment","AutoNumber","Barcode","Button","Checkbox","Collaborator","Count","CreatedTime","Currency","Date","DateTime","Decimal","Duration","Email","Formula","ForeignKey","GeoData","Geometry","ID","JSON","LastModifiedTime","LongText","LinkToAnotherRecord","Lookup","MultiSelect","Number","Percent","PhoneNumber","Rating","Rollup","SingleLineText","SingleSelect","SpecificDBType","Time","URL","Year","QrCode","Links","User","CreatedBy","LastModifiedBy"],"type":"string","description":"UI Data Type"},"un":{"$ref":"#/components/schemas/Bool","description":"Is this column unique?"},"unique":{"$ref":"#/components/schemas/Bool","description":"Is this column unique?"}},"title":"Normal Column Request Model","type":"object","required":["title"],"x-stoplight":{"id":"fn3gqmojvswv2"}},"OrgUserReq":{"description":"Model for Organisation User Update Request","examples":[{"email":"user@example.com","roles":"org-level-creator"}],"properties":{"email":{"format":"email","type":"string"},"roles":{"enum":["org-level-creator","org-level-viewer"],"type":"string","description":"Roles for the base user"}},"title":"Organisation User Request Model","type":"object","x-stoplight":{"id":"n484boi6jv3up"}},"Paginated":{"description":"Model for Paginated","examples":[{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}],"properties":{"isFirstPage":{"description":"Is the current page the first page","type":"boolean"},"isLastPage":{"description":"Is the current page the last page","type":"boolean"},"page":{"description":"The current page","example":1,"type":"number"},"offset":{"description":"The current offset and it will be present only when the page is not included","example":1,"type":"number"},"pageSize":{"description":"The number of pages","example":10,"type":"number"},"totalRows":{"description":"The number of rows in the given result","example":1,"type":"number"}},"title":"Paginated Model","type":"object","x-stoplight":{"id":"2x65v3n9xo8q3"}},"Password":{"description":"Model for Password","example":"password123456789","examples":["password123456789"],"minLength":8,"title":"Password Model","type":"string","x-stoplight":{"id":"s7gk265anpyc7"}},"PasswordChangeReq":{"description":"Model for Password Change Request","examples":[{"currentPassword":"currentpassword","newPassword":"newpassword"}],"properties":{"currentPassword":{"minLength":8,"maxLength":128,"type":"string"},"newPassword":{"minLength":8,"maxLength":128,"type":"string"}},"required":["currentPassword","newPassword"],"title":"Password Change Request Model","type":"object","x-stoplight":{"id":"wvritsht82jyy"}},"PasswordForgotReq":{"description":"Model for Password Forgot Request","examples":[{"email":"user@example.com"}],"properties":{"email":{"description":"Email address of the user","format":"email","type":"string"}},"required":["email"],"title":"Password Forgot Request Model","type":"object","x-stoplight":{"id":"qj6pb0nc6dtb1"}},"PasswordResetReq":{"description":"Model for Password Reset Request","examples":[{"password":"newpassword"}],"properties":{"password":{"description":"New password","example":"newpassword","minLength":8,"maxLength":128,"type":"string"}},"required":["password"],"title":"Password Reset Request Model","type":"object","x-stoplight":{"id":"24ig9uh9evw2p"}},"Plugin":{"description":"Model for Plugin","examples":[{"id":"nc_tljibbzcyjrhcc","title":"S3","description":"Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.","active":true,"rating":null,"version":"0.0.1","docs":null,"status":"install","status_details":null,"logo":"plugins/s3.png","icon":null,"tags":"Storage","category":"Storage","input_schema":"{\\"title\\":\\"Configure Amazon S3\\",\\"items\\":[{\\"key\\":\\"bucket\\",\\"label\\":\\"Bucket Name\\",\\"placeholder\\":\\"Bucket Name\\",\\"type\\":\\"SingleLineText\\",\\"required\\":true},{\\"key\\":\\"region\\",\\"label\\":\\"Region\\",\\"placeholder\\":\\"Region\\",\\"type\\":\\"SingleLineText\\",\\"required\\":true},{\\"key\\":\\"access_key\\",\\"label\\":\\"Access Key\\",\\"placeholder\\":\\"Access Key\\",\\"type\\":\\"SingleLineText\\",\\"required\\":true},{\\"key\\":\\"access_secret\\",\\"label\\":\\"Access Secret\\",\\"placeholder\\":\\"Access Secret\\",\\"type\\":\\"Password\\",\\"required\\":true}],\\"actions\\":[{\\"label\\":\\"Test\\",\\"placeholder\\":\\"Test\\",\\"key\\":\\"test\\",\\"actionType\\":\\"TEST\\",\\"type\\":\\"Button\\"},{\\"label\\":\\"Save\\",\\"placeholder\\":\\"Save\\",\\"key\\":\\"save\\",\\"actionType\\":\\"SUBMIT\\",\\"type\\":\\"Button\\"}],\\"msgOnInstall\\":\\"Successfully installed and attachment will be stored in AWS S3\\",\\"msgOnUninstall\\":\\"\\"}","input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}","creator":null,"creator_website":null,"price":null}],"title":"Plugin Model","type":"object","properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is plguin active?"},"category":{"type":"string","description":"Plugin Category","example":"Storage"},"creator":{"type":"string","description":"Plugin Creator (Not in use)"},"creator_website":{"type":"string","description":"Plugin Creator website (Not in use)"},"description":{"type":"string","description":"Plugin Description","example":"Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance."},"docs":{"type":"string","description":"Documentation of plugin (Not in use)"},"icon":{"type":"string","description":"Plugin Icon (Not in use)"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"input":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"integer"}],"description":"Plugin Input"},"input_schema":{"type":"string","description":"Plugin Input Schema\\n"},"logo":{"type":"string","description":"Plugin logo","example":"plugins/s3.png"},"price":{"type":"string","description":"Plugin Price (Not in use)"},"rating":{"type":"number","description":"Plugin Rating (Not in use)"},"status":{"type":"string","description":"Plugin Status","example":"install"},"status_details":{"type":"string","description":"Not in use"},"tags":{"type":"string","description":"Plugin tags","example":"Storage"},"title":{"type":"string","description":"Plugin Title"},"version":{"type":"string","description":"Plugin Version","example":"0.0.1"}},"x-stoplight":{"id":"xxoy0oe5kab93"}},"PluginReq":{"description":"Model for Plugin Request","examples":[{"active":0,"input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}"}],"title":"Plugin Reqeust","type":"object","x-stoplight":{"id":"qcriv4xl88hyu"},"properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is Plugin Active?"},"input":{"description":"Plugin Input","oneOf":[{"type":"string"},{"type":"null"}]}}},"PluginTestReq":{"description":"Model for Plugin Test Request","examples":[{"title":"Plugin Foo","input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}","category":"Email"}],"title":"Plugin Test Request Model","type":"object","properties":{"title":{"maxLength":45,"type":"string","description":"Plugin Title"},"input":{"oneOf":[{"type":"string","description":"Plugin Input as JSON string"},{"description":"Plugin Input","type":"object"}]},"category":{"x-stoplight":{"id":"rg3i3ov9rs6d0"},"type":"string","example":"Email"}},"required":["title","input","category"],"x-stoplight":{"id":"zrvjtpfx9wc54"}},"Base":{"description":"Model for Base","examples":[{"sources":[{"alias":"string","config":null,"enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"base_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my base description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-base"}],"title":"Base Model","type":"object","properties":{"sources":{"description":"List of source models","type":"array","items":{"$ref":"#/components/schemas/Source"}},"color":{"description":"Primary Theme Color","example":"#24716E","type":"string"},"deleted":{"$ref":"#/components/schemas/Bool","description":"Is the base deleted"},"description":{"description":"Base Description","example":"This is my base description","type":"string"},"id":{"description":"Unique Base ID","example":"p_124hhlkbeasewh","type":"string"},"fk_workspace_id":{"description":"Workspace ID","example":"ws_123456","type":"string"},"is_meta":{"$ref":"#/components/schemas/Bool"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info such as theme colors"},"order":{"description":"The order in base list","type":"number"},"prefix":{"description":"Base prefix. Used in XCDB only.","example":"nc_vm5q__","type":"string"},"type":{"type":"string","enum":["database","documentation","dashboard"]},"linked_db_projects":{"description":"List of linked Database Projects that this base has access to (only used in Dashboard bases so far)","type":"array","items":{"$ref":"#/components/schemas/Base"}},"status":{"type":"string"},"title":{"description":"Base Title","example":"my-base","type":"string"}},"x-stoplight":{"id":"t8uouhop01ndi"}},"ProjectList":{"description":"Model for Base List","examples":[{"list":[{"sources":[{"alias":"string","config":null,"created_at":"2023-03-01 14:27:36","enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"base_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my base description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-base","updated_at":"2023-03-01 14:27:36"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Base List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"description":"List of Base Models","minItems":1,"type":"array","uniqueItems":true,"items":{"$ref":"#/components/schemas/Base"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Pagination Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"fr75wwwzt951h"}},"ProjectReq":{"description":"Model for Base Request","examples":[{"sources":[{"alias":"My Source","config":null,"inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"type":"mysql"}],"color":"#24716E","description":"This is my base description","title":"My Base"}],"properties":{"sources":{"description":"Array of Bases","items":{"$ref":"#/components/schemas/BaseReq"},"type":"array"},"color":{"description":"Primary Theme Color","example":"#24716E","maxLength":50,"type":"string"},"description":{"description":"Base Description","example":"This is my base description","type":"string"},"title":{"description":"Base Title","example":"My Base","maxLength":128,"minLength":1,"type":"string"},"status":{"$ref":"#/components/schemas/StringOrNull","description":"Base Status","example":"locked"},"type":{"type":"string","enum":["database","documentation","dashboard"]},"linked_db_project_ids":{"description":"List of Linked Database Base IDs (only used for Dashboard Projects so far)","type":"array","items":{"type":"string"}},"meta":{"$ref":"#/components/schemas/Meta","description":"Base Meta"}},"required":["title"],"title":"Base Request Model","type":"object","x-stoplight":{"id":"f5k929rrvfy92"}},"ProjectUpdateReq":{"description":"Model for Base Update Request","x-stoplight":{"id":"0fq3a94qjgb5f"},"examples":[{"color":"#24716E","meta":null,"title":"My Base","order":1}],"title":"Base Update Request Model","type":"object","properties":{"color":{"description":"Primary Theme Color","example":"#24716E","maxLength":50,"type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Base Meta","x-stoplight":{"id":"m05w9sbwqgul3"}},"title":{"description":"Base Title","example":"My Base","maxLength":128,"minLength":1,"type":"string"},"status":{"$ref":"#/components/schemas/StringOrNull","description":"Base Status","example":"locked"},"linked_db_project_ids":{"description":"List of Linked Database Base IDs (only used for Dashboard Projects so far)","type":"array","items":{"type":"string"}},"order":{"type":"number","description":"The order of the list of projects.","example":1,"minimum":0}}},"ProjectUserReq":{"description":"Model for Base User Request","examples":[{"email":"user@example.com","roles":"owner"}],"title":"Base User Request Model","type":"object","properties":{"email":{"type":"string","description":"Base User Email"},"roles":{"enum":["no-access","commenter","editor","guest","owner","viewer","creator"],"type":"string","description":"Base User Role"}},"required":["email","roles"],"x-stoplight":{"id":"3bvgqk9tn16ur"}},"ProjectUserMetaReq":{"description":"Model for Base User Meta Request","examples":[{"starred":true,"order":1,"hidden":true}],"title":"Base User Meta Request Model","type":"object","properties":{"starred":{"$ref":"#/components/schemas/Bool","description":"Star Base"},"order":{"type":"number","description":"The order among the bases","example":1},"hidden":{"$ref":"#/components/schemas/Bool"}}},"Rollup":{"description":"Model for Rollup","examples":[{"id":"rl_kc19pbdkij8wly","fk_column_id":"cl_588b63mneri2yi","fk_relation_column_id":"cl_c09q6eu6hsvn4s","fk_rollup_column_id":"cl_m62i1vyl23n8co","rollup_function":"count"}],"title":"Rollup Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign to Relation Column"},"fk_rollup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign to Rollup Column"},"rollup_function":{"type":"string","description":"Rollup Function","example":"count","enum":["count","min","max","avg","sum","countDistinct","sumDistinct","avgDistinct"]}},"x-stoplight":{"id":"imknmkksc8bqk"}},"RollupColumnReq":{"description":"Model for Rollup Column Request","examples":[{"fk_relation_column_id":"cl_c09q6eu6hsvn4s","fk_rollup_column_id":"cl_m62i1vyl23n8co","title":"Rollup Column","rollup_function":"avg","uidt":"Rollup"}],"title":"Rollup Column Request Model","type":"object","properties":{"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Relation Column"},"fk_rollup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Rollup Column"},"title":{"maxLength":255,"type":"string","description":"Rollup Column Title"},"rollup_function":{"enum":["avg","avgDistinct","count","countDistinct","max","min","sum","sumDistinct"],"type":"string","description":"Rollup Function"},"uidt":{"enum":["Rollup"],"type":"string","description":"UI DataType"}},"x-stoplight":{"id":"ayjjv1pfxmvlv"}},"SelectOption":{"description":"Model for SelectOption","examples":[{"id":"sl_hvfeuagqtlzzbk","title":"Option A","fk_column_id":"cl_35zmvi2tezfipw","color":"#cfdffe","order":1}],"title":"SelectOption Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"title":{"type":"string","description":"Option Title\\n","example":"Option A"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"color":{"type":"string","description":"Option Color","example":"#cfdffe"},"order":{"type":"number","description":"The order among the options","example":1}},"x-stoplight":{"id":"y9gglydcl3zjr"}},"SelectOptions":{"description":"Model for SelectOptions","examples":[{"options":[{"id":"sl_hvfeuagqtlzzbk","title":"Option A","fk_column_id":"cl_35zmvi2tezfipw","color":"#cfdffe","order":1}]}],"title":"SelectOptions Model","type":"object","properties":{"options":{"type":"array","description":"Array of select options","items":{"$ref":"#/components/schemas/SelectOption"}}},"required":["options"],"x-stoplight":{"id":"3rx8jyy2ufbc3"}},"SharedBaseReq":{"description":"Model for Shared Base Request","examples":[{"password":"password123","roles":"editor"}],"title":"Shared Base Request Model","type":"object","properties":{"password":{"minLength":8,"type":"string","description":"Password to protect the base","example":"password123"},"roles":{"enum":["commenter","editor","viewer"],"type":"string","description":"The role given the target user","example":"editor"}},"x-stoplight":{"id":"4jvab8fa8ibxv"}},"SharedView":{"$ref":"#/components/schemas/View","description":"Model for Shared View","title":"SharedView","examples":[{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"x-stoplight":{"id":"gagdto3i3c0fb"}},"SharedViewList":{"description":"Model for Shared View List","examples":[{"list":[{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Shared View List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of shared view objects","items":{"$ref":"#/components/schemas/SharedView"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"5gnbbmgal3om3"}},"SharedViewReq":{"description":"Model for Shared View Request","examples":[{"meta":{},"password":"123456789"}],"title":"Shared View Request Model","type":"object","properties":{"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data passing to Shared View such as if download is allowed or not."},"password":{"$ref":"#/components/schemas/StringOrNull","description":"Password to restrict access"}},"x-stoplight":{"id":"hbj6j87gyi7ap"}},"SignInReq":{"description":"Model for Signin Request","examples":[{"email":"user@example.com","password":"string"}],"properties":{"email":{"description":"Email address of the user","format":"email","type":"string"},"password":{"description":"Password of the user","type":"string"}},"required":["email","password"],"title":"Signin Request Model","type":"object","x-stoplight":{"id":"efb2gvnypydy9"}},"SignUpReq":{"description":"Model for Signup Request","examples":[{"email":"user@example.com","password":"password123456789","firstname":"Alice","lastname":"Smith","token":null,"ignore_subscribe":0}],"title":"Signup Request Model","type":"object","properties":{"email":{"description":"Email address of the user","example":"user@example.com","format":"email","type":"string"},"password":{"description":"Password of the user","example":"password123456789","minLength":8,"maxLength":128,"type":"string"},"firstname":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"lblivgs8wcsm1"}},"lastname":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"d4341r35tucq3"}},"token":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"otw9jgnr9n7c4"},"description":"Sign Up Token. Used for invitation."},"ignore_subscribe":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"g7ge6mc6vdsds"},"description":"Ignore Subscription"}},"required":["email","password"],"x-stoplight":{"id":"6ia1chyii9w48"}},"Sort":{"description":"Model for Sort","examples":[{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","source_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"base_id":"p_9sx43moxhqtjm3"}],"title":"Sort Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id"},"fk_model_id":{"$ref":"#/components/schemas/Id"},"source_id":{"type":"string","description":"Source ID","example":"ds_3l9qx8xqksenrl","readOnly":true},"direction":{"type":"string","description":"Sort direction","enum":["asc","desc","count-desc","count-asc"],"example":"desc"},"order":{"type":"number","example":1},"base_id":{"type":"string","description":"Base ID","example":"p_9sx43moxhqtjm3","readOnly":true}},"x-stoplight":{"id":"25fm97zsmwf6h"}},"SortList":{"description":"Model for Sort List","examples":[{"list":[{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","source_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"base_id":"p_9sx43moxhqtjm3"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Sort List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"gjqqc8ciqg947"},"description":"List of Sort Objects","items":{"$ref":"#/components/schemas/Sort","x-stoplight":{"id":"usnfa1kbovpmb"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"i75wcejfp5mnq"}}},"required":["list","pageInfo"],"x-stoplight":{"id":"us9qfo1go142f"}},"SortReq":{"description":"Model for Sort Request","examples":[{"direction":"asc","fk_column_id":"cl_l11b769pe2j1ce"}],"minProperties":1,"title":"Sort Request Model","type":"object","properties":{"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"direction":{"description":"Sort direction","enum":["asc","desc"],"type":"string"}},"x-stoplight":{"id":"8v8qzwm3w4v11"}},"TextOrNull":{"description":"Model for TextOrNull","examples":["string"],"oneOf":[{"maxLength":8192,"type":"string"},{"type":"null"}],"title":"TextOrNull Model"},"CalendarRangeOrNull":{"description":"Model for CalendarRangeOrNull","example":[{"id":"kvc_2skkg5mi1eb37f","fk_from_column_id":"cl_hzos4ghyncqi4k","fk_to_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","label":"string"}],"oneOf":[{"type":"null"},{"type":"array","items":{"$ref":"#/components/schemas/CalendarRange"}}],"title":"CalendarRangeOrNull Model","x-stoplight":{"id":"p1g7xrgdsn540"}},"StringOrNull":{"description":"Model for StringOrNull","examples":["string"],"oneOf":[{"maxLength":255,"type":"string"},{"type":"null"}],"title":"StringOrNull Model","x-stoplight":{"id":"p1g7xrgdsn540"}},"StringOrNullOrBooleanOrNumber":{"description":"Model for StringOrNullOrBooleanOrNumber","examples":["string"],"oneOf":[{"type":"string"},{"type":"null"},{"type":"boolean"},{"type":"number"}],"title":"StringOrNullOrBooleanOrNumber Model"},"IdOrNull":{"description":"Model for IdOrNull","examples":["string"],"oneOf":[{"$ref":"#/components/schemas/Id"},{"type":"null"}],"title":"IdOrNull Model"},"Table":{"description":"Model for Table","examples":[{"source_id":"ds_g4ccx6e77h1dmi","columns":[{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":1,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}],"columnsById":{"cl_c5knoi4xs4sfpt":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_jpl0qu4gj4rexq":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_m4wkaqgqqjzoeh":{"ai":0,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_phvuuwjrzcdo0g":{"ai":1,"au":0,"source_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"base_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}},"created_at":"2023-03-02 17:04:06","deleted":null,"enabled":1,"id":"md_rsu68aqjsbyqtl","meta":null,"mm":0,"order":1,"pinned":null,"base_id":"p_xm3thidrblw4n7","schema":null,"table_name":"nc_vm5q___Table1","tags":null,"title":"Table1","type":"table","updated_at":"2023-03-02 17:04:08","views":[{"_ptn":"Table1","_tn":"Table1","source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","disabled":{"commenter":false,"creator":false,"editor":false,"guest":false,"owner":false,"viewer":false},"fk_model_id":"md_rsu68aqjsbyqtl","id":"vw_p2jcatxz4mvcfw","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","ptn":"nc_vm5q___Table1","ptype":"table","show":1,"show_system_fields":null,"table_meta":null,"title":"Table1","tn":"Table1","type":3,"updated_at":"2023-03-02 17:04:06","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","fk_view_id":"vw_p2jcatxz4mvcfw","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:04:06","uuid":null}}]}],"title":"Table Model","type":"object","properties":{"source_id":{"description":"Unique Source ID","type":"string"},"columns":{"description":"The columns included in this table","type":"array","items":{"$ref":"#/components/schemas/Column"}},"columnsById":{"description":"Column Models grouped by IDs","type":"object"},"deleted":{"$ref":"#/components/schemas/Bool"},"enabled":{"$ref":"#/components/schemas/Bool","description":"Is this table enabled?"},"id":{"description":"Unique Table ID","type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Data"},"mm":{"$ref":"#/components/schemas/Bool","description":"Is this table used for M2M"},"order":{"description":"The order of the list of tables","type":"number"},"pinned":{"$ref":"#/components/schemas/Bool","description":"Currently not in use"},"base_id":{"description":"Unique Base ID","type":"string"},"description":{"description":"Table Description","$ref":"#/components/schemas/TextOrNull"},"table_name":{"description":"Table Name. Prefix will be added for XCDB bases.","type":"string"},"tags":{"$ref":"#/components/schemas/StringOrNull","description":"Currently not in use"},"title":{"description":"Table Title","type":"string"},"type":{"description":"Table Type","type":"string"}},"required":["title","title"],"x-stoplight":{"id":"dkfoyjcny5am9"}},"TableList":{"description":"Model for Table List","examples":[{"list":[{"alias":"string","source_id":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"source_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"id":"string","order":0,"parent_id":"string","pinned":true,"base_id":"string","show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Table List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of table objects","items":{"$ref":"#/components/schemas/Table"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"urwk2euatlkjl"}},"TableReq":{"description":"Model for Table Request","examples":[{"columns":[{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"updated_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"UpdatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"created_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"CreatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":null,"ck":false,"clen":45,"column_name":"title","ct":"varchar(45)","dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"Title","uicn":"","uidt":"SingleLineText","uip":"","un":false},{"ai":true,"altered":1,"cdf":null,"ck":false,"clen":null,"column_name":"id","ct":"int(11)","dt":"int","dtx":"integer","dtxp":"11","dtxs":"","np":11,"nrqd":false,"ns":0,"pk":true,"rqd":true,"title":"Id","uicn":"","uidt":"ID","uip":"","un":true}],"table_name":"Sheet-1","title":"Sheet-1"}],"properties":{"columns":{"description":"The column models in this table","items":{"$ref":"#/components/schemas/NormalColumnRequest"},"type":"array"},"description":{"description":"Table description","$ref":"#/components/schemas/TextOrNull"},"meta":{"$ref":"#/components/schemas/Meta","description":"the meta data for this table"},"order":{"description":"The order of table list","example":1,"type":"number"},"table_name":{"description":"Table name","example":"my_table","maxLength":255,"minLength":1,"type":"string"},"title":{"description":"Table title","example":"My Table","maxLength":255,"minLength":0,"type":"string"}},"required":["columns","title"],"title":"Table Request Model","type":"object","x-stoplight":{"id":"sv3junrrevn31"}},"User":{"description":"Model for User","examples":[{"id":"142","user_name":"jaysmith","display_name":"Jay Smith","email":"jay.smith@gmail.com","emailVerified":true,"roles":"org-level-creator,super","bio":"foo","location":"Istanbul","created_at":"2019-08-24","avatar":"https://dummyimage.com/300.png"}],"title":"User Model","type":"object","x-internal":false,"properties":{"id":{"type":"string","description":"Unique identifier for the given user."},"email":{"type":"string","format":"email"},"roles":{"type":"string"},"email_verified":{"type":"boolean","description":"Set to true if the user\'s email has been verified."},"created_at":{"type":"string","format":"date","description":"The date that the user was created."},"updated_at":{"type":"string","format":"date","description":"The date that the user was created."},"display_name":{"type":"string"},"user_name":{"type":"string"},"bio":{"type":"string"},"location":{"type":"string"},"website":{"type":"string"},"avatar":{"type":"string"},"token_version":{"description":"Access token version","type":"string"}},"required":["id","email","email_verified"],"x-stoplight":{"id":"hcruzlenrwb2x"}},"UserInfo":{"description":"Model for User Info","examples":[{"email":"user@example.com","email_verified":true,"firstname":"string","id":"string","lastname":"string","roles":null}],"properties":{"email":{"description":"User Email","format":"email","type":"string"},"email_verified":{"description":"Set to true if the user\'s email has been verified.","type":"boolean"},"firstname":{"description":"The firstname of the user","type":"string"},"id":{"description":"User ID","type":"string"},"lastname":{"description":"The lastname of the user","type":"string"},"roles":{"description":"The roles of the user"},"base_roles":{"description":"The base roles of the user"},"workspace_roles":{"description":"The workspace roles of the user"}},"title":"User Info Model","type":"object","x-stoplight":{"id":"mzqg7tcf4hglo"}},"UserList":{"description":"Model for User List","examples":[{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"User List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"8o7v47q3e67ef"},"description":"List of user objects","items":{"$ref":"#/components/schemas/User","x-stoplight":{"id":"kwqzxwea9r5er"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"0d98n6sfxfvft"},"description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"32mz06s4tgptq"}},"View":{"description":"Model for View","examples":[{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"title":"View Model","type":"object","properties":{"source_id":{"$ref":"#/components/schemas/Id","description":"Unique Source ID"},"fk_model_id":{"$ref":"#/components/schemas/Id","description":"Unique Model ID"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID for View"},"lock_type":{"description":"Lock Type of the view","enum":["collaborative","locked","personal"],"type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for this view"},"order":{"description":"The rder of the list of views","type":"number"},"description":{"description":"View Description","$ref":"#/components/schemas/TextOrNull"},"password":{"$ref":"#/components/schemas/StringOrNull","description":"Password for protecting the view"},"base_id":{"$ref":"#/components/schemas/Id","description":"Unique Base ID"},"show":{"$ref":"#/components/schemas/Bool","description":"If this view is shown?"},"show_system_fields":{"$ref":"#/components/schemas/Bool","description":"Should show system fields in this view?"},"is_default":{"$ref":"#/components/schemas/Bool","description":"Is this view default view for the model?"},"title":{"description":"View Title","type":"string"},"type":{"description":"View Type","type":"number"},"uuid":{"$ref":"#/components/schemas/StringOrNull","description":"UUID of the view"},"view":{"anyOf":[{"$ref":"#/components/schemas/Form"},{"$ref":"#/components/schemas/Gallery"},{"$ref":"#/components/schemas/Grid"},{"$ref":"#/components/schemas/Kanban"},{"$ref":"#/components/schemas/Map"},{"$ref":"#/components/schemas/Calendar"}],"description":"Associated View Model"}},"required":["fk_model_id","show","title","type"],"x-stoplight":{"id":"nobjewdlhxrkq"}},"ViewList":{"description":"Model for View List","examples":[{"list":[{"alias":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"source_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"fk_base_id":"string","fk_project_id":"string","id":"string","order":0,"parent_id":"string","pinned":true,"show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"View List Model","type":"object","x-examples":{"example-1":{"sources":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"base_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","description":"List of view objects","items":{"$ref":"#/components/schemas/View"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"a1f99jvpiuugl"}},"ViewCreateReq":{"type":"object","x-stoplight":{"id":"zvdo4i7c70jmo"},"title":"ViewCreateReq","description":"Model for View Create Request","examples":[{"title":"My Grid View","type":3,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null},{"title":"My Gallery View","type":2,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null},{"title":"My Form View","type":1,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null},{"title":"My Kanban View","type":4,"copy_from_id":null,"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_geo_data_col_id":null},{"title":"My Calendar View","type":6,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null,"calendar_range":[{"fk_from_column_id":"cl_5jestblzneb649","fk_to_column_id":"cl_5jestblzneb649"}]},{"title":"My Map View","type":5,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":"cl_uu1meolj00tlrq"}],"properties":{"title":{"type":"string","description":"View Title","example":"My View"},"type":{"type":"number","description":"View Type"},"copy_from_id":{"$ref":"#/components/schemas/StringOrNull","description":"ID of view to be copied from. Used in Copy View."},"fk_grp_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Grouping Column. Used in creating Kanban View."},"fk_geo_data_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Geo Data Column. Used in creating Map View."},"calendar_range":{"description":"Calendar Range or Null","$ref":"#/components/schemas/CalendarRangeOrNull"}},"required":["title"]},"ViewUpdateReq":{"description":"Model for View Update Request","x-stoplight":{"id":"7inf594lhs8mh"},"examples":[{"title":"Grid View 1","uuid":"e2457bbf-e29c-4fec-866e-fe3b01dba57f","password":"password123","lock_type":"collaborative","meta":"{\\"allowCSVDownload\\":true}","order":1,"show_system_fields":0}],"title":"View Update Request Model","type":"object","properties":{"title":{"maxLength":255,"type":"string","description":"View Title","example":"Grid View 1"},"description":{"$ref":"#/components/schemas/TextOrNull","description":"Description of the view.","example":"This is a grid view."},"uuid":{"maxLength":255,"type":"string","x-stoplight":{"id":"vlhs7xs644u8l"},"description":"View UUID. Used in Shared View.","example":"e2457bbf-e29c-4fec-866e-fe3b01dba57f"},"password":{"maxLength":255,"type":"string","x-stoplight":{"id":"vlhs7xs644u8l"},"description":"View Password. Used in Shared View.","example":"password123"},"lock_type":{"enum":["collaborative","locked","personal"],"type":"string","description":"Lock type of View.","example":"collaborative"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta info used in View."},"order":{"type":"number","description":"The order of the list of views.","example":1,"minimum":0},"show_system_fields":{"$ref":"#/components/schemas/Bool","description":"Should this view show system fields?"}}},"ViewColumnUpdateReq":{"description":"Model for View Column Update Request","x-stoplight":{"id":"7xso36z6hvh43"},"examples":[{"show":0,"order":1}],"title":"View Column Update Request Model","type":"object","properties":{"show":{"$ref":"#/components/schemas/Bool","description":"View Title","x-stoplight":{"id":"coxius73ejq5x"}},"order":{"type":"number","description":"The order of the list of views.","example":1,"minimum":0}}},"ViewColumnReq":{"description":"Model for View Column Request","x-stoplight":{"id":"ofapz0gzl35z2"},"examples":[{"fk_column_id":"cl_5jestblzneb649","show":0,"order":1}],"title":"View Column Request Model","type":"object","properties":{"fk_column_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"rxd07wvp9hf6s"},"description":"Foreign Key to Column"},"show":{"$ref":"#/components/schemas/Bool","description":"View Title","x-stoplight":{"id":"coxius73ejq5x"}},"order":{"type":"number","description":"The order of the list of views.","example":1,"minimum":0}}},"VisibilityRuleReq":{"description":"Model for Visibility Rule Request","examples":[[{"disabled":{"commenter":true,"creator":true,"editor":true,"guest":true,"owner":true,"viewer":true}}]],"items":{"properties":{"id":{"oneOf":[{"type":"string"},{"type":"null"}]},"disabled":{"properties":{"commenter":{"$ref":"#/components/schemas/Bool"},"creator":{"$ref":"#/components/schemas/Bool"},"editor":{"$ref":"#/components/schemas/Bool"},"guest":{"$ref":"#/components/schemas/Bool"},"owner":{"$ref":"#/components/schemas/Bool"},"viewer":{"$ref":"#/components/schemas/Bool"}},"type":"object"}},"type":"object"},"title":"Visibility Rule Request Model","type":"array","x-stoplight":{"id":"xu5zgt0fc3ms9"}},"Webhook":{"properties":{"id":{"type":"string"},"title":{"type":"string"},"type":{"type":"string"}},"title":"Webhook","type":"object"},"ProjectInviteEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who receives the base invite"},"type":{"type":"string","description":"The type of event, which should be set to \'PROJECT_INVITE\'"},"body":{"type":"object","properties":{"base":{"type":"object","properties":{"id":{"type":"string","description":"The ID of the base being invited to"},"title":{"type":"string","description":"The title of the base being invited to"},"type":{"type":"string","description":"The type of the base being invited to"}},"required":["id","title","type"],"description":"The ID of the base being invited to"},"user":{"type":"object","properties":{"id":{"type":"string","description":"The ID of the user who invited to the base"},"email":{"type":"string","description":"The email address of the user who invited to the base"},"display_name":{"type":"string","description":"The display name of the user who invited to the base"}},"required":["id","email"]}},"required":["base","user"]}},"required":["fk_user_id","type","body"]},"WelcomeEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user receiving the welcome message"},"type":{"type":"string","description":"The type of event, which should be set to \'WELCOME\'"},"body":{"type":"object","description":"An empty object"}},"required":["fk_user_id","type","body"]},"Notification":{"allOf":[{"description":"","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"is_read":{"type":"boolean","description":"Whether the notification has been read by the user"},"is_deleted":{"type":"boolean","description":"Whether the notification has been deleted by the user"},"type":{"type":"string","description":"Type of notification"},"updated_at":{},"created_at":{}},"title":"Notification","type":"object"},{"oneOf":[{"$ref":"#/components/schemas/ProjectInviteEvent"},{"$ref":"#/components/schemas/WelcomeEvent"}]}]},"NotificationList":{"description":"Model for Notification List","examples":[{"list":[{"body":{},"type":"invite","is_read":false,"is_deleted":false,"id":"1","updated_at":"2020-05-20T12:00:00.000000Z","created_at":"2020-05-20T12:00:00.000000Z","fk_user_id":"us_b3xo2i44nx5y9l"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"API Token List Model","type":"object","properties":{"list":{"type":"array","description":"List of notification objects","items":{"$ref":"#/components/schemas/Notification"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Model for Paginated"}},"required":["list","pageInfo"]},"NotificationUpdate":{"type":"object","properties":{"is_read":{"type":"boolean"}}},"UserFieldRecord":{"type":"object","properties":{"id":{"type":"string","required":true},"display_name":{"type":"string","required":false},"email":{"type":"string","required":true},"deleted":{"type":"boolean","required":false}}},"nestedListCopyPasteOrDeleteAllReq":{"type":"array","minItems":1,"maxItems":2,"items":{"type":"object","properties":{"operation":{"type":"string","enum":["copy","paste","deleteAll"]},"rowId":{"type":"string"},"columnId":{"type":"string"},"fk_related_model_id":{"type":"string"}},"required":["operation","rowId","columnId","fk_related_model_id"]}},"KanbanColumnReq":{"description":"Model for Kanban Column Request","examples":[{"title":"string","show":0,"order":"1"}],"title":"Kanban Column Model Request","type":"object","properties":{"title":{"type":"string","description":"Title"},"show":{"$ref":"#/components/schemas/Bool","description":"Is this column shown?"},"order":{"type":"number","example":1,"description":"Column Order"}}},"GalleryColumnReq":{"description":"Model for Gallery Column Request","examples":[{"label":"My Column","width":"200px"}],"properties":{"show":{"$ref":"#/components/schemas/Bool","description":"Show"},"order":{"type":"number","description":"Order","example":1}}},"CalendarColumnReq":{"description":"Model for Calendar Column Request","examples":[{"title":"string","show":0,"bold":0,"italic":0,"underline":0,"order":"1"}],"title":"Calendar Column Model","type":"object","properties":{"show":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown?"},"bold":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown as bold?"},"italic":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown as italic?"},"underline":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown underlines?"},"order":{"type":"number","x-stoplight":{"id":"pbnchzgci5dwa"},"example":1,"description":"Column Order"}},"x-stoplight":{"id":"psbv6c6y9qvbu"}},"ErrorReportReq":{"type":"object","properties":{"errors":{"type":"array","items":{"type":"object","properties":{"message":{"type":"string"},"stack":{"type":"string"}}}},"extra":{"type":"object"}}},"Comment":{"description":"Model for Comment","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"row_id":{"type":"string","example":"rec0Adp9PMG9o7uJy","description":"Row ID"},"comment":{"type":"string","example":"This is a comment","description":"Comment"},"created_by":{"$ref":"#/components/schemas/Id","example":"usr0Adp9PMG9o7uJy","description":"Created By User ID"},"created_by_email":{"type":"string","example":"xxx@nocodb.com","description":"Created By User Email"},"resolved_by":{"$ref":"#/components/schemas/Id","example":"usr0Adp9PMG9o7uJy","description":"Resolved By User ID"},"resolved_by_email":{"type":"string","example":"xxx@nocodb.com","description":"Resolved By User Email"},"parent_comment_id":{"$ref":"#/components/schemas/Id","example":"cmt043cx4r30343ff","description":"Parent Comment ID"},"source_id":{"$ref":"#/components/schemas/Id","example":"src0Adp9PMG9o7uJy","description":"Source ID"},"base_id":{"$ref":"#/components/schemas/Id","example":"bas0Adp9PMG9o7uJy","description":"Base ID"},"fk_model_id":{"$ref":"#/components/schemas/Id","example":"mod0Adp9PMG9o7uJy","description":"Model ID"},"created_at":{"type":"string","example":"2020-05-20T12:00:00.000000Z","description":"Created At"},"updated_at":{"type":"string","example":"2020-05-20T12:00:00.000000Z","description":"Updated At"},"is_deleted":{"type":"boolean","description":"Whether the comment has been deleted by the user or not"}}},"UserCommentNotificationPreference":{"description":"Model for User Comment Notification Preference","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"row_id":{"type":"string","description":"User ID"},"user_id":{"$ref":"#/components/schemas/Id","description":"User ID"},"source_id":{"$ref":"#/components/schemas/Id","example":"src0Adp9PMG9o7uJy","description":"Source ID"},"base_id":{"$ref":"#/components/schemas/Id","example":"bas0Adp9PMG9o7uJy","description":"Base ID"},"fk_model_id":{"$ref":"#/components/schemas/Id","example":"mod0Adp9PMG9o7uJy","description":"Model ID"},"preference":{"type":"string","enum":["ALL_COMMENTS","ONLY_MENTIONS"],"description":"Is Read"},"created_at":{"type":"string","description":"Created At"},"updated_at":{"type":"string","description":"Updated At"}}},"CommentReactions":{"description":"Model for Comment Reactions","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"row_id":{"type":"string","description":"Row ID"},"comment_id":{"$ref":"#/components/schemas/Id","description":"Comment ID"},"reaction":{"type":"string","description":"Reaction"},"user_id":{"$ref":"#/components/schemas/Id","description":"User ID"},"source_id":{"$ref":"#/components/schemas/Id","example":"src0Adp9PMG9o7uJy","description":"Source ID"},"base_id":{"$ref":"#/components/schemas/Id","example":"bas0Adp9PMG9o7uJy","description":"Base ID"},"fk_model_id":{"$ref":"#/components/schemas/Id","example":"mod0Adp9PMG9o7uJy","description":"Model ID"},"created_at":{"type":"string","description":"Created At"},"updated_at":{"type":"string","description":"Updated At"}}},"Extension":{"type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"base_id":{"$ref":"#/components/schemas/Id","description":"Unique Base ID"},"fk_user_id":{"$ref":"#/components/schemas/Id","description":"Unique User ID"},"extension_id":{"type":"string","description":"Extension ID"},"title":{"type":"string","description":"Extension Title"},"kv_store":{"$ref":"#/components/schemas/Meta","description":"Key Value Store for the extension"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for the extension"},"order":{"type":"number","description":"Order of the extension"}}},"ExtensionReq":{"type":"object","properties":{"base_id":{"$ref":"#/components/schemas/Id","description":"Unique Base ID"},"title":{"type":"string","description":"Extension Title"},"extension_id":{"type":"string","description":"Extension ID"},"kv_store":{"$ref":"#/components/schemas/Meta","description":"Key Value Store for the extension"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for the extension"},"order":{"type":"number","description":"Order of the extension"}}}},"responses":{"ProjectList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectList"},"examples":{"example-1":{"value":{"list":[{"sources":[{"alias":"string","config":null,"created_at":"2023-03-01 14:27:36","enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"base_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my base description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-base","updated_at":"2023-03-01 14:27:36"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"BaseList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BaseList"},"examples":{"example-1":{"value":{"list":[{"id":"ds_krsappzu9f8vmo","base_id":"p_01clqvzik3izk6","alias":null,"config":"<ENCRYPTED>","meta":null,"is_meta":1,"type":"mysql2","inflection_column":"camelize","inflection_table":"camelize","created_at":"2023-03-01 16:31:49","updated_at":"2023-03-02 11:28:17","enabled":1,"order":1},{"id":"ds_btbdt19zde0gj9","base_id":"p_01clqvzik3izk6","alias":"sakila","config":"<ENCRYPTED>","meta":null,"is_meta":null,"type":"mysql2","inflection_column":"camelize","inflection_table":"camelize","created_at":"2023-03-02 11:28:17","updated_at":"2023-03-02 11:28:17","enabled":1,"order":2}],"pageInfo":{"totalRows":2,"page":1,"pageSize":2,"isFirstPage":true,"isLastPage":true}}}}}}},"TableList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TableList"},"examples":{"Example 1":{"value":{"list":[{"id":"md_5hua2iqloqirhd","source_id":"ds_jxuewivwbxeum2","base_id":"p_tbhl1hnycvhe5l","table_name":"nc_b84e___Sheet-1","title":"Sheet-1","type":"table","meta":null,"schema":null,"enabled":true,"mm":false,"tags":null,"pinned":null,"deleted":null,"order":1,"created_at":"2023-03-11T09:11:45.907Z","updated_at":"2023-03-11T09:11:45.907Z"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"ColumnList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnList"}}}},"FilterList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"}}}},"SortList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SortList"},"examples":{}}}},"ViewList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewList"},"examples":{"Example 1":{"value":{"list":[{"alias":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"source_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"fk_base_id":"string","fk_project_id":"string","id":"string","order":0,"parent_id":"string","pinned":true,"show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"SharedViewList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"},"examples":{"Example 1":{"value":{"list":[{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"base_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"source_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"base_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"HookList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookList"}}}},"UserList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserList"},"examples":{"Example 1":{"value":{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"APITokenList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenList"},"examples":{}}},"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"uukp6v55zfp7i"},"items":{"$ref":"#/components/schemas/ApiToken","x-stoplight":{"id":"9zqpoqfkdxy0y"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"6unr17jyisial"}}}},"BadRequest":{"description":"BadReqeust","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"p9mk4oi0hbihm"},"example":"BadRequest [Error]: <ERROR MESSAGE>"}},"required":["msg"]},"examples":{"Example 1":{"value":{"msg":"BadRequest [Error]: <ERROR MESSAGE>"}}}}},"headers":{}}},"securitySchemes":{"xc-auth":{"name":"Auth Token ","type":"apiKey","in":"header","description":"Auth Token is a JWT Token generated based on the logged-in user. By default, the token is only valid for 10 hours. However, you can change the value by defining it using environment variable `NC_JWT_EXPIRES_IN`."},"xc-shared-base-id":{"name":"Shared Base ID","type":"apiKey","in":"header","description":"Shared base uuid"},"xc-shared-erd-id":{"name":"Shared ERD ID","type":"apiKey","in":"header","description":"Shared ERD uuid"}},"parameters":{"xc-token":{"name":"xc-token","in":"header","required":true,"schema":{"type":"string"},"description":"API Token. Refer [here](https://docs.nocodb.com/account-settings/api-tokens/) to know more"},"xc-auth":{"name":"xc-auth","in":"header","required":true,"schema":{"type":"string"},"description":"Auth Token is a JWT Token generated based on the logged-in user. By default, the token is only valid for 10 hours. However, you can change the value by defining it using environment variable NC_JWT_EXPIRES_IN."}}}}')},50584:e=>{"use strict";e.exports=JSON.parse('{"openapi":"3.0.0","info":{"title":"nocodb","version":"1.0"},"servers":[{"url":"http://localhost:8080"}],"paths":{},"components":{"schemas":{"Paginated":{"title":"Paginated","type":"object","properties":{"pageSize":{"type":"integer"},"totalRows":{"type":"integer"},"isFirstPage":{"type":"boolean"},"isLastPage":{"type":"boolean"},"page":{"type":"number"}}},"Attachment":{"title":"Attachment","type":"object","properties":{"mimetype":{"type":"string"},"size":{"type":"integer"},"title":{"type":"string"},"url":{"type":"string"},"icon":{"type":"string"}}},"Groupby":{"title":"Groupby","type":"object","properties":{"count":{"type":"number","description":"count"},"column_name":{"type":"string","description":"the value of the given column"}}}},"securitySchemes":{"xcToken":{"type":"apiKey","in":"header","name":"xc-token","description":"API token"}}},"security":[{"xcAuth":[]},{"xcToken":[]}]}')},50096:e=>{"use strict";e.exports=JSON.parse('{"openapi":"3.0.0","info":{"title":"nocodb","version":"2.0"},"servers":[{"url":"http://localhost:8080"}],"paths":{},"components":{"schemas":{"Paginated":{"title":"Paginated","type":"object","properties":{"pageSize":{"type":"integer"},"totalRows":{"type":"integer"},"isFirstPage":{"type":"boolean"},"isLastPage":{"type":"boolean"},"page":{"type":"number"}}},"Attachment":{"title":"Attachment","type":"object","properties":{"mimetype":{"type":"string"},"size":{"type":"integer"},"title":{"type":"string"},"url":{"type":"string"},"icon":{"type":"string"}}},"Groupby":{"title":"Groupby","type":"object","properties":{"count":{"type":"number","description":"count"},"column_name":{"type":"string","description":"the value of the given column"}}}},"securitySchemes":{"xcToken":{"type":"apiKey","in":"header","name":"xc-token","description":"API token"}},"responses":{"BadRequest":{"description":"BadRequest","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"p9mk4oi0hbihm"},"example":"BadRequest [Error]: <ERROR MESSAGE>"}},"required":["msg"]},"examples":{"Example 1":{"value":{"msg":"BadRequest [Error]: <ERROR MESSAGE>"}}}}},"headers":{}}}},"security":[{"xcToken":[]}]}')}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(a.exports,a,a.exports,__webpack_require__),a.loaded=!0,a.exports}__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var __webpack_exports__=__webpack_require__(42125);return __webpack_exports__})()));